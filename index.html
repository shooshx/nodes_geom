<!DOCTYPE html><html>
<head>
<script src="gui.js"></script>
<script src="base_node.js"></script>
<script>

 var Module = {
    preRun: [],
    postRun: [],
    print: function(text) {
        console.log(text);
    },
    printErr: function(text) {
        console.error(text);
    },
    canvas: null,
    setStatus: function(text) {
        // console.log("STATUS:" + text)
    },
    totalDependencies: 0,
    monitorRunDependencies: function(left) {
    },
    onRuntimeInitialized: function() {
        //console.log('zerg');
        start()
    }    
 }  
</script>
<script src="out/geom_nodes.js"></script>
<script>
"use strict"


var ctx_nodes, ctx_image

function page_onload() {
}

function start()
{
    ctx_nodes = canvas_nodes.getContext('2d')
    
    canvas_nodes.do_draw = function() {
        draw_nodes()
    }
    canvas_image.do_draw = function() {
    }
    
    Module.start()
    
    setup_vert_splitter(main_view, image_panel, canvas_image, image_splitter, edit_panel, canvas_nodes)
    setup_horz_splitter(edit_panel, edit_params, edit_splitter, edit_nodes, canvas_nodes)
    
    nodes_panel_mouse_control()
    

    add_node(0, 0, "node1", "Geom_Primitive")
    add_node(100, 100, "node2", "Test_Dummy")
    
    draw_nodes()
}


var program = {
    nodes: [],
    lines: []
}

class NodeTestDummy {
    constructor() {
        this.inputs = [ new Terminal("in_1"), new Terminal("in_2") ]
        this.outputs = [ new Terminal("out") ]
        this.parameters = [
            
        ]
    }
}


class NodeGeomPrimitive
{
    static name() { return "Geom_Primitive" }
    constructor() {
        this.inputs = []
        this.outputs = [new Terminal("out_mesh")]
        this.parameters = [
             new ParamCoord2("size", 0.5, 0.5)
        ]
    }
}

class NodePointColor
{
    static name() { return "Point_Color" }
    constructor() {
        this.inputs = [new Terminal("in_mesh")]
        this.outputs = [new Terminal("out_mesh")]
        this.parameters = [
            new ParamColor("Uniform", "#cccccc")
        ]
    }
}

class NodeGeomMerge
{
    static name() { return "Geom_Merge" }
    constructor() {
        this.inputs = [new TerminalMulti("in_multi_mesh")]
        this.outputs = [new Terminal("out_mesh")]
        this.parameters = [
        ]
    }
}

var nodes_classes = [
    "Test_Dummy", "Geom_Primitive", "Point_Color", "Geom_Merge"
]


class Parameter
{
    constructor(label) {
        this.label = label
    }
}

window.ParamInt = class ParamInt extends Parameter {
    constructor(label) {
        super(label)
        this.value = 0
    }
}

window.ParamVec2 = class ParamVec2 extends Parameter {
    constructor(label, cpp_param) {
        super(label)
        this.cpp_param = cpp_param
    }
    init_val(x, y) {
        this.elem_x.value = x
        this.elem_y.value = y
    }
    add_elems(parent) {
        let line = addTextChild(parent, "<div class='param_line'>\
<span class='param_label_pre'>LABEL:</span>\
<input class='param_input' type='text' spellcheck='false'>\
<input class='param_input' type='text' spellcheck='false'>\
</div>".replace(/LABEL/, this.label))
        this.elem_x = line.childNodes[1]
        this.elem_y = line.childNodes[2]
        this.cpp_param.pull_value()
        let that = this
        this.elem_x.addEventListener("input", function() { that.cpp_param.set_value(0, that.elem_x.value) })
        this.elem_y.addEventListener("input", function() { that.cpp_param.set_value(1, that.elem_y.value) })
    }
}


function show_params_of(node) {
    // clear children
    let div_params_list = document.getElementById('div_params_list')
    var cNode = div_params_list.cloneNode(false);
    div_params_list.parentNode.replaceChild(cNode, div_params_list);
    div_params_list = cNode
    if (node === null)
        return
    
    for(let p of node.parameters) {
        p.add_elems(div_params_list)
    }
}

</script>
<link rel="stylesheet" type="text/css" href="style.css">

</head>
<body onload=page_onload()><div id="main_view"><div id="image_panel"><canvas id="canvas_image" width="100" height="100"></canvas></div><div id="image_splitter" class="splitter"></div><div id="edit_panel"><div id="edit_params"><div id="div_params_list"></div></div><div id="edit_splitter" class="splitter"></div><div id="edit_nodes"><canvas id="canvas_nodes" width="100" height="100"></div></div></div></body>
</html>