<html>
<head>
<script src="gui.js"></script>
<script src="base_node.js"></script>
<script>
"use strict"


var ctx_nodes, ctx_image

function start()
{
    ctx_nodes = canvas_nodes.getContext('2d')
    
    canvas_nodes.do_draw = function() {
        draw_nodes()
    }
    canvas_image.do_draw = function() {
    }
    
    
    setup_vert_splitter(main_view, image_panel, canvas_image, image_splitter, edit_panel, canvas_nodes)
    setup_horz_splitter(edit_panel, edit_params, edit_splitter, edit_nodes, canvas_nodes)
    
    nodes_panel_mouse_control()
    

    add_node(0, 0, "node1", NodeGeomPrimitive)
    add_node(100, 100, "node2", NodeTestDummy)
    
    draw_nodes()
}


var program = {
    nodes: [],
    lines: []
}

class NodeTestDummy {
    constructor() {
        this.inputs = [ new Terminal("in_1"), new Terminal("in_2") ]
        this.outputs = [ new Terminal("out") ]
        this.parameters = [
            
        ]
    }
}


class NodeGeomPrimitive
{
    constructor() {
        this.inputs = []
        this.outputs = [new Terminal("out_mesh")]
        this.parameters = [
             new ParamCoord2("size", 0.5, 0.5)
        ]

    }
}

class Parameter
{
    constructor(label) {
        this.label = label
    }
}

class ParamInt extends Parameter {
    constructor(label, start_val) {
        super(label)
        this.value = start_val
    }
}

class ParamCoord2 extends Parameter {
    constructor(label, start_w, start_h) {
        super(label)
        this.w = start_w;
        this.h = start_h
    }
    add_elems(parent) {
        let line = addTextChild(parent, "<div class='param_line'>\
<span class='param_label_pre'>LABEL:</span>\
<input class='param_input' type='text' spellcheck='false'>\
<input class='param_input' type='text' spellcheck='false'>\
</div>".replace(/LABEL/, this.label))
        this.elem_w = line.childNodes[1]
        this.elem_h = line.childNodes[2]
        this.elem_w.value = this.w
        this.elem_h.value = this.h
    }
}


function show_params_of(node) {
    // clear children
    let div_params_list = document.getElementById('div_params_list')
    var cNode = div_params_list.cloneNode(false);
    div_params_list.parentNode.replaceChild(cNode, div_params_list);
    div_params_list = cNode
    if (node === null)
        return
    
    for(let p of node.cls.parameters) {
        p.add_elems(div_params_list)
    }
}




</script>
<style>

body {
    margin: 0;
    box-sizing: border-box;
    font-family: Verdana;
    user-select: none;
}

#main_view {
    position: absolute;
    bottom: 0;
    top: 0;
    left: 0;
    right: 0;
}

#image_panel {
    display: inline-block;
    width: calc(50% - 4px);
}
#edit_panel {
    position: absolute;
    top: 0;
    display: inline-block;
    width: 50%;
    height:100%;
}
#edit_params {
    display: inline-block;
    height: 200px;
    width: 100%;
    background-color: #312F31;
    color: #fff;    
}

.splitter {
    display: inline-block;
    background-color: #ddd;
}
.splitter:hover {
    background-color: #ccc;
}
#image_splitter {
    cursor: col-resize;
    width:5px;
    height:100%;
}
#edit_splitter {
    cursor: row-resize;
    height: 5px;
    width: 100%;
}

.ctx_menu {
    position: absolute;
    background-color: #656565;
    padding: 7px 0;
    border-radius: 4px;
    border: solid 2px #7d7d7d;
    color: #fff;
    line-height: 140%;
}
.ctx_menu_opt {  
    padding: 0 7px;
}
.ctx_menu_opt:hover {  
    background-color: #888888;
}

.node_name_edit {
    position: absolute;
}
.node_name_input {
    outline:none;  /* no focus outline */
    width: 100px;
    font-size: 14px;
    margin-top: -5px;
    margin-left: -4px;
    background-color: #555;
    color: #fff;
    border: solid 1px #888;
    padding-left: 3px;
    border-radius: 2px;
    font-size: 15px;
}
.param_line {
    margin: 3px 0 0 0;
    overflow: none;
}
.param_label_pre {
    width: 120px;
    display: inline-block;
    text-align: right;
    padding-right: 5px;
}
.param_input {
    background-color: #555;
    color: #fff;
    border: solid 1px #888;
    margin: 0 5px;
    height: 24px;
    border-radius: 3px;
    padding: 0 5px;
    font-family: Verdana;
    width: 25%;
    min-width: 100px;
}

</style>
</head>
<body onload=start()>
  <div id="main_view">
  <div id="image_panel"><canvas id="canvas_image" width="100" height="100"></canvas></div><div id="image_splitter" class="splitter"></div><div id="edit_panel"><div id="edit_params"><div id="div_params_list"></div></div><div id="edit_splitter" class="splitter"></div><div id="edit_nodes"><canvas id="canvas_nodes" width="100" height="100"></div></div>
  </div>
  

</body>
</html>