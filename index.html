<!DOCTYPE html><html>
<head>
<script src="gui.js"></script>
<script src="base_node.js"></script>
<script src="parameters.js"></script>
<script src="mesh.js"></script>

<script>
"use strict"


var ctx_nodes, ctx_image


function page_onload()
{
    ctx_nodes = canvas_nodes.getContext('2d')
    
    canvas_nodes.do_draw = function() {
        draw_nodes()
    }
    canvas_image.do_draw = function() {
    }
    
    
    setup_vert_splitter(main_view, image_panel, canvas_image, image_splitter, edit_panel, canvas_nodes)
    setup_horz_splitter(edit_panel, edit_params, edit_splitter, edit_nodes, canvas_nodes)
    
    nodes_panel_mouse_control()
    

    add_node(0, 0, "node1", NodeGeomPrimitive)
    add_node(100, 100, "node2", NodeTestDummy)
    
    draw_nodes()
}


var program = {
    nodes: [],
    lines: [],
    display_node: null
}

class NodeTestDummy {
    static name() { return "Test_Dummy" }
    constructor(node) {
        this.in_1 = new InTerminal(node, "in_1")
        this.in_2 = new InTerminal(node, "in_2")
        this.out = new OutTerminal(node, "out")
    }
}


class NodeGeomPrimitive
{
    static name() { return "Geom_Primitive" }
    constructor(node) {
        this.out = new OutTerminal(node, "out_mesh")
        this.size = new ParamVec2(node, "size", 0.5, 0.5)
    }
    run() {
        let m = new Mesh()
        // center at 0,0
        let hx = this.size.x * 0.5, hy = this.size.y * 0.5
        m.set_vtx([-hx, -hy, hx, -hy, hx, hy, -hx, hy])
        m.set_idx([0, 1, 2, 3])
        m.set_type(MESH_QUAD)
        this.out.set(m)
    }
}

class NodePointColor
{
    static name() { return "Point_Color" }
    constructor(node) {
        this.in_mesh = new InTerminal(node, "in_mesh")
        this.out_mesh = new OutTerminal(node, "out_mesh")
        this.color = new ParamColor(node, "#cccccc")
    }
}

class NodeGeomMerge
{
    static name() { return "Geom_Merge" }
    constructor(node) {
        this.in_m = new InTerminalMulti(node, "in_multi_mesh")
        this.out = new OutTerminal(node, "out_mesh")
    }
}

// called whenever the display needs to be updated to reflect a change
function trigger_frame_draw() {

}



var nodes_classes = [
    NodeTestDummy, NodeGeomPrimitive, NodePointColor, NodeGeomMerge
]


</script>
<link rel="stylesheet" type="text/css" href="style.css">

</head>
<body onload=page_onload()><div id="main_view"><div id="image_panel"><canvas id="canvas_image" width="100" height="100"></canvas></div><div id="image_splitter" class="splitter"></div><div id="edit_panel"><div id="edit_params"><div id="div_params_list"></div></div><div id="edit_splitter" class="splitter"></div><div id="edit_nodes"><canvas id="canvas_nodes" width="100" height="100"></div></div></div></body>
</html>