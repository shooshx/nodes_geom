/*
 @fileoverview gl-matrix - High performance matrix and vector operations
@author Brandon Jones
@author Colin MacKenzie IV
@version 3.1.0

Copyright (c) 2015-2019, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

 Curve calc function for canvas 2.3.1
 Epistemex (c) 2013-2014
 License: MIT
 https://github.com/gdenisov/cardinal-spline-js
 Paper.js v0.12.4 - The Swiss Army Knife of Vector Graphics Scripting.
 http://paperjs.org/

 Copyright (c) 2011 - 2019, Juerg Lehni & Jonathan Puckey
 http://scratchdisk.com/ & https://puckey.studio/

 Distributed under the MIT license. See LICENSE file for details.

 All rights reserved.

 Date: Sun Dec 15 21:25:00 2019 +0100

**

 Straps.js - Class inheritance library with support for bean-style accessors

 Copyright (c) 2006 - 2019 Juerg Lehni
 http://scratchdisk.com/

 Distributed under the MIT license.

**

 Acorn.js
 https://marijnhaverbeke.nl/acorn/

 Acorn is a tiny, fast JavaScript parser written in JavaScript,
 created by Marijn Haverbeke and released under an MIT license.

 !
  Canvas 2 Svg v1.0.19
  A low level canvas to SVG converter. Uses a mock canvas context to build an SVG document.

  Licensed under the MIT license:
  http://www.opensource.org/licenses/mit-license.php

  Author:
  Kerry Liu

  Copyright (c) 2014 Gliffy Inc.
*/
var pb=this;
function tb(a){function b(k,p,A){var H=p[0],O=p[1],M=p[2];p=p[3];var R=A[0],W=A[1],ma=A[2];A=A[3];k[0]=H*R+M*W;k[1]=O*R+p*W;k[2]=H*ma+M*A;k[3]=O*ma+p*A;return k}function l(k,p,A){k[0]=p[0]-A[0];k[1]=p[1]-A[1];k[2]=p[2]-A[2];k[3]=p[3]-A[3];return k}function e(k,p,A){var H=p[0],O=p[1],M=p[2],R=p[3],W=p[4];p=p[5];var ma=A[0],wa=A[1],Da=A[2],Ea=A[3],Pa=A[4];A=A[5];k[0]=H*ma+M*wa;k[1]=O*ma+R*wa;k[2]=H*Da+M*Ea;k[3]=O*Da+R*Ea;k[4]=H*Pa+M*A+W;k[5]=O*Pa+R*A+p;return k}function f(k,p,A){k[0]=p[0]-A[0];k[1]=
p[1]-A[1];k[2]=p[2]-A[2];k[3]=p[3]-A[3];k[4]=p[4]-A[4];k[5]=p[5]-A[5];return k}function h(){var k=new na(9);na!=Float32Array&&(k[1]=0,k[2]=0,k[3]=0,k[5]=0,k[6]=0,k[7]=0);k[0]=1;k[4]=1;k[8]=1;return k}function g(k,p,A){var H=p[0],O=p[1],M=p[2],R=p[3],W=p[4],ma=p[5],wa=p[6],Da=p[7];p=p[8];var Ea=A[0],Pa=A[1],Ha=A[2],Ma=A[3],Ta=A[4],Ka=A[5],Wa=A[6],bb=A[7];A=A[8];k[0]=Ea*H+Pa*R+Ha*wa;k[1]=Ea*O+Pa*W+Ha*Da;k[2]=Ea*M+Pa*ma+Ha*p;k[3]=Ma*H+Ta*R+Ka*wa;k[4]=Ma*O+Ta*W+Ka*Da;k[5]=Ma*M+Ta*ma+Ka*p;k[6]=Wa*H+bb*
R+A*wa;k[7]=Wa*O+bb*W+A*Da;k[8]=Wa*M+bb*ma+A*p;return k}function m(k,p,A){k[0]=p[0]-A[0];k[1]=p[1]-A[1];k[2]=p[2]-A[2];k[3]=p[3]-A[3];k[4]=p[4]-A[4];k[5]=p[5]-A[5];k[6]=p[6]-A[6];k[7]=p[7]-A[7];k[8]=p[8]-A[8];return k}function q(k){k[0]=1;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=1;k[6]=0;k[7]=0;k[8]=0;k[9]=0;k[10]=1;k[11]=0;k[12]=0;k[13]=0;k[14]=0;k[15]=1;return k}function r(k,p,A){var H=p[0],O=p[1],M=p[2],R=p[3],W=p[4],ma=p[5],wa=p[6],Da=p[7],Ea=p[8],Pa=p[9],Ha=p[10],Ma=p[11],Ta=p[12],Ka=p[13],Wa=p[14];
p=p[15];var bb=A[0],hb=A[1],sb=A[2],Ab=A[3];k[0]=bb*H+hb*W+sb*Ea+Ab*Ta;k[1]=bb*O+hb*ma+sb*Pa+Ab*Ka;k[2]=bb*M+hb*wa+sb*Ha+Ab*Wa;k[3]=bb*R+hb*Da+sb*Ma+Ab*p;bb=A[4];hb=A[5];sb=A[6];Ab=A[7];k[4]=bb*H+hb*W+sb*Ea+Ab*Ta;k[5]=bb*O+hb*ma+sb*Pa+Ab*Ka;k[6]=bb*M+hb*wa+sb*Ha+Ab*Wa;k[7]=bb*R+hb*Da+sb*Ma+Ab*p;bb=A[8];hb=A[9];sb=A[10];Ab=A[11];k[8]=bb*H+hb*W+sb*Ea+Ab*Ta;k[9]=bb*O+hb*ma+sb*Pa+Ab*Ka;k[10]=bb*M+hb*wa+sb*Ha+Ab*Wa;k[11]=bb*R+hb*Da+sb*Ma+Ab*p;bb=A[12];hb=A[13];sb=A[14];Ab=A[15];k[12]=bb*H+hb*W+sb*Ea+Ab*
Ta;k[13]=bb*O+hb*ma+sb*Pa+Ab*Ka;k[14]=bb*M+hb*wa+sb*Ha+Ab*Wa;k[15]=bb*R+hb*Da+sb*Ma+Ab*p;return k}function B(k,p,A){var H=p[0],O=p[1],M=p[2],R=p[3],W=H+H,ma=O+O,wa=M+M;p=H*W;var Da=H*ma;H*=wa;var Ea=O*ma;O*=wa;M*=wa;W*=R;ma*=R;R*=wa;k[0]=1-(Ea+M);k[1]=Da+R;k[2]=H-ma;k[3]=0;k[4]=Da-R;k[5]=1-(p+M);k[6]=O+W;k[7]=0;k[8]=H+ma;k[9]=O-W;k[10]=1-(p+Ea);k[11]=0;k[12]=A[0];k[13]=A[1];k[14]=A[2];k[15]=1;return k}function D(k,p){k[0]=p[12];k[1]=p[13];k[2]=p[14];return k}function F(k,p){var A=p[4],H=p[5],O=p[6],
M=p[8],R=p[9],W=p[10];k[0]=Math.hypot(p[0],p[1],p[2]);k[1]=Math.hypot(A,H,O);k[2]=Math.hypot(M,R,W);return k}function G(k,p){var A=new na(3);F(A,p);var H=1/A[0],O=1/A[1],M=1/A[2],R=p[0]*H;A=p[1]*O;var W=p[2]*M,ma=p[4]*H,wa=p[5]*O,Da=p[6]*M;H*=p[8];O*=p[9];p=p[10]*M;M=R+wa+p;0<M?(R=2*Math.sqrt(M+1),k[3]=.25*R,k[0]=(Da-O)/R,k[1]=(H-W)/R,k[2]=(A-ma)/R):R>wa&&R>p?(R=2*Math.sqrt(1+R-wa-p),k[3]=(Da-O)/R,k[0]=.25*R,k[1]=(A+ma)/R,k[2]=(H+W)/R):wa>p?(R=2*Math.sqrt(1+wa-R-p),k[3]=(H-W)/R,k[0]=(A+ma)/R,k[1]=
.25*R,k[2]=(Da+O)/R):(R=2*Math.sqrt(1+p-R-wa),k[3]=(A-ma)/R,k[0]=(H+W)/R,k[1]=(Da+O)/R,k[2]=.25*R);return k}function N(k,p,A){k[0]=p[0]-A[0];k[1]=p[1]-A[1];k[2]=p[2]-A[2];k[3]=p[3]-A[3];k[4]=p[4]-A[4];k[5]=p[5]-A[5];k[6]=p[6]-A[6];k[7]=p[7]-A[7];k[8]=p[8]-A[8];k[9]=p[9]-A[9];k[10]=p[10]-A[10];k[11]=p[11]-A[11];k[12]=p[12]-A[12];k[13]=p[13]-A[13];k[14]=p[14]-A[14];k[15]=p[15]-A[15];return k}function T(){var k=new na(3);na!=Float32Array&&(k[0]=0,k[1]=0,k[2]=0);return k}function V(k){return Math.hypot(k[0],
k[1],k[2])}function E(k,p,A){var H=new na(3);H[0]=k;H[1]=p;H[2]=A;return H}function Q(k,p,A){k[0]=p[0]-A[0];k[1]=p[1]-A[1];k[2]=p[2]-A[2];return k}function aa(k,p,A){k[0]=p[0]*A[0];k[1]=p[1]*A[1];k[2]=p[2]*A[2];return k}function qa(k,p,A){k[0]=p[0]/A[0];k[1]=p[1]/A[1];k[2]=p[2]/A[2];return k}function P(k,p){return Math.hypot(p[0]-k[0],p[1]-k[1],p[2]-k[2])}function ea(k,p){var A=p[0]-k[0],H=p[1]-k[1];k=p[2]-k[2];return A*A+H*H+k*k}function ua(k){var p=k[0],A=k[1];k=k[2];return p*p+A*A+k*k}function Fa(k,
p){var A=p[0],H=p[1],O=p[2];A=A*A+H*H+O*O;0<A&&(A=1/Math.sqrt(A));k[0]=p[0]*A;k[1]=p[1]*A;k[2]=p[2]*A;return k}function pa(k,p){return k[0]*p[0]+k[1]*p[1]+k[2]*p[2]}function ra(k,p,A){var H=p[0],O=p[1];p=p[2];var M=A[0],R=A[1];A=A[2];k[0]=O*A-p*R;k[1]=p*M-H*A;k[2]=H*R-O*M;return k}function Ca(){var k=new na(4);na!=Float32Array&&(k[0]=0,k[1]=0,k[2]=0,k[3]=0);return k}function Ga(k){var p=new na(4);p[0]=k[0];p[1]=k[1];p[2]=k[2];p[3]=k[3];return p}function Aa(k,p,A,H){var O=new na(4);O[0]=k;O[1]=p;O[2]=
A;O[3]=H;return O}function xa(k,p){k[0]=p[0];k[1]=p[1];k[2]=p[2];k[3]=p[3];return k}function za(k,p,A,H,O){k[0]=p;k[1]=A;k[2]=H;k[3]=O;return k}function Na(k,p,A){k[0]=p[0]+A[0];k[1]=p[1]+A[1];k[2]=p[2]+A[2];k[3]=p[3]+A[3];return k}function ya(k,p,A){k[0]=p[0]-A[0];k[1]=p[1]-A[1];k[2]=p[2]-A[2];k[3]=p[3]-A[3];return k}function Ia(k,p,A){k[0]=p[0]*A[0];k[1]=p[1]*A[1];k[2]=p[2]*A[2];k[3]=p[3]*A[3];return k}function $a(k,p,A){k[0]=p[0]/A[0];k[1]=p[1]/A[1];k[2]=p[2]/A[2];k[3]=p[3]/A[3];return k}function lb(k,
p,A){k[0]=p[0]*A;k[1]=p[1]*A;k[2]=p[2]*A;k[3]=p[3]*A;return k}function xb(k,p){return Math.hypot(p[0]-k[0],p[1]-k[1],p[2]-k[2],p[3]-k[3])}function Cb(k,p){var A=p[0]-k[0],H=p[1]-k[1],O=p[2]-k[2];k=p[3]-k[3];return A*A+H*H+O*O+k*k}function ca(k){return Math.hypot(k[0],k[1],k[2],k[3])}function Sa(k){var p=k[0],A=k[1],H=k[2];k=k[3];return p*p+A*A+H*H+k*k}function Va(k,p){var A=p[0],H=p[1],O=p[2];p=p[3];var M=A*A+H*H+O*O+p*p;0<M&&(M=1/Math.sqrt(M));k[0]=A*M;k[1]=H*M;k[2]=O*M;k[3]=p*M;return k}function fb(k,
p){return k[0]*p[0]+k[1]*p[1]+k[2]*p[2]+k[3]*p[3]}function Qa(k,p,A,H){var O=p[0],M=p[1],R=p[2];p=p[3];k[0]=O+H*(A[0]-O);k[1]=M+H*(A[1]-M);k[2]=R+H*(A[2]-R);k[3]=p+H*(A[3]-p);return k}function eb(k,p){return k[0]===p[0]&&k[1]===p[1]&&k[2]===p[2]&&k[3]===p[3]}function mb(k,p){var A=k[0],H=k[1],O=k[2];k=k[3];var M=p[0],R=p[1],W=p[2];p=p[3];return Math.abs(A-M)<=1E-6*Math.max(1,Math.abs(A),Math.abs(M))&&Math.abs(H-R)<=1E-6*Math.max(1,Math.abs(H),Math.abs(R))&&Math.abs(O-W)<=1E-6*Math.max(1,Math.abs(O),
Math.abs(W))&&Math.abs(k-p)<=1E-6*Math.max(1,Math.abs(k),Math.abs(p))}function ub(){var k=new na(4);na!=Float32Array&&(k[0]=0,k[1]=0,k[2]=0);k[3]=1;return k}function Bb(k,p,A){A*=.5;var H=Math.sin(A);k[0]=H*p[0];k[1]=H*p[1];k[2]=H*p[2];k[3]=Math.cos(A);return k}function qb(k,p,A){var H=p[0],O=p[1],M=p[2];p=p[3];var R=A[0],W=A[1],ma=A[2];A=A[3];k[0]=H*A+p*R+O*ma-M*W;k[1]=O*A+p*W+M*R-H*ma;k[2]=M*A+p*ma+H*W-O*R;k[3]=p*A-H*R-O*W-M*ma;return k}function yb(k,p,A){A*=.5;var H=p[0],O=p[1],M=p[2];p=p[3];var R=
Math.sin(A);A=Math.cos(A);k[0]=H*A+p*R;k[1]=O*A+M*R;k[2]=M*A-O*R;k[3]=p*A-H*R;return k}function Ib(k,p,A){A*=.5;var H=p[0],O=p[1],M=p[2];p=p[3];var R=Math.sin(A);A=Math.cos(A);k[0]=H*A-M*R;k[1]=O*A+p*R;k[2]=M*A+H*R;k[3]=p*A-O*R;return k}function Pb(k,p,A){A*=.5;var H=p[0],O=p[1],M=p[2];p=p[3];var R=Math.sin(A);A=Math.cos(A);k[0]=H*A+O*R;k[1]=O*A-H*R;k[2]=M*A+p*R;k[3]=p*A-M*R;return k}function Eb(k,p){var A=p[0],H=p[1],O=p[2],M=Math.sqrt(A*A+H*H+O*O);p=Math.exp(p[3]);var R=0<M?p*Math.sin(M)/M:0;k[0]=
A*R;k[1]=H*R;k[2]=O*R;k[3]=p*Math.cos(M);return k}function z(k,p){var A=p[0],H=p[1],O=p[2];p=p[3];var M=Math.sqrt(A*A+H*H+O*O);M=0<M?Math.atan2(M,p)/M:0;k[0]=A*M;k[1]=H*M;k[2]=O*M;k[3]=.5*Math.log(A*A+H*H+O*O+p*p);return k}function Xb(k,p,A,H){var O=p[0],M=p[1],R=p[2];p=p[3];var W=A[0],ma=A[1],wa=A[2];A=A[3];var Da=O*W+M*ma+R*wa+p*A;0>Da&&(Da=-Da,W=-W,ma=-ma,wa=-wa,A=-A);if(1E-6<1-Da){var Ea=Math.acos(Da);var Pa=Math.sin(Ea);Da=Math.sin((1-H)*Ea)/Pa;H=Math.sin(H*Ea)/Pa}else Da=1-H;k[0]=Da*O+H*W;k[1]=
Da*M+H*ma;k[2]=Da*R+H*wa;k[3]=Da*p+H*A;return k}function Nb(k,p){var A=p[0]+p[4]+p[8];if(0<A)A=Math.sqrt(A+1),k[3]=.5*A,A=.5/A,k[0]=(p[5]-p[7])*A,k[1]=(p[6]-p[2])*A,k[2]=(p[1]-p[3])*A;else{var H=0;p[4]>p[0]&&(H=1);p[8]>p[3*H+H]&&(H=2);var O=(H+1)%3,M=(H+2)%3;A=Math.sqrt(p[3*H+H]-p[3*O+O]-p[3*M+M]+1);k[H]=.5*A;A=.5/A;k[3]=(p[3*O+M]-p[3*M+O])*A;k[O]=(p[3*O+H]+p[3*H+O])*A;k[M]=(p[3*M+H]+p[3*H+M])*A}return k}function Rb(k,p,A){var H=.5*A[0],O=.5*A[1];A=.5*A[2];var M=p[0],R=p[1],W=p[2];p=p[3];k[0]=M;k[1]=
R;k[2]=W;k[3]=p;k[4]=H*p+O*W-A*R;k[5]=O*p+A*M-H*W;k[6]=A*p+H*R-O*M;k[7]=-H*M-O*R-A*W;return k}function Fb(k,p){k[0]=p[0];k[1]=p[1];k[2]=p[2];k[3]=p[3];k[4]=p[4];k[5]=p[5];k[6]=p[6];k[7]=p[7];return k}function Wb(k,p,A){var H=p[0],O=p[1],M=p[2],R=p[3],W=A[4],ma=A[5],wa=A[6],Da=A[7],Ea=p[4],Pa=p[5],Ha=p[6];p=p[7];var Ma=A[0],Ta=A[1],Ka=A[2];A=A[3];k[0]=H*A+R*Ma+O*Ka-M*Ta;k[1]=O*A+R*Ta+M*Ma-H*Ka;k[2]=M*A+R*Ka+H*Ta-O*Ma;k[3]=R*A-H*Ma-O*Ta-M*Ka;k[4]=H*Da+R*W+O*wa-M*ma+Ea*A+p*Ma+Pa*Ka-Ha*Ta;k[5]=O*Da+R*
ma+M*W-H*wa+Pa*A+p*Ta+Ha*Ma-Ea*Ka;k[6]=M*Da+R*wa+H*ma-O*W+Ha*A+p*Ka+Ea*Ta-Pa*Ma;k[7]=R*Da-H*W-O*ma-M*wa+p*A-Ea*Ma-Pa*Ta-Ha*Ka;return k}function ib(){var k=new na(2);na!=Float32Array&&(k[0]=0,k[1]=0);return k}function rb(k,p,A){k[0]=p[0]-A[0];k[1]=p[1]-A[1];return k}function ab(k,p,A){k[0]=p[0]*A[0];k[1]=p[1]*A[1];return k}function ob(k,p,A){k[0]=p[0]/A[0];k[1]=p[1]/A[1];return k}function J(k,p){return Math.hypot(p[0]-k[0],p[1]-k[1])}function S(k,p){var A=p[0]-k[0];k=p[1]-k[1];return A*A+k*k}function fa(k){return Math.hypot(k[0],
k[1])}function oa(k){var p=k[0];k=k[1];return p*p+k*k}var na="undefined"!==typeof Float32Array?Float32Array:Array,ja=Math.random,Ba=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var k=0,p=arguments.length;p--;)k+=arguments[p]*arguments[p];return Math.sqrt(k)});var Ua=Object.freeze({EPSILON:1E-6,get ARRAY_TYPE(){return na},RANDOM:ja,setMatrixArrayType:function(k){na=k},toRadian:function(k){return k*Ba},equals:function(k,p){return Math.abs(k-p)<=1E-6*Math.max(1,Math.abs(k),Math.abs(p))}}),Ya=Object.freeze({create:function(){var k=
new na(4);na!=Float32Array&&(k[1]=0,k[2]=0);k[0]=1;k[3]=1;return k},clone:function(k){var p=new na(4);p[0]=k[0];p[1]=k[1];p[2]=k[2];p[3]=k[3];return p},copy:function(k,p){k[0]=p[0];k[1]=p[1];k[2]=p[2];k[3]=p[3];return k},identity:function(k){k[0]=1;k[1]=0;k[2]=0;k[3]=1;return k},fromValues:function(k,p,A,H){var O=new na(4);O[0]=k;O[1]=p;O[2]=A;O[3]=H;return O},set:function(k,p,A,H,O){k[0]=p;k[1]=A;k[2]=H;k[3]=O;return k},transpose:function(k,p){if(k===p){var A=p[1];k[1]=p[2];k[2]=A}else k[0]=p[0],
k[1]=p[2],k[2]=p[1],k[3]=p[3];return k},invert:function(k,p){var A=p[0],H=p[1],O=p[2];p=p[3];var M=A*p-O*H;if(!M)return null;M=1/M;k[0]=p*M;k[1]=-H*M;k[2]=-O*M;k[3]=A*M;return k},adjoint:function(k,p){var A=p[0];k[0]=p[3];k[1]=-p[1];k[2]=-p[2];k[3]=A;return k},determinant:function(k){return k[0]*k[3]-k[2]*k[1]},multiply:b,rotate:function(k,p,A){var H=p[0],O=p[1],M=p[2];p=p[3];var R=Math.sin(A);A=Math.cos(A);k[0]=H*A+M*R;k[1]=O*A+p*R;k[2]=H*-R+M*A;k[3]=O*-R+p*A;return k},scale:function(k,p,A){var H=
p[1],O=p[2],M=p[3],R=A[0];A=A[1];k[0]=p[0]*R;k[1]=H*R;k[2]=O*A;k[3]=M*A;return k},fromRotation:function(k,p){var A=Math.sin(p);p=Math.cos(p);k[0]=p;k[1]=A;k[2]=-A;k[3]=p;return k},fromScaling:function(k,p){k[0]=p[0];k[1]=0;k[2]=0;k[3]=p[1];return k},str:function(k){return"mat2("+k[0]+", "+k[1]+", "+k[2]+", "+k[3]+")"},frob:function(k){return Math.hypot(k[0],k[1],k[2],k[3])},LDU:function(k,p,A,H){k[2]=H[2]/H[0];A[0]=H[0];A[1]=H[1];A[3]=H[3]-k[2]*A[1];return[k,p,A]},add:function(k,p,A){k[0]=p[0]+A[0];
k[1]=p[1]+A[1];k[2]=p[2]+A[2];k[3]=p[3]+A[3];return k},subtract:l,exactEquals:function(k,p){return k[0]===p[0]&&k[1]===p[1]&&k[2]===p[2]&&k[3]===p[3]},equals:function(k,p){var A=k[0],H=k[1],O=k[2];k=k[3];var M=p[0],R=p[1],W=p[2];p=p[3];return Math.abs(A-M)<=1E-6*Math.max(1,Math.abs(A),Math.abs(M))&&Math.abs(H-R)<=1E-6*Math.max(1,Math.abs(H),Math.abs(R))&&Math.abs(O-W)<=1E-6*Math.max(1,Math.abs(O),Math.abs(W))&&Math.abs(k-p)<=1E-6*Math.max(1,Math.abs(k),Math.abs(p))},multiplyScalar:function(k,p,A){k[0]=
p[0]*A;k[1]=p[1]*A;k[2]=p[2]*A;k[3]=p[3]*A;return k},multiplyScalarAndAdd:function(k,p,A,H){k[0]=p[0]+A[0]*H;k[1]=p[1]+A[1]*H;k[2]=p[2]+A[2]*H;k[3]=p[3]+A[3]*H;return k},mul:b,sub:l}),K=Object.freeze({create:function(){var k=new na(6);na!=Float32Array&&(k[1]=0,k[2]=0,k[4]=0,k[5]=0);k[0]=1;k[3]=1;return k},clone:function(k){var p=new na(6);p[0]=k[0];p[1]=k[1];p[2]=k[2];p[3]=k[3];p[4]=k[4];p[5]=k[5];return p},copy:function(k,p){k[0]=p[0];k[1]=p[1];k[2]=p[2];k[3]=p[3];k[4]=p[4];k[5]=p[5];return k},identity:function(k){k[0]=
1;k[1]=0;k[2]=0;k[3]=1;k[4]=0;k[5]=0;return k},fromValues:function(k,p,A,H,O,M){var R=new na(6);R[0]=k;R[1]=p;R[2]=A;R[3]=H;R[4]=O;R[5]=M;return R},set:function(k,p,A,H,O,M,R){k[0]=p;k[1]=A;k[2]=H;k[3]=O;k[4]=M;k[5]=R;return k},invert:function(k,p){var A=p[0],H=p[1],O=p[2],M=p[3],R=p[4];p=p[5];var W=A*M-H*O;if(!W)return null;W=1/W;k[0]=M*W;k[1]=-H*W;k[2]=-O*W;k[3]=A*W;k[4]=(O*p-M*R)*W;k[5]=(H*R-A*p)*W;return k},determinant:function(k){return k[0]*k[3]-k[1]*k[2]},multiply:e,rotate:function(k,p,A){var H=
p[0],O=p[1],M=p[2],R=p[3],W=p[4];p=p[5];var ma=Math.sin(A);A=Math.cos(A);k[0]=H*A+M*ma;k[1]=O*A+R*ma;k[2]=H*-ma+M*A;k[3]=O*-ma+R*A;k[4]=W;k[5]=p;return k},scale:function(k,p,A){var H=p[1],O=p[2],M=p[3],R=p[4],W=p[5],ma=A[0];A=A[1];k[0]=p[0]*ma;k[1]=H*ma;k[2]=O*A;k[3]=M*A;k[4]=R;k[5]=W;return k},translate:function(k,p,A){var H=p[0],O=p[1],M=p[2],R=p[3],W=p[4];p=p[5];var ma=A[0];A=A[1];k[0]=H;k[1]=O;k[2]=M;k[3]=R;k[4]=H*ma+M*A+W;k[5]=O*ma+R*A+p;return k},fromRotation:function(k,p){var A=Math.sin(p);
p=Math.cos(p);k[0]=p;k[1]=A;k[2]=-A;k[3]=p;k[4]=0;k[5]=0;return k},fromScaling:function(k,p){k[0]=p[0];k[1]=0;k[2]=0;k[3]=p[1];k[4]=0;k[5]=0;return k},fromTranslation:function(k,p){k[0]=1;k[1]=0;k[2]=0;k[3]=1;k[4]=p[0];k[5]=p[1];return k},str:function(k){return"mat2d("+k[0]+", "+k[1]+", "+k[2]+", "+k[3]+", "+k[4]+", "+k[5]+")"},frob:function(k){return Math.hypot(k[0],k[1],k[2],k[3],k[4],k[5],1)},add:function(k,p,A){k[0]=p[0]+A[0];k[1]=p[1]+A[1];k[2]=p[2]+A[2];k[3]=p[3]+A[3];k[4]=p[4]+A[4];k[5]=p[5]+
A[5];return k},subtract:f,multiplyScalar:function(k,p,A){k[0]=p[0]*A;k[1]=p[1]*A;k[2]=p[2]*A;k[3]=p[3]*A;k[4]=p[4]*A;k[5]=p[5]*A;return k},multiplyScalarAndAdd:function(k,p,A,H){k[0]=p[0]+A[0]*H;k[1]=p[1]+A[1]*H;k[2]=p[2]+A[2]*H;k[3]=p[3]+A[3]*H;k[4]=p[4]+A[4]*H;k[5]=p[5]+A[5]*H;return k},exactEquals:function(k,p){return k[0]===p[0]&&k[1]===p[1]&&k[2]===p[2]&&k[3]===p[3]&&k[4]===p[4]&&k[5]===p[5]},equals:function(k,p){var A=k[0],H=k[1],O=k[2],M=k[3],R=k[4];k=k[5];var W=p[0],ma=p[1],wa=p[2],Da=p[3],
Ea=p[4];p=p[5];return Math.abs(A-W)<=1E-6*Math.max(1,Math.abs(A),Math.abs(W))&&Math.abs(H-ma)<=1E-6*Math.max(1,Math.abs(H),Math.abs(ma))&&Math.abs(O-wa)<=1E-6*Math.max(1,Math.abs(O),Math.abs(wa))&&Math.abs(M-Da)<=1E-6*Math.max(1,Math.abs(M),Math.abs(Da))&&Math.abs(R-Ea)<=1E-6*Math.max(1,Math.abs(R),Math.abs(Ea))&&Math.abs(k-p)<=1E-6*Math.max(1,Math.abs(k),Math.abs(p))},mul:e,sub:f}),X=Object.freeze({create:h,fromMat4:function(k,p){k[0]=p[0];k[1]=p[1];k[2]=p[2];k[3]=p[4];k[4]=p[5];k[5]=p[6];k[6]=p[8];
k[7]=p[9];k[8]=p[10];return k},clone:function(k){var p=new na(9);p[0]=k[0];p[1]=k[1];p[2]=k[2];p[3]=k[3];p[4]=k[4];p[5]=k[5];p[6]=k[6];p[7]=k[7];p[8]=k[8];return p},copy:function(k,p){k[0]=p[0];k[1]=p[1];k[2]=p[2];k[3]=p[3];k[4]=p[4];k[5]=p[5];k[6]=p[6];k[7]=p[7];k[8]=p[8];return k},fromValues:function(k,p,A,H,O,M,R,W,ma){var wa=new na(9);wa[0]=k;wa[1]=p;wa[2]=A;wa[3]=H;wa[4]=O;wa[5]=M;wa[6]=R;wa[7]=W;wa[8]=ma;return wa},set:function(k,p,A,H,O,M,R,W,ma,wa){k[0]=p;k[1]=A;k[2]=H;k[3]=O;k[4]=M;k[5]=
R;k[6]=W;k[7]=ma;k[8]=wa;return k},identity:function(k){k[0]=1;k[1]=0;k[2]=0;k[3]=0;k[4]=1;k[5]=0;k[6]=0;k[7]=0;k[8]=1;return k},transpose:function(k,p){if(k===p){var A=p[1],H=p[2],O=p[5];k[1]=p[3];k[2]=p[6];k[3]=A;k[5]=p[7];k[6]=H;k[7]=O}else k[0]=p[0],k[1]=p[3],k[2]=p[6],k[3]=p[1],k[4]=p[4],k[5]=p[7],k[6]=p[2],k[7]=p[5],k[8]=p[8];return k},invert:function(k,p){var A=p[0],H=p[1],O=p[2],M=p[3],R=p[4],W=p[5],ma=p[6],wa=p[7];p=p[8];var Da=p*R-W*wa,Ea=-p*M+W*ma,Pa=wa*M-R*ma,Ha=A*Da+H*Ea+O*Pa;if(!Ha)return null;
Ha=1/Ha;k[0]=Da*Ha;k[1]=(-p*H+O*wa)*Ha;k[2]=(W*H-O*R)*Ha;k[3]=Ea*Ha;k[4]=(p*A-O*ma)*Ha;k[5]=(-W*A+O*M)*Ha;k[6]=Pa*Ha;k[7]=(-wa*A+H*ma)*Ha;k[8]=(R*A-H*M)*Ha;return k},adjoint:function(k,p){var A=p[0],H=p[1],O=p[2],M=p[3],R=p[4],W=p[5],ma=p[6],wa=p[7];p=p[8];k[0]=R*p-W*wa;k[1]=O*wa-H*p;k[2]=H*W-O*R;k[3]=W*ma-M*p;k[4]=A*p-O*ma;k[5]=O*M-A*W;k[6]=M*wa-R*ma;k[7]=H*ma-A*wa;k[8]=A*R-H*M;return k},determinant:function(k){var p=k[3],A=k[4],H=k[5],O=k[6],M=k[7],R=k[8];return k[0]*(R*A-H*M)+k[1]*(-R*p+H*O)+k[2]*
(M*p-A*O)},multiply:g,translate:function(k,p,A){var H=p[0],O=p[1],M=p[2],R=p[3],W=p[4],ma=p[5],wa=p[6],Da=p[7];p=p[8];var Ea=A[0];A=A[1];k[0]=H;k[1]=O;k[2]=M;k[3]=R;k[4]=W;k[5]=ma;k[6]=Ea*H+A*R+wa;k[7]=Ea*O+A*W+Da;k[8]=Ea*M+A*ma+p;return k},rotate:function(k,p,A){var H=p[0],O=p[1],M=p[2],R=p[3],W=p[4],ma=p[5],wa=p[6],Da=p[7];p=p[8];var Ea=Math.sin(A);A=Math.cos(A);k[0]=A*H+Ea*R;k[1]=A*O+Ea*W;k[2]=A*M+Ea*ma;k[3]=A*R-Ea*H;k[4]=A*W-Ea*O;k[5]=A*ma-Ea*M;k[6]=wa;k[7]=Da;k[8]=p;return k},scale:function(k,
p,A){var H=A[0];A=A[1];k[0]=H*p[0];k[1]=H*p[1];k[2]=H*p[2];k[3]=A*p[3];k[4]=A*p[4];k[5]=A*p[5];k[6]=p[6];k[7]=p[7];k[8]=p[8];return k},fromTranslation:function(k,p){k[0]=1;k[1]=0;k[2]=0;k[3]=0;k[4]=1;k[5]=0;k[6]=p[0];k[7]=p[1];k[8]=1;return k},fromRotation:function(k,p){var A=Math.sin(p);p=Math.cos(p);k[0]=p;k[1]=A;k[2]=0;k[3]=-A;k[4]=p;k[5]=0;k[6]=0;k[7]=0;k[8]=1;return k},fromScaling:function(k,p){k[0]=p[0];k[1]=0;k[2]=0;k[3]=0;k[4]=p[1];k[5]=0;k[6]=0;k[7]=0;k[8]=1;return k},fromMat2d:function(k,
p){k[0]=p[0];k[1]=p[1];k[2]=0;k[3]=p[2];k[4]=p[3];k[5]=0;k[6]=p[4];k[7]=p[5];k[8]=1;return k},fromQuat:function(k,p){var A=p[0],H=p[1],O=p[2];p=p[3];var M=A+A,R=H+H,W=O+O;A*=M;var ma=H*M;H*=R;var wa=O*M,Da=O*R;O*=W;M*=p;R*=p;p*=W;k[0]=1-H-O;k[3]=ma-p;k[6]=wa+R;k[1]=ma+p;k[4]=1-A-O;k[7]=Da-M;k[2]=wa-R;k[5]=Da+M;k[8]=1-A-H;return k},normalFromMat4:function(k,p){var A=p[0],H=p[1],O=p[2],M=p[3],R=p[4],W=p[5],ma=p[6],wa=p[7],Da=p[8],Ea=p[9],Pa=p[10],Ha=p[11],Ma=p[12],Ta=p[13],Ka=p[14];p=p[15];var Wa=A*
W-H*R,bb=A*ma-O*R,hb=A*wa-M*R,sb=H*ma-O*W,Ab=H*wa-M*W,La=O*wa-M*ma,Ra=Da*Ta-Ea*Ma,Za=Da*Ka-Pa*Ma;Da=Da*p-Ha*Ma;var cb=Ea*Ka-Pa*Ta;Ea=Ea*p-Ha*Ta;Pa=Pa*p-Ha*Ka;Ha=Wa*Pa-bb*Ea+hb*cb+sb*Da-Ab*Za+La*Ra;if(!Ha)return null;Ha=1/Ha;k[0]=(W*Pa-ma*Ea+wa*cb)*Ha;k[1]=(ma*Da-R*Pa-wa*Za)*Ha;k[2]=(R*Ea-W*Da+wa*Ra)*Ha;k[3]=(O*Ea-H*Pa-M*cb)*Ha;k[4]=(A*Pa-O*Da+M*Za)*Ha;k[5]=(H*Da-A*Ea-M*Ra)*Ha;k[6]=(Ta*La-Ka*Ab+p*sb)*Ha;k[7]=(Ka*hb-Ma*La-p*bb)*Ha;k[8]=(Ma*Ab-Ta*hb+p*Wa)*Ha;return k},projection:function(k,p,A){k[0]=
2/p;k[1]=0;k[2]=0;k[3]=0;k[4]=-2/A;k[5]=0;k[6]=-1;k[7]=1;k[8]=1;return k},str:function(k){return"mat3("+k[0]+", "+k[1]+", "+k[2]+", "+k[3]+", "+k[4]+", "+k[5]+", "+k[6]+", "+k[7]+", "+k[8]+")"},frob:function(k){return Math.hypot(k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7],k[8])},add:function(k,p,A){k[0]=p[0]+A[0];k[1]=p[1]+A[1];k[2]=p[2]+A[2];k[3]=p[3]+A[3];k[4]=p[4]+A[4];k[5]=p[5]+A[5];k[6]=p[6]+A[6];k[7]=p[7]+A[7];k[8]=p[8]+A[8];return k},subtract:m,multiplyScalar:function(k,p,A){k[0]=p[0]*A;k[1]=p[1]*
A;k[2]=p[2]*A;k[3]=p[3]*A;k[4]=p[4]*A;k[5]=p[5]*A;k[6]=p[6]*A;k[7]=p[7]*A;k[8]=p[8]*A;return k},multiplyScalarAndAdd:function(k,p,A,H){k[0]=p[0]+A[0]*H;k[1]=p[1]+A[1]*H;k[2]=p[2]+A[2]*H;k[3]=p[3]+A[3]*H;k[4]=p[4]+A[4]*H;k[5]=p[5]+A[5]*H;k[6]=p[6]+A[6]*H;k[7]=p[7]+A[7]*H;k[8]=p[8]+A[8]*H;return k},exactEquals:function(k,p){return k[0]===p[0]&&k[1]===p[1]&&k[2]===p[2]&&k[3]===p[3]&&k[4]===p[4]&&k[5]===p[5]&&k[6]===p[6]&&k[7]===p[7]&&k[8]===p[8]},equals:function(k,p){var A=k[0],H=k[1],O=k[2],M=k[3],
R=k[4],W=k[5],ma=k[6],wa=k[7];k=k[8];var Da=p[0],Ea=p[1],Pa=p[2],Ha=p[3],Ma=p[4],Ta=p[5],Ka=p[6],Wa=p[7];p=p[8];return Math.abs(A-Da)<=1E-6*Math.max(1,Math.abs(A),Math.abs(Da))&&Math.abs(H-Ea)<=1E-6*Math.max(1,Math.abs(H),Math.abs(Ea))&&Math.abs(O-Pa)<=1E-6*Math.max(1,Math.abs(O),Math.abs(Pa))&&Math.abs(M-Ha)<=1E-6*Math.max(1,Math.abs(M),Math.abs(Ha))&&Math.abs(R-Ma)<=1E-6*Math.max(1,Math.abs(R),Math.abs(Ma))&&Math.abs(W-Ta)<=1E-6*Math.max(1,Math.abs(W),Math.abs(Ta))&&Math.abs(ma-Ka)<=1E-6*Math.max(1,
Math.abs(ma),Math.abs(Ka))&&Math.abs(wa-Wa)<=1E-6*Math.max(1,Math.abs(wa),Math.abs(Wa))&&Math.abs(k-p)<=1E-6*Math.max(1,Math.abs(k),Math.abs(p))},mul:g,sub:m}),Y=Object.freeze({create:function(){var k=new na(16);na!=Float32Array&&(k[1]=0,k[2]=0,k[3]=0,k[4]=0,k[6]=0,k[7]=0,k[8]=0,k[9]=0,k[11]=0,k[12]=0,k[13]=0,k[14]=0);k[0]=1;k[5]=1;k[10]=1;k[15]=1;return k},clone:function(k){var p=new na(16);p[0]=k[0];p[1]=k[1];p[2]=k[2];p[3]=k[3];p[4]=k[4];p[5]=k[5];p[6]=k[6];p[7]=k[7];p[8]=k[8];p[9]=k[9];p[10]=
k[10];p[11]=k[11];p[12]=k[12];p[13]=k[13];p[14]=k[14];p[15]=k[15];return p},copy:function(k,p){k[0]=p[0];k[1]=p[1];k[2]=p[2];k[3]=p[3];k[4]=p[4];k[5]=p[5];k[6]=p[6];k[7]=p[7];k[8]=p[8];k[9]=p[9];k[10]=p[10];k[11]=p[11];k[12]=p[12];k[13]=p[13];k[14]=p[14];k[15]=p[15];return k},fromValues:function(k,p,A,H,O,M,R,W,ma,wa,Da,Ea,Pa,Ha,Ma,Ta){var Ka=new na(16);Ka[0]=k;Ka[1]=p;Ka[2]=A;Ka[3]=H;Ka[4]=O;Ka[5]=M;Ka[6]=R;Ka[7]=W;Ka[8]=ma;Ka[9]=wa;Ka[10]=Da;Ka[11]=Ea;Ka[12]=Pa;Ka[13]=Ha;Ka[14]=Ma;Ka[15]=Ta;return Ka},
set:function(k,p,A,H,O,M,R,W,ma,wa,Da,Ea,Pa,Ha,Ma,Ta,Ka){k[0]=p;k[1]=A;k[2]=H;k[3]=O;k[4]=M;k[5]=R;k[6]=W;k[7]=ma;k[8]=wa;k[9]=Da;k[10]=Ea;k[11]=Pa;k[12]=Ha;k[13]=Ma;k[14]=Ta;k[15]=Ka;return k},identity:q,transpose:function(k,p){if(k===p){var A=p[1],H=p[2],O=p[3],M=p[6],R=p[7],W=p[11];k[1]=p[4];k[2]=p[8];k[3]=p[12];k[4]=A;k[6]=p[9];k[7]=p[13];k[8]=H;k[9]=M;k[11]=p[14];k[12]=O;k[13]=R;k[14]=W}else k[0]=p[0],k[1]=p[4],k[2]=p[8],k[3]=p[12],k[4]=p[1],k[5]=p[5],k[6]=p[9],k[7]=p[13],k[8]=p[2],k[9]=p[6],
k[10]=p[10],k[11]=p[14],k[12]=p[3],k[13]=p[7],k[14]=p[11],k[15]=p[15];return k},invert:function(k,p){var A=p[0],H=p[1],O=p[2],M=p[3],R=p[4],W=p[5],ma=p[6],wa=p[7],Da=p[8],Ea=p[9],Pa=p[10],Ha=p[11],Ma=p[12],Ta=p[13],Ka=p[14];p=p[15];var Wa=A*W-H*R,bb=A*ma-O*R,hb=A*wa-M*R,sb=H*ma-O*W,Ab=H*wa-M*W,La=O*wa-M*ma,Ra=Da*Ta-Ea*Ma,Za=Da*Ka-Pa*Ma,cb=Da*p-Ha*Ma,gb=Ea*Ka-Pa*Ta,kb=Ea*p-Ha*Ta,jb=Pa*p-Ha*Ka,Db=Wa*jb-bb*kb+hb*gb+sb*cb-Ab*Za+La*Ra;if(!Db)return null;Db=1/Db;k[0]=(W*jb-ma*kb+wa*gb)*Db;k[1]=(O*kb-H*
jb-M*gb)*Db;k[2]=(Ta*La-Ka*Ab+p*sb)*Db;k[3]=(Pa*Ab-Ea*La-Ha*sb)*Db;k[4]=(ma*cb-R*jb-wa*Za)*Db;k[5]=(A*jb-O*cb+M*Za)*Db;k[6]=(Ka*hb-Ma*La-p*bb)*Db;k[7]=(Da*La-Pa*hb+Ha*bb)*Db;k[8]=(R*kb-W*cb+wa*Ra)*Db;k[9]=(H*cb-A*kb-M*Ra)*Db;k[10]=(Ma*Ab-Ta*hb+p*Wa)*Db;k[11]=(Ea*hb-Da*Ab-Ha*Wa)*Db;k[12]=(W*Za-R*gb-ma*Ra)*Db;k[13]=(A*gb-H*Za+O*Ra)*Db;k[14]=(Ta*bb-Ma*sb-Ka*Wa)*Db;k[15]=(Da*sb-Ea*bb+Pa*Wa)*Db;return k},adjoint:function(k,p){var A=p[0],H=p[1],O=p[2],M=p[3],R=p[4],W=p[5],ma=p[6],wa=p[7],Da=p[8],Ea=p[9],
Pa=p[10],Ha=p[11],Ma=p[12],Ta=p[13],Ka=p[14];p=p[15];k[0]=W*(Pa*p-Ha*Ka)-Ea*(ma*p-wa*Ka)+Ta*(ma*Ha-wa*Pa);k[1]=-(H*(Pa*p-Ha*Ka)-Ea*(O*p-M*Ka)+Ta*(O*Ha-M*Pa));k[2]=H*(ma*p-wa*Ka)-W*(O*p-M*Ka)+Ta*(O*wa-M*ma);k[3]=-(H*(ma*Ha-wa*Pa)-W*(O*Ha-M*Pa)+Ea*(O*wa-M*ma));k[4]=-(R*(Pa*p-Ha*Ka)-Da*(ma*p-wa*Ka)+Ma*(ma*Ha-wa*Pa));k[5]=A*(Pa*p-Ha*Ka)-Da*(O*p-M*Ka)+Ma*(O*Ha-M*Pa);k[6]=-(A*(ma*p-wa*Ka)-R*(O*p-M*Ka)+Ma*(O*wa-M*ma));k[7]=A*(ma*Ha-wa*Pa)-R*(O*Ha-M*Pa)+Da*(O*wa-M*ma);k[8]=R*(Ea*p-Ha*Ta)-Da*(W*p-wa*Ta)+Ma*
(W*Ha-wa*Ea);k[9]=-(A*(Ea*p-Ha*Ta)-Da*(H*p-M*Ta)+Ma*(H*Ha-M*Ea));k[10]=A*(W*p-wa*Ta)-R*(H*p-M*Ta)+Ma*(H*wa-M*W);k[11]=-(A*(W*Ha-wa*Ea)-R*(H*Ha-M*Ea)+Da*(H*wa-M*W));k[12]=-(R*(Ea*Ka-Pa*Ta)-Da*(W*Ka-ma*Ta)+Ma*(W*Pa-ma*Ea));k[13]=A*(Ea*Ka-Pa*Ta)-Da*(H*Ka-O*Ta)+Ma*(H*Pa-O*Ea);k[14]=-(A*(W*Ka-ma*Ta)-R*(H*Ka-O*Ta)+Ma*(H*ma-O*W));k[15]=A*(W*Pa-ma*Ea)-R*(H*Pa-O*Ea)+Da*(H*ma-O*W);return k},determinant:function(k){var p=k[0],A=k[1],H=k[2],O=k[3],M=k[4],R=k[5],W=k[6],ma=k[7],wa=k[8],Da=k[9],Ea=k[10],Pa=k[11],
Ha=k[12],Ma=k[13],Ta=k[14];k=k[15];return(p*R-A*M)*(Ea*k-Pa*Ta)-(p*W-H*M)*(Da*k-Pa*Ma)+(p*ma-O*M)*(Da*Ta-Ea*Ma)+(A*W-H*R)*(wa*k-Pa*Ha)-(A*ma-O*R)*(wa*Ta-Ea*Ha)+(H*ma-O*W)*(wa*Ma-Da*Ha)},multiply:r,translate:function(k,p,A){var H=A[0],O=A[1];A=A[2];if(p===k)k[12]=p[0]*H+p[4]*O+p[8]*A+p[12],k[13]=p[1]*H+p[5]*O+p[9]*A+p[13],k[14]=p[2]*H+p[6]*O+p[10]*A+p[14],k[15]=p[3]*H+p[7]*O+p[11]*A+p[15];else{var M=p[0];var R=p[1];var W=p[2];var ma=p[3];var wa=p[4];var Da=p[5];var Ea=p[6];var Pa=p[7];var Ha=p[8];
var Ma=p[9];var Ta=p[10];var Ka=p[11];k[0]=M;k[1]=R;k[2]=W;k[3]=ma;k[4]=wa;k[5]=Da;k[6]=Ea;k[7]=Pa;k[8]=Ha;k[9]=Ma;k[10]=Ta;k[11]=Ka;k[12]=M*H+wa*O+Ha*A+p[12];k[13]=R*H+Da*O+Ma*A+p[13];k[14]=W*H+Ea*O+Ta*A+p[14];k[15]=ma*H+Pa*O+Ka*A+p[15]}return k},scale:function(k,p,A){var H=A[0],O=A[1];A=A[2];k[0]=p[0]*H;k[1]=p[1]*H;k[2]=p[2]*H;k[3]=p[3]*H;k[4]=p[4]*O;k[5]=p[5]*O;k[6]=p[6]*O;k[7]=p[7]*O;k[8]=p[8]*A;k[9]=p[9]*A;k[10]=p[10]*A;k[11]=p[11]*A;k[12]=p[12];k[13]=p[13];k[14]=p[14];k[15]=p[15];return k},
rotate:function(k,p,A,H){var O=H[0],M=H[1];H=H[2];var R=Math.hypot(O,M,H);if(1E-6>R)return null;R=1/R;O*=R;M*=R;H*=R;var W=Math.sin(A);var ma=Math.cos(A);var wa=1-ma;A=p[0];R=p[1];var Da=p[2];var Ea=p[3];var Pa=p[4];var Ha=p[5];var Ma=p[6];var Ta=p[7];var Ka=p[8];var Wa=p[9];var bb=p[10];var hb=p[11];var sb=O*O*wa+ma;var Ab=M*O*wa+H*W;var La=H*O*wa-M*W;var Ra=O*M*wa-H*W;var Za=M*M*wa+ma;var cb=H*M*wa+O*W;var gb=O*H*wa+M*W;O=M*H*wa-O*W;M=H*H*wa+ma;k[0]=A*sb+Pa*Ab+Ka*La;k[1]=R*sb+Ha*Ab+Wa*La;k[2]=Da*
sb+Ma*Ab+bb*La;k[3]=Ea*sb+Ta*Ab+hb*La;k[4]=A*Ra+Pa*Za+Ka*cb;k[5]=R*Ra+Ha*Za+Wa*cb;k[6]=Da*Ra+Ma*Za+bb*cb;k[7]=Ea*Ra+Ta*Za+hb*cb;k[8]=A*gb+Pa*O+Ka*M;k[9]=R*gb+Ha*O+Wa*M;k[10]=Da*gb+Ma*O+bb*M;k[11]=Ea*gb+Ta*O+hb*M;p!==k&&(k[12]=p[12],k[13]=p[13],k[14]=p[14],k[15]=p[15]);return k},rotateX:function(k,p,A){var H=Math.sin(A);A=Math.cos(A);var O=p[4],M=p[5],R=p[6],W=p[7],ma=p[8],wa=p[9],Da=p[10],Ea=p[11];p!==k&&(k[0]=p[0],k[1]=p[1],k[2]=p[2],k[3]=p[3],k[12]=p[12],k[13]=p[13],k[14]=p[14],k[15]=p[15]);k[4]=
O*A+ma*H;k[5]=M*A+wa*H;k[6]=R*A+Da*H;k[7]=W*A+Ea*H;k[8]=ma*A-O*H;k[9]=wa*A-M*H;k[10]=Da*A-R*H;k[11]=Ea*A-W*H;return k},rotateY:function(k,p,A){var H=Math.sin(A);A=Math.cos(A);var O=p[0],M=p[1],R=p[2],W=p[3],ma=p[8],wa=p[9],Da=p[10],Ea=p[11];p!==k&&(k[4]=p[4],k[5]=p[5],k[6]=p[6],k[7]=p[7],k[12]=p[12],k[13]=p[13],k[14]=p[14],k[15]=p[15]);k[0]=O*A-ma*H;k[1]=M*A-wa*H;k[2]=R*A-Da*H;k[3]=W*A-Ea*H;k[8]=O*H+ma*A;k[9]=M*H+wa*A;k[10]=R*H+Da*A;k[11]=W*H+Ea*A;return k},rotateZ:function(k,p,A){var H=Math.sin(A);
A=Math.cos(A);var O=p[0],M=p[1],R=p[2],W=p[3],ma=p[4],wa=p[5],Da=p[6],Ea=p[7];p!==k&&(k[8]=p[8],k[9]=p[9],k[10]=p[10],k[11]=p[11],k[12]=p[12],k[13]=p[13],k[14]=p[14],k[15]=p[15]);k[0]=O*A+ma*H;k[1]=M*A+wa*H;k[2]=R*A+Da*H;k[3]=W*A+Ea*H;k[4]=ma*A-O*H;k[5]=wa*A-M*H;k[6]=Da*A-R*H;k[7]=Ea*A-W*H;return k},fromTranslation:function(k,p){k[0]=1;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=1;k[6]=0;k[7]=0;k[8]=0;k[9]=0;k[10]=1;k[11]=0;k[12]=p[0];k[13]=p[1];k[14]=p[2];k[15]=1;return k},fromScaling:function(k,p){k[0]=p[0];
k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=p[1];k[6]=0;k[7]=0;k[8]=0;k[9]=0;k[10]=p[2];k[11]=0;k[12]=0;k[13]=0;k[14]=0;k[15]=1;return k},fromRotation:function(k,p,A){var H=A[0],O=A[1];A=A[2];var M=Math.hypot(H,O,A);if(1E-6>M)return null;M=1/M;H*=M;O*=M;A*=M;M=Math.sin(p);p=Math.cos(p);var R=1-p;k[0]=H*H*R+p;k[1]=O*H*R+A*M;k[2]=A*H*R-O*M;k[3]=0;k[4]=H*O*R-A*M;k[5]=O*O*R+p;k[6]=A*O*R+H*M;k[7]=0;k[8]=H*A*R+O*M;k[9]=O*A*R-H*M;k[10]=A*A*R+p;k[11]=0;k[12]=0;k[13]=0;k[14]=0;k[15]=1;return k},fromXRotation:function(k,
p){var A=Math.sin(p);p=Math.cos(p);k[0]=1;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=p;k[6]=A;k[7]=0;k[8]=0;k[9]=-A;k[10]=p;k[11]=0;k[12]=0;k[13]=0;k[14]=0;k[15]=1;return k},fromYRotation:function(k,p){var A=Math.sin(p);p=Math.cos(p);k[0]=p;k[1]=0;k[2]=-A;k[3]=0;k[4]=0;k[5]=1;k[6]=0;k[7]=0;k[8]=A;k[9]=0;k[10]=p;k[11]=0;k[12]=0;k[13]=0;k[14]=0;k[15]=1;return k},fromZRotation:function(k,p){var A=Math.sin(p);p=Math.cos(p);k[0]=p;k[1]=A;k[2]=0;k[3]=0;k[4]=-A;k[5]=p;k[6]=0;k[7]=0;k[8]=0;k[9]=0;k[10]=1;k[11]=0;k[12]=
0;k[13]=0;k[14]=0;k[15]=1;return k},fromRotationTranslation:B,fromQuat2:function(k,p){var A=new na(3),H=-p[0],O=-p[1],M=-p[2],R=p[3],W=p[4],ma=p[5],wa=p[6],Da=p[7],Ea=H*H+O*O+M*M+R*R;0<Ea?(A[0]=2*(W*R+Da*H+ma*M-wa*O)/Ea,A[1]=2*(ma*R+Da*O+wa*H-W*M)/Ea,A[2]=2*(wa*R+Da*M+W*O-ma*H)/Ea):(A[0]=2*(W*R+Da*H+ma*M-wa*O),A[1]=2*(ma*R+Da*O+wa*H-W*M),A[2]=2*(wa*R+Da*M+W*O-ma*H));B(k,p,A);return k},getTranslation:D,getScaling:F,getRotation:G,fromRotationTranslationScale:function(k,p,A,H){var O=p[0],M=p[1],R=p[2],
W=p[3],ma=O+O,wa=M+M,Da=R+R;p=O*ma;var Ea=O*wa;O*=Da;var Pa=M*wa;M*=Da;R*=Da;ma*=W;wa*=W;W*=Da;Da=H[0];var Ha=H[1];H=H[2];k[0]=(1-(Pa+R))*Da;k[1]=(Ea+W)*Da;k[2]=(O-wa)*Da;k[3]=0;k[4]=(Ea-W)*Ha;k[5]=(1-(p+R))*Ha;k[6]=(M+ma)*Ha;k[7]=0;k[8]=(O+wa)*H;k[9]=(M-ma)*H;k[10]=(1-(p+Pa))*H;k[11]=0;k[12]=A[0];k[13]=A[1];k[14]=A[2];k[15]=1;return k},fromRotationTranslationScaleOrigin:function(k,p,A,H,O){var M=p[0],R=p[1],W=p[2],ma=p[3],wa=M+M,Da=R+R,Ea=W+W;p=M*wa;var Pa=M*Da,Ha=M*Ea;M=R*Da;R*=Ea;var Ma=W*Ea;W=
ma*wa;Da*=ma;var Ta=ma*Ea,Ka=H[0],Wa=H[1];Ea=H[2];H=O[0];ma=O[1];O=O[2];wa=(1-(M+Ma))*Ka;var bb=(Pa+Ta)*Ka;Ka*=Ha-Da;Pa=(Pa-Ta)*Wa;Ma=(1-(p+Ma))*Wa;Wa*=R+W;Ha=(Ha+Da)*Ea;R=(R-W)*Ea;p=(1-(p+M))*Ea;k[0]=wa;k[1]=bb;k[2]=Ka;k[3]=0;k[4]=Pa;k[5]=Ma;k[6]=Wa;k[7]=0;k[8]=Ha;k[9]=R;k[10]=p;k[11]=0;k[12]=A[0]+H-(wa*H+Pa*ma+Ha*O);k[13]=A[1]+ma-(bb*H+Ma*ma+R*O);k[14]=A[2]+O-(Ka*H+Wa*ma+p*O);k[15]=1;return k},fromQuat:function(k,p){var A=p[0],H=p[1],O=p[2];p=p[3];var M=A+A,R=H+H,W=O+O;A*=M;var ma=H*M;H*=R;var wa=
O*M,Da=O*R;O*=W;M*=p;R*=p;p*=W;k[0]=1-H-O;k[1]=ma+p;k[2]=wa-R;k[3]=0;k[4]=ma-p;k[5]=1-A-O;k[6]=Da+M;k[7]=0;k[8]=wa+R;k[9]=Da-M;k[10]=1-A-H;k[11]=0;k[12]=0;k[13]=0;k[14]=0;k[15]=1;return k},frustum:function(k,p,A,H,O,M,R){var W=1/(A-p),ma=1/(O-H),wa=1/(M-R);k[0]=2*M*W;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=2*M*ma;k[6]=0;k[7]=0;k[8]=(A+p)*W;k[9]=(O+H)*ma;k[10]=(R+M)*wa;k[11]=-1;k[12]=0;k[13]=0;k[14]=R*M*2*wa;k[15]=0;return k},perspective:function(k,p,A,H,O){p=1/Math.tan(p/2);k[0]=p/A;k[1]=0;k[2]=0;k[3]=0;
k[4]=0;k[5]=p;k[6]=0;k[7]=0;k[8]=0;k[9]=0;k[11]=-1;k[12]=0;k[13]=0;k[15]=0;null!=O&&Infinity!==O?(A=1/(H-O),k[10]=(O+H)*A,k[14]=2*O*H*A):(k[10]=-1,k[14]=-2*H);return k},perspectiveFromFieldOfView:function(k,p,A,H){var O=Math.tan(p.upDegrees*Math.PI/180),M=Math.tan(p.downDegrees*Math.PI/180),R=Math.tan(p.leftDegrees*Math.PI/180);p=Math.tan(p.rightDegrees*Math.PI/180);var W=2/(R+p),ma=2/(O+M);k[0]=W;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=ma;k[6]=0;k[7]=0;k[8]=-((R-p)*W*.5);k[9]=(O-M)*ma*.5;k[10]=H/(A-H);
k[11]=-1;k[12]=0;k[13]=0;k[14]=H*A/(A-H);k[15]=0;return k},ortho:function(k,p,A,H,O,M,R){var W=1/(p-A),ma=1/(H-O),wa=1/(M-R);k[0]=-2*W;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=-2*ma;k[6]=0;k[7]=0;k[8]=0;k[9]=0;k[10]=2*wa;k[11]=0;k[12]=(p+A)*W;k[13]=(O+H)*ma;k[14]=(R+M)*wa;k[15]=1;return k},lookAt:function(k,p,A,H){var O=p[0],M=p[1];p=p[2];var R=H[0];var W=H[1];var ma=H[2];var wa=A[0];H=A[1];var Da=A[2];if(1E-6>Math.abs(O-wa)&&1E-6>Math.abs(M-H)&&1E-6>Math.abs(p-Da))return q(k);A=O-wa;H=M-H;wa=p-Da;var Ea=
1/Math.hypot(A,H,wa);A*=Ea;H*=Ea;wa*=Ea;Da=W*wa-ma*H;ma=ma*A-R*wa;R=R*H-W*A;(Ea=Math.hypot(Da,ma,R))?(Ea=1/Ea,Da*=Ea,ma*=Ea,R*=Ea):R=ma=Da=0;W=H*R-wa*ma;var Pa=wa*Da-A*R;var Ha=A*ma-H*Da;(Ea=Math.hypot(W,Pa,Ha))?(Ea=1/Ea,W*=Ea,Pa*=Ea,Ha*=Ea):Ha=Pa=W=0;k[0]=Da;k[1]=W;k[2]=A;k[3]=0;k[4]=ma;k[5]=Pa;k[6]=H;k[7]=0;k[8]=R;k[9]=Ha;k[10]=wa;k[11]=0;k[12]=-(Da*O+ma*M+R*p);k[13]=-(W*O+Pa*M+Ha*p);k[14]=-(A*O+H*M+wa*p);k[15]=1;return k},targetTo:function(k,p,A,H){var O=p[0],M=p[1];p=p[2];var R=H[0],W=H[1],ma=
H[2];H=O-A[0];var wa=M-A[1];A=p-A[2];var Da=H*H+wa*wa+A*A;0<Da&&(Da=1/Math.sqrt(Da),H*=Da,wa*=Da,A*=Da);var Ea=W*A-ma*wa;ma=ma*H-R*A;R=R*wa-W*H;Da=Ea*Ea+ma*ma+R*R;0<Da&&(Da=1/Math.sqrt(Da),Ea*=Da,ma*=Da,R*=Da);k[0]=Ea;k[1]=ma;k[2]=R;k[3]=0;k[4]=wa*R-A*ma;k[5]=A*Ea-H*R;k[6]=H*ma-wa*Ea;k[7]=0;k[8]=H;k[9]=wa;k[10]=A;k[11]=0;k[12]=O;k[13]=M;k[14]=p;k[15]=1;return k},str:function(k){return"mat4("+k[0]+", "+k[1]+", "+k[2]+", "+k[3]+", "+k[4]+", "+k[5]+", "+k[6]+", "+k[7]+", "+k[8]+", "+k[9]+", "+k[10]+
", "+k[11]+", "+k[12]+", "+k[13]+", "+k[14]+", "+k[15]+")"},frob:function(k){return Math.hypot(k[0],k[1],k[3],k[4],k[5],k[6],k[7],k[8],k[9],k[10],k[11],k[12],k[13],k[14],k[15])},add:function(k,p,A){k[0]=p[0]+A[0];k[1]=p[1]+A[1];k[2]=p[2]+A[2];k[3]=p[3]+A[3];k[4]=p[4]+A[4];k[5]=p[5]+A[5];k[6]=p[6]+A[6];k[7]=p[7]+A[7];k[8]=p[8]+A[8];k[9]=p[9]+A[9];k[10]=p[10]+A[10];k[11]=p[11]+A[11];k[12]=p[12]+A[12];k[13]=p[13]+A[13];k[14]=p[14]+A[14];k[15]=p[15]+A[15];return k},subtract:N,multiplyScalar:function(k,
p,A){k[0]=p[0]*A;k[1]=p[1]*A;k[2]=p[2]*A;k[3]=p[3]*A;k[4]=p[4]*A;k[5]=p[5]*A;k[6]=p[6]*A;k[7]=p[7]*A;k[8]=p[8]*A;k[9]=p[9]*A;k[10]=p[10]*A;k[11]=p[11]*A;k[12]=p[12]*A;k[13]=p[13]*A;k[14]=p[14]*A;k[15]=p[15]*A;return k},multiplyScalarAndAdd:function(k,p,A,H){k[0]=p[0]+A[0]*H;k[1]=p[1]+A[1]*H;k[2]=p[2]+A[2]*H;k[3]=p[3]+A[3]*H;k[4]=p[4]+A[4]*H;k[5]=p[5]+A[5]*H;k[6]=p[6]+A[6]*H;k[7]=p[7]+A[7]*H;k[8]=p[8]+A[8]*H;k[9]=p[9]+A[9]*H;k[10]=p[10]+A[10]*H;k[11]=p[11]+A[11]*H;k[12]=p[12]+A[12]*H;k[13]=p[13]+A[13]*
H;k[14]=p[14]+A[14]*H;k[15]=p[15]+A[15]*H;return k},exactEquals:function(k,p){return k[0]===p[0]&&k[1]===p[1]&&k[2]===p[2]&&k[3]===p[3]&&k[4]===p[4]&&k[5]===p[5]&&k[6]===p[6]&&k[7]===p[7]&&k[8]===p[8]&&k[9]===p[9]&&k[10]===p[10]&&k[11]===p[11]&&k[12]===p[12]&&k[13]===p[13]&&k[14]===p[14]&&k[15]===p[15]},equals:function(k,p){var A=k[0],H=k[1],O=k[2],M=k[3],R=k[4],W=k[5],ma=k[6],wa=k[7],Da=k[8],Ea=k[9],Pa=k[10],Ha=k[11],Ma=k[12],Ta=k[13],Ka=k[14];k=k[15];var Wa=p[0],bb=p[1],hb=p[2],sb=p[3],Ab=p[4],
La=p[5],Ra=p[6],Za=p[7],cb=p[8],gb=p[9],kb=p[10],jb=p[11],Db=p[12],Ob=p[13],Mb=p[14];p=p[15];return Math.abs(A-Wa)<=1E-6*Math.max(1,Math.abs(A),Math.abs(Wa))&&Math.abs(H-bb)<=1E-6*Math.max(1,Math.abs(H),Math.abs(bb))&&Math.abs(O-hb)<=1E-6*Math.max(1,Math.abs(O),Math.abs(hb))&&Math.abs(M-sb)<=1E-6*Math.max(1,Math.abs(M),Math.abs(sb))&&Math.abs(R-Ab)<=1E-6*Math.max(1,Math.abs(R),Math.abs(Ab))&&Math.abs(W-La)<=1E-6*Math.max(1,Math.abs(W),Math.abs(La))&&Math.abs(ma-Ra)<=1E-6*Math.max(1,Math.abs(ma),Math.abs(Ra))&&
Math.abs(wa-Za)<=1E-6*Math.max(1,Math.abs(wa),Math.abs(Za))&&Math.abs(Da-cb)<=1E-6*Math.max(1,Math.abs(Da),Math.abs(cb))&&Math.abs(Ea-gb)<=1E-6*Math.max(1,Math.abs(Ea),Math.abs(gb))&&Math.abs(Pa-kb)<=1E-6*Math.max(1,Math.abs(Pa),Math.abs(kb))&&Math.abs(Ha-jb)<=1E-6*Math.max(1,Math.abs(Ha),Math.abs(jb))&&Math.abs(Ma-Db)<=1E-6*Math.max(1,Math.abs(Ma),Math.abs(Db))&&Math.abs(Ta-Ob)<=1E-6*Math.max(1,Math.abs(Ta),Math.abs(Ob))&&Math.abs(Ka-Mb)<=1E-6*Math.max(1,Math.abs(Ka),Math.abs(Mb))&&Math.abs(k-p)<=
1E-6*Math.max(1,Math.abs(k),Math.abs(p))},mul:r,sub:N}),la=function(){var k=T();return function(p,A,H,O,M,R){A||=3;H||=0;for(O=O?Math.min(O*A+H,p.length):p.length;H<O;H+=A)k[0]=p[H],k[1]=p[H+1],k[2]=p[H+2],M(k,k,R),p[H]=k[0],p[H+1]=k[1],p[H+2]=k[2];return p}}();la=Object.freeze({create:T,clone:function(k){var p=new na(3);p[0]=k[0];p[1]=k[1];p[2]=k[2];return p},length:V,fromValues:E,copy:function(k,p){k[0]=p[0];k[1]=p[1];k[2]=p[2];return k},set:function(k,p,A,H){k[0]=p;k[1]=A;k[2]=H;return k},add:function(k,
p,A){k[0]=p[0]+A[0];k[1]=p[1]+A[1];k[2]=p[2]+A[2];return k},subtract:Q,multiply:aa,divide:qa,ceil:function(k,p){k[0]=Math.ceil(p[0]);k[1]=Math.ceil(p[1]);k[2]=Math.ceil(p[2]);return k},floor:function(k,p){k[0]=Math.floor(p[0]);k[1]=Math.floor(p[1]);k[2]=Math.floor(p[2]);return k},min:function(k,p,A){k[0]=Math.min(p[0],A[0]);k[1]=Math.min(p[1],A[1]);k[2]=Math.min(p[2],A[2]);return k},max:function(k,p,A){k[0]=Math.max(p[0],A[0]);k[1]=Math.max(p[1],A[1]);k[2]=Math.max(p[2],A[2]);return k},round:function(k,
p){k[0]=Math.round(p[0]);k[1]=Math.round(p[1]);k[2]=Math.round(p[2]);return k},scale:function(k,p,A){k[0]=p[0]*A;k[1]=p[1]*A;k[2]=p[2]*A;return k},scaleAndAdd:function(k,p,A,H){k[0]=p[0]+A[0]*H;k[1]=p[1]+A[1]*H;k[2]=p[2]+A[2]*H;return k},distance:P,squaredDistance:ea,squaredLength:ua,negate:function(k,p){k[0]=-p[0];k[1]=-p[1];k[2]=-p[2];return k},inverse:function(k,p){k[0]=1/p[0];k[1]=1/p[1];k[2]=1/p[2];return k},normalize:Fa,dot:pa,cross:ra,lerp:function(k,p,A,H){var O=p[0],M=p[1];p=p[2];k[0]=O+
H*(A[0]-O);k[1]=M+H*(A[1]-M);k[2]=p+H*(A[2]-p);return k},hermite:function(k,p,A,H,O,M){var R=M*M,W=R*(2*M-3)+1,ma=R*(M-2)+M,wa=R*(M-1);M=R*(3-2*M);k[0]=p[0]*W+A[0]*ma+H[0]*wa+O[0]*M;k[1]=p[1]*W+A[1]*ma+H[1]*wa+O[1]*M;k[2]=p[2]*W+A[2]*ma+H[2]*wa+O[2]*M;return k},bezier:function(k,p,A,H,O,M){var R=1-M,W=R*R,ma=M*M,wa=W*R;W*=3*M;R*=3*ma;M*=ma;k[0]=p[0]*wa+A[0]*W+H[0]*R+O[0]*M;k[1]=p[1]*wa+A[1]*W+H[1]*R+O[1]*M;k[2]=p[2]*wa+A[2]*W+H[2]*R+O[2]*M;return k},random:function(k,p){p=p||1;var A=2*ja()*Math.PI,
H=2*ja()-1,O=Math.sqrt(1-H*H)*p;k[0]=Math.cos(A)*O;k[1]=Math.sin(A)*O;k[2]=H*p;return k},transformMat4:function(k,p,A){var H=p[0],O=p[1];p=p[2];var M=A[3]*H+A[7]*O+A[11]*p+A[15];M=M||1;k[0]=(A[0]*H+A[4]*O+A[8]*p+A[12])/M;k[1]=(A[1]*H+A[5]*O+A[9]*p+A[13])/M;k[2]=(A[2]*H+A[6]*O+A[10]*p+A[14])/M;return k},transformMat3:function(k,p,A){var H=p[0],O=p[1];p=p[2];k[0]=H*A[0]+O*A[3]+p*A[6];k[1]=H*A[1]+O*A[4]+p*A[7];k[2]=H*A[2]+O*A[5]+p*A[8];return k},transformQuat:function(k,p,A){var H=A[0],O=A[1],M=A[2],
R=p[0],W=p[1];p=p[2];var ma=O*p-M*W,wa=M*R-H*p,Da=H*W-O*R;A=2*A[3];k[0]=R+ma*A+2*(O*Da-M*wa);k[1]=W+wa*A+2*(M*ma-H*Da);k[2]=p+Da*A+2*(H*wa-O*ma);return k},rotateX:function(k,p,A,H){var O=[],M=[];O[0]=p[0]-A[0];O[1]=p[1]-A[1];O[2]=p[2]-A[2];M[0]=O[0];M[1]=O[1]*Math.cos(H)-O[2]*Math.sin(H);M[2]=O[1]*Math.sin(H)+O[2]*Math.cos(H);k[0]=M[0]+A[0];k[1]=M[1]+A[1];k[2]=M[2]+A[2];return k},rotateY:function(k,p,A,H){var O=[],M=[];O[0]=p[0]-A[0];O[1]=p[1]-A[1];O[2]=p[2]-A[2];M[0]=O[2]*Math.sin(H)+O[0]*Math.cos(H);
M[1]=O[1];M[2]=O[2]*Math.cos(H)-O[0]*Math.sin(H);k[0]=M[0]+A[0];k[1]=M[1]+A[1];k[2]=M[2]+A[2];return k},rotateZ:function(k,p,A,H){var O=[],M=[];O[0]=p[0]-A[0];O[1]=p[1]-A[1];O[2]=p[2]-A[2];M[0]=O[0]*Math.cos(H)-O[1]*Math.sin(H);M[1]=O[0]*Math.sin(H)+O[1]*Math.cos(H);M[2]=O[2];k[0]=M[0]+A[0];k[1]=M[1]+A[1];k[2]=M[2]+A[2];return k},angle:function(k,p){k=E(k[0],k[1],k[2]);p=E(p[0],p[1],p[2]);Fa(k,k);Fa(p,p);p=pa(k,p);return 1<p?0:-1>p?Math.PI:Math.acos(p)},zero:function(k){k[0]=0;k[1]=0;k[2]=0;return k},
str:function(k){return"vec3("+k[0]+", "+k[1]+", "+k[2]+")"},exactEquals:function(k,p){return k[0]===p[0]&&k[1]===p[1]&&k[2]===p[2]},equals:function(k,p){var A=k[0],H=k[1];k=k[2];var O=p[0],M=p[1];p=p[2];return Math.abs(A-O)<=1E-6*Math.max(1,Math.abs(A),Math.abs(O))&&Math.abs(H-M)<=1E-6*Math.max(1,Math.abs(H),Math.abs(M))&&Math.abs(k-p)<=1E-6*Math.max(1,Math.abs(k),Math.abs(p))},sub:Q,mul:aa,div:qa,dist:P,sqrDist:ea,len:V,sqrLen:ua,forEach:la});var sa=function(){var k=Ca();return function(p,A,H,O,
M,R){A||=4;H||=0;for(O=O?Math.min(O*A+H,p.length):p.length;H<O;H+=A)k[0]=p[H],k[1]=p[H+1],k[2]=p[H+2],k[3]=p[H+3],M(k,k,R),p[H]=k[0],p[H+1]=k[1],p[H+2]=k[2],p[H+3]=k[3];return p}}();sa=Object.freeze({create:Ca,clone:Ga,fromValues:Aa,copy:xa,set:za,add:Na,subtract:ya,multiply:Ia,divide:$a,ceil:function(k,p){k[0]=Math.ceil(p[0]);k[1]=Math.ceil(p[1]);k[2]=Math.ceil(p[2]);k[3]=Math.ceil(p[3]);return k},floor:function(k,p){k[0]=Math.floor(p[0]);k[1]=Math.floor(p[1]);k[2]=Math.floor(p[2]);k[3]=Math.floor(p[3]);
return k},min:function(k,p,A){k[0]=Math.min(p[0],A[0]);k[1]=Math.min(p[1],A[1]);k[2]=Math.min(p[2],A[2]);k[3]=Math.min(p[3],A[3]);return k},max:function(k,p,A){k[0]=Math.max(p[0],A[0]);k[1]=Math.max(p[1],A[1]);k[2]=Math.max(p[2],A[2]);k[3]=Math.max(p[3],A[3]);return k},round:function(k,p){k[0]=Math.round(p[0]);k[1]=Math.round(p[1]);k[2]=Math.round(p[2]);k[3]=Math.round(p[3]);return k},scale:lb,scaleAndAdd:function(k,p,A,H){k[0]=p[0]+A[0]*H;k[1]=p[1]+A[1]*H;k[2]=p[2]+A[2]*H;k[3]=p[3]+A[3]*H;return k},
distance:xb,squaredDistance:Cb,length:ca,squaredLength:Sa,negate:function(k,p){k[0]=-p[0];k[1]=-p[1];k[2]=-p[2];k[3]=-p[3];return k},inverse:function(k,p){k[0]=1/p[0];k[1]=1/p[1];k[2]=1/p[2];k[3]=1/p[3];return k},normalize:Va,dot:fb,cross:function(k,p,A,H){var O=A[0]*H[1]-A[1]*H[0],M=A[0]*H[2]-A[2]*H[0],R=A[0]*H[3]-A[3]*H[0],W=A[1]*H[2]-A[2]*H[1],ma=A[1]*H[3]-A[3]*H[1];A=A[2]*H[3]-A[3]*H[2];H=p[0];var wa=p[1],Da=p[2];p=p[3];k[0]=wa*A-Da*ma+p*W;k[1]=-(H*A)+Da*R-p*M;k[2]=H*ma-wa*R+p*O;k[3]=-(H*W)+wa*
M-Da*O;return k},lerp:Qa,random:function(k,p){p=p||1;do{var A=2*ja()-1;var H=2*ja()-1;var O=A*A+H*H}while(1<=O);do{var M=2*ja()-1;var R=2*ja()-1;var W=M*M+R*R}while(1<=W);O=Math.sqrt((1-O)/W);k[0]=p*A;k[1]=p*H;k[2]=p*M*O;k[3]=p*R*O;return k},transformMat4:function(k,p,A){var H=p[0],O=p[1],M=p[2];p=p[3];k[0]=A[0]*H+A[4]*O+A[8]*M+A[12]*p;k[1]=A[1]*H+A[5]*O+A[9]*M+A[13]*p;k[2]=A[2]*H+A[6]*O+A[10]*M+A[14]*p;k[3]=A[3]*H+A[7]*O+A[11]*M+A[15]*p;return k},transformQuat:function(k,p,A){var H=p[0],O=p[1],M=
p[2],R=A[0],W=A[1],ma=A[2];A=A[3];var wa=A*H+W*M-ma*O,Da=A*O+ma*H-R*M,Ea=A*M+R*O-W*H;H=-R*H-W*O-ma*M;k[0]=wa*A+H*-R+Da*-ma-Ea*-W;k[1]=Da*A+H*-W+Ea*-R-wa*-ma;k[2]=Ea*A+H*-ma+wa*-W-Da*-R;k[3]=p[3];return k},zero:function(k){k[0]=0;k[1]=0;k[2]=0;k[3]=0;return k},str:function(k){return"vec4("+k[0]+", "+k[1]+", "+k[2]+", "+k[3]+")"},exactEquals:eb,equals:mb,sub:ya,mul:Ia,div:$a,dist:xb,sqrDist:Cb,len:ca,sqrLen:Sa,forEach:sa});var va=function(){var k=T(),p=E(1,0,0),A=E(0,1,0);return function(H,O,M){var R=
pa(O,M);if(-.999999>R)return ra(k,p,O),1E-6>V(k)&&ra(k,A,O),Fa(k,k),Bb(H,k,Math.PI),H;if(.999999<R)return H[0]=0,H[1]=0,H[2]=0,H[3]=1,H;ra(k,O,M);H[0]=k[0];H[1]=k[1];H[2]=k[2];H[3]=1+R;return Va(H,H)}}(),ba=function(){var k=ub(),p=ub();return function(A,H,O,M,R,W){Xb(k,H,R,W);Xb(p,O,M,W);Xb(A,k,p,2*W*(1-W));return A}}(),ha=function(){var k=h();return function(p,A,H,O){k[0]=H[0];k[3]=H[1];k[6]=H[2];k[1]=O[0];k[4]=O[1];k[7]=O[2];k[2]=-A[0];k[5]=-A[1];k[8]=-A[2];return Va(p,Nb(p,k))}}();va=Object.freeze({create:ub,
identity:function(k){k[0]=0;k[1]=0;k[2]=0;k[3]=1;return k},setAxisAngle:Bb,getAxisAngle:function(k,p){var A=2*Math.acos(p[3]),H=Math.sin(A/2);1E-6<H?(k[0]=p[0]/H,k[1]=p[1]/H,k[2]=p[2]/H):(k[0]=1,k[1]=0,k[2]=0);return A},getAngle:function(k,p){k=fb(k,p);return Math.acos(2*k*k-1)},multiply:qb,rotateX:yb,rotateY:Ib,rotateZ:Pb,calculateW:function(k,p){var A=p[0],H=p[1];p=p[2];k[0]=A;k[1]=H;k[2]=p;k[3]=Math.sqrt(Math.abs(1-A*A-H*H-p*p));return k},exp:Eb,ln:z,pow:function(k,p,A){z(k,p);lb(k,k,A);Eb(k,k);
return k},slerp:Xb,random:function(k){var p=ja(),A=ja(),H=ja(),O=Math.sqrt(1-p);p=Math.sqrt(p);k[0]=O*Math.sin(2*Math.PI*A);k[1]=O*Math.cos(2*Math.PI*A);k[2]=p*Math.sin(2*Math.PI*H);k[3]=p*Math.cos(2*Math.PI*H);return k},invert:function(k,p){var A=p[0],H=p[1],O=p[2];p=p[3];var M=A*A+H*H+O*O+p*p;M=M?1/M:0;k[0]=-A*M;k[1]=-H*M;k[2]=-O*M;k[3]=p*M;return k},conjugate:function(k,p){k[0]=-p[0];k[1]=-p[1];k[2]=-p[2];k[3]=p[3];return k},fromMat3:Nb,fromEuler:function(k,p,A,H){var O=.5*Math.PI/180;p*=O;A*=
O;H*=O;O=Math.sin(p);p=Math.cos(p);var M=Math.sin(A);A=Math.cos(A);var R=Math.sin(H);H=Math.cos(H);k[0]=O*A*H-p*M*R;k[1]=p*M*H+O*A*R;k[2]=p*A*R-O*M*H;k[3]=p*A*H+O*M*R;return k},str:function(k){return"quat("+k[0]+", "+k[1]+", "+k[2]+", "+k[3]+")"},clone:Ga,fromValues:Aa,copy:xa,set:za,add:Na,mul:qb,scale:lb,dot:fb,lerp:Qa,length:ca,len:ca,squaredLength:Sa,sqrLen:Sa,normalize:Va,exactEquals:eb,equals:mb,rotationTo:va,sqlerp:ba,setAxes:ha});ba=Object.freeze({create:function(){var k=new na(8);na!=Float32Array&&
(k[0]=0,k[1]=0,k[2]=0,k[4]=0,k[5]=0,k[6]=0,k[7]=0);k[3]=1;return k},clone:function(k){var p=new na(8);p[0]=k[0];p[1]=k[1];p[2]=k[2];p[3]=k[3];p[4]=k[4];p[5]=k[5];p[6]=k[6];p[7]=k[7];return p},fromValues:function(k,p,A,H,O,M,R,W){var ma=new na(8);ma[0]=k;ma[1]=p;ma[2]=A;ma[3]=H;ma[4]=O;ma[5]=M;ma[6]=R;ma[7]=W;return ma},fromRotationTranslationValues:function(k,p,A,H,O,M,R){var W=new na(8);W[0]=k;W[1]=p;W[2]=A;W[3]=H;O*=.5;M*=.5;R*=.5;W[4]=O*H+M*A-R*p;W[5]=M*H+R*k-O*A;W[6]=R*H+O*p-M*k;W[7]=-O*k-M*p-
R*A;return W},fromRotationTranslation:Rb,fromTranslation:function(k,p){k[0]=0;k[1]=0;k[2]=0;k[3]=1;k[4]=.5*p[0];k[5]=.5*p[1];k[6]=.5*p[2];k[7]=0;return k},fromRotation:function(k,p){k[0]=p[0];k[1]=p[1];k[2]=p[2];k[3]=p[3];k[4]=0;k[5]=0;k[6]=0;k[7]=0;return k},fromMat4:function(k,p){var A=ub();G(A,p);var H=new na(3);D(H,p);Rb(k,A,H);return k},copy:Fb,identity:function(k){k[0]=0;k[1]=0;k[2]=0;k[3]=1;k[4]=0;k[5]=0;k[6]=0;k[7]=0;return k},set:function(k,p,A,H,O,M,R,W,ma){k[0]=p;k[1]=A;k[2]=H;k[3]=O;k[4]=
M;k[5]=R;k[6]=W;k[7]=ma;return k},getReal:xa,getDual:function(k,p){k[0]=p[4];k[1]=p[5];k[2]=p[6];k[3]=p[7];return k},setReal:xa,setDual:function(k,p){k[4]=p[0];k[5]=p[1];k[6]=p[2];k[7]=p[3];return k},getTranslation:function(k,p){var A=p[4],H=p[5],O=p[6],M=p[7],R=-p[0],W=-p[1],ma=-p[2];p=p[3];k[0]=2*(A*p+M*R+H*ma-O*W);k[1]=2*(H*p+M*W+O*R-A*ma);k[2]=2*(O*p+M*ma+A*W-H*R);return k},translate:function(k,p,A){var H=p[0],O=p[1],M=p[2],R=p[3],W=.5*A[0],ma=.5*A[1];A=.5*A[2];var wa=p[4],Da=p[5],Ea=p[6];p=p[7];
k[0]=H;k[1]=O;k[2]=M;k[3]=R;k[4]=R*W+O*A-M*ma+wa;k[5]=R*ma+M*W-H*A+Da;k[6]=R*A+H*ma-O*W+Ea;k[7]=-H*W-O*ma-M*A+p;return k},rotateX:function(k,p,A){var H=-p[0],O=-p[1],M=-p[2],R=p[3],W=p[4],ma=p[5],wa=p[6],Da=p[7],Ea=W*R+Da*H+ma*M-wa*O,Pa=ma*R+Da*O+wa*H-W*M,Ha=wa*R+Da*M+W*O-ma*H;W=Da*R-W*H-ma*O-wa*M;yb(k,p,A);H=k[0];O=k[1];M=k[2];R=k[3];k[4]=Ea*R+W*H+Pa*M-Ha*O;k[5]=Pa*R+W*O+Ha*H-Ea*M;k[6]=Ha*R+W*M+Ea*O-Pa*H;k[7]=W*R-Ea*H-Pa*O-Ha*M;return k},rotateY:function(k,p,A){var H=-p[0],O=-p[1],M=-p[2],R=p[3],
W=p[4],ma=p[5],wa=p[6],Da=p[7],Ea=W*R+Da*H+ma*M-wa*O,Pa=ma*R+Da*O+wa*H-W*M,Ha=wa*R+Da*M+W*O-ma*H;W=Da*R-W*H-ma*O-wa*M;Ib(k,p,A);H=k[0];O=k[1];M=k[2];R=k[3];k[4]=Ea*R+W*H+Pa*M-Ha*O;k[5]=Pa*R+W*O+Ha*H-Ea*M;k[6]=Ha*R+W*M+Ea*O-Pa*H;k[7]=W*R-Ea*H-Pa*O-Ha*M;return k},rotateZ:function(k,p,A){var H=-p[0],O=-p[1],M=-p[2],R=p[3],W=p[4],ma=p[5],wa=p[6],Da=p[7],Ea=W*R+Da*H+ma*M-wa*O,Pa=ma*R+Da*O+wa*H-W*M,Ha=wa*R+Da*M+W*O-ma*H;W=Da*R-W*H-ma*O-wa*M;Pb(k,p,A);H=k[0];O=k[1];M=k[2];R=k[3];k[4]=Ea*R+W*H+Pa*M-Ha*O;
k[5]=Pa*R+W*O+Ha*H-Ea*M;k[6]=Ha*R+W*M+Ea*O-Pa*H;k[7]=W*R-Ea*H-Pa*O-Ha*M;return k},rotateByQuatAppend:function(k,p,A){var H=A[0],O=A[1],M=A[2];A=A[3];var R=p[0],W=p[1],ma=p[2],wa=p[3];k[0]=R*A+wa*H+W*M-ma*O;k[1]=W*A+wa*O+ma*H-R*M;k[2]=ma*A+wa*M+R*O-W*H;k[3]=wa*A-R*H-W*O-ma*M;R=p[4];W=p[5];ma=p[6];wa=p[7];k[4]=R*A+wa*H+W*M-ma*O;k[5]=W*A+wa*O+ma*H-R*M;k[6]=ma*A+wa*M+R*O-W*H;k[7]=wa*A-R*H-W*O-ma*M;return k},rotateByQuatPrepend:function(k,p,A){var H=p[0],O=p[1],M=p[2];p=p[3];var R=A[0],W=A[1],ma=A[2],
wa=A[3];k[0]=H*wa+p*R+O*ma-M*W;k[1]=O*wa+p*W+M*R-H*ma;k[2]=M*wa+p*ma+H*W-O*R;k[3]=p*wa-H*R-O*W-M*ma;R=A[4];W=A[5];ma=A[6];wa=A[7];k[4]=H*wa+p*R+O*ma-M*W;k[5]=O*wa+p*W+M*R-H*ma;k[6]=M*wa+p*ma+H*W-O*R;k[7]=p*wa-H*R-O*W-M*ma;return k},rotateAroundAxis:function(k,p,A,H){if(1E-6>Math.abs(H))return Fb(k,p);var O=Math.hypot(A[0],A[1],A[2]);H*=.5;var M=Math.sin(H),R=M*A[0]/O,W=M*A[1]/O;A=M*A[2]/O;H=Math.cos(H);O=p[0];M=p[1];var ma=p[2],wa=p[3];k[0]=O*H+wa*R+M*A-ma*W;k[1]=M*H+wa*W+ma*R-O*A;k[2]=ma*H+wa*A+
O*W-M*R;k[3]=wa*H-O*R-M*W-ma*A;O=p[4];M=p[5];ma=p[6];p=p[7];k[4]=O*H+p*R+M*A-ma*W;k[5]=M*H+p*W+ma*R-O*A;k[6]=ma*H+p*A+O*W-M*R;k[7]=p*H-O*R-M*W-ma*A;return k},add:function(k,p,A){k[0]=p[0]+A[0];k[1]=p[1]+A[1];k[2]=p[2]+A[2];k[3]=p[3]+A[3];k[4]=p[4]+A[4];k[5]=p[5]+A[5];k[6]=p[6]+A[6];k[7]=p[7]+A[7];return k},multiply:Wb,mul:Wb,scale:function(k,p,A){k[0]=p[0]*A;k[1]=p[1]*A;k[2]=p[2]*A;k[3]=p[3]*A;k[4]=p[4]*A;k[5]=p[5]*A;k[6]=p[6]*A;k[7]=p[7]*A;return k},dot:fb,lerp:function(k,p,A,H){var O=1-H;0>fb(p,
A)&&(H=-H);k[0]=p[0]*O+A[0]*H;k[1]=p[1]*O+A[1]*H;k[2]=p[2]*O+A[2]*H;k[3]=p[3]*O+A[3]*H;k[4]=p[4]*O+A[4]*H;k[5]=p[5]*O+A[5]*H;k[6]=p[6]*O+A[6]*H;k[7]=p[7]*O+A[7]*H;return k},invert:function(k,p){var A=Sa(p);k[0]=-p[0]/A;k[1]=-p[1]/A;k[2]=-p[2]/A;k[3]=p[3]/A;k[4]=-p[4]/A;k[5]=-p[5]/A;k[6]=-p[6]/A;k[7]=p[7]/A;return k},conjugate:function(k,p){k[0]=-p[0];k[1]=-p[1];k[2]=-p[2];k[3]=p[3];k[4]=-p[4];k[5]=-p[5];k[6]=-p[6];k[7]=p[7];return k},length:ca,len:ca,squaredLength:Sa,sqrLen:Sa,normalize:function(k,
p){var A=Sa(p);if(0<A){A=Math.sqrt(A);var H=p[0]/A,O=p[1]/A,M=p[2]/A,R=p[3]/A,W=p[4],ma=p[5],wa=p[6];p=p[7];var Da=H*W+O*ma+M*wa+R*p;k[0]=H;k[1]=O;k[2]=M;k[3]=R;k[4]=(W-H*Da)/A;k[5]=(ma-O*Da)/A;k[6]=(wa-M*Da)/A;k[7]=(p-R*Da)/A}return k},str:function(k){return"quat2("+k[0]+", "+k[1]+", "+k[2]+", "+k[3]+", "+k[4]+", "+k[5]+", "+k[6]+", "+k[7]+")"},exactEquals:function(k,p){return k[0]===p[0]&&k[1]===p[1]&&k[2]===p[2]&&k[3]===p[3]&&k[4]===p[4]&&k[5]===p[5]&&k[6]===p[6]&&k[7]===p[7]},equals:function(k,
p){var A=k[0],H=k[1],O=k[2],M=k[3],R=k[4],W=k[5],ma=k[6];k=k[7];var wa=p[0],Da=p[1],Ea=p[2],Pa=p[3],Ha=p[4],Ma=p[5],Ta=p[6];p=p[7];return Math.abs(A-wa)<=1E-6*Math.max(1,Math.abs(A),Math.abs(wa))&&Math.abs(H-Da)<=1E-6*Math.max(1,Math.abs(H),Math.abs(Da))&&Math.abs(O-Ea)<=1E-6*Math.max(1,Math.abs(O),Math.abs(Ea))&&Math.abs(M-Pa)<=1E-6*Math.max(1,Math.abs(M),Math.abs(Pa))&&Math.abs(R-Ha)<=1E-6*Math.max(1,Math.abs(R),Math.abs(Ha))&&Math.abs(W-Ma)<=1E-6*Math.max(1,Math.abs(W),Math.abs(Ma))&&Math.abs(ma-
Ta)<=1E-6*Math.max(1,Math.abs(ma),Math.abs(Ta))&&Math.abs(k-p)<=1E-6*Math.max(1,Math.abs(k),Math.abs(p))}});ha=function(){var k=ib();return function(p,A,H,O,M,R){A||=2;H||=0;for(O=O?Math.min(O*A+H,p.length):p.length;H<O;H+=A)k[0]=p[H],k[1]=p[H+1],M(k,k,R),p[H]=k[0],p[H+1]=k[1];return p}}();ha=Object.freeze({create:ib,clone:function(k){var p=new na(2);p[0]=k[0];p[1]=k[1];return p},fromValues:function(k,p){var A=new na(2);A[0]=k;A[1]=p;return A},copy:function(k,p){k[0]=p[0];k[1]=p[1];return k},set:function(k,
p,A){k[0]=p;k[1]=A;return k},add:function(k,p,A){k[0]=p[0]+A[0];k[1]=p[1]+A[1];return k},subtract:rb,multiply:ab,divide:ob,ceil:function(k,p){k[0]=Math.ceil(p[0]);k[1]=Math.ceil(p[1]);return k},floor:function(k,p){k[0]=Math.floor(p[0]);k[1]=Math.floor(p[1]);return k},min:function(k,p,A){k[0]=Math.min(p[0],A[0]);k[1]=Math.min(p[1],A[1]);return k},max:function(k,p,A){k[0]=Math.max(p[0],A[0]);k[1]=Math.max(p[1],A[1]);return k},round:function(k,p){k[0]=Math.round(p[0]);k[1]=Math.round(p[1]);return k},
scale:function(k,p,A){k[0]=p[0]*A;k[1]=p[1]*A;return k},scaleAndAdd:function(k,p,A,H){k[0]=p[0]+A[0]*H;k[1]=p[1]+A[1]*H;return k},distance:J,squaredDistance:S,length:fa,squaredLength:oa,negate:function(k,p){k[0]=-p[0];k[1]=-p[1];return k},inverse:function(k,p){k[0]=1/p[0];k[1]=1/p[1];return k},normalize:function(k,p){var A=p[0],H=p[1];A=A*A+H*H;0<A&&(A=1/Math.sqrt(A));k[0]=p[0]*A;k[1]=p[1]*A;return k},dot:function(k,p){return k[0]*p[0]+k[1]*p[1]},cross:function(k,p,A){p=p[0]*A[1]-p[1]*A[0];k[0]=k[1]=
0;k[2]=p;return k},lerp:function(k,p,A,H){var O=p[0];p=p[1];k[0]=O+H*(A[0]-O);k[1]=p+H*(A[1]-p);return k},random:function(k,p){p=p||1;var A=2*ja()*Math.PI;k[0]=Math.cos(A)*p;k[1]=Math.sin(A)*p;return k},transformMat2:function(k,p,A){var H=p[0];p=p[1];k[0]=A[0]*H+A[2]*p;k[1]=A[1]*H+A[3]*p;return k},transformMat2d:function(k,p,A){var H=p[0];p=p[1];k[0]=A[0]*H+A[2]*p+A[4];k[1]=A[1]*H+A[3]*p+A[5];return k},transformMat3:function(k,p,A){var H=p[0];p=p[1];k[0]=A[0]*H+A[3]*p+A[6];k[1]=A[1]*H+A[4]*p+A[7];
return k},transformMat4:function(k,p,A){var H=p[0];p=p[1];k[0]=A[0]*H+A[4]*p+A[12];k[1]=A[1]*H+A[5]*p+A[13];return k},rotate:function(k,p,A,H){var O=p[0]-A[0];p=p[1]-A[1];var M=Math.sin(H);H=Math.cos(H);k[0]=O*H-p*M+A[0];k[1]=O*M+p*H+A[1];return k},angle:function(k,p){var A=k[0];k=k[1];var H=p[0];p=p[1];var O=A*A+k*k;0<O&&(O=1/Math.sqrt(O));var M=H*H+p*p;0<M&&(M=1/Math.sqrt(M));A=(A*H+k*p)*O*M;return 1<A?0:-1>A?Math.PI:Math.acos(A)},zero:function(k){k[0]=0;k[1]=0;return k},str:function(k){return"vec2("+
k[0]+", "+k[1]+")"},exactEquals:function(k,p){return k[0]===p[0]&&k[1]===p[1]},equals:function(k,p){var A=k[0];k=k[1];var H=p[0];p=p[1];return Math.abs(A-H)<=1E-6*Math.max(1,Math.abs(A),Math.abs(H))&&Math.abs(k-p)<=1E-6*Math.max(1,Math.abs(k),Math.abs(p))},len:fa,sub:rb,mul:ab,div:ob,dist:J,sqrDist:S,sqrLen:oa,forEach:ha});a.glMatrix=Ua;a.mat2=Ya;a.mat2d=K;a.mat3=X;a.mat4=Y;a.quat=va;a.quat2=ba;a.vec2=ha;a.vec3=la;a.vec4=sa;Object.defineProperty(a,"__esModule",{value:!0})}
"object"===typeof exports&&"undefined"!==typeof module?tb(exports):"function"===typeof define&&define.amd?define(["exports"],tb):(pb=pb||self,tb(pb.glMatrix={}));"use strict";
function vb(a,b,l,e){function f(E,Q,aa){for(var qa=2,P;qa<aa;qa+=2){var ea=E[qa],ua=E[qa+1],Fa=E[qa+2],pa=E[qa+3],ra=(Fa-E[qa-2])*b,Ca=(pa-E[qa-1])*b,Ga=(E[qa+4]-ea)*b,Aa=(E[qa+5]-ua)*b;for(P=0;P<l;P++){var xa=P<<2,za=Q[xa],Na=Q[xa+1],ya=Q[xa+2];xa=Q[xa+3];q[m++]=za*ea+Na*Fa+ya*ra+xa*Ga;q[m++]=za*ua+Na*pa+ya*Ca+xa*Aa}}}b="number"===typeof b?b:.5;l=l?l:25;var h=1,g=a.length,m=0,q=new Float32Array((g-2)*l+2+(e?2*l:0)),r=new Float32Array(4*(l+2)),B=4;var D=a.slice(0);e?(D.unshift(a[g-1]),D.unshift(a[g-
2]),D.push(a[0],a[1])):(D.unshift(a[1]),D.unshift(a[0]),D.push(a[g-2],a[g-1]));for(r[0]=1;h<l;h++){var F=h/l,G=F*F,N=G*F,T=2*N,V=3*G;r[B++]=T-V+1;r[B++]=V-T;r[B++]=N-2*G+F;r[B++]=N-G}r[++B]=1;f(D,r,g);e&&(D=[],D.push(a[g-4],a[g-3],a[g-2],a[g-1]),D.push(a[0],a[1],a[2],a[3]),f(D,r,4));g=e?0:a.length-2;q[m++]=a[g];q[m]=a[g+1];return q}const wb=Math.pow(2,-52),Gb=new Uint32Array(512);
class Kb{static from(a,b=Lb,l=Sb){const e=a.length,f=new Float64Array(2*e);for(let h=0;h<e;h++){const g=a[h];f[2*h]=b(g);f[2*h+1]=l(g)}return new Kb(f)}constructor(a){const b=a.length>>1;if(0<b&&"number"!==typeof a[0])throw Error("Expected coords to contain numbers.");this.coords=a;a=Math.max(2*b-5,0);this._triangles=new Uint32Array(3*a);this._halfedges=new Int32Array(3*a);this._hashSize=Math.ceil(Math.sqrt(b));this._hullPrev=new Uint32Array(b);this._hullNext=new Uint32Array(b);this._hullTri=new Uint32Array(b);
this._hullHash=(new Int32Array(this._hashSize)).fill(-1);this._ids=new Uint32Array(b);this._dists=new Float64Array(b);this.update()}update(){const {coords:a,_hullPrev:b,_hullNext:l,_hullTri:e,_hullHash:f}=this;var h=a.length>>1,g=Infinity,m=Infinity,q=-Infinity,r=-Infinity;for(var B=0;B<h;B++){var D=a[2*B];var F=a[2*B+1];D<g&&(g=D);F<m&&(m=F);D>q&&(q=D);F>r&&(r=F);this._ids[B]=B}q=(g+q)/2;m=(m+r)/2;g=Infinity;for(r=0;r<h;r++)if(B=Ub(q,m,a[2*r],a[2*r+1]),B<g){var G=r;g=B}m=a[2*G];r=a[2*G+1];g=Infinity;
for(q=0;q<h;q++)if(q!==G&&(B=Ub(m,r,a[2*q],a[2*q+1]),B<g&&0<B)){var N=q;g=B}g=a[2*N];q=a[2*N+1];F=Infinity;for(B=0;B<h;B++)if(B!==G&&B!==N){D=g-m;var T=q-r;var V=a[2*B]-m;var E=a[2*B+1]-r,Q=D*D+T*T,aa=V*V+E*E,qa=.5/(D*E-T*V);T=(E*Q-T*aa)*qa;D=(D*aa-V*Q)*qa;D=T*T+D*D;if(D<F){var P=B;F=D}}B=a[2*P];D=a[2*P+1];if(Infinity===F){for(G=0;G<h;G++)this._dists[G]=a[2*G]-a[0]||a[2*G+1]-a[1];Yb(this._ids,this._dists,0,h-1);G=new Uint32Array(h);N=0;for(let ea=0,ua=-Infinity;ea<h;ea++)P=this._ids[ea],this._dists[P]>
ua&&(G[N++]=P,ua=this._dists[P]);this.hull=G.subarray(0,N);this.triangles=new Uint32Array(0);this.halfedges=new Uint32Array(0)}else{Zb(m,r,g,q,B,D)&&(F=N,V=g,Q=q,N=P,g=B,q=D,P=F,B=V,D=Q);V=g-m;F=q-r;Q=B-m;E=D-r;aa=V*V+F*F;qa=Q*Q+E*E;T=.5/(V*E-F*Q);F=m+(E*aa-F*qa)*T;V=r+(V*qa-Q*aa)*T;this._cx=F;this._cy=V;for(Q=0;Q<h;Q++)this._dists[Q]=Ub(a[2*Q],a[2*Q+1],F,V);Yb(this._ids,this._dists,0,h-1);this._hullStart=G;h=3;l[G]=b[P]=N;l[N]=b[G]=P;l[P]=b[N]=G;e[G]=0;e[N]=1;e[P]=2;f.fill(-1);f[this._hashKey(m,
r)]=G;f[this._hashKey(g,q)]=N;f[this._hashKey(B,D)]=P;this.trianglesLen=0;this._addTriangle(G,N,P,-1,-1,-1);for(let ea=0,ua,Fa;ea<this._ids.length;ea++){m=this._ids[ea];r=a[2*m];g=a[2*m+1];if(0<ea&&Math.abs(r-ua)<=wb&&Math.abs(g-Fa)<=wb)continue;ua=r;Fa=g;if(m===G||m===N||m===P)continue;q=0;for(let ra=0,Ca=this._hashKey(r,g);ra<this._hashSize&&(q=f[(Ca+ra)%this._hashSize],-1===q||q===l[q]);ra++);B=q=b[q];let pa;for(;pa=l[B],!Zb(r,g,a[2*B],a[2*B+1],a[2*pa],a[2*pa+1]);)if(B=pa,B===q){B=-1;break}if(-1!==
B){D=this._addTriangle(B,m,l[B],-1,-1,e[B]);e[m]=this._legalize(D+2);e[B]=D;h++;for(F=l[B];pa=l[F],Zb(r,g,a[2*F],a[2*F+1],a[2*pa],a[2*pa+1]);)D=this._addTriangle(F,m,pa,e[m],-1,e[F]),e[m]=this._legalize(D+2),l[F]=F,h--,F=pa;if(B===q)for(;pa=b[B],Zb(r,g,a[2*pa],a[2*pa+1],a[2*B],a[2*B+1]);)D=this._addTriangle(pa,m,B,-1,e[B],e[pa]),this._legalize(D+2),e[pa]=D,l[B]=B,h--,B=pa;this._hullStart=b[m]=B;l[B]=b[F]=m;l[m]=F;f[this._hashKey(r,g)]=m;f[this._hashKey(a[2*B],a[2*B+1])]=B}}this.hull=new Uint32Array(h);
for(let ea=0,ua=this._hullStart;ea<h;ea++)this.hull[ea]=ua,ua=l[ua];this.triangles=this._triangles.subarray(0,this.trianglesLen);this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}}_hashKey(a,b){var l=Math;a-=this._cx;b-=this._cy;a/=Math.abs(a)+Math.abs(b);return l.floor.call(l,(0<b?3-a:1+a)/4*this._hashSize)%this._hashSize}_legalize(a){const {_triangles:b,_halfedges:l,coords:e}=this;let f=0;for(var h;;){const F=l[a];var g=a-a%3;h=g+(a+2)%3;if(-1===F){if(0===f)break;a=Gb[--f];continue}const G=
F-F%3,N=G+(F+2)%3;var m=b[h],q=b[a],r=b[g+(a+1)%3];g=b[N];var B=e[2*g],D=e[2*g+1];const T=e[2*m]-B,V=e[2*m+1]-D,E=e[2*q]-B;q=e[2*q+1]-D;B=e[2*r]-B;D=e[2*r+1]-D;r=E*E+q*q;const Q=B*B+D*D;if(0>T*(q*Q-r*D)-V*(E*Q-r*B)+(T*T+V*V)*(E*D-q*B)){b[a]=g;b[F]=m;m=l[N];if(-1===m){g=this._hullStart;do{if(this._hullTri[g]===N){this._hullTri[g]=a;break}g=this._hullPrev[g]}while(g!==this._hullStart)}this._link(a,m);this._link(F,l[h]);this._link(h,N);h=G+(F+1)%3;f<Gb.length&&(Gb[f++]=h)}else{if(0===f)break;a=Gb[--f]}}return h}_link(a,
b){this._halfedges[a]=b;-1!==b&&(this._halfedges[b]=a)}_addTriangle(a,b,l,e,f,h){const g=this.trianglesLen;this._triangles[g]=a;this._triangles[g+1]=b;this._triangles[g+2]=l;this._link(g,e);this._link(g+1,f);this._link(g+2,h);this.trianglesLen+=3;return g}}function Ub(a,b,l,e){a-=l;b-=e;return a*a+b*b}function $b(a,b,l,e,f,h){e=(e-b)*(f-a);a=(l-a)*(h-b);return Math.abs(e-a)>=3.3306690738754716E-16*Math.abs(e+a)?e-a:0}
function Zb(a,b,l,e,f,h){return 0>($b(f,h,a,b,l,e)||$b(a,b,l,e,f,h)||$b(l,e,f,h,a,b))}function Yb(a,b,l,e){if(20>=e-l)for(var f=l+1;f<=e;f++){for(var h=a[f],g=b[h],m=f-1;m>=l&&b[a[m]]>g;)a[m+1]=a[m--];a[m+1]=h}else{f=l+1;h=e;hc(a,l+e>>1,f);b[a[l]]>b[a[e]]&&hc(a,l,e);b[a[f]]>b[a[e]]&&hc(a,f,e);b[a[l]]>b[a[f]]&&hc(a,l,f);g=a[f];for(m=b[g];;){do f++;while(b[a[f]]<m);do h--;while(b[a[h]]>m);if(h<f)break;hc(a,f,h)}a[l+1]=a[h];a[h]=g;e-f+1>=h-l?(Yb(a,b,f,e),Yb(a,b,l,h-1)):(Yb(a,b,l,h-1),Yb(a,b,f,e))}}
function hc(a,b,l){const e=a[b];a[b]=a[l];a[l]=e}function Lb(a){return a[0]}function Sb(a){return a[1]}"use strict";
class ic{constructor(a,[b,l,e,f]=[0,0,960,500]){if(!((e=+e)>=(b=+b)&&(f=+f)>=(l=+l)))throw Error("invalid bounds");this.delaunay=a;this._circumcenters=new Float64Array(2*a.points.length);this.vectors=new Float64Array(2*a.points.length);this.xmax=e;this.xmin=b;this.ymax=f;this.ymin=l;this._init();this._init_from_dela()}_init_from_dela(){const {delaunay:{points:a,hull:b,triangles:l,halfedges:e}}=this;this.delaunay.inedges=this.inedges=new Int32Array(a.length/2);this.delaunay._hullIndex=this._hullIndex=
new Int32Array(a.length/2);const f=this.inedges.fill(-1),h=this._hullIndex.fill(-1);for(let g=0,m=e.length;g<m;++g){const q=l[2===g%3?g-2:g+1];if(-1===e[g]||-1===f[q])f[q]=g}for(let g=0,m=b.length;g<m;++g)h[b[g]]=g}_step_from_dela(a,b,l){const {delaunay:{inedges:e,hull:f,_hullIndex:h,halfedges:g,triangles:m,points:q}}=this;if(-1===e[a]||!q.length)return(a+1)%(q.length>>1);let r=a,B=(b-q[2*a])**2+(l-q[2*a+1])**2;const D=e[a];let F=D;do{let G=m[F];const N=(b-q[2*G])**2+(l-q[2*G+1])**2;N<B&&(B=N,r=G);
F=2===F%3?F-2:F+1;if(m[F]!==a)break;F=g[F];if(-1===F){F=f[(h[a]+1)%f.length];if(F!==G&&(b-q[2*F])**2+(l-q[2*F+1])**2<B)return F;break}}while(F!==D);return r}_init(){const {delaunay:{points:a,hull:b,triangles:l},vectors:e}=this;var f=this.circumcenters=this._circumcenters.subarray(0,l.length/3*2);for(let F=0,G=0,N=l.length,T,V;F<N;F+=3,G+=2){var h=2*l[F],g=2*l[F+1],m=2*l[F+2],q=a[h];h=a[h+1];var r=a[m],B=a[m+1];m=a[g]-q;g=a[g+1]-h;var D=r-q;const E=B-h,Q=m*m+g*g,aa=D*D+E*E,qa=2*(m*E-g*D);qa?1E-8>Math.abs(qa)?
(T=(q+r)/2,V=(h+B)/2):(r=1/qa,T=q+(E*Q-g*aa)*r,V=h+(m*aa-D*Q)*r):(T=(q+r)/2-1E8*E,V=(h+B)/2+1E8*D);f[G]=T;f[G+1]=V}f=b[b.length-1];h=4*f;m=a[2*f];g=a[2*f+1];e.fill(0);for(D=0;D<b.length;++D)f=b[D],q=h,r=m,B=g,h=4*f,m=a[2*f],g=a[2*f+1],e[q+2]=e[h]=B-g,e[q+3]=e[h+1]=m-r}renderCell(a,b){const l=null==b?b=new Path:void 0,e=this._clip(a);if(null!==e){b.moveTo(e[0],e[1],a);for(a=e.length;e[0]===e[a-2]&&e[1]===e[a-1]&&1<a;)a-=2;for(let f=2;f<a;f+=2)e[f]===e[f-2]&&e[f+1]===e[f-1]||b.lineTo(e[f],e[f+1]);b.closePath();
return l&&l.value()}}renderCells(a){const {delaunay:{points:b}}=this;for(let l=0,e=b.length/2;l<e;++l)this.renderCell(l,a)}contains(a,b,l){return(b=+b,b!==b)||(l=+l,l!==l)?!1:this._step_from_dela(a,b,l)===a}_cell(a){const {circumcenters:b,delaunay:{inedges:l,halfedges:e,triangles:f}}=this,h=l[a];if(-1===h)return null;const g=[];let m=h;do{const q=Math.floor(m/3);g.push(b[2*q],b[2*q+1]);m=2===m%3?m-2:m+1;if(f[m]!==a)break;m=e[m]}while(m!==h&&-1!==m);return g}_clip(a){if(0===a&&1===this.delaunay.hull.length)return[this.xmax,
this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const b=this._cell(a);if(null===b)return null;const {vectors:l}=this,e=4*a;return l[e]||l[e+1]?this._clipInfinite(a,b,l[e],l[e+1],l[e+2],l[e+3]):this._clipFinite(a,b)}_clipFinite(a,b){const l=b.length;let e=null;let f=b[l-2],h=b[l-1];let g=this._regioncode(f,h),m;for(let D=0;D<l;D+=2){var q=f;var r=h;f=b[D];h=b[D+1];var B=g;g=this._regioncode(f,h);if(0===B&&0===g)m=0,e?e.push(f,h):e=[f,h];else{let F,G;if(0===B){if(null===(q=this._clipSegment(q,
r,f,h,B,g)))continue;[r,B,F,G]=q}else{if(null===(q=this._clipSegment(f,h,q,r,g,B)))continue;[F,G,r,B]=q;q=m;m=this._edgecode(r,B);q&&m&&this._edge(a,q,m,e,e.length);e?e.push(r,B):e=[r,B]}q=m;m=this._edgecode(F,G);q&&m&&this._edge(a,q,m,e,e.length);e?e.push(F,G):e=[F,G]}}if(e)q=m,m=this._edgecode(e[0],e[1]),q&&m&&this._edge(a,q,m,e,e.length);else if(this.contains(a,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];
return e}_clipSegment(a,b,l,e,f,h){for(;;){if(0===f&&0===h)return[a,b,l,e];if(f&h)return null;var g=void 0;let m;g=f||h;g&8?(g=a+(l-a)*(this.ymax-b)/(e-b),m=this.ymax):g&4?(g=a+(l-a)*(this.ymin-b)/(e-b),m=this.ymin):g&2?(m=b+(e-b)*(this.xmax-a)/(l-a),g=this.xmax):(m=b+(e-b)*(this.xmin-a)/(l-a),g=this.xmin);f?(a=g,b=m,f=this._regioncode(a,b)):(l=g,e=m,h=this._regioncode(l,e))}}_clipInfinite(a,b,l,e,f,h){b=Array.from(b);let g;(g=this._project(b[0],b[1],l,e))&&b.unshift(g[0],g[1]);(g=this._project(b[b.length-
2],b[b.length-1],f,h))&&b.push(g[0],g[1]);if(b=this._clipFinite(a,b))for(let m=0,q=b.length,r,B=this._edgecode(b[q-2],b[q-1]);m<q;m+=2)r=B,B=this._edgecode(b[m],b[m+1]),r&&B&&(m=this._edge(a,r,B,b,m),q=b.length);else this.contains(a,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(b=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return b}_edge(a,b,l,e,f){for(;b!==l;){let h,g;switch(b){case 5:b=4;continue;case 4:b=6;h=this.xmax;g=this.ymin;break;case 6:b=2;continue;
case 2:b=10;h=this.xmax;g=this.ymax;break;case 10:b=8;continue;case 8:b=9;h=this.xmin;g=this.ymax;break;case 9:b=1;continue;case 1:b=5,h=this.xmin,g=this.ymin}e[f]===h&&e[f+1]===g||!this.contains(a,h,g)||(e.splice(f,0,h,g),f+=2)}if(4<e.length)for(a=0;a<e.length;a+=2)if(b=(a+2)%e.length,l=(a+4)%e.length,e[a]===e[b]&&e[b]===e[l]||e[a+1]===e[b+1]&&e[b+1]===e[l+1])e.splice(b,2),a-=2;return f}_project(a,b,l,e){let f=Infinity,h,g,m;if(0>e){if(b<=this.ymin)return null;(h=(this.ymin-b)/e)<f&&(m=this.ymin,
g=a+(f=h)*l)}else if(0<e){if(b>=this.ymax)return null;(h=(this.ymax-b)/e)<f&&(m=this.ymax,g=a+(f=h)*l)}if(0<l){if(a>=this.xmax)return null;(h=(this.xmax-a)/l)<f&&(g=this.xmax,m=b+h*e)}else if(0>l){if(a<=this.xmin)return null;(h=(this.xmin-a)/l)<f&&(g=this.xmin,m=b+h*e)}return[g,m]}_edgecode(a,b){return(a===this.xmin?1:a===this.xmax?2:0)|(b===this.ymin?4:b===this.ymax?8:0)}_regioncode(a,b){return(a<this.xmin?1:a>this.xmax?2:0)|(b<this.ymin?4:b>this.ymax?8:0)}}
(function(a){"object"===typeof exports&&"undefined"!==typeof module?module.exports=a():"function"===typeof define&&define.amd?define([],a):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).poly2tri=a()})(function(){return function f(b,l,e){function h(q,r){if(!l[q]){if(!b[q]){var B="function"==typeof require&&require;if(!r&&B)return B(q,!0);if(g)return g(q,!0);r=Error("Cannot find module '"+q+"'");throw r.code="MODULE_NOT_FOUND",r;}r=l[q]={exports:{}};
b[q][0].call(r.exports,function(D){var F=b[q][1][D];return h(F?F:D)},r,r.exports,f,b,l,e)}return l[q].exports}for(var g="function"==typeof require&&require,m=0;m<e.length;m++)h(e[m]);return h}({1:[function(b,l){l.exports={version:"1.5.0"}},{}],2:[function(b,l){function e(f,h){this.head_=f;this.tail_=h;this.search_node_=f}e.prototype.head=function(){return this.head_};e.prototype.setHead=function(f){this.head_=f};e.prototype.tail=function(){return this.tail_};e.prototype.setTail=function(f){this.tail_=
f};e.prototype.search=function(){return this.search_node_};e.prototype.setSearch=function(f){this.search_node_=f};e.prototype.findSearchNode=function(){return this.search_node_};e.prototype.locateNode=function(f){var h=this.search_node_;if(f<h.value)for(;h=h.prev;){if(f>=h.value)return this.search_node_=h}else for(;h=h.next;)if(f<h.value)return this.search_node_=h.prev;return null};e.prototype.locatePoint=function(f){var h=f.x,g=this.findSearchNode(h),m=g.point.x;if(h===m){if(f!==g.point)if(f===g.prev.point)g=
g.prev;else if(f===g.next.point)g=g.next;else throw Error("poly2tri Invalid AdvancingFront.locatePoint() call");}else if(h<m)for(;(g=g.prev)&&f!==g.point;);else for(;(g=g.next)&&f!==g.point;);g&&(this.search_node_=g);return g};l.exports=e;l.exports.Node=function(f,h){this.point=f;this.triangle=h||null;this.prev=this.next=null;this.value=f.x}},{}],3:[function(b,l){l.exports=function(e,f){if(!e)throw Error(f||"Assert Failed");}},{}],4:[function(b,l){function e(h,g){this.x=+h||0;this.y=+g||0;this._p2t_edge_list=
null}var f=b("./xy");e.prototype.toString=function(){return f.toStringBase(this)};e.prototype.toJSON=function(){return{x:this.x,y:this.y}};e.prototype.clone=function(){return new e(this.x,this.y)};e.prototype.set_zero=function(){this.y=this.x=0;return this};e.prototype.set=function(h,g){this.x=+h||0;this.y=+g||0;return this};e.prototype.negate=function(){this.x=-this.x;this.y=-this.y;return this};e.prototype.add=function(h){this.x+=h.x;this.y+=h.y;return this};e.prototype.sub=function(h){this.x-=
h.x;this.y-=h.y;return this};e.prototype.mul=function(h){this.x*=h;this.y*=h;return this};e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};e.prototype.normalize=function(){var h=this.length();this.x/=h;this.y/=h;return h};e.prototype.equals=function(h){return this.x===h.x&&this.y===h.y};e.negate=function(h){return new e(-h.x,-h.y)};e.add=function(h,g){return new e(h.x+g.x,h.y+g.y)};e.sub=function(h,g){return new e(h.x-g.x,h.y-g.y)};e.mul=function(h,g){return new e(h*g.x,
h*g.y)};e.cross=function(h,g){return"number"===typeof h?"number"===typeof g?h*g:new e(-h*g.y,h*g.x):"number"===typeof g?new e(g*h.y,-g*h.x):h.x*g.y-h.y*g.x};e.toString=f.toString;e.compare=f.compare;e.cmp=f.compare;e.equals=f.equals;e.dot=function(h,g){return h.x*g.x+h.y*g.y};l.exports=e},{"./xy":11}],5:[function(b,l){function e(h,g){this.name="PointError";this.points=g=g||[];this.message=h||"Invalid Points!";for(h=0;h<g.length;h++)this.message+=" "+f.toString(g[h])}var f=b("./xy");e.prototype=Error();
e.prototype.constructor=e;l.exports=e},{"./xy":11}],6:[function(b,l,e){(function(f){var h=f.poly2tri;e.noConflict=function(){f.poly2tri=h;return e};e.VERSION=b("../dist/version.json").version;e.PointError=b("./pointerror");e.Point=b("./point");e.Triangle=b("./triangle");e.SweepContext=b("./sweepcontext");var g=b("./sweep");e.triangulate=g.triangulate;e.sweep={Triangulate:g.triangulate}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:
{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(b,l,e){function f(Ga,Aa,xa,za,Na){if(!h(za,Aa,xa)){var ya=za.pointCCW(Na),Ia=pa(xa,ya,Aa);if(Ia===Fa.COLLINEAR)throw new qa("poly2tri EdgeEvent: Collinear not supported!",[xa,ya,Aa]);ya=za.pointCW(Na);var $a=pa(xa,ya,Aa);if($a===Fa.COLLINEAR)throw new qa("poly2tri EdgeEvent: Collinear not supported!",[xa,ya,Aa]);Ia===$a?(za=Ia===Fa.CW?za.neighborCCW(Na):za.neighborCW(Na),f(Ga,Aa,
xa,za,Na)):V(Ga,Aa,xa,za,Na)}}function h(Ga,Aa,xa){var za=Ga.edgeIndex(Aa,xa);return-1!==za?(Ga.markConstrainedEdgeByIndex(za),(Ga=Ga.getNeighbor(za))&&Ga.markConstrainedEdgeByPoints(Aa,xa),!0):!1}function g(Ga,Aa){var xa=new P(Aa.prev.point,Aa.point,Aa.next.point);xa.markNeighbor(Aa.prev.triangle);xa.markNeighbor(Aa.triangle);Ga.addToMap(xa);Aa.prev.next=Aa.next;Aa.next.prev=Aa.prev;m(Ga,xa)||Ga.mapTriangleToNodes(xa)}function m(Ga,Aa){for(var xa=0;3>xa;++xa)if(!Aa.delaunay_edge[xa]){var za=Aa.getNeighbor(xa);
if(za){var Na=Aa.getPoint(xa),ya=za.oppositePoint(Aa,Na),Ia=za.index(ya);if(za.constrained_edge[Ia]||za.delaunay_edge[Ia])Aa.constrained_edge[xa]=za.constrained_edge[Ia];else{var $a=Aa.pointCCW(Na),lb=Aa.pointCW(Na);var xb=Na.x-ya.x;var Cb=Na.y-ya.y,ca=$a.x-ya.x;$a=$a.y-ya.y;var Sa=xb*$a-ca*Cb;if(0>=Sa)xb=!1;else{var Va=lb.x-ya.x;lb=lb.y-ya.y;var fb=Va*Cb-xb*lb;xb=0>=fb?!1:0<(xb*xb+Cb*Cb)*(ca*lb-Va*$a)+(ca*ca+$a*$a)*fb+(Va*Va+lb*lb)*Sa}if(xb)return Aa.delaunay_edge[xa]=!0,za.delaunay_edge[Ia]=!0,
q(Aa,Na,za,ya),(Na=!m(Ga,Aa))&&Ga.mapTriangleToNodes(Aa),(Na=!m(Ga,za))&&Ga.mapTriangleToNodes(za),Aa.delaunay_edge[xa]=!1,za.delaunay_edge[Ia]=!1,!0}}}return!1}function q(Ga,Aa,xa,za){var Na=Ga.neighborCCW(Aa);var ya=Ga.neighborCW(Aa);var Ia=xa.neighborCCW(za);var $a=xa.neighborCW(za);var lb=Ga.getConstrainedEdgeCCW(Aa);var xb=Ga.getConstrainedEdgeCW(Aa);var Cb=xa.getConstrainedEdgeCCW(za);var ca=xa.getConstrainedEdgeCW(za);var Sa=Ga.getDelaunayEdgeCCW(Aa);var Va=Ga.getDelaunayEdgeCW(Aa);var fb=
xa.getDelaunayEdgeCCW(za);var Qa=xa.getDelaunayEdgeCW(za);Ga.legalize(Aa,za);xa.legalize(za,Aa);xa.setDelaunayEdgeCCW(Aa,Sa);Ga.setDelaunayEdgeCW(Aa,Va);Ga.setDelaunayEdgeCCW(za,fb);xa.setDelaunayEdgeCW(za,Qa);xa.setConstrainedEdgeCCW(Aa,lb);Ga.setConstrainedEdgeCW(Aa,xb);Ga.setConstrainedEdgeCCW(za,Cb);xa.setConstrainedEdgeCW(za,ca);Ga.clearNeighbors();xa.clearNeighbors();Na&&xa.markNeighbor(Na);ya&&Ga.markNeighbor(ya);Ia&&Ga.markNeighbor(Ia);$a&&xa.markNeighbor($a);Ga.markNeighbor(xa)}function r(Ga,
Aa){var xa=Ga.basin.width>(Ga.basin.left_highest?Ga.basin.left_node.point.y-Aa.point.y:Ga.basin.right_node.point.y-Aa.point.y)?!0:!1;if(!xa&&(g(Ga,Aa),Aa.prev!==Ga.basin.left_node||Aa.next!==Ga.basin.right_node)){if(Aa.prev===Ga.basin.left_node){xa=pa(Aa.point,Aa.next.point,Aa.next.next.point);if(xa===Fa.CW)return;Aa=Aa.next}else if(Aa.next===Ga.basin.right_node){xa=pa(Aa.point,Aa.prev.point,Aa.prev.prev.point);if(xa===Fa.CCW)return;Aa=Aa.prev}else Aa=Aa.prev.point.y<Aa.next.point.y?Aa.prev:Aa.next;
r(Ga,Aa)}}function B(Ga,Aa,xa){xa.point.x<Aa.p.x&&(pa(xa.point,xa.next.point,xa.next.next.point)===Fa.CCW?D(Ga,Aa,xa):(F(Ga,Aa,xa),B(Ga,Aa,xa)))}function D(Ga,Aa,xa){g(Ga,xa.next);xa.next.point!==Aa.p&&pa(Aa.q,xa.next.point,Aa.p)===Fa.CCW&&pa(xa.point,xa.next.point,xa.next.next.point)===Fa.CCW&&D(Ga,Aa,xa)}function F(Ga,Aa,xa){pa(xa.next.point,xa.next.next.point,xa.next.next.next.point)===Fa.CCW?D(Ga,Aa,xa.next):pa(Aa.q,xa.next.next.point,Aa.p)===Fa.CCW&&F(Ga,Aa,xa.next)}function G(Ga,Aa,xa){xa.point.x>
Aa.p.x&&(pa(xa.point,xa.prev.point,xa.prev.prev.point)===Fa.CW?T(Ga,Aa,xa):(N(Ga,Aa,xa),G(Ga,Aa,xa)))}function N(Ga,Aa,xa){pa(xa.prev.point,xa.prev.prev.point,xa.prev.prev.prev.point)===Fa.CW?T(Ga,Aa,xa.prev):pa(Aa.q,xa.prev.prev.point,Aa.p)===Fa.CW&&N(Ga,Aa,xa.prev)}function T(Ga,Aa,xa){g(Ga,xa.prev);xa.prev.point!==Aa.p&&pa(Aa.q,xa.prev.point,Aa.p)===Fa.CW&&pa(xa.point,xa.prev.point,xa.prev.prev.point)===Fa.CW&&T(Ga,Aa,xa)}function V(Ga,Aa,xa,za,Na){var ya=za.neighborAcross(Na);aa(ya,"FLIP failed due to missing triangle!");
var Ia=ya.oppositePoint(za,Na);if(za.getConstrainedEdgeAcross(Na))throw Ga=za.index(Na),new qa("poly2tri Intersecting Constraints",[Na,Ia,za.getPoint((Ga+1)%3),za.getPoint((Ga+2)%3)]);if(ra(Na,za.pointCCW(Na),za.pointCW(Na),Ia))if(q(za,Na,ya,Ia),Ga.mapTriangleToNodes(za),Ga.mapTriangleToNodes(ya),Na===xa&&Ia===Aa)xa===Ga.edge_event.constrained_edge.q&&Aa===Ga.edge_event.constrained_edge.p&&(za.markConstrainedEdgeByPoints(Aa,xa),ya.markConstrainedEdgeByPoints(Aa,xa),m(Ga,za),m(Ga,ya));else{var $a=
pa(xa,Ia,Aa);$a===Fa.CCW?(Ia=ya.edgeIndex(Na,Ia),ya.delaunay_edge[Ia]=!0,m(Ga,ya),ya.clearDelaunayEdges()):(Ia=za.edgeIndex(Na,Ia),za.delaunay_edge[Ia]=!0,m(Ga,za),za.clearDelaunayEdges(),za=ya);V(Ga,Aa,xa,za,Na)}else Ia=E(Aa,xa,ya,Ia),Q(Ga,Aa,xa,za,ya,Ia),f(Ga,Aa,xa,za,Na)}function E(Ga,Aa,xa,za){var Na=pa(Aa,za,Ga);if(Na===Fa.CW)return xa.pointCCW(za);if(Na===Fa.CCW)return xa.pointCW(za);throw new qa("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[Aa,za,Ga]);}function Q(Ga,
Aa,xa,za,Na,ya){var Ia=Na.neighborAcross(ya);aa(Ia,"FLIP failed due to missing triangle");Na=Ia.oppositePoint(Na,ya);ra(xa,za.pointCCW(xa),za.pointCW(xa),Na)?V(Ga,xa,Na,Ia,Na):(Na=E(Aa,xa,Ia,Na),Q(Ga,Aa,xa,za,Ia,Na))}var aa=b("./assert"),qa=b("./pointerror"),P=b("./triangle"),ea=b("./advancingfront").Node;b=b("./utils");var ua=b.EPSILON,Fa=b.Orientation,pa=b.orient2d,ra=b.inScanArea,Ca=b.isAngleObtuse;e.triangulate=function(Ga){Ga.initTriangulation();Ga.createAdvancingFront();var Aa,xa=Ga.pointCount();
for(Aa=1;Aa<xa;++Aa){var za=Ga.getPoint(Aa),Na=Ga,ya=za,Ia=Na.locateNode(ya),$a=new P(ya,Ia.point,Ia.next.point);$a.markNeighbor(Ia.triangle);Na.addToMap($a);var lb=new ea(ya);lb.next=Ia.next;lb.prev=Ia;Ia.next.prev=lb;Ia.next=lb;m(Na,$a)||Na.mapTriangleToNodes($a);ya.x<=Ia.point.x+ua&&g(Na,Ia);for(ya=lb.next;ya.next&&!Ca(ya.point,ya.next.point,ya.prev.point);)g(Na,ya),ya=ya.next;for(ya=lb.prev;ya.prev&&!Ca(ya.point,ya.next.point,ya.prev.point);)g(Na,ya),ya=ya.prev;if(lb.next&&lb.next.next&&(ya=lb.point.x-
lb.next.next.point.x,Ia=lb.point.y-lb.next.next.point.y,aa(0<=Ia,"unordered y"),0<=ya||Math.abs(ya)<Ia)){ya=lb;pa(ya.point,ya.next.point,ya.next.next.point)===Fa.CCW?Na.basin.left_node=ya.next.next:Na.basin.left_node=ya.next;for(Na.basin.bottom_node=Na.basin.left_node;Na.basin.bottom_node.next&&Na.basin.bottom_node.point.y>=Na.basin.bottom_node.next.point.y;)Na.basin.bottom_node=Na.basin.bottom_node.next;if(Na.basin.bottom_node!==Na.basin.left_node){for(Na.basin.right_node=Na.basin.bottom_node;Na.basin.right_node.next&&
Na.basin.right_node.point.y<Na.basin.right_node.next.point.y;)Na.basin.right_node=Na.basin.right_node.next;Na.basin.right_node!==Na.basin.bottom_node&&(Na.basin.width=Na.basin.right_node.point.x-Na.basin.left_node.point.x,Na.basin.left_highest=Na.basin.left_node.point.y>Na.basin.right_node.point.y,r(Na,Na.basin.bottom_node))}}za=za._p2t_edge_list;for(Na=0;za&&Na<za.length;++Na)if(ya=Ga,Ia=za[Na],$a=lb,ya.edge_event.constrained_edge=Ia,ya.edge_event.right=Ia.p.x>Ia.q.x,!h($a.triangle,Ia.p,Ia.q)){if(ya.edge_event.right)for(var xb=
ya,Cb=Ia,ca=$a;ca.next.point.x<Cb.p.x;)pa(Cb.q,ca.next.point,Cb.p)===Fa.CCW?B(xb,Cb,ca):ca=ca.next;else for(xb=ya,Cb=Ia,ca=$a;ca.prev.point.x>Cb.p.x;)pa(Cb.q,ca.prev.point,Cb.p)===Fa.CW?G(xb,Cb,ca):ca=ca.prev;f(ya,Ia.p,Ia.q,$a.triangle,Ia.q)}}Aa=Ga.front().head().next.triangle;for(xa=Ga.front().head().next.point;!Aa.getConstrainedEdgeCW(xa);)Aa=Aa.neighborCCW(xa);Ga.meshClean(Aa)}},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(b,l){function e(G,N){N=
N||{};this.triangles_=[];this.map_=[];this.points_=N.cloneArrays?G.slice(0):G;this.edge_list=[];this.af_tail_=this.af_middle_=this.af_head_=this.tail_=this.head_=this.front_=this.pmin_=this.pmax_=null;this.basin=new h;this.edge_event=new f;this.initEdges(this.points_)}function f(){this.constrained_edge=null;this.right=!1}function h(){this.right_node=this.bottom_node=this.left_node=null;this.width=0;this.left_highest=!1}function g(G,N){this.p=G;this.q=N;if(G.y>N.y)this.q=G,this.p=N;else if(G.y===N.y)if(G.x>
N.x)this.q=G,this.p=N;else if(G.x===N.x)throw new m("poly2tri Invalid Edge constructor: repeated points!",[G]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]);this.q._p2t_edge_list.push(this)}var m=b("./pointerror"),q=b("./point"),r=b("./triangle"),B=b("./sweep"),D=b("./advancingfront"),F=D.Node;h.prototype.clear=function(){this.right_node=this.bottom_node=this.left_node=null;this.width=0;this.left_highest=!1};e.prototype.addHole=function(G){this.initEdges(G);var N,T=G.length;for(N=0;N<T;N++)this.points_.push(G[N]);
return this};e.prototype.AddHole=e.prototype.addHole;e.prototype.addHoles=function(G){var N,T=G.length;for(N=0;N<T;N++)this.initEdges(G[N]);this.points_=this.points_.concat.apply(this.points_,G);return this};e.prototype.addPoint=function(G){this.points_.push(G);return this};e.prototype.AddPoint=e.prototype.addPoint;e.prototype.addPoints=function(G){this.points_=this.points_.concat(G);return this};e.prototype.triangulate=function(){B.triangulate(this);return this};e.prototype.getBoundingBox=function(){return{min:this.pmin_,
max:this.pmax_}};e.prototype.getTriangles=function(){return this.triangles_};e.prototype.GetTriangles=e.prototype.getTriangles;e.prototype.front=function(){return this.front_};e.prototype.pointCount=function(){return this.points_.length};e.prototype.head=function(){return this.head_};e.prototype.setHead=function(G){this.head_=G};e.prototype.tail=function(){return this.tail_};e.prototype.setTail=function(G){this.tail_=G};e.prototype.getMap=function(){return this.map_};e.prototype.initTriangulation=
function(){var G=this.points_[0].x,N=this.points_[0].x,T=this.points_[0].y,V=this.points_[0].y,E,Q=this.points_.length;for(E=1;E<Q;E++){var aa=this.points_[E];aa.x>G&&(G=aa.x);aa.x<N&&(N=aa.x);aa.y>T&&(T=aa.y);aa.y<V&&(V=aa.y)}this.pmin_=new q(N,V);this.pmax_=new q(G,T);E=.3*(G-N);T=.3*(T-V);this.head_=new q(G+E,V-T);this.tail_=new q(N-E,V-T);this.points_.sort(q.compare)};e.prototype.initEdges=function(G){var N,T=G.length;for(N=0;N<T;++N)this.edge_list.push(new g(G[N],G[(N+1)%T]))};e.prototype.getPoint=
function(G){return this.points_[G]};e.prototype.addToMap=function(G){this.map_.push(G)};e.prototype.locateNode=function(G){return this.front_.locateNode(G.x)};e.prototype.createAdvancingFront=function(){var G=new r(this.points_[0],this.tail_,this.head_);this.map_.push(G);var N=new F(G.getPoint(1),G);var T=new F(G.getPoint(0),G);G=new F(G.getPoint(2));this.front_=new D(N,G);N.next=T;T.next=G;T.prev=N;G.prev=T};e.prototype.removeNode=function(){};e.prototype.mapTriangleToNodes=function(G){for(var N=
0;3>N;++N)if(!G.getNeighbor(N)){var T=this.front_.locatePoint(G.pointCW(G.getPoint(N)));T&&(T.triangle=G)}};e.prototype.removeFromMap=function(G){var N,T=this.map_,V=T.length;for(N=0;N<V;N++)if(T[N]===G){T.splice(N,1);break}};e.prototype.meshClean=function(G){G=[G];for(var N,T;N=G.pop();)if(!N.isInterior())for(N.setInterior(!0),this.triangles_.push(N),T=0;3>T;T++)N.constrained_edge[T]||G.push(N.getNeighbor(T))};l.exports=e},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],
9:[function(b,l){function e(h,g,m){this.points_=[h,g,m];this.neighbors_=[null,null,null];this.interior_=!1;this.constrained_edge=[!1,!1,!1];this.delaunay_edge=[!1,!1,!1]}var f=b("./xy").toString;e.prototype.toString=function(){return"["+f(this.points_[0])+f(this.points_[1])+f(this.points_[2])+"]"};e.prototype.getPoint=function(h){return this.points_[h]};e.prototype.GetPoint=e.prototype.getPoint;e.prototype.getPoints=function(){return this.points_};e.prototype.getNeighbor=function(h){return this.neighbors_[h]};
e.prototype.containsPoint=function(h){var g=this.points_;return h===g[0]||h===g[1]||h===g[2]};e.prototype.containsEdge=function(h){return this.containsPoint(h.p)&&this.containsPoint(h.q)};e.prototype.containsPoints=function(h,g){return this.containsPoint(h)&&this.containsPoint(g)};e.prototype.isInterior=function(){return this.interior_};e.prototype.setInterior=function(h){this.interior_=h;return this};e.prototype.markNeighborPointers=function(h,g,m){var q=this.points_;if(h===q[2]&&g===q[1]||h===q[1]&&
g===q[2])this.neighbors_[0]=m;else if(h===q[0]&&g===q[2]||h===q[2]&&g===q[0])this.neighbors_[1]=m;else if(h===q[0]&&g===q[1]||h===q[1]&&g===q[0])this.neighbors_[2]=m;else throw Error("poly2tri Invalid Triangle.markNeighborPointers() call");};e.prototype.markNeighbor=function(h){var g=this.points_;h.containsPoints(g[1],g[2])?(this.neighbors_[0]=h,h.markNeighborPointers(g[1],g[2],this)):h.containsPoints(g[0],g[2])?(this.neighbors_[1]=h,h.markNeighborPointers(g[0],g[2],this)):h.containsPoints(g[0],g[1])&&
(this.neighbors_[2]=h,h.markNeighborPointers(g[0],g[1],this))};e.prototype.clearNeighbors=function(){this.neighbors_[0]=null;this.neighbors_[1]=null;this.neighbors_[2]=null};e.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1;this.delaunay_edge[1]=!1;this.delaunay_edge[2]=!1};e.prototype.pointCW=function(h){var g=this.points_;return h===g[0]?g[2]:h===g[1]?g[0]:h===g[2]?g[1]:null};e.prototype.pointCCW=function(h){var g=this.points_;return h===g[0]?g[1]:h===g[1]?g[2]:h===g[2]?g[0]:null};
e.prototype.neighborCW=function(h){return h===this.points_[0]?this.neighbors_[1]:h===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]};e.prototype.neighborCCW=function(h){return h===this.points_[0]?this.neighbors_[2]:h===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]};e.prototype.getConstrainedEdgeCW=function(h){return h===this.points_[0]?this.constrained_edge[1]:h===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]};e.prototype.getConstrainedEdgeCCW=function(h){return h===
this.points_[0]?this.constrained_edge[2]:h===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]};e.prototype.getConstrainedEdgeAcross=function(h){return h===this.points_[0]?this.constrained_edge[0]:h===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]};e.prototype.setConstrainedEdgeCW=function(h,g){h===this.points_[0]?this.constrained_edge[1]=g:h===this.points_[1]?this.constrained_edge[2]=g:this.constrained_edge[0]=g};e.prototype.setConstrainedEdgeCCW=function(h,g){h===
this.points_[0]?this.constrained_edge[2]=g:h===this.points_[1]?this.constrained_edge[0]=g:this.constrained_edge[1]=g};e.prototype.getDelaunayEdgeCW=function(h){return h===this.points_[0]?this.delaunay_edge[1]:h===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]};e.prototype.getDelaunayEdgeCCW=function(h){return h===this.points_[0]?this.delaunay_edge[2]:h===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]};e.prototype.setDelaunayEdgeCW=function(h,g){h===this.points_[0]?this.delaunay_edge[1]=
g:h===this.points_[1]?this.delaunay_edge[2]=g:this.delaunay_edge[0]=g};e.prototype.setDelaunayEdgeCCW=function(h,g){h===this.points_[0]?this.delaunay_edge[2]=g:h===this.points_[1]?this.delaunay_edge[0]=g:this.delaunay_edge[1]=g};e.prototype.neighborAcross=function(h){return h===this.points_[0]?this.neighbors_[0]:h===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]};e.prototype.oppositePoint=function(h,g){h=h.pointCW(g);return this.pointCW(h)};e.prototype.legalize=function(h,g){var m=this.points_;
if(h===m[0])m[1]=m[0],m[0]=m[2],m[2]=g;else if(h===m[1])m[2]=m[1],m[1]=m[0],m[0]=g;else if(h===m[2])m[0]=m[2],m[2]=m[1],m[1]=g;else throw Error("poly2tri Invalid Triangle.legalize() call");};e.prototype.index=function(h){var g=this.points_;if(h===g[0])return 0;if(h===g[1])return 1;if(h===g[2])return 2;throw Error("poly2tri Invalid Triangle.index() call");};e.prototype.edgeIndex=function(h,g){var m=this.points_;if(h===m[0]){if(g===m[1])return 2;if(g===m[2])return 1}else if(h===m[1]){if(g===m[2])return 0;
if(g===m[0])return 2}else if(h===m[2]){if(g===m[0])return 1;if(g===m[1])return 0}return-1};e.prototype.markConstrainedEdgeByIndex=function(h){this.constrained_edge[h]=!0};e.prototype.markConstrainedEdgeByEdge=function(h){this.markConstrainedEdgeByPoints(h.p,h.q)};e.prototype.markConstrainedEdgeByPoints=function(h,g){var m=this.points_;if(g===m[0]&&h===m[1]||g===m[1]&&h===m[0])this.constrained_edge[2]=!0;else if(g===m[0]&&h===m[2]||g===m[2]&&h===m[0])this.constrained_edge[1]=!0;else if(g===m[1]&&h===
m[2]||g===m[2]&&h===m[1])this.constrained_edge[0]=!0};l.exports=e},{"./xy":11}],10:[function(b,l,e){e.EPSILON=1E-12;var f={CW:1,CCW:-1,COLLINEAR:0};e.Orientation=f;e.orient2d=function(h,g,m){h=(h.x-m.x)*(g.y-m.y)-(h.y-m.y)*(g.x-m.x);return-1E-12<h&&1E-12>h?f.COLLINEAR:0<h?f.CCW:f.CW};e.inScanArea=function(h,g,m,q){return-1E-12<=(h.x-g.x)*(q.y-g.y)-(q.x-g.x)*(h.y-g.y)||1E-12>=(h.x-m.x)*(q.y-m.y)-(q.x-m.x)*(h.y-m.y)?!1:!0};e.isAngleObtuse=function(h,g,m){return 0>(g.x-h.x)*(m.x-h.x)+(g.y-h.y)*(m.y-
h.y)}},{}],11:[function(b,l){function e(f){return"("+f.x+";"+f.y+")"}l.exports={toString:function(f){var h=f.toString();return"[object Object]"===h?e(f):h},toStringBase:e,compare:function(f,h){return f.y===h.y?f.x-h.x:f.y-h.y},equals:function(f,h){return f.x===h.x&&f.y===h.y}}},{}]},{},[6])(6)});
var pc=function(a,b){a=a||require("./node/self.js");var l=a.window,e=a.document,f=new function(){function rb(K,X,Y){if(K){var la=ja(K,"length");(la&&"number"===typeof la.value?Ua:ab).call(K,X,Y=Y||K)}return Y}function ab(K,X){for(var Y in this)this.hasOwnProperty(Y)&&K.call(X,this[Y],Y,this)}function ob(K,X,Y,la,sa){function va(A,H){H=H||(H=ja(X,A))&&(H.get?H:H.value);"string"===typeof H&&"#"===H[0]&&(H=K[H.substring(1)]||H);var O="function"===typeof H,M=H,R=sa||O&&!H.base?H&&H.get?A in K:K[A]:null,
W;sa&&R||(O&&R&&(H.base=R),O&&!1!==la&&(W=A.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(ba[W[3].toLowerCase()+W[4]]=W[2]),M&&!O&&M.get&&"function"===typeof M.get&&J.isPlainObject(M)||(M={value:M,writable:!0}),(ja(K,A)||{configurable:!0}).configurable&&(M.configurable=!0,M.enumerable=null!=Y?Y:!W),Ba(K,A,M))}var ba={};if(X){for(var ha in X)X.hasOwnProperty(ha)&&!S.test(ha)&&va(ha);for(ha in ba){var k=ba[ha],p=K["set"+k];k=K["get"+k]||p&&K["is"+k];!k||!0!==la&&0!==k.length||va(ha,{get:k,set:p})}}return K}
function J(){for(var K=0,X=arguments.length;K<X;K++){var Y=arguments[K];Y&&Ya(this,Y)}return this}var S=/^(statics|enumerable|beans|preserve)$/,fa=[],oa=fa.slice,na=Object.create,ja=Object.getOwnPropertyDescriptor,Ba=Object.defineProperty,Ua=fa.forEach||function(K,X){for(var Y=0,la=this.length;Y<la;Y++)K.call(X,this[Y],Y,this)},Ya=Object.assign||function(K){for(var X=1,Y=arguments.length;X<Y;X++){var la=arguments[X],sa;for(sa in la)la.hasOwnProperty(sa)&&(K[sa]=la[sa])}return K};return ob(J,{inject:function(K){if(K){var X=
!0===K.statics?K:K.statics,Y=K.beans,la=K.preserve;X!==K&&ob(this.prototype,K,K.enumerable,Y,la);ob(this,X,null,Y,la)}X=1;for(Y=arguments.length;X<Y;X++)this.inject(arguments[X]);return this},extend:function(){for(var K=this,X,Y,la=0,sa,va=arguments.length;la<va&&(!X||!Y);la++)sa=arguments[la],X=X||sa.initialize,Y=Y||sa.prototype;X=X||function(){K.apply(this,arguments)};Y=X.prototype=Y||na(this.prototype);Ba(Y,"constructor",{value:X,writable:!0,configurable:!0});ob(X,this);arguments.length&&this.inject.apply(X,
arguments);X.base=K;return X}}).inject({enumerable:!1,initialize:J,set:J,inject:function(){for(var K=0,X=arguments.length;K<X;K++){var Y=arguments[K];Y&&ob(this,Y,Y.enumerable,Y.beans,Y.preserve)}return this},extend:function(){var K=na(this);return K.inject.apply(K,arguments)},each:function(K,X){return rb(this,K,X)},clone:function(){return new this.constructor(this)},statics:{set:Ya,each:rb,create:na,define:Ba,describe:ja,clone:function(K){return Ya(new K.constructor,K)},isPlainObject:function(K){return(K=
null!=K&&K.constructor)&&(K===Object||K===J||"Object"===K.name)},pick:function(K,X){return K!==b?K:X},slice:function(K,X,Y){return oa.call(K,X,Y)}}})};"undefined"!==typeof module&&(module.exports=f);f.inject({enumerable:!1,toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+f.each(this,function(rb,ab){if(!/^_/.test(ab)){var ob=typeof rb;this.push(ab+": "+("number"===ob?r.instance.number(rb):"string"===ob?"'"+rb+"'":rb))}},[]).join(", ")+
" }"},getClassName:function(){return this._class||""},importJSON:function(rb){return f.importJSON(rb,this)},exportJSON:function(rb){return f.exportJSON(this,rb)},toJSON:function(){return f.serialize(this)},set:function(rb,ab){rb&&f.filter(this,rb,ab,this._prioritize);return this}},{beans:!1,statics:{exports:{},extend:function ab(){var ob=ab.base.apply(this,arguments),J=ob.prototype._class;J&&!f.exports[J]&&(f.exports[J]=ob);return ob},equals:function(ab,ob){if(ab===ob)return!0;if(ab&&ab.equals)return ab.equals(ob);
if(ob&&ob.equals)return ob.equals(ab);if(ab&&ob&&"object"===typeof ab&&"object"===typeof ob){if(Array.isArray(ab)&&Array.isArray(ob)){var J=ab.length;if(J!==ob.length)return!1;for(;J--;)if(!f.equals(ab[J],ob[J]))return!1}else{var S=Object.keys(ab);J=S.length;if(J!==Object.keys(ob).length)return!1;for(;J--;){var fa=S[J];if(!ob.hasOwnProperty(fa)||!f.equals(ab[fa],ob[fa]))return!1}}return!0}return!1},read:function(ab,ob,J,S){if(this===f)return J=this.peek(ab,ob),ab.__index++,J;var fa=this.prototype,
oa=fa._readIndex,na=ob||oa&&ab.__index||0,ja=ab.length;ob=ab[na];S=S||ja-na;if(ob instanceof this||J&&J.readNull&&null==ob&&1>=S)return oa&&(ab.__index=na+1),ob&&J&&J.clone?ob.clone():ob;ob=f.create(fa);oa&&(ob.__read=!0);ob=ob.initialize.apply(ob,0<na||na+S<ja?f.slice(ab,na,na+S):ab)||ob;if(oa){ab.__index=na+ob.__read;if(J=ob.__filtered)ab.__filtered=J,ob.__filtered=b;ob.__read=b}return ob},peek:function(ab,ob){return ab[ab.__index=ob||ab.__index||0]},remain:function(ab){return ab.length-(ab.__index||
0)},readList:function(ab,ob,J,S){var fa=[],oa;ob=ob||0;for(S=S?ob+S:ab.length;ob<S;ob++)fa.push(Array.isArray(oa=ab[ob])?this.read(oa,0,J):this.read(ab,ob,J,1));return fa},readNamed:function(ab,ob,J,S,fa){var oa=this.getNamed(ab,ob),na=oa!==b;if(na){var ja=ab.__filtered;if(!ja){var Ba=this.getSource(ab);ja=ab.__filtered=f.create(Ba);ja.__unfiltered=Ba}ja[ob]=b}return this.read(na?[oa]:ab,J,S,fa)},readSupported:function(ab,ob){var J=this.getSource(ab),S=this,fa=!1;J&&Object.keys(J).forEach(function(oa){if(oa in
ob){var na=S.readNamed(ab,oa);na!==b&&(ob[oa]=na);fa=!0}});return fa},getSource:function(ab){var ob=ab.__source;ob===b&&(ob=1===ab.length&&ab[0],ob=ab.__source=ob&&f.isPlainObject(ob)?ob:null);return ob},getNamed:function(ab,ob){var J=this.getSource(ab);if(J)return ob?J[ob]:ab.__filtered||J},hasNamed:function(ab,ob){return!!this.getNamed(ab,ob)},filter:function(ab,ob,J,S){function fa(Ya){if(!(J&&Ya in J||Ua&&Ya in Ua)){var K=ob[Ya];K!==b&&(ab[Ya]=K)}}if(S){for(var oa={},na=0,ja,Ba=S.length;na<Ba;na++)(ja=
S[na])in ob&&(fa(ja),oa[ja]=!0);var Ua=oa}Object.keys(ob.__unfiltered||ob).forEach(fa);return ab},isPlainValue:function(ab,ob){return f.isPlainObject(ab)||Array.isArray(ab)||ob&&"string"===typeof ab},serialize:function(ab,ob,J,S){ob=ob||{};var fa=!S;fa&&(ob.formatter=new r(ob.precision),S={length:0,definitions:{},references:{},add:function(Ya,K){var X="#"+Ya._id,Y=this.references[X];Y||(this.length++,K=K.call(Ya),(Ya=Ya._class)&&K[0]!==Ya&&K.unshift(Ya),this.definitions[X]=K,Y=this.references[X]=
[X]);return Y}});if(ab&&ab._serialize){var oa=ab._serialize(ob,S);ob=ab._class;!ob||ab._compactSerialize||!fa&&J||oa[0]===ob||oa.unshift(ob)}else if(Array.isArray(ab)){oa=[];for(var na=0,ja=ab.length;na<ja;na++)oa[na]=f.serialize(ab[na],ob,J,S)}else if(f.isPlainObject(ab)){oa={};var Ba=Object.keys(ab);na=0;for(ja=Ba.length;na<ja;na++){var Ua=Ba[na];oa[Ua]=f.serialize(ab[Ua],ob,J,S)}}else oa="number"===typeof ab?ob.formatter.number(ab,ob.precision):ab;return fa&&0<S.length?[["dictionary",S.definitions],
oa]:oa},deserialize:function(ab,ob,J,S,fa){var oa=ab,na=!J,ja=na&&ab&&ab.length&&"dictionary"===ab[0][0];J=J||{};if(Array.isArray(ab)){S=ab[0];var Ba="dictionary"===S;if(1==ab.length&&/^#/.test(S))return J.dictionary[S];S=f.exports[S];oa=[];for(var Ua=S?1:0,Ya=ab.length;Ua<Ya;Ua++)oa.push(f.deserialize(ab[Ua],ob,J,Ba,ja));S&&(ab=oa,oa=ob?ob(S,ab,na||fa):new S(ab))}else if(f.isPlainObject(ab))for(Ba in oa={},S&&(J.dictionary=oa),ab)oa[Ba]=f.deserialize(ab[Ba],ob,J);return ja?oa[1]:oa},exportJSON:function(ab,
ob){ab=f.serialize(ab,ob);return ob&&0==ob.asString?ab:JSON.stringify(ab)},importJSON:function(ab,ob){return f.deserialize("string"===typeof ab?JSON.parse(ab):ab,function(J,S,fa){var oa=(fa=fa&&ob&&ob.constructor===J)?ob:f.create(J.prototype);if(1===S.length&&oa instanceof P&&(fa||!(oa instanceof ua))){var na=S[0];f.isPlainObject(na)&&(na.insert=!1,fa&&(S=S.concat([{insert:!0}])))}(fa?oa.set:J).apply(oa,S);fa&&(ob=null);return oa})},push:function(ab,ob){var J=ob.length;if(4096>J)ab.push.apply(ab,
ob);else{var S=ab.length;ab.length+=J;for(var fa=0;fa<J;fa++)ab[S+fa]=ob[fa]}return ab},splice:function(ab,ob,J,S){var fa=ob&&ob.length,oa=J===b;J=oa?ab.length:J;J>ab.length&&(J=ab.length);for(var na=0;na<fa;na++)ob[na]._index=J+na;if(oa)return f.push(ab,ob),[];na=[J,S];ob&&f.push(na,ob);ob=ab.splice.apply(ab,na);na=0;for(S=ob.length;na<S;na++)ob[na]._index=b;na=J+fa;for(S=ab.length;na<S;na++)ab[na]._index=na;return ob},capitalize:function(ab){return ab.replace(/\b[a-z]/g,function(ob){return ob.toUpperCase()})},
camelize:function(ab){return ab.replace(/-(.)/g,function(ob,J){return J.toUpperCase()})},hyphenate:function(ab){return ab.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var h={on:function(ab,ob){if("string"!==typeof ab)f.each(ab,function(fa,oa){this.on(oa,fa)},this);else{var J=this._eventTypes;J=J&&J[ab];var S=this._callbacks=this._callbacks||{};S=S[ab]=S[ab]||[];-1===S.indexOf(ob)&&(S.push(ob),J&&J.install&&1===S.length&&J.install.call(this,ab))}return this},off:function(ab,ob){if("string"!==
typeof ab)f.each(ab,function(oa,na){this.off(na,oa)},this);else{var J=this._eventTypes;J=J&&J[ab];var S=this._callbacks&&this._callbacks[ab],fa;S&&(!ob||-1!==(fa=S.indexOf(ob))&&1===S.length?(J&&J.uninstall&&J.uninstall.call(this,ab),delete this._callbacks[ab]):-1!==fa&&S.splice(fa,1));return this}},once:function(ab,ob){return this.on(ab,function S(){ob.apply(this,arguments);this.off(ab,S)})},emit:function(ab,ob){var J=this._callbacks&&this._callbacks[ab];if(!J)return!1;var S=f.slice(arguments,1),
fa=ob&&ob.target&&!ob.currentTarget;J=J.slice();fa&&(ob.currentTarget=this);for(var oa=0,na=J.length;oa<na;oa++)if(0==J[oa].apply(this,S)){ob&&ob.stop&&ob.stop();break}fa&&delete ob.currentTarget;return!0},responds:function(ab){return!(!this._callbacks||!this._callbacks[ab])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(ab){var ob=this._eventTypes,J=this._callbacks;ab=ab?"install":"uninstall";if(ob)for(var S in J)if(0<J[S].length){var fa=ob[S];(fa=fa&&fa[ab])&&fa.call(this,S)}},
statics:{inject:function J(ob){var S=ob._events;if(S){var fa={};f.each(S,function(oa,na){var ja="string"===typeof oa,Ba=ja?oa:na;na=f.capitalize(Ba);var Ua=Ba.substring(2).toLowerCase();fa[Ua]=ja?{}:oa;Ba="_"+Ba;ob["get"+na]=function(){return this[Ba]};ob["set"+na]=function(Ya){var K=this[Ba];K&&this.off(Ua,K);if(Ya)this.on(Ua,Ya);this[Ba]=Ya}});ob._eventTypes=fa}return J.base.apply(this,arguments)}}},g=f.extend({_class:"PaperScope",initialize:function J(){ib=this;this.settings=new f({applyMatrix:!0,
insertItems:!0,handleSize:4,hitTolerance:0});this.project=null;this.projects=[];this.tools=[];this._id=J._id++;J._scopes[this._id]=this;var S=J.prototype;if(!this.support){var fa=Nb.getContext(1,1)||{};S.support={nativeDash:"setLineDash"in fa||"mozDash"in fa,nativeBlendModes:Rb.nativeModes};Nb.release(fa)}if(!this.agent){fa=a.navigator.userAgent.toLowerCase();var oa=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(fa)||[])[0];oa="darwin"===oa?"mac":oa;var na=S.agent=S.browser={platform:oa};oa&&(na[oa]=
!0);fa.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node|jsdom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv:v?([.\d]+))?/g,function(ja,Ba,Ua,Ya,K){na.chrome||(ja="opera"===Ba?Ya:/^(node|trident)$/.test(Ba)?K:Ua,na.version=ja,na.versionNumber=parseFloat(ja),Ba={trident:"msie",jsdom:"node"}[Ba]||Ba,na.name=Ba,na[Ba]=!0)});na.chrome&&delete na.webkit;na.atom&&delete na.chrome}},version:"0.12.4",getView:function(){var J=this.project;return J&&J._view},getPaper:function(){return this},
execute:function(){},install:function(J){var S=this;f.each(["project","view","tool"],function(oa){f.define(J,oa,{configurable:!0,get:function(){return S[oa]}})});for(var fa in this)!/^_/.test(fa)&&this[fa]&&(J[fa]=this[fa])},setup:function(J){ib=this;this.project=new qa(J);return this},createCanvas:function(J,S){return Nb.getCanvas(J,S)},activate:function(){ib=this},clear:function(){for(var J=this.projects,S=this.tools,fa=J.length-1;0<=fa;fa--)J[fa].remove();for(fa=S.length-1;0<=fa;fa--)S[fa].remove()},
remove:function(){this.clear();delete g._scopes[this._id]},statics:new function(){function J(S){S+="Attribute";return function(fa,oa){return fa[S](oa)||fa[S]("data-paper-"+oa)}}return{_scopes:{},_id:0,get:function(S){return this._scopes[S]||null},getAttribute:J("get"),hasAttribute:J("has")}}}),m=f.extend(h,{initialize:function(J){this._scope=ib;this._index=this._scope[this._list].push(this)-1;!J&&this._scope[this._reference]||this.activate()},activate:function(){if(!this._scope)return!1;var J=this._scope[this._reference];
J&&J!==this&&J.emit("deactivate");this._scope[this._reference]=this;this.emit("activate",J);return!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){if(null==this._index)return!1;f.splice(this._scope[this._list],null,this._index,1);this._scope[this._reference]==this&&(this._scope[this._reference]=null);this._scope=null;return!0},getView:function(){return this._scope.getView()}}),q={findItemBoundsCollisions:function(J,S,fa){function oa(ja){for(var Ba=Array(ja.length),
Ua=0;Ua<ja.length;Ua++){var Ya=ja[Ua].getBounds();Ba[Ua]=[Ya.left,Ya.top,Ya.right,Ya.bottom]}return Ba}var na=oa(J);J=S&&S!==J?oa(S):na;return this.findBoundsCollisions(na,J,fa||0)},findCurveBoundsCollisions:function(J,S,fa,oa){function na(Ba){for(var Ua=Math.min,Ya=Math.max,K=Array(Ba.length),X=0;X<Ba.length;X++){var Y=Ba[X];K[X]=[Ua(Y[0],Y[2],Y[4],Y[6]),Ua(Y[1],Y[3],Y[5],Y[7]),Ya(Y[0],Y[2],Y[4],Y[6]),Ya(Y[1],Y[3],Y[5],Y[7])]}return K}var ja=na(J);J=S&&S!==J?na(S):ja;if(oa){oa=this.findBoundsCollisions(ja,
J,fa||0,!1,!0);fa=this.findBoundsCollisions(ja,J,fa||0,!0,!0);ja=[];J=0;for(S=oa.length;J<S;J++)ja[J]={hor:oa[J],ver:fa[J]};return ja}return this.findBoundsCollisions(ja,J,fa||0)},findBoundsCollisions:function(J,S,fa,oa,na){function ja(Ha,Ma,Ta){for(var Ka=0,Wa=Ha.length;Ka<Wa;){var bb=Wa+Ka>>>1;Ua[Ha[bb]][Ma]<Ta?Ka=bb+1:Wa=bb}return Ka-1}var Ba=!S||J===S,Ua=Ba?J:J.concat(S),Ya=J.length,K=Ua.length,X=oa?1:0,Y=X+2,la=oa?0:1,sa=la+2,va=Array(K);for(oa=0;oa<K;oa++)va[oa]=oa;va.sort(function(Ha,Ma){return Ua[Ha][X]-
Ua[Ma][X]});var ba=[],ha=Array(Ya);for(oa=0;oa<K;oa++){var k=va[oa],p=Ua[k],A=Ba?k:k-Ya,H=k<Ya,O=Ba||!H,M=H?[]:null;if(ba.length){var R=ja(ba,Y,p[X]-fa)+1;ba.splice(0,R);if(Ba&&na)for(M=M.concat(ba),R=0;R<ba.length;R++){var W=ba[R];ha[W].push(A)}else{var ma=p[sa],wa=p[la];for(R=0;R<ba.length;R++){W=ba[R];var Da=Ua[W],Ea=W<Ya,Pa=Ba||W>=Ya;if(na||(H&&Pa||O&&Ea)&&ma>=Da[la]-fa&&wa<=Da[sa]+fa)H&&Pa&&M.push(Ba?W:W-Ya),O&&Ea&&ha[W].push(A)}}}H&&(J===S&&M.push(k),ha[k]=M);ba.length?(p=ja(ba,Y,p[Y]),ba.splice(p+
1,0,k)):ba.push(k)}for(oa=0;oa<ha.length;oa++)(J=ha[oa])&&J.sort(function(Ha,Ma){return Ha-Ma});return ha}},r=f.extend({initialize:function(J){this.precision=f.pick(J,5);this.multiplier=Math.pow(10,this.precision)},number:function(J){return 16>this.precision?Math.round(J*this.multiplier)/this.multiplier:J},pair:function(J,S,fa){return this.number(J)+(fa||",")+this.number(S)},point:function(J,S){return this.number(J.x)+(S||",")+this.number(J.y)},size:function(J,S){return this.number(J.width)+(S||",")+
this.number(J.height)},rectangle:function(J,S){return this.point(J,S)+(S||",")+this.size(J,S)}});r.instance=new r;var B=new function(){function J(K,X,Y){return K<X?X:K>Y?Y:K}function S(K,X,Y){function la(ha){var k=134217729*ha;k=ha-k+k;return[k,ha-k]}var sa=X*X-K*Y,va=X*X+K*Y;if(3*ja(sa)<va){sa=la(K);va=la(X);var ba=la(Y);X*=X;K*=Y;sa=X-K+(va[0]*va[0]-X+2*va[0]*va[1]+va[1]*va[1]-(sa[0]*ba[0]-K+sa[0]*ba[1]+sa[1]*ba[0]+sa[1]*ba[1]))}return sa}function fa(){var K=Math.max.apply(Math,arguments);return K&&
(1E-8>K||1E8<K)?Ua(2,-Math.round(Ya(K))):0}var oa=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,
.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,
.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],na=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],
[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,
.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,
.062253523938647894,.027152459411754096]],ja=Math.abs,Ba=Math.sqrt,Ua=Math.pow,Ya=Math.log2||function(K){return Math.log(K)*Math.LOG2E};return{EPSILON:1E-12,MACHINE_EPSILON:1.12E-16,CURVETIME_EPSILON:1E-8,GEOMETRIC_EPSILON:1E-7,TRIGONOMETRIC_EPSILON:1E-8,KAPPA:4*(Ba(2)-1)/3,isZero:function(K){return-1E-12<=K&&1E-12>=K},isMachineZero:function(K){return-1.12E-16<=K&&1.12E-16>=K},clamp:J,integrate:function(K,X,Y,la){var sa=oa[la-2],va=na[la-2];Y=.5*(Y-X);X=Y+X;var ba=0,ha=la+1>>1;for(la=la&1?va[ba++]*
K(X):0;ba<ha;){var k=Y*sa[ba];la+=va[ba++]*(K(X+k)+K(X-k))}return Y*la},findRoot:function(K,X,Y,la,sa,va,ba){for(var ha=0;ha<va;ha++){var k=K(Y),p=k/X(Y),A=Y-p;if(ja(p)<ba){Y=A;break}0<k?(sa=Y,Y=A<=la?.5*(la+sa):A):(la=Y,Y=A>=sa?.5*(la+sa):A)}return J(Y,la,sa)},solveQuadratic:function(K,X,Y,la,sa,va){var ba=Infinity;if(1E-12>ja(K)){if(1E-12>ja(X))return 1E-12>ja(Y)?-1:0;var ha=-Y/X}else{X*=-.5;var k=S(K,X,Y);if(k&&1.12E-16>ja(k)){var p=fa(ja(K),ja(X),ja(Y));p&&(K*=p,X*=p,Y*=p,k=S(K,X,Y))}-1.12E-16<=
k&&(ha=0>k?0:Ba(k),ba=X+(0>X?-ha:ha),0===ba?(ha=Y/K,ba=-ha):(ha=ba/K,ba=Y/ba))}K=0;Y=null==sa;X=sa-1E-12;k=va+1E-12;isFinite(ha)&&(Y||ha>X&&ha<k)&&(la[K++]=Y?ha:J(ha,sa,va));ba!==ha&&isFinite(ba)&&(Y||ba>X&&ba<k)&&(la[K++]=Y?ba:J(ba,sa,va));return K},solveCubic:function(K,X,Y,la,sa,va,ba){function ha(ma){M=ma;ma=K*M;H=ma+X;O=H*M+Y;p=(ma+H)*M+O;A=O*M+la}var k=fa(ja(K),ja(X),ja(Y),ja(la)),p,A;k&&(K*=k,X*=k,Y*=k,la*=k);if(1E-12>ja(K)){K=X;var H=Y;var O=la;var M=Infinity}else if(1E-12>ja(la))H=X,O=Y,
M=0;else{ha(-(X/K)/3);k=A/K;var R=Ua(ja(k),1/3);k=0>k?-1:1;var W=-p/K;R=0<W?1.324717957244746*Math.max(R,Ba(W)):R;R=M-k*R;if(R!==M){do ha(R),R=0===p?M:M-A/p/(1+1.12E-16);while(k*R>k*M);ja(K)*M*M>ja(la/M)&&(O=-la/M,H=(O-Y)/M)}}k=B.solveQuadratic(K,H,O,sa,va,ba);R=null==va;isFinite(M)&&(0===k||0<k&&M!==sa[0]&&M!==sa[1])&&(R||M>va-1E-12&&M<ba+1E-12)&&(sa[k++]=R?M:J(M,va,ba));return k}}},D={_id:1,_pools:{},get:function(J){if(J){var S=this._pools[J];S||=this._pools[J]={_id:1};return S._id++}return this._id++}},
F=f.extend({_class:"Point",_readIndex:!0,initialize:function(J,S){var fa=typeof J,oa=this.__read,na=0;"number"===fa?(fa="number"===typeof S,this._set(J,fa?S:J),oa&&(na=fa?2:1)):"undefined"===fa||null===J?(this._set(0,0),oa&&(na=null===J?1:0)):(J="string"===fa?J.split(/[\s,]+/)||[]:J,na=1,Array.isArray(J)?this._set(+J[0],+(1<J.length?J[1]:J[0])):"x"in J?this._set(J.x||0,J.y||0):"width"in J?this._set(J.width||0,J.height||0):"angle"in J?(this._set(J.length||0,0),this.setAngle(J.angle||0)):(this._set(0,
0),na=0));oa&&(this.__read=na);return this},set:"#initialize",_set:function(J,S){this.x=J;this.y=S;return this},equals:function(J){return this===J||J&&(this.x===J.x&&this.y===J.y||Array.isArray(J)&&this.x===J[0]&&this.y===J[1])||!1},clone:function(){return new F(this.x,this.y)},toString:function(){var J=r.instance;return"{ x: "+J.number(this.x)+", y: "+J.number(this.y)+" }"},_serialize:function(J){J=J.formatter;return[J.number(this.x),J.number(this.y)]},getLength:function(){return Math.sqrt(this.x*
this.x+this.y*this.y)},setLength:function(J){if(this.isZero()){var S=this._angle||0;this._set(Math.cos(S)*J,Math.sin(S)*J)}else J/=this.getLength(),B.isZero(J)&&this.getAngle(),this._set(this.x*J,this.y*J)},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(J){this.setAngleInRadians.call(this,J*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var J=F.read(arguments),S=this.getLength()*
J.getLength();if(B.isZero(S))return NaN;J=this.dot(J)/S;return Math.acos(-1>J?-1:1<J?1:J)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(J){this._angle=J;if(!this.isZero()){var S=this.getLength();this._set(Math.cos(J)*S,Math.sin(J)*S)}},getQuadrant:function(){return 0<=this.x?0<=this.y?1:4:0<=this.y?2:3}},{beans:!1,getDirectedAngle:function(){var J=F.read(arguments);return 180*Math.atan2(this.cross(J),this.dot(J))/Math.PI},getDistance:function(){var J=
arguments,S=F.read(J),fa=S.x-this.x;S=S.y-this.y;fa=fa*fa+S*S;return f.read(J)?fa:Math.sqrt(fa)},normalize:function(J){J===b&&(J=1);var S=this.getLength();J=0!==S?J/S:0;S=new F(this.x*J,this.y*J);0<=J&&(S._angle=this._angle);return S},rotate:function(J,S){if(0===J)return this.clone();J=J*Math.PI/180;var fa=S?this.subtract(S):this,oa=Math.sin(J);J=Math.cos(J);fa=new F(fa.x*J-fa.y*oa,fa.x*oa+fa.y*J);return S?fa.add(S):fa},transform:function(J){return J?J._transformPoint(this):this},add:function(){var J=
F.read(arguments);return new F(this.x+J.x,this.y+J.y)},subtract:function(){var J=F.read(arguments);return new F(this.x-J.x,this.y-J.y)},multiply:function(){var J=F.read(arguments);return new F(this.x*J.x,this.y*J.y)},divide:function(){var J=F.read(arguments);return new F(this.x/J.x,this.y/J.y)},modulo:function(){var J=F.read(arguments);return new F(this.x%J.x,this.y%J.y)},negate:function(){return new F(-this.x,-this.y)},isInside:function(){return V.read(arguments).contains(this)},isClose:function(){var J=
arguments,S=F.read(J);J=f.read(J);return this.getDistance(S)<=J},isCollinear:function(){var J=F.read(arguments);return F.isCollinear(this.x,this.y,J.x,J.y)},isColinear:"#isCollinear",isOrthogonal:function(){var J=F.read(arguments);return F.isOrthogonal(this.x,this.y,J.x,J.y)},isZero:function(){var J=B.isZero;return J(this.x)&&J(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(J){return 0<=this.x*(1<J&&4>J?-1:1)&&0<=this.y*(2<J?-1:1)},dot:function(){var J=F.read(arguments);
return this.x*J.x+this.y*J.y},cross:function(){var J=F.read(arguments);return this.x*J.y-this.y*J.x},project:function(){var J=F.read(arguments),S=J.isZero()?0:this.dot(J)/J.dot(J);return new F(J.x*S,J.y*S)},statics:{min:function(){var J=arguments,S=F.read(J);J=F.read(J);return new F(Math.min(S.x,J.x),Math.min(S.y,J.y))},max:function(){var J=arguments,S=F.read(J);J=F.read(J);return new F(Math.max(S.x,J.x),Math.max(S.y,J.y))},random:function(){return new F(Math.random(),Math.random())},isCollinear:function(J,
S,fa,oa){return Math.abs(J*oa-S*fa)<=1E-8*Math.sqrt((J*J+S*S)*(fa*fa+oa*oa))},isOrthogonal:function(J,S,fa,oa){return Math.abs(J*fa+S*oa)<=1E-8*Math.sqrt((J*J+S*S)*(fa*fa+oa*oa))}}},f.each(["round","ceil","floor","abs"],function(J){var S=Math[J];this[J]=function(){return new F(S(this.x),S(this.y))}},{})),G=F.extend({initialize:function(J,S,fa,oa){this._x=J;this._y=S;this._owner=fa;this._setter=oa},_set:function(J,S,fa){this._x=J;this._y=S;if(!fa)this._owner[this._setter](this);return this},getX:function(){return this._x},
setX:function(J){this._x=J;this._owner[this._setter](this)},getY:function(){return this._y},setY:function(J){this._y=J;this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(J){this._owner._changeSelection(this._getSelection(),J)},_getSelection:function(){return"setPosition"===this._setter?4:0}}),N=f.extend({_class:"Size",_readIndex:!0,initialize:function(J,S){var fa=typeof J,oa=this.__read,na=0;"number"===fa?(fa="number"===
typeof S,this._set(J,fa?S:J),oa&&(na=fa?2:1)):"undefined"===fa||null===J?(this._set(0,0),oa&&(na=null===J?1:0)):(J="string"===fa?J.split(/[\s,]+/)||[]:J,na=1,Array.isArray(J)?this._set(+J[0],+(1<J.length?J[1]:J[0])):"width"in J?this._set(J.width||0,J.height||0):"x"in J?this._set(J.x||0,J.y||0):(this._set(0,0),na=0));oa&&(this.__read=na);return this},set:"#initialize",_set:function(J,S){this.width=J;this.height=S;return this},equals:function(J){return J===this||J&&(this.width===J.width&&this.height===
J.height||Array.isArray(J)&&this.width===J[0]&&this.height===J[1])||!1},clone:function(){return new N(this.width,this.height)},toString:function(){var J=r.instance;return"{ width: "+J.number(this.width)+", height: "+J.number(this.height)+" }"},_serialize:function(J){J=J.formatter;return[J.number(this.width),J.number(this.height)]},add:function(){var J=N.read(arguments);return new N(this.width+J.width,this.height+J.height)},subtract:function(){var J=N.read(arguments);return new N(this.width-J.width,
this.height-J.height)},multiply:function(){var J=N.read(arguments);return new N(this.width*J.width,this.height*J.height)},divide:function(){var J=N.read(arguments);return new N(this.width/J.width,this.height/J.height)},modulo:function(){var J=N.read(arguments);return new N(this.width%J.width,this.height%J.height)},negate:function(){return new N(-this.width,-this.height)},isZero:function(){var J=B.isZero;return J(this.width)&&J(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},
statics:{min:function(J,S){return new N(Math.min(J.width,S.width),Math.min(J.height,S.height))},max:function(J,S){return new N(Math.max(J.width,S.width),Math.max(J.height,S.height))},random:function(){return new N(Math.random(),Math.random())}}},f.each(["round","ceil","floor","abs"],function(J){var S=Math[J];this[J]=function(){return new N(S(this.width),S(this.height))}},{})),T=N.extend({initialize:function(J,S,fa,oa){this._width=J;this._height=S;this._owner=fa;this._setter=oa},_set:function(J,S,
fa){this._width=J;this._height=S;if(!fa)this._owner[this._setter](this);return this},getWidth:function(){return this._width},setWidth:function(J){this._width=J;this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(J){this._height=J;this._owner[this._setter](this)}}),V=f.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(J,S,fa,oa){var na=arguments,ja=typeof J;if("number"===ja){this._set(J,S,fa,oa);var Ba=4}else"undefined"===ja||null===J?(this._set(0,
0,0,0),Ba=null===J?1:0):1===na.length&&(Array.isArray(J)?(this._set.apply(this,J),Ba=1):J.x!==b||J.width!==b?(this._set(J.x||0,J.y||0,J.width||0,J.height||0),Ba=1):J.from===b&&J.to===b&&(this._set(0,0,0,0),f.readSupported(na,this)&&(Ba=1)));if(Ba===b){ja=F.readNamed(na,"from");var Ua=f.peek(na);Ba=ja.x;ja=ja.y;if(Ua&&Ua.x!==b||f.hasNamed(na,"to")){var Ya=F.readNamed(na,"to");Ua=Ya.x-Ba;var K=Ya.y-ja;0>Ua&&(Ba=Ya.x,Ua=-Ua);0>K&&(ja=Ya.y,K=-K)}else K=N.read(na),Ua=K.width,K=K.height;this._set(Ba,ja,
Ua,K);Ba=na.__index}if(na=na.__filtered)this.__filtered=na;this.__read&&(this.__read=Ba);return this},set:"#initialize",_set:function(J,S,fa,oa){this.x=J;this.y=S;this.width=fa;this.height=oa;return this},clone:function(){return new V(this.x,this.y,this.width,this.height)},equals:function(J){var S=f.isPlainValue(J)?V.read(arguments):J;return S===this||S&&this.x===S.x&&this.y===S.y&&this.width===S.width&&this.height===S.height||!1},toString:function(){var J=r.instance;return"{ x: "+J.number(this.x)+
", y: "+J.number(this.y)+", width: "+J.number(this.width)+", height: "+J.number(this.height)+" }"},_serialize:function(J){J=J.formatter;return[J.number(this.x),J.number(this.y),J.number(this.width),J.number(this.height)]},getPoint:function(J){return new (J?F:G)(this.x,this.y,this,"setPoint")},setPoint:function(){var J=F.read(arguments);this.x=J.x;this.y=J.y},getSize:function(J){return new (J?N:T)(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var J=N.read(arguments),S=this._sx,
fa=this._sy,oa=J.width;J=J.height;S&&(this.x+=(this.width-oa)*S);fa&&(this.y+=(this.height-J)*fa);this.width=oa;this.height=J;this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(J){if(!this._fw){var S=J-this.x;this.width-=.5===this._sx?2*S:S}this.x=J;this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(J){if(!this._fh){var S=J-this.y;this.height-=.5===this._sy?2*S:S}this.y=J;this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(J){if(!this._fw){var S=
J-this.x;this.width=.5===this._sx?2*S:S}this.x=J-this.width;this._sx=1;this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(J){if(!this._fh){var S=J-this.y;this.height=.5===this._sy?2*S:S}this.y=J-this.height;this._sy=1;this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(J){this._fw||.5===this._sx?this.x=J-this.width/2:(this._sx&&(this.x+=2*(J-this.x)*this._sx),this.width=2*(J-this.x));this._sx=.5;this._fw=0},getCenterY:function(){return this.y+
this.height/2},setCenterY:function(J){this._fh||.5===this._sy?this.y=J-this.height/2:(this._sy&&(this.y+=2*(J-this.y)*this._sy),this.height=2*(J-this.y));this._sy=.5;this._fh=0},getCenter:function(J){return new (J?F:G)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var J=F.read(arguments);this.setCenterX(J.x);this.setCenterY(J.y);return this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(J){return J&&
J.width!==b||4===(Array.isArray(J)?J:arguments).length?this._containsRectangle(V.read(arguments)):this._containsPoint(F.read(arguments))},_containsPoint:function(J){var S=J.x;J=J.y;return S>=this.x&&J>=this.y&&S<=this.x+this.width&&J<=this.y+this.height},_containsRectangle:function(J){var S=J.x,fa=J.y;return S>=this.x&&fa>=this.y&&S+J.width<=this.x+this.width&&fa+J.height<=this.y+this.height},intersects:function(){var J=V.read(arguments),S=f.read(arguments)||0;return J.x+J.width>this.x-S&&J.y+J.height>
this.y-S&&J.x<this.x+this.width+S&&J.y<this.y+this.height+S},intersect:function(){var J=V.read(arguments),S=Math.max(this.x,J.x),fa=Math.max(this.y,J.y);return new V(S,fa,Math.min(this.x+this.width,J.x+J.width)-S,Math.min(this.y+this.height,J.y+J.height)-fa)},unite:function(){var J=V.read(arguments),S=Math.min(this.x,J.x),fa=Math.min(this.y,J.y);return new V(S,fa,Math.max(this.x+this.width,J.x+J.width)-S,Math.max(this.y+this.height,J.y+J.height)-fa)},include:function(){var J=F.read(arguments),S=Math.min(this.x,
J.x),fa=Math.min(this.y,J.y);return new V(S,fa,Math.max(this.x+this.width,J.x)-S,Math.max(this.y+this.height,J.y)-fa)},expand:function(){var J=N.read(arguments),S=J.width;J=J.height;return new V(this.x-S/2,this.y-J/2,this.width+S,this.height+J)},scale:function(J,S){return this.expand(this.width*J-this.width,this.height*(S===b?J:S)-this.height)}},f.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(J,
S){var fa=J.join(""),oa=/^[RL]/.test(fa);4<=S&&(J[1]+=oa?"Y":"X");S=J[oa?0:1];J=J[oa?1:0];var na="get"+S,ja="get"+J,Ba="set"+S,Ua="set"+J,Ya="set"+fa;this["get"+fa]=function(K){return new (K?F:G)(this[na](),this[ja](),this,Ya)};this[Ya]=function(){var K=F.read(arguments);this[Ba](K.x);this[Ua](K.y)}},{beans:!0})),E=V.extend({initialize:function(J,S,fa,oa,na,ja){this._set(J,S,fa,oa,!0);this._owner=na;this._setter=ja},_set:function(J,S,fa,oa,na){this._x=J;this._y=S;this._width=fa;this._height=oa;if(!na)this._owner[this._setter](this);
return this}},new function(){var J=V.prototype;return f.each(["x","y","width","height"],function(S){var fa=f.capitalize(S),oa="_"+S;this["get"+fa]=function(){return this[oa]};this["set"+fa]=function(na){this[oa]=na;if(!this._dontNotify)this._owner[this._setter](this)}},f.each("Point Size Center Left Top Right Bottom CenterX CenterY TopLeft TopRight BottomLeft BottomRight LeftCenter TopCenter RightCenter BottomCenter".split(" "),function(S){var fa="set"+S;this[fa]=function(){this._dontNotify=!0;J[fa].apply(this,
arguments);this._dontNotify=!1;this._owner[this._setter](this)}},{isSelected:function(){return!!(this._owner._selection&2)},setSelected:function(S){var fa=this._owner;fa._changeSelection&&fa._changeSelection(2,S)}}))}),Q=f.extend({_class:"Matrix",initialize:function oa(S,fa){var na=arguments,ja=na.length,Ba=!0;6<=ja?this._set.apply(this,na):1===ja||2===ja?S instanceof oa?this._set(S._a,S._b,S._c,S._d,S._tx,S._ty,fa):Array.isArray(S)?this._set.apply(this,fa?S.concat([fa]):S):Ba=!1:ja?Ba=!1:this.reset();
if(!Ba)throw Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(S,fa,oa,na,ja,Ba,Ua){this._a=S;this._b=fa;this._c=oa;this._d=na;this._tx=ja;this._ty=Ba;Ua||this._changed();return this},_serialize:function(S,fa){return f.serialize(this.getValues(),S,!0,fa)},_changed:function(){var S=this._owner;S&&(S._applyMatrix?S.transform(null,!0):S._changed(25))},clone:function(){return new Q(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(S){return S===this||
S&&this._a===S._a&&this._b===S._b&&this._c===S._c&&this._d===S._d&&this._tx===S._tx&&this._ty===S._ty},toString:function(){var S=r.instance;return"[["+[S.number(this._a),S.number(this._c),S.number(this._tx)].join(", ")+"], ["+[S.number(this._b),S.number(this._d),S.number(this._ty)].join(", ")+"]]"},reset:function(S){this._a=this._d=1;this._b=this._c=this._tx=this._ty=0;S||this._changed();return this},apply:function(S,fa){var oa=this._owner;return oa?(oa.transform(null,f.pick(S,!0),fa),this.isIdentity()):
!1},translate:function(){var S=F.read(arguments),fa=S.x;S=S.y;this._tx+=fa*this._a+S*this._c;this._ty+=fa*this._b+S*this._d;this._changed();return this},scale:function(){var S=arguments,fa=F.read(S);(S=F.read(S,0,{readNull:!0}))&&this.translate(S);this._a*=fa.x;this._b*=fa.x;this._c*=fa.y;this._d*=fa.y;S&&this.translate(S.negate());this._changed();return this},rotate:function(S){S*=Math.PI/180;var fa=F.read(arguments,1),oa=fa.x,na=fa.y;fa=Math.cos(S);var ja=Math.sin(S),Ba=oa-oa*fa+na*ja;oa=na-oa*
ja-na*fa;na=this._a;var Ua=this._b,Ya=this._c,K=this._d;this._a=fa*na+ja*Ya;this._b=fa*Ua+ja*K;this._c=-ja*na+fa*Ya;this._d=-ja*Ua+fa*K;this._tx+=Ba*na+oa*Ya;this._ty+=Ba*Ua+oa*K;this._changed();return this},shear:function(){var S=arguments,fa=F.read(S);(S=F.read(S,0,{readNull:!0}))&&this.translate(S);var oa=this._a,na=this._b;this._a+=fa.y*this._c;this._b+=fa.y*this._d;this._c+=fa.x*oa;this._d+=fa.x*na;S&&this.translate(S.negate());this._changed();return this},skew:function(){var S=arguments,fa=
F.read(S);S=F.read(S,0,{readNull:!0});var oa=Math.PI/180;fa=new F(Math.tan(fa.x*oa),Math.tan(fa.y*oa));return this.shear(fa,S)},append:function(S,fa){if(S){var oa=this._a,na=this._b,ja=this._c,Ba=this._d,Ua=S._a,Ya=S._c,K=S._b,X=S._d,Y=S._tx;S=S._ty;this._a=Ua*oa+K*ja;this._c=Ya*oa+X*ja;this._b=Ua*na+K*Ba;this._d=Ya*na+X*Ba;this._tx+=Y*oa+S*ja;this._ty+=Y*na+S*Ba;fa||this._changed()}return this},prepend:function(S,fa){if(S){var oa=this._a,na=this._b,ja=this._c,Ba=this._d,Ua=this._tx,Ya=this._ty,K=
S._a,X=S._c,Y=S._b,la=S._d,sa=S._tx;S=S._ty;this._a=K*oa+X*na;this._c=K*ja+X*Ba;this._b=Y*oa+la*na;this._d=Y*ja+la*Ba;this._tx=K*Ua+X*Ya+sa;this._ty=Y*Ua+la*Ya+S;fa||this._changed()}return this},appended:function(S){return this.clone().append(S)},prepended:function(S){return this.clone().prepend(S)},invert:function(){var S=this._a,fa=this._b,oa=this._c,na=this._d,ja=this._tx,Ba=this._ty,Ua=S*na-fa*oa,Ya=null;Ua&&!isNaN(Ua)&&isFinite(ja)&&isFinite(Ba)&&(this._a=na/Ua,this._b=-fa/Ua,this._c=-oa/Ua,
this._d=S/Ua,this._tx=(oa*Ba-na*ja)/Ua,this._ty=(fa*ja-S*Ba)/Ua,Ya=this);return Ya},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new Q(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return 1===this._a&&0===this._b&&0===this._c&&1===this._d&&0===this._tx&&0===this._ty},isInvertible:function(){var S=this._a*this._d-this._c*
this._b;return S&&!isNaN(S)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(S,fa,oa){return 3>arguments.length?this._transformPoint(F.read(arguments)):this._transformCoordinates(S,fa,oa)},_transformPoint:function(S,fa,oa){var na=S.x;S=S.y;fa||=new F;return fa._set(na*this._a+S*this._c+this._tx,na*this._b+S*this._d+this._ty,oa)},_transformCoordinates:function(S,fa,oa){var na=0;for(oa*=2;na<oa;na+=2){var ja=S[na],Ba=S[na+1];fa[na]=ja*this._a+
Ba*this._c+this._tx;fa[na+1]=ja*this._b+Ba*this._d+this._ty}return fa},_transformCorners:function(S){var fa=S.x,oa=S.y,na=fa+S.width;S=oa+S.height;fa=[fa,oa,na,oa,na,S,fa,S];return this._transformCoordinates(fa,fa,4)},_transformBounds:function(S,fa,oa){S=this._transformCorners(S);for(var na=S.slice(0,2),ja=na.slice(),Ba=2;8>Ba;Ba++){var Ua=S[Ba],Ya=Ba&1;Ua<na[Ya]?na[Ya]=Ua:Ua>ja[Ya]&&(ja[Ya]=Ua)}fa||=new V;return fa._set(na[0],na[1],ja[0]-na[0],ja[1]-na[1],oa)},inverseTransform:function(){return this._inverseTransform(F.read(arguments))},
_inverseTransform:function(S,fa,oa){var na=this._a,ja=this._b,Ba=this._c,Ua=this._d,Ya=this._tx,K=this._ty,X=na*Ua-ja*Ba,Y=null;X&&!isNaN(X)&&isFinite(Ya)&&isFinite(K)&&(Ya=S.x-this._tx,S=S.y-this._ty,fa||=new F,Y=fa._set((Ya*Ua-S*Ba)/X,(S*na-Ya*ja)/X,oa));return Y},decompose:function(){var S=this._a,fa=this._b,oa=this._c,na=this._d,ja=S*na-fa*oa,Ba=Math.sqrt,Ua=Math.atan2,Ya=180/Math.PI;if(0!==S||0!==fa){var K=Ba(S*S+fa*fa);Ba=Math.acos(S/K)*(0<fa?1:-1);ja=[K,ja/K];S=[Ua(S*oa+fa*na,K*K),0]}else 0!==
oa||0!==na?(K=Ba(oa*oa+na*na),Ba=Math.asin(oa/K)*(0<na?1:-1),ja=[ja/K,K],S=[0,Ua(S*oa+fa*na,K*K)]):(Ba=0,S=ja=[0,0]);return{translation:this.getTranslation(),rotation:Ba*Ya,scaling:new F(ja),skewing:new F(S[0]*Ya,S[1]*Ya)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new F(this._tx,this._ty)},getScaling:function(){return this.decompose().scaling},getRotation:function(){return this.decompose().rotation},applyToContext:function(S){this.isIdentity()||
S.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},f.each("a b c d tx ty".split(" "),function(S){var fa=f.capitalize(S),oa="_"+S;this["get"+fa]=function(){return this[oa]};this["set"+fa]=function(na){this[oa]=na;this._changed()}},{})),aa=f.extend({_class:"Line",initialize:function(S,fa,oa,na,ja){if(4<=arguments.length){this._px=S;this._py=fa;this._vx=oa;this._vy=na;var Ba=ja}else this._px=S.x,this._py=S.y,this._vx=fa.x,this._vy=fa.y,Ba=oa;Ba||(this._vx-=this._px,this._vy-=this._py)},
getPoint:function(){return new F(this._px,this._py)},getVector:function(){return new F(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(S,fa){return aa.intersect(this._px,this._py,this._vx,this._vy,S._px,S._py,S._vx,S._vy,!0,fa)},getSide:function(S,fa){return aa.getSide(this._px,this._py,this._vx,this._vy,S.x,S.y,!0,fa)},getDistance:function(S){return Math.abs(this.getSignedDistance(S))},getSignedDistance:function(S){return aa.getSignedDistance(this._px,
this._py,this._vx,this._vy,S.x,S.y,!0)},isCollinear:function(S){return F.isCollinear(this._vx,this._vy,S._vx,S._vy)},isOrthogonal:function(S){return F.isOrthogonal(this._vx,this._vy,S._vx,S._vy)},statics:{intersect:function(S,fa,oa,na,ja,Ba,Ua,Ya,K,X){K||(oa-=S,na-=fa,Ua-=ja,Ya-=Ba);K=oa*Ya-na*Ua;if(!B.isMachineZero(K)&&(ja=S-ja,Ba=fa-Ba,Ua=(Ua*Ba-Ya*ja)/K,Ya=(oa*Ba-na*ja)/K,K=1+1E-12,X||-1E-12<Ua&&Ua<K&&-1E-12<Ya&&Ya<K))return X||(Ua=0>=Ua?0:1<=Ua?1:Ua),new F(S+Ua*oa,fa+Ua*na)},getSide:function(S,
fa,oa,na,ja,Ba,Ua,Ya){Ua||(oa-=S,na-=fa);S=ja-S;fa=S*na-(Ba-fa)*oa;!Ya&&B.isMachineZero(fa)&&(fa=(S*oa+S*oa)/(oa*oa+na*na),0<=fa&&1>=fa&&(fa=0));return 0>fa?-1:0<fa?1:0},getSignedDistance:function(S,fa,oa,na,ja,Ba,Ua){Ua||(oa-=S,na-=fa);return 0===oa?0<na?ja-S:S-ja:0===na?0>oa?Ba-fa:fa-Ba:((ja-S)*na-(Ba-fa)*oa)/(na>oa?na*Math.sqrt(1+oa*oa/(na*na)):oa*Math.sqrt(1+na*na/(oa*oa)))},getDistance:function(S,fa,oa,na,ja,Ba,Ua){return Math.abs(aa.getSignedDistance(S,fa,oa,na,ja,Ba,Ua))}}}),qa=m.extend({_class:"Project",
_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(S){m.call(this,!0);this._children=[];this._namedChildren={};this._activeLayer=null;this._currentStyle=new Qa(null,null,this);this._view=ub.create(this,S||Nb.getCanvas(1,1));this._selectionItems={};this._updateVersion=this._selectionCount=0},_serialize:function(S,fa){return f.serialize(this._children,S,!0,fa)},_changed:function(S,fa){if(S&1){var oa=this._view;oa&&(oa._needsUpdate=!0,!oa._requested&&oa._autoUpdate&&oa.requestUpdate())}if((oa=
this._changes)&&fa){var na=this._changesById,ja=fa._id,Ba=na[ja];Ba?Ba.flags|=S:oa.push(na[ja]={item:fa,flags:S})}},clear:function(){for(var S=this._children,fa=S.length-1;0<=fa;fa--)S[fa].remove()},isEmpty:function(){return!this._children.length},remove:function fa(){if(!fa.base.call(this))return!1;this._view&&this._view.remove();return!0},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(fa){this._currentStyle.set(fa)},getIndex:function(){return this._index},
getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new ua({project:this,insert:!0})},getSymbolDefinitions:function(){var fa=[],oa={};this.getItems({class:ra,match:function(na){na=na._definition;var ja=na._id;oa[ja]||(oa[ja]=!0,fa.push(na));return!1}});return fa},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var fa=this._selectionItems,oa=[],na;for(na in fa){var ja=fa[na],Ba=ja._selection;
Ba&1&&ja.isInserted()?oa.push(ja):Ba||this._updateSelection(ja)}return oa},_updateSelection:function(fa){var oa=fa._id,na=this._selectionItems;fa._selection?na[oa]!==fa&&(this._selectionCount++,na[oa]=fa):na[oa]===fa&&(this._selectionCount--,delete na[oa])},selectAll:function(){for(var fa=this._children,oa=0,na=fa.length;oa<na;oa++)fa[oa].setFullySelected(!0)},deselectAll:function(){var fa=this._selectionItems,oa;for(oa in fa)fa[oa].setFullySelected(!1)},addLayer:function(fa){return this.insertLayer(b,
fa)},insertLayer:function(fa,oa){oa instanceof ua?(oa._remove(!1,!0),f.splice(this._children,[oa],fa,0),oa._setProject(this,!0),(fa=oa._name)&&oa.setName(fa),this._changes&&oa._changed(5),this._activeLayer||(this._activeLayer=oa)):oa=null;return oa},_insertItem:function(fa,oa,na){oa=this.insertLayer(fa,oa)||(this._activeLayer||this._insertItem(b,new ua(P.NO_INSERT),!0)).insertChild(fa,oa);na&&oa.activate&&oa.activate();return oa},getItems:function(fa){return P._getItems(this,fa)},getItem:function(fa){return P._getItems(this,
fa,null,null,!0)[0]||null},importJSON:function(fa){this.activate();var oa=this._activeLayer;return f.importJSON(fa,oa&&oa.isEmpty()&&oa)},removeOn:function(fa){var oa=this._removeSets;if(oa){"mouseup"===fa&&(oa.mousedrag=null);var na=oa[fa];if(na){for(var ja in na){var Ba=na[ja],Ua;for(Ua in oa){var Ya=oa[Ua];Ya&&Ya!=na&&delete Ya[Ba._id]}Ba.remove()}oa[fa]=null}}},draw:function(fa,oa,na){this._updateVersion++;fa.save();oa.applyToContext(fa);var ja=this._children;na=new f({offset:new F(0,0),pixelRatio:na,
viewMatrix:oa.isIdentity()?null:oa,matrices:[new Q],updateMatrix:!0});for(var Ba=0,Ua=ja.length;Ba<Ua;Ba++)ja[Ba].draw(fa,na);fa.restore();if(0<this._selectionCount){fa.save();fa.strokeWidth=1;ja=this._selectionItems;na=this._scope.settings.handleSize;Ba=this._updateVersion;for(var Ya in ja)ja[Ya]._drawSelection(fa,oa,na,ja,Ba);fa.restore()}}}),P=f.extend(h,{statics:{extend:function na(oa){oa._serializeFields&&(oa._serializeFields=f.set({},this.prototype._serializeFields,oa._serializeFields));return na.base.apply(this,
arguments)},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new Q,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var oa="onMouseDown onMouseUp onMouseDrag onClick onDoubleClick onMouseMove onMouseEnter onMouseLeave".split(" ");
return f.each(oa,function(na){this._events[na]={install:function(ja){this.getView()._countItemEvent(ja,1)},uninstall:function(ja){this.getView()._countItemEvent(ja,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:oa}})},{initialize:function(){},_initialize:function(oa,na){var ja=oa&&f.isPlainObject(oa),Ba=ja&&!0===oa.internal,Ua=this._matrix=new Q,Ya=ja&&oa.project||
ib.project,K=ib.settings;this._id=Ba?null:D.get();this._parent=this._index=null;this._applyMatrix=this._canApplyMatrix&&K.applyMatrix;na&&Ua.translate(na);Ua._owner=this;this._style=new Qa(Ya._currentStyle,this,Ya);Ba||ja&&0==oa.insert||!(K.insertItems||ja&&!0===oa.insert)?this._setProject(Ya):(ja&&oa.parent||Ya)._insertItem(b,this,!0);ja&&oa!==P.NO_INSERT&&this.set(oa,{internal:!0,insert:!0,project:!0,parent:!0});return ja},_serialize:function(oa,na){function ja(Ya){for(var K in Ya){var X=Ua[K];
f.equals(X,"leading"===K?1.2*Ya.fontSize:Ya[K])||(Ba[K]=f.serialize(X,oa,"data"!==K,na))}}var Ba={},Ua=this;ja(this._serializeFields);this instanceof ea||ja(this._style._defaults);return[this._class,Ba]},_changed:function(oa){var na=this._symbol,ja=this._parent||na,Ba=this._project;oa&8&&(this._bounds=this._position=this._decomposed=b);oa&16&&(this._globalMatrix=b);ja&&oa&72&&P._clearBoundsCache(ja);oa&2&&P._clearBoundsCache(this);Ba&&Ba._changed(oa,this);na&&na._changed(oa)},getId:function(){return this._id},
getName:function(){return this._name},setName:function(oa){this._name&&this._removeNamed();if(oa===+oa+"")throw Error("Names consisting only of numbers are not supported.");var na=this._getOwner();if(oa&&na){var ja=na._children;na=na._namedChildren;(na[oa]=na[oa]||[]).push(this);oa in ja||(ja[oa]=this)}this._name=oa||b;this._changed(256)},getStyle:function(){return this._style},setStyle:function(oa){this.getStyle().set(oa)}},f.each(["locked","visible","blendMode","opacity","guide"],function(oa){var na=
f.capitalize(oa),ja="_"+oa,Ba={locked:256,visible:265};this["get"+na]=function(){return this[ja]};this["set"+na]=function(Ua){Ua!=this[ja]&&(this[ja]=Ua,this._changed(Ba[oa]||257))}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(oa){oa!==this._selection&&(this._selection=oa,oa=this._project)&&(oa._updateSelection(this),this._changed(257))},_changeSelection:function(oa,na){var ja=this._selection;this.setSelection(na?ja|oa:ja&~oa)},isSelected:function(){if(this._selectChildren)for(var oa=
this._children,na=0,ja=oa.length;na<ja;na++)if(oa[na].isSelected())return!0;return!!(this._selection&1)},setSelected:function(oa){if(this._selectChildren)for(var na=this._children,ja=0,Ba=na.length;ja<Ba;ja++)na[ja].setSelected(oa);this._changeSelection(1,oa)},isFullySelected:function(){var oa=this._children,na=!!(this._selection&1);if(oa&&na){na=0;for(var ja=oa.length;na<ja;na++)if(!oa[na].isFullySelected())return!1;return!0}return na},setFullySelected:function(oa){var na=this._children;if(na)for(var ja=
0,Ba=na.length;ja<Ba;ja++)na[ja].setFullySelected(oa);this._changeSelection(1,oa)},isClipMask:function(){return this._clipMask},setClipMask:function(oa){if(this._clipMask!=(oa=!!oa)){if(this._clipMask=oa)this.setFillColor(null),this.setStrokeColor(null);this._changed(257);this._parent&&this._parent._changed(2048)}},getData:function(){this._data||(this._data={});return this._data},setData:function(oa){this._data=oa},getPosition:function(oa){oa=oa?F:G;var na=this._position||(this._position=this._getPositionFromBounds());
return new oa(na.x,na.y,this,"setPosition")},setPosition:function(){this.translate(F.read(arguments).subtract(this.getPosition(!0)))},_getPositionFromBounds:function(oa){return this._pivot?this._matrix._transformPoint(this._pivot):(oa||this.getBounds()).getCenter(!0)},getPivot:function(){var oa=this._pivot;return oa?new G(oa.x,oa.y,this,"setPivot"):null},setPivot:function(){this._pivot=F.read(arguments,0,{clone:!0,readNull:!0});this._position=b}},f.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},
getInternalBounds:{internal:!0}},function(oa,na){this[na]=function(ja){return this.getBounds(ja,oa)}},{beans:!0,getBounds:function(oa,na){var ja=na||oa instanceof Q,Ba=f.set({},ja?na:oa,this._boundsOptions);if(!Ba.stroke||this.getStrokeScaling())Ba.cacheItem=this;ja=this._getCachedBounds(ja&&oa,Ba).rect;return arguments.length?ja:new E(ja.x,ja.y,ja.width,ja.height,this,"setBounds")},setBounds:function(){var oa=V.read(arguments),na=this.getBounds(),ja=this._matrix,Ba=new Q,Ua=oa.getCenter();Ba.translate(Ua);
if(oa.width!=na.width||oa.height!=na.height)ja.isInvertible()||(ja.set(ja._backup||(new Q).translate(ja.getTranslation())),na=this.getBounds()),Ba.scale(0!==na.width?oa.width/na.width:0,0!==na.height?oa.height/na.height:0);Ua=na.getCenter();Ba.translate(-Ua.x,-Ua.y);this.transform(Ba)},_getBounds:function(oa,na){var ja=this._children;if(!ja||!ja.length)return new V;P._updateBoundsCache(this,na.cacheItem);return P._getBounds(ja,oa,na)},_getBoundsCacheKey:function(oa,na){return[oa.stroke?1:0,oa.handle?
1:0,na?1:0].join("")},_getCachedBounds:function(oa,na,ja){oa=oa&&oa._orNullIfIdentity();ja=na.internal&&!ja;var Ba=na.cacheItem,Ua=ja?null:this._matrix._orNullIfIdentity(),Ya=Ba&&(!oa||oa.equals(Ua))&&this._getBoundsCacheKey(na,ja),K=this._bounds;P._updateBoundsCache(this._parent||this._symbol,Ba);if(Ya&&K&&Ya in K)return ja=K[Ya],{rect:ja.rect.clone(),nonscaling:ja.nonscaling};na=this._getBounds(oa||Ua,na);oa=na.rect||na;Ba=this._style;na=na.nonscaling||Ba.hasStroke()&&!Ba.getStrokeScaling();Ya&&
(K||(this._bounds=K={}),K[Ya]={rect:oa.clone(),nonscaling:na,internal:ja});return{rect:oa,nonscaling:na}},_getStrokeMatrix:function(oa,na){return(oa=(na=this.getStrokeScaling()?null:na&&na.internal?this:this._parent||this._symbol&&this._symbol._item)?na.getViewMatrix().invert():oa)&&oa._shiftless()},statics:{_updateBoundsCache:function(oa,na){if(oa&&na){var ja=na._id;oa=oa._boundsCache=oa._boundsCache||{ids:{},list:[]};oa.ids[ja]||(oa.list.push(na),oa.ids[ja]=na)}},_clearBoundsCache:function(oa){var na=
oa._boundsCache;if(na){oa._bounds=oa._position=oa._boundsCache=b;var ja=0;na=na.list;for(var Ba=na.length;ja<Ba;ja++){var Ua=na[ja];Ua!==oa&&(Ua._bounds=Ua._position=b,Ua._boundsCache&&P._clearBoundsCache(Ua))}}},_getBounds:function(oa,na,ja){var Ba=Infinity,Ua=-Ba,Ya=Ba,K=Ua,X=!1;ja=ja||{};for(var Y=0,la=oa.length;Y<la;Y++){var sa=oa[Y];if(sa._visible&&!sa.isEmpty(!0)){sa=sa._getCachedBounds(na&&na.appended(sa._matrix),ja,!0);var va=sa.rect;Ba=Math.min(va.x,Ba);Ya=Math.min(va.y,Ya);Ua=Math.max(va.x+
va.width,Ua);K=Math.max(va.y+va.height,K);sa.nonscaling&&(X=!0)}}return{rect:isFinite(Ba)?new V(Ba,Ya,Ua-Ba,K-Ya):new V,nonscaling:X}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var oa=this._decompose();return oa?oa.rotation:0},setRotation:function(oa){var na=this.getRotation();if(null!=na&&null!=oa){var ja=this._decomposed;this.rotate(oa-na);ja&&(ja.rotation=oa,this._decomposed=ja)}},getScaling:function(){var oa=
this._decompose();oa=oa&&oa.scaling;return new G(oa?oa.x:1,oa?oa.y:1,this,"setScaling")},setScaling:function(){var oa=this.getScaling(),na=F.read(arguments,0,{clone:!0,readNull:!0});if(oa&&na&&!oa.equals(na)){var ja=this.getRotation(),Ba=this._decomposed,Ua=new Q,Ya=this.getPosition(!0);Ua.translate(Ya);ja&&Ua.rotate(ja);Ua.scale(na.x/oa.x,na.y/oa.y);ja&&Ua.rotate(-ja);Ua.translate(Ya.negate());this.transform(Ua);Ba&&(Ba.scaling=na,this._decomposed=Ba)}},getMatrix:function(){return this._matrix},
setMatrix:function(){var oa=this._matrix;oa.initialize.apply(oa,arguments)},getGlobalMatrix:function(oa){var na=this._globalMatrix;if(na)for(var ja=this._parent,Ba=[];ja;){if(!ja._globalMatrix){na=null;ja=0;for(var Ua=Ba.length;ja<Ua;ja++)Ba[ja]._globalMatrix=null;break}Ba.push(ja);ja=ja._parent}na||(na=this._globalMatrix=this._matrix.clone(),(ja=this._parent)&&na.prepend(ja.getGlobalMatrix(!0)));return oa?na:na.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},
getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(oa){(this._applyMatrix=this._canApplyMatrix&&!!oa)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(oa,na){if(this._project!==oa){this._project&&this._installEvents(!1);this._project=oa;na=this._children;for(var ja=0,Ba=na&&na.length;ja<Ba;ja++)na[ja]._setProject(oa);na=!0}na&&this._installEvents(!0)},getView:function(){return this._project._view},
_installEvents:function ja(na){ja.base.call(this,na);for(var Ba=this._children,Ua=0,Ya=Ba&&Ba.length;Ua<Ya;Ua++)Ba[Ua]._installEvents(na)},getLayer:function(){for(var na=this;na=na._parent;)if(na instanceof ua)return na;return null},getParent:function(){return this._parent},setParent:function(na){return na.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(na){this.removeChildren();this.addChildren(na)},getFirstChild:function(){return this._children&&
this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var na=this._getOwner();return na&&na._children[this._index+1]||null},getPreviousSibling:function(){var na=this._getOwner();return na&&na._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(na){return na===this||na&&this._class===na._class&&this._style.equals(na._style)&&this._matrix.equals(na._matrix)&&this._locked===
na._locked&&this._visible===na._visible&&this._blendMode===na._blendMode&&this._opacity===na._opacity&&this._clipMask===na._clipMask&&this._guide===na._guide&&this._equals(na)||!1},_equals:function(na){return f.equals(this._children,na._children)},clone:function(na){var ja=new this.constructor(P.NO_INSERT),Ba=this._children,Ua=f.pick(na?na.insert:b,na===b||!0===na);na=f.pick(na?na.deep:b,!0);Ba&&ja.copyAttributes(this);Ba&&!na||ja.copyContent(this);Ba||ja.copyAttributes(this);Ua&&ja.insertAbove(this);
Ua=this._name;Ba=this._parent;if(Ua&&Ba){Ba=Ba._children;na=Ua;for(var Ya=1;Ba[Ua];)Ua=na+" "+Ya++;Ua!==na&&ja.setName(Ua)}return ja},copyContent:function(na){na=na._children;for(var ja=0,Ba=na&&na.length;ja<Ba;ja++)this.addChild(na[ja].clone(!1),!0)},copyAttributes:function(na,ja){this.setStyle(na._style);for(var Ba="_locked _visible _blendMode _opacity _clipMask _guide".split(" "),Ua=0,Ya=Ba.length;Ua<Ya;Ua++){var K=Ba[Ua];na.hasOwnProperty(K)&&(this[K]=na[K])}ja||this._matrix.set(na._matrix,!0);
this.setApplyMatrix(na._applyMatrix);this.setPivot(na._pivot);this.setSelection(na._selection);ja=na._data;na=na._name;this._data=ja?f.clone(ja):null;na&&this.setName(na)},rasterize:function(na,ja){var Ba=this.getStrokeBounds();na=(na||this.getView().getResolution())/72;var Ua=Ba.getTopLeft().floor();Ba=Ba.getBottomRight().ceil();Ba=new N(Ba.subtract(Ua));var Ya=new pa(P.NO_INSERT);if(!Ba.isZero()){var K=Nb.getCanvas(Ba.multiply(na)),X=K.getContext("2d"),Y=(new Q).scale(na).translate(Ua.negate());
X.save();Y.applyToContext(X);this.draw(X,new f({matrices:[Y]}));X.restore();Ya.setCanvas(K)}Ya.transform((new Q).translate(Ua.add(Ba.divide(2))).scale(1/na));(ja===b||ja)&&Ya.insertAbove(this);return Ya},contains:function(){var na=this._matrix;return na.isInvertible()&&!!this._contains(na._inverseTransform(F.read(arguments)))},_contains:function(na){var ja=this._children;if(ja){for(var Ba=ja.length-1;0<=Ba;Ba--)if(ja[Ba].contains(na))return!0;return!1}return na.isInside(this.getInternalBounds())},
isInside:function(){return V.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new Ia.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(na,ja){return na instanceof P?0<this._asPathItem().getIntersections(na._asPathItem(),null,ja,!0).length:!1}},new function(){function na(){var Ua=arguments;return this._hitTest(F.read(Ua),Ga.getOptions(Ua))}function ja(){var Ua=arguments,Ya=F.read(Ua);Ua=Ga.getOptions(Ua);var K=[];this._hitTest(Ya,
new f({all:K},Ua));return K}function Ba(Ua,Ya,K,X){var Y=this._children;if(Y)for(var la=Y.length-1;0<=la;la--){var sa=Y[la];if((sa=sa!==X&&sa._hitTest(Ua,Ya,K))&&!Ya.all)return sa}return null}qa.inject({hitTest:na,hitTestAll:ja,_hitTest:Ba});return{hitTest:na,hitTestAll:ja,_hitTestChildren:Ba}},{_hitTest:function(na,ja,Ba){function Ua(A){A&&la&&!la(A)&&(A=null);A&&ja.all&&ja.all.push(A);return A}function Ya(A,H){var O=H?k["get"+H]():sa.getPosition();if(1>=na.subtract(O).divide(X).length)return new Ga(A,
sa,{name:H?f.hyphenate(H):A,point:O})}if(this._locked||!this._visible||this._guide&&!ja.guides||this.isEmpty())return null;var K=this._matrix;Ba=Ba?Ba.appended(K):this.getGlobalMatrix().prepend(this.getView()._matrix);var X=ja._tolerancePadding=new N(Ia._getStrokePadding(Math.max(ja.tolerance,1E-12),K._shiftless().invert()));na=K._inverseTransform(na);if(!na||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(X.multiply(2))._containsPoint(na))return null;var Y=!(ja.guides&&
!this._guide||ja.selected&&!this.isSelected()||ja.type&&ja.type!==f.hyphenate(this._class)||ja.class&&!(this instanceof ja.class)),la=ja.match,sa=this,va=ja.position,ba=ja.center,ha=ja.bounds;if(Y&&this._parent&&(va||ba||ha)){if(ba||ha)var k=this.getInternalBounds();var p=va&&Ya("position")||ba&&Ya("center","Center");if(!p&&ha)for(va="TopLeft TopRight BottomLeft BottomRight LeftCenter TopCenter RightCenter BottomCenter".split(" "),ba=0;8>ba&&!p;ba++)p=Ya("bounds",va[ba]);p=Ua(p)}p||=this._hitTestChildren(na,
ja,Ba)||Y&&Ua(this._hitTestSelf(na,ja,Ba,this.getStrokeScaling()?null:Ba._shiftless().invert()))||null;p&&p.point&&(p.point=K.transform(p.point));return p},_hitTestSelf:function(na,ja){if(ja.fill&&this.hasFill()&&this._contains(na))return new Ga("fill",this)},matches:function(na,ja){function Ba(K,X){for(var Y in K)if(K.hasOwnProperty(Y)){var la=K[Y],sa=X[Y];if(f.isPlainObject(la)&&f.isPlainObject(sa)){if(!Ba(la,sa))return!1}else if(!f.equals(la,sa))return!1}return!0}var Ua=typeof na;if("object"===
Ua){for(var Ya in na)if(na.hasOwnProperty(Ya)&&!this.matches(Ya,na[Ya]))return!1;return!0}if("function"===Ua)return na(this);if("match"===na)return ja(this);Ua=/^(empty|editable)$/.test(na)?this["is"+f.capitalize(na)]():"type"===na?f.hyphenate(this._class):this[na];if("class"===na){if("function"===typeof ja)return this instanceof ja;Ua=this._class}if("function"===typeof ja)return!!ja(Ua);if(ja){if(ja.test)return ja.test(Ua);if(f.isPlainObject(ja))return Ba(ja,Ua)}return f.equals(Ua,ja)},getItems:function(na){return P._getItems(this,
na,this._matrix)},getItem:function(na){return P._getItems(this,na,this._matrix,null,!0)[0]||null},statics:{_getItems:function X(ja,Ba,Ua,Ya,K){if(!Ya){var Y="object"===typeof Ba&&Ba;Ya=Y&&Y.overlapping;var la=Y&&Y.inside,sa=Ya||la,va=sa&&V.read([sa]);Ya={items:[],recursive:Y&&!1!==Y.recursive,inside:!!la,overlapping:!!Ya,rect:va,path:Ya&&new Ia.Rectangle({rectangle:va,insert:!1})};Y&&(Ba=f.filter({},Ba,{recursive:!0,inside:!0,overlapping:!0}))}ja=ja._children;Y=Ya.items;Ua=(va=Ya.rect)&&(Ua||new Q);
la=0;for(var ba=ja&&ja.length;la<ba;la++){var ha=ja[la],k=Ua&&Ua.appended(ha._matrix),p=!0;if(va){sa=ha.getBounds(k);if(!va.intersects(sa))continue;va.contains(sa)||Ya.overlapping&&(sa.contains(va)||Ya.path.intersects(ha,k))||(p=!1)}if(p&&ha.matches(Ba)&&(Y.push(ha),K))break;!1!==Ya.recursive&&X(ha,Ba,k,Ya,K);if(K&&0<Y.length)break}return Y}}},{importJSON:function(ja){ja=f.importJSON(ja,this);return ja!==this?this.addChild(ja):ja},addChild:function(ja){return this.insertChild(b,ja)},insertChild:function(ja,
Ba){return(ja=Ba?this.insertChildren(ja,[Ba]):null)&&ja[0]},addChildren:function(ja){return this.insertChildren(this._children.length,ja)},insertChildren:function(ja,Ba){var Ua=this._children;if(Ua&&Ba&&0<Ba.length){Ba=f.slice(Ba);for(var Ya={},K=Ba.length-1;0<=K;K--){var X=Ba[K],Y=X&&X._id;!X||Ya[Y]?Ba.splice(K,1):(X._remove(!1,!0),Ya[Y]=!0)}f.splice(Ua,Ba,ja,0);ja=this._project;Ua=ja._changes;K=0;for(Ya=Ba.length;K<Ya;K++)X=Ba[K],Y=X._name,X._parent=this,X._setProject(ja,!0),Y&&X.setName(Y),Ua&&
X._changed(5);this._changed(11)}else Ba=null;return Ba},_insertItem:"#insertChild",_insertAt:function(ja,Ba){var Ua=ja&&ja._getOwner(),Ya=ja!==this&&Ua?this:null;Ya&&(Ya._remove(!1,!0),Ua._insertItem(ja._index+Ba,Ya));return Ya},insertAbove:function(ja){return this._insertAt(ja,1)},insertBelow:function(ja){return this._insertAt(ja,0)},sendToBack:function(){var ja=this._getOwner();return ja?ja._insertItem(0,this):null},bringToFront:function(){var ja=this._getOwner();return ja?ja._insertItem(b,this):
null},appendTop:"#addChild",appendBottom:function(ja){return this.insertChild(0,ja)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(ja){return ja._insertItem(b,this)},copyTo:function(ja){return this.clone(!1).addTo(ja)},reduce:function(ja){var Ba=this._children;return Ba&&1===Ba.length?(ja=Ba[0].reduce(ja),this._parent?(ja.insertAbove(this),this.remove()):ja.remove(),ja):this},_removeNamed:function(){var ja=this._getOwner();if(ja){var Ba=ja._children;ja=ja._namedChildren;var Ua=
this._name,Ya=ja[Ua],K=Ya?Ya.indexOf(this):-1;-1!==K&&(Ba[Ua]==this&&delete Ba[Ua],Ya.splice(K,1),Ya.length?Ba[Ua]=Ya[0]:delete ja[Ua])}},_remove:function(ja,Ba){var Ua=this._getOwner(),Ya=this._project,K=this._index;this._style&&this._style._dispose();return Ua?(this._name&&this._removeNamed(),null!=K&&(Ya._activeLayer===this&&(Ya._activeLayer=this.getNextSibling()||this.getPreviousSibling()),f.splice(Ua._children,null,K,1)),this._installEvents(!1),ja&&Ya._changes&&this._changed(5),Ba&&Ua._changed(11,
this),this._parent=null,!0):!1},remove:function(){return this._remove(!0,!0)},replaceWith:function(ja){(ja=ja&&ja.insertBelow(this))&&this.remove();return ja},removeChildren:function(ja,Ba){if(!this._children)return null;ja=ja||0;Ba=f.pick(Ba,this._children.length);ja=f.splice(this._children,null,ja,Ba-ja);for(Ba=ja.length-1;0<=Ba;Ba--)ja[Ba]._remove(!0,!1);0<ja.length&&this._changed(11);return ja},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var ja=
0,Ba=this._children.length;ja<Ba;ja++)this._children[ja]._index=ja;this._changed(11)}},isEmpty:function(ja){var Ba=this._children,Ua=Ba?Ba.length:0;if(ja){for(var Ya=0;Ya<Ua;Ya++)if(!Ba[Ya].isEmpty(ja))return!1;return!0}return!Ua},isEditable:function(){for(var ja=this;ja;){if(!ja._visible||ja._locked)return!1;ja=ja._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},
_getOrder:function(ja){function Ba(X){var Y=[];do Y.unshift(X);while(X=X._parent);return Y}var Ua=Ba(this);ja=Ba(ja);for(var Ya=0,K=Math.min(Ua.length,ja.length);Ya<K;Ya++)if(Ua[Ya]!=ja[Ya])return Ua[Ya]._index<ja[Ya]._index?1:-1;return 0},hasChildren:function(){return this._children&&0<this._children.length},isInserted:function(){return this._parent?this._parent.isInserted():!1},isAbove:function(ja){return-1===this._getOrder(ja)},isBelow:function(ja){return 1===this._getOrder(ja)},isParent:function(ja){return this._parent===
ja},isChild:function(ja){return ja&&ja._parent===this},isDescendant:function(ja){for(var Ba=this;Ba=Ba._parent;)if(Ba===ja)return!0;return!1},isAncestor:function(ja){return ja?ja.isDescendant(this):!1},isSibling:function(ja){return this._parent===ja._parent},isGroupedWith:function(ja){for(var Ba=this._parent;Ba;){if(Ba._parent&&/^(Group|Layer|CompoundPath)$/.test(Ba._class)&&ja.isDescendant(Ba))return!0;Ba=Ba._parent}return!1}},f.each(["rotate","scale","shear","skew"],function(ja){var Ba="rotate"===
ja;this[ja]=function(){var Ua=arguments,Ya=(Ba?f:F).read(Ua);Ua=F.read(Ua,0,{readNull:!0});return this.transform((new Q)[ja](Ya,Ua||this.getPosition(!0)))}},{translate:function(){var ja=new Q;return this.transform(ja.translate.apply(ja,arguments))},transform:function(ja,Ba,Ua){var Ya=this._matrix,K=ja&&!ja.isIdentity(),X=Ua&&this._canApplyMatrix||this._applyMatrix&&(K||!Ya.isIdentity()||Ba&&this._children);if(!K&&!X)return this;if(K){!ja.isInvertible()&&Ya.isInvertible()&&(Ya._backup=Ya.getValues());
Ya.prepend(ja,!0);var Y=this._style,la=Y.getFillColor(!0);Y=Y.getStrokeColor(!0);la&&la.transform(ja);Y&&Y.transform(ja)}if(X&&=this._transformContent(Ya,Ba,Ua))(Ba=this._pivot)&&Ya._transformPoint(Ba,Ba,!0),Ya.reset(!0),Ua&&this._canApplyMatrix&&(this._applyMatrix=!0);Ua=this._bounds;Ya=this._position;(K||X)&&this._changed(25);if((Ba=K&&Ua&&ja.decompose())&&Ba.skewing.isZero()&&0===Ba.rotation%90){for(var sa in Ua)if(K=Ua[sa],K.nonscaling)delete Ua[sa];else if(X||!K.internal)K=K.rect,ja._transformBounds(K,
K);this._bounds=Ua;if(ja=Ua[this._getBoundsCacheKey(this._boundsOptions||{})])this._position=this._getPositionFromBounds(ja.rect)}else K&&Ya&&this._pivot&&(this._position=ja._transformPoint(Ya,Ya));return this},_transformContent:function(ja,Ba,Ua){var Ya=this._children;if(Ya){for(var K=0,X=Ya.length;K<X;K++)Ya[K].transform(ja,Ba,Ua);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(F.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(F.read(arguments))},
parentToLocal:function(){return this._matrix._inverseTransform(F.read(arguments))},localToParent:function(){return this._matrix._transformPoint(F.read(arguments))},fitBounds:function(ja,Ba){ja=V.read(arguments);var Ua=this.getBounds(),Ya=Ua.height/Ua.width,K=ja.height/ja.width;Ya=(Ba?Ya>K:Ya<K)?ja.width/Ua.width:ja.height/Ua.height;Ua=new V(new F,new N(Ua.width*Ya,Ua.height*Ya));Ua.setCenter(ja.getCenter());this.setBounds(Ua)}}),{_setStyles:function(ja,Ba,Ua){var Ya=this._style,K=this._matrix;Ya.hasFill()&&
(ja.fillStyle=Ya.getFillColor().toCanvasStyle(ja,K));if(Ya.hasStroke()){ja.strokeStyle=Ya.getStrokeColor().toCanvasStyle(ja,K);ja.lineWidth=Ya.getStrokeWidth();K=Ya.getStrokeJoin();var X=Ya.getStrokeCap(),Y=Ya.getMiterLimit();K&&(ja.lineJoin=K);X&&(ja.lineCap=X);Y&&(ja.miterLimit=Y);ib.support.nativeDash&&(K=Ya.getDashArray(),X=Ya.getDashOffset(),K&&K.length&&("setLineDash"in ja?(ja.setLineDash(K),ja.lineDashOffset=X):(ja.mozDash=K,ja.mozDashOffset=X)))}Ya.hasShadow()&&(Ba=Ba.pixelRatio||1,Ba=Ua._shiftless().prepend((new Q).scale(Ba,
Ba)),Ua=Ba.transform(new F(Ya.getShadowBlur(),0)),Ba=Ba.transform(this.getShadowOffset()),ja.shadowColor=Ya.getShadowColor().toCanvasStyle(ja),ja.shadowBlur=Ua.getLength(),ja.shadowOffsetX=Ba.x,ja.shadowOffsetY=Ba.y)},draw:function(ja,Ba,Ua){this._updateVersion=this._project._updateVersion;if(this._visible&&0!==this._opacity){var Ya=Ba.matrices,K=Ba.viewMatrix,X=this._matrix,Y=Ya[Ya.length-1].appended(X);if(Y.isInvertible()){K=K?K.appended(Y):Y;Ya.push(Y);Ba.updateMatrix&&(this._globalMatrix=Y);Y=
this._blendMode;var la=this._opacity,sa="normal"===Y,va=Rb.nativeModes[Y];sa=sa&&1===la||Ba.dontStart||Ba.clip||(va||sa&&1>la)&&this._canComposite();var ba=Ba.pixelRatio||1;if(!sa){var ha=this.getStrokeBounds(K);if(!ha.width||!ha.height){Ya.pop();return}var k=Ba.offset;var p=Ba.offset=ha.getTopLeft().floor();var A=ja;ja=Nb.getContext(ha.getSize().ceil().add(1).multiply(ba));1!==ba&&ja.scale(ba,ba)}ja.save();Ua=Ua?Ua.appended(X):this._canScaleStroke&&!this.getStrokeScaling(!0)&&K;ha=!sa&&Ba.clipItem;
var H=!Ua||ha;sa?(ja.globalAlpha=la,va&&(ja.globalCompositeOperation=Y)):H&&ja.translate(-p.x,-p.y);H&&(sa?X:K).applyToContext(ja);ha&&Ba.clipItem.draw(ja,Ba.extend({clip:!0}));Ua&&(ja.setTransform(ba,0,0,ba,0,0),(X=Ba.offset)&&ja.translate(-X.x,-X.y));this._draw(ja,Ba,K,Ua);ja.restore();Ya.pop();Ba.clip&&!Ba.dontFinish&&ja.clip(this.getFillRule());sa||(Rb.process(Y,ja,A,la,p.subtract(k).multiply(ba)),Nb.release(ja),Ba.offset=k)}}},_isUpdated:function(ja){var Ba=this._parent;if(Ba instanceof $a)return Ba._isUpdated(ja);
var Ua=this._updateVersion===ja;!Ua&&Ba&&Ba._visible&&Ba._isUpdated(ja)&&(this._updateVersion=ja,Ua=!0);return Ua},_drawSelection:function(ja,Ba,Ua,Ya,K){var X=this._selection,Y=X&1,la=X&2||Y&&this._selectBounds;X&=4;this._drawSelected||(Y=!1);if((Y||la||X)&&this._isUpdated(K)){var sa;K=this.getSelectedColor(!0)||(sa=this.getLayer())&&sa.getSelectedColor(!0);sa=Ba.appended(this.getGlobalMatrix(!0));Ba=Ua/2;ja.strokeStyle=ja.fillStyle=K?K.toCanvasStyle(ja):"#009dec";Y&&this._drawSelected(ja,sa,Ya);
if(X){Ya=this.getPosition(!0);Y=(Y=this._parent)?Y.localToGlobal(Ya):Ya;Ya=Y.x;X=Y.y;ja.beginPath();ja.arc(Ya,X,Ba,0,2*Math.PI,!0);ja.stroke();K=[[0,-1],[1,0],[0,1],[-1,0]];var va=Ua+1;for(Y=0;4>Y;Y++){var ba=K[Y],ha=ba[0];ba=ba[1];ja.moveTo(Ya+ha*Ba,X+ba*Ba);ja.lineTo(Ya+ha*va,X+ba*va);ja.stroke()}}if(la){la=sa._transformCorners(this.getInternalBounds());ja.beginPath();for(Y=0;8>Y;Y++)ja[Y?"lineTo":"moveTo"](la[Y],la[++Y]);ja.closePath();ja.stroke();for(Y=0;8>Y;Y++)ja.fillRect(la[Y]-Ba,la[++Y]-Ba,
Ua,Ua)}}},_canComposite:function(){return!1}},f.each(["down","drag","up","move"],function(ja){this["removeOn"+f.capitalize(ja)]=function(){var Ba={};Ba[ja]=!0;return this.removeOn(Ba)}},{removeOn:function(ja){for(var Ba in ja)if(ja[Ba]){var Ua="mouse"+Ba,Ya=this._project;Ya=Ya._removeSets=Ya._removeSets||{};Ya[Ua]=Ya[Ua]||{};Ya[Ua][this._id]=this}return this}}),{tween:function(ja,Ba,Ua){function Ya(Y){X._handleFrame(1E3*Y.time);X.running||this.off("frame",Ya)}Ua||(Ua=Ba,Ba=ja,ja=null,Ua||(Ua=Ba,Ba=
null));var K=null!=Ua&&("number"===typeof Ua?Ua:Ua.duration),X=new z(this,ja,Ba,K,Ua&&Ua.easing,Ua&&Ua.start);if(K)this.on("frame",Ya);return X},tweenTo:function(ja,Ba){return this.tween(null,ja,Ba)},tweenFrom:function(ja,Ba){return this.tween(ja,null,Ba)}}),ea=P.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(ja){this._children=[];this._namedChildren={};this._initialize(ja)||this.addChildren(Array.isArray(ja)?ja:arguments)},_changed:function Ua(Ba){Ua.base.call(this,
Ba);Ba&2050&&(this._clipItem=b)},_getClipItem:function(){var Ba=this._clipItem;if(Ba===b){Ba=null;for(var Ua=this._children,Ya=0,K=Ua.length;Ya<K;Ya++)if(Ua[Ya]._clipMask){Ba=Ua[Ya];break}this._clipItem=Ba}return Ba},isClipped:function(){return!!this._getClipItem()},setClipped:function(Ba){var Ua=this.getFirstChild();Ua&&Ua.setClipMask(Ba)},_getBounds:function K(Ua,Ya){var X=this._getClipItem();return X?X._getCachedBounds(X._matrix.prepended(Ua),f.set({},Ya,{stroke:!1})):K.base.call(this,Ua,Ya)},
_hitTestChildren:function Y(Ya,K,X){var la=this._getClipItem();return(!la||la.contains(Ya))&&Y.base.call(this,Ya,K,X,la)},_draw:function(Ya,K){var X=K.clip,Y=!X&&this._getClipItem();K=K.extend({clipItem:Y,clip:!1});X?(Ya.beginPath(),K.dontStart=K.dontFinish=!0):Y&&Y.draw(Ya,K.extend({clip:!0}));X=this._children;for(var la=0,sa=X.length;la<sa;la++){var va=X[la];va!==Y&&va.draw(Ya,K)}}}),ua=ea.extend({_class:"Layer",initialize:function(){ea.apply(this,arguments)},_getOwner:function(){return this._parent||
null!=this._index&&this._project},isInserted:function K(){return this._parent?K.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),Fa=P.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(K,X){this._initialize(K,X)},_equals:function(K){return this._type===K._type&&this._size.equals(K._size)&&f.equals(this._radius,K._radius)},copyContent:function(K){this.setType(K._type);
this.setSize(K._size);this.setRadius(K._radius)},getType:function(){return this._type},setType:function(K){this._type=K},getShape:"#getType",setShape:"#setType",getSize:function(){var K=this._size;return new T(K.width,K.height,this,"setSize")},setSize:function(){var K=N.read(arguments);if(!this._size)this._size=K.clone();else if(!this._size.equals(K)){var X=this._type,Y=K.width,la=K.height;"rectangle"===X?this._radius.set(N.min(this._radius,K.divide(2).abs())):"circle"===X?(Y=la=(Y+la)/2,this._radius=
Y/2):"ellipse"===X&&this._radius._set(Y/2,la/2);this._size._set(Y,la);this._changed(9)}},getRadius:function(){var K=this._radius;return"circle"===this._type?K:new T(K.width,K.height,this,"setRadius")},setRadius:function(K){var X=this._type;if("circle"===X){if(K===this._radius)return;X=2*K;this._radius=K;this._size._set(X,X)}else if(K=N.read(arguments),this._radius){if(this._radius.equals(K))return;this._radius.set(K);"rectangle"===X?(X=N.max(this._size,K.multiply(2)),this._size.set(X)):"ellipse"===
X&&this._size._set(2*K.width,2*K.height)}else this._radius=K.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(K){var X=new (Ia[f.capitalize(this._type)])({center:new F,size:this._size,radius:this._radius,insert:!1});X.copyAttributes(this);ib.settings.applyMatrix&&X.setApplyMatrix(!0);(K===b||K)&&X.insertAbove(this);return X},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(K,X,Y,la){var sa=this._style,va=sa.hasFill(),ba=sa.hasStroke(),ha=X.dontFinish||
X.clip,k=!la;if(va||ba||ha){var p=this._type,A=this._radius,H="circle"===p;X.dontStart||K.beginPath();if(k&&H)K.arc(0,0,A,0,2*Math.PI,!0);else{var O=H?A:A.width;A=H?A:A.height;var M=this._size;H=M.width;M=M.height;k&&"rectangle"===p&&0===O&&0===A?K.rect(-H/2,-M/2,H,M):(k=H/2,p=M/2,H=.44771525016920644*O,M=.44771525016920644*A,H=[-k,-p+A,-k,-p+M,-k+H,-p,-k+O,-p,k-O,-p,k-H,-p,k,-p+M,k,-p+A,k,p-A,k,p-M,k-H,p,k-O,p,-k+O,p,-k+H,p,-k,p-M,-k,p-A],la&&la.transform(H,H,32),K.moveTo(H[0],H[1]),K.bezierCurveTo(H[2],
H[3],H[4],H[5],H[6],H[7]),k!==O&&K.lineTo(H[8],H[9]),K.bezierCurveTo(H[10],H[11],H[12],H[13],H[14],H[15]),p!==A&&K.lineTo(H[16],H[17]),K.bezierCurveTo(H[18],H[19],H[20],H[21],H[22],H[23]),k!==O&&K.lineTo(H[24],H[25]),K.bezierCurveTo(H[26],H[27],H[28],H[29],H[30],H[31]))}K.closePath()}ha||!va&&!ba||(this._setStyles(K,X,Y),va&&(K.fill(sa.getFillRule()),K.shadowColor="rgba(0,0,0,0)"),ba&&K.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(K,X){var Y=(new V(this._size)).setCenter(0,
0),la=this._style;la=X.stroke&&la.hasStroke()&&la.getStrokeWidth();K&&(Y=K._transformBounds(Y));return la?Y.expand(Ia._getStrokePadding(la,this._getStrokeMatrix(K,X))):Y}},new function(){function K(Y,la,sa){var va=Y._radius;if(!va.isZero()){Y=Y._size.divide(2);for(var ba=1;4>=ba;ba++){var ha=new F(1<ba&&4>ba?-1:1,2<ba?-1:1),k=ha.multiply(Y),p=k.subtract(ha.multiply(va));if((new V(sa?k.add(ha.multiply(sa)):k,p)).contains(la))return{point:p,quadrant:ba}}}}function X(Y,la,sa,va){Y=Y.divide(la);return(!va||
Y.isInQuadrant(va))&&1>=Y.subtract(Y.normalize()).multiply(la).divide(sa).length}return{_contains:function sa(la){if("rectangle"===this._type){var va=K(this,la);return va?1>=la.subtract(va.point).divide(this._radius).getLength():sa.base.call(this,la)}return.5>=la.divide(this.size).getLength()},_hitTestSelf:function k(sa,va,ba,ha){var p=!1,A=this._style,H=va.stroke&&A.hasStroke(),O=va.fill&&A.hasFill();if(H||O){O=this._type;p=this._radius;var M=H?A.getStrokeWidth()/2:0;M=va._tolerancePadding.add(Ia._getStrokePadding(M,
!A.getStrokeScaling()&&ha));"rectangle"===O?(A=M.multiply(2),(O=K(this,sa,A))?p=X(sa.subtract(O.point),p,M,O.quadrant):(O=(new V(this._size)).setCenter(0,0),p=O.expand(A),A=O.expand(A.negate()),p=p._containsPoint(sa)&&!A._containsPoint(sa))):p=X(sa,p,M)}return p?new Ga(H?"stroke":"fill",this):k.base.apply(this,arguments)}}},{statics:new function(){function K(X,Y,la,sa,va){var ba=f.create(Fa.prototype);ba._type=X;ba._size=la;ba._radius=sa;ba._initialize(f.getNamed(va),Y);return ba}return{Circle:function(){var X=
arguments,Y=F.readNamed(X,"center"),la=f.readNamed(X,"radius");return K("circle",Y,new N(2*la),la,X)},Rectangle:function(){var X=arguments,Y=V.readNamed(X,"rectangle"),la=N.min(N.readNamed(X,"radius"),Y.getSize(!0).divide(2));return K("rectangle",Y.getCenter(!0),Y.getSize(!0),la,X)},Ellipse:function(){var X=arguments,Y=Fa._readEllipse(X),la=Y.radius;return K("ellipse",Y.center,la.multiply(2),la,X)},_readEllipse:function(X){if(f.hasNamed(X,"radius")){var Y=F.readNamed(X,"center");X=N.readNamed(X,"radius")}else X=
V.readNamed(X,"rectangle"),Y=X.getCenter(!0),X=X.getSize(!0).divide(2);return{center:Y,radius:X}}}}}),pa=P.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],_smoothing:!0,beans:!0,initialize:function(K,X){if(!this._initialize(K,X!==b&&F.read(arguments))){var Y=typeof K;if((Y="string"===Y?e.getElementById(K):"object"===Y?K:null)&&Y!==P.NO_INSERT)if(Y.getContent||null!=Y.naturalHeight)var la=
Y;else Y&&(Y=N.read(arguments),Y.isZero()||(la=Nb.getCanvas(Y)));la?this.setImage(la):this.setSource(K)}this._size||(this._size=new N,this._loaded=!1)},_equals:function(K){return this.getSource()===K.getSource()},copyContent:function(K){var X=K._image,Y=K._canvas;X?this._setImage(X):Y&&(X=Nb.getCanvas(K._size),X.getContext("2d").drawImage(Y,0,0),this._setImage(X));this._crossOrigin=K._crossOrigin},getSize:function(){var K=this._size;return new T(K?K.width:0,K?K.height:0,this,"setSize")},setSize:function(){var K=
N.read(arguments);if(!K.equals(this._size))if(0<K.width&&0<K.height){var X=this.getElement();this._setImage(Nb.getCanvas(K));X&&this.getContext(!0).drawImage(X,0,0,K.width,K.height)}else this._canvas&&Nb.release(this._canvas),this._size=K.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(K){this.setSize(K,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(K){this.setSize(this.getWidth(),K)},getLoaded:function(){return this._loaded},
isEmpty:function(){var K=this._size;return!K||0===K.width&&0===K.height},getResolution:function(){var K=this._matrix,X=(new F(0,0)).transform(K),Y=(new F(1,0)).transform(K).subtract(X);K=(new F(0,1)).transform(K).subtract(X);return new N(72/Y.getLength(),72/K.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(K){function X(la){var sa=Y.getView(),va=la&&la.type||"load";sa&&Y.responds(va)&&(ib=sa._scope,Y.emit(va,new qb(la)))}var Y=this;this._setImage(K);
this._loaded?setTimeout(X,0):K&&mb.add(K,{load:function(la){Y._setImage(K);X(la)},error:X})},_setImage:function(K){this._canvas&&Nb.release(this._canvas);K&&K.getContext?(this._image=null,this._canvas=K,this._loaded=!0):(this._image=K,this._canvas=null,this._loaded=!!(K&&K.src&&K.complete));this._size=new N(K?K.naturalWidth||K.width:0,K?K.naturalHeight||K.height:0);this._context=null;this._changed(1033)},getCanvas:function(){if(!this._canvas){var K=Nb.getContext(this._size);try{this._image&&K.drawImage(this._image,
0,0),this._canvas=K.canvas}catch(X){Nb.release(K)}}return this._canvas},setCanvas:"#setImage",getContext:function(K){this._context||(this._context=this.getCanvas().getContext("2d"));K&&(this._image=null,this._changed(1025));return this._context},setContext:function(K){this._context=K},getSource:function(){var K=this._image;return K&&K.src||this.toDataURL()},setSource:function(K){var X=new a.Image,Y=this._crossOrigin;Y&&(X.crossOrigin=Y);K&&(X.src=K);this.setImage(X)},getCrossOrigin:function(){var K=
this._image;return K&&K.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(K){this._crossOrigin=K;var X=this._image;X&&(X.crossOrigin=K)},getSmoothing:function(){return this._smoothing},setSmoothing:function(K){this._smoothing=K;this._changed(257)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var K=V.read(arguments),X=Nb.getContext(K.getSize());X.drawImage(this.getCanvas(),K.x,K.y,K.width,K.height,0,0,K.width,K.height);return X.canvas},
getSubRaster:function(){var K=V.read(arguments),X=new pa(P.NO_INSERT);X._setImage(this.getSubCanvas(K));X.translate(K.getCenter().subtract(this.getSize().divide(2)));X._matrix.prepend(this._matrix);X.insertAbove(this);return X},toDataURL:function(){var K=this._image;K=K&&K.src;return/^data:/.test(K)?K:(K=this.getCanvas())?K.toDataURL.apply(K,arguments):null},drawImage:function(K){var X=F.read(arguments,1);this.getContext(!0).drawImage(K,X.x,X.y)},getAverageColor:function(K){if(K)if(K instanceof ya){var X=
K;var Y=K.getBounds()}else"object"===typeof K&&("width"in K?Y=new V(K):"x"in K&&(Y=new V(K.x-.5,K.y-.5,1,1)));else Y=this.getBounds();if(!Y)return null;K=Math.min(Y.width,32);var la=Math.min(Y.height,32),sa=pa._sampleContext;sa?sa.clearRect(0,0,33,33):sa=pa._sampleContext=Nb.getContext(new N(32));sa.save();Y=(new Q).scale(K/Y.width,la/Y.height).translate(-Y.x,-Y.y);Y.applyToContext(sa);X&&X.draw(sa,new f({clip:!0,matrices:[Y]}));this._matrix.applyToContext(sa);X=this.getElement();Y=this._size;X&&
sa.drawImage(X,-Y.width/2,-Y.height/2);sa.restore();K=sa.getImageData(.5,.5,Math.ceil(K),Math.ceil(la)).data;la=[0,0,0];X=sa=0;for(Y=K.length;X<Y;X+=4){var va=K[X+3];sa+=va;va/=255;la[0]+=K[X]*va;la[1]+=K[X+1]*va;la[2]+=K[X+2]*va}for(X=0;3>X;X++)la[X]/=sa;return sa?Sa.read(la):null},getPixel:function(){var K=F.read(arguments);K=this.getContext().getImageData(K.x,K.y,1,1).data;return new Sa("rgb",[K[0]/255,K[1]/255,K[2]/255],K[3]/255)},setPixel:function(){var K=arguments,X=F.read(K),Y=Sa.read(K);K=
Y._convert("rgb");Y=Y._alpha;var la=this.getContext(!0),sa=la.createImageData(1,1),va=sa.data;va[0]=255*K[0];va[1]=255*K[1];va[2]=255*K[2];va[3]=null!=Y?255*Y:255;la.putImageData(sa,X.x,X.y)},clear:function(){var K=this._size;this.getContext(!0).clearRect(0,0,K.width+1,K.height+1)},createImageData:function(){var K=N.read(arguments);return this.getContext().createImageData(K.width,K.height)},getImageData:function(){var K=V.read(arguments);K.isEmpty()&&(K=new V(this._size));return this.getContext().getImageData(K.x,
K.y,K.width,K.height)},setImageData:function(K){var X=F.read(arguments,1);this.getContext(!0).putImageData(K,X.x,X.y)},_getBounds:function(K){var X=(new V(this._size)).setCenter(0,0);return K?K._transformBounds(X):X},_hitTestSelf:function(K){if(this._contains(K)){var X=this;return new Ga("pixel",X,{offset:K.add(X._size.divide(2)).round(),color:{get:function(){return X.getPixel(this.offset)}}})}},_draw:function(K,X,Y){var la=this.getElement();la&&0<la.width&&0<la.height&&(K.globalAlpha=this._opacity,
this._setStyles(K,X,Y),eb.setPrefixed(K,"imageSmoothingEnabled",this._smoothing),K.drawImage(la,-this._size.width/2,-this._size.height/2))},_canComposite:function(){return!0}}),ra=P.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(K,X){this._initialize(K,X!==b&&F.read(arguments,1))||this.setDefinition(K instanceof Ca?K:new Ca(K))},_equals:function(K){return this._definition===K._definition},copyContent:function(K){this.setDefinition(K._definition)},
getDefinition:function(){return this._definition},setDefinition:function(K){this._definition=K;this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(K,X){var Y=this._definition._item;return Y._getCachedBounds(Y._matrix.prepended(K),X)},_hitTestSelf:function(K,X,Y){X=X.extend({all:!1});if(K=this._definition._item._hitTest(K,X,Y))K.item=this;return K},_draw:function(K,X){this._definition._item.draw(K,X)}}),
Ca=f.extend({_class:"SymbolDefinition",initialize:function(K,X){this._id=D.get();this.project=ib.project;K&&this.setItem(K,X)},_serialize:function(K,X){return X.add(this,function(){return f.serialize([this._class,this._item],K,!1,X)})},_changed:function(K){K&8&&P._clearBoundsCache(this);K&1&&this.project._changed(K)},getItem:function(){return this._item},setItem:function(K,X){K._symbol&&(K=K.clone());this._item&&(this._item._symbol=null);this._item=K;K.remove();K.setSelected(!1);X||K.setPosition(new F);
K._symbol=this;this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(K){return new ra(this,K)},clone:function(){return new Ca(this._item.clone(!1))},equals:function(K){return K===this||K&&this._item.equals(K._item)||!1}}),Ga=f.extend({_class:"HitResult",initialize:function(K,X,Y){this.type=K;this.item=X;Y&&this.inject(Y)},statics:{getOptions:function(K){K=K&&f.read(K);return new f({type:null,tolerance:ib.settings.hitTolerance,fill:!K,stroke:!K,segments:!K,handles:!1,ends:!1,
position:!1,center:!1,bounds:!1,guides:!1,selected:!1},K)}}}),Aa=f.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(K,X,Y,la,sa,va){var ba=arguments.length;if(0<ba)if(null==K||"object"===typeof K)if(1===ba&&K&&"point"in K){var ha=K.point;var k=K.handleIn;var p=K.handleOut;var A=K.selection}else ha=K,k=X,p=Y,A=la;else ha=[K,X],k=Y!==b?[Y,la]:null,p=sa!==b?[sa,va]:null;new xa(ha,this,"_point");new xa(k,this,"_handleIn");new xa(p,this,"_handleOut");A&&this.setSelection(A)},_serialize:function(K,
X){var Y=this._point,la=this._selection;Y=la||this.hasHandles()?[Y,this._handleIn,this._handleOut]:Y;la&&Y.push(la);return f.serialize(Y,K,!0,X)},_changed:function(K){var X=this._path;if(X){var Y=X._curves,la=this._index,sa;Y&&(K&&K!==this._point&&K!==this._handleIn||!(sa=0<la?Y[la-1]:X._closed?Y[Y.length-1]:null)||sa._changed(),K&&K!==this._point&&K!==this._handleOut||!(sa=Y[la])||sa._changed());X._changed(41)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(F.read(arguments))},
getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(F.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(F.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var K=this._handleIn,X=this._handleOut;return!K.isZero()&&!X.isZero()&&K.isCollinear(X)},clearHandles:function(){this._handleIn._set(0,0);this._handleOut._set(0,0)},getSelection:function(){return this._selection},
setSelection:function(K){var X=this._selection,Y=this._path;this._selection=K=K||0;Y&&K!==X&&(Y._updateSelection(this,X,K),Y._changed(257))},_changeSelection:function(K,X){var Y=this._selection;this.setSelection(X?Y|K:Y&~K)},isSelected:function(){return!!(this._selection&7)},setSelected:function(K){this._changeSelection(7,K)},getIndex:function(){return this._index!==b?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var K=this._path,X=this._index;return K?(0<X&&!K._closed&&
X===K._segments.length-1&&X--,K.getCurves()[X]||null):null},getLocation:function(){var K=this.getCurve();return K?new Na(K,this===K._segment1?0:1):null},getNext:function(){var K=this._path&&this._path._segments;return K&&(K[this._index+1]||this._path._closed&&K[0])||null},smooth:function(K,X,Y){K=K||{};var la=K.type,sa=K.factor,va=this.getPrevious();K=this.getNext();var ba=(va||this)._point,ha=this._point,k=(K||this)._point,p=ba.getDistance(ha),A=ha.getDistance(k);if(la&&"catmull-rom"!==la)if("geometric"===
la)va&&K&&(K=ba.subtract(k),ba=sa===b?.4:sa,ha=ba*p/(p+A),X||this.setHandleIn(K.multiply(ha)),Y||this.setHandleOut(K.multiply(ha-ba)));else throw Error("Smoothing method '"+la+"' not supported.");else sa=sa===b?.5:sa,p=Math.pow(p,sa),la=p*p,A=Math.pow(A,sa),sa=A*A,!X&&va&&(X=2*sa+3*A*p+la,va=3*A*(A+p),this.setHandleIn(0!==va?new F((sa*ba._x+X*ha._x-la*k._x)/va-ha._x,(sa*ba._y+X*ha._y-la*k._y)/va-ha._y):new F)),!Y&&K&&(X=2*la+3*p*A+sa,va=3*p*(p+A),this.setHandleOut(0!==va?new F((la*k._x+X*ha._x-sa*
ba._x)/va-ha._x,(la*k._y+X*ha._y-sa*ba._y)/va-ha._y):new F))},getPrevious:function(){var K=this._path&&this._path._segments;return K&&(K[this._index-1]||this._path._closed&&K[K.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var K=this._path;return K&&this._index===K._segments.length-1||!1},reverse:function(){var K=this._handleIn,X=this._handleOut,Y=K.clone();K.set(X);X.set(Y)},reversed:function(){return new Aa(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?
!!this._path.removeSegment(this._index):!1},clone:function(){return new Aa(this._point,this._handleIn,this._handleOut)},equals:function(K){return K===this||K&&this._class===K._class&&this._point.equals(K._point)&&this._handleIn.equals(K._handleIn)&&this._handleOut.equals(K._handleOut)||!1},toString:function(){var K=["point: "+this._point];this._handleIn.isZero()||K.push("handleIn: "+this._handleIn);this._handleOut.isZero()||K.push("handleOut: "+this._handleOut);return"{ "+K.join(", ")+" }"},transform:function(K){this._transformCoordinates(K,
Array(6),!0);this._changed()},interpolate:function(K,X,Y){var la=1-Y,sa=K._point,va=X._point,ba=K._handleIn,ha=X._handleIn;X=X._handleOut;K=K._handleOut;this._point._set(la*sa._x+Y*va._x,la*sa._y+Y*va._y,!0);this._handleIn._set(la*ba._x+Y*ha._x,la*ba._y+Y*ha._y,!0);this._handleOut._set(la*K._x+Y*X._x,la*K._y+Y*X._y,!0);this._changed()},_transformCoordinates:function(K,X,Y){var la=this._point,sa=Y&&this._handleIn.isZero()?null:this._handleIn,va=Y&&this._handleOut.isZero()?null:this._handleOut,ba=la._x,
ha=la._y,k=2;X[0]=ba;X[1]=ha;sa&&(X[k++]=sa._x+ba,X[k++]=sa._y+ha);va&&(X[k++]=va._x+ba,X[k++]=va._y+ha);K&&(K._transformCoordinates(X,X,k/2),ba=X[0],ha=X[1],Y?(la._x=ba,la._y=ha,k=2,sa&&(sa._x=X[k++]-ba,sa._y=X[k++]-ha),va&&(va._x=X[k++]-ba,va._y=X[k++]-ha)):(sa||(X[k++]=ba,X[k++]=ha),va||(X[k++]=ba,X[k++]=ha)));return X}}),xa=F.extend({initialize:function(K,X,Y){var la;if(K)if((la=K[0])!==b)var sa=K[1];else{var va=K;(la=va.x)===b&&(va=F.read(arguments),la=va.x);sa=va.y;va=va.selected}else la=sa=
0;this._x=la;this._y=sa;this._owner=X;X[Y]=this;va&&this.setSelected(!0)},_set:function(K,X){this._x=K;this._y=X;this._owner._changed(this);return this},getX:function(){return this._x},setX:function(K){this._x=K;this._owner._changed(this)},getY:function(){return this._y},setY:function(K){this._y=K;this._owner._changed(this)},isZero:function(){var K=B.isZero;return K(this._x)&&K(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(K){this._owner._changeSelection(this._getSelection(),
K)},_getSelection:function(){var K=this._owner;return this===K._point?1:this===K._handleIn?2:this===K._handleOut?4:0}}),za=f.extend({_class:"Curve",beans:!0,initialize:function(K,X,Y,la,sa,va,ba,ha){var k=arguments.length;if(3===k){this._path=K;var p=X;var A=Y}else if(k)if(1===k)if("segment1"in K)p=new Aa(K.segment1),A=new Aa(K.segment2);else if("point1"in K){var H=K.point1;var O=K.handle1;var M=K.handle2;var R=K.point2}else Array.isArray(K)&&(H=[K[0],K[1]],R=[K[6],K[7]],O=[K[2]-K[0],K[3]-K[1]],M=
[K[4]-K[6],K[5]-K[7]]);else 2===k?(p=new Aa(K),A=new Aa(X)):4===k?(H=K,O=X,M=Y,R=la):8===k&&(H=[K,X],R=[ba,ha],O=[Y-K,la-X],M=[sa-ba,va-ha]);else p=new Aa,A=new Aa;this._segment1=p||new Aa(H,null,O);this._segment2=A||new Aa(R,M,null)},_serialize:function(K,X){return f.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],K,!0,X)},_changed:function(){this._length=this._bounds=b},clone:function(){return new za(this._segment1,
this._segment2)},toString:function(){var K=["point1: "+this._segment1._point];this._segment1._handleOut.isZero()||K.push("handle1: "+this._segment1._handleOut);this._segment2._handleIn.isZero()||K.push("handle2: "+this._segment2._handleIn);K.push("point2: "+this._segment2._point);return"{ "+K.join(", ")+" }"},classify:function(){return za.classify(this.getValues())},remove:function(){var K=!1;if(this._path){K=this._segment2;var X=K._handleOut;(K=K.remove())&&this._segment1._handleOut.set(X)}return K},
getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(F.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(F.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(F.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(F.read(arguments))},getSegment1:function(){return this._segment1},
getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var K=this._path&&this._path._curves;return K&&(K[this._segment1._index+1]||this._path._closed&&K[0])||null},getPrevious:function(){var K=this._path&&this._path._curves;return K&&(K[this._segment1._index-1]||this._path._closed&&K[K.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var K=this._path;return K&&this._segment1._index===
K._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(K){this.getPoint1().setSelected(K);this.getHandle1().setSelected(K);this.getHandle2().setSelected(K);this.getPoint2().setSelected(K)},getValues:function(K){return za.getValues(this._segment1,this._segment2,K)},getPoints:function(){for(var K=this.getValues(),X=[],Y=0;8>Y;Y+=2)X.push(new F(K[Y],K[Y+1]));
return X}},{getLength:function(){null==this._length&&(this._length=za.getLength(this.getValues(),0,1));return this._length},getArea:function(){return za.getArea(this.getValues())},getLine:function(){return new aa(this._segment1._point,this._segment2._point)},getPart:function(K,X){return new za(za.getPart(this.getValues(),K,X))},getPartLength:function(K,X){return za.getLength(this.getValues(),K,X)},divideAt:function(K){return this.divideAtTime(K&&K.curve===this?K.time:this.getTimeAt(K))},divideAtTime:function(K,
X){var Y=null;if(1E-8<=K&&.99999999>=K){Y=za.subdivide(this.getValues(),K);K=Y[0];Y=Y[1];var la=X||this.hasHandles();X=this._segment1;var sa=this._segment2,va=this._path;la&&(X._handleOut._set(K[2]-K[0],K[3]-K[1]),sa._handleIn._set(Y[4]-Y[6],Y[5]-Y[7]));var ba=K[6],ha=K[7];K=new Aa(new F(ba,ha),la&&new F(K[4]-ba,K[5]-ha),la&&new F(Y[2]-ba,Y[3]-ha));va?(va.insert(X._index+1,K),Y=this.getNext()):(this._segment2=K,this._changed(),Y=new za(K,sa))}return Y},splitAt:function(K){var X=this._path;return X?
X.splitAt(K):null},splitAtTime:function(K){return this.splitAt(this.getLocationAtTime(K))},divide:function(K,X){return this.divideAtTime(K===b?.5:X?K:this.getTimeAt(K))},split:function(K,X){return this.splitAtTime(K===b?.5:X?K:this.getTimeAt(K))},reversed:function(){return new za(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0);this._segment2._handleIn._set(0,0)},statics:{getValues:function(K,X,Y,la){var sa=K._point;K=K._handleOut;var va=
X._handleIn,ba=X._point;X=sa.x;sa=sa.y;var ha=ba.x;ba=ba.y;la=la?[X,sa,X,sa,ha,ba,ha,ba]:[X,sa,X+K._x,sa+K._y,ha+va._x,ba+va._y,ha,ba];Y&&Y._transformCoordinates(la,la,4);return la},subdivide:function(K,X){var Y=K[0],la=K[1],sa=K[2],va=K[3],ba=K[4],ha=K[5],k=K[6];K=K[7];X===b&&(X=.5);var p=1-X,A=p*Y+X*sa,H=p*la+X*va,O=p*sa+X*ba,M=p*va+X*ha;ba=p*ba+X*k;ha=p*ha+X*K;va=p*A+X*O;sa=p*H+X*M;O=p*O+X*ba;M=p*M+X*ha;var R=p*va+X*O;X=p*sa+X*M;return[[Y,la,A,H,va,sa,R,X],[R,X,O,M,ba,ha,k,K]]},getMonoCurves:function(K,
X){var Y=[];X=X?0:1;var la=K[X+0],sa=K[X+2],va=K[X+4],ba=K[X+6];la>=sa===sa>=va&&sa>=va===va>=ba||za.isStraight(K)?Y.push(K):(X=[],(la=B.solveQuadratic(3*(sa-va)-la+ba,2*(la+va)-4*sa,sa-la,X,1E-8,.99999999))?(X.sort(),sa=X[0],K=za.subdivide(K,sa),Y.push(K[0]),1<la&&(sa=(X[1]-sa)/(1-sa),K=za.subdivide(K[1],sa),Y.push(K[0])),Y.push(K[1])):Y.push(K));return Y},solveCubic:function(K,X,Y,la,sa,va){var ba=K[X],ha=K[X+2],k=K[X+4];K=K[X+6];X=0;ba<Y&&K<Y&&ha<Y&&k<Y||ba>Y&&K>Y&&ha>Y&&k>Y||(X=3*(ha-ba),ha=3*
(k-ha)-X,X=B.solveCubic(K-ba-X-ha,ha,X,ba-Y,la,sa,va));return X},getTimeOf:function(K,X){var Y=new F(K[0],K[1]),la=new F(K[6],K[7]);if(null===(X.isClose(Y,1E-12)?0:X.isClose(la,1E-12)?1:null))for(var sa=[X.x,X.y],va=[],ba=0;2>ba;ba++)for(var ha=za.solveCubic(K,ba,sa[ba],va,0,1),k=0;k<ha;k++){var p=va[k];if(X.isClose(za.getPoint(K,p),1E-7))return p}return X.isClose(Y,1E-7)?0:X.isClose(la,1E-7)?1:null},getNearestTime:function(K,X){function Y(A){if(0<=A&&1>=A){var H=X.getDistance(za.getPoint(K,A),!0);
if(H<k)return k=H,p=A,!0}}if(za.isStraight(K)){var la=K[0],sa=K[1],va=K[6]-la,ba=K[7]-sa,ha=va*va+ba*ba;if(0===ha)return 0;ha=((X.x-la)*va+(X.y-sa)*ba)/ha;return 1E-12>ha?0:.999999999999<ha?1:za.getTimeOf(K,new F(la+ha*va,sa+ha*ba))}var k=Infinity,p=0;for(la=0;100>=la;la++)Y(la/100);for(la=.005;1E-8<la;)Y(p-la)||Y(p+la)||(la/=2);return p},getPart:function(K,X,Y){var la=X>Y;if(la){var sa=X;X=Y;Y=sa}0<X&&(K=za.subdivide(K,X)[1]);1>Y&&(K=za.subdivide(K,(Y-X)/(1-X))[0]);return la?[K[6],K[7],K[4],K[5],
K[2],K[3],K[0],K[1]]:K},isFlatEnough:function(K,X){var Y=K[0],la=K[1],sa=K[6],va=K[7],ba=3*K[2]-2*Y-sa,ha=3*K[3]-2*la-va;Y=3*K[4]-2*sa-Y;K=3*K[5]-2*va-la;return Math.max(ba*ba,Y*Y)+Math.max(ha*ha,K*K)<=16*X*X},getArea:function(K){var X=K[0],Y=K[1],la=K[2],sa=K[3],va=K[4],ba=K[5],ha=K[6];K=K[7];return 3*((K-Y)*(la+va)-(ha-X)*(sa+ba)+sa*(X-va)-la*(Y-ba)+K*(va+X/3)-ha*(ba+Y/3))/20},getBounds:function(K){for(var X=K.slice(0,2),Y=X.slice(),la=[0,0],sa=0;2>sa;sa++)za._addBounds(K[sa],K[sa+2],K[sa+4],K[sa+
6],sa,0,X,Y,la);return new V(X[0],X[1],Y[0]-X[0],Y[1]-X[1])},_addBounds:function(K,X,Y,la,sa,va,ba,ha,k){function p(R,W){var ma=R-W;R+=W;ma<ba[sa]&&(ba[sa]=ma);R>ha[sa]&&(ha[sa]=R)}va/=2;var A=ba[sa]-va,H=ha[sa]+va;if(K<A||X<A||Y<A||la<A||K>H||X>H||Y>H||la>H)if(X<K!=X<la&&Y<K!=Y<la)p(K,va),p(la,va);else for(A=B.solveQuadratic(3*(X-Y)-K+la,2*(K+Y)-4*X,X-K,k),p(la,0),H=0;H<A;H++){var O=k[H],M=1-O;1E-8<=O&&.99999999>=O&&p(M*M*M*K+3*M*M*O*X+3*M*O*O*Y+O*O*O*la,va)}}}},f.each(["getBounds","getStrokeBounds",
"getHandleBounds"],function(K){this[K]=function(){this._bounds||(this._bounds={});var X=this._bounds[K];X||=this._bounds[K]=Ia[K]([this._segment1,this._segment2],!1,this._path);return X.clone()}},{}),f.each({isStraight:function(K,X,Y,la){if(X.isZero()&&Y.isZero())return!0;var sa=la.subtract(K);if(!sa.isZero()&&sa.isCollinear(X)&&sa.isCollinear(Y)){var va=new aa(K,la);if(1E-7>va.getDistance(K.add(X))&&1E-7>va.getDistance(la.add(Y)))return K=sa.dot(sa),X=sa.dot(X)/K,Y=sa.dot(Y)/K,0<=X&&1>=X&&0>=Y&&
-1<=Y}return!1},isLinear:function(K,X,Y,la){K=la.subtract(K).divide(3);return X.equals(K)&&Y.negate().equals(K)}},function(K,X){this[X]=function(Y){var la=this._segment1,sa=this._segment2;return K(la._point,la._handleOut,sa._handleIn,sa._point,Y)};this.statics[X]=function(Y,la){var sa=Y[0],va=Y[1],ba=Y[6],ha=Y[7];return K(new F(sa,va),new F(Y[2]-sa,Y[3]-va),new F(Y[4]-ba,Y[5]-ha),new F(ba,ha),la)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},
hasLength:function(K){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(K||0)},isCollinear:function(K){return K&&this.isStraight()&&K.isStraight()&&this.getLine().isCollinear(K.getLine())},isHorizontal:function(){return this.isStraight()&&1E-8>Math.abs(this.getTangentAtTime(.5).y)},isVertical:function(){return this.isStraight()&&1E-8>Math.abs(this.getTangentAtTime(.5).x)}}),{beans:!1,getLocationAt:function(K,X){return this.getLocationAtTime(X?K:this.getTimeAt(K))},
getLocationAtTime:function(K){return null!=K&&0<=K&&1>=K?new Na(this,K):null},getTimeAt:function(K,X){return za.getTimeAt(this.getValues(),K,X)},getParameterAt:"#getTimeAt",getTimesWithTangent:function(){var K=F.read(arguments);return K.isZero()?[]:za.getTimesWithTangent(this.getValues(),K)},getOffsetAtTime:function(K){return this.getPartLength(0,K)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(F.read(arguments)))},getOffsetOf:function(){var K=this.getLocationOf.apply(this,
arguments);return K?K.getOffset():null},getTimeOf:function(){return za.getTimeOf(this.getValues(),F.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var K=F.read(arguments),X=this.getValues(),Y=za.getNearestTime(X,K);X=za.getPoint(X,Y);return new Na(this,Y,X,null,K.getDistance(X))},getNearestPoint:function(){var K=this.getNearestLocation.apply(this,arguments);return K?K.getPoint():K}},new function(){var K="getPoint getTangent getNormal getWeightedTangent getWeightedNormal getCurvature".split(" ");
return f.each(K,function(X){this[X+"At"]=function(Y,la){var sa=this.getValues();return za[X](sa,la?Y:za.getTimeAt(sa,Y))};this[X+"AtTime"]=function(Y){return za[X](this.getValues(),Y)}},{statics:{_evaluateMethods:K}})},new function(){function K(Y){var la=Y[0],sa=Y[1],va=Y[2],ba=Y[3],ha=Y[4],k=Y[5],p=9*(va-ha)+3*(Y[6]-la),A=6*(la+ha)-12*va,H=3*(va-la),O=9*(ba-k)+3*(Y[7]-sa),M=6*(sa+k)-12*ba,R=3*(ba-sa);return function(W){var ma=(p*W+A)*W+H;W=(O*W+M)*W+R;return Math.sqrt(ma*ma+W*W)}}function X(Y,la,
sa,va){if(null==la||0>la||1<la)return null;var ba=Y[0],ha=Y[1],k=Y[2],p=Y[3],A=Y[4],H=Y[5],O=Y[6],M=Y[7];Y=B.isZero;Y(k-ba)&&Y(p-ha)&&(k=ba,p=ha);Y(A-O)&&Y(H-M)&&(A=O,H=M);var R=3*(k-ba);Y=3*(A-k)-R;var W=O-ba-R-Y,ma=3*(p-ha),wa=3*(H-p)-ma,Da=M-ha-ma-wa;0===sa?(ba=0===la?ba:1===la?O:((W*la+Y)*la+R)*la+ba,ha=0===la?ha:1===la?M:((Da*la+wa)*la+ma)*la+ha):(1E-8>la?(ba=R,ha=ma):.99999999<la?(ba=3*(O-A),ha=3*(M-H)):(ba=(3*W*la+2*Y)*la+R,ha=(3*Da*la+2*wa)*la+ma),va&&(0===ba&&0===ha&&(1E-8>la||.99999999<
la)&&(ba=A-k,ha=H-p),va=Math.sqrt(ba*ba+ha*ha))&&(ba/=va,ha/=va),3===sa&&(va=Math.pow(ba*ba+ha*ha,1.5),ba=0!==va?(ba*(6*Da*la+2*wa)-ha*(6*W*la+2*Y))/va:0,ha=0));return 2===sa?new F(ha,-ba):new F(ba,ha)}return{statics:{classify:function(Y){function la(O,M,R){var W=M!==b,ma=W&&0<M&&1>M,wa=W&&0<R&&1>R;!W||(ma||wa)&&("loop"!==O||ma&&wa)||(O="arch",ma=wa=!1);return{type:O,roots:ma||wa?ma&&wa?M<R?[M,R]:[R,M]:[ma?M:R]:null}}var sa=Y[0],va=Y[1],ba=Y[2],ha=Y[3],k=Y[4],p=Y[5],A=Y[6];Y=Y[7];var H=ba*(va-Y)+
ha*(A-sa)+sa*Y-va*A;ha=3*(k*(ha-va)+p*(sa-ba)+ba*va-ha*sa);ba=ha-H;sa=ba-H+(sa*(Y-p)+va*(k-A)+A*p-Y*k);va=Math.sqrt(sa*sa+ba*ba+ha*ha);k=0!==va?1/va:0;va=B.isZero;sa*=k;ba*=k;ha*=k;if(va(sa))return va(ba)?la(va(ha)?"line":"quadratic"):la("serpentine",ha/(3*ba));ha=3*ba*ba-4*sa*ha;if(va(ha))return la("cusp",ba/(2*sa));va=0<ha?Math.sqrt(ha/3):Math.sqrt(-ha);sa*=2;return la(0<ha?"serpentine":"loop",(ba+va)/sa,(ba-va)/sa)},getLength:function(Y,la,sa,va){la===b&&(la=0);sa===b&&(sa=1);return za.isStraight(Y)?
(1>sa&&(Y=za.subdivide(Y,sa)[0],la/=sa),0<la&&(Y=za.subdivide(Y,la)[1]),la=Y[6]-Y[0],sa=Y[7]-Y[1],Math.sqrt(la*la+sa*sa)):B.integrate(va||K(Y),la,sa,Math.max(2,Math.min(16,Math.ceil(32*Math.abs(sa-la)))))},getTimeAt:function(Y,la,sa){sa===b&&(sa=0>la?1:0);if(0===la)return sa;var va=Math.abs,ba=0<la,ha=ba?sa:0,k=ba?1:sa,p=K(Y);Y=za.getLength(Y,ha,k,p);var A=va(la)-Y;if(1E-12>va(A))return ba?k:ha;if(1E-12<A)return null;var H=0;return B.findRoot(function(O){H+=B.integrate(p,sa,O,Math.max(2,Math.min(16,
Math.ceil(32*Math.abs(O-sa)))));sa=O;return H-la},p,sa+la/Y,ha,k,32,1E-12)},getPoint:function(Y,la){return X(Y,la,0,!1)},getTangent:function(Y,la){return X(Y,la,1,!0)},getWeightedTangent:function(Y,la){return X(Y,la,1,!1)},getNormal:function(Y,la){return X(Y,la,2,!0)},getWeightedNormal:function(Y,la){return X(Y,la,2,!1)},getCurvature:function(Y,la){return X(Y,la,3,!1).x},getPeaks:function(Y){var la=Y[0],sa=Y[1],va=Y[2],ba=Y[3],ha=Y[4],k=Y[5],p=-la+3*va-3*ha+Y[6];ha=3*la-6*va+3*ha;la=-3*la+3*va;Y=
-sa+3*ba-3*k+Y[7];k=3*sa-6*ba+3*k;sa=-3*sa+3*ba;ba=[];B.solveCubic(9*(p*p+Y*Y),9*(p*ha+k*Y),2*(ha*ha+k*k)+3*(la*p+sa*Y),la*ha+k*sa,ba,1E-8,.99999999);return ba.sort()}}}},new function(){function K(A,H,O,M,R,W,ma){var wa=!ma&&O.getPrevious()===R,Da=!ma&&O!==R&&O.getNext()===R;null!==M&&M>=(wa?1E-8:0)&&M<=(Da?.99999999:1)&&null!==W&&W>=(Da?1E-8:0)&&W<=(wa?.99999999:1)&&(O=new Na(O,M,null,ma),R=new Na(R,W,null,ma),O._intersection=R,R._intersection=O,H&&!H(O)||Na.insert(A,O,!0))}function X(A,H,O,M,R,
W,ma,wa,Da,Ea,Pa,Ha,Ma){if(4096<=++Da||40<=++wa)return Da;var Ta=H[0],Ka=H[1],Wa=H[6],bb=H[7],hb=aa.getSignedDistance,sb=hb(Ta,Ka,Wa,bb,H[2],H[3]),Ab=hb(Ta,Ka,Wa,bb,H[4],H[5]),La=0<sb*Ab?.75:4/9,Ra=La*Math.min(0,sb,Ab);La*=Math.max(0,sb,Ab);var Za=hb(Ta,Ka,Wa,bb,A[0],A[1]),cb=hb(Ta,Ka,Wa,bb,A[2],A[3]),gb=hb(Ta,Ka,Wa,bb,A[4],A[5]);Ta=hb(Ta,Ka,Wa,bb,A[6],A[7]);bb=[0,Za];hb=[1/3,cb];var kb=[2/3,gb],jb=[1,Ta];Ka=cb-(2*Za+Ta)/3;Wa=gb-(Za+2*Ta)/3;if(0>Ka*Wa)bb=[[bb,hb,jb],[bb,kb,jb]];else{var Db=Ka/Wa;
bb=[2<=Db?[bb,hb,jb]:.5>=Db?[bb,kb,jb]:[bb,hb,kb,jb],[bb,jb]]}Wa=0>(Ka||Wa)?bb.reverse():bb;Ka=Wa[0];Wa=Wa[1];var Ob,Mb;if(0===sb&&0===Ab&&0===Za&&0===cb&&0===gb&&0===Ta||null==(Ob=Y(Ka,Wa,Ra,La))||null==(Mb=Y(Ka.reverse(),Wa.reverse(),Ra,La)))return Da;sb=Ea+(Pa-Ea)*Ob;Ea+=(Pa-Ea)*Mb;1E-9>Math.max(Ma-Ha,Ea-sb)?(A=(sb+Ea)/2,H=(Ha+Ma)/2,K(R,W,ma?M:O,ma?H:A,ma?O:M,ma?A:H)):(A=za.getPart(A,Ob,Mb),Pa=Ma-Ha,.8<Mb-Ob?Ea-sb>Pa?(Ob=za.subdivide(A,.5),A=(sb+Ea)/2,Da=X(H,Ob[0],M,O,R,W,!ma,wa,Da,Ha,Ma,sb,A),
Da=X(H,Ob[1],M,O,R,W,!ma,wa,Da,Ha,Ma,A,Ea)):(Ob=za.subdivide(H,.5),H=(Ha+Ma)/2,Da=X(Ob[0],A,M,O,R,W,!ma,wa,Da,Ha,H,sb,Ea),Da=X(Ob[1],A,M,O,R,W,!ma,wa,Da,H,Ma,sb,Ea)):Da=0===Pa||1E-9<=Pa?X(H,A,M,O,R,W,!ma,wa,Da,Ha,Ma,sb,Ea):X(A,H,O,M,R,W,ma,wa,Da,sb,Ea,Ha,Ma));return Da}function Y(A,H,O,M){return A[0][1]<O?la(A,!0,O):H[0][1]>M?la(H,!1,M):A[0][0]}function la(A,H,O){for(var M=A[0][0],R=A[0][1],W=1,ma=A.length;W<ma;W++){var wa=A[W][0],Da=A[W][1];if(H?Da>=O:Da<=O)return Da===O?wa:M+(O-R)*(wa-M)/(Da-R);
M=wa;R=Da}return null}function sa(A,H,O,M,R){var W=B.isZero;if(W(M)&&W(R))return A=za.getTimeOf(A,new F(H,O)),null===A?[]:[A];R=Math.atan2(-R,M);M=Math.sin(R);R=Math.cos(R);W=[];for(var ma=[],wa=0;8>wa;wa+=2){var Da=A[wa]-H,Ea=A[wa+1]-O;W.push(Da*R-Ea*M,Da*M+Ea*R)}za.solveCubic(W,1,0,ma,0,1);return ma}function va(A,H,O,M,R,W,ma){var wa=H[0],Da=H[1];wa=sa(A,wa,Da,H[6]-wa,H[7]-Da);Da=0;for(var Ea=wa.length;Da<Ea;Da++){var Pa=wa[Da],Ha=za.getPoint(A,Pa);Ha=za.getTimeOf(H,Ha);null!==Ha&&K(R,W,ma?M:O,
ma?Ha:Pa,ma?O:M,ma?Pa:Ha)}}function ba(A,H,O,M,R,W){var ma=aa.intersect(A[0],A[1],A[6],A[7],H[0],H[1],H[6],H[7]);ma&&K(R,W,O,za.getTimeOf(A,ma),M,za.getTimeOf(H,ma))}function ha(A,H,O,M,R,W){var ma=Math.min,wa=Math.max;if(wa(A[0],A[2],A[4],A[6])+1E-12>ma(H[0],H[2],H[4],H[6])&&ma(A[0],A[2],A[4],A[6])-1E-12<wa(H[0],H[2],H[4],H[6])&&wa(A[1],A[3],A[5],A[7])+1E-12>ma(H[1],H[3],H[5],H[7])&&ma(A[1],A[3],A[5],A[7])-1E-12<wa(H[1],H[3],H[5],H[7]))if(wa=p(A,H))for(ma=0;2>ma;ma++)A=wa[ma],K(R,W,O,A[0],M,A[1],
!0);else{ma=za.isStraight(A);wa=za.isStraight(H);var Da=ma&&wa,Ea=ma&&!wa,Pa=R.length;(Da?ba:ma||wa?va:X)(Ea?H:A,Ea?A:H,Ea?M:O,Ea?O:M,R,W,Ea,0,0,0,1,0,1);if(!Da||R.length===Pa)for(ma=0;4>ma;ma++)wa=ma>>1,Da=ma&1,Pa=6*wa,Ea=6*Da,Pa=new F(A[Pa],A[Pa+1]),Ea=new F(H[Ea],H[Ea+1]),Pa.isClose(Ea,1E-12)&&K(R,W,O,wa,M,Da)}return R}function k(A,H,O,M){A=za.classify(A);"loop"===A.type&&(A=A.roots,K(O,M,H,A[0],H,A[1]));return O}function p(A,H){function O(Ka){var Wa=Ka[6]-Ka[0];Ka=Ka[7]-Ka[1];return Wa*Wa+Ka*
Ka}var M=Math.abs,R=aa.getDistance,W=za.isStraight(A),ma=za.isStraight(H),wa=W&&ma,Da=O(A)<O(H),Ea=Da?H:A;Da=Da?A:H;var Pa=Ea[0],Ha=Ea[1],Ma=Ea[6]-Pa,Ta=Ea[7]-Ha;if(1E-7>R(Pa,Ha,Ma,Ta,Da[0],Da[1],!0)&&1E-7>R(Pa,Ha,Ma,Ta,Da[6],Da[7],!0))!wa&&1E-7>R(Pa,Ha,Ma,Ta,Ea[2],Ea[3],!0)&&1E-7>R(Pa,Ha,Ma,Ta,Ea[4],Ea[5],!0)&&1E-7>R(Pa,Ha,Ma,Ta,Da[2],Da[3],!0)&&1E-7>R(Pa,Ha,Ma,Ta,Da[4],Da[5],!0)&&(W=ma=wa=!0);else if(wa)return null;if(W^ma)return null;W=[A,H];R=[];for(ma=0;4>ma&&2>R.length&&(Ea=ma&1,Pa=Ea^1,Da=
ma>>1,Pa=za.getTimeOf(W[Ea],new F(W[Pa][Da?6:0],W[Pa][Da?7:1])),null!=Pa&&(Ea=Ea?[Da,Pa]:[Pa,Da],(!R.length||1E-8<M(Ea[0]-R[0][0])&&1E-8<M(Ea[1]-R[0][1]))&&R.push(Ea)),!(2<ma)||R.length);ma++);2!==R.length?R=null:!wa&&(A=za.getPart(A,R[0][0],R[1][0]),H=za.getPart(H,R[0][1],R[1][1]),1E-7<M(H[2]-A[2])||1E-7<M(H[3]-A[3])||1E-7<M(H[4]-A[4])||1E-7<M(H[5]-A[5]))&&(R=null);return R}return{getIntersections:function(A){var H=this.getValues(),O=A&&A!==this&&A.getValues();return O?ha(H,O,this,A,[]):k(H,this,
[])},statics:{getOverlaps:p,getIntersections:function(A,H,O,M,R,W){var ma=!H;ma&&(H=A);for(var wa=A.length,Da=H.length,Ea=Array(wa),Pa=ma?Ea:Array(Da),Ha=[],Ma=0;Ma<wa;Ma++)Ea[Ma]=A[Ma].getValues(M);if(!ma)for(Ma=0;Ma<Da;Ma++)Pa[Ma]=H[Ma].getValues(R);M=q.findCurveBoundsCollisions(Ea,Pa,1E-7);for(R=0;R<wa;R++){Da=A[R];Ma=Ea[R];ma&&k(Ma,Da,Ha,O);var Ta=M[R];if(Ta)for(var Ka=0;Ka<Ta.length;Ka++){if(W&&Ha.length)return Ha;var Wa=Ta[Ka];(!ma||Wa>R)&&ha(Ma,Pa[Wa],Da,H[Wa],Ha,O)}}return Ha},getCurveLineIntersections:sa,
getTimesWithTangent:function(A,H){var O=A[0],M=A[1],R=A[2],W=A[3],ma=A[4],wa=A[5],Da=A[6],Ea=A[7];A=H.normalize();H=A.x;A=A.y;Da=3*Da-9*ma+9*R-3*O;Ea=3*Ea-9*wa+9*W-3*M;ma=6*ma-12*R+6*O;wa=6*wa-12*W+6*M;O=3*R-3*O;R=3*W-3*M;W=2*Da*A-2*Ea*H;M=[];Math.abs(W)<B.CURVETIME_EPSILON?(W=Da*wa-Ea*ma,0!=W&&(H=-(Da*R-Ea*O)/W,0<=H&&1>=H&&M.push(H))):(O=(ma*ma-4*Da*O)*A*A+(-2*ma*wa+4*Ea*O+4*Da*R)*H*A+(wa*wa-4*Ea*R)*H*H,H=ma*A-wa*H,0<=O&&0!=W&&(O=Math.sqrt(O),A=-(H+O)/W,H=(-H+O)/W,0<=A&&1>=A&&M.push(A),0<=H&&1>=
H&&M.push(H)));return M}}}}),Na=f.extend({_class:"CurveLocation",initialize:function(K,X,Y,la,sa){if(.99999999<=X){var va=K.getNext();va&&(X=0,K=va)}this._setCurve(K);this._time=X;this._point=Y||K.getPointAtTime(X);this._overlap=la;this._distance=sa;this._intersection=this._next=this._previous=null},_setCurve:function(K){var X=K._path;this._version=(this._path=X)?X._version:0;this._curve=K;this._segment=null;this._segment1=K._segment1;this._segment2=K._segment2},_setSegment:function(K){this._setCurve(K.getCurve());
this._segment=K;this._time=K===this._segment1?0:1;this._point=K._point.clone()},getSegment:function(){var K=this._segment;if(!K){var X=this.getCurve(),Y=this.getTime();0===Y?K=X._segment1:1===Y?K=X._segment2:null!=Y&&(K=X.getPartLength(0,Y)<X.getPartLength(Y,1)?X._segment1:X._segment2);this._segment=K}return K},getCurve:function(){function K(la){if((la=la&&la.getCurve())&&null!=(Y._time=la.getTimeOf(Y._point)))return Y._setCurve(la),la}var X=this._path,Y=this;X&&X._version!==this._version&&(this._time=
this._offset=this._curveOffset=this._curve=null);return this._curve||K(this._segment)||K(this._segment1)||K(this._segment2.getPrevious())},getPath:function(){var K=this.getCurve();return K&&K._path},getIndex:function(){var K=this.getCurve();return K&&K.getIndex()},getTime:function(){var K=this.getCurve(),X=this._time;return K&&null==X?this._time=K.getTimeOf(this._point):X},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var K=this._offset;if(null==K){K=0;var X=
this.getPath(),Y=this.getIndex();if(X&&null!=Y){X=X.getCurves();for(var la=0;la<Y;la++)K+=X[la].getLength()}this._offset=K+=this.getCurveOffset()}return K},getCurveOffset:function(){var K=this._curveOffset;if(null==K){K=this.getCurve();var X=this.getTime();this._curveOffset=K=null!=X&&K&&K.getPartLength(0,X)}return K},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var K=this.getCurve();(K=K&&K.divideAtTime(this.getTime()))&&this._setSegment(K._segment1);
return K},split:function(){var K=this.getCurve(),X=K._path;(K=K&&K.splitAtTime(this.getTime()))&&this._setSegment(X.getLastSegment());return K},equals:function(K,X){var Y=this===K;if(!Y&&K instanceof Na){var la=this.getCurve(),sa=K.getCurve();la=la._path;if(la===sa._path){Y=Math.abs;sa=Y(this.getOffset()-K.getOffset());var va=!X&&this._intersection;K=!X&&K._intersection;Y=(1E-7>sa||la&&1E-7>Y(la.getLength()-sa))&&(!va&&!K||va&&K&&va.equals(K,!0))}}return Y},toString:function(){var K=[],X=this.getPoint(),
Y=r.instance;X&&K.push("point: "+X);X=this.getIndex();null!=X&&K.push("index: "+X);X=this.getTime();null!=X&&K.push("time: "+Y.number(X));null!=this._distance&&K.push("distance: "+Y.number(this._distance));return"{ "+K.join(", ")+" }"},isTouching:function(){var K=this._intersection;if(K&&this.getTangent().isCollinear(K.getTangent())){var X=this.getCurve();K=K.getCurve();return!(X.isStraight()&&K.isStraight()&&X.getLine().intersect(K.getLine()))}return!1},isCrossing:function(){function K(M,R){var W=
M.getValues(),ma=za.classify(W).roots||za.getPeaks(W);M=ma.length;R=za.getLength(W,R&&M?ma[M-1]:0,!R&&M?ma[0]:1);A.push(M?R:R/64)}function X(M,R,W){return R<W?M>R&&M<W:M>R||M<W}var Y=this._intersection;if(!Y)return!1;var la=this.getTime(),sa=Y.getTime(),va=1E-8<=la&&.99999999>=la,ba=1E-8<=sa&&.99999999>=sa;if(va&&ba)return!this.isTouching();var ha=this.getCurve(),k=ha&&1E-8>la?ha.getPrevious():ha,p=Y.getCurve();Y=p&&1E-8>sa?p.getPrevious():p;.99999999<la&&(ha=ha.getNext());.99999999<sa&&(p=p.getNext());
if(!(k&&ha&&Y&&p))return!1;var A=[];va||(K(k,!0),K(ha,!1));ba||(K(Y,!0),K(p,!1));var H=this.getPoint(),O=Math.min.apply(Math,A);la=va?ha.getTangentAtTime(la):ha.getPointAt(O).subtract(H);k=va?la.negate():k.getPointAt(-O).subtract(H);sa=ba?p.getTangentAtTime(sa):p.getPointAt(O).subtract(H);Y=ba?sa.negate():Y.getPointAt(-O).subtract(H);ba=k.getAngle();H=la.getAngle();Y=Y.getAngle();sa=sa.getAngle();return!!(va?X(ba,Y,sa)^X(H,Y,sa)&&X(ba,sa,Y)^X(H,sa,Y):X(Y,ba,H)^X(sa,ba,H)&&X(Y,H,ba)^X(sa,H,ba))},hasOverlap:function(){return!!this._overlap}},
f.each(za._evaluateMethods,function(K){var X=K+"At";this[K]=function(){var Y=this.getCurve(),la=this.getTime();return null!=la&&Y&&Y[X](la,!0)}},{preserve:!0}),new function(){function K(X,Y,la){function sa(M,R){for(M+=R;-1<=M&&M<=va;M+=R){var W=X[(M%va+va)%va];if(!Y.getPoint().isClose(W.getPoint(),1E-7))break;if(Y.equals(W))return W}return null}for(var va=X.length,ba=0,ha=va-1;ba<=ha;){var k=ba+ha>>>1,p=X[k],A;if(la&&(A=Y.equals(p)?p:sa(k,-1)||sa(k,1)))return Y._overlap&&(A._overlap=A._intersection._overlap=
!0),A;var H=Y.getPath(),O=p.getPath();0>(H!==O?H._id-O._id:Y.getIndex()+Y.getTime()-(p.getIndex()+p.getTime()))?ha=k-1:ba=k+1}X.splice(ba,0,Y);return Y}return{statics:{insert:K,expand:function(X){for(var Y=X.slice(),la=X.length-1;0<=la;la--)K(Y,X[la]._intersection,!1);return Y}}}}),ya=P.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(K){if(f.isPlainObject(K)){var X=K.segments;var Y=K.pathData}else Array.isArray(K)?X=K:"string"===
typeof K&&(Y=K);if(X)var la=(Y=X[0])&&Array.isArray(Y[0]);else Y&&(la=1<(Y.match(/m/gi)||[]).length||/z\s*\S+/i.test(Y));return new (la?$a:Ia)(K)}},_asPathItem:function(){return this},isClockwise:function(){return 0<=this.getArea()},setClockwise:function(K){this.isClockwise()!=!!K&&this.reverse()},setPathData:function(K){function X(R,W){R=+la[R];sa&&(R+=va[W]);return R}function Y(R){return new F(X(R,"x"),X(R+1,"y"))}K=K&&K.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/ig);var la,sa=!1,va=new F,ba=new F;this.clear();
for(var ha=0,k=K&&K.length;ha<k;ha++){var p=K[ha],A=p[0],H=A.toLowerCase();p=(la=p.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g))&&la.length;sa=A===H;"z"!==O||/[mz]/.test(H)||this.moveTo(va);switch(H){case "m":case "l":var O="m"===H;for(A=0;A<p;A+=2)this[O?"moveTo":"lineTo"](va=Y(A)),O&&(ba=va,O=!1);var M=va;break;case "h":case "v":O="h"===H?"x":"y";va=va.clone();for(A=0;A<p;A++)va[O]=X(A,O),this.lineTo(va);M=va;break;case "c":for(A=0;A<p;A+=6)this.cubicCurveTo(Y(A),M=Y(A+2),va=Y(A+4));break;
case "s":for(A=0;A<p;A+=4)this.cubicCurveTo(/[cs]/.test(O)?va.multiply(2).subtract(M):va,M=Y(A),va=Y(A+2)),O=H;break;case "q":for(A=0;A<p;A+=4)this.quadraticCurveTo(M=Y(A),va=Y(A+2));break;case "t":for(A=0;A<p;A+=2)this.quadraticCurveTo(M=/[qt]/.test(O)?va.multiply(2).subtract(M):va,va=Y(A)),O=H;break;case "a":for(A=0;A<p;A+=7)this.arcTo(va=Y(A+5),new N(+la[A],+la[A+1]),+la[A+2],+la[A+4],+la[A+3]);break;case "z":this.closePath(1E-12),va=ba}O=H}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},
_contains:function(K){K=K.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(K):{};return K.onPath||!!("evenodd"===this.getFillRule()?K.windingL&1||K.windingR&1:K.winding)},getIntersections:function(K,X,Y,la){var sa=this===K||!K,va=this._matrix._orNullIfIdentity();Y=sa?va:(Y||K._matrix)._orNullIfIdentity();return sa||this.getBounds(va).intersects(K.getBounds(Y),1E-12)?za.getIntersections(this.getCurves(),!sa&&K.getCurves(),X,va,Y,la):[]},getCrossings:function(K){return this.getIntersections(K,
function(X){return X.isCrossing()})},getNearestLocation:function(){for(var K=F.read(arguments),X=this.getCurves(),Y=Infinity,la=null,sa=0,va=X.length;sa<va;sa++){var ba=X[sa].getNearestLocation(K);ba._distance<Y&&(Y=ba._distance,la=ba)}return la},getNearestPoint:function(){var K=this.getNearestLocation.apply(this,arguments);return K?K.getPoint():K},interpolate:function(K,X,Y){var la=!this._children,sa=la?"_segments":"_children",va=K[sa],ba=X[sa];sa=this[sa];if(!va||!ba||va.length!==ba.length)throw Error("Invalid operands in interpolate() call: "+
K+", "+X);var ha=sa.length;X=ba.length;if(ha<X)for(var k=la?Aa:Ia;ha<X;ha++)this.add(new k);else if(ha>X)this[la?"removeSegments":"removeChildren"](X,ha);for(ha=0;ha<X;ha++)sa[ha].interpolate(va[ha],ba[ha],Y);la&&(this.setClosed(K._closed),this._changed(9))},compare:function(K){var X=!1;if(K){var Y=this._children||[this];K=K._children?K._children.slice():[K];var la=Y.length,sa=K.length,va=[],ba=0;X=!0;var ha=q.findBoundsOverlaps(Y,K,B.GEOMETRIC_EPSILON);for(--la;0<=la&&X;la--){var k=Y[la];X=!1;var p=
ha[la];if(p)for(var A=p.length-1;0<=A&&!X;A--)k.compare(K[p[A]])&&(va[p[A]]||(va[p[A]]=!0,ba++),X=!0)}X=X&&ba===sa}return X}}),Ia=ya.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(K){this._closed=!1;this._segments=[];this._version=0;var X=arguments;(X=Array.isArray(K)?"object"===typeof K[0]?K:X:!K||K.size!==b||K.x===b&&K.point===b?null:X)&&0<X.length?this.setSegments(X):(this._curves=b,this._segmentSelection=0,X||"string"!==typeof K||(this.setPathData(K),K=null));
this._initialize(!X&&K)},_equals:function(K){return this._closed===K._closed&&f.equals(this._segments,K._segments)},copyContent:function(K){this.setSegments(K._segments);this._closed=K._closed},_changed:function Y(X){Y.base.call(this,X);if(X&8)if(this._length=this._area=b,X&32)this._version++;else{if(this._curves){X=0;for(var la=this._curves.length;X<la;X++)this._curves[X]._changed()}}else X&64&&(this._bounds=b)},getStyle:function(){var X=this._parent;return(X instanceof $a?X:this)._style},getSegments:function(){return this._segments},
setSegments:function(X){var Y=this.isFullySelected(),la=X&&X.length;this._segmentSelection=this._segments.length=0;this._curves=b;if(la){var sa=X[la-1];"boolean"===typeof sa&&(this.setClosed(sa),la--);this._add(Aa.readList(X,0,{},la))}Y&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var X=this._curves,Y=this._segments;if(!X){var la=this._countCurves();X=this._curves=Array(la);
for(var sa=0;sa<la;sa++)X[sa]=new za(this,Y[sa],Y[sa+1]||Y[0])}return X},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var X=this.getCurves();return X[X.length-1]},isClosed:function(){return this._closed},setClosed:function(X){if(this._closed!=(X=!!X)){this._closed=X;if(this._curves){var Y=this._curves.length=this._countCurves();X&&(this._curves[Y-1]=new za(this,this._segments[Y-1],this._segments[0]))}this._changed(41)}}},{beans:!0,getPathData:function(X,Y){function la(Da,
Ea){Da._transformCoordinates(X,ha);p=ha[0];A=ha[1];k?(wa.push("M"+ba.pair(p,A)),k=!1):(M=ha[2],R=ha[3],M===p&&R===A&&W===H&&ma===O?Ea||(Da=p-H,Ea=A-O,wa.push(0===Da?"v"+ba.number(Ea):0===Ea?"h"+ba.number(Da):"l"+ba.pair(Da,Ea))):wa.push("c"+ba.pair(W-H,ma-O)+" "+ba.pair(M-H,R-O)+" "+ba.pair(p-H,A-O)));H=p;O=A;W=ha[4];ma=ha[5]}var sa=this._segments,va=sa.length,ba=new r(Y),ha=Array(6),k=!0,p,A,H,O,M,R,W,ma,wa=[];if(!va)return"";for(Y=0;Y<va;Y++)la(sa[Y]);this._closed&&0<va&&(la(sa[0],!0),wa.push("z"));
return wa.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(X){for(var Y=this._segments,la=Array(6),sa=0,va=Y.length;sa<va;sa++)Y[sa]._transformCoordinates(X,la,!0);return!0},_add:function(X,Y){var la=this._segments,sa=this._curves,va=X.length,ba=null==Y;Y=ba?la.length:Y;for(var ha=0;ha<va;ha++){var k=X[ha];k._path&&(k=X[ha]=k.clone());k._path=this;k._index=Y+ha;k._selection&&this._updateSelection(k,0,k._selection)}if(ba)f.push(la,X);else for(la.splice.apply(la,
[Y,0].concat(X)),ha=Y+va,ba=la.length;ha<ba;ha++)la[ha]._index=ha;if(sa){ha=this._countCurves();la=Y=0<Y&&Y+va-1===ha?Y-1:Y;va=Math.min(Y+va,ha);X._curves&&(sa.splice.apply(sa,[Y,0].concat(X._curves)),la+=X._curves.length);for(ha=la;ha<va;ha++)sa.splice(ha,0,new za(this,null,null));this._adjustCurves(Y,va)}this._changed(41);return X},_adjustCurves:function(X,Y){for(var la=this._segments,sa=this._curves,va,ba=X;ba<Y;ba++)va=sa[ba],va._path=this,va._segment1=la[ba],va._segment2=la[ba+1]||la[0],va._changed();
if(va=sa[this._closed&&!X?la.length-1:X-1])va._segment2=la[X]||la[0],va._changed();if(va=sa[Y])va._segment1=la[Y],va._changed()},_countCurves:function(){var X=this._segments.length;return!this._closed&&0<X?X-1:X},add:function(X){var Y=arguments;return 1<Y.length&&"number"!==typeof X?this._add(Aa.readList(Y)):this._add([Aa.read(Y)])[0]},insert:function(X,Y){var la=arguments;return 2<la.length&&"number"!==typeof Y?this._add(Aa.readList(la,1),X):this._add([Aa.read(la,1)],X)[0]},addSegment:function(){return this._add([Aa.read(arguments)])[0]},
insertSegment:function(X){return this._add([Aa.read(arguments,1)],X)[0]},addSegments:function(X){return this._add(Aa.readList(X))},insertSegments:function(X,Y){return this._add(Aa.readList(Y),X)},removeSegment:function(X){return this.removeSegments(X,X+1)[0]||null},removeSegments:function(X,Y,la){X=X||0;Y=f.pick(Y,this._segments.length);var sa=this._segments,va=this._curves,ba=sa.length,ha=sa.splice(X,Y-X),k=ha.length;if(!k)return ha;for(var p=0;p<k;p++){var A=ha[p];A._selection&&this._updateSelection(A,
A._selection,0);A._index=A._path=null}p=X;for(A=sa.length;p<A;p++)sa[p]._index=p;if(va){X=0<X&&Y===ba+(this._closed?1:0)?X-1:X;va=va.splice(X,k);for(p=va.length-1;0<=p;p--)va[p]._path=null;la&&(ha._curves=va.slice(1));this._adjustCurves(X,X)}this._changed(41);return ha},clear:"#removeSegments",hasHandles:function(){for(var X=this._segments,Y=0,la=X.length;Y<la;Y++)if(X[Y].hasHandles())return!0;return!1},clearHandles:function(){for(var X=this._segments,Y=0,la=X.length;Y<la;Y++)X[Y].clearHandles()},
getLength:function(){if(null==this._length){for(var X=this.getCurves(),Y=0,la=0,sa=X.length;la<sa;la++)Y+=X[la].getLength();this._length=Y}return this._length},getArea:function(){var X=this._area;if(null==X){for(var Y=this._segments,la=this._closed,sa=X=0,va=Y.length;sa<va;sa++){var ba=sa+1===va;X+=za.getArea(za.getValues(Y[sa],Y[ba?0:sa+1],null,ba&&!la))}this._area=X}return X},isFullySelected:function(){var X=this._segments.length;return this.isSelected()&&0<X&&this._segmentSelection===7*X},setFullySelected:function(X){X&&
this._selectSegments(!0);this.setSelected(X)},setSelection:function la(Y){Y&1||this._selectSegments(!1);la.base.call(this,Y)},_selectSegments:function(Y){var la=this._segments,sa=la.length;Y=Y?7:0;this._segmentSelection=Y*sa;for(var va=0;va<sa;va++)la[va]._selection=Y},_updateSelection:function(Y,la,sa){Y._selection=sa;0<(this._segmentSelection+=sa-la)&&this.setSelected(!0)},divideAt:function(Y){Y=this.getLocationAt(Y);var la;return Y&&(la=Y.getCurve().divideAt(Y.getCurveOffset()))?la._segment1:null},
splitAt:function(Y){var la=this.getLocationAt(Y);Y=la&&la.index;la=la&&la.time;.99999999<la&&(Y++,la=0);var sa=this.getCurves();return 0<=Y&&Y<sa.length?(1E-8<=la&&sa[Y++].divideAtTime(la),Y=this.removeSegments(Y,this._segments.length,!0),this._closed?(this.setClosed(!1),la=this):(la=new Ia(P.NO_INSERT),la.insertAbove(this),la.copyAttributes(this)),la._add(Y,0),this.addSegment(Y[0]),la):null},split:function(Y,la){var sa;Y=la===b?Y:(sa=this.getCurves()[Y])&&sa.getLocationAtTime(la);return null!=Y?
this.splitAt(Y):null},join:function(Y,la){la=la||0;if(Y&&Y!==this){var sa=Y._segments,va=this.getLastSegment(),ba=Y.getLastSegment();if(!ba)return this;va&&va._point.isClose(ba._point,la)&&Y.reverse();ba=Y.getFirstSegment();va&&va._point.isClose(ba._point,la)?(va.setHandleOut(ba._handleOut),this._add(sa.slice(1))):((va=this.getFirstSegment())&&va._point.isClose(ba._point,la)&&Y.reverse(),ba=Y.getLastSegment(),va&&va._point.isClose(ba._point,la)?(va.setHandleIn(ba._handleIn),this._add(sa.slice(0,sa.length-
1),0)):this._add(sa.slice()));Y._closed&&this._add([sa[0]]);Y.remove()}Y=this.getFirstSegment();sa=this.getLastSegment();Y!==sa&&Y._point.isClose(sa._point,la)&&(Y.setHandleIn(sa._handleIn),sa.remove(),this.setClosed(!0));return this},reduce:function(Y){for(var la=this.getCurves(),sa=(Y=Y&&Y.simplify)?1E-7:0,va=la.length-1;0<=va;va--){var ba=la[va];!ba.hasHandles()&&(!ba.hasLength(sa)||Y&&ba.isCollinear(ba.getNext()))&&ba.remove()}return this},reverse:function(){this._segments.reverse();for(var Y=
0,la=this._segments.length;Y<la;Y++){var sa=this._segments[Y],va=sa._handleIn;sa._handleIn=sa._handleOut;sa._handleOut=va;sa._index=Y}this._curves=null;this._changed(9)},flatten:function(Y){Y=(new lb(this,Y||.25,256,!0)).parts;for(var la=Y.length,sa=[],va=0;va<la;va++)sa.push(new Aa(Y[va].curve.slice(0,2)));!this._closed&&0<la&&sa.push(new Aa(Y[la-1].curve.slice(6)));this.setSegments(sa)},simplify:function(Y){(Y=(new xb(this)).fit(Y||2.5))&&this.setSegments(Y);return!!Y},smooth:function(Y){function la(sb,
Ab){var La=sb&&sb.index;if(null!=La){var Ra=sb.path;if(Ra&&Ra!==sa)throw Error(sb._class+" "+La+" of "+Ra+" is not part of "+sa);Ab&&sb instanceof za&&La++}else La="number"===typeof sb?sb:Ab;return Math.min(0>La&&k?La%ha:0>La?La+ha:La,ha-1)}var sa=this,va=Y||{},ba=va.type||"asymmetric";Y=this._segments;var ha=Y.length,k=this._closed,p=k&&va.from===b&&va.to===b,A=la(va.from,0),H=la(va.to,ha-1);if(A>H)if(k)A-=ha;else{var O=A;A=H;H=O}if(/^(?:asymmetric|continuous)$/.test(ba)){var M="asymmetric"===ba;
ba=Math.min;va=H-A+1;var R=va-1,W=va=O=p?ba(va,4):1,ma=[];k||(va=ba(1,A),W=ba(1,ha-H-1));R+=va+W;if(!(1>=R)){ba=0;for(var wa=A-va;ba<=R;ba++,wa++)ma[ba]=Y[(0>wa?wa+ha:wa)%ha]._point;wa=ma[0]._x+2*ma[1]._x;var Da=ma[0]._y+2*ma[1]._y,Ea=2,Pa=R-1,Ha=[wa],Ma=[Da],Ta=[Ea];H=[];O=[];for(ba=1;ba<R;ba++){var Ka=ba<Pa,Wa=Ka?4:M?3:8,bb=Ka?2:M?0:1,hb=(Ka?1:M?1:2)/Ea;Ea=Ta[ba]=(Ka?4:M?2:7)-hb;wa=Ha[ba]=Wa*ma[ba]._x+bb*ma[ba+1]._x-hb*wa;Da=Ma[ba]=Wa*ma[ba]._y+bb*ma[ba+1]._y-hb*Da}H[Pa]=Ha[Pa]/Ta[Pa];O[Pa]=Ma[Pa]/
Ta[Pa];for(ba=R-2;0<=ba;ba--)H[ba]=(Ha[ba]-H[ba+1])/Ta[ba],O[ba]=(Ma[ba]-O[ba+1])/Ta[ba];H[R]=(3*ma[R]._x-H[Pa])/2;O[R]=(3*ma[R]._y-O[Pa])/2;ba=va;M=R-W;for(wa=A;ba<=M;ba++,wa++)A=Y[0>wa?wa+ha:wa],W=A._point,R=H[ba]-W._x,W=O[ba]-W._y,(p||ba<M)&&A.setHandleOut(R,W),(p||ba>va)&&A.setHandleIn(-R,-W)}}else for(ba=A;ba<=H;ba++)Y[0>ba?ba+ha:ba].smooth(va,!p&&ba===A,!p&&ba===H)},toShape:function(Y){function la(M,R){M=ha[M];var W=M.getNext();R=ha[R];var ma=R.getNext();return M._handleOut.isZero()&&W._handleIn.isZero()&&
R._handleOut.isZero()&&ma._handleIn.isZero()&&W._point.subtract(M._point).isCollinear(ma._point.subtract(R._point))}function sa(M){M=ha[M];var R=M.getPrevious(),W=M.getNext();return R._handleOut.isZero()&&M._handleIn.isZero()&&M._handleOut.isZero()&&W._handleIn.isZero()&&M._point.subtract(R._point).isOrthogonal(W._point.subtract(M._point))}function va(M){var R=ha[M],W=R.getNext();M=R._handleOut;var ma=W._handleIn;if(M.isOrthogonal(ma)){R=R._point;W=W._point;var wa=(new aa(R,M,!0)).intersect(new aa(W,
ma,!0),!0);return wa&&B.isZero(M.getLength()/wa.subtract(R).getLength()-.5522847498307936)&&B.isZero(ma.getLength()/wa.subtract(W).getLength()-.5522847498307936)}return!1}function ba(M,R){return ha[M]._point.getDistance(ha[R]._point)}if(!this._closed)return null;var ha=this._segments;if(!this.hasHandles()&&4===ha.length&&la(0,2)&&la(1,3)&&sa(1)){var k=Fa.Rectangle;var p=new N(ba(0,3),ba(0,1));var A=ha[1]._point.add(ha[2]._point).divide(2)}else if(8===ha.length&&va(0)&&va(2)&&va(4)&&va(6)&&la(1,5)&&
la(3,7)){k=Fa.Rectangle;p=new N(ba(1,6),ba(0,3));var H=p.subtract(new N(ba(0,7),ba(1,2))).divide(2);A=ha[3]._point.add(ha[4]._point).divide(2)}else 4===ha.length&&va(0)&&va(1)&&va(2)&&va(3)&&(B.isZero(ba(0,2)-ba(1,3))?(k=Fa.Circle,H=ba(0,2)/2):(k=Fa.Ellipse,H=new N(ba(2,0)/2,ba(3,1)/2)),A=ha[1]._point);if(k){var O=this.getPosition(!0);k=new k({center:O,size:p,radius:H,insert:!1});k.copyAttributes(this,!0);k._matrix.prepend(this._matrix);k.rotate(A.subtract(O).getAngle()+90);(Y===b||Y)&&k.insertAbove(this);
return k}return null},toPath:"#clone",compare:function sa(la){if(!la||la instanceof $a)return sa.base.call(this,la);var va=this.getCurves();la=la.getCurves();var ba=va.length,ha=la.length;if(!ba||!ha)return ba==ha;for(var k=va[0].getValues(),p=[],A=0,H,O=0,M,R=0;R<ha;R++){var W=la[R].getValues();p.push(W);var ma=za.getOverlaps(k,W);if(ma){H=!R&&0<ma[0][0]?ha-1:R;M=ma[0][1];break}}R=Math.abs;W=p[H];for(var wa;k&&W;){if((ma=za.getOverlaps(k,W))&&1E-8>R(ma[0][0]-O)){O=ma[1][0];1===O&&(k=++A<ba?va[A].getValues():
null,O=0);var Da=ma[0][1];if(1E-8>R(Da-M)){wa||=[H,Da];M=ma[1][1];1===M&&(++H>=ha&&(H=0),W=p[H]||la[H].getValues(),M=0);if(!k)return wa[0]===H&&wa[1]===M;continue}}break}return!1},_hitTestSelf:function(la,sa,va,ba){function ha(sb,Ab){return 1>=la.subtract(sb).divide(Ab).length}function k(sb,Ab,La){if(!sa.selected||Ab.isSelected()){var Ra=sb._point;Ab!==Ra&&(Ab=Ab.add(Ra));if(ha(Ab,wa))return new Ga(La,O,{segment:sb,point:Ab})}}function p(sb,Ab){return(Ab||sa.segments)&&k(sb,sb._point,"segment")||
!Ab&&sa.handles&&(k(sb,sb._handleIn,"handle-in")||k(sb,sb._handleOut,"handle-out"))}function A(sb){Da.add(sb)}function H(sb){var Ab=W||0<sb._index&&sb._index<R-1;if("round"===(Ab?Wa:bb))return ha(sb._point,wa);Da=new Ia({internal:!0,closed:!0});Ab?sb.isSmooth()||Ia._addBevelJoin(sb,Wa,Ka,hb,null,ba,A,!0):"square"===bb&&Ia._addSquareCap(sb,bb,Ka,null,ba,A,!0);if(!Da.isEmpty()){var La;return Da.contains(la)||(La=Da.getNearestLocation(la))&&ha(La.getPoint(),ma)}}var O=this,M=this.getStyle();va=this._segments;
var R=va.length,W=this._closed,ma=sa._tolerancePadding,wa=ma,Da,Ea,Pa,Ha=sa.stroke&&M.hasStroke(),Ma=sa.fill&&M.hasFill(),Ta=sa.curves,Ka=Ha?M.getStrokeWidth()/2:Ma&&0<sa.tolerance||Ta?0:null;if(null!==Ka)if(0<Ka){var Wa=M.getStrokeJoin();var bb=M.getStrokeCap();var hb=M.getMiterLimit();wa=wa.add(Ia._getStrokePadding(Ka,ba))}else Wa=bb="round";if(sa.ends&&!sa.segments&&!W){if(Pa=p(va[0],!0)||p(va[R-1],!0))return Pa}else if(sa.segments||sa.handles)for(M=0;M<R;M++)if(Pa=p(va[M]))return Pa;if(null!==
Ka){if(Ea=this.getNearestLocation(la))M=Ea.getTime(),0===M||1===M&&1<R?H(Ea.getSegment())||(Ea=null):ha(Ea.getPoint(),wa)||(Ea=null);if(!Ea&&"miter"===Wa&&1<R)for(M=0;M<R;M++)if(Pa=va[M],la.getDistance(Pa._point)<=hb*Ka&&H(Pa)){Ea=Pa.getLocation();break}}return!Ea&&Ma&&this._contains(la)||Ea&&!Ha&&!Ta?new Ga("fill",this):Ea?new Ga(Ha?"stroke":"curve",this,{location:Ea,point:Ea.getPoint()}):null}},f.each(za._evaluateMethods,function(la){this[la+"At"]=function(sa){return(sa=this.getLocationAt(sa))&&
sa[la]()}},{beans:!1,getLocationOf:function(){for(var la=F.read(arguments),sa=this.getCurves(),va=0,ba=sa.length;va<ba;va++){var ha=sa[va].getLocationOf(la);if(ha)return ha}return null},getOffsetOf:function(){var la=this.getLocationOf.apply(this,arguments);return la?la.getOffset():null},getLocationAt:function(la){if("number"===typeof la){for(var sa=this.getCurves(),va=0,ba=0,ha=sa.length;ba<ha;ba++){var k=va,p=sa[ba];va+=p.getLength();if(va>la)return p.getLocationAt(la-k)}if(0<sa.length&&la<=this.getLength())return new Na(sa[sa.length-
1],1)}else if(la&&la.getPath&&la.getPath()===this)return la;return null},getOffsetsWithTangent:function(){var la=F.read(arguments);if(la.isZero())return[];for(var sa=[],va=0,ba=this.getCurves(),ha=0,k=ba.length;ha<k;ha++){for(var p=ba[ha],A=p.getTimesWithTangent(la),H=0,O=A.length;H<O;H++){var M=va+p.getOffsetAtTime(A[H]);0>sa.indexOf(M)&&sa.push(M)}va+=p.length}return sa}}),new function(){function la(va,ba,ha,k){function p(Pa){var Ha=M[Pa];Pa=M[Pa+1];if(R!=Ha||W!=Pa)va.beginPath(),va.moveTo(R,W),
va.lineTo(Ha,Pa),va.stroke(),va.beginPath(),va.arc(Ha,Pa,A,0,2*Math.PI,!0),va.fill()}if(!(0>=k))for(var A=k/2,H=k-2,O=A-1,M=Array(6),R,W,ma=0,wa=ba.length;ma<wa;ma++){var Da=ba[ma],Ea=Da._selection;Da._transformCoordinates(ha,M);R=M[0];W=M[1];Ea&2&&p(2);Ea&4&&p(4);va.fillRect(R-A,W-A,k,k);0<H&&!(Ea&1)&&(Da=va.fillStyle,va.fillStyle="#ffffff",va.fillRect(R-O,W-O,H,H),va.fillStyle=Da)}}function sa(va,ba,ha){function k(Ma){if(ha)Ma._transformCoordinates(ha,H),M=H[0],R=H[1];else{var Ta=Ma._point;M=Ta._x;
R=Ta._y}O?(va.moveTo(M,R),O=!1):(ha?(wa=H[2],Da=H[3]):(Ta=Ma._handleIn,wa=M+Ta._x,Da=R+Ta._y),wa===M&&Da===R&&Ea===W&&Pa===ma?va.lineTo(M,R):va.bezierCurveTo(Ea,Pa,wa,Da,M,R));W=M;ma=R;ha?(Ea=H[4],Pa=H[5]):(Ta=Ma._handleOut,Ea=W+Ta._x,Pa=ma+Ta._y)}for(var p=ba._segments,A=p.length,H=Array(6),O=!0,M,R,W,ma,wa,Da,Ea,Pa,Ha=0;Ha<A;Ha++)k(p[Ha]);ba._closed&&0<A&&k(p[0])}return{_draw:function(va,ba,ha,k){function p(wa){return W[(wa%ma+ma)%ma]}var A=ba.dontStart,H=ba.dontFinish||ba.clip,O=this.getStyle(),
M=O.hasFill(),R=O.hasStroke(),W=O.getDashArray(),ma=!ib.support.nativeDash&&R&&W&&W.length;A||va.beginPath();if(M||R&&!ma||H)sa(va,this,k),this._closed&&va.closePath();if(!H&&(M||R)&&(this._setStyles(va,ba,ha),M&&(va.fill(O.getFillRule()),va.shadowColor="rgba(0,0,0,0)"),R)){if(ma){A||va.beginPath();ba=new lb(this,.25,32,!1,k);ha=ba.length;O=-O.getDashOffset();A=0;for(O%=ha;0<O;)O-=p(A--)+p(A--);for(;O<ha;)k=O+p(A++),(0<O||0<k)&&ba.drawPart(va,Math.max(O,0),Math.max(k,0)),O=k+p(A++)}va.stroke()}},
_drawSelected:function(va,ba){va.beginPath();sa(va,this,ba);va.stroke();la(va,this._segments,ba,ib.settings.handleSize)}}},new function(){function la(sa){sa=sa._segments;if(!sa.length)throw Error("Use a moveTo() command first");return sa[sa.length-1]}return{moveTo:function(){var sa=this._segments;1===sa.length&&this.removeSegment(0);sa.length||this._add([new Aa(F.read(arguments))])},moveBy:function(){throw Error("moveBy() is unsupported on Path items.");},lineTo:function(){this._add([new Aa(F.read(arguments))])},
cubicCurveTo:function(){var sa=arguments,va=F.read(sa),ba=F.read(sa);sa=F.read(sa);var ha=la(this);ha.setHandleOut(va.subtract(ha._point));this._add([new Aa(sa,ba.subtract(sa))])},quadraticCurveTo:function(){var sa=arguments,va=F.read(sa);sa=F.read(sa);var ba=la(this)._point;this.cubicCurveTo(va.add(ba.subtract(va).multiply(1/3)),va.add(sa.subtract(va).multiply(1/3)),sa)},curveTo:function(){var sa=arguments,va=F.read(sa),ba=F.read(sa);sa=f.pick(f.read(sa),.5);var ha=1-sa,k=la(this)._point;va=va.subtract(k.multiply(ha*
ha)).subtract(ba.multiply(sa*sa)).divide(2*sa*ha);if(va.isNaN())throw Error("Cannot put a curve through points with parameter = "+sa);this.quadraticCurveTo(va,ba)},arcTo:function(){var sa=arguments,va=Math.abs,ba=Math.sqrt,ha=la(this),k=ha._point,p=F.read(sa),A=f.peek(sa);A=f.pick(A,!0);if("boolean"===typeof A){sa=k.add(p).divide(2);var H=sa.add(sa.subtract(k).rotate(A?-90:90))}else if(2>=f.remain(sa))H=p,p=F.read(sa);else if(!k.equals(p)){var O=N.read(sa);var M=B.isZero;if(M(O.width)||M(O.height))return this.lineTo(p);
var R=f.read(sa);A=!!f.read(sa);M=!!f.read(sa);sa=k.add(p).divide(2);var W=k.subtract(sa).rotate(-R);var ma=W.x;var wa=W.y;W=va(O.width);O=va(O.height);var Da=W*W,Ea=O*O,Pa=ma*ma,Ha=wa*wa,Ma=ba(Pa/Da+Ha/Ea);1<Ma&&(W*=Ma,O*=Ma,Da=W*W,Ea=O*O);Ma=(Da*Ea-Da*Ha-Ea*Pa)/(Da*Ha+Ea*Pa);1E-12>va(Ma)&&(Ma=0);if(0>Ma)throw Error("Cannot create an arc with the given arguments");M=(new F(W*wa/O,-O*ma/W)).multiply((M===A?-1:1)*ba(Ma)).rotate(R).add(sa);R=(new Q).translate(M).rotate(R).scale(W,O);ma=R._inverseTransform(k);
W=ma.getDirectedAngle(R._inverseTransform(p));!A&&0<W?W-=360:A&&0>W&&(W+=360)}if(H){M=new aa(k.add(H).divide(2),H.subtract(k).rotate(90),!0);ma=new aa(H.add(p).divide(2),p.subtract(H).rotate(90),!0);ba=new aa(k,p);H=ba.getSide(H);M=M.intersect(ma,!0);if(!M){if(!H)return this.lineTo(p);throw Error("Cannot create an arc with the given arguments");}ma=k.subtract(M);W=ma.getDirectedAngle(p.subtract(M));k=ba.getSide(M,!0);0===k?W=H*va(W):H===k&&(W+=0>W?360:-360)}if(W){va=va(W);va=360<=va?4:Math.ceil((va-
1E-7)/90);k=W/va;H=k*Math.PI/360;H=4/3*Math.sin(H)/(1+Math.cos(H));ba=[];for(A=0;A<=va;A++)W=p,sa=null,A<va&&(sa=ma.rotate(90).multiply(H),R?(W=R._transformPoint(ma),sa=R._transformPoint(ma.add(sa)).subtract(W)):W=M.add(ma)),A?(wa=ma.rotate(-90).multiply(H),R&&(wa=R._transformPoint(ma.add(wa)).subtract(W)),ba.push(new Aa(W,wa,sa))):ha.setHandleOut(sa),ma=ma.rotate(k);this._add(ba)}},lineBy:function(){var sa=F.read(arguments),va=la(this)._point;this.lineTo(va.add(sa))},curveBy:function(){var sa=arguments,
va=F.read(sa),ba=F.read(sa);sa=f.read(sa);var ha=la(this)._point;this.curveTo(ha.add(va),ha.add(ba),sa)},cubicCurveBy:function(){var sa=arguments,va=F.read(sa),ba=F.read(sa);sa=F.read(sa);var ha=la(this)._point;this.cubicCurveTo(ha.add(va),ha.add(ba),ha.add(sa))},quadraticCurveBy:function(){var sa=arguments,va=F.read(sa);sa=F.read(sa);var ba=la(this)._point;this.quadraticCurveTo(ba.add(va),ba.add(sa))},arcBy:function(){var sa=arguments,va=la(this)._point,ba=va.add(F.read(sa)),ha=f.pick(f.peek(sa),
!0);"boolean"===typeof ha?this.arcTo(ba,ha):this.arcTo(ba,va.add(F.read(sa)))},closePath:function(sa){this.setClosed(!0);this.join(this,sa)}}},{_getBounds:function(la,sa){return Ia[sa.handle?"getHandleBounds":sa.stroke?"getStrokeBounds":"getBounds"](this._segments,this._closed,this,la,sa)},statics:{getBounds:function(la,sa,va,ba,ha,k){function p(ma){ma._transformCoordinates(ba,A);for(ma=0;2>ma;ma++)za._addBounds(H[ma],H[ma+4],A[ma+2],A[ma],ma,k?k[ma]:0,O,M,R);ma=H;H=A;A=ma}va=la[0];if(!va)return new V;
var A=Array(6),H=va._transformCoordinates(ba,Array(6)),O=H.slice(0,2),M=O.slice(),R=Array(2);ha=1;for(var W=la.length;ha<W;ha++)p(la[ha]);sa&&p(va);return new V(O[0],O[1],M[0]-O[0],M[1]-O[1])},getStrokeBounds:function(la,sa,va,ba,ha){function k(Pa){ma=ma.include(Pa)}function p(Pa,Ha){"round"===Ha||Pa.isSmooth()?ma=ma.unite(Ea.setCenter(Pa._point.transform(ba))):Ia._addBevelJoin(Pa,Ha,wa,Da,ba,R,k)}function A(Pa,Ha){"round"===Ha?ma=ma.unite(Ea.setCenter(Pa._point.transform(ba))):Ia._addSquareCap(Pa,
Ha,wa,ba,R,k)}var H=va.getStyle(),O=H.hasStroke(),M=H.getStrokeWidth(),R=O&&va._getStrokeMatrix(ba,ha),W=O&&Ia._getStrokePadding(M,R),ma=Ia.getBounds(la,sa,va,ba,ha,W);if(!O)return ma;var wa=M/2;va=H.getStrokeJoin();ha=H.getStrokeCap();var Da=H.getMiterLimit(),Ea=new V(new N(W));H=la.length-(sa?0:1);for(W=1;W<H;W++)p(la[W],va);sa?p(la[0],va):0<H&&(A(la[0],ha),A(la[la.length-1],ha));return ma},_getStrokePadding:function(la,sa){if(!sa)return[la,la];var va=(new F(la,0)).transform(sa);la=(new F(0,la)).transform(sa);
var ba=va.getAngleInRadians();va=va.getLength();la=la.getLength();sa=Math.sin(ba);var ha=Math.cos(ba),k=Math.tan(ba);ba=Math.atan2(la*k,va);k=Math.atan2(la,k*va);return[Math.abs(va*Math.cos(ba)*ha+la*Math.sin(ba)*sa),Math.abs(la*Math.sin(k)*ha+va*Math.cos(k)*sa)]},_addBevelJoin:function(la,sa,va,ba,ha,k,p,A){la=la.getCurve();var H=la.getPrevious();ha=la.getPoint1().transform(ha);H=H.getNormalAtTime(1).multiply(va).transform(k);k=la.getNormalAtTime(0).multiply(va).transform(k);la=H.getDirectedAngle(k);
if(0>la||180<=la)H=H.negate(),k=k.negate();A&&p(ha);p(ha.add(H));"miter"===sa&&(sa=(new aa(ha.add(H),new F(-H.y,H.x),!0)).intersect(new aa(ha.add(k),new F(-k.y,k.x),!0),!0))&&ha.getDistance(sa)<=ba*va&&p(sa);p(ha.add(k))},_addSquareCap:function(la,sa,va,ba,ha,k,p){ba=la._point.transform(ba);la=la.getLocation();va=la.getNormal().multiply(0===la.getTime()?va:-va).transform(ha);"square"===sa&&(p&&(k(ba.subtract(va)),k(ba.add(va))),ba=ba.add(va.rotate(-90)));k(ba.add(va));k(ba.subtract(va))},getHandleBounds:function(la,
sa,va,ba,ha){sa=va.getStyle();var k;if(ha.stroke&&sa.hasStroke()){var p=va._getStrokeMatrix(ba,ha);va=k=sa.getStrokeWidth()/2;"miter"===sa.getStrokeJoin()&&(va=k*sa.getMiterLimit());"square"===sa.getStrokeCap()&&(va=Math.max(va,k*Math.SQRT2));k=Ia._getStrokePadding(k,p);p=Ia._getStrokePadding(va,p)}sa=Array(6);va=Infinity;ha=-va;for(var A=va,H=ha,O=0,M=la.length;O<M;O++){la[O]._transformCoordinates(ba,sa);for(var R=0;6>R;R+=2){var W=R?k:p,ma=W?W[0]:0,wa=W?W[1]:0,Da=sa[R],Ea=sa[R+1];W=Da-ma;ma=Da+
ma;Da=Ea-wa;wa=Ea+wa;W<va&&(va=W);ma>ha&&(ha=ma);Da<A&&(A=Da);wa>H&&(H=wa)}}return new V(va,A,ha-va,H-A)}}});Ia.inject({statics:new function(){function la(ba,ha,k){k=f.getNamed(k);var p=new Ia(k&&0==k.insert&&P.NO_INSERT);p._add(ba);p._closed=ha;return p.set(k,{insert:!0})}function sa(ba,ha,k){for(var p=Array(4),A=0;4>A;A++){var H=va[A];p[A]=new Aa(H._point.multiply(ha).add(ba),H._handleIn.multiply(ha),H._handleOut.multiply(ha))}return la(p,!0,k)}var va=[new Aa([-1,0],[0,.5522847498307936],[0,-.5522847498307936]),
new Aa([0,-1],[-.5522847498307936,0],[.5522847498307936,0]),new Aa([1,0],[0,-.5522847498307936],[0,.5522847498307936]),new Aa([0,1],[.5522847498307936,0],[-.5522847498307936,0])];return{Line:function(){var ba=arguments;return la([new Aa(F.readNamed(ba,"from")),new Aa(F.readNamed(ba,"to"))],!1,ba)},Circle:function(){var ba=arguments,ha=F.readNamed(ba,"center"),k=f.readNamed(ba,"radius");return sa(ha,new N(k),ba)},Rectangle:function(){var ba=arguments,ha=V.readNamed(ba,"rectangle"),k=N.readNamed(ba,
"radius",0,{readNull:!0}),p=ha.getBottomLeft(!0),A=ha.getTopLeft(!0),H=ha.getTopRight(!0),O=ha.getBottomRight(!0);if(!k||k.isZero())p=[new Aa(p),new Aa(A),new Aa(H),new Aa(O)];else{k=N.min(k,ha.getSize(!0).divide(2));ha=k.width;k=k.height;var M=.5522847498307936*ha,R=.5522847498307936*k;p=[new Aa(p.add(ha,0),null,[-M,0]),new Aa(p.subtract(0,k),[0,R]),new Aa(A.add(0,k),null,[0,-R]),new Aa(A.add(ha,0),[-M,0],null),new Aa(H.subtract(ha,0),null,[M,0]),new Aa(H.add(0,k),[0,-R],null),new Aa(O.subtract(0,
k),null,[0,R]),new Aa(O.subtract(ha,0),[M,0])]}return la(p,!0,ba)},RoundRectangle:"#Rectangle",Ellipse:function(){var ba=arguments,ha=Fa._readEllipse(ba);return sa(ha.center,ha.radius,ba)},Oval:"#Ellipse",Arc:function(){var ba=arguments,ha=F.readNamed(ba,"from"),k=F.readNamed(ba,"through"),p=F.readNamed(ba,"to");ba=f.getNamed(ba);var A=new Ia(ba&&0==ba.insert&&P.NO_INSERT);A.moveTo(ha);A.arcTo(k,p);return A.set(ba)},RegularPolygon:function(){var ba=arguments,ha=F.readNamed(ba,"center"),k=f.readNamed(ba,
"sides"),p=f.readNamed(ba,"radius"),A=360/k,H=0===k%3;p=new F(0,H?-p:p);H=H?-1:.5;for(var O=Array(k),M=0;M<k;M++)O[M]=new Aa(ha.add(p.rotate((M+H)*A)));return la(O,!0,ba)},Star:function(){for(var ba=arguments,ha=F.readNamed(ba,"center"),k=2*f.readNamed(ba,"points"),p=f.readNamed(ba,"radius1"),A=f.readNamed(ba,"radius2"),H=360/k,O=new F(0,-1),M=Array(k),R=0;R<k;R++)M[R]=new Aa(ha.add(O.rotate(H*R).multiply(R%2?A:p)));return la(M,!0,ba)}}}});var $a=ya.extend({_class:"CompoundPath",_serializeFields:{children:[]},
beans:!0,initialize:function(la){this._children=[];this._namedChildren={};this._initialize(la)||("string"===typeof la?this.setPathData(la):this.addChildren(Array.isArray(la)?la:arguments))},insertChildren:function ba(sa,va){var ha=va,k=ha[0];k&&"number"===typeof k[0]&&(ha=[ha]);for(k=va.length-1;0<=k;k--){var p=ha[k];ha!==va||p instanceof Ia||(ha=f.slice(ha));Array.isArray(p)?ha[k]=new Ia({segments:p,insert:!1}):p instanceof $a&&(ha.splice.apply(ha,[k,1].concat(p.removeChildren())),p.remove())}return ba.base.call(this,
sa,ha)},reduce:function ba(va){for(var ha=this._children,k=ha.length-1;0<=k;k--){var p=ha[k].reduce(va);p.isEmpty()&&p.remove()}return ha.length?ba.base.call(this):(p=new Ia(P.NO_INSERT),p.copyAttributes(this),p.insertAbove(this),this.remove(),p)},isClosed:function(){for(var va=this._children,ba=0,ha=va.length;ba<ha;ba++)if(!va[ba]._closed)return!1;return!0},setClosed:function(va){for(var ba=this._children,ha=0,k=ba.length;ha<k;ha++)ba[ha].setClosed(va)},getFirstSegment:function(){var va=this.getFirstChild();
return va&&va.getFirstSegment()},getLastSegment:function(){var va=this.getLastChild();return va&&va.getLastSegment()},getCurves:function(){for(var va=this._children,ba=[],ha=0,k=va.length;ha<k;ha++)f.push(ba,va[ha].getCurves());return ba},getFirstCurve:function(){var va=this.getFirstChild();return va&&va.getFirstCurve()},getLastCurve:function(){var va=this.getLastChild();return va&&va.getLastCurve()},getArea:function(){for(var va=this._children,ba=0,ha=0,k=va.length;ha<k;ha++)ba+=va[ha].getArea();
return ba},getLength:function(){for(var va=this._children,ba=0,ha=0,k=va.length;ha<k;ha++)ba+=va[ha].getLength();return ba},getPathData:function(va,ba){for(var ha=this._children,k=[],p=0,A=ha.length;p<A;p++){var H=ha[p],O=H._matrix;k.push(H.getPathData(va&&!O.isIdentity()?va.appended(O):va,ba))}return k.join("")},_hitTestChildren:function p(ba,ha,k){return p.base.call(this,ba,ha.class===Ia||"path"===ha.type?ha:f.set({},ha,{fill:!1}),k)},_draw:function(ba,ha,k,p){var A=this._children;if(A.length){ha=
ha.extend({dontStart:!0,dontFinish:!0});ba.beginPath();for(var H=0,O=A.length;H<O;H++)A[H].draw(ba,ha,p);ha.clip||(this._setStyles(ba,ha,k),ha=this._style,ha.hasFill()&&(ba.fill(ha.getFillRule()),ba.shadowColor="rgba(0,0,0,0)"),ha.hasStroke()&&ba.stroke())}},_drawSelected:function(ba,ha,k){for(var p=this._children,A=0,H=p.length;A<H;A++){var O=p[A],M=O._matrix;k[O._id]||O._drawSelected(ba,M.isIdentity()?ha:ha.appended(M))}}},new function(){function ba(ha,k){ha=ha._children;if(k&&!ha.length)throw Error("Use a moveTo() command first");
return ha[ha.length-1]}return f.each("lineTo cubicCurveTo quadraticCurveTo curveTo arcTo lineBy cubicCurveBy quadraticCurveBy curveBy arcBy".split(" "),function(ha){this[ha]=function(){var k=ba(this,!0);k[ha].apply(k,arguments)}},{moveTo:function(){var ha=ba(this),k=ha&&ha.isEmpty()?ha:new Ia(P.NO_INSERT);k!==ha&&this.addChild(k);k.moveTo.apply(k,arguments)},moveBy:function(){var ha=ba(this,!0);ha=ha&&ha.getLastSegment();var k=F.read(arguments);this.moveTo(ha?k.add(ha._point):k)},closePath:function(ha){ba(this,
!0).closePath(ha)}})},f.each(["reverse","flatten","simplify","smooth"],function(ba){this[ba]=function(ha){for(var k=this._children,p,A=0,H=k.length;A<H;A++)p=k[A][ba](ha)||p;return p}},{}));ya.inject(new function(){function ba(Ma,Ta){var Ka=Ma.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);if(Ta){Ta=Ka._children||[Ka];for(var Wa=0,bb=Ta.length;Wa<bb;Wa++)Ma=Ta[Wa],Ma._closed||Ma.isEmpty()||(Ma.closePath(1E-12),Ma.getFirstSegment().setHandleIn(0,0),Ma.getLastSegment().setHandleOut(0,0));Ka=
Ka.resolveCrossings().reorient("nonzero"===Ka.getFillRule(),!0)}return Ka}function ha(Ma,Ta,Ka,Wa,bb){var hb=new $a(P.NO_INSERT);hb.addChildren(Ma,!0);hb=hb.reduce({simplify:Ta});bb&&0==bb.insert||hb.insertAbove(Wa&&Ka.isSibling(Wa)&&Ka.getIndex()<Wa.getIndex()?Wa:Ka);hb.copyAttributes(Ka,!0);return hb}function k(Ma){return Ma.hasOverlap()||Ma.isCrossing()}function p(Ma,Ta,Ka,Wa){function bb(Ob){for(var Mb=0,ec=Ob.length;Mb<ec;Mb++){var kc=Ob[Mb];f.push(cb,kc._segments);f.push(gb,kc.getCurves());
kc._overlapsOnly=!0}}function hb(Ob){for(var Mb=[],ec=0,kc=Ob&&Ob.length;ec<kc;ec++)Mb.push(gb[Ob[ec]]);return Mb}if(Wa&&(0==Wa.trace||Wa.stroke)&&/^(subtract|intersect)$/.test(Ka))return A(Ma,Ta,Ka);var sb=ba(Ma,!0),Ab=Ta&&Ma!==Ta&&ba(Ta,!0),La=Ha[Ka];La[Ka]=!0;Ab&&(La.subtract||La.exclude)^Ab.isClockwise()^sb.isClockwise()&&Ab.reverse();Ka=R(Na.expand(sb.getIntersections(Ab,k)));var Ra=sb._children||[sb],Za=Ab&&(Ab._children||[Ab]),cb=[],gb=[];if(Ka.length){bb(Ra);Za&&bb(Za);Za=Array(gb.length);
Ra=0;for(var kb=gb.length;Ra<kb;Ra++)Za[Ra]=gb[Ra].getValues();kb=q.findCurveBoundsCollisions(Za,Za,0,!0);Za={};for(Ra=0;Ra<gb.length;Ra++){var jb=gb[Ra],Db=jb._path._id;(Za[Db]=Za[Db]||{})[jb.getIndex()]={hor:hb(kb[Ra].hor),ver:hb(kb[Ra].ver)}}Ra=0;for(kb=Ka.length;Ra<kb;Ra++)ma(Ka[Ra]._segment,sb,Ab,Za,La);Ra=0;for(kb=cb.length;Ra<kb;Ra++)Ka=cb[Ra],jb=Ka._intersection,Ka._winding||ma(Ka,sb,Ab,Za,La),jb&&jb._overlap||(Ka._path._overlapsOnly=!1);sb=wa(cb,La)}else sb=M(Za?Ra.concat(Za):Ra.slice(),
function(Ob){return!!La[Ob]});return ha(sb,!0,Ma,Ta,Wa)}function A(Ma,Ta,Ka){function Wa(gb){if(!Ra[gb._id]&&(La||hb.contains(gb.getPointAt(gb.getLength()/2))^Ab))return Za.unshift(gb),Ra[gb._id]=!0}var bb=ba(Ma),hb=ba(Ta),sb=bb.getIntersections(hb,k),Ab="subtract"===Ka,La="divide"===Ka,Ra={},Za=[];for(Ka=sb.length-1;0<=Ka;Ka--){var cb=sb[Ka].split();cb&&(Wa(cb)&&cb.getFirstSegment().setHandleIn(0,0),bb.getLastSegment().setHandleOut(0,0))}Wa(bb);return ha(Za,!1,Ma,Ta)}function H(Ma,Ta){for(var Ka=
Ma;Ka;){if(Ka===Ta)return;Ka=Ka._previous}for(;Ma._next&&Ma._next!==Ta;)Ma=Ma._next;if(!Ma._next){for(;Ta._previous;)Ta=Ta._previous;Ma._next=Ta;Ta._previous=Ma}}function O(Ma){for(var Ta=Ma.length-1;0<=Ta;Ta--)Ma[Ta].clearHandles()}function M(Ma,Ta,Ka){var Wa=Ma&&Ma.length;if(Wa){var bb=f.each(Ma,function(Db,Ob){this[Db._id]={container:null,winding:Db.isClockwise()?1:-1,index:Ob}},{}),hb=Ma.slice().sort(function(Db,Ob){return Pa(Ob.getArea())-Pa(Db.getArea())}),sb=hb[0],Ab=q.findItemBoundsCollisions(hb,
null,B.GEOMETRIC_EPSILON);null==Ka&&(Ka=sb.isClockwise());for(sb=0;sb<Wa;sb++){var La=hb[sb],Ra=bb[La._id],Za=0,cb=Ab[sb];if(cb)for(var gb=null,kb=cb.length-1;0<=kb;kb--)if(cb[kb]<sb){gb=gb||La.getInteriorPoint();var jb=hb[cb[kb]];if(jb.contains(gb)){cb=bb[jb._id];Za=cb.winding;Ra.winding+=Za;Ra.container=cb.exclude?cb.container:jb;break}}Ta(Ra.winding)===Ta(Za)?(Ra.exclude=!0,Ma[Ra.index]=null):(Ra=Ra.container,La.setClockwise(Ra?!Ra.isClockwise():Ka))}}return Ma}function R(Ma,Ta,Ka){for(var Wa=
Ta&&[],bb=!1,hb=Ka||[],sb=Ka&&{},Ab,La,Ra,Za=(Ka&&Ka.length)-1;0<=Za;Za--){var cb=Ka[Za];cb._path&&(sb[cb._path._id+"."+cb._segment1._index]=!0)}for(Za=Ma.length-1;0<=Za;Za--){var gb=Ma[Za],kb=gb._time,jb=kb,Db=Ta&&!Ta(gb);if(cb=gb._curve)cb!==La?(bb=!cb.hasHandles()||sb&&sb[cb._path._id+"."+cb._segment1._index],Ab=[],Ra=null,La=cb):1E-8<=Ra&&(kb/=Ra);if(Db)Ab&&Ab.push(gb);else{Ta&&Wa.unshift(gb);Ra=jb;if(1E-8>kb)cb=cb._segment1;else if(.99999999<kb)cb=cb._segment2;else for(jb=cb.divideAtTime(kb,
!0),bb&&hb.push(cb,jb),cb=jb._segment1,jb=Ab.length-1;0<=jb;jb--)Db=Ab[jb],Db._time=(Db._time-kb)/(1-kb);gb._setSegment(cb);kb=cb._intersection;gb=gb._intersection;if(kb)for(H(kb,gb),gb=kb;gb;)H(gb._intersection,kb),gb=gb._next;else cb._intersection=gb}}Ka||O(hb);return Wa||Ma}function W(Ma,Ta,Ka,Wa,bb){function hb(hd){var Zc=hd[La+0],id=hd[La+2],Nc=hd[La+4],td=hd[La+6];if(cb<=Ea(Zc,id,Nc,td)&&cb>=Da(Zc,id,Nc,td))for(Zc=hd[Ab+0],id=hd[Ab+2],Nc=hd[Ab+4],td=hd[Ab+6],hd=gb>Ea(Zc,id,Nc,td)||kb<Da(Zc,
id,Nc,td)?[hd]:za.getMonoCurves(hd,Ka),Zc=0,id=hd.length;Zc<id;Zc++){Nc=hd[Zc];td=Nc[La+0];var pd=Nc[La+6];if(cb<Da(td,pd)||cb>Ea(td,pd))Nc=void 0;else{var Vd=Nc[Ab+0],Zd=Nc[Ab+2],Ze=Nc[Ab+4],md=Nc[Ab+6];if(td===pd){if(Vd<kb&&md>gb||md<kb&&Vd>gb)Mb=!0;Nc=void 0}else{Zd=cb===td?0:cb===pd?1:gb>Ea(Vd,Zd,Ze,md)||kb<Da(Vd,Zd,Ze,md)?1:0<za.solveCubic(Nc,La,cb,Oc,0,1)?Oc[0]:1;md=0===Zd?Vd:1===Zd?md:za.getPoint(Nc,Zd)[Ka?"y":"x"];pd=td>pd?1:-1;Ze=tc[La]>tc[La+6]?1:-1;var tf=tc[Ab+6];cb!==td?(md<gb?Db+=pd:
md>kb?Ob+=pd:Mb=!0,md>Za-1E-6&&md<Za+1E-6&&(kc/=2)):(pd!==Ze?Vd<gb?Db+=pd:Vd>kb&&(Ob+=pd):Vd!=tf&&(tf<kb&&md>kb?(Ob+=pd,Mb=!0):tf>gb&&md<gb&&(Db+=pd,Mb=!0)),kc/=4);tc=Nc;Nc=!bb&&md>gb&&md<kb&&0===za.getTangent(Nc,Zd)[Ka?"x":"y"]&&W(Ma,Ta,!Ka,Wa,!0)}}if(Nc)return Nc}}for(var sb=Array.isArray(Ta)?Ta:Ta[Ka?"hor":"ver"],Ab=Ka?1:0,La=Ab^1,Ra=[Ma.x,Ma.y],Za=Ra[Ab],cb=Ra[La],gb=Za-1E-9,kb=Za+1E-9,jb=Ra=0,Db=0,Ob=0,Mb=!1,ec=!1,kc=1,Oc=[],tc,xc,oc=0,Ac=sb.length;oc<Ac;oc++){var Pc=sb[oc],Wc=Pc._path,$d=Pc.getValues();
if(!oc||sb[oc-1]._path!==Wc)if(tc=null,Wc._closed||(xc=za.getValues(Wc.getLastCurve().getSegment2(),Pc.getSegment1(),null,!Wa),xc[La]!==xc[La+6]&&(tc=xc)),!tc){tc=$d;for(var Ad=Wc.getLastCurve();Ad&&Ad!==Pc;){var Xc=Ad.getValues();if(Xc[La]!==Xc[La+6]){tc=Xc;break}Ad=Ad.getPrevious()}}if(Pc=hb($d))return Pc;if(oc+1===Ac||sb[oc+1]._path!==Wc){if(xc&&(Pc=hb(xc)))return Pc;!Mb||Db||Ob||(Db=Ob=Wc.isClockwise(Wa)^Ka?1:-1);Ra+=Db;jb+=Ob;Db=Ob=0;Mb&&(ec=!0,Mb=!1);xc=null}}Ra=Pa(Ra);jb=Pa(jb);return{winding:Ea(Ra,
jb),windingL:Ra,windingR:jb,quality:kc,onPath:ec}}function ma(Ma,Ta,Ka,Wa,bb){var hb=[],sb=Ma,Ab=0;do{var La=Ma.getCurve();if(La){var Ra=La.getLength();hb.push({segment:Ma,curve:La,length:Ra});Ab+=Ra}Ma=Ma.getNext()}while(Ma&&!Ma._intersection&&Ma!==sb);sb=[.5,.25,.75];Ma={winding:0,quality:-1};for(var Za=0;Za<sb.length&&.5>Ma.quality;Za++){Ra=Ab*sb[Za];for(var cb=0,gb=hb.length;cb<gb;cb++){La=hb[cb];var kb=La.length;if(Ra<=kb){La=La.curve;kb=La._path;var jb=kb._parent;jb=jb instanceof $a?jb:kb;var Db=
B.clamp(La.getTimeAt(Ra),.001,.999),Ob=La.getPointAtTime(Db);Db=Pa(La.getTangentAtTime(Db).y)<Math.SQRT1_2;var Mb=null;if(bb.subtract&&Ka){var ec=(jb===Ta?Ka:Ta)._getWinding(Ob,Db,!0);if(jb===Ta&&ec.winding||jb===Ka&&!ec.winding)if(1>ec.quality)continue;else Mb={winding:0,quality:1}}Mb=Mb||W(Ob,Wa[kb._id][La.getIndex()],Db,!0);Mb.quality>Ma.quality&&(Ma=Mb);break}Ra-=kb}}for(cb=hb.length-1;0<=cb;cb--)hb[cb].segment._winding=Ma}function wa(Ma,Ta){function Ka(oc){var Ac;return!(!oc||oc._visited||Ta&&
(!Ta[(Ac=oc._winding||{}).winding]||Ta.unite&&2===Ac.winding&&Ac.windingL&&Ac.windingR))}function Wa(oc){if(oc)for(var Ac=0,Pc=Ab.length;Ac<Pc;Ac++)if(oc===Ab[Ac])return!0;return!1}function bb(oc){oc=oc._segments;for(var Ac=0,Pc=oc.length;Ac<Pc;Ac++)oc[Ac]._visited=!0}function hb(oc,Ac){function Pc(Xc,hd){for(;Xc&&Xc!==hd;){var Zc=Xc._segment,id=Zc&&Zc._path;if(id){id=Zc.getNext()||id.getFirstSegment();var Nc=id._intersection;Zc!==oc&&(Wa(Zc)||Wa(id)||id&&Ka(Zc)&&(Ka(id)||Nc&&Ka(Nc._segment)))&&Ad.push(Zc);
Ac&&Ab.push(Zc)}Xc=Xc._next}}var Wc=oc._intersection,$d=Wc,Ad=[];Ac&&(Ab=[oc]);if(Wc){for(Pc(Wc);Wc&&Wc._prev;)Wc=Wc._prev;Pc(Wc,$d)}return Ad}var sb=[],Ab;Ma.sort(function(oc,Ac){var Pc=oc._intersection,Wc=Ac._intersection,$d=!(!Pc||!Pc._overlap),Ad=oc._path,Xc=Ac._path;return $d^!(!Wc||!Wc._overlap)?$d?1:-1:!Pc^!Wc?Pc?1:-1:Ad!==Xc?Ad._id-Xc._id:oc._index-Ac._index});for(var La=0,Ra=Ma.length;La<Ra;La++){var Za=Ma[La],cb=Ka(Za),gb=null,kb=!1,jb=!0,Db=[],Ob;if(cb&&Za._path._overlapsOnly){var Mb=Za._path,
ec=Za._intersection._segment._path;Mb.compare(ec)&&(Mb.getArea()&&sb.push(Mb.clone(!1)),bb(Mb),bb(ec),cb=!1)}for(;cb;){Mb=!gb;ec=hb(Za,Mb);var kc=ec.shift();kb=!Mb&&(Wa(Za)||Wa(kc));var Oc=!kb&&kc;if(Mb){gb=new Ia(P.NO_INSERT);var tc=null}if(kb){if(Za.isFirst()||Za.isLast())jb=Za._path._closed;Za._visited=!0;break}Oc&&tc&&(Db.push(tc),tc=null);tc||(Oc&&ec.push(Za),tc={start:gb._segments.length,crossings:ec,visited:Ob=[],handleIn:xc});Oc&&(Za=kc);if(!Ka(Za)){gb.removeSegments(tc.start);Za=0;for(Mb=
Ob.length;Za<Mb;Za++)Ob[Za]._visited=!1;Ob.length=0;do if(Za=tc&&tc.crossings.shift(),!Za||!Za._path)if(Za=null,tc=Db.pop()){Ob=tc.visited;var xc=tc.handleIn}while(tc&&!Ka(Za));if(!Za)break}Mb=Za.getNext();gb.add(new Aa(Za._point,xc,Mb&&Za._handleOut));Za._visited=!0;Ob.push(Za);Za=Mb||Za._path.getFirstSegment();xc=Mb&&Mb._handleIn}kb&&(jb&&(gb.getFirstSegment().setHandleIn(xc),gb.setClosed(jb)),0!==gb.getArea()&&sb.push(gb))}return sb}var Da=Math.min,Ea=Math.max,Pa=Math.abs,Ha={unite:{1:!0,2:!0},
intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};return{_getWinding:function(Ma,Ta,Ka){return W(Ma,this.getCurves(),Ta,Ka)},unite:function(Ma,Ta){return p(this,Ma,"unite",Ta)},intersect:function(Ma,Ta){return p(this,Ma,"intersect",Ta)},subtract:function(Ma,Ta){return p(this,Ma,"subtract",Ta)},exclude:function(Ma,Ta){return p(this,Ma,"exclude",Ta)},divide:function(Ma,Ta){return Ta&&(0==Ta.trace||Ta.stroke)?A(this,Ma,"divide"):ha([this.subtract(Ma,Ta),this.intersect(Ma,Ta)],!0,this,Ma,Ta)},
resolveCrossings:function(){function Ma(jb,Db){return(jb=jb&&jb._intersection)&&jb._overlap&&jb._path===Db}var Ta=this._children,Ka=Ta||[this],Wa=!1,bb=!1,hb=this.getIntersections(null,function(jb){return jb.hasOverlap()&&(Wa=!0)||jb.isCrossing()&&(bb=!0)}),sb=Wa&&bb&&[];hb=Na.expand(hb);if(Wa)for(var Ab=R(hb,function(jb){return jb.hasOverlap()},sb),La=Ab.length-1;0<=La;La--){var Ra=Ab[La],Za=Ra._path;Ra=Ra._segment;var cb=Ra.getPrevious(),gb=Ra.getNext();Ma(cb,Za)&&Ma(gb,Za)&&(Ra.remove(),cb._handleOut._set(0,
0),gb._handleIn._set(0,0),cb===Ra||cb.getCurve().hasLength()||(gb._handleIn.set(cb._handleIn),cb.remove()))}bb&&(R(hb,Wa&&function(jb){var Db=jb.getCurve(),Ob=jb.getSegment(),Mb=jb._intersection;jb=Mb._curve;Mb=Mb._segment;if(Db&&jb&&Db._path&&jb._path)return!0;Ob&&(Ob._intersection=null);Mb&&(Mb._intersection=null)},sb),sb&&O(sb),Ka=wa(f.each(Ka,function(jb){f.push(this,jb._segments)},[])));hb=Ka.length;if(1<hb&&Ta){Ka!==Ta&&this.setChildren(Ka);var kb=this}else 1!==hb||Ta||(Ka[0]!==this&&this.setSegments(Ka[0].removeSegments()),
kb=this);kb||(kb=new $a(P.NO_INSERT),kb.addChildren(Ka),kb=kb.reduce(),kb.copyAttributes(this),this.replaceWith(kb));return kb},reorient:function(Ma,Ta){var Ka=this._children;Ka&&Ka.length?this.setChildren(M(this.removeChildren(),function(Wa){return!!(Ma?Wa:Wa&1)},Ta)):Ta!==b&&this.setClockwise(Ta);return this},getInteriorPoint:function(){var Ma=this.getBounds().getCenter(!0);if(!this.contains(Ma)){for(var Ta=this.getCurves(),Ka=Ma.y,Wa=[],bb=[],hb=0,sb=Ta.length;hb<sb;hb++){var Ab=Ta[hb].getValues(),
La=Ab[1],Ra=Ab[3],Za=Ab[5],cb=Ab[7];if(Ka>=Da(La,Ra,Za,cb)&&Ka<=Ea(La,Ra,Za,cb))for(Ab=za.getMonoCurves(Ab),La=0,Ra=Ab.length;La<Ra;La++){Za=Ab[La];cb=Za[1];var gb=Za[7];cb!==gb&&(Ka>=cb&&Ka<=gb||Ka>=gb&&Ka<=cb)&&(Za=Ka===cb?Za[0]:Ka===gb?Za[6]:1===za.solveCubic(Za,1,Ka,bb,0,1)?za.getPoint(Za,bb[0]).x:(Za[0]+Za[6])/2,Wa.push(Za))}}1<Wa.length&&(Wa.sort(function(kb,jb){return kb-jb}),Ma.x=(Wa[0]+Wa[1])/2)}return Ma}}});var lb=f.extend({_class:"PathFlattener",initialize:function(ba,ha,k,p,A){function H(Ha,
Ma){Ma=za.getValues(Ha,Ma,A);M.push(Ma);O(Ma,Ha._index,0,1)}function O(Ha,Ma,Ta,Ka){if(!(Ka-Ta>ma)||p&&za.isStraight(Ha)||za.isFlatEnough(Ha,ha||.25)){Ta=Ha[6]-Ha[0];var Wa=Ha[7]-Ha[1];Ta=Math.sqrt(Ta*Ta+Wa*Wa);0<Ta&&(W+=Ta,R.push({offset:W,curve:Ha,index:Ma,time:Ka}))}else Ha=za.subdivide(Ha,.5),Wa=(Ta+Ka)/2,O(Ha[0],Ma,Ta,Wa),O(Ha[1],Ma,Wa,Ka)}var M=[],R=[],W=0,ma=1/(k||32);k=ba._segments;for(var wa=k[0],Da,Ea=1,Pa=k.length;Ea<Pa;Ea++)Da=k[Ea],H(wa,Da),wa=Da;ba._closed&&H(Da||wa,k[0]);this.curves=
M;this.parts=R;this.length=W;this.index=0},_get:function(ba){for(var ha=this.parts,k=ha.length,p,A=this.index;p=A,A&&!(ha[--A].offset<ba););for(;p<k;p++)if(A=ha[p],A.offset>=ba)return this.index=p,ha=(k=ha[p-1])&&k.index===A.index?k.time:0,k=k?k.offset:0,{index:A.index,time:ha+(A.time-ha)*(ba-k)/(A.offset-k)};return{index:ha[k-1].index,time:1}},drawPart:function(ba,ha,k){ha=this._get(ha);k=this._get(k);for(var p=ha.index,A=k.index;p<=A;p++){var H=za.getPart(this.curves[p],p===ha.index?ha.time:0,p===
k.index?k.time:1);p===ha.index&&ba.moveTo(H[0],H[1]);ba.bezierCurveTo.apply(ba,H.slice(2))}}},f.each(za._evaluateMethods,function(ba){this[ba+"At"]=function(ha){ha=this._get(ha);return za[ba](this.curves[ha.index],ha.time)}},{})),xb=f.extend({initialize:function(ba){var ha=this.points=[],k=ba._segments;ba=ba._closed;for(var p=0,A,H=k.length;p<H;p++){var O=k[p].point;A&&A.equals(O)||ha.push(A=O.clone())}ba&&(ha.unshift(ha[ha.length-1]),ha.push(ha[1]));this.closed=ba},fit:function(ba){var ha=this.points,
k=ha.length,p=null;0<k&&(p=[new Aa(ha[0])],1<k&&(this.fitCubic(p,ba,0,k-1,ha[1].subtract(ha[0]),ha[k-2].subtract(ha[k-1])),this.closed&&(p.shift(),p.pop())));return p},fitCubic:function(ba,ha,k,p,A,H){var O=this.points;if(1===p-k)ha=O[k],p=O[p],k=ha.getDistance(p)/3,this.addCurve(ba,[ha,ha.add(A.normalize(k)),p.add(H.normalize(k)),p]);else{for(var M=this.chordLengthParameterize(k,p),R=Math.max(ha,ha*ha),W,ma=!0,wa=0;4>=wa;wa++){var Da=this.generateBezier(k,p,M,A,H),Ea=this.findMaxError(k,p,Da,M);
if(Ea.error<ha&&ma){this.addCurve(ba,Da);return}W=Ea.index;if(Ea.error>=R)break;ma=this.reparameterize(k,p,M,Da);R=Ea.error}O=O[W-1].subtract(O[W+1]);this.fitCubic(ba,ha,k,W,A,O);this.fitCubic(ba,ha,W,p,O.negate(),H)}},addCurve:function(ba,ha){ba[ba.length-1].setHandleOut(ha[1].subtract(ha[0]));ba.push(new Aa(ha[3],ha[2].subtract(ha[3])))},generateBezier:function(ba,ha,k,p,A){var H=Math.abs,O=this.points,M=O[ba],R=O[ha],W=[[0,0],[0,0]],ma=[0,0],wa=0;for(ha=ha-ba+1;wa<ha;wa++){var Da=k[wa],Ea=1-Da,
Pa=3*Da*Ea,Ha=Ea*Ea*Ea;Ea*=Pa;Pa*=Da;var Ma=Da*Da*Da;Da=p.normalize(Ea);var Ta=A.normalize(Pa);Ha=O[ba+wa].subtract(M.multiply(Ha+Ea)).subtract(R.multiply(Pa+Ma));W[0][0]+=Da.dot(Da);W[0][1]+=Da.dot(Ta);W[1][0]=W[0][1];W[1][1]+=Ta.dot(Ta);ma[0]+=Da.dot(Ha);ma[1]+=Ta.dot(Ha)}ba=W[0][0]*W[1][1]-W[1][0]*W[0][1];1E-12<H(ba)?(H=W[0][0]*ma[1]-W[1][0]*ma[0],ma=(ma[0]*W[1][1]-ma[1]*W[0][1])/ba,H/=ba):(ba=W[0][0]+W[0][1],W=W[1][0]+W[1][1],ma=H=1E-12<H(ba)?ma[0]/ba:1E-12<H(W)?ma[1]/W:0);W=R.getDistance(M);
ba=1E-12*W;if(ma<ba||H<ba)ma=H=W/3;else{ba=R.subtract(M);var Ka=p.normalize(ma);var Wa=A.normalize(H);Ka.dot(ba)-Wa.dot(ba)>W*W&&(ma=H=W/3,Ka=Wa=null)}return[M,M.add(Ka||p.normalize(ma)),R.add(Wa||A.normalize(H)),R]},reparameterize:function(ba,ha,k,p){for(var A=ba;A<=ha;A++)k[A-ba]=this.findRoot(p,this.points[A],k[A-ba]);A=1;for(ba=k.length;A<ba;A++)if(k[A]<=k[A-1])return!1;return!0},findRoot:function(ba,ha,k){for(var p=[],A=[],H=0;2>=H;H++)p[H]=ba[H+1].subtract(ba[H]).multiply(3);for(H=0;1>=H;H++)A[H]=
p[H+1].subtract(p[H]).multiply(2);ba=this.evaluate(3,ba,k);p=this.evaluate(2,p,k);A=this.evaluate(1,A,k);ha=ba.subtract(ha);A=p.dot(p)+ha.dot(A);return B.isMachineZero(A)?k:k-ha.dot(p)/A},evaluate:function(ba,ha,k){ha=ha.slice();for(var p=1;p<=ba;p++)for(var A=0;A<=ba-p;A++)ha[A]=ha[A].multiply(1-k).add(ha[A+1].multiply(k));return ha[0]},chordLengthParameterize:function(ba,ha){for(var k=[0],p=ba+1;p<=ha;p++)k[p-ba]=k[p-ba-1]+this.points[p].getDistance(this.points[p-1]);p=1;for(ba=ha-ba;p<=ba;p++)k[p]/=
k[ba];return k},findMaxError:function(ba,ha,k,p){for(var A=Math.floor((ha-ba+1)/2),H=0,O=ba+1;O<ha;O++){var M=this.evaluate(3,k,p[O-ba]).subtract(this.points[O]);M=M.x*M.x+M.y*M.y;M>=H&&(H=M,A=O)}return{error:H,index:A}}}),Cb=P.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(ba){this._content="";this._lines=[];var ha=ba&&f.isPlainObject(ba)&&ba.x===b&&ba.y===b;this._initialize(ha&&ba,!ha&&F.read(arguments))},
_equals:function(ba){return this._content===ba._content},copyContent:function(ba){this.setContent(ba._content)},getContent:function(){return this._content},setContent:function(ba){this._content=""+ba;this._lines=this._content.split(/\r\n|\n|\r/mg);this._changed(521)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),ca=Cb.extend({_class:"PointText",initialize:function(){Cb.apply(this,arguments)},
getPoint:function(){var ba=this._matrix.getTranslation();return new G(ba.x,ba.y,this,"setPoint")},setPoint:function(){var ba=F.read(arguments);this.translate(ba.subtract(this._matrix.getTranslation()))},_draw:function(ba,ha,k){if(this._content){this._setStyles(ba,ha,k);ha=this._lines;var p=this._style;k=p.hasFill();var A=p.hasStroke(),H=p.getLeading(),O=ba.shadowColor;ba.font=p.getFontStyle();ba.textAlign=p.getJustification();p=0;for(var M=ha.length;p<M;p++){ba.shadowColor=O;var R=ha[p];k&&(ba.fillText(R,
0,0),ba.shadowColor="rgba(0,0,0,0)");A&&ba.strokeText(R,0,0);ba.translate(0,H)}}},_getBounds:function(ba){var ha=this._style,k=this._lines,p=k.length,A=ha.getJustification(),H=ha.getLeading();ha=this.getView().getTextWidth(ha.getFontStyle(),k);k=0;"left"!==A&&(k-=ha/("center"===A?2:1));p=new V(k,p?-.75*H:0,ha,p*H);return ba?ba._transformBounds(p,p):p}}),Sa=f.extend(new function(){var ba={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],
gradient:["gradient","origin","destination","highlight"]},ha={},k={transparent:[0,0,0,0]},p,A=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],H={"rgb-hsb":function(O,M,R){var W=Math.max(O,M,R),ma=W-Math.min(O,M,R);return[0===ma?0:60*(W==O?(M-R)/ma+(M<R?6:0):W==M?(R-O)/ma+2:(O-M)/ma+4),0===W?0:ma/W,W]},"hsb-rgb":function(O,M,R){O=(O/60%6+6)%6;var W=Math.floor(O);O-=W;W=A[W];M=[R,R*(1-M),R*(1-M*O),R*(1-M*(1-O))];return[M[W[0]],M[W[1]],M[W[2]]]},"rgb-hsl":function(O,M,R){var W=Math.max(O,M,R),ma=Math.min(O,
M,R),wa=W-ma,Da=0===wa,Ea=(W+ma)/2;return[Da?0:60*(W==O?(M-R)/wa+(M<R?6:0):W==M?(R-O)/wa+2:(O-M)/wa+4),Da?0:.5>Ea?wa/(W+ma):wa/(2-W-ma),Ea]},"hsl-rgb":function(O,M,R){O=(O/360%1+1)%1;if(0===M)return[R,R,R];O=[O+1/3,O,O-1/3];M=.5>R?R*(1+M):R+M-R*M;R=2*R-M;for(var W=[],ma=0;3>ma;ma++){var wa=O[ma];0>wa&&(wa+=1);1<wa&&--wa;W[ma]=1>6*wa?R+6*(M-R)*wa:1>2*wa?M:2>3*wa?R+(M-R)*(2/3-wa)*6:R}return W},"rgb-gray":function(O,M,R){return[.2989*O+.587*M+.114*R]},"gray-rgb":function(O){return[O,O,O]},"gray-hsb":function(O){return[0,
0,O]},"gray-hsl":function(O){return[0,0,O]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return f.each(ba,function(O,M){ha[M]=[];f.each(O,function(R,W){var ma=f.capitalize(R),wa=/^(hue|saturation)$/.test(R),Da=ha[M][W]="gradient"===M?"gradient"===R?function(Ea){var Pa=this._components[0];Ea=Va.read(Array.isArray(Ea)?Ea:arguments,0,{readNull:!0});Pa!==Ea&&(Pa&&Pa._removeOwner(this),Ea&&Ea._addOwner(this));return Ea}:function(){return F.read(arguments,0,{readNull:"highlight"===
R,clone:!0})}:function(Ea){return null==Ea||isNaN(Ea)?0:+Ea};this["get"+ma]=function(){return this._type===M||wa&&/^hs[bl]$/.test(this._type)?this._components[W]:this._convert(M)[W]};this["set"+ma]=function(Ea){this._type===M||wa&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(M),this._properties=ba[M],this._type=M);this._components[W]=Da.call(this,Ea);this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function R(M){var W=arguments,ma=this.__read,wa=0,Da;Array.isArray(M)&&
(W=M,M=W[0]);var Ea=null!=M&&typeof M;if("string"===Ea&&M in ba){var Pa=M;M=W[1];if(Array.isArray(M)){var Ha=M;var Ma=W[2]}else ma&&(wa=1),W=f.slice(W,1),Ea=typeof M}if(!Ha){if(Da="number"===Ea?W:"object"===Ea&&null!=M.length?M:null)Pa||=3<=Da.length?"rgb":"gray",W=ba[Pa].length,Ma=Da[W],ma&&(wa+=Da===arguments?W+(null!=Ma?1:0):1),Da.length>W&&(Da=f.slice(Da,0,W));else if("string"===Ea){Ha=M;var Ta=Ha.match(/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i)||Ha.match(/^#([\da-f])([\da-f])([\da-f])([\da-f])?$/i);
Pa="rgb";if(Ta){var Ka=Ta[4]?4:3;Ha=Array(Ka);for(W=0;W<Ka;W++)Ea=Ta[W+1],Ha[W]=parseInt(1==Ea.length?Ea+Ea:Ea,16)/255}else if(Ta=Ha.match(/^(rgb|hsl)a?\((.*)\)$/))for(Pa=Ta[1],Ha=Ta[2].trim().split(/[,\s]+/g),Ta="hsl"===Pa,W=0,Ka=Math.min(Ha.length,4);W<Ka;W++){var Wa=Ha[W];Ea=parseFloat(Wa);Ta?0===W?(Wa=Wa.match(/([a-z]*)$/)[1],Ea*={turn:360,rad:180/Math.PI,grad:.9}[Wa]||1):3>W&&(Ea/=100):3>W&&(Ea/=/%$/.test(Wa)?100:255);Ha[W]=Ea}else W=k[Ha],W||(l?(p||(p=Nb.getContext(1,1),p.globalCompositeOperation=
"copy"),p.fillStyle="rgba(0,0,0,0)",p.fillStyle=Ha,p.fillRect(0,0,1,1),W=p.getImageData(0,0,1,1).data,W=k[Ha]=[W[0]/255,W[1]/255,W[2]/255]):W=[0,0,0]),Ha=W.slice();Ha=[Pa,Ha];Pa=Ha[0];Ha=Ha[1];4===Ha.length&&(Ma=Ha[3],Ha.length--)}else if("object"===Ea)if(M.constructor===R){if(Pa=M._type,Ha=M._components.slice(),Ma=M._alpha,"gradient"===Pa)for(W=1,Ea=Ha.length;W<Ea;W++)(Ta=Ha[W])&&(Ha[W]=Ta.clone())}else if(M.constructor===Va)Pa="gradient",Da=W;else{Pa="hue"in M?"lightness"in M?"hsl":"hsb":"gradient"in
M||"stops"in M||"radial"in M?"gradient":"gray"in M?"gray":"rgb";Ma=ba[Pa];Ta=ha[Pa];this._components=Ha=[];W=0;for(Ea=Ma.length;W<Ea;W++)Ka=M[Ma[W]],null==Ka&&!W&&"gradient"===Pa&&"stops"in M&&(Ka={stops:M.stops,radial:M.radial}),Ka=Ta[W].call(this,Ka),null!=Ka&&(Ha[W]=Ka);Ma=M.alpha}ma&&Pa&&(wa=1)}this._type=Pa||"rgb";if(!Ha)for(this._components=Ha=[],Ta=ha[this._type],W=0,Ea=Ta.length;W<Ea;W++)Ka=Ta[W].call(this,Da&&Da[W]),null!=Ka&&(Ha[W]=Ka);this._components=Ha;this._properties=ba[this._type];
this._alpha=Ma;ma&&(this.__read=wa);return this},set:"#initialize",_serialize:function(M,R){var W=this.getComponents();return f.serialize(/^(gray|rgb)$/.test(this._type)?W:[this._type].concat(W),M,!0,R)},_changed:function(){this._canvasStyle=null;if(this._owner)if(this._setter)this._owner[this._setter](this);else this._owner._changed(129)},_convert:function(M){var R;return this._type===M?this._components.slice():(R=H[this._type+"-"+M])?R.apply(this,this._components):H["rgb-"+M].apply(this,H[this._type+
"-rgb"].apply(this,this._components))},convert:function(M){return new Sa(M,this._convert(M),this._alpha)},getType:function(){return this._type},setType:function(M){this._components=this._convert(M);this._properties=ba[M];this._type=M},getComponents:function(){var M=this._components.slice();null!=this._alpha&&M.push(this._alpha);return M},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(M){this._alpha=null==M?null:Math.min(Math.max(M,0),1);this._changed()},hasAlpha:function(){return null!=
this._alpha},equals:function(M){var R=f.isPlainValue(M,!0)?Sa.read(arguments):M;return R===this||R&&this._class===R._class&&this._type===R._type&&this.getAlpha()===R.getAlpha()&&f.equals(this._components,R._components)||!1},toString:function(){for(var M=this._properties,R=[],W="gradient"===this._type,ma=r.instance,wa=0,Da=M.length;wa<Da;wa++){var Ea=this._components[wa];null!=Ea&&R.push(M[wa]+": "+(W?Ea:ma.number(Ea)))}null!=this._alpha&&R.push("alpha: "+ma.number(this._alpha));return"{ "+R.join(", ")+
" }"},toCSS:function(M){function R(wa){return Math.round(255*(0>wa?0:1<wa?1:wa))}var W=this._convert("rgb"),ma=M||null==this._alpha?1:this._alpha;W=[R(W[0]),R(W[1]),R(W[2])];1>ma&&W.push(0>ma?0:ma);return M?"#"+(16777216+(W[0]<<16)+(W[1]<<8)+W[2]).toString(16).slice(1):(4==W.length?"rgba(":"rgb(")+W.join(",")+")"},toCanvasStyle:function(M,R){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var W=this._components,ma=W[0],wa=ma._stops,Da=
W[1],Ea=W[2];W=W[3];if(R=R&&R.inverted())Da=R._transformPoint(Da),Ea=R._transformPoint(Ea),W&&=R._transformPoint(W);ma._radial?(ma=Ea.getDistance(Da),W&&(Ea=W.subtract(Da),Ea.getLength()>ma&&(W=Da.add(Ea.normalize(ma-.1)))),W=W||Da,M=M.createRadialGradient(W.x,W.y,0,Da.x,Da.y,ma)):M=M.createLinearGradient(Da.x,Da.y,Ea.x,Ea.y);Da=0;for(W=wa.length;Da<W;Da++)ma=wa[Da],Ea=ma._offset,M.addColorStop(null==Ea?Da/(W-1):Ea,ma._color.toCanvasStyle());return this._canvasStyle=M},transform:function(M){if("gradient"===
this._type){for(var R=this._components,W=1,ma=R.length;W<ma;W++){var wa=R[W];M._transformPoint(wa,wa,!0)}this._changed()}},statics:{_types:ba,random:function(){var M=Math.random;return new Sa(M(),M(),M())},_setOwner:function(M,R,W){M&&(M._owner&&R&&M._owner!==R&&(M=M.clone()),!M._owner^!R&&(M._owner=R||null,M._setter=W||null));return M}}})},new function(){return f.each({add:function(ba,ha){return ba+ha},subtract:function(ba,ha){return ba-ha},multiply:function(ba,ha){return ba*ha},divide:function(ba,
ha){return ba/ha}},function(ba,ha){this[ha]=function(k){k=Sa.read(arguments);for(var p=this._type,A=this._components,H=k._convert(p),O=0,M=A.length;O<M;O++)H[O]=ba(A[O],H[O]);return new Sa(p,H,null!=this._alpha?ba(this._alpha,k.getAlpha()):null)}},{})}),Va=f.extend({_class:"Gradient",initialize:function(ba,ha){this._id=D.get();ba&&f.isPlainObject(ba)&&(this.set(ba),ba=ha=null);null==this._stops&&this.setStops(ba||["white","black"]);null==this._radial&&this.setRadial("string"===typeof ha&&"radial"===
ha||ha||!1)},_serialize:function(ba,ha){return ha.add(this,function(){return f.serialize([this._stops,this._radial],ba,!0,ha)})},_changed:function(){for(var ba=0,ha=this._owners&&this._owners.length;ba<ha;ba++)this._owners[ba]._changed()},_addOwner:function(ba){this._owners||(this._owners=[]);this._owners.push(ba)},_removeOwner:function(ba){ba=this._owners?this._owners.indexOf(ba):-1;-1!=ba&&(this._owners.splice(ba,1),this._owners.length||(this._owners=b))},clone:function(){for(var ba=[],ha=0,k=this._stops.length;ha<
k;ha++)ba[ha]=this._stops[ha].clone();return new Va(ba,this._radial)},getStops:function(){return this._stops},setStops:function(ba){if(2>ba.length)throw Error("Gradient stop list needs to contain at least two stops.");var ha=this._stops;if(ha)for(var k=0,p=ha.length;k<p;k++)ha[k]._owner=b;ha=this._stops=fb.readList(ba,0,{clone:!0});k=0;for(p=ha.length;k<p;k++)ha[k]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(ba){this._radial=ba;this._changed()},equals:function(ba){if(ba===
this)return!0;if(ba&&this._class===ba._class){var ha=this._stops;ba=ba._stops;var k=ha.length;if(k===ba.length){for(var p=0;p<k;p++)if(!ha[p].equals(ba[p]))return!1;return!0}}return!1}}),fb=f.extend({_class:"GradientStop",initialize:function(ba,ha){var k=ba,p=ha;if("object"===typeof ba&&ha===b)if(Array.isArray(ba)&&"number"!==typeof ba[0])k=ba[0],p=ba[1];else if("color"in ba||"offset"in ba||"rampPoint"in ba)k=ba.color,p=ba.offset||ba.rampPoint||0;this.setColor(k);this.setOffset(p)},clone:function(){return new fb(this._color.clone(),
this._offset)},_serialize:function(ba,ha){var k=this._color,p=this._offset;return f.serialize(null==p?[k]:[k,p],ba,!0,ha)},_changed:function(){this._owner&&this._owner._changed(129)},getOffset:function(){return this._offset},setOffset:function(ba){this._offset=ba;this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){Sa._setOwner(this._color,null);this._color=Sa._setOwner(Sa.read(arguments,0),this,"setColor");this._changed()},
equals:function(ba){return ba===this||ba&&this._class===ba._class&&this._color.equals(ba._color)&&this._offset==ba._offset||!1}}),Qa=f.extend(new function(){var ba={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new F,selectedColor:null},ha=f.set({},ba,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),k=
f.set({},ha,{fillColor:new Sa}),p={strokeWidth:193,strokeCap:193,strokeJoin:193,strokeScaling:201,miterLimit:193,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},A={beans:!0},H={_class:"Style",beans:!0,initialize:function(O,M,R){this._values={};this._project=(this._owner=M)&&M._project||R||ib.project;this._defaults=!M||M instanceof ea?ha:M instanceof Cb?k:ba;O&&this.set(O)}};f.each(ha,function(O,M){var R=/Color$/.test(M),W="shadowOffset"===M;O=f.capitalize(M);var ma=p[M],wa=
"set"+O,Da="get"+O;H[wa]=function(Ea){var Pa=this._owner,Ha=Pa&&Pa._children,Ma=Ha&&0<Ha.length&&!(Pa instanceof $a);if(Ma)for(var Ta=0,Ka=Ha.length;Ta<Ka;Ta++)Ha[Ta]._style[wa](Ea);("selectedColor"===M||!Ma)&&M in this._defaults&&(Ha=this._values[M],Ha!==Ea&&(R&&(Ha&&(Sa._setOwner(Ha,null),Ha._canvasStyle=null),Ea&&Ea.constructor===Sa&&(Ea=Sa._setOwner(Ea,Pa,Ma&&wa))),this._values[M]=Ea,Pa&&Pa._changed(ma||129)))};H[Da]=function(Ea){var Pa=this._owner,Ha=Pa&&Pa._children,Ma=Ha&&0<Ha.length&&!(Pa instanceof
$a);if(Ma&&!Ea){Ea=0;for(var Ta=Ha.length;Ea<Ta;Ea++){var Ka=Ha[Ea]._style[Da]();if(!Ea)var Wa=Ka;else if(!f.equals(Wa,Ka))return b}}else M in this._defaults&&(Wa=this._values[M],Wa===b?(Wa=this._defaults[M])&&Wa.clone&&(Wa=Wa.clone()):(Ha=R?Sa:W?F:null,!Ha||Wa&&Wa.constructor===Ha||(this._values[M]=Wa=Ha.read([Wa],0,{readNull:!0,clone:!0}))));Wa&&R&&(Wa=Sa._setOwner(Wa,Pa,Ma&&wa));return Wa};A[Da]=function(Ea){return this._style[Da](Ea)};A[wa]=function(Ea){this._style[wa](Ea)}});f.each({Font:"FontFamily",
WindingRule:"FillRule"},function(O,M){var R="get"+M;M="set"+M;H[R]=A[R]="#get"+O;H[M]=A[M]="#set"+O});P.inject(A);return H},{set:function(ba){var ha=ba instanceof Qa;if(ba=ha?ba._values:ba)for(var k in ba)if(k in this._defaults){var p=ba[k];this[k]=p&&ha&&p.clone?p.clone():p}},equals:function(ba){function ha(k,p,A){k=k._values;var H=p._values;p=p._defaults;for(var O in k){var M=k[O],R=H[O];if(!(A&&O in H||f.equals(M,R===b?p[O]:R)))return!1}return!0}return ba===this||ba&&this._class===ba._class&&ha(this,
ba)&&ha(ba,this,!0)||!1},_dispose:function(){var ba;if(ba=this.getFillColor())ba._canvasStyle=null;if(ba=this.getStrokeColor())ba._canvasStyle=null;if(ba=this.getShadowColor())ba._canvasStyle=null},hasFill:function(){var ba=this.getFillColor();return!!ba&&0<ba.alpha},hasStroke:function(){var ba=this.getStrokeColor();return!!ba&&0<ba.alpha&&0<this.getStrokeWidth()},hasShadow:function(){var ba=this.getShadowColor();return!!ba&&0<ba.alpha&&(0<this.getShadowBlur()||!this.getShadowOffset().isZero())},
getView:function(){return this._project._view},getFontStyle:function(){var ba=this.getFontSize();return this.getFontWeight()+" "+ba+(/[a-z]/i.test(ba+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function ha(){var k=ha.base.call(this),p=this.getFontSize();/pt|em|%|px/.test(p)&&(p=this.getView().getPixelSize(p));return null!=k?k:1.2*p}}),eb=new function(){function ha(k,p,A,H){for(var O=" webkit moz Moz ms o".split(" "),M=p[0].toUpperCase()+p.substring(1),
R=0;6>R;R++){var W=O[R];W=W?W+M:p;if(W in k){if(A)k[W]=H;else return k[W];break}}}return{getStyles:function(k){var p=k&&9!==k.nodeType?k.ownerDocument:k;return(p=p&&p.defaultView)&&p.getComputedStyle(k,"")},getBounds:function(k,p){var A=k.ownerDocument,H=A.body,O=A.documentElement;try{var M=k.getBoundingClientRect()}catch(W){M={left:0,top:0,width:0,height:0}}k=M.left-(O.clientLeft||H.clientLeft||0);var R=M.top-(O.clientTop||H.clientTop||0);p||(p=A.defaultView,k+=p.pageXOffset||O.scrollLeft||H.scrollLeft,
R+=p.pageYOffset||O.scrollTop||H.scrollTop);return new V(k,R,M.width,M.height)},getViewportBounds:function(k){var p=k.ownerDocument;k=p.defaultView;p=p.documentElement;return new V(0,0,k.innerWidth||p.clientWidth,k.innerHeight||p.clientHeight)},getOffset:function(k,p){return eb.getBounds(k,p).getPoint()},getSize:function(k){return eb.getBounds(k,!0).getSize()},isInvisible:function(k){return eb.getSize(k).equals(new N(0,0))},isInView:function(k){return!eb.isInvisible(k)&&eb.getViewportBounds(k).intersects(eb.getBounds(k,
!0))},isInserted:function(k){return e.body.contains(k)},getPrefixed:function(k,p){return k&&ha(k,p)},setPrefixed:function(k,p,A){if("object"===typeof p)for(var H in p)ha(k,H,!0,p[H]);else ha(k,p,!0,A)}}},mb={add:function(ha,k){if(ha)for(var p in k)for(var A=k[p],H=p.split(/[\s,]+/g),O=0,M=H.length;O<M;O++){var R=H[O];ha.addEventListener(R,A,ha!==e||"touchstart"!==R&&"touchmove"!==R?!1:{passive:!1})}},remove:function(ha,k){if(ha)for(var p in k)for(var A=k[p],H=p.split(/[\s,]+/g),O=0,M=H.length;O<M;O++)ha.removeEventListener(H[O],
A,!1)},getPoint:function(ha){ha=ha.targetTouches?ha.targetTouches.length?ha.targetTouches[0]:ha.changedTouches[0]:ha;return new F(ha.pageX||ha.clientX+e.documentElement.scrollLeft,ha.pageY||ha.clientY+e.documentElement.scrollTop)},getTarget:function(ha){return ha.target||ha.srcElement},getRelatedTarget:function(ha){return ha.relatedTarget||ha.toElement},getOffset:function(ha,k){return mb.getPoint(ha).subtract(eb.getOffset(k||mb.getTarget(ha)))}};mb.requestAnimationFrame=new function(){function ha(){var O=
A;A=[];for(var M=0,R=O.length;M<R;M++)O[M]();(p=k&&A.length)&&k(ha)}var k=eb.getPrefixed(l,"requestAnimationFrame"),p=!1,A=[],H;return function(O){A.push(O);k?p||(k(ha),p=!0):H||=setInterval(ha,1E3/60)}};var ub=f.extend(h,{_class:"View",initialize:function A(k,p){function H(Da){return p[Da]||parseInt(p.getAttribute(Da),10)}function O(){var Da=eb.getSize(p);return Da.isNaN()||Da.isZero()?new N(H("width"),H("height")):Da}if(l&&p){this._id=p.getAttribute("id");null==this._id&&p.setAttribute("id",this._id=
"view-"+A._id++);mb.add(p,this._viewEvents);eb.setPrefixed(p.style,{userDrag:"none",userSelect:"none",touchCallout:"none",contentZooming:"none",tapHighlightColor:"rgba(0,0,0,0)"});if(g.hasAttribute(p,"resize")){var M=this;mb.add(l,this._windowEvents={resize:function(){M.setViewSize(O())}})}var R=O();if(g.hasAttribute(p,"stats")&&"undefined"!==typeof Stats){this._stats=new Stats;var W=this._stats.domElement,ma=W.style,wa=eb.getOffset(p);ma.position="absolute";ma.left=wa.x+"px";ma.top=wa.y+"px";e.body.appendChild(W)}}else R=
new N(p),p=null;this._project=k;this._scope=k._scope;this._element=p;this._pixelRatio||(this._pixelRatio=l&&l.devicePixelRatio||1);this._setElementSize(R.width,R.height);this._viewSize=R;A._views.push(this);A._viewsById[this._id]=this;(this._matrix=new Q)._owner=this;A._focused||(A._focused=this);this._frameItems={};this._frameItemCount=0;this._itemEvents={native:{},virtual:{}};this._autoUpdate=!ib.agent.node;this._needsUpdate=!1},remove:function(){if(!this._project)return!1;ub._focused===this&&(ub._focused=
null);ub._views.splice(ub._views.indexOf(this),1);delete ub._viewsById[this._id];var k=this._project;k._view===this&&(k._view=null);mb.remove(this._element,this._viewEvents);mb.remove(l,this._windowEvents);this._element=this._project=null;this.off("frame");this._animate=!1;this._frameItems={};return!0},_events:f.each(P._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(k){this[k]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,
_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(k){(this._autoUpdate=k)&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var k=this;mb.requestAnimationFrame(function(){k._requested=!1;if(k._animate){k.requestUpdate();var p=k._element;eb.getPrefixed(e,"hidden")&&"true"!==g.getAttribute(p,"keepalive")||!eb.isInView(p)||k._handleFrame()}k._autoUpdate&&k.update()});this._requested=!0}},play:function(){this._animate=
!0;this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){ib=this._scope;var k=Date.now()/1E3,p=this._last?k-this._last:0;this._last=k;this.emit("frame",new f({delta:p,time:this._time+=p,count:this._count++}));this._stats&&this._stats.update()},_animateItem:function(k,p){var A=this._frameItems;if(p){if(A[k._id]={item:k,time:0,count:0},1===++this._frameItemCount)this.on("frame",this._handleFrameItems)}else delete A[k._id],0===--this._frameItemCount&&this.off("frame",this._handleFrameItems)},
_handleFrameItems:function(k){for(var p in this._frameItems){var A=this._frameItems[p];A.item.emit("frame",new f(k,{time:A.time+=k.delta,count:A.count++}))}},_changed:function(){this._project._changed(4097);this._bounds=this._decomposed=b},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var k=this._viewSize;return new T(k.width,k.height,this,"setViewSize")},setViewSize:function(){var k=
N.read(arguments),p=k.subtract(this._viewSize);p.isZero()||(this._setElementSize(k.width,k.height),this._viewSize.set(k),this._changed(),this.emit("resize",{size:k,delta:p}),this._autoUpdate&&this.update())},_setElementSize:function(k,p){var A=this._element;A&&(A.width!==k&&(A.width=k),A.height!==p&&(A.height=p))},getBounds:function(){this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new V(new F,this._viewSize)));return this._bounds},getSize:function(){return this.getBounds().getSize()},
isVisible:function(){return eb.isInView(this._element)},isInserted:function(){return eb.isInserted(this._element)},getPixelSize:function(k){var p=this._element;if(p){p=p.parentNode;var A=e.createElement("div");A.style.fontSize=k;p.appendChild(A);var H=parseFloat(eb.getStyles(A).fontSize);p.removeChild(A)}else H=parseFloat(H);return H},getTextWidth:function(){return 0}},f.each(["rotate","scale","shear","skew"],function(k){var p="rotate"===k;this[k]=function(){var A=arguments,H=(p?f:F).read(A);A=F.read(A,
0,{readNull:!0});return this.transform((new Q)[k](H,A||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var k=new Q;return this.transform(k.translate.apply(k,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var k=F.read(arguments);this.translate(this.getCenter().subtract(k))},getZoom:function(){var k=this._decompose().scaling;return(k.x+k.y)/2},setZoom:function(k){this.transform((new Q).scale(k/
this.getZoom(),this.getCenter()))},getRotation:function(){return this._decompose().rotation},setRotation:function(k){var p=this.getRotation();null!=p&&null!=k&&this.rotate(k-p)},getScaling:function(){var k=this._decompose().scaling;return new G(k.x,k.y,this,"setScaling")},setScaling:function(){var k=this.getScaling(),p=F.read(arguments,0,{clone:!0,readNull:!0});k&&p&&this.scale(p.x/k.x,p.y/k.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var k=this._matrix;k.initialize.apply(k,
arguments)},transform:function(k){this._matrix.append(k)},scrollBy:function(){this.translate(F.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(F.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(F.read(arguments))},getEventPoint:function(k){return this.viewToProject(mb.getOffset(k,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(k,p){e&&"string"===typeof p&&(p=e.getElementById(p));return new (l?Bb:ub)(k,
p)}}},new function(){function k(gb){gb=mb.getTarget(gb);return gb.getAttribute&&ub._viewsById[gb.getAttribute("id")]}function p(){var gb=ub._focused;if(!gb||!gb.isVisible())for(var kb=0,jb=ub._views.length;kb<jb;kb++)if((gb=ub._views[kb]).isVisible()){ub._focused=M=gb;break}}function A(gb,kb,jb,Db,Ob,Mb,ec){function kc(xc,oc){if(xc.responds(oc)){if(tc||=new Pb(oc,Db,Ob,kb||xc,Mb?Ob.subtract(Mb):null),xc.emit(oc,tc)&&(Ha=!0,tc.prevented&&(Ma=!0),tc.stopped))return Oc=!0}else if(oc=Ta[oc])return kc(xc,
oc)}for(var Oc=!1,tc;gb&&gb!==ec&&!kc(gb,jb);)gb=gb._parent;return Oc}function H(gb,kb,jb,Db,Ob,Mb){gb._project.removeOn(jb);Ma=Ha=!1;return Ab&&A(Ab,null,jb,Db,Ob,Mb)||kb&&kb!==Ab&&!kb.isDescendant(Ab)&&A(kb,null,"mousedrag"===jb?"mousemove":jb,Db,Ob,Mb,Ab)||A(gb,Ab||kb||gb,jb,Db,Ob,Mb)}if(l){var O,M,R=!1,W=!1,ma=l.navigator;if(ma.pointerEnabled||ma.msPointerEnabled){var wa="pointerdown MSPointerDown";var Da="pointermove MSPointerMove";var Ea="pointerup pointercancel MSPointerUp MSPointerCancel"}else wa=
"touchstart",Da="touchmove",Ea="touchend touchcancel","ontouchstart"in l&&ma.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(wa+=" mousedown",Da+=" mousemove",Ea+=" mouseup");ma={};var Pa={mouseout:function(gb){var kb=ub._focused,jb=mb.getRelatedTarget(gb);if(kb&&(!jb||"HTML"===jb.nodeName)){jb=mb.getOffset(gb,kb._element);var Db=jb.x,Ob=Math.abs,Mb=Ob(Db),ec=Mb-33554432;jb.x=Ob(ec)<Mb?ec*(0>Db?-1:1):Db;jb=kb.viewToProject(jb);kb._handleMouseEvent("mousemove",gb,jb)}},scroll:p};ma[wa]=
function(gb){var kb=ub._focused=k(gb);R||(R=!0,kb._handleMouseEvent("mousedown",gb))};Pa[Da]=function(gb){var kb=ub._focused;if(!W){var jb=k(gb);jb?kb!==jb&&(kb&&kb._handleMouseEvent("mousemove",gb,void 0),O||=kb,kb=ub._focused=M=jb):M&&M===kb&&(O&&!O.isInserted()&&(O=null),kb=ub._focused=O,O=null,p())}kb&&kb._handleMouseEvent("mousemove",gb,void 0)};Pa[wa]=function(){W=!0};Pa[Ea]=function(gb){var kb=ub._focused;kb&&R&&kb._handleMouseEvent("mouseup",gb);W=R=!1};mb.add(e,Pa);mb.add(l,{load:p});var Ha=
!1,Ma=!1,Ta={doubleclick:"click",mousedrag:"mousemove"},Ka=!1,Wa,bb,hb,sb,Ab,La,Ra,Za,cb={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:ma,_handleMouseEvent:function(gb,kb,jb){function Db(Pc){return Ob.virtual[Pc]||Oc.responds(Pc)||kc&&kc.responds(Pc)}var Ob=this._itemEvents,Mb=Ob.native[gb],ec="mousemove"===gb,kc=this._scope.tool,Oc=this;ec&&R&&Db("mousedrag")&&
(gb="mousedrag");jb||=this.getEventPoint(kb);var tc=this.getBounds().contains(jb),xc=Mb&&tc&&Oc._project.hitTest(jb,{tolerance:0,fill:!0,stroke:!0});xc=xc&&xc.item||null;var oc=!1,Ac={};Ac[gb.substr(5)]=!0;Mb&&xc!==sb&&(sb&&A(sb,null,"mouseleave",kb,jb),xc&&A(xc,null,"mouseenter",kb,jb),sb=xc);Ka^tc&&(A(this,null,tc?"mouseenter":"mouseleave",kb,jb),oc=!0);!tc&&!Ac.drag||jb.equals(bb)||(H(this,xc,ec?gb:"mousemove",kb,jb,bb),oc=!0);Ka=tc;if(Ac.down&&tc||Ac.up&&Wa){H(this,xc,gb,kb,jb,Wa);if(Ac.down){Za=
xc===La&&300>Date.now()-Ra;hb=La=xc;if(!Ma&&xc){for(Mb=xc;Mb&&!Mb.responds("mousedrag");)Mb=Mb._parent;Mb&&(Ab=xc)}Wa=jb}else Ac.up&&(Ma||xc!==hb||(Ra=Date.now(),H(this,xc,Za?"doubleclick":"click",kb,jb,Wa),Za=!1),hb=Ab=null);Ka=!1;oc=!0}bb=jb;oc&&kc&&(Ha=kc._handleMouseEvent(gb,kb,jb,Ac)||Ha);!1!==kb.cancelable&&(Ha&&!Ac.move||Ac.down&&Db("mouseup"))&&kb.preventDefault()},_handleKeyEvent:function(gb,kb,jb,Db){function Ob(Oc){Oc.responds(gb)&&(ib=Mb,Oc.emit(gb,kc=kc||new yb(gb,kb,jb,Db)))}var Mb=
this._scope,ec=Mb.tool,kc;this.isVisible()&&(Ob(this),ec&&ec.responds(gb)&&Ob(ec))},_countItemEvent:function(gb,kb){var jb=this._itemEvents,Db=jb.native;jb=jb.virtual;for(var Ob in cb)Db[Ob]=(Db[Ob]||0)+(cb[Ob][gb]||0)*kb;jb[gb]=(jb[gb]||0)+kb},statics:{updateFocus:p,_resetState:function(){R=W=Ha=Ka=!1;O=M=Wa=bb=hb=sb=Ab=La=Ra=Za=null}}}}}),Bb=ub.extend({_class:"CanvasView",initialize:function(k,p){if(!(p instanceof l.HTMLCanvasElement)){var A=N.read(arguments,1);if(A.isZero())throw Error("Cannot create CanvasView with the provided argument: "+
f.slice(arguments,1));p=Nb.getCanvas(A)}var H=this._context=p.getContext("2d");H.save();this._pixelRatio=1;/^off|false$/.test(g.getAttribute(p,"hidpi"))||(A=l.devicePixelRatio||1,H=eb.getPrefixed(H,"backingStorePixelRatio")||1,this._pixelRatio=A/H);ub.call(this,k,p);this._needsUpdate=!0},remove:function p(){this._context.restore();return p.base.call(this)},_setElementSize:function O(A,H){var M=this._pixelRatio;O.base.call(this,A*M,H*M);if(1!==M){var R=this._element,W=this._context;g.hasAttribute(R,
"resize")||(R=R.style,R.width=A+"px",R.height=H+"px");W.restore();W.save();W.scale(M,M)}},getContext:function(){return this._context},getPixelSize:function O(H){var M=ib.agent;if(M&&M.firefox)H=O.base.call(this,H);else{M=this._context;var R=M.font;M.font=H+" serif";H=parseFloat(M.font);M.font=R}return H},getTextWidth:function(H,O){var M=this._context,R=M.font,W=0;M.font=H;H=0;for(var ma=O.length;H<ma;H++)W=Math.max(W,M.measureText(O[H]).width);M.font=R;return W},update:function(){if(!this._needsUpdate)return!1;
var H=this._project,O=this._context,M=this._viewSize;O.clearRect(0,0,M.width+1,M.height+1);H&&H.draw(O,this._matrix,this._pixelRatio);this._needsUpdate=!1;return!0}}),qb=f.extend({_class:"Event",initialize:function(H){this.type=(this.event=H)&&H.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0;this.event.preventDefault()},stopPropagation:function(){this.stopped=!0;this.event.stopPropagation()},stop:function(){this.stopPropagation();this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},
getModifiers:function(){return Ib.modifiers}}),yb=qb.extend({_class:"KeyEvent",initialize:function(H,O,M,R){this.type=H;this.event=O;this.key=M;this.character=R},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),Ib=new function(){function H(Pa){var Ha=Pa.key||Pa.keyIdentifier;Ha=/^U\+/.test(Ha)?String.fromCharCode(parseInt(Ha.substr(2),16)):/^Arrow[A-Z]/.test(Ha)?Ha.substr(5):"Unidentified"===Ha||Ha===
b?String.fromCharCode(Pa.keyCode):Ha;return M[Ha]||(1<Ha.length?f.hyphenate(Ha):Ha.toLowerCase())}function O(Pa,Ha,Ma,Ta){var Ka=ub._focused,Wa;(W[Ha]=Pa)?ma[Ha]=Ma:delete ma[Ha];if(1<Ha.length&&(Wa=f.camelize(Ha))in Ea){Ea[Wa]=Pa;var bb=ib&&ib.agent;if("meta"===Wa&&bb&&bb.mac)if(Pa)wa={};else{for(var hb in wa)hb in ma&&O(!1,hb,wa[hb],Ta);wa=null}}else Pa&&wa&&(wa[Ha]=Ma);Ka&&Ka._handleKeyEvent(Pa?"keydown":"keyup",Ta,Ha,Ma)}var M={"\t":"tab"," ":"space","\b":"backspace","\u007f":"delete",Spacebar:"space",
Del:"delete",Win:"meta",Esc:"escape"},R={tab:"\t",space:" ",enter:"\r"},W={},ma={},wa,Da,Ea=(new f({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1})).inject({option:{get:function(){return this.alt}},command:{get:function(){var Pa=ib&&ib.agent;return Pa&&Pa.mac?this.meta:this.control}}});mb.add(e,{keydown:function(Pa){var Ha=H(Pa),Ma=ib&&ib.agent;1<Ha.length||Ma&&Ma.chrome&&(Pa.altKey||Ma.mac&&Pa.metaKey||!Ma.mac&&Pa.ctrlKey)?O(!0,Ha,R[Ha]||(1<Ha.length?"":Ha),Pa):Da=Ha},keypress:function(Pa){if(Da){var Ha=
H(Pa),Ma=Pa.charCode;Ma=32<=Ma?String.fromCharCode(Ma):1<Ha.length?"":Ha;Ha!==Da&&(Ha=Ma.toLowerCase());O(!0,Ha,Ma,Pa);Da=null}},keyup:function(Pa){var Ha=H(Pa);Ha in ma&&O(!1,Ha,ma[Ha],Pa)}});mb.add(l,{blur:function(Pa){for(var Ha in ma)O(!1,Ha,ma[Ha],Pa)}});return{modifiers:Ea,isDown:function(Pa){return!!W[Pa]}}},Pb=qb.extend({_class:"MouseEvent",initialize:function(H,O,M,R,W){this.type=H;this.event=O;this.point=M;this.target=R;this.delta=W},toString:function(){return"{ type: '"+this.type+"', point: "+
this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),Eb=qb.extend({_class:"ToolEvent",_item:null,initialize:function(H,O,M){this.tool=H;this.type=O;this.event=M},_choosePoint:function(H,O){return H?H:O?O.clone():null},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(H){this._point=H},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(H){this._lastPoint=
H},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(H){this._downPoint=H},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(H){this._middlePoint=H},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(H){this._delta=H},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?
"_downCount":"_moveCount"]},setCount:function(H){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=H},getItem:function(){if(!this._item){var H=this.tool._scope.project.hitTest(this.getPoint());if(H){H=H.item;for(var O=H._parent;/^(Group|CompoundPath)$/.test(O._class);)H=O,O=O._parent;this._item=H}}return this._item},setItem:function(H){this._item=H},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+
" }"}});m.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:"onMouseDown onMouseUp onMouseDrag onMouseMove onActivate onDeactivate onEditOptions onKeyDown onKeyUp".split(" "),initialize:function(H){m.call(this);this._downCount=this._moveCount=-1;this.set(H)},getMinDistance:function(){return this._minDistance},setMinDistance:function(H){this._minDistance=H;null!=H&&null!=this._maxDistance&&H>this._maxDistance&&(this._maxDistance=H)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(H){this._maxDistance=
H;null!=this._minDistance&&null!=H&&H<this._minDistance&&(this._minDistance=H)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(H){this._minDistance=this._maxDistance=H},_handleMouseEvent:function(H,O,M,R){function W(Ta,Ka){var Wa=M,bb=wa?Ma._point:Ma._downPoint||Wa;if(wa){if(0<=Ma._moveCount&&Wa.equals(bb))return!1;if(bb&&(null!=Ta||null!=Ka)){var hb=Wa.subtract(bb),sb=hb.getLength();if(sb<(Ta||0))return!1;Ka&&(Wa=bb.add(hb.normalize(Math.min(sb,
Ka))))}Ma._moveCount++}Ma._point=Wa;Ma._lastPoint=bb||Wa;R.down&&(Ma._moveCount=-1,Ma._downPoint=Wa,Ma._downCount++);return!0}function ma(){Da&&(Ha=Ma.emit(H,new Eb(Ma,H,O))||Ha)}ib=this._scope;R.drag&&!this.responds(H)&&(H="mousemove");var wa=R.move||R.drag,Da=this.responds(H),Ea=this.minDistance,Pa=this.maxDistance,Ha=!1,Ma=this;if(R.down)W(),ma();else if(R.up)W(null,Pa),ma();else if(Da)for(;W(Ea,Pa);)ma();return Ha}});var z=f.extend(h,{_class:"Tween",statics:{easings:{linear:function(H){return H},
easeInQuad:function(H){return H*H},easeOutQuad:function(H){return H*(2-H)},easeInOutQuad:function(H){return.5>H?2*H*H:-1+2*(2-H)*H},easeInCubic:function(H){return H*H*H},easeOutCubic:function(H){return--H*H*H+1},easeInOutCubic:function(H){return.5>H?4*H*H*H:(H-1)*(2*H-2)*(2*H-2)+1},easeInQuart:function(H){return H*H*H*H},easeOutQuart:function(H){return 1- --H*H*H*H},easeInOutQuart:function(H){return.5>H?8*H*H*H*H:1-8*--H*H*H*H},easeInQuint:function(H){return H*H*H*H*H},easeOutQuint:function(H){return 1+
--H*H*H*H*H},easeInOutQuint:function(H){return.5>H?16*H*H*H*H*H:1+16*--H*H*H*H*H}}},initialize:function Da(O,M,R,W,ma,wa){this.object=O;O=typeof ma;var Ea="function"===O;this.type=Ea?O:"string"===O?ma:"linear";this.easing=Ea?ma:Da.easings[this.type];this.duration=W;this.running=!1;this._startTime=this._then=null;this._keys=(W=M||R)?Object.keys(W):[];this._parsedKeys=this._parseKeys(this._keys);this._from=W&&this._getState(M);this._to=W&&this._getState(R);!1!==wa&&this.start()},then:function(O){this._then=
O;return this},start:function(){this._startTime=null;this.running=!0;return this},stop:function(){this.running=!1;return this},update:function(O){if(this.running){1<O&&(O=1,this.running=!1);for(var M=this.easing(O),R=this._keys,W=function(Ha){return"function"===typeof Ha?Ha(M,O):Ha},ma=0,wa=R&&R.length;ma<wa;ma++){var Da=R[ma],Ea=W(this._from[Da]),Pa=W(this._to[Da]);Ea=Ea&&Pa&&Ea.__add&&Pa.__add?Pa.__subtract(Ea).__multiply(M).__add(Ea):(Pa-Ea)*M+Ea;this._setProperty(this._parsedKeys[Da],Ea)}!this.running&&
this._then&&this._then(this.object);this.responds("update")&&this.emit("update",new f({progress:O,factor:M}))}return this},_events:{onUpdate:{}},_handleFrame:function(O){var M=this._startTime,R=M?(O-M)/this.duration:0;M||(this._startTime=O);this.update(R)},_getState:function(O){for(var M=this._keys,R={},W=0,ma=M.length;W<ma;W++){var wa=M[W],Da=this._parsedKeys[wa],Ea=this._getProperty(Da);if(O){var Pa=this._resolveValue(Ea,O[wa]);this._setProperty(Da,Pa);Pa=(Pa=this._getProperty(Da))&&Pa.clone?Pa.clone():
Pa;this._setProperty(Da,Ea)}else Pa=Ea&&Ea.clone?Ea.clone():Ea;R[wa]=Pa}return R},_resolveValue:function(O,M){if(M){if(Array.isArray(M)&&2===M.length){var R=M[0];return R&&R.match&&R.match(/^[+\-\*\/]=/)?this._calculate(O,R[0],M[1]):M}if("string"===typeof M&&(R=M.match(/^[+\-*/]=(.*)/)))return R=JSON.parse(R[1].replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": ')),this._calculate(O,M[0],R)}return M},_calculate:function(O,M,R){return ib.PaperScript.calculateBinary(O,M,R)},_parseKeys:function(O){for(var M=
{},R=0,W=O.length;R<W;R++){var ma=O[R],wa=ma.replace(/\.([^.]*)/g,"/$1").replace(/\[['"]?([^'"\]]*)['"]?\]/g,"/$1");M[ma]=wa.split("/")}return M},_getProperty:function(O,M){var R=this.object,W=0;for(M=O.length-(M||0);W<M&&R;W++)R=R[O[W]];return R},_setProperty:function(O,M){var R=this._getProperty(O,1);R&&(R[O[O.length-1]]=M)}}),Xb={request:function(O){var M=new a.XMLHttpRequest;M.open((O.method||"get").toUpperCase(),O.url,f.pick(O.async,!0));O.mimeType&&M.overrideMimeType(O.mimeType);M.onload=function(){var R=
M.status;if(0===R||200===R)O.onLoad&&O.onLoad.call(M,M.responseText);else M.onerror()};M.onerror=function(){var R=M.status,W='Could not load "'+O.url+'" (Status: '+R+")";if(O.onError)O.onError(W,R);else throw Error(W);};return M.send(null)}},Nb={canvases:[],getCanvas:function(O,M){if(!l)return null;var R=!0;"object"===typeof O&&(M=O.height,O=O.width);if(this.canvases.length)var W=this.canvases.pop();else W=e.createElement("canvas"),R=!1;var ma=W.getContext("2d");if(!ma)throw Error("Canvas "+W+" is unable to provide a 2D context.");
W.width===O&&W.height===M?R&&ma.clearRect(0,0,O+1,M+1):(W.width=O,W.height=M);ma.save();return W},getContext:function(O,M){return(O=this.getCanvas(O,M))?O.getContext("2d"):null},release:function(O){(O=O&&O.canvas?O.canvas:O)&&O.getContext&&(O.getContext("2d").restore(),this.canvases.push(O))}},Rb=new function(){function O(Ra,Za,cb,gb){gb-=.2989*Ra+.587*Za+.114*cb;Wa=Ra+gb;bb=Za+gb;hb=cb+gb;gb=.2989*Wa+.587*bb+.114*hb;Za=R(Wa,bb,hb);Ra=W(Wa,bb,hb);0>Za&&(Za=gb-Za,Wa=gb+(Wa-gb)*gb/Za,bb=gb+(bb-gb)*
gb/Za,hb=gb+(hb-gb)*gb/Za);255<Ra&&(Za=255-gb,Ra-=gb,Wa=gb+(Wa-gb)*Za/Ra,bb=gb+(bb-gb)*Za/Ra,hb=gb+(hb-gb)*Za/Ra)}function M(Ra,Za,cb,gb){var kb=[Ra,Za,cb],jb=W(Ra,Za,cb);cb=R(Ra,Za,cb);cb=cb===Ra?0:cb===Za?1:2;jb=jb===Ra?0:jb===Za?1:2;Ra=0===R(cb,jb)?1===W(cb,jb)?2:1:0;kb[jb]>kb[cb]?(kb[Ra]=(kb[Ra]-kb[cb])*gb/(kb[jb]-kb[cb]),kb[jb]=gb):kb[Ra]=kb[jb]=0;kb[cb]=0;Wa=kb[0];bb=kb[1];hb=kb[2]}var R=Math.min,W=Math.max,ma=Math.abs,wa,Da,Ea,Pa,Ha,Ma,Ta,Ka,Wa,bb,hb,sb={multiply:function(){Wa=Ha*wa/255;bb=
Ma*Da/255;hb=Ta*Ea/255},screen:function(){Wa=Ha+wa-Ha*wa/255;bb=Ma+Da-Ma*Da/255;hb=Ta+Ea-Ta*Ea/255},overlay:function(){Wa=128>Ha?2*Ha*wa/255:255-2*(255-Ha)*(255-wa)/255;bb=128>Ma?2*Ma*Da/255:255-2*(255-Ma)*(255-Da)/255;hb=128>Ta?2*Ta*Ea/255:255-2*(255-Ta)*(255-Ea)/255},"soft-light":function(){var Ra=wa*Ha/255;Wa=Ra+Ha*(255-(255-Ha)*(255-wa)/255-Ra)/255;Ra=Da*Ma/255;bb=Ra+Ma*(255-(255-Ma)*(255-Da)/255-Ra)/255;Ra=Ea*Ta/255;hb=Ra+Ta*(255-(255-Ta)*(255-Ea)/255-Ra)/255},"hard-light":function(){Wa=128>
wa?2*wa*Ha/255:255-2*(255-wa)*(255-Ha)/255;bb=128>Da?2*Da*Ma/255:255-2*(255-Da)*(255-Ma)/255;hb=128>Ea?2*Ea*Ta/255:255-2*(255-Ea)*(255-Ta)/255},"color-dodge":function(){Wa=0===Ha?0:255===wa?255:R(255,255*Ha/(255-wa));bb=0===Ma?0:255===Da?255:R(255,255*Ma/(255-Da));hb=0===Ta?0:255===Ea?255:R(255,255*Ta/(255-Ea))},"color-burn":function(){Wa=255===Ha?255:0===wa?0:W(0,255-255*(255-Ha)/wa);bb=255===Ma?255:0===Da?0:W(0,255-255*(255-Ma)/Da);hb=255===Ta?255:0===Ea?0:W(0,255-255*(255-Ta)/Ea)},darken:function(){Wa=
Ha<wa?Ha:wa;bb=Ma<Da?Ma:Da;hb=Ta<Ea?Ta:Ea},lighten:function(){Wa=Ha>wa?Ha:wa;bb=Ma>Da?Ma:Da;hb=Ta>Ea?Ta:Ea},difference:function(){Wa=Ha-wa;0>Wa&&(Wa=-Wa);bb=Ma-Da;0>bb&&(bb=-bb);hb=Ta-Ea;0>hb&&(hb=-hb)},exclusion:function(){Wa=Ha+wa*(255-Ha-Ha)/255;bb=Ma+Da*(255-Ma-Ma)/255;hb=Ta+Ea*(255-Ta-Ta)/255},hue:function(){var Ra=wa,Za=Da,cb=Ea;var gb=Ha;var kb=Ma,jb=Ta;gb=W(gb,kb,jb)-R(gb,kb,jb);M(Ra,Za,cb,gb);O(Wa,bb,hb,.2989*Ha+.587*Ma+.114*Ta)},saturation:function(){var Ra=Ha,Za=Ma,cb=Ta;var gb=wa;var kb=
Da,jb=Ea;gb=W(gb,kb,jb)-R(gb,kb,jb);M(Ra,Za,cb,gb);O(Wa,bb,hb,.2989*Ha+.587*Ma+.114*Ta)},luminosity:function(){O(Ha,Ma,Ta,.2989*wa+.587*Da+.114*Ea)},color:function(){O(wa,Da,Ea,.2989*Ha+.587*Ma+.114*Ta)},add:function(){Wa=R(Ha+wa,255);bb=R(Ma+Da,255);hb=R(Ta+Ea,255)},subtract:function(){Wa=W(Ha-wa,0);bb=W(Ma-Da,0);hb=W(Ta-Ea,0)},average:function(){Wa=(Ha+wa)/2;bb=(Ma+Da)/2;hb=(Ta+Ea)/2},negation:function(){Wa=255-ma(255-wa-Ha);bb=255-ma(255-Da-Ma);hb=255-ma(255-Ea-Ta)}},Ab=this.nativeModes=f.each("source-over source-in source-out source-atop destination-over destination-in destination-out destination-atop lighter darker copy xor".split(" "),
function(Ra){this[Ra]=!0},{}),La=Nb.getContext(1,1);La&&(f.each(sb,function(Ra,Za){Ra="darken"===Za;var cb=!1;La.save();try{La.fillStyle=Ra?"#300":"#a00",La.fillRect(0,0,1,1),La.globalCompositeOperation=Za,La.globalCompositeOperation===Za&&(La.fillStyle=Ra?"#a00":"#300",La.fillRect(0,0,1,1),cb=La.getImageData(0,0,1,1).data[0]!==Ra?170:51)}catch(gb){}La.restore();Ab[Za]=cb}),Nb.release(La));this.process=function(Ra,Za,cb,gb,kb){var jb=Za.canvas,Db="normal"===Ra;if(Db||Ab[Ra])cb.save(),cb.setTransform(1,
0,0,1,0,0),cb.globalAlpha=gb,Db||(cb.globalCompositeOperation=Ra),cb.drawImage(jb,kb.x,kb.y),cb.restore();else if(Ra=sb[Ra]){Db=cb.getImageData(kb.x,kb.y,jb.width,jb.height);var Ob=Db.data;Za=Za.getImageData(0,0,jb.width,jb.height).data;jb=0;for(var Mb=Ob.length;jb<Mb;jb+=4){wa=Za[jb];Ha=Ob[jb];Da=Za[jb+1];Ma=Ob[jb+1];Ea=Za[jb+2];Ta=Ob[jb+2];Pa=Za[jb+3];Ka=Ob[jb+3];Ra();var ec=Pa*gb/255,kc=1-ec;Ob[jb]=ec*Wa+kc*Ha;Ob[jb+1]=ec*bb+kc*Ma;Ob[jb+2]=ec*hb+kc*Ta;Ob[jb+3]=Pa*gb+kc*Ka}cb.putImageData(Db,kb.x,
kb.y)}}},Fb=new function(){function O(R,W,ma){for(var wa in W){var Da=W[wa],Ea=M[wa];"number"===typeof Da&&ma&&(Da=ma.number(Da));Ea?R.setAttributeNS(Ea,wa,Da):R.setAttribute(wa,Da)}return R}var M={href:"http://www.w3.org/1999/xlink",xlink:"http://www.w3.org/2000/xmlns",xmlns:"http://www.w3.org/2000/xmlns/","xmlns:xlink":"http://www.w3.org/2000/xmlns/"};return{svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns",xlink:"http://www.w3.org/1999/xlink",create:function(R,W,ma){return O(e.createElementNS("http://www.w3.org/2000/svg",
R),W,ma)},get:function(R,W){var ma=M[W];R=ma?R.getAttributeNS(ma,W):R.getAttribute(W);return"null"===R?null:R},set:O}},Wb=f.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(O,M){return!M&&(O instanceof ya||O instanceof Fa||O instanceof Cb)}],miterLimit:["stroke-miterlimit",
"number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(O,M){var R=f.capitalize(M),W=O[2];this[M]={type:O[1],property:M,attribute:O[0],toSVG:W,fromSVG:W&&f.each(W,function(ma,wa){this[ma]=wa},{}),exportFilter:O[3],
get:"get"+R,set:"set"+R}},{});new function(){function O(Ka,Wa,bb){var hb=new f,sb=Ka.getTranslation();Wa&&(Ka.isInvertible()?(Ka=Ka._shiftless(),Wa=Ka._inverseTransform(sb),sb=null):Wa=new F,hb[bb?"cx":"x"]=Wa.x,hb[bb?"cy":"y"]=Wa.y);if(!Ka.isIdentity())if(bb=Ka.decompose()){Ka=[];Wa=bb.rotation;var Ab=bb.scaling;bb=bb.skewing;sb&&!sb.isZero()&&Ka.push("translate("+Ha.point(sb)+")");Wa&&Ka.push("rotate("+Ha.number(Wa)+")");B.isZero(Ab.x-1)&&B.isZero(Ab.y-1)||Ka.push("scale("+Ha.point(Ab)+")");bb.x&&
Ka.push("skewX("+Ha.number(bb.x)+")");bb.y&&Ka.push("skewY("+Ha.number(bb.y)+")");hb.transform=Ka.join(" ")}else hb.transform="matrix("+Ka.getValues().join(",")+")";return hb}function M(Ka,Wa){var bb=O(Ka._matrix);Ka=Ka._children;bb=Fb.create("g",bb,Ha);for(var hb=0,sb=Ka.length;hb<sb;hb++){var Ab=Ka[hb],La=Ea(Ab,Wa);if(La)if(Ab.isClipMask()){var Ra=Fb.create("clipPath");Ra.appendChild(La);wa(Ab,Ra,"clip");Fb.set(bb,{"clip-path":"url(#"+Ra.id+")"})}else bb.appendChild(La)}return bb}function R(Ka){var Wa=
Ka._type,bb=Ka._radius,hb=O(Ka._matrix,!0,"rectangle"!==Wa);if("rectangle"===Wa){Wa="rect";var sb=Ka._size;Ka=sb.width;sb=sb.height;hb.x-=Ka/2;hb.y-=sb/2;hb.width=Ka;hb.height=sb;bb.isZero()&&(bb=null)}bb&&("circle"===Wa?hb.r=bb:(hb.rx=bb.width,hb.ry=bb.height));return Fb.create(Wa,hb,Ha)}function W(Ka,Wa,bb){var hb={},sb=!bb&&Ka.getParent(),Ab=[];null!=Ka._name&&(hb.id=Ka._name);f.each(Wb,function(La){var Ra=La.get,Za=La.type,cb=Ka[Ra]();if(La.exportFilter?La.exportFilter(Ka,cb):!sb||!f.equals(sb[Ra](),
cb))if("color"===Za&&null!=cb&&(Ra=cb.getAlpha(),1>Ra&&(hb[La.attribute+"-opacity"]=Ra)),"style"===Za)Ab.push(La.attribute+": "+cb);else{Ra=La.attribute;if(null==cb)cb="none";else if("color"===Za)if(cb.gradient){La=ma(cb,"color");if(!La){var gb=cb.getGradient();La=gb._radial;Za=cb.getOrigin();var kb=cb.getDestination();if(La){if(Za={cx:Za.x,cy:Za.y,r:Za.getDistance(kb)},kb=cb.getHighlight())Za.fx=kb.x,Za.fy=kb.y}else Za={x1:Za.x,y1:Za.y,x2:kb.x,y2:kb.y};Za.gradientUnits="userSpaceOnUse";La=Fb.create((La?
"radial":"linear")+"Gradient",Za,Ha);gb=gb._stops;kb=0;for(var jb=gb.length;kb<jb;kb++){Za=gb[kb];var Db=Za._color,Ob=Db.getAlpha();Za=Za._offset;Za={offset:null==Za?kb/(jb-1):Za};Db&&(Za["stop-color"]=Db.toCSS(!0));1>Ob&&(Za["stop-opacity"]=Ob);La.appendChild(Fb.create("stop",Za,Ha))}wa(cb,La,"color")}cb="url(#"+La.id+")"}else cb=cb.toCSS(!0);else cb="array"===Za?cb.join(","):"lookup"===Za?La.toSVG[cb]:cb;hb[Ra]=cb}});Ab.length&&(hb.style=Ab.join(";"));1===hb.opacity&&delete hb.opacity;Ka._visible||
(hb.visibility="hidden");return Fb.set(Wa,hb,Ha)}function ma(Ka,Wa){Ta||={ids:{},svgs:{}};return Ka&&Ta.svgs[Wa+"-"+(Ka._id||Ka.__id||(Ka.__id=D.get("svg")))]}function wa(Ka,Wa,bb){Ta||ma();var hb=Ta.ids[bb]=(Ta.ids[bb]||0)+1;Wa.id=bb+"-"+hb;Ta.svgs[bb+"-"+(Ka._id||Ka.__id)]=Wa}function Da(Ka,Wa){var bb=Ka,hb=null;if(Ta){bb="svg"===Ka.nodeName.toLowerCase()&&Ka;for(var sb in Ta.svgs)hb||(bb||(bb=Fb.create("svg"),bb.appendChild(Ka)),hb=bb.insertBefore(Fb.create("defs"),bb.firstChild)),hb.appendChild(Ta.svgs[sb]);
Ta=null}return Wa.asString?(new a.XMLSerializer).serializeToString(bb):bb}function Ea(Ka,Wa,bb){var hb=Ma[Ka._class];if(hb=hb&&hb(Ka,Wa)){var sb=Wa.onExport;sb&&(hb=sb(Ka,hb,Wa)||hb);(Wa=JSON.stringify(Ka._data))&&"{}"!==Wa&&"null"!==Wa&&hb.setAttribute("data-paper-data",Wa)}return hb&&W(Ka,hb,bb)}function Pa(Ka){Ka||={};Ha=new r(Ka.precision);return Ka}var Ha,Ma={Group:M,Layer:M,Raster:function(Ka,Wa){var bb=O(Ka._matrix,!0),hb=Ka.getSize(),sb=Ka.getImage();bb.x-=hb.width/2;bb.y-=hb.height/2;bb.width=
hb.width;bb.height=hb.height;bb.href=0==Wa.embedImages&&sb&&sb.src||Ka.toDataURL();return Fb.create("image",bb,Ha)},Path:function(Ka,Wa){var bb=Wa.matchShapes;if(bb){var hb=Ka.toShape(!1);if(hb)return R(hb,Wa)}var sb=Ka._segments,Ab=sb.length;hb=O(Ka._matrix);if(bb&&2<=Ab&&!Ka.hasHandles())if(2<Ab){bb=Ka._closed?"polygon":"polyline";Ka=[];for(Wa=0;Wa<Ab;Wa++)Ka.push(Ha.point(sb[Wa]._point));hb.points=Ka.join(" ")}else bb="line",Ab=sb[0]._point,sb=sb[1]._point,hb.set({x1:Ab.x,y1:Ab.y,x2:sb.x,y2:sb.y});
else bb="path",hb.d=Ka.getPathData(null,Wa.precision);return Fb.create(bb,hb,Ha)},Shape:R,CompoundPath:function(Ka,Wa){var bb=O(Ka._matrix);if(Ka=Ka.getPathData(null,Wa.precision))bb.d=Ka;return Fb.create("path",bb,Ha)},SymbolItem:function(Ka,Wa){var bb=O(Ka._matrix,!0);Ka=Ka._definition;var hb=ma(Ka,"symbol"),sb=Ka._item,Ab=sb.getStrokeBounds();hb||(hb=Fb.create("symbol",{viewBox:Ha.rectangle(Ab)}),hb.appendChild(Ea(sb,Wa)),wa(Ka,hb,"symbol"));bb.href="#"+hb.id;bb.x+=Ab.x;bb.y+=Ab.y;bb.width=Ab.width;
bb.height=Ab.height;bb.overflow="visible";return Fb.create("use",bb,Ha)},PointText:function(Ka){var Wa=Fb.create("text",O(Ka._matrix,!0),Ha);Wa.textContent=Ka._content;return Wa}},Ta;P.inject({exportSVG:function(Ka){Ka=Pa(Ka);return Da(Ea(this,Ka,!0),Ka)}});qa.inject({exportSVG:function(Ka){Ka=Pa(Ka);var Wa=this._children,bb=this.getView(),hb=f.pick(Ka.bounds,"view"),sb=Ka.matrix||"view"===hb&&bb._matrix;sb=sb&&Q.read([sb]);bb="view"===hb?new V([0,0],bb.getViewSize()):"content"===hb?P._getBounds(Wa,
sb,{stroke:!0}).rect:V.read([hb],0,{readNull:!0});hb={version:"1.1",xmlns:Fb.svg,"xmlns:xlink":Fb.xlink};bb&&(hb.width=bb.width,hb.height=bb.height,bb.x||0===bb.x||bb.y||0===bb.y)&&(hb.viewBox=Ha.rectangle(bb));hb=bb=Fb.create("svg",hb,Ha);sb&&!sb.isIdentity()&&(hb=bb.appendChild(Fb.create("g",O(sb),Ha)));sb=0;for(var Ab=Wa.length;sb<Ab;sb++)hb.appendChild(Ea(Wa[sb],Ka,!0));return Da(bb,Ka)}})};new function(){function O(La,Ra,Za,cb,gb,kb){La=Fb.get(La,Ra)||kb;Za=null==La?cb?null:Za?"":0:Za?La:parseFloat(La);
return/%\s*$/.test(La)?Za/100*(gb?1:hb[/x|^width/.test(Ra)?"width":"height"]):Za}function M(La,Ra,Za,cb,gb,kb,jb){Ra=O(La,Ra||"x",!1,cb,gb,kb);Za=O(La,Za||"y",!1,cb,gb,jb);return!cb||null!=Ra&&null!=Za?new F(Ra,Za):null}function R(La,Ra,Za,cb,gb){Ra=O(La,Ra||"width",!1,cb,gb);Za=O(La,Za||"height",!1,cb,gb);return!cb||null!=Ra&&null!=Za?new N(Ra,Za):null}function W(La,Ra,Za){return"none"===La?null:"number"===Ra?parseFloat(La):"array"===Ra?La?La.split(/[\s,]+/g).map(parseFloat):[]:"color"===Ra?Ta(La)||
La:"lookup"===Ra?Za[La]:La}function ma(La,Ra,Za,cb){var gb=La.childNodes,kb="clippath"===Ra;Ra="defs"===Ra;var jb=new ea,Db=jb._project,Ob=Db._currentStyle,Mb=[];kb||Ra||(jb=Ma(jb,La,cb),Db._currentStyle=jb._style.clone());if(cb)for(var ec=La.querySelectorAll("defs"),kc=0,Oc=ec.length;kc<Oc;kc++)Ka(ec[kc],Za,!1);kc=0;for(Oc=gb.length;kc<Oc;kc++){ec=gb[kc];var tc;1!==ec.nodeType||/^defs$/i.test(ec.nodeName)||!(tc=Ka(ec,Za,!1))||tc instanceof Ca||Mb.push(tc)}jb.addChildren(Mb);kb&&(jb=Ma(jb.reduce(),
La,cb));Db._currentStyle=Ob;if(kb||Ra)jb.remove(),jb=null;return jb}function wa(La,Ra){La=La.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);for(var Za=[],cb=0,gb=La.length;cb<gb;cb+=2)Za.push(new F(parseFloat(La[cb]),parseFloat(La[cb+1])));La=new Ia(Za);"polygon"===Ra&&La.closePath();return La}function Da(La,Ra){var Za=(O(La,"href",!0)||"").substring(1);Ra="radialgradient"===Ra;if(Za)Za=bb[Za].getGradient(),Za._radial^Ra&&(Za=Za.clone(),Za._radial=Ra);else{Za=La.childNodes;
for(var cb=[],gb=0,kb=Za.length;gb<kb;gb++){var jb=Za[gb];1===jb.nodeType&&cb.push(Ma(new fb,jb))}Za=new Va(cb,Ra)}cb="userSpaceOnUse"!==O(La,"gradientUnits",!0);if(Ra){Ra=M(La,"cx","cy",!1,cb,"50%","50%");gb=Ra.add(O(La,"r",!1,!1,cb,"50%"),0);var Db=M(La,"fx","fy",!0,cb)}else Ra=M(La,"x1","y1",!1,cb,"0%","0%"),gb=M(La,"x2","y2",!1,cb,"100%","0%");Ma(new Sa(Za,Ra,gb,Db),La)._scaleToBounds=cb;return null}function Ea(La,Ra,Za,cb){if(La.transform){Ra=(cb.getAttribute(Za)||"").split(/\)\s*/g);Za=new Q;
cb=0;for(var gb=Ra.length;cb<gb;cb++){var kb=Ra[cb];if(!kb)break;var jb=kb.split(/\(\s*/);kb=jb[0];jb=jb[1].split(/[\s,]+/g);for(var Db=0,Ob=jb.length;Db<Ob;Db++)jb[Db]=parseFloat(jb[Db]);switch(kb){case "matrix":Za.append(new Q(jb[0],jb[1],jb[2],jb[3],jb[4],jb[5]));break;case "rotate":Za.rotate(jb[0],jb[1]||0,jb[2]||0);break;case "translate":Za.translate(jb[0],jb[1]||0);break;case "scale":Za.scale(jb);break;case "skewX":Za.skew(jb[0],0);break;case "skewY":Za.skew(0,jb[0])}}La.transform(Za)}}function Pa(La,
Ra,Za){Za="fill-opacity"===Za?"getFillColor":"getStrokeColor";(La=La[Za]&&La[Za]())&&La.setAlpha(parseFloat(Ra))}function Ha(La,Ra,Za){var cb=La.attributes[Ra];cb=cb&&cb.value;!cb&&La.style&&(Ra=f.camelize(Ra),(cb=La.style[Ra])||Za.node[Ra]===Za.parent[Ra]||(cb=Za.node[Ra]));return cb?"none"===cb?null:cb:b}function Ma(La,Ra,Za){var cb=Ra.parentNode,gb={node:eb.getStyles(Ra)||{},parent:!Za&&!/^defs$/i.test(cb.tagName)&&eb.getStyles(cb)||{}};f.each(Ab,function(kb,jb){var Db=Ha(Ra,jb,gb);La=Db!==b&&
kb(La,Db,jb,Ra,gb)||La});return La}function Ta(La){(La=(La=(La=La&&La.match(/\((?:["'#]*)([^"')]+)/))&&La[1])&&bb[l?La.replace(l.location.href.split("#")[0]+"#",""):La])&&La._scaleToBounds&&(La=La.clone(),La._scaleToBounds=!0);return La}function Ka(La,Ra,Za){var cb=La.nodeName.toLowerCase(),gb="#document"!==cb,kb=e.body;if(Za&&gb){hb=ib.getView().getSize();hb=R(La,null,null,!0)||hb;var jb=Fb.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"});var Db=La.parentNode;var Ob=La.nextSibling;
jb.appendChild(La);kb.appendChild(jb)}var Mb=ib.settings,ec=Mb.applyMatrix,kc=Mb.insertItems;Mb.applyMatrix=!1;Mb.insertItems=!1;var Oc=sb[cb];cb=Oc&&Oc(La,cb,Ra,Za)||null;Mb.insertItems=kc;Mb.applyMatrix=ec;cb&&(!gb||cb instanceof ea||(cb=Ma(cb,La,Za)),Mb=Ra.onImport,gb=gb&&La.getAttribute("data-paper-data"),Mb&&(cb=Mb(La,cb,Ra)||cb),Ra.expandShapes&&cb instanceof Fa&&(cb.remove(),cb=cb.toPath()),gb&&(cb._data=JSON.parse(gb)));jb&&(kb.removeChild(jb),Db&&(Ob?Db.insertBefore(La,Ob):Db.appendChild(La)));
Za&&(bb={},cb&&f.pick(Ra.applyMatrix,ec)&&cb.matrix.apply(!0,!0));return cb}function Wa(La,Ra,Za){function cb(Mb){try{var ec="object"===typeof Mb?Mb:(new a.DOMParser).parseFromString(Mb,"image/svg+xml");if(!ec.nodeName)throw Error("Unsupported SVG source: "+La);ib=kb;jb=Ka(ec,Ra,!0);Ra&&!1===Ra.insert||Za._insertItem(b,jb);var kc=Ra.onLoad;kc&&kc(jb,Mb)}catch(Oc){gb(Oc)}}function gb(Mb,ec){var kc=Ra.onError;if(kc)kc(Mb,ec);else throw Error(Mb);}if(!La)return null;Ra="function"===typeof Ra?{onLoad:Ra}:
Ra||{};var kb=ib,jb=null;if("string"!==typeof La||/^.*</.test(La)){if("undefined"!==typeof File&&La instanceof File){var Db=new FileReader;Db.onload=function(){cb(Db.result)};Db.onerror=function(){gb(Db.error)};return Db.readAsText(La)}cb(La)}else{var Ob=e.getElementById(La);Ob?cb(Ob):Xb.request({url:La,async:!0,onLoad:cb,onError:gb})}return jb}var bb={},hb,sb={"#document":function(La,Ra,Za,cb){La=La.childNodes;Ra=0;for(var gb=La.length;Ra<gb;Ra++){var kb=La[Ra];if(1===kb.nodeType)return Ka(kb,Za,
cb)}},g:ma,svg:ma,clippath:ma,polygon:wa,polyline:wa,path:function(La){return ya.create(La.getAttribute("d"))},lineargradient:Da,radialgradient:Da,image:function(La){var Ra=new pa(O(La,"href",!0));Ra.on("load",function(){var Za=R(La);this.setSize(Za);Za=M(La).add(Za.divide(2));this._matrix.append((new Q).translate(Za))});return Ra},symbol:function(La,Ra,Za,cb){return new Ca(ma(La,Ra,Za,cb),!0)},defs:ma,use:function(La){var Ra=(O(La,"href",!0)||"").substring(1);Ra=bb[Ra];La=M(La);return Ra?Ra instanceof
Ca?Ra.place(La):Ra.clone().translate(La):null},circle:function(La){return new Fa.Circle(M(La,"cx","cy"),O(La,"r"))},ellipse:function(La){return new Fa.Ellipse({center:M(La,"cx","cy"),radius:R(La,"rx","ry")})},rect:function(La){return new Fa.Rectangle(new V(M(La),R(La)),R(La,"rx","ry"))},line:function(La){return new Ia.Line(M(La,"x1","y1"),M(La,"x2","y2"))},text:function(La){var Ra=new ca(M(La).add(M(La,"dx","dy")));Ra.setContent(La.textContent.trim()||"");return Ra},switch:ma},Ab=f.set(f.each(Wb,
function(La){this[La.attribute]=function(Ra,Za){Ra[La.set]&&(Ra[La.set](W(Za,La.type,La.fromSVG)),"color"===La.type&&(Za=Ra[La.get]())&&Za._scaleToBounds&&(Ra=Ra.getBounds(),Za.transform((new Q).translate(Ra.getPoint()).scale(Ra.getSize()))))}},{}),{id:function(La,Ra){bb[Ra]=La;La.setName&&La.setName(Ra)},"clip-path":function(La,Ra){if(Ra=Ta(Ra))if(Ra=Ra.clone(),Ra.setClipMask(!0),La instanceof ea)La.insertChild(0,Ra);else return new ea(Ra,La)},gradientTransform:Ea,transform:Ea,"fill-opacity":Pa,
"stroke-opacity":Pa,visibility:function(La,Ra){La.setVisible&&La.setVisible("visible"===Ra)},display:function(La,Ra){La.setVisible&&La.setVisible(null!==Ra)},"stop-color":function(La,Ra){La.setColor&&La.setColor(Ra)},"stop-opacity":function(La,Ra){La._color&&La._color.setAlpha(parseFloat(Ra))},offset:function(La,Ra){if(La.setOffset){var Za=Ra.match(/(.*)%$/);La.setOffset(Za?Za[1]/100:parseFloat(Ra))}},viewBox:function(La,Ra,Za,cb,gb){Ra=new V(W(Ra,"array"));Za=R(cb,null,null,!0);if(La instanceof ea){var kb=
Za?Za.divide(Ra.getSize()):1;var jb=(new Q).scale(kb).translate(Ra.getPoint().negate());kb=La}else La instanceof Ca&&(Za&&Ra.setSize(Za),kb=La._item);kb&&("visible"!==Ha(cb,"overflow",gb)&&(La=new Fa.Rectangle(Ra),La.setClipMask(!0),kb.addChild(La)),jb&&kb.transform(jb))}});P.inject({importSVG:function(La,Ra){return Wa(La,Ra,this)}});qa.inject({importSVG:function(La,Ra){this.activate();return Wa(La,Ra,this)}})};var ib=new (g.inject(f.exports,{Base:f,Numerical:B,Key:Ib,DomEvent:mb,DomElement:eb,document:e,
window:l,Symbol:Ca,PlacedSymbol:ra}));ib.agent.node&&require("./node/extend.js")(ib);"function"===typeof define&&define.amd?define("paper",ib):"object"===typeof module&&module&&(module.exports=ib);return ib}.call(this,"object"===typeof self?self:null);
(function(a){"object"===typeof exports&&"undefined"!==typeof module?module.exports=a():"function"===typeof define&&define.amd?define([],a):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).jsyaml=a()})(function(){return function(){function a(b,l,e){function f(m,q){if(!l[m]){if(!b[m]){var r="function"==typeof require&&require;if(!q&&r)return r(m,!0);if(h)return h(m,!0);q=Error("Cannot find module '"+m+"'");throw q.code="MODULE_NOT_FOUND",q;
}q=l[m]={exports:{}};b[m][0].call(q.exports,function(B){return f(b[m][1][B]||B)},q,q.exports,a,b,l,e)}return l[m].exports}for(var h="function"==typeof require&&require,g=0;g<e.length;g++)f(e[g]);return f}return a}()({1:[function(a,b){function l(h){return function(){throw Error("Function "+h+" is deprecated and cannot be used.");}}var e=a("./js-yaml/loader"),f=a("./js-yaml/dumper");b.exports.Type=a("./js-yaml/type");b.exports.Schema=a("./js-yaml/schema");b.exports.FAILSAFE_SCHEMA=a("./js-yaml/schema/failsafe");
b.exports.JSON_SCHEMA=a("./js-yaml/schema/json");b.exports.CORE_SCHEMA=a("./js-yaml/schema/core");b.exports.DEFAULT_SAFE_SCHEMA=a("./js-yaml/schema/default_safe");b.exports.DEFAULT_FULL_SCHEMA=a("./js-yaml/schema/default_full");b.exports.load=e.load;b.exports.loadAll=e.loadAll;b.exports.safeLoad=e.safeLoad;b.exports.safeLoadAll=e.safeLoadAll;b.exports.dump=f.dump;b.exports.safeDump=f.safeDump;b.exports.YAMLException=a("./js-yaml/exception");b.exports.MINIMAL_SCHEMA=a("./js-yaml/schema/failsafe");
b.exports.SAFE_SCHEMA=a("./js-yaml/schema/default_safe");b.exports.DEFAULT_SCHEMA=a("./js-yaml/schema/default_full");b.exports.scan=l("scan");b.exports.parse=l("parse");b.exports.compose=l("compose");b.exports.addConstructor=l("addConstructor")},{"./js-yaml/dumper":3,"./js-yaml/exception":4,"./js-yaml/loader":5,"./js-yaml/schema":7,"./js-yaml/schema/core":8,"./js-yaml/schema/default_full":9,"./js-yaml/schema/default_safe":10,"./js-yaml/schema/failsafe":11,"./js-yaml/schema/json":12,"./js-yaml/type":13}],
2:[function(a,b){function l(e){return"undefined"===typeof e||null===e}b.exports.isNothing=l;b.exports.isObject=function(e){return"object"===typeof e&&null!==e};b.exports.toArray=function(e){return Array.isArray(e)?e:l(e)?[]:[e]};b.exports.repeat=function(e,f){var h="",g;for(g=0;g<f;g+=1)h+=e;return h};b.exports.isNegativeZero=function(e){return 0===e&&Number.NEGATIVE_INFINITY===1/e};b.exports.extend=function(e,f){var h;if(f){var g=Object.keys(f);var m=0;for(h=g.length;m<h;m+=1){var q=g[m];e[q]=f[q]}}return e}},
{}],3:[function(a,b){function l(ra){var Ca=ra.toString(16).toUpperCase();if(255>=ra){ra="x";var Ga=2}else if(65535>=ra)ra="u",Ga=4;else if(4294967295>=ra)ra="U",Ga=8;else throw new aa("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+ra+Q.repeat("0",Ga-Ca.length)+Ca}function e(ra){this.schema=ra.schema||qa;this.indent=Math.max(1,ra.indent||2);this.noArrayIndent=ra.noArrayIndent||!1;this.skipInvalid=ra.skipInvalid||!1;this.flowLevel=Q.isNothing(ra.flowLevel)?-1:ra.flowLevel;
var Ca=this.schema;var Ga=ra.styles||null,Aa,xa;if(null===Ga)Ca={};else{var za={};var Na=Object.keys(Ga);var ya=0;for(Aa=Na.length;ya<Aa;ya+=1){var Ia=Na[ya];var $a=String(Ga[Ia]);"!!"===Ia.slice(0,2)&&(Ia="tag:yaml.org,2002:"+Ia.slice(2));(xa=Ca.compiledTypeMap.fallback[Ia])&&ua.call(xa.styleAliases,$a)&&($a=xa.styleAliases[$a]);za[Ia]=$a}Ca=za}this.styleMap=Ca;this.sortKeys=ra.sortKeys||!1;this.lineWidth=ra.lineWidth||80;this.noRefs=ra.noRefs||!1;this.noCompatMode=ra.noCompatMode||!1;this.condenseFlow=
ra.condenseFlow||!1;this._flowArrLevel=Q.isNothing(ra._flowArrLevel)?-1:ra._flowArrLevel;this.implicitTypes=this.schema.compiledImplicit;this.explicitTypes=this.schema.compiledExplicit;this.tag=null;this.result="";this.duplicates=[];this.usedDuplicates=null}function f(ra,Ca){Ca=Q.repeat(" ",Ca);for(var Ga=0,Aa,xa="",za,Na=ra.length;Ga<Na;)Aa=ra.indexOf("\n",Ga),-1===Aa?(za=ra.slice(Ga),Ga=Na):(za=ra.slice(Ga,Aa+1),Ga=Aa+1),za.length&&"\n"!==za&&(xa+=Ca),xa+=za;return xa}function h(ra){return 32<=
ra&&126>=ra||161<=ra&&55295>=ra&&8232!==ra&&8233!==ra||57344<=ra&&65533>=ra&&65279!==ra||65536<=ra&&1114111>=ra}function g(ra){return h(ra)&&65279!==ra&&44!==ra&&91!==ra&&93!==ra&&123!==ra&&125!==ra&&58!==ra&&35!==ra}function m(ra,Ca,Ga,Aa,xa){var za=!1,Na=!1,ya=-1!==Aa,Ia=-1,$a=ra.charCodeAt(0);if($a=h($a)&&65279!==$a&&!(32===$a||9===$a)&&45!==$a&&63!==$a&&58!==$a&&44!==$a&&91!==$a&&93!==$a&&123!==$a&&125!==$a&&35!==$a&&38!==$a&&42!==$a&&33!==$a&&124!==$a&&62!==$a&&39!==$a&&34!==$a&&37!==$a&&64!==
$a&&96!==$a)$a=ra.charCodeAt(ra.length-1),$a=!(32===$a||9===$a);if(Ca)for(Ca=0;Ca<ra.length;Ca++){var lb=ra.charCodeAt(Ca);if(!h(lb))return 5;$a=$a&&g(lb)}else{for(Ca=0;Ca<ra.length;Ca++){lb=ra.charCodeAt(Ca);if(10===lb)za=!0,ya&&(Na=Na||Ca-Ia-1>Aa&&" "!==ra[Ia+1],Ia=Ca);else if(!h(lb))return 5;$a=$a&&g(lb)}Na=Na||ya&&Ca-Ia-1>Aa&&" "!==ra[Ia+1]}return za||Na?9<Ga&&/^\n* /.test(ra)?5:Na?4:3:$a&&!xa(ra)?1:2}function q(ra,Ca,Ga,Aa){ra.dump=function(){if(0===Ca.length)return"''";if(!ra.noCompatMode&&
-1!==pa.indexOf(Ca))return"'"+Ca+"'";var xa=ra.indent*Math.max(1,Ga),za=-1===ra.lineWidth?-1:Math.max(Math.min(ra.lineWidth,40),ra.lineWidth-xa);switch(m(Ca,Aa||-1<ra.flowLevel&&Ga>=ra.flowLevel,ra.indent,za,function(Na){a:{var ya;var Ia=0;for(ya=ra.implicitTypes.length;Ia<ya;Ia+=1){var $a=ra.implicitTypes[Ia];if($a.resolve(Na)){Na=!0;break a}}Na=!1}return Na})){case 1:return Ca;case 2:return"'"+Ca.replace(/'/g,"''")+"'";case 3:return"|"+r(Ca,ra.indent)+B(f(Ca,xa));case 4:return">"+r(Ca,ra.indent)+
B(f(D(Ca,za),xa));case 5:return'"'+G(Ca,za)+'"';default:throw new aa("impossible error: invalid scalar style");}}()}function r(ra,Ca){Ca=/^\n* /.test(ra)?String(Ca):"";var Ga="\n"===ra[ra.length-1];return Ca+(!Ga||"\n"!==ra[ra.length-2]&&"\n"!==ra?Ga?"":"-":"+")+"\n"}function B(ra){return"\n"===ra[ra.length-1]?ra.slice(0,-1):ra}function D(ra,Ca){var Ga=/(\n+)([^\n]*)/g;var Aa=ra.indexOf("\n");Aa=-1!==Aa?Aa:ra.length;Ga.lastIndex=Aa;Aa=F(ra.slice(0,Aa),Ca);for(var xa="\n"===ra[0]||" "===ra[0],za;za=
Ga.exec(ra);){var Na=za[1],ya=za[2];za=" "===ya[0];Aa+=Na+(xa||za||""===ya?"":"\n")+F(ya,Ca);xa=za}return Aa}function F(ra,Ca){if(""===ra||" "===ra[0])return ra;var Ga=/ [^ ]/g,Aa,xa=0;var za=0;for(var Na="";Aa=Ga.exec(ra);)Aa=Aa.index,Aa-xa>Ca&&(za=za>xa?za:Aa,Na+="\n"+ra.slice(xa,za),xa=za+1),za=Aa;Na+="\n";Na=ra.length-xa>Ca&&za>xa?Na+(ra.slice(xa,za)+"\n"+ra.slice(za+1)):Na+ra.slice(xa);return Na.slice(1)}function G(ra){for(var Ca="",Ga,Aa,xa=0;xa<ra.length;xa++){Ga=ra.charCodeAt(xa);if(55296<=
Ga&&56319>=Ga&&(Aa=ra.charCodeAt(xa+1),56320<=Aa&&57343>=Aa)){Ca+=l(1024*(Ga-55296)+Aa-56320+65536);xa++;continue}Aa=Fa[Ga];Ca+=!Aa&&h(Ga)?ra[xa]:Aa||l(Ga)}return Ca}function N(ra,Ca,Ga){var Aa;var xa=Ga?ra.explicitTypes:ra.implicitTypes;var za=0;for(Aa=xa.length;za<Aa;za+=1){var Na=xa[za];if((Na.instanceOf||Na.predicate)&&(!Na.instanceOf||"object"===typeof Ca&&Ca instanceof Na.instanceOf)&&(!Na.predicate||Na.predicate(Ca))){ra.tag=Ga?Na.tag:"?";if(Na.represent){Ga=ra.styleMap[Na.tag]||Na.defaultStyle;
if("[object Function]"===ea.call(Na.represent))Ca=Na.represent(Ca,Ga);else if(ua.call(Na.represent,Ga))Ca=Na.represent[Ga](Ca,Ga);else throw new aa("!<"+Na.tag+'> tag resolver accepts not "'+Ga+'" style');ra.dump=Ca}return!0}}return!1}function T(ra,Ca,Ga,Aa,xa,za){ra.tag=null;ra.dump=Ga;N(ra,Ga,!1)||N(ra,Ga,!0);var Na=ea.call(ra.dump);Aa&&=0>ra.flowLevel||ra.flowLevel>Ca;var ya="[object Object]"===Na||"[object Array]"===Na;if(ya){var Ia=ra.duplicates.indexOf(Ga);var $a=-1!==Ia}if(null!==ra.tag&&"?"!==
ra.tag||$a||2!==ra.indent&&0<Ca)xa=!1;if($a&&ra.usedDuplicates[Ia])ra.dump="*ref_"+Ia;else{ya&&$a&&!ra.usedDuplicates[Ia]&&(ra.usedDuplicates[Ia]=!0);if("[object Object]"===Na)if(Aa&&0!==Object.keys(ra.dump).length){Ga=ra.dump;Aa="";za=ra.tag;Na=Object.keys(Ga);var lb;if(!0===ra.sortKeys)Na.sort();else if("function"===typeof ra.sortKeys)Na.sort(ra.sortKeys);else if(ra.sortKeys)throw new aa("sortKeys must be a boolean or a function");ya=0;for(lb=Na.length;ya<lb;ya+=1){var xb="";xa&&0===ya||(xb+="\n"+
Q.repeat(" ",ra.indent*Ca));var Cb=Na[ya];var ca=Ga[Cb];T(ra,Ca+1,Cb,!0,!0,!0)&&((Cb=null!==ra.tag&&"?"!==ra.tag||ra.dump&&1024<ra.dump.length)&&(xb=ra.dump&&10===ra.dump.charCodeAt(0)?xb+"?":xb+"? "),xb+=ra.dump,Cb&&(xb+="\n"+Q.repeat(" ",ra.indent*Ca)),T(ra,Ca+1,ca,!0,Cb)&&(xb=ra.dump&&10===ra.dump.charCodeAt(0)?xb+":":xb+": ",xb+=ra.dump,Aa+=xb))}ra.tag=za;ra.dump=Aa||"{}";$a&&(ra.dump="&ref_"+Ia+ra.dump)}else{Ga=ra.dump;xa="";Aa=ra.tag;za=Object.keys(Ga);Na=0;for(ya=za.length;Na<ya;Na+=1)xb=ra.condenseFlow?
'"':"",0!==Na&&(xb+=", "),lb=za[Na],ca=Ga[lb],T(ra,Ca,lb,!1,!1)&&(1024<ra.dump.length&&(xb+="? "),xb+=ra.dump+(ra.condenseFlow?'"':"")+":"+(ra.condenseFlow?"":" "),T(ra,Ca,ca,!1,!1)&&(xb+=ra.dump,xa+=xb));ra.tag=Aa;ra.dump="{"+xa+"}";$a&&(ra.dump="&ref_"+Ia+" "+ra.dump)}else if("[object Array]"===Na||null!==Ga&&void 0!==Ga&&void 0!==Ga.BYTES_PER_ELEMENT)if(Ga=ra.noArrayIndent&&0<Ca?Ca-1:Ca,Aa&&ra._flowArrLevel>Ca&&0!==ra.dump.length){Ca=ra.dump;Aa="";za=ra.tag;Na=0;for(ya=Ca.length;Na<ya;Na+=1)T(ra,
Ga+1,Ca[Na],!0,!0)&&(xa&&0===Na||(Aa+="\n"+Q.repeat(" ",ra.indent*Ga)),Aa=ra.dump&&10===ra.dump.charCodeAt(0)?Aa+"-":Aa+"- ",Aa+=ra.dump);ra.tag=za;ra.dump=Aa||"[]";$a&&(ra.dump="&ref_"+Ia+ra.dump)}else{Ca=ra.dump;xa="";Aa=ra.tag;za=0;for(Na=Ca.length;za<Na;za+=1)T(ra,Ga,Ca[za],!1,!1)&&(0!==za&&(xa+=","+(ra.condenseFlow?"":" ")),xa+=ra.dump);ra.tag=Aa;ra.dump="["+xa+"]";$a&&(ra.dump="&ref_"+Ia+" "+ra.dump)}else if("[object String]"===Na)"?"!==ra.tag&&q(ra,ra.dump,Ca,za);else{if(ra.skipInvalid)return!1;
throw new aa("unacceptable kind of an object to dump "+Na);}null!==ra.tag&&"?"!==ra.tag&&(ra.dump="!<"+ra.tag+"> "+ra.dump)}return!0}function V(ra,Ca,Ga){var Aa;if(null!==ra&&"object"===typeof ra){var xa=Ca.indexOf(ra);if(-1!==xa)-1===Ga.indexOf(xa)&&Ga.push(xa);else if(Ca.push(ra),Array.isArray(ra))for(xa=0,Aa=ra.length;xa<Aa;xa+=1)V(ra[xa],Ca,Ga);else{var za=Object.keys(ra);xa=0;for(Aa=za.length;xa<Aa;xa+=1)V(ra[za[xa]],Ca,Ga)}}}function E(ra,Ca){Ca=Ca||{};Ca=new e(Ca);if(!Ca.noRefs){var Ga=[],
Aa=[],xa;V(ra,Ga,Aa);var za=0;for(xa=Aa.length;za<xa;za+=1)Ca.duplicates.push(Ga[Aa[za]]);Ca.usedDuplicates=Array(xa)}return T(Ca,0,ra,!0,!0)?Ca.dump+"\n":""}var Q=a("./common"),aa=a("./exception"),qa=a("./schema/default_full"),P=a("./schema/default_safe"),ea=Object.prototype.toString,ua=Object.prototype.hasOwnProperty,Fa={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},pa="y Y yes Yes YES on On ON n N no No NO off Off OFF".split(" ");
b.exports.dump=E;b.exports.safeDump=function(ra,Ca){return E(ra,Q.extend({schema:P},Ca))}},{"./common":2,"./exception":4,"./schema/default_full":9,"./schema/default_safe":10}],4:[function(a,b){function l(e,f){Error.call(this);this.name="YAMLException";this.reason=e;this.mark=f;this.message=(this.reason||"(unknown reason)")+(this.mark?" "+this.mark.toString():"");Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=Error().stack||""}l.prototype=Object.create(Error.prototype);
l.prototype.constructor=l;l.prototype.toString=function(e){var f=this.name+": ";f+=this.reason||"(unknown reason)";!e&&this.mark&&(f+=" "+this.mark.toString());return f};b.exports=l},{}],5:[function(a,b){function l(ca){return 10===ca||13===ca}function e(ca){return 9===ca||32===ca}function f(ca){return 9===ca||32===ca||10===ca||13===ca}function h(ca){return 44===ca||91===ca||93===ca||123===ca||125===ca}function g(ca){return 48===ca?"\x00":97===ca?"\u0007":98===ca?"\b":116===ca?"\t":9===ca?"\t":110===
ca?"\n":118===ca?"\v":102===ca?"\f":114===ca?"\r":101===ca?"\u001b":32===ca?" ":34===ca?'"':47===ca?"/":92===ca?"\\":78===ca?"\u0085":95===ca?"\u00a0":76===ca?"\u2028":80===ca?"\u2029":""}function m(ca,Sa){this.input=ca;this.filename=Sa.filename||null;this.schema=Sa.schema||Aa;this.onWarning=Sa.onWarning||null;this.legacy=Sa.legacy||!1;this.json=Sa.json||!1;this.listener=Sa.listener||null;this.implicitTypes=this.schema.compiledImplicit;this.typeMap=this.schema.compiledTypeMap;this.length=ca.length;
this.lineIndent=this.lineStart=this.line=this.position=0;this.documents=[]}function q(ca,Sa){return new ra(Sa,new Ca(ca.filename,ca.input,ca.position,ca.line,ca.position-ca.lineStart))}function r(ca,Sa){throw q(ca,Sa);}function B(ca,Sa){ca.onWarning&&ca.onWarning.call(null,q(ca,Sa))}function D(ca,Sa,Va,fb){if(Sa<Va){Sa=ca.input.slice(Sa,Va);if(fb)for(fb=0,Va=Sa.length;fb<Va;fb+=1){var Qa=Sa.charCodeAt(fb);9===Qa||32<=Qa&&1114111>=Qa||r(ca,"expected valid JSON character")}else za.test(Sa)&&r(ca,"the stream contains non-printable characters");
ca.result+=Sa}}function F(ca,Sa,Va,fb){var Qa;pa.isObject(Va)||r(ca,"cannot merge mappings; the provided source object is unacceptable");ca=Object.keys(Va);var eb=0;for(Qa=ca.length;eb<Qa;eb+=1){var mb=ca[eb];xa.call(Sa,mb)||(Sa[mb]=Va[mb],fb[mb]=!0)}}function G(ca,Sa,Va,fb,Qa,eb,mb,ub){var Bb;if(Array.isArray(Qa)){Qa=Array.prototype.slice.call(Qa);var qb=0;for(Bb=Qa.length;qb<Bb;qb+=1)Array.isArray(Qa[qb])&&r(ca,"nested arrays are not supported inside keys"),"object"===typeof Qa&&"[object Object]"===
Object.prototype.toString.call(Qa[qb])&&(Qa[qb]="[object Object]")}"object"===typeof Qa&&"[object Object]"===Object.prototype.toString.call(Qa)&&(Qa="[object Object]");Qa=String(Qa);null===Sa&&(Sa={});if("tag:yaml.org,2002:merge"===fb)if(Array.isArray(eb))for(qb=0,Bb=eb.length;qb<Bb;qb+=1)F(ca,Sa,eb[qb],Va);else F(ca,Sa,eb,Va);else ca.json||xa.call(Va,Qa)||!xa.call(Sa,Qa)||(ca.line=mb||ca.line,ca.position=ub||ca.position,r(ca,"duplicated mapping key")),Sa[Qa]=eb,delete Va[Qa];return Sa}function N(ca){var Sa=
ca.input.charCodeAt(ca.position);10===Sa?ca.position++:13===Sa?(ca.position++,10===ca.input.charCodeAt(ca.position)&&ca.position++):r(ca,"a line break is expected");ca.line+=1;ca.lineStart=ca.position}function T(ca,Sa,Va){for(var fb=0,Qa=ca.input.charCodeAt(ca.position);0!==Qa;){for(;e(Qa);)Qa=ca.input.charCodeAt(++ca.position);if(Sa&&35===Qa){do Qa=ca.input.charCodeAt(++ca.position);while(10!==Qa&&13!==Qa&&0!==Qa)}if(l(Qa))for(N(ca),Qa=ca.input.charCodeAt(ca.position),fb++,ca.lineIndent=0;32===Qa;)ca.lineIndent++,
Qa=ca.input.charCodeAt(++ca.position);else break}-1!==Va&&0!==fb&&ca.lineIndent<Va&&B(ca,"deficient indentation");return fb}function V(ca){var Sa=ca.position;var Va=ca.input.charCodeAt(Sa);return 45!==Va&&46!==Va||Va!==ca.input.charCodeAt(Sa+1)||Va!==ca.input.charCodeAt(Sa+2)||(Va=ca.input.charCodeAt(Sa+3),0!==Va&&!f(Va))?!1:!0}function E(ca,Sa){1===Sa?ca.result+=" ":1<Sa&&(ca.result+=pa.repeat("\n",Sa-1))}function Q(ca,Sa){var Va=ca.tag,fb=ca.anchor,Qa=[],eb=!1,mb;null!==ca.anchor&&(ca.anchorMap[ca.anchor]=
Qa);for(mb=ca.input.charCodeAt(ca.position);0!==mb&&45===mb;){var ub=ca.input.charCodeAt(ca.position+1);if(!f(ub))break;eb=!0;ca.position++;if(T(ca,!0,-1)&&ca.lineIndent<=Sa)Qa.push(null),mb=ca.input.charCodeAt(ca.position);else if(ub=ca.line,P(ca,Sa,3,!1,!0),Qa.push(ca.result),T(ca,!0,-1),mb=ca.input.charCodeAt(ca.position),(ca.line===ub||ca.lineIndent>Sa)&&0!==mb)r(ca,"bad indentation of a sequence entry");else if(ca.lineIndent<Sa)break}return eb?(ca.tag=Va,ca.anchor=fb,ca.kind="sequence",ca.result=
Qa,!0):!1}function aa(ca){var Sa=!1,Va=!1;var fb=ca.input.charCodeAt(ca.position);if(33!==fb)return!1;null!==ca.tag&&r(ca,"duplication of a tag property");fb=ca.input.charCodeAt(++ca.position);if(60===fb)Sa=!0,fb=ca.input.charCodeAt(++ca.position);else if(33===fb){Va=!0;var Qa="!!";fb=ca.input.charCodeAt(++ca.position)}else Qa="!";var eb=ca.position;if(Sa){do fb=ca.input.charCodeAt(++ca.position);while(0!==fb&&62!==fb);if(ca.position<ca.length){var mb=ca.input.slice(eb,ca.position);ca.input.charCodeAt(++ca.position)}else r(ca,
"unexpected end of the stream within a verbatim tag")}else{for(;0!==fb&&!f(fb);)33===fb&&(Va?r(ca,"tag suffix cannot contain exclamation marks"):(Qa=ca.input.slice(eb-1,ca.position+1),Ia.test(Qa)||r(ca,"named tag handle cannot contain such characters"),Va=!0,eb=ca.position+1)),fb=ca.input.charCodeAt(++ca.position);mb=ca.input.slice(eb,ca.position);ya.test(mb)&&r(ca,"tag suffix cannot contain flow indicator characters")}mb&&!$a.test(mb)&&r(ca,"tag name cannot contain such characters: "+mb);Sa?ca.tag=
mb:xa.call(ca.tagMap,Qa)?ca.tag=ca.tagMap[Qa]+mb:"!"===Qa?ca.tag="!"+mb:"!!"===Qa?ca.tag="tag:yaml.org,2002:"+mb:r(ca,'undeclared tag handle "'+Qa+'"');return!0}function qa(ca){var Sa;var Va=ca.input.charCodeAt(ca.position);if(38!==Va)return!1;null!==ca.anchor&&r(ca,"duplication of an anchor property");Va=ca.input.charCodeAt(++ca.position);for(Sa=ca.position;0!==Va&&!f(Va)&&!h(Va);)Va=ca.input.charCodeAt(++ca.position);ca.position===Sa&&r(ca,"name of an anchor node must contain at least one character");
ca.anchor=ca.input.slice(Sa,ca.position);return!0}function P(ca,Sa,Va,fb,Qa){var eb,mb,ub=1,Bb=!1,qb=!1;null!==ca.listener&&ca.listener("open",ca);ca.tag=null;ca.anchor=null;ca.kind=null;ca.result=null;var yb=eb=mb=4===Va||3===Va;fb&&T(ca,!0,-1)&&(Bb=!0,ca.lineIndent>Sa?ub=1:ca.lineIndent===Sa?ub=0:ca.lineIndent<Sa&&(ub=-1));if(1===ub)for(;aa(ca)||qa(ca);)T(ca,!0,-1)?(Bb=!0,mb=yb,ca.lineIndent>Sa?ub=1:ca.lineIndent===Sa?ub=0:ca.lineIndent<Sa&&(ub=-1)):mb=!1;mb&&=Bb||Qa;if(1===ub||4===Va)if(Sa=1===
Va||2===Va?Sa:Sa+1,fb=ca.position-ca.lineStart,1===ub){if(mb&&!(mb=Q(ca,fb)))a:{yb=ca.tag;Bb=ca.anchor;var Ib={},Pb={},Eb=null,z=null,Xb=null,Nb=!1,Rb=!1,Fb;null!==ca.anchor&&(ca.anchorMap[ca.anchor]=Ib);for(Fb=ca.input.charCodeAt(ca.position);0!==Fb;){mb=ca.input.charCodeAt(ca.position+1);ub=ca.line;Qa=ca.position;if(63!==Fb&&58!==Fb||!f(mb))if(P(ca,Sa,2,!1,!0))if(ca.line===ub){for(Fb=ca.input.charCodeAt(ca.position);e(Fb);)Fb=ca.input.charCodeAt(++ca.position);if(58===Fb){Fb=ca.input.charCodeAt(++ca.position);
f(Fb)||r(ca,"a whitespace character is expected after the key-value separator within a block mapping");Nb&&(G(ca,Ib,Pb,Eb,z,null),Xb=null);Rb=!0;var Wb=Nb=!1;Eb=ca.tag;z=ca.result}else if(Rb)r(ca,"can not read an implicit mapping pair; a colon is missed");else{ca.tag=yb;ca.anchor=Bb;mb=!0;break a}}else if(Rb)r(ca,"can not read a block mapping entry; a multiline key may not be an implicit key");else{ca.tag=yb;ca.anchor=Bb;mb=!0;break a}else break;else 63===Fb?(Nb&&(G(ca,Ib,Pb,Eb,z,null),Eb=z=Xb=null),
Wb=Nb=Rb=!0):Nb?(Nb=!1,Wb=!0):r(ca,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),ca.position+=1,Fb=mb;if(ca.line===ub||ca.lineIndent>fb)P(ca,fb,4,!0,Wb)&&(Nb?z=ca.result:Xb=ca.result),Nb||(G(ca,Ib,Pb,Eb,z,Xb,ub,Qa),Eb=z=Xb=null),T(ca,!0,-1),Fb=ca.input.charCodeAt(ca.position);if(ca.lineIndent>fb&&0!==Fb)r(ca,"bad indentation of a mapping entry");else if(ca.lineIndent<fb)break}Nb&&G(ca,Ib,Pb,Eb,z,null);Rb&&(ca.tag=yb,ca.anchor=Bb,ca.kind="mapping",
ca.result=Ib);mb=Rb}if(!(Wb=mb))a:{Bb=!0;Wb=ca.tag;mb=ca.anchor;yb={};Eb=ca.input.charCodeAt(ca.position);if(91===Eb)ub=93,Qa=!1,fb=[];else if(123===Eb)ub=125,Qa=!0,fb={};else{Wb=!1;break a}null!==ca.anchor&&(ca.anchorMap[ca.anchor]=fb);for(Eb=ca.input.charCodeAt(++ca.position);0!==Eb;){T(ca,!0,Sa);Eb=ca.input.charCodeAt(ca.position);if(Eb===ub){ca.position++;ca.tag=Wb;ca.anchor=mb;ca.kind=Qa?"mapping":"sequence";ca.result=fb;Wb=!0;break a}else Bb||r(ca,"missed comma between flow collection entries");
Pb=null;Bb=Ib=!1;63===Eb&&(Eb=ca.input.charCodeAt(ca.position+1),f(Eb)&&(Bb=Ib=!0,ca.position++,T(ca,!0,Sa)));z=ca.line;P(ca,Sa,1,!1,!0);Nb=ca.tag;Xb=ca.result;T(ca,!0,Sa);Eb=ca.input.charCodeAt(ca.position);!Ib&&ca.line!==z||58!==Eb||(Bb=!0,ca.input.charCodeAt(++ca.position),T(ca,!0,Sa),P(ca,Sa,1,!1,!0),Pb=ca.result);Qa?G(ca,fb,yb,Nb,Xb,Pb):Bb?fb.push(G(ca,null,yb,Nb,Xb,Pb)):fb.push(Xb);T(ca,!0,Sa);Eb=ca.input.charCodeAt(ca.position);44===Eb?(Bb=!0,Eb=ca.input.charCodeAt(++ca.position)):Bb=!1}r(ca,
"unexpected end of the stream within a flow collection");Wb=void 0}if(Wb)qb=!0;else{if(eb)a:{Wb=1;mb=fb=!1;ub=Sa;Qa=0;yb=!1;Bb=ca.input.charCodeAt(ca.position);if(124===Bb)eb=!1;else if(62===Bb)eb=!0;else{eb=!1;break a}ca.kind="scalar";for(ca.result="";0!==Bb;)if(Bb=ca.input.charCodeAt(++ca.position),43===Bb||45===Bb)1===Wb?Wb=43===Bb?3:2:r(ca,"repeat of a chomping mode identifier");else if(0<=(Ib=48<=Bb&&57>=Bb?Bb-48:-1))0===Ib?r(ca,"bad explicit indentation width of a block scalar; it cannot be less than one"):
mb?r(ca,"repeat of an indentation width identifier"):(ub=Sa+Ib-1,mb=!0);else break;if(e(Bb)){do Bb=ca.input.charCodeAt(++ca.position);while(e(Bb));if(35===Bb){do Bb=ca.input.charCodeAt(++ca.position);while(!l(Bb)&&0!==Bb)}}for(;0!==Bb;){N(ca);ca.lineIndent=0;for(Bb=ca.input.charCodeAt(ca.position);(!mb||ca.lineIndent<ub)&&32===Bb;)ca.lineIndent++,Bb=ca.input.charCodeAt(++ca.position);!mb&&ca.lineIndent>ub&&(ub=ca.lineIndent);if(l(Bb))Qa++;else{if(ca.lineIndent<ub){3===Wb?ca.result+=pa.repeat("\n",
fb?1+Qa:Qa):1===Wb&&fb&&(ca.result+="\n");break}eb?e(Bb)?(yb=!0,ca.result+=pa.repeat("\n",fb?1+Qa:Qa)):yb?(yb=!1,ca.result+=pa.repeat("\n",Qa+1)):0===Qa?fb&&(ca.result+=" "):ca.result+=pa.repeat("\n",Qa):ca.result+=pa.repeat("\n",fb?1+Qa:Qa);mb=fb=!0;Qa=0;for(Ib=ca.position;!l(Bb)&&0!==Bb;)Bb=ca.input.charCodeAt(++ca.position);D(ca,Ib,ca.position,!1)}}eb=!0}if(!eb)a:if(eb=ca.input.charCodeAt(ca.position),39!==eb)eb=!1;else{ca.kind="scalar";ca.result="";ca.position++;for(Wb=fb=ca.position;0!==(eb=
ca.input.charCodeAt(ca.position));)if(39===eb)if(D(ca,Wb,ca.position,!0),eb=ca.input.charCodeAt(++ca.position),39===eb)Wb=ca.position,ca.position++,fb=ca.position;else{eb=!0;break a}else l(eb)?(D(ca,Wb,fb,!0),E(ca,T(ca,!1,Sa)),Wb=fb=ca.position):ca.position===ca.lineStart&&V(ca)?r(ca,"unexpected end of the document within a single quoted scalar"):(ca.position++,fb=ca.position);r(ca,"unexpected end of the stream within a single quoted scalar");eb=void 0}if(!eb)a:if(mb=ca.input.charCodeAt(ca.position),
34!==mb)eb=!1;else{ca.kind="scalar";ca.result="";ca.position++;for(eb=Wb=ca.position;0!==(mb=ca.input.charCodeAt(ca.position));)if(34===mb){D(ca,eb,ca.position,!0);ca.position++;eb=!0;break a}else if(92===mb){D(ca,eb,ca.position,!0);mb=ca.input.charCodeAt(++ca.position);if(l(mb))T(ca,!1,Sa);else if(256>mb&&lb[mb])ca.result+=xb[mb],ca.position++;else if(0<(fb=120===mb?2:117===mb?4:85===mb?8:0)){Wb=fb;for(eb=0;0<Wb;Wb--)mb=ca.input.charCodeAt(++ca.position),48<=mb&&57>=mb?mb-=48:(mb|=32,mb=97<=mb&&
102>=mb?mb-97+10:-1),0<=(fb=mb)?eb=(eb<<4)+fb:r(ca,"expected hexadecimal character");Wb=ca.result;eb=65535>=eb?String.fromCharCode(eb):String.fromCharCode((eb-65536>>10)+55296,(eb-65536&1023)+56320);ca.result=Wb+eb;ca.position++}else r(ca,"unknown escape sequence");eb=Wb=ca.position}else l(mb)?(D(ca,eb,Wb,!0),E(ca,T(ca,!1,Sa)),eb=Wb=ca.position):ca.position===ca.lineStart&&V(ca)?r(ca,"unexpected end of the document within a double quoted scalar"):(ca.position++,Wb=ca.position);r(ca,"unexpected end of the stream within a double quoted scalar");
eb=void 0}if(eb)qb=!0;else{Wb=ca.input.charCodeAt(ca.position);if(42!==Wb)eb=!1;else{Wb=ca.input.charCodeAt(++ca.position);for(eb=ca.position;0!==Wb&&!f(Wb)&&!h(Wb);)Wb=ca.input.charCodeAt(++ca.position);ca.position===eb&&r(ca,"name of an alias node must contain at least one character");eb=ca.input.slice(eb,ca.position);ca.anchorMap.hasOwnProperty(eb)||r(ca,'unidentified alias "'+eb+'"');ca.result=ca.anchorMap[eb];T(ca,!0,-1);eb=!0}if(eb)qb=!0,null===ca.tag&&null===ca.anchor||r(ca,"alias node should not have any properties");
else{a:if(Va=1===Va,fb=ca.kind,mb=ca.result,Qa=ca.input.charCodeAt(ca.position),f(Qa)||h(Qa)||35===Qa||38===Qa||42===Qa||33===Qa||124===Qa||62===Qa||39===Qa||34===Qa||37===Qa||64===Qa||96===Qa)var ib=!1;else{if(63===Qa||45===Qa)if(yb=ca.input.charCodeAt(ca.position+1),f(yb)||Va&&h(yb)){ib=!1;break a}ca.kind="scalar";ca.result="";eb=Wb=ca.position;for(ub=!1;0!==Qa;){if(58===Qa){if(yb=ca.input.charCodeAt(ca.position+1),f(yb)||Va&&h(yb))break}else if(35===Qa){if(yb=ca.input.charCodeAt(ca.position-1),
f(yb))break}else if(ca.position===ca.lineStart&&V(ca)||Va&&h(Qa))break;else if(l(Qa))if(ib=ca.line,ub=ca.lineStart,Qa=ca.lineIndent,T(ca,!1,-1),ca.lineIndent>=Sa){ub=!0;Qa=ca.input.charCodeAt(ca.position);continue}else{ca.position=Wb;ca.line=ib;ca.lineStart=ub;ca.lineIndent=Qa;break}ub&&(D(ca,eb,Wb,!1),E(ca,ca.line-ib),eb=Wb=ca.position,ub=!1);e(Qa)||(Wb=ca.position+1);Qa=ca.input.charCodeAt(++ca.position)}D(ca,eb,Wb,!1);ca.result?ib=!0:(ca.kind=fb,ca.result=mb,ib=!1)}ib&&(qb=!0,null===ca.tag&&(ca.tag=
"?"))}}null!==ca.anchor&&(ca.anchorMap[ca.anchor]=ca.result)}}else 0===ub&&(qb=mb&&Q(ca,fb));if(null!==ca.tag&&"!"!==ca.tag)if("?"===ca.tag)for(ib=0,Sa=ca.implicitTypes.length;ib<Sa;ib+=1){if(Va=ca.implicitTypes[ib],Va.resolve(ca.result)){ca.result=Va.construct(ca.result);ca.tag=Va.tag;null!==ca.anchor&&(ca.anchorMap[ca.anchor]=ca.result);break}}else xa.call(ca.typeMap[ca.kind||"fallback"],ca.tag)?(Va=ca.typeMap[ca.kind||"fallback"][ca.tag],null!==ca.result&&Va.kind!==ca.kind&&r(ca,"unacceptable node kind for !<"+
ca.tag+'> tag; it should be "'+Va.kind+'", not "'+ca.kind+'"'),Va.resolve(ca.result)?(ca.result=Va.construct(ca.result),null!==ca.anchor&&(ca.anchorMap[ca.anchor]=ca.result)):r(ca,"cannot resolve a node with !<"+ca.tag+"> explicit tag")):r(ca,"unknown tag !<"+ca.tag+">");null!==ca.listener&&ca.listener("close",ca);return null!==ca.tag||null!==ca.anchor||qb}function ea(ca,Sa){ca=String(ca);Sa=Sa||{};0!==ca.length&&(10!==ca.charCodeAt(ca.length-1)&&13!==ca.charCodeAt(ca.length-1)&&(ca+="\n"),65279===
ca.charCodeAt(0)&&(ca=ca.slice(1)));ca=new m(ca,Sa);for(ca.input+="\x00";32===ca.input.charCodeAt(ca.position);)ca.lineIndent+=1,ca.position+=1;for(;ca.position<ca.length-1;){var Va,fb=ca,Qa=fb.position,eb=!1;fb.version=null;fb.checkLineBreaks=fb.legacy;fb.tagMap={};for(fb.anchorMap={};0!==fb.input.charCodeAt(fb.position);){T(fb,!0,-1);Sa=fb.input.charCodeAt(fb.position);if(0<fb.lineIndent||37!==Sa)break;eb=!0;Sa=fb.input.charCodeAt(++fb.position);for(Va=fb.position;0!==Sa&&!f(Sa);)Sa=fb.input.charCodeAt(++fb.position);
var mb=fb.input.slice(Va,fb.position);var ub=[];for(1>mb.length&&r(fb,"directive name must not be less than one character in length");0!==Sa;){for(;e(Sa);)Sa=fb.input.charCodeAt(++fb.position);if(35===Sa){do Sa=fb.input.charCodeAt(++fb.position);while(0!==Sa&&!l(Sa));break}if(l(Sa))break;for(Va=fb.position;0!==Sa&&!f(Sa);)Sa=fb.input.charCodeAt(++fb.position);ub.push(fb.input.slice(Va,fb.position))}0!==Sa&&N(fb);if(xa.call(Cb,mb))Cb[mb](fb,mb,ub);else B(fb,'unknown document directive "'+mb+'"')}T(fb,
!0,-1);0===fb.lineIndent&&45===fb.input.charCodeAt(fb.position)&&45===fb.input.charCodeAt(fb.position+1)&&45===fb.input.charCodeAt(fb.position+2)?(fb.position+=3,T(fb,!0,-1)):eb&&r(fb,"directives end mark is expected");P(fb,fb.lineIndent-1,4,!1,!0);T(fb,!0,-1);fb.checkLineBreaks&&Na.test(fb.input.slice(Qa,fb.position))&&B(fb,"non-ASCII line breaks are interpreted as content");fb.documents.push(fb.result);fb.position===fb.lineStart&&V(fb)?46===fb.input.charCodeAt(fb.position)&&(fb.position+=3,T(fb,
!0,-1)):fb.position<fb.length-1&&r(fb,"end of the stream or a document separator is expected")}return ca.documents}function ua(ca,Sa,Va){ca=ea(ca,Va);var fb;if("function"!==typeof Sa)return ca;Va=0;for(fb=ca.length;Va<fb;Va+=1)Sa(ca[Va])}function Fa(ca,Sa){ca=ea(ca,Sa);if(0!==ca.length){if(1===ca.length)return ca[0];throw new ra("expected a single document in the stream, but found more");}}var pa=a("./common"),ra=a("./exception"),Ca=a("./mark"),Ga=a("./schema/default_safe"),Aa=a("./schema/default_full"),
xa=Object.prototype.hasOwnProperty,za=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Na=/[\x85\u2028\u2029]/,ya=/[,\[\]\{\}]/,Ia=/^(?:!|!!|![a-z\-]+!)$/i,$a=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i,lb=Array(256),xb=Array(256);for(a=0;256>a;a++)lb[a]=g(a)?1:0,xb[a]=g(a);var Cb={YAML:function(ca,Sa,Va){null!==ca.version&&r(ca,"duplication of %YAML directive");1!==Va.length&&
r(ca,"YAML directive accepts exactly one argument");var fb=/^([0-9]+)\.([0-9]+)$/.exec(Va[0]);null===fb&&r(ca,"ill-formed argument of the YAML directive");Sa=parseInt(fb[1],10);fb=parseInt(fb[2],10);1!==Sa&&r(ca,"unacceptable YAML version of the document");ca.version=Va[0];ca.checkLineBreaks=2>fb;1!==fb&&2!==fb&&B(ca,"unsupported YAML version of the document")},TAG:function(ca,Sa,Va){2!==Va.length&&r(ca,"TAG directive accepts exactly two arguments");Sa=Va[0];Va=Va[1];Ia.test(Sa)||r(ca,"ill-formed tag handle (first argument) of the TAG directive");
xa.call(ca.tagMap,Sa)&&r(ca,'there is a previously declared suffix for "'+Sa+'" tag handle');$a.test(Va)||r(ca,"ill-formed tag prefix (second argument) of the TAG directive");ca.tagMap[Sa]=Va}};b.exports.loadAll=ua;b.exports.load=Fa;b.exports.safeLoadAll=function(ca,Sa,Va){if("function"===typeof Sa)ua(ca,Sa,pa.extend({schema:Ga},Va));else return ua(ca,pa.extend({schema:Ga},Va))};b.exports.safeLoad=function(ca,Sa){return Fa(ca,pa.extend({schema:Ga},Sa))}},{"./common":2,"./exception":4,"./mark":6,"./schema/default_full":9,
"./schema/default_safe":10}],6:[function(a,b){function l(f,h,g,m,q){this.name=f;this.buffer=h;this.position=g;this.line=m;this.column=q}var e=a("./common");l.prototype.getSnippet=function(f,h){var g,m;if(!this.buffer)return null;f=f||4;h=h||75;var q="";for(g=this.position;0<g&&-1==="\x00\r\n\u0085\u2028\u2029".indexOf(this.buffer.charAt(g-1));)if(--g,this.position-g>h/2-1){q=" ... ";g+=5;break}var r="";for(m=this.position;m<this.buffer.length&&-1==="\x00\r\n\u0085\u2028\u2029".indexOf(this.buffer.charAt(m));)if(m+=
1,m-this.position>h/2-1){r=" ... ";m-=5;break}h=this.buffer.slice(g,m);return e.repeat(" ",f)+q+h+r+"\n"+e.repeat(" ",f+this.position-g+q.length)+"^"};l.prototype.toString=function(f){var h="";this.name&&(h+='in "'+this.name+'" ');h+="at line "+(this.line+1)+", column "+(this.column+1);f||(f=this.getSnippet())&&(h+=":\n"+f);return h};b.exports=l},{"./common":2}],7:[function(a,b){function l(q,r,B){var D=[];q.include.forEach(function(F){B=l(F,r,B)});q[r].forEach(function(F){B.forEach(function(G,N){G.tag===
F.tag&&G.kind===F.kind&&D.push(N)});B.push(F)});return B.filter(function(F,G){return-1===D.indexOf(G)})}function e(){function q(F){r[F.kind][F.tag]=r.fallback[F.tag]=F}var r={scalar:{},sequence:{},mapping:{},fallback:{}},B;var D=0;for(B=arguments.length;D<B;D+=1)arguments[D].forEach(q);return r}function f(q){this.include=q.include||[];this.implicit=q.implicit||[];this.explicit=q.explicit||[];this.implicit.forEach(function(r){if(r.loadKind&&"scalar"!==r.loadKind)throw new g("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");
});this.compiledImplicit=l(this,"implicit",[]);this.compiledExplicit=l(this,"explicit",[]);this.compiledTypeMap=e(this.compiledImplicit,this.compiledExplicit)}var h=a("./common"),g=a("./exception"),m=a("./type");f.DEFAULT=null;f.create=function(){switch(arguments.length){case 1:var q=f.DEFAULT;var r=arguments[0];break;case 2:q=arguments[0];r=arguments[1];break;default:throw new g("Wrong number of arguments for Schema.create function");}q=h.toArray(q);r=h.toArray(r);if(!q.every(function(B){return B instanceof
f}))throw new g("Specified list of super schemas (or a single Schema object) contains a non-Schema object.");if(!r.every(function(B){return B instanceof m}))throw new g("Specified list of YAML types (or a single Type object) contains a non-Type object.");return new f({include:q,explicit:r})};b.exports=f},{"./common":2,"./exception":4,"./type":13}],8:[function(a,b){var l=a("../schema");b.exports=new l({include:[a("./json")]})},{"../schema":7,"./json":12}],9:[function(a,b){var l=a("../schema");b.exports=
l.DEFAULT=new l({include:[a("./default_safe")],explicit:[a("../type/js/undefined"),a("../type/js/regexp"),a("../type/js/function")]})},{"../schema":7,"../type/js/function":18,"../type/js/regexp":19,"../type/js/undefined":20,"./default_safe":10}],10:[function(a,b){var l=a("../schema");b.exports=new l({include:[a("./core")],implicit:[a("../type/timestamp"),a("../type/merge")],explicit:[a("../type/binary"),a("../type/omap"),a("../type/pairs"),a("../type/set")]})},{"../schema":7,"../type/binary":14,"../type/merge":22,
"../type/omap":24,"../type/pairs":25,"../type/set":27,"../type/timestamp":29,"./core":8}],11:[function(a,b){var l=a("../schema");b.exports=new l({explicit:[a("../type/str"),a("../type/seq"),a("../type/map")]})},{"../schema":7,"../type/map":21,"../type/seq":26,"../type/str":28}],12:[function(a,b){var l=a("../schema");b.exports=new l({include:[a("./failsafe")],implicit:[a("../type/null"),a("../type/bool"),a("../type/int"),a("../type/float")]})},{"../schema":7,"../type/bool":15,"../type/float":16,"../type/int":17,
"../type/null":23,"./failsafe":11}],13:[function(a,b){function l(g){var m={};null!==g&&Object.keys(g).forEach(function(q){g[q].forEach(function(r){m[String(r)]=q})});return m}var e=a("./exception"),f="kind resolve construct instanceOf predicate represent defaultStyle styleAliases".split(" "),h=["scalar","sequence","mapping"];b.exports=function(g,m){m=m||{};Object.keys(m).forEach(function(q){if(-1===f.indexOf(q))throw new e('Unknown option "'+q+'" is met in definition of "'+g+'" YAML type.');});this.tag=
g;this.kind=m.kind||null;this.resolve=m.resolve||function(){return!0};this.construct=m.construct||function(q){return q};this.instanceOf=m.instanceOf||null;this.predicate=m.predicate||null;this.represent=m.represent||null;this.defaultStyle=m.defaultStyle||null;this.styleAliases=l(m.styleAliases||null);if(-1===h.indexOf(this.kind))throw new e('Unknown kind "'+this.kind+'" is specified for "'+g+'" YAML type.');}},{"./exception":4}],14:[function(a,b){a=a("../type");b.exports=new a("tag:yaml.org,2002:binary",
{kind:"scalar",resolve:function(l){if(null===l)return!1;var e,f=0,h=l.length;for(e=0;e<h;e++){var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r".indexOf(l.charAt(e));if(!(64<g)){if(0>g)return!1;f+=6}}return 0===f%8},construct:function(l){var e,f=l.replace(/[\r\n=]/g,""),h=f.length;l=0;var g=[];for(e=0;e<h;e++)0===e%4&&e&&(g.push(l>>16&255),g.push(l>>8&255),g.push(l&255)),l=l<<6|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r".indexOf(f.charAt(e));
e=h%4*6;0===e?(g.push(l>>16&255),g.push(l>>8&255),g.push(l&255)):18===e?(g.push(l>>10&255),g.push(l>>2&255)):12===e&&g.push(l>>4&255);return g},predicate:function(){},represent:function(l){var e="",f=0,h,g=l.length;for(h=0;h<g;h++)0===h%3&&h&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[f>>18&63],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[f>>12&63],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[f>>6&63],e+=
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[f&63]),f=(f<<8)+l[h];l=g%3;0===l?(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[f>>18&63],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[f>>12&63],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[f>>6&63],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[f&63]):2===l?(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[f>>
10&63],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[f>>4&63],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[f<<2&63],e+="="):1===l&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[f>>2&63],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[f<<4&63],e+="==");return e}})},{"../type":13}],15:[function(a,b){a=a("../type");b.exports=new a("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(l){if(null===
l)return!1;var e=l.length;return 4===e&&("true"===l||"True"===l||"TRUE"===l)||5===e&&("false"===l||"False"===l||"FALSE"===l)},construct:function(l){return"true"===l||"True"===l||"TRUE"===l},predicate:function(l){return"[object Boolean]"===Object.prototype.toString.call(l)},represent:{lowercase:function(l){return l?"true":"false"},uppercase:function(l){return l?"TRUE":"FALSE"},camelcase:function(l){return l?"True":"False"}},defaultStyle:"lowercase"})},{"../type":13}],16:[function(a,b){var l=a("../common");
a=a("../type");var e=RegExp("^(?:[-+]?(?:0|[1-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),f=/^[-+]?[0-9]+e/;b.exports=new a("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(h){return null!==h&&e.test(h)&&"_"!==h[h.length-1]?!0:!1},construct:function(h){var g=h.replace(/_/g,"").toLowerCase();h="-"===g[0]?-1:1;var m=[];0<="+-".indexOf(g[0])&&(g=g.slice(1));if(".inf"===
g)return 1===h?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;if(".nan"===g)return NaN;if(0<=g.indexOf(":")){g.split(":").forEach(function(r){m.unshift(parseFloat(r,10))});g=0;var q=1;m.forEach(function(r){g+=r*q;q*=60});return h*g}return h*parseFloat(g,10)},predicate:function(h){return"[object Number]"===Object.prototype.toString.call(h)&&(0!==h%1||l.isNegativeZero(h))},represent:function(h,g){if(isNaN(h))switch(g){case "lowercase":return".nan";case "uppercase":return".NAN";case "camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===
h)switch(g){case "lowercase":return".inf";case "uppercase":return".INF";case "camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===h)switch(g){case "lowercase":return"-.inf";case "uppercase":return"-.INF";case "camelcase":return"-.Inf"}else if(l.isNegativeZero(h))return"-0.0";h=h.toString(10);return f.test(h)?h.replace("e",".e"):h},defaultStyle:"lowercase"})},{"../common":2,"../type":13}],17:[function(a,b){var l=a("../common");a=a("../type");b.exports=new a("tag:yaml.org,2002:int",{kind:"scalar",
resolve:function(e){if(null===e)return!1;var f=e.length,h=0,g=!1;if(!f)return!1;var m=e[h];if("-"===m||"+"===m)m=e[++h];if("0"===m){if(h+1===f)return!0;m=e[++h];if("b"===m){for(h++;h<f;h++)if(m=e[h],"_"!==m){if("0"!==m&&"1"!==m)return!1;g=!0}return g&&"_"!==m}if("x"===m){for(h++;h<f;h++)if(m=e[h],"_"!==m){g=e.charCodeAt(h);if(!(48<=g&&57>=g||65<=g&&70>=g||97<=g&&102>=g))return!1;g=!0}return g&&"_"!==m}for(;h<f;h++)if(m=e[h],"_"!==m){g=e.charCodeAt(h);if(!(48<=g&&55>=g))return!1;g=!0}return g&&"_"!==
m}if("_"===m)return!1;for(;h<f;h++)if(m=e[h],"_"!==m){if(":"===m)break;g=e.charCodeAt(h);if(!(48<=g&&57>=g))return!1;g=!0}return g&&"_"!==m?":"!==m?!0:/^(:[0-5]?[0-9])+$/.test(e.slice(h)):!1},construct:function(e){var f=e;e=1;var h=[];-1!==f.indexOf("_")&&(f=f.replace(/_/g,""));var g=f[0];if("-"===g||"+"===g)"-"===g&&(e=-1),f=f.slice(1),g=f[0];if("0"===f)return 0;if("0"===g)return"b"===f[1]?e*parseInt(f.slice(2),2):"x"===f[1]?e*parseInt(f,16):e*parseInt(f,8);if(-1!==f.indexOf(":")){f.split(":").forEach(function(q){h.unshift(parseInt(q,
10))});f=0;var m=1;h.forEach(function(q){f+=q*m;m*=60});return e*f}return e*parseInt(f,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&0===e%1&&!l.isNegativeZero(e)},represent:{binary:function(e){return 0<=e?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return 0<=e?"0"+e.toString(8):"-0"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return 0<=e?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},
defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}})},{"../common":2,"../type":13}],18:[function(a,b){a=a("../../type");b.exports=new a("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:function(l){if(null===l)return!1;try{var e=(void 0).parse("("+l+")",{range:!0});return"Program"!==e.type||1!==e.body.length||"ExpressionStatement"!==e.body[0].type||"ArrowFunctionExpression"!==e.body[0].expression.type&&"FunctionExpression"!==e.body[0].expression.type?
!1:!0}catch(f){return!1}},construct:function(l){l="("+l+")";var e=(void 0).parse(l,{range:!0}),f=[];if("Program"!==e.type||1!==e.body.length||"ExpressionStatement"!==e.body[0].type||"ArrowFunctionExpression"!==e.body[0].expression.type&&"FunctionExpression"!==e.body[0].expression.type)throw Error("Failed to resolve function");e.body[0].expression.params.forEach(function(g){f.push(g.name)});var h=e.body[0].expression.body.range;return"BlockStatement"===e.body[0].expression.body.type?new Function(f,
l.slice(h[0]+1,h[1]-1)):new Function(f,"return "+l.slice(h[0],h[1]))},predicate:function(l){return"[object Function]"===Object.prototype.toString.call(l)},represent:function(l){return l.toString()}})},{"../../type":13}],19:[function(a,b){a=a("../../type");b.exports=new a("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:function(l){if(null===l||0===l.length)return!1;var e=/\/([gim]*)$/.exec(l),f="";return"/"===l[0]&&(e&&(f=e[1]),3<f.length||"/"!==l[l.length-f.length-1])?!1:!0},construct:function(l){var e=
l;l=/\/([gim]*)$/.exec(l);var f="";"/"===e[0]&&(l&&(f=l[1]),e=e.slice(1,e.length-f.length-1));return new RegExp(e,f)},predicate:function(l){return"[object RegExp]"===Object.prototype.toString.call(l)},represent:function(l){var e="/"+l.source+"/";l.global&&(e+="g");l.multiline&&(e+="m");l.ignoreCase&&(e+="i");return e}})},{"../../type":13}],20:[function(a,b){a=a("../../type");b.exports=new a("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:function(){return!0},construct:function(){},predicate:function(l){return"undefined"===
typeof l},represent:function(){return""}})},{"../../type":13}],21:[function(a,b){a=a("../type");b.exports=new a("tag:yaml.org,2002:map",{kind:"mapping",construct:function(l){return null!==l?l:{}}})},{"../type":13}],22:[function(a,b){a=a("../type");b.exports=new a("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(l){return"<<"===l||null===l}})},{"../type":13}],23:[function(a,b){a=a("../type");b.exports=new a("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(l){if(null===l)return!0;var e=
l.length;return 1===e&&"~"===l||4===e&&("null"===l||"Null"===l||"NULL"===l)},construct:function(){return null},predicate:function(l){return null===l},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"})},{"../type":13}],24:[function(a,b){a=a("../type");var l=Object.prototype.hasOwnProperty,e=Object.prototype.toString;b.exports=new a("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(f){if(null===
f)return!0;var h=[],g,m;var q=0;for(g=f.length;q<g;q+=1){var r=f[q];var B=!1;if("[object Object]"!==e.call(r))return!1;for(m in r)if(l.call(r,m)){if(B)return!1;B=!0}if(B&&-1===h.indexOf(m))h.push(m);else return!1}return!0},construct:function(f){return null!==f?f:[]}})},{"../type":13}],25:[function(a,b){a=a("../type");var l=Object.prototype.toString;b.exports=new a("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(e){if(null===e)return!0;var f;var h=Array(e.length);var g=0;for(f=e.length;g<
f;g+=1){var m=e[g];if("[object Object]"!==l.call(m))return!1;var q=Object.keys(m);if(1!==q.length)return!1;h[g]=[q[0],m[q[0]]]}return!0},construct:function(e){if(null===e)return[];var f;var h=Array(e.length);var g=0;for(f=e.length;g<f;g+=1){var m=e[g];var q=Object.keys(m);h[g]=[q[0],m[q[0]]]}return h}})},{"../type":13}],26:[function(a,b){a=a("../type");b.exports=new a("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(l){return null!==l?l:[]}})},{"../type":13}],27:[function(a,b){a=a("../type");
var l=Object.prototype.hasOwnProperty;b.exports=new a("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(e){if(null===e)return!0;for(var f in e)if(l.call(e,f)&&null!==e[f])return!1;return!0},construct:function(e){return null!==e?e:{}}})},{"../type":13}],28:[function(a,b){a=a("../type");b.exports=new a("tag:yaml.org,2002:str",{kind:"scalar",construct:function(l){return null!==l?l:""}})},{"../type":13}],29:[function(a,b){a=a("../type");var l=RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),
e=RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");b.exports=new a("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(f){return null===f?!1:null!==l.exec(f)||null!==e.exec(f)?!0:!1},construct:function(f){var h=0,g=null;var m=l.exec(f);null===m&&(m=e.exec(f));if(null===m)throw Error("Date resolve error");f=+m[1];var q=+m[2]-1;var r=+m[3];if(!m[4])return new Date(Date.UTC(f,
q,r));var B=+m[4];var D=+m[5];var F=+m[6];if(m[7]){for(h=m[7].slice(0,3);3>h.length;)h+="0";h=+h}if(m[9]){g=+m[10];var G=+(m[11]||0);g=6E4*(60*g+G);"-"===m[9]&&(g=-g)}m=new Date(Date.UTC(f,q,r,B,D,F,h));g&&m.setTime(m.getTime()-g);return m},instanceOf:Date,represent:function(f){return f.toISOString()}})},{"../type":13}],"/":[function(a,b){a=a("./lib/js-yaml.js");b.exports=a},{"./lib/js-yaml.js":1}]},{},[])("/")});
(function(){function a(e,f){var h;if("undefined"===typeof Object.getOwnPropertyNames)for(h in f.prototype){if("undefined"===typeof e.prototype[h]||e.prototype[h]===Object.prototype[h])e.prototype[h]=f.prototype[h]}else for(var g=Object.getOwnPropertyNames(f.prototype),m=0;m<g.length;m++)"undefined"===typeof Object.getOwnPropertyDescriptor(e.prototype,g[m])&&Object.defineProperty(e.prototype,g[m],Object.getOwnPropertyDescriptor(f.prototype,g[m]));for(h in f)"undefined"===typeof e[h]&&(e[h]=f[h]);e.$baseCtor=
f}var b={version:"6.4.2.2",use_lines:!0,use_xyz:!1},l=!1;"undefined"!==typeof module&&module.exports?(module.exports=b,l=!0):"undefined"!==typeof document?window.ClipperLib=b:self.ClipperLib=b;l=l?"chrome":navigator.userAgent.toString().toLowerCase();-1!=l.indexOf("chrome")&&l.indexOf("chromium");l.indexOf("chromium");-1!=l.indexOf("safari")&&-1==l.indexOf("chrome")&&l.indexOf("chromium");l.indexOf("firefox");l.indexOf("firefox/17");l.indexOf("firefox/15");l.indexOf("firefox/3");l.indexOf("opera");
l.indexOf("msie 10");l.indexOf("msie 9");l.indexOf("msie 8");l.indexOf("msie 7");l.indexOf("msie ");b.Path=function(){return[]};b.Path.prototype.push=Array.prototype.push;b.Paths=function(){return[]};b.Paths.prototype.push=Array.prototype.push;b.PolyNode=function(){this.m_Parent=null;this.m_polygon=new b.Path;this.m_endtype=this.m_jointype=this.m_Index=0;this.m_Childs=[];this.IsOpen=!1};b.PolyNode.prototype.IsHoleNode=function(){for(var e=!0,f=this.m_Parent;null!==f;)e=!e,f=f.m_Parent;return e};b.PolyNode.prototype.ChildCount=
function(){return this.m_Childs.length};b.PolyNode.prototype.Contour=function(){return this.m_polygon};b.PolyNode.prototype.AddChild=function(e){var f=this.m_Childs.length;this.m_Childs.push(e);e.m_Parent=this;e.m_Index=f};b.PolyNode.prototype.GetNext=function(){return 0<this.m_Childs.length?this.m_Childs[0]:this.GetNextSiblingUp()};b.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index===this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+
1]};b.PolyNode.prototype.Childs=function(){return this.m_Childs};b.PolyNode.prototype.Parent=function(){return this.m_Parent};b.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()};b.PolyTree=function(){this.m_AllPolys=[];b.PolyNode.call(this)};b.PolyTree.prototype.Clear=function(){for(var e=0,f=this.m_AllPolys.length;e<f;e++)this.m_AllPolys[e]=null;this.m_AllPolys.length=0;this.m_Childs.length=0};b.PolyTree.prototype.GetFirst=function(){return 0<this.m_Childs.length?this.m_Childs[0]:null};
b.PolyTree.prototype.Total=function(){var e=this.m_AllPolys.length;0<e&&this.m_Childs[0]!==this.m_AllPolys[0]&&e--;return e};a(b.PolyTree,b.PolyNode);b.Clear=function(e){e.length=0};b.PI=3.141592653589793;b.PI2=6.283185307179586;b.FPoint=function(){var e=arguments,f=e.length;this.Y=this.X=0;b.use_xyz?(this.Z=0,3===f?(this.X=e[0],this.Y=e[1],this.Z=e[2]):2===f?(this.X=e[0],this.Y=e[1],this.Z=0):1===f?e[0]instanceof b.FPoint?(e=e[0],this.X=e.X,this.Y=e.Y,this.Z=0):(e=e[0],"undefined"===typeof e.Z&&
(e.Z=0),this.X=e.X,this.Y=e.Y,this.Z=e.Z):this.Z=this.Y=this.X=0):2===f?(this.X=e[0],this.Y=e[1]):1===f?(e=e[0],this.X=e.X,this.Y=e.Y):this.Y=this.X=0};b.FPoint.op_Equality=function(e,f){return e.X===f.X&&e.Y===f.Y};b.FPoint.op_Inequality=function(e,f){return e.X!==f.X||e.Y!==f.Y};b.FPoint0=function(){this.Y=this.X=0;b.use_xyz&&(this.Z=-1)};b.FPoint0.prototype=b.FPoint.prototype;b.FPoint1=function(e){this.X=e.X;this.Y=e.Y;b.use_xyz&&(this.Z="undefined"===typeof e.Z?0:e.Z)};b.FPoint1.prototype=b.FPoint.prototype;
b.FPoint1dp=function(e){this.X=e.X;this.Y=e.Y;b.use_xyz&&(this.Z=0)};b.FPoint1dp.prototype=b.FPoint.prototype;b.FPoint2=function(e,f,h){this.X=e;this.Y=f;b.use_xyz&&(this.Z="undefined"===typeof h?0:h)};b.FPoint2.prototype=b.FPoint.prototype;b.FRect=function(){var e=arguments,f=e.length;4===f?(this.left=e[0],this.top=e[1],this.right=e[2],this.bottom=e[3]):1===f?(e=e[0],this.left=e.left,this.top=e.top,this.right=e.right,this.bottom=e.bottom):this.bottom=this.right=this.top=this.left=0};b.FRect0=function(){this.bottom=
this.right=this.top=this.left=0};b.FRect0.prototype=b.FRect.prototype;b.FRect1=function(e){this.left=e.left;this.top=e.top;this.right=e.right;this.bottom=e.bottom};b.FRect1.prototype=b.FRect.prototype;b.FRect4=function(e,f,h,g){this.left=e;this.top=f;this.right=h;this.bottom=g};b.FRect4.prototype=b.FRect.prototype;b.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3};b.PolyType={ptSubject:0,ptClip:1};b.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3};b.JoinType={jtSquare:0,
jtRound:1,jtMiter:2,jtMiterAlways:3};b.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4};b.EdgeSide={esLeft:0,esRight:1};b.Direction={dRightToLeft:0,dLeftToRight:1};b.TEdge=function(){this.Bot=new b.FPoint0;this.Curr=new b.FPoint0;this.Top=new b.FPoint0;this.Delta=new b.FPoint0;this.Dx=0;this.PolyTyp=b.PolyType.ptSubject;this.Side=b.EdgeSide.esLeft;this.OutIdx=this.WindCnt2=this.WindCnt=this.WindDelta=0;this.PrevInSEL=this.NextInSEL=this.PrevInAEL=this.NextInAEL=
this.NextInLML=this.Prev=this.Next=null};b.IntersectNode=function(){this.Edge2=this.Edge1=null;this.Pt=new b.FPoint0};b.MyIntersectNodeSort=function(){};b.MyIntersectNodeSort.Compare=function(e,f){e=f.Pt.Y-e.Pt.Y;return 0<e?1:0>e?-1:0};b.LocalMinima=function(){this.Y=0;this.Next=this.RightBound=this.LeftBound=null};b.Scanbeam=function(){this.Y=0;this.Next=null};b.Maxima=function(){this.X=0;this.Prev=this.Next=null};b.OutRec=function(){this.Idx=0;this.IsOpen=this.IsHole=!1;this.PolyNode=this.BottomPt=
this.Pts=this.FirstLeft=null};b.OutPt=function(){this.Idx=0;this.Pt=new b.FPoint0;this.Prev=this.Next=null};b.Join=function(){this.OutPt2=this.OutPt1=null;this.OffPt=new b.FPoint0};b.ClipperBase=function(){this.m_CurrentLM=this.m_MinimaList=null;this.m_edges=[];this.PreserveCollinear=this.m_HasOpenPaths=!1;this.m_ActiveEdges=this.m_PolyOuts=this.m_Scanbeam=null};b.ClipperBase.horizontal=-3.4E38;b.ClipperBase.Skip=-2;b.ClipperBase.Unassigned=-1;b.ClipperBase.tolerance=1E-20;b.ClipperBase.maxValue=
Math.sqrt(Number.MAX_VALUE);b.ClipperBase.minValue=Math.sqrt(Number.MIN_VALUE);b.ClipperBase.near_zero=function(e){return e>-b.ClipperBase.tolerance&&e<b.ClipperBase.tolerance};b.ClipperBase.IsHorizontal=function(e){return 0===e.Delta.Y};b.ClipperBase.prototype.PointIsVertex=function(e,f){var h=f;do{if(b.FPoint.op_Equality(h.Pt,e))return!0;h=h.Next}while(h!==f);return!1};b.ClipperBase.prototype.PointOnLineSegment=function(e,f,h){return e.X===f.X&&e.Y===f.Y||e.X===h.X&&e.Y===h.Y||e.X>f.X===e.X<h.X&&
e.Y>f.Y===e.Y<h.Y&&(e.X-f.X)*(h.Y-f.Y)===(h.X-f.X)*(e.Y-f.Y)};b.ClipperBase.prototype.PointOnPolygon=function(e,f){for(var h=f;;){if(this.PointOnLineSegment(e,h.Pt,h.Next.Pt))return!0;h=h.Next;if(h===f)break}return!1};b.ClipperBase.prototype.SlopesEqual=b.ClipperBase.SlopesEqual=function(){var e=arguments,f=e.length;if(2===f)return f=e[0],e=e[1],f.Delta.Y*e.Delta.X===f.Delta.X*e.Delta.Y;if(3===f){f=e[0];var h=e[1];var g=e[2];return 0===(f.Y-h.Y)*(h.X-g.X)-(f.X-h.X)*(h.Y-g.Y)}f=e[0];h=e[1];g=e[2];
e=e[3];return 0===(f.Y-h.Y)*(g.X-e.X)-(f.X-h.X)*(g.Y-e.Y)};b.ClipperBase.SlopesEqual3=function(e,f){return e.Delta.Y*f.Delta.X===e.Delta.X*f.Delta.Y};b.ClipperBase.SlopesEqual4=function(e,f,h){return 0===(e.Y-f.Y)*(f.X-h.X)-(e.X-f.X)*(f.Y-h.Y)};b.ClipperBase.SlopesEqual5=function(e,f,h,g){return 0===(e.Y-f.Y)*(h.X-g.X)-(e.X-f.X)*(h.Y-g.Y)};b.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var e=0,f=this.m_edges.length;e<f;++e){for(var h=0,g=this.m_edges[e].length;h<g;++h)this.m_edges[e][h]=
null;b.Clear(this.m_edges[e])}b.Clear(this.m_edges);this.m_HasOpenPaths=!1};b.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var e=this.m_MinimaList.Next;this.m_MinimaList=null;this.m_MinimaList=e}this.m_CurrentLM=null};b.ClipperBase.prototype.RangeTest=function(e){(e.X>b.ClipperBase.maxValue||e.X<-b.ClipperBase.maxValue||e.Y>b.ClipperBase.maxValue||e.Y<-b.ClipperBase.maxValue||0<e.X&&e.X<b.ClipperBase.minValue||0<e.Y&&e.Y<b.ClipperBase.minValue||0>e.X&&e.X>
-b.ClipperBase.minValue||0>e.Y&&e.Y>-b.ClipperBase.minValue)&&b.Error("Coordinate outside allowed range in RangeTest().")};b.ClipperBase.prototype.InitEdge=function(e,f,h,g){e.Next=f;e.Prev=h;e.Curr.X=g.X;e.Curr.Y=g.Y;b.use_xyz&&(e.Curr.Z=g.Z);e.OutIdx=-1};b.ClipperBase.prototype.InitEdge2=function(e,f){e.Curr.Y>=e.Next.Curr.Y?(e.Bot.X=e.Curr.X,e.Bot.Y=e.Curr.Y,b.use_xyz&&(e.Bot.Z=e.Curr.Z),e.Top.X=e.Next.Curr.X,e.Top.Y=e.Next.Curr.Y,b.use_xyz&&(e.Top.Z=e.Next.Curr.Z)):(e.Top.X=e.Curr.X,e.Top.Y=e.Curr.Y,
b.use_xyz&&(e.Top.Z=e.Curr.Z),e.Bot.X=e.Next.Curr.X,e.Bot.Y=e.Next.Curr.Y,b.use_xyz&&(e.Bot.Z=e.Next.Curr.Z));this.SetDx(e);e.PolyTyp=f};b.ClipperBase.prototype.FindNextLocMin=function(e){for(var f;;){for(;b.FPoint.op_Inequality(e.Bot,e.Prev.Bot)||b.FPoint.op_Equality(e.Curr,e.Top);)e=e.Next;if(e.Dx!==b.ClipperBase.horizontal&&e.Prev.Dx!==b.ClipperBase.horizontal)break;for(;e.Prev.Dx===b.ClipperBase.horizontal;)e=e.Prev;for(f=e;e.Dx===b.ClipperBase.horizontal;)e=e.Next;if(e.Top.Y!==e.Prev.Bot.Y){f.Prev.Bot.X<
e.Bot.X&&(e=f);break}}return e};b.ClipperBase.prototype.ProcessBound=function(e,f){var h=e;if(h.OutIdx===b.ClipperBase.Skip){e=h;if(f){for(;e.Top.Y===e.Next.Bot.Y;)e=e.Next;for(;e!==h&&e.Dx===b.ClipperBase.horizontal;)e=e.Prev}else{for(;e.Top.Y===e.Prev.Bot.Y;)e=e.Prev;for(;e!==h&&e.Dx===b.ClipperBase.horizontal;)e=e.Next}if(e===h)h=f?e.Next:e.Prev;else{e=f?h.Next:h.Prev;var g=new b.LocalMinima;g.Next=null;g.Y=e.Bot.Y;g.LeftBound=null;g.RightBound=e;e.WindDelta=0;h=this.ProcessBound(e,f);this.InsertLocalMinima(g)}return h}e.Dx===
b.ClipperBase.horizontal&&(g=f?e.Prev:e.Next,g.Dx===b.ClipperBase.horizontal?g.Bot.X!==e.Bot.X&&g.Top.X!==e.Bot.X&&this.ReverseHorizontal(e):g.Bot.X!==e.Bot.X&&this.ReverseHorizontal(e));g=e;if(f){for(;h.Top.Y===h.Next.Bot.Y&&h.Next.OutIdx!==b.ClipperBase.Skip;)h=h.Next;if(h.Dx===b.ClipperBase.horizontal&&h.Next.OutIdx!==b.ClipperBase.Skip){for(f=h;f.Prev.Dx===b.ClipperBase.horizontal;)f=f.Prev;f.Prev.Top.X>h.Next.Top.X&&(h=f.Prev)}for(;e!==h;)e.NextInLML=e.Next,e.Dx===b.ClipperBase.horizontal&&e!==
g&&e.Bot.X!==e.Prev.Top.X&&this.ReverseHorizontal(e),e=e.Next;e.Dx===b.ClipperBase.horizontal&&e!==g&&e.Bot.X!==e.Prev.Top.X&&this.ReverseHorizontal(e);h=h.Next}else{for(;h.Top.Y===h.Prev.Bot.Y&&h.Prev.OutIdx!==b.ClipperBase.Skip;)h=h.Prev;if(h.Dx===b.ClipperBase.horizontal&&h.Prev.OutIdx!==b.ClipperBase.Skip){for(f=h;f.Next.Dx===b.ClipperBase.horizontal;)f=f.Next;if(f.Next.Top.X===h.Prev.Top.X||f.Next.Top.X>h.Prev.Top.X)h=f.Next}for(;e!==h;)e.NextInLML=e.Prev,e.Dx===b.ClipperBase.horizontal&&e!==
g&&e.Bot.X!==e.Next.Top.X&&this.ReverseHorizontal(e),e=e.Prev;e.Dx===b.ClipperBase.horizontal&&e!==g&&e.Bot.X!==e.Next.Top.X&&this.ReverseHorizontal(e);h=h.Prev}return h};b.ClipperBase.prototype.AddPath=function(e,f,h){b.use_lines?h||f!==b.PolyType.ptClip||b.Error("AddPath: Open paths must be subject."):h||b.Error("AddPath: Open paths have been disabled.");var g=e.length-1;if(h)for(;0<g&&b.FPoint.op_Equality(e[g],e[0]);)--g;for(;0<g&&b.FPoint.op_Equality(e[g],e[g-1]);)--g;if(h&&2>g||!h&&1>g)return!1;
for(var m=[],q=0;q<=g;q++)m.push(new b.TEdge);var r=!0;m[1].Curr.X=e[1].X;m[1].Curr.Y=e[1].Y;b.use_xyz&&(m[1].Curr.Z=e[1].Z);this.RangeTest(e[0]);this.RangeTest(e[g]);this.InitEdge(m[0],m[1],m[g],e[0]);this.InitEdge(m[g],m[0],m[g-1],e[g]);for(q=g-1;1<=q;--q)this.RangeTest(e[q]),this.InitEdge(m[q],m[q+1],m[q-1],e[q]);for(q=e=g=m[0];;)if(e.Curr!==e.Next.Curr||!h&&e.Next===g){if(e.Prev===e.Next)break;else if(h&&b.ClipperBase.SlopesEqual4(e.Prev.Curr,e.Curr,e.Next.Curr)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(e.Prev.Curr,
e.Curr,e.Next.Curr))){e===g&&(g=e.Next);e=this.RemoveEdge(e);q=e=e.Prev;continue}e=e.Next;if(e===q||!h&&e.Next===g)break}else{if(e===e.Next)break;e===g&&(g=e.Next);q=e=this.RemoveEdge(e)}if(!h&&e===e.Next||h&&e.Prev===e.Next)return!1;h||(this.m_HasOpenPaths=!0,g.Prev.OutIdx=b.ClipperBase.Skip);e=g;do this.InitEdge2(e,f),e=e.Next,r&&e.Curr.Y!==g.Curr.Y&&(r=!1);while(e!==g);if(r){if(h)return!1;e.Prev.OutIdx=b.ClipperBase.Skip;f=new b.LocalMinima;f.Next=null;f.Y=e.Bot.Y;f.LeftBound=null;f.RightBound=
e;f.RightBound.Side=b.EdgeSide.esRight;for(f.RightBound.WindDelta=0;;){e.Bot.X!==e.Prev.Top.X&&this.ReverseHorizontal(e);if(e.Next.OutIdx===b.ClipperBase.Skip)break;e=e.NextInLML=e.Next}this.InsertLocalMinima(f);this.m_edges.push(m);return!0}this.m_edges.push(m);r=null;b.FPoint.op_Equality(e.Prev.Bot,e.Prev.Top)&&(e=e.Next);for(;;){e=this.FindNextLocMin(e);if(e===r)break;else null===r&&(r=e);f=new b.LocalMinima;f.Next=null;f.Y=e.Bot.Y;e.Dx<e.Prev.Dx?(f.LeftBound=e.Prev,f.RightBound=e,m=!1):(f.LeftBound=
e,f.RightBound=e.Prev,m=!0);f.LeftBound.Side=b.EdgeSide.esLeft;f.RightBound.Side=b.EdgeSide.esRight;f.LeftBound.WindDelta=h?f.LeftBound.Next===f.RightBound?-1:1:0;f.RightBound.WindDelta=-f.LeftBound.WindDelta;e=this.ProcessBound(f.LeftBound,m);e.OutIdx===b.ClipperBase.Skip&&(e=this.ProcessBound(e,m));g=this.ProcessBound(f.RightBound,!m);g.OutIdx===b.ClipperBase.Skip&&(g=this.ProcessBound(g,!m));f.LeftBound.OutIdx===b.ClipperBase.Skip?f.LeftBound=null:f.RightBound.OutIdx===b.ClipperBase.Skip&&(f.RightBound=
null);this.InsertLocalMinima(f);m||(e=g)}return!0};b.ClipperBase.prototype.AddPaths=function(e,f,h){for(var g=!1,m=0,q=e.length;m<q;++m)this.AddPath(e[m],f,h)&&(g=!0);return g};b.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(e,f,h){return b.FPoint.op_Equality(e,h)||b.FPoint.op_Equality(e,f)||b.FPoint.op_Equality(h,f)?!1:e.X!==h.X?f.X>e.X===f.X<h.X:f.Y>e.Y===f.Y<h.Y};b.ClipperBase.prototype.RemoveEdge=function(e){e.Prev.Next=e.Next;e.Next.Prev=e.Prev;var f=e.Next;e.Prev=null;return f};b.ClipperBase.prototype.SetDx=
function(e){e.Delta.X=e.Top.X-e.Bot.X;e.Delta.Y=e.Top.Y-e.Bot.Y;e.Dx=0===e.Delta.Y?b.ClipperBase.horizontal:e.Delta.X/e.Delta.Y};b.ClipperBase.prototype.InsertLocalMinima=function(e){if(null===this.m_MinimaList)this.m_MinimaList=e;else if(e.Y>=this.m_MinimaList.Y)e.Next=this.m_MinimaList,this.m_MinimaList=e;else{for(var f=this.m_MinimaList;null!==f.Next&&e.Y<f.Next.Y;)f=f.Next;e.Next=f.Next;f.Next=e}};b.ClipperBase.prototype.PopLocalMinima=function(e,f){f.v=this.m_CurrentLM;return null!==this.m_CurrentLM&&
this.m_CurrentLM.Y===e?(this.m_CurrentLM=this.m_CurrentLM.Next,!0):!1};b.ClipperBase.prototype.ReverseHorizontal=function(e){var f=e.Top.X;e.Top.X=e.Bot.X;e.Bot.X=f;b.use_xyz&&(f=e.Top.Z,e.Top.Z=e.Bot.Z,e.Bot.Z=f)};b.ClipperBase.prototype.Reset=function(){this.m_CurrentLM=this.m_MinimaList;if(null!==this.m_CurrentLM){this.m_Scanbeam=null;for(var e=this.m_MinimaList;null!==e;){this.InsertScanbeam(e.Y);var f=e.LeftBound;null!==f&&(f.Curr.X=f.Bot.X,f.Curr.Y=f.Bot.Y,b.use_xyz&&(f.Curr.Z=f.Bot.Z),f.OutIdx=
b.ClipperBase.Unassigned);f=e.RightBound;null!==f&&(f.Curr.X=f.Bot.X,f.Curr.Y=f.Bot.Y,b.use_xyz&&(f.Curr.Z=f.Bot.Z),f.OutIdx=b.ClipperBase.Unassigned);e=e.Next}this.m_ActiveEdges=null}};b.ClipperBase.prototype.InsertScanbeam=function(e){if(null===this.m_Scanbeam)this.m_Scanbeam=new b.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=e;else if(e>this.m_Scanbeam.Y){var f=new b.Scanbeam;f.Y=e;f.Next=this.m_Scanbeam;this.m_Scanbeam=f}else{for(f=this.m_Scanbeam;null!==f.Next&&e<=f.Next.Y;)f=f.Next;
if(e!==f.Y){var h=new b.Scanbeam;h.Y=e;h.Next=f.Next;f.Next=h}}};b.ClipperBase.prototype.PopScanbeam=function(e){if(null===this.m_Scanbeam)return e.v=0,!1;e.v=this.m_Scanbeam.Y;this.m_Scanbeam=this.m_Scanbeam.Next;return!0};b.ClipperBase.prototype.LocalMinimaPending=function(){return null!==this.m_CurrentLM};b.ClipperBase.prototype.CreateOutRec=function(){var e=new b.OutRec;e.Idx=b.ClipperBase.Unassigned;e.IsHole=!1;e.IsOpen=!1;e.FirstLeft=null;e.Pts=null;e.BottomPt=null;e.PolyNode=null;this.m_PolyOuts.push(e);
e.Idx=this.m_PolyOuts.length-1;return e};b.ClipperBase.prototype.DisposeOutRec=function(e){this.m_PolyOuts[e].Pts=null;this.m_PolyOuts[e]=null};b.ClipperBase.prototype.UpdateEdgeIntoAEL=function(e){null===e.NextInLML&&b.Error("UpdateEdgeIntoAEL: invalid call");var f=e.PrevInAEL,h=e.NextInAEL;e.NextInLML.OutIdx=e.OutIdx;null!==f?f.NextInAEL=e.NextInLML:this.m_ActiveEdges=e.NextInLML;null!==h&&(h.PrevInAEL=e.NextInLML);e.NextInLML.Side=e.Side;e.NextInLML.WindDelta=e.WindDelta;e.NextInLML.WindCnt=e.WindCnt;
e.NextInLML.WindCnt2=e.WindCnt2;e=e.NextInLML;e.Curr.X=e.Bot.X;e.Curr.Y=e.Bot.Y;e.PrevInAEL=f;e.NextInAEL=h;b.ClipperBase.IsHorizontal(e)||this.InsertScanbeam(e.Top.Y);return e};b.ClipperBase.prototype.SwapPositionsInAEL=function(e,f){if(e.NextInAEL!==e.PrevInAEL&&f.NextInAEL!==f.PrevInAEL){if(e.NextInAEL===f){var h=f.NextInAEL;null!==h&&(h.PrevInAEL=e);var g=e.PrevInAEL;null!==g&&(g.NextInAEL=f);f.PrevInAEL=g;f.NextInAEL=e;e.PrevInAEL=f;e.NextInAEL=h}else f.NextInAEL===e?(h=e.NextInAEL,null!==h&&
(h.PrevInAEL=f),g=f.PrevInAEL,null!==g&&(g.NextInAEL=e),e.PrevInAEL=g,e.NextInAEL=f,f.PrevInAEL=e,f.NextInAEL=h):(h=e.NextInAEL,g=e.PrevInAEL,e.NextInAEL=f.NextInAEL,null!==e.NextInAEL&&(e.NextInAEL.PrevInAEL=e),e.PrevInAEL=f.PrevInAEL,null!==e.PrevInAEL&&(e.PrevInAEL.NextInAEL=e),f.NextInAEL=h,null!==f.NextInAEL&&(f.NextInAEL.PrevInAEL=f),f.PrevInAEL=g,null!==f.PrevInAEL&&(f.PrevInAEL.NextInAEL=f));null===e.PrevInAEL?this.m_ActiveEdges=e:null===f.PrevInAEL&&(this.m_ActiveEdges=f)}};b.ClipperBase.prototype.DeleteFromAEL=
function(e){var f=e.PrevInAEL,h=e.NextInAEL;if(null!==f||null!==h||e===this.m_ActiveEdges)null!==f?f.NextInAEL=h:this.m_ActiveEdges=h,null!==h&&(h.PrevInAEL=f),e.NextInAEL=null,e.PrevInAEL=null};b.Clipper=function(e){"undefined"===typeof e&&(e=0);this.m_PolyOuts=null;this.m_ClipType=b.ClipType.ctIntersection;this.m_IntersectNodeComparer=this.m_IntersectList=this.m_SortedEdges=this.m_ActiveEdges=this.m_Maxima=this.m_Scanbeam=null;this.m_ExecuteLocked=!1;this.m_SubjFillType=this.m_ClipFillType=b.PolyFillType.pftEvenOdd;
this.m_GhostJoins=this.m_Joins=null;this.StrictlySimple=this.ReverseSolution=this.m_UsingPolyTree=!1;b.ClipperBase.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Maxima=this.m_Scanbeam=null;this.m_IntersectList=[];this.m_IntersectNodeComparer=b.MyIntersectNodeSort.Compare;this.m_UsingPolyTree=this.m_ExecuteLocked=!1;this.m_PolyOuts=[];this.m_Joins=[];this.m_GhostJoins=[];this.ReverseSolution=0!==(1&e);this.StrictlySimple=0!==(2&e);this.PreserveCollinear=0!==(4&e);b.use_xyz&&(this.ZFillFunction=
null)};b.Clipper.ioReverseSolution=1;b.Clipper.ioStrictlySimple=2;b.Clipper.ioPreserveCollinear=4;b.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),b.ClipperBase.prototype.Clear.call(this))};b.Clipper.prototype.InsertMaxima=function(e){var f=new b.Maxima;f.X=e;if(null===this.m_Maxima)this.m_Maxima=f,this.m_Maxima.Next=null,this.m_Maxima.Prev=null;else if(e<this.m_Maxima.X)f.Next=this.m_Maxima,f.Prev=null,this.m_Maxima=f;else{for(var h=this.m_Maxima;null!==h.Next&&
e>=h.Next.X;)h=h.Next;e!==h.X&&(f.Next=h.Next,f.Prev=h,null!==h.Next&&(h.Next.Prev=f),h.Next=f)}};b.Clipper.prototype.Execute=function(){var e=arguments,f=e.length,h=e[1]instanceof b.PolyTree;if(4!==f||h){if(4===f&&h){f=e[0];var g=e[1];h=e[2];e=e[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0;this.m_SubjFillType=h;this.m_ClipFillType=e;this.m_ClipType=f;this.m_UsingPolyTree=!0;try{(m=this.ExecuteInternal())&&this.BuildResult2(g)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return m}if(2===
f&&!h||2===f&&h)return f=e[0],g=e[1],this.Execute(f,g,b.PolyFillType.pftEvenOdd,b.PolyFillType.pftEvenOdd)}else{f=e[0];g=e[1];h=e[2];e=e[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&b.Error("Error: PolyTree struct is needed for open path clipping.");this.m_ExecuteLocked=!0;b.Clear(g);this.m_SubjFillType=h;this.m_ClipFillType=e;this.m_ClipType=f;this.m_UsingPolyTree=!1;try{var m=this.ExecuteInternal();m&&this.BuildResult(g)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return m}};
b.Clipper.prototype.FixHoleLinkage=function(e){if(null!==e.FirstLeft&&(e.IsHole===e.FirstLeft.IsHole||null===e.FirstLeft.Pts)){for(var f=e.FirstLeft;null!==f&&(f.IsHole===e.IsHole||null===f.Pts);)f=f.FirstLeft;e.FirstLeft=f}};b.Clipper.prototype.ExecuteInternal=function(){try{this.Reset();this.m_Maxima=this.m_SortedEdges=null;var e={},f={};if(!this.PopScanbeam(e))return!1;for(this.InsertLocalMinimaIntoAEL(e.v);this.PopScanbeam(f)||this.LocalMinimaPending();){this.ProcessHorizontals();this.m_GhostJoins.length=
0;if(!this.ProcessIntersections(f.v))return!1;this.ProcessEdgesAtTopOfScanbeam(f.v);e.v=f.v;this.InsertLocalMinimaIntoAEL(e.v)}var h;var g=0;for(h=this.m_PolyOuts.length;g<h;g++){var m=this.m_PolyOuts[g];null===m.Pts||m.IsOpen||(m.IsHole^this.ReverseSolution)==0<this.Area$1(m)&&this.ReversePolyPtLinks(m.Pts)}this.JoinCommonEdges();g=0;for(h=this.m_PolyOuts.length;g<h;g++)m=this.m_PolyOuts[g],null!==m.Pts&&(m.IsOpen?this.FixupOutPolyline(m):this.FixupOutPolygon(m));this.StrictlySimple&&this.DoSimplePolygons();
return!0}finally{this.m_Joins.length=0,this.m_GhostJoins.length=0}};b.Clipper.prototype.DisposeAllPolyPts=function(){for(var e=0,f=this.m_PolyOuts.length;e<f;++e)this.DisposeOutRec(e);b.Clear(this.m_PolyOuts)};b.Clipper.prototype.AddJoin=function(e,f,h){var g=new b.Join;g.OutPt1=e;g.OutPt2=f;g.OffPt.X=h.X;g.OffPt.Y=h.Y;b.use_xyz&&(g.OffPt.Z=h.Z);this.m_Joins.push(g)};b.Clipper.prototype.AddGhostJoin=function(e,f){var h=new b.Join;h.OutPt1=e;h.OffPt.X=f.X;h.OffPt.Y=f.Y;b.use_xyz&&(h.OffPt.Z=f.Z);this.m_GhostJoins.push(h)};
b.Clipper.prototype.SetZ=function(e,f,h){null!==this.ZFillFunction&&-1===e.Z&&null!==this.ZFillFunction&&(b.FPoint.op_Equality(e,f.Bot)?e.Z=f.Bot.Z:b.FPoint.op_Equality(e,f.Top)?e.Z=f.Top.Z:b.FPoint.op_Equality(e,h.Bot)?e.Z=h.Bot.Z:b.FPoint.op_Equality(e,h.Top)?e.Z=h.Top.Z:this.ZFillFunction(f.Bot,f.Top,h.Bot,h.Top,e))};b.Clipper.prototype.InsertLocalMinimaIntoAEL=function(e){for(var f={},h,g;this.PopLocalMinima(e,f);){h=f.v.LeftBound;g=f.v.RightBound;var m=null;null===h?(this.InsertEdgeIntoAEL(g,
null),this.SetWindingCount(g),this.IsContributing(g)&&(m=this.AddOutPt(g,g.Bot))):(null===g?(this.InsertEdgeIntoAEL(h,null),this.SetWindingCount(h),this.IsContributing(h)&&(m=this.AddOutPt(h,h.Bot))):(this.InsertEdgeIntoAEL(h,null),this.InsertEdgeIntoAEL(g,h),this.SetWindingCount(h),g.WindCnt=h.WindCnt,g.WindCnt2=h.WindCnt2,this.IsContributing(h)&&(m=this.AddLocalMinPoly(h,g,h.Bot))),this.InsertScanbeam(h.Top.Y));null!==g&&(b.ClipperBase.IsHorizontal(g)?(null!==g.NextInLML&&this.InsertScanbeam(g.NextInLML.Top.Y),
this.AddEdgeToSEL(g)):this.InsertScanbeam(g.Top.Y));if(null!==h&&null!==g){if(null!==m&&b.ClipperBase.IsHorizontal(g)&&0<this.m_GhostJoins.length&&0!==g.WindDelta)for(var q=0,r=this.m_GhostJoins.length;q<r;q++){var B=this.m_GhostJoins[q];this.HorzSegmentsOverlap(B.OutPt1.Pt.X,B.OffPt.X,g.Bot.X,g.Top.X)&&this.AddJoin(B.OutPt1,m,B.OffPt)}0<=h.OutIdx&&null!==h.PrevInAEL&&h.PrevInAEL.Curr.X===h.Bot.X&&0<=h.PrevInAEL.OutIdx&&b.ClipperBase.SlopesEqual5(h.PrevInAEL.Curr,h.PrevInAEL.Top,h.Curr,h.Top)&&0!==
h.WindDelta&&0!==h.PrevInAEL.WindDelta&&(q=this.AddOutPt(h.PrevInAEL,h.Bot),this.AddJoin(m,q,h.Top));if(h.NextInAEL!==g&&(0<=g.OutIdx&&0<=g.PrevInAEL.OutIdx&&b.ClipperBase.SlopesEqual5(g.PrevInAEL.Curr,g.PrevInAEL.Top,g.Curr,g.Top)&&0!==g.WindDelta&&0!==g.PrevInAEL.WindDelta&&(q=this.AddOutPt(g.PrevInAEL,g.Bot),this.AddJoin(m,q,g.Top)),m=h.NextInAEL,null!==m))for(;m!==g;)this.IntersectEdges(g,m,h.Curr),m=m.NextInAEL}}};b.Clipper.prototype.InsertEdgeIntoAEL=function(e,f){if(null===this.m_ActiveEdges)e.PrevInAEL=
null,e.NextInAEL=null,this.m_ActiveEdges=e;else if(null===f&&this.E2InsertsBeforeE1(this.m_ActiveEdges,e))e.PrevInAEL=null,e.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges=this.m_ActiveEdges.PrevInAEL=e;else{null===f&&(f=this.m_ActiveEdges);for(;null!==f.NextInAEL&&!this.E2InsertsBeforeE1(f.NextInAEL,e);)f=f.NextInAEL;e.NextInAEL=f.NextInAEL;null!==f.NextInAEL&&(f.NextInAEL.PrevInAEL=e);e.PrevInAEL=f;f.NextInAEL=e}};b.Clipper.prototype.E2InsertsBeforeE1=function(e,f){return f.Curr.X===e.Curr.X?f.Top.Y>
e.Top.Y?f.Top.X<b.Clipper.TopX(e,f.Top.Y):e.Top.X>b.Clipper.TopX(f,e.Top.Y):f.Curr.X<e.Curr.X};b.Clipper.prototype.IsEvenOddFillType=function(e){return e.PolyTyp===b.PolyType.ptSubject?this.m_SubjFillType===b.PolyFillType.pftEvenOdd:this.m_ClipFillType===b.PolyFillType.pftEvenOdd};b.Clipper.prototype.IsEvenOddAltFillType=function(e){return e.PolyTyp===b.PolyType.ptSubject?this.m_ClipFillType===b.PolyFillType.pftEvenOdd:this.m_SubjFillType===b.PolyFillType.pftEvenOdd};b.Clipper.prototype.IsContributing=
function(e){if(e.PolyTyp===b.PolyType.ptSubject){var f=this.m_SubjFillType;var h=this.m_ClipFillType}else f=this.m_ClipFillType,h=this.m_SubjFillType;switch(f){case b.PolyFillType.pftEvenOdd:if(0===e.WindDelta&&1!==e.WindCnt)return!1;break;case b.PolyFillType.pftNonZero:if(1!==Math.abs(e.WindCnt))return!1;break;case b.PolyFillType.pftPositive:if(1!==e.WindCnt)return!1;break;default:if(-1!==e.WindCnt)return!1}switch(this.m_ClipType){case b.ClipType.ctIntersection:switch(h){case b.PolyFillType.pftEvenOdd:case b.PolyFillType.pftNonZero:return 0!==
e.WindCnt2;case b.PolyFillType.pftPositive:return 0<e.WindCnt2;default:return 0>e.WindCnt2}case b.ClipType.ctUnion:switch(h){case b.PolyFillType.pftEvenOdd:case b.PolyFillType.pftNonZero:return 0===e.WindCnt2;case b.PolyFillType.pftPositive:return 0>=e.WindCnt2;default:return 0<=e.WindCnt2}case b.ClipType.ctDifference:if(e.PolyTyp===b.PolyType.ptSubject)switch(h){case b.PolyFillType.pftEvenOdd:case b.PolyFillType.pftNonZero:return 0===e.WindCnt2;case b.PolyFillType.pftPositive:return 0>=e.WindCnt2;
default:return 0<=e.WindCnt2}else switch(h){case b.PolyFillType.pftEvenOdd:case b.PolyFillType.pftNonZero:return 0!==e.WindCnt2;case b.PolyFillType.pftPositive:return 0<e.WindCnt2;default:return 0>e.WindCnt2}case b.ClipType.ctXor:if(0===e.WindDelta)switch(h){case b.PolyFillType.pftEvenOdd:case b.PolyFillType.pftNonZero:return 0===e.WindCnt2;case b.PolyFillType.pftPositive:return 0>=e.WindCnt2;default:return 0<=e.WindCnt2}}return!0};b.Clipper.prototype.SetWindingCount=function(e){for(var f=e.PrevInAEL;null!==
f&&(f.PolyTyp!==e.PolyTyp||0===f.WindDelta);)f=f.PrevInAEL;if(null===f)f=e.PolyTyp===b.PolyType.ptSubject?this.m_SubjFillType:this.m_ClipFillType,e.WindCnt=0===e.WindDelta?f===b.PolyFillType.pftNegative?-1:1:e.WindDelta,e.WindCnt2=0,f=this.m_ActiveEdges;else{if(0===e.WindDelta&&this.m_ClipType!==b.ClipType.ctUnion)e.WindCnt=1;else if(this.IsEvenOddFillType(e))if(0===e.WindDelta){for(var h=!0,g=f.PrevInAEL;null!==g;)g.PolyTyp===f.PolyTyp&&0!==g.WindDelta&&(h=!h),g=g.PrevInAEL;e.WindCnt=h?0:1}else e.WindCnt=
e.WindDelta;else e.WindCnt=0>f.WindCnt*f.WindDelta?1<Math.abs(f.WindCnt)?0>f.WindDelta*e.WindDelta?f.WindCnt:f.WindCnt+e.WindDelta:0===e.WindDelta?1:e.WindDelta:0===e.WindDelta?0>f.WindCnt?f.WindCnt-1:f.WindCnt+1:0>f.WindDelta*e.WindDelta?f.WindCnt:f.WindCnt+e.WindDelta;e.WindCnt2=f.WindCnt2;f=f.NextInAEL}if(this.IsEvenOddAltFillType(e))for(;f!==e;)0!==f.WindDelta&&(e.WindCnt2=0===e.WindCnt2?1:0),f=f.NextInAEL;else for(;f!==e;)e.WindCnt2+=f.WindDelta,f=f.NextInAEL};b.Clipper.prototype.AddEdgeToSEL=
function(e){null===this.m_SortedEdges?(this.m_SortedEdges=e,e.PrevInSEL=null,e.NextInSEL=null):(e.NextInSEL=this.m_SortedEdges,e.PrevInSEL=null,this.m_SortedEdges=this.m_SortedEdges.PrevInSEL=e)};b.Clipper.prototype.PopEdgeFromSEL=function(e){e.v=this.m_SortedEdges;if(null===e.v)return!1;var f=e.v;this.m_SortedEdges=e.v.NextInSEL;null!==this.m_SortedEdges&&(this.m_SortedEdges.PrevInSEL=null);f.NextInSEL=null;f.PrevInSEL=null;return!0};b.Clipper.prototype.CopyAELToSEL=function(){var e=this.m_ActiveEdges;
for(this.m_SortedEdges=e;null!==e;)e.PrevInSEL=e.PrevInAEL,e=e.NextInSEL=e.NextInAEL};b.Clipper.prototype.SwapPositionsInSEL=function(e,f){if(null!==e.NextInSEL||null!==e.PrevInSEL)if(null!==f.NextInSEL||null!==f.PrevInSEL){if(e.NextInSEL===f){var h=f.NextInSEL;null!==h&&(h.PrevInSEL=e);var g=e.PrevInSEL;null!==g&&(g.NextInSEL=f);f.PrevInSEL=g;f.NextInSEL=e;e.PrevInSEL=f;e.NextInSEL=h}else f.NextInSEL===e?(h=e.NextInSEL,null!==h&&(h.PrevInSEL=f),g=f.PrevInSEL,null!==g&&(g.NextInSEL=e),e.PrevInSEL=
g,e.NextInSEL=f,f.PrevInSEL=e,f.NextInSEL=h):(h=e.NextInSEL,g=e.PrevInSEL,e.NextInSEL=f.NextInSEL,null!==e.NextInSEL&&(e.NextInSEL.PrevInSEL=e),e.PrevInSEL=f.PrevInSEL,null!==e.PrevInSEL&&(e.PrevInSEL.NextInSEL=e),f.NextInSEL=h,null!==f.NextInSEL&&(f.NextInSEL.PrevInSEL=f),f.PrevInSEL=g,null!==f.PrevInSEL&&(f.PrevInSEL.NextInSEL=f));null===e.PrevInSEL?this.m_SortedEdges=e:null===f.PrevInSEL&&(this.m_SortedEdges=f)}};b.Clipper.prototype.AddLocalMaxPoly=function(e,f,h){this.AddOutPt(e,h);0===f.WindDelta&&
this.AddOutPt(f,h);e.OutIdx===f.OutIdx?(e.OutIdx=-1,f.OutIdx=-1):e.OutIdx<f.OutIdx?this.AppendPolygon(e,f):this.AppendPolygon(f,e)};b.Clipper.prototype.AddLocalMinPoly=function(e,f,h){if(b.ClipperBase.IsHorizontal(f)||e.Dx>f.Dx){var g=this.AddOutPt(e,h);f.OutIdx=e.OutIdx;e.Side=b.EdgeSide.esLeft;f.Side=b.EdgeSide.esRight;var m=e;e=m.PrevInAEL===f?f.PrevInAEL:m.PrevInAEL}else g=this.AddOutPt(f,h),e.OutIdx=f.OutIdx,e.Side=b.EdgeSide.esRight,f.Side=b.EdgeSide.esLeft,m=f,e=m.PrevInAEL===e?e.PrevInAEL:
m.PrevInAEL;if(null!==e&&0<=e.OutIdx&&e.Top.Y<h.Y&&m.Top.Y<h.Y){f=b.Clipper.TopX(e,h.Y);var q=b.Clipper.TopX(m,h.Y);f===q&&0!==m.WindDelta&&0!==e.WindDelta&&b.ClipperBase.SlopesEqual5(new b.FPoint2(f,h.Y),e.Top,new b.FPoint2(q,h.Y),m.Top)&&(h=this.AddOutPt(e,h),this.AddJoin(g,h,m.Top))}return g};b.Clipper.prototype.AddOutPt=function(e,f){if(0>e.OutIdx){var h=this.CreateOutRec();h.IsOpen=0===e.WindDelta;var g=new b.OutPt;h.Pts=g;g.Idx=h.Idx;g.Pt.X=f.X;g.Pt.Y=f.Y;b.use_xyz&&(g.Pt.Z=f.Z);g.Next=g;g.Prev=
g;h.IsOpen||this.SetHoleState(e,h);e.OutIdx=h.Idx}else{h=this.m_PolyOuts[e.OutIdx];var m=h.Pts;if((e=e.Side===b.EdgeSide.esLeft)&&b.FPoint.op_Equality(f,m.Pt))return m;if(!e&&b.FPoint.op_Equality(f,m.Prev.Pt))return m.Prev;g=new b.OutPt;g.Idx=h.Idx;g.Pt.X=f.X;g.Pt.Y=f.Y;b.use_xyz&&(g.Pt.Z=f.Z);g.Next=m;g.Prev=m.Prev;g.Prev.Next=g;m.Prev=g;e&&(h.Pts=g)}return g};b.Clipper.prototype.GetLastOutPt=function(e){var f=this.m_PolyOuts[e.OutIdx];return e.Side===b.EdgeSide.esLeft?f.Pts:f.Pts.Prev};b.Clipper.prototype.SwapPoints=
function(e,f){var h=new b.FPoint1(e.Value);e.Value.X=f.Value.X;e.Value.Y=f.Value.Y;b.use_xyz&&(e.Value.Z=f.Value.Z);f.Value.X=h.X;f.Value.Y=h.Y;b.use_xyz&&(f.Value.Z=h.Z)};b.Clipper.prototype.HorzSegmentsOverlap=function(e,f,h,g){if(e>f){var m=e;e=f;f=m}h>g&&(m=h,h=g,g=m);return e<g&&h<f};b.Clipper.prototype.SetHoleState=function(e,f){e=e.PrevInAEL;for(var h=null;null!==e;)0<=e.OutIdx&&0!==e.WindDelta&&(null===h?h=e:h.OutIdx===e.OutIdx&&(h=null)),e=e.PrevInAEL;null===h?(f.FirstLeft=null,f.IsHole=
!1):(f.FirstLeft=this.m_PolyOuts[h.OutIdx],f.IsHole=!f.FirstLeft.IsHole)};b.Clipper.prototype.GetDx=function(e,f){return e.Y===f.Y?b.ClipperBase.horizontal:(f.X-e.X)/(f.Y-e.Y)};b.Clipper.prototype.FirstIsBottomPt=function(e,f){for(var h=e.Prev;b.FPoint.op_Equality(h.Pt,e.Pt)&&h!==e;)h=h.Prev;var g=Math.abs(this.GetDx(e.Pt,h.Pt));for(h=e.Next;b.FPoint.op_Equality(h.Pt,e.Pt)&&h!==e;)h=h.Next;var m=Math.abs(this.GetDx(e.Pt,h.Pt));for(h=f.Prev;b.FPoint.op_Equality(h.Pt,f.Pt)&&h!==f;)h=h.Prev;var q=Math.abs(this.GetDx(f.Pt,
h.Pt));for(h=f.Next;b.FPoint.op_Equality(h.Pt,f.Pt)&&h!==f;)h=h.Next;f=Math.abs(this.GetDx(f.Pt,h.Pt));return Math.max(g,m)===Math.max(q,f)&&Math.min(g,m)===Math.min(q,f)?0<this.Area(e):g>=q&&g>=f||m>=q&&m>=f};b.Clipper.prototype.GetBottomPt=function(e){for(var f=null,h=e.Next;h!==e;)h.Pt.Y>e.Pt.Y?(e=h,f=null):h.Pt.Y===e.Pt.Y&&h.Pt.X<=e.Pt.X&&(h.Pt.X<e.Pt.X?(f=null,e=h):h.Next!==e&&h.Prev!==e&&(f=h)),h=h.Next;if(null!==f)for(;f!==h;)for(this.FirstIsBottomPt(h,f)||(e=f),f=f.Next;b.FPoint.op_Inequality(f.Pt,
e.Pt);)f=f.Next;return e};b.Clipper.prototype.GetLowermostRec=function(e,f){null===e.BottomPt&&(e.BottomPt=this.GetBottomPt(e.Pts));null===f.BottomPt&&(f.BottomPt=this.GetBottomPt(f.Pts));var h=e.BottomPt,g=f.BottomPt;return h.Pt.Y>g.Pt.Y?e:h.Pt.Y<g.Pt.Y?f:h.Pt.X<g.Pt.X?e:h.Pt.X>g.Pt.X?f:h.Next===h?f:g.Next===g?e:this.FirstIsBottomPt(h,g)?e:f};b.Clipper.prototype.OutRec1RightOfOutRec2=function(e,f){do if(e=e.FirstLeft,e===f)return!0;while(null!==e);return!1};b.Clipper.prototype.GetOutRec=function(e){for(e=
this.m_PolyOuts[e];e!==this.m_PolyOuts[e.Idx];)e=this.m_PolyOuts[e.Idx];return e};b.Clipper.prototype.AppendPolygon=function(e,f){var h=this.m_PolyOuts[e.OutIdx],g=this.m_PolyOuts[f.OutIdx];var m=this.OutRec1RightOfOutRec2(h,g)?g:this.OutRec1RightOfOutRec2(g,h)?h:this.GetLowermostRec(h,g);var q=h.Pts,r=q.Prev,B=g.Pts,D=B.Prev;e.Side===b.EdgeSide.esLeft?f.Side===b.EdgeSide.esLeft?(this.ReversePolyPtLinks(B),B.Next=q,q.Prev=B,r.Next=D,D.Prev=r,h.Pts=D):(D.Next=q,q.Prev=D,B.Prev=r,r.Next=B,h.Pts=B):
f.Side===b.EdgeSide.esRight?(this.ReversePolyPtLinks(B),r.Next=D,D.Prev=r,B.Next=q,q.Prev=B):(r.Next=B,B.Prev=r,q.Prev=D,D.Next=q);h.BottomPt=null;m===g&&(g.FirstLeft!==h&&(h.FirstLeft=g.FirstLeft),h.IsHole=g.IsHole);g.Pts=null;g.BottomPt=null;g.FirstLeft=h;m=e.OutIdx;q=f.OutIdx;e.OutIdx=-1;f.OutIdx=-1;for(f=this.m_ActiveEdges;null!==f;){if(f.OutIdx===q){f.OutIdx=m;f.Side=e.Side;break}f=f.NextInAEL}g.Idx=h.Idx};b.Clipper.prototype.ReversePolyPtLinks=function(e){if(null!==e){var f=e;do{var h=f.Next;
f.Next=f.Prev;f=f.Prev=h}while(f!==e)}};b.Clipper.SwapSides=function(e,f){var h=e.Side;e.Side=f.Side;f.Side=h};b.Clipper.SwapPolyIndexes=function(e,f){var h=e.OutIdx;e.OutIdx=f.OutIdx;f.OutIdx=h};b.Clipper.prototype.IntersectEdges=function(e,f,h){var g=0<=e.OutIdx,m=0<=f.OutIdx;b.use_xyz&&this.SetZ(h,e,f);if(!b.use_lines||0!==e.WindDelta&&0!==f.WindDelta){if(e.PolyTyp===f.PolyTyp)if(this.IsEvenOddFillType(e)){var q=e.WindCnt;e.WindCnt=f.WindCnt;f.WindCnt=q}else e.WindCnt=0===e.WindCnt+f.WindDelta?
-e.WindCnt:e.WindCnt+f.WindDelta,f.WindCnt=0===f.WindCnt-e.WindDelta?-f.WindCnt:f.WindCnt-e.WindDelta;else this.IsEvenOddFillType(f)?e.WindCnt2=0===e.WindCnt2?1:0:e.WindCnt2+=f.WindDelta,this.IsEvenOddFillType(e)?f.WindCnt2=0===f.WindCnt2?1:0:f.WindCnt2-=e.WindDelta;if(e.PolyTyp===b.PolyType.ptSubject){var r=this.m_SubjFillType;var B=this.m_ClipFillType}else r=this.m_ClipFillType,B=this.m_SubjFillType;if(f.PolyTyp===b.PolyType.ptSubject){var D=this.m_SubjFillType;q=this.m_ClipFillType}else D=this.m_ClipFillType,
q=this.m_SubjFillType;switch(r){case b.PolyFillType.pftPositive:r=e.WindCnt;break;case b.PolyFillType.pftNegative:r=-e.WindCnt;break;default:r=Math.abs(e.WindCnt)}switch(D){case b.PolyFillType.pftPositive:D=f.WindCnt;break;case b.PolyFillType.pftNegative:D=-f.WindCnt;break;default:D=Math.abs(f.WindCnt)}if(g&&m)0!==r&&1!==r||0!==D&&1!==D||e.PolyTyp!==f.PolyTyp&&this.m_ClipType!==b.ClipType.ctXor?this.AddLocalMaxPoly(e,f,h):(this.AddOutPt(e,h),this.AddOutPt(f,h),b.Clipper.SwapSides(e,f),b.Clipper.SwapPolyIndexes(e,
f));else if(g){if(0===D||1===D)this.AddOutPt(e,h),b.Clipper.SwapSides(e,f),b.Clipper.SwapPolyIndexes(e,f)}else if(m){if(0===r||1===r)this.AddOutPt(f,h),b.Clipper.SwapSides(e,f),b.Clipper.SwapPolyIndexes(e,f)}else if(!(0!==r&&1!==r||0!==D&&1!==D)){switch(B){case b.PolyFillType.pftPositive:g=e.WindCnt2;break;case b.PolyFillType.pftNegative:g=-e.WindCnt2;break;default:g=Math.abs(e.WindCnt2)}switch(q){case b.PolyFillType.pftPositive:m=f.WindCnt2;break;case b.PolyFillType.pftNegative:m=-f.WindCnt2;break;
default:m=Math.abs(f.WindCnt2)}if(e.PolyTyp!==f.PolyTyp)this.AddLocalMinPoly(e,f,h);else if(1===r&&1===D)switch(this.m_ClipType){case b.ClipType.ctIntersection:0<g&&0<m&&this.AddLocalMinPoly(e,f,h);break;case b.ClipType.ctUnion:0>=g&&0>=m&&this.AddLocalMinPoly(e,f,h);break;case b.ClipType.ctDifference:(e.PolyTyp===b.PolyType.ptClip&&0<g&&0<m||e.PolyTyp===b.PolyType.ptSubject&&0>=g&&0>=m)&&this.AddLocalMinPoly(e,f,h);break;case b.ClipType.ctXor:this.AddLocalMinPoly(e,f,h)}else b.Clipper.SwapSides(e,
f)}}else if(0!==e.WindDelta||0!==f.WindDelta)e.PolyTyp===f.PolyTyp&&e.WindDelta!==f.WindDelta&&this.m_ClipType===b.ClipType.ctUnion?0===e.WindDelta?m&&(this.AddOutPt(e,h),g&&(e.OutIdx=-1)):g&&(this.AddOutPt(f,h),m&&(f.OutIdx=-1)):e.PolyTyp!==f.PolyTyp&&(0!==e.WindDelta||1!==Math.abs(f.WindCnt)||this.m_ClipType===b.ClipType.ctUnion&&0!==f.WindCnt2?0!==f.WindDelta||1!==Math.abs(e.WindCnt)||this.m_ClipType===b.ClipType.ctUnion&&0!==e.WindCnt2||(this.AddOutPt(f,h),m&&(f.OutIdx=-1)):(this.AddOutPt(e,h),
g&&(e.OutIdx=-1)))};b.Clipper.prototype.DeleteFromSEL=function(e){var f=e.PrevInSEL,h=e.NextInSEL;if(null!==f||null!==h||e===this.m_SortedEdges)null!==f?f.NextInSEL=h:this.m_SortedEdges=h,null!==h&&(h.PrevInSEL=f),e.NextInSEL=null,e.PrevInSEL=null};b.Clipper.prototype.ProcessHorizontals=function(){for(var e={};this.PopEdgeFromSEL(e);)this.ProcessHorizontal(e.v)};b.Clipper.prototype.GetHorzDirection=function(e,f){e.Bot.X<e.Top.X?(f.Left=e.Bot.X,f.Right=e.Top.X,f.Dir=b.Direction.dLeftToRight):(f.Left=
e.Top.X,f.Right=e.Bot.X,f.Dir=b.Direction.dRightToLeft)};b.Clipper.prototype.ProcessHorizontal=function(e){var f={Dir:null,Left:null,Right:null};this.GetHorzDirection(e,f);var h=f.Dir,g=f.Left;f=f.Right;for(var m=0===e.WindDelta,q=e,r=null;null!==q.NextInLML&&b.ClipperBase.IsHorizontal(q.NextInLML);)q=q.NextInLML;null===q.NextInLML&&(r=this.GetMaximaPair(q));var B=this.m_Maxima;if(null!==B)if(h===b.Direction.dLeftToRight){for(;null!==B&&B.X<=e.Bot.X;)B=B.Next;null!==B&&B.X>=q.Top.X&&(B=null)}else{for(;null!==
B.Next&&B.Next.X<e.Bot.X;)B=B.Next;B.X<=q.Top.X&&(B=null)}for(var D=null;;){for(var F=e===q,G=this.GetNextInAEL(e,h);null!==G;){if(null!==B)if(h===b.Direction.dLeftToRight)for(;null!==B&&B.X<G.Curr.X;)0<=e.OutIdx&&!m&&this.AddOutPt(e,new b.FPoint2(B.X,e.Bot.Y)),B=B.Next;else for(;null!==B&&B.X>G.Curr.X;)0<=e.OutIdx&&!m&&this.AddOutPt(e,new b.FPoint2(B.X,e.Bot.Y)),B=B.Prev;if(h===b.Direction.dLeftToRight&&G.Curr.X>f||h===b.Direction.dRightToLeft&&G.Curr.X<g)break;if(G.Curr.X===e.Top.X&&null!==e.NextInLML&&
G.Dx<e.NextInLML.Dx)break;if(0<=e.OutIdx&&!m){b.use_xyz&&(h===b.Direction.dLeftToRight?this.SetZ(G.Curr,e,G):this.SetZ(G.Curr,G,e));D=this.AddOutPt(e,G.Curr);for(var N=this.m_SortedEdges;null!==N;){if(0<=N.OutIdx&&this.HorzSegmentsOverlap(e.Bot.X,e.Top.X,N.Bot.X,N.Top.X)){var T=this.GetLastOutPt(N);this.AddJoin(T,D,N.Top)}N=N.NextInSEL}this.AddGhostJoin(D,e.Bot)}if(G===r&&F){0<=e.OutIdx&&this.AddLocalMaxPoly(e,r,e.Top);this.DeleteFromAEL(e);this.DeleteFromAEL(r);return}h===b.Direction.dLeftToRight?
(N=new b.FPoint2(G.Curr.X,e.Curr.Y),this.IntersectEdges(e,G,N)):(N=new b.FPoint2(G.Curr.X,e.Curr.Y),this.IntersectEdges(G,e,N));N=this.GetNextInAEL(G,h);this.SwapPositionsInAEL(e,G);G=N}if(null===e.NextInLML||!b.ClipperBase.IsHorizontal(e.NextInLML))break;e=this.UpdateEdgeIntoAEL(e);0<=e.OutIdx&&this.AddOutPt(e,e.Bot);f={Dir:h,Left:g,Right:f};this.GetHorzDirection(e,f);h=f.Dir;g=f.Left;f=f.Right}if(0<=e.OutIdx&&null===D){D=this.GetLastOutPt(e);for(N=this.m_SortedEdges;null!==N;)0<=N.OutIdx&&this.HorzSegmentsOverlap(e.Bot.X,
e.Top.X,N.Bot.X,N.Top.X)&&(T=this.GetLastOutPt(N),this.AddJoin(T,D,N.Top)),N=N.NextInSEL;this.AddGhostJoin(D,e.Top)}null!==e.NextInLML?0<=e.OutIdx?(D=this.AddOutPt(e,e.Top),e=this.UpdateEdgeIntoAEL(e),0!==e.WindDelta&&(h=e.PrevInAEL,N=e.NextInAEL,null!==h&&h.Curr.X===e.Bot.X&&h.Curr.Y===e.Bot.Y&&0===h.WindDelta&&0<=h.OutIdx&&h.Curr.Y>h.Top.Y&&b.ClipperBase.SlopesEqual3(e,h)?(T=this.AddOutPt(h,e.Bot),this.AddJoin(D,T,e.Top)):null!==N&&N.Curr.X===e.Bot.X&&N.Curr.Y===e.Bot.Y&&0!==N.WindDelta&&0<=N.OutIdx&&
N.Curr.Y>N.Top.Y&&b.ClipperBase.SlopesEqual3(e,N)&&(T=this.AddOutPt(N,e.Bot),this.AddJoin(D,T,e.Top)))):this.UpdateEdgeIntoAEL(e):(0<=e.OutIdx&&this.AddOutPt(e,e.Top),this.DeleteFromAEL(e))};b.Clipper.prototype.GetNextInAEL=function(e,f){return f===b.Direction.dLeftToRight?e.NextInAEL:e.PrevInAEL};b.Clipper.prototype.IsMinima=function(e){return null!==e&&e.Prev.NextInLML!==e&&e.Next.NextInLML!==e};b.Clipper.prototype.IsMaxima=function(e,f){return null!==e&&e.Top.Y===f&&null===e.NextInLML};b.Clipper.prototype.IsIntermediate=
function(e,f){return e.Top.Y===f&&null!==e.NextInLML};b.Clipper.prototype.GetMaximaPair=function(e){return b.FPoint.op_Equality(e.Next.Top,e.Top)&&null===e.Next.NextInLML?e.Next:b.FPoint.op_Equality(e.Prev.Top,e.Top)&&null===e.Prev.NextInLML?e.Prev:null};b.Clipper.prototype.GetMaximaPairEx=function(e){e=this.GetMaximaPair(e);return null===e||e.OutIdx===b.ClipperBase.Skip||e.NextInAEL===e.PrevInAEL&&!b.ClipperBase.IsHorizontal(e)?null:e};b.Clipper.prototype.ProcessIntersections=function(e){if(null===
this.m_ActiveEdges)return!0;try{this.BuildIntersectList(e);if(0===this.m_IntersectList.length)return!0;if(1===this.m_IntersectList.length||this.FixupIntersectionOrder())this.ProcessIntersectList();else return!1}catch(f){this.m_SortedEdges=null,this.m_IntersectList.length=0,b.Error("ProcessIntersections error")}this.m_SortedEdges=null;return!0};b.Clipper.prototype.BuildIntersectList=function(e){if(null!==this.m_ActiveEdges){var f=this.m_ActiveEdges;for(this.m_SortedEdges=f;null!==f;)f.PrevInSEL=f.PrevInAEL,
f.NextInSEL=f.NextInAEL,f.Curr.X=b.Clipper.TopX(f,e),f=f.NextInAEL;for(var h=!0;h&&null!==this.m_SortedEdges;){h=!1;for(f=this.m_SortedEdges;null!==f.NextInSEL;){var g=f.NextInSEL,m=new b.FPoint0;f.Curr.X>g.Curr.X?(this.IntersectPoint(f,g,m),m.Y<e&&(m=new b.FPoint2(b.Clipper.TopX(f,e),e)),h=new b.IntersectNode,h.Edge1=f,h.Edge2=g,h.Pt.X=m.X,h.Pt.Y=m.Y,b.use_xyz&&(h.Pt.Z=m.Z),this.m_IntersectList.push(h),this.SwapPositionsInSEL(f,g),h=!0):f=g}if(null!==f.PrevInSEL)f.PrevInSEL.NextInSEL=null;else break}this.m_SortedEdges=
null}};b.Clipper.prototype.EdgesAdjacent=function(e){return e.Edge1.NextInSEL===e.Edge2||e.Edge1.PrevInSEL===e.Edge2};b.Clipper.IntersectNodeSort=function(e,f){return f.Pt.Y-e.Pt.Y};b.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer);this.CopyAELToSEL();for(var e=this.m_IntersectList.length,f=0;f<e;f++){if(!this.EdgesAdjacent(this.m_IntersectList[f])){for(var h=f+1;h<e&&!this.EdgesAdjacent(this.m_IntersectList[h]);)h++;if(h===e)return!1;var g=
this.m_IntersectList[f];this.m_IntersectList[f]=this.m_IntersectList[h];this.m_IntersectList[h]=g}this.SwapPositionsInSEL(this.m_IntersectList[f].Edge1,this.m_IntersectList[f].Edge2)}return!0};b.Clipper.prototype.ProcessIntersectList=function(){for(var e=0,f=this.m_IntersectList.length;e<f;e++){var h=this.m_IntersectList[e];this.IntersectEdges(h.Edge1,h.Edge2,h.Pt);this.SwapPositionsInAEL(h.Edge1,h.Edge2)}this.m_IntersectList.length=0};b.Clipper.TopX=function(e,f){return f===e.Top.Y?e.Top.X:e.Bot.X+
e.Dx*(f-e.Bot.Y)};b.Clipper.prototype.IntersectPoint=function(e,f,h){h.X=0;h.Y=0;if(e.Dx===f.Dx)h.Y=e.Curr.Y,h.X=b.Clipper.TopX(e,h.Y);else{if(0===e.Delta.X)if(h.X=e.Bot.X,b.ClipperBase.IsHorizontal(f))h.Y=f.Bot.Y;else{var g=f.Bot.Y-f.Bot.X/f.Dx;h.Y=h.X/f.Dx+g}else if(0===f.Delta.X)if(h.X=f.Bot.X,b.ClipperBase.IsHorizontal(e))h.Y=e.Bot.Y;else{var m=e.Bot.Y-e.Bot.X/e.Dx;h.Y=h.X/e.Dx+m}else{m=e.Bot.X-e.Bot.Y*e.Dx;g=f.Bot.X-f.Bot.Y*f.Dx;var q=(g-m)/(e.Dx-f.Dx);h.Y=q;h.X=Math.abs(e.Dx)<Math.abs(f.Dx)?
e.Dx*q+m:f.Dx*q+g}if(h.Y<e.Top.Y||h.Y<f.Top.Y){if(e.Top.Y>f.Top.Y)return h.Y=e.Top.Y,h.X=b.Clipper.TopX(f,e.Top.Y),h.X<e.Top.X;h.Y=f.Top.Y;h.X=Math.abs(e.Dx)<Math.abs(f.Dx)?b.Clipper.TopX(e,h.Y):b.Clipper.TopX(f,h.Y)}h.Y>e.Curr.Y&&(h.Y=e.Curr.Y,h.X=Math.abs(e.Dx)>Math.abs(f.Dx)?b.Clipper.TopX(f,h.Y):b.Clipper.TopX(e,h.Y))}};b.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(e){for(var f=this.m_ActiveEdges;null!==f;){var h=this.IsMaxima(f,e);h&&(h=this.GetMaximaPairEx(f),h=null===h||!b.ClipperBase.IsHorizontal(h));
if(h){this.StrictlySimple&&this.InsertMaxima(f.Top.X);var g=f.PrevInAEL;this.DoMaxima(f);f=null===g?this.m_ActiveEdges:g.NextInAEL}else{this.IsIntermediate(f,e)&&b.ClipperBase.IsHorizontal(f.NextInLML)?(f=this.UpdateEdgeIntoAEL(f),0<=f.OutIdx&&this.AddOutPt(f,f.Bot),this.AddEdgeToSEL(f)):(f.Curr.X=b.Clipper.TopX(f,e),f.Curr.Y=e);b.use_xyz&&(f.Curr.Z=f.Top.Y===e?f.Top.Z:f.Bot.Y===e?f.Bot.Z:0);if(this.StrictlySimple&&(g=f.PrevInAEL,0<=f.OutIdx&&0!==f.WindDelta&&null!==g&&0<=g.OutIdx&&g.Curr.X===f.Curr.X&&
0!==g.WindDelta)){var m=new b.FPoint1(f.Curr);b.use_xyz&&this.SetZ(m,g,f);h=this.AddOutPt(g,m);g=this.AddOutPt(f,m);this.AddJoin(h,g,m)}f=f.NextInAEL}}this.ProcessHorizontals();this.m_Maxima=null;for(f=this.m_ActiveEdges;null!==f;)this.IsIntermediate(f,e)&&(h=null,0<=f.OutIdx&&(h=this.AddOutPt(f,f.Top)),f=this.UpdateEdgeIntoAEL(f),g=f.PrevInAEL,m=f.NextInAEL,null!==g&&g.Curr.X===f.Bot.X&&g.Curr.Y===f.Bot.Y&&null!==h&&0<=g.OutIdx&&g.Curr.Y===g.Top.Y&&b.ClipperBase.SlopesEqual5(f.Curr,f.Top,g.Curr,
g.Top)&&0!==f.WindDelta&&0!==g.WindDelta?(g=this.AddOutPt(ePrev2,f.Bot),this.AddJoin(h,g,f.Top)):null!==m&&m.Curr.X===f.Bot.X&&m.Curr.Y===f.Bot.Y&&null!==h&&0<=m.OutIdx&&m.Curr.Y===m.Top.Y&&b.ClipperBase.SlopesEqual5(f.Curr,f.Top,m.Curr,m.Top)&&0!==f.WindDelta&&0!==m.WindDelta&&(g=this.AddOutPt(m,f.Bot),this.AddJoin(h,g,f.Top))),f=f.NextInAEL};b.Clipper.prototype.DoMaxima=function(e){var f=this.GetMaximaPairEx(e);if(null===f)0<=e.OutIdx&&this.AddOutPt(e,e.Top),this.DeleteFromAEL(e);else{for(var h=
e.NextInAEL;null!==h&&h!==f;)this.IntersectEdges(e,h,e.Top),this.SwapPositionsInAEL(e,h),h=e.NextInAEL;-1===e.OutIdx&&-1===f.OutIdx?(this.DeleteFromAEL(e),this.DeleteFromAEL(f)):0<=e.OutIdx&&0<=f.OutIdx?(0<=e.OutIdx&&this.AddLocalMaxPoly(e,f,e.Top),this.DeleteFromAEL(e),this.DeleteFromAEL(f)):b.use_lines&&0===e.WindDelta?(0<=e.OutIdx&&(this.AddOutPt(e,e.Top),e.OutIdx=b.ClipperBase.Unassigned),this.DeleteFromAEL(e),0<=f.OutIdx&&(this.AddOutPt(f,e.Top),f.OutIdx=b.ClipperBase.Unassigned),this.DeleteFromAEL(f)):
b.Error("DoMaxima error")}};b.Clipper.ReversePaths=function(e){for(var f=0,h=e.length;f<h;f++)e[f].reverse()};b.Clipper.Orientation=function(e){return 0<=b.Clipper.Area(e)};b.Clipper.prototype.PointCount=function(e){if(null===e)return 0;var f=0,h=e;do f++,h=h.Next;while(h!==e);return f};b.Clipper.prototype.BuildResult=function(e){b.Clear(e);for(var f=0,h=this.m_PolyOuts.length;f<h;f++){var g=this.m_PolyOuts[f];if(null!==g.Pts){g=g.Pts.Prev;var m=this.PointCount(g);if(!(2>m)){for(var q=Array(m),r=
0;r<m;r++)q[r]=g.Pt,g=g.Prev;e.push(q)}}}};b.Clipper.prototype.BuildResult2=function(e){e.Clear();for(var f=0,h=this.m_PolyOuts.length;f<h;f++){var g=this.m_PolyOuts[f],m=this.PointCount(g.Pts);if(!(g.IsOpen&&2>m||!g.IsOpen&&3>m)){this.FixHoleLinkage(g);var q=new b.PolyNode;e.m_AllPolys.push(q);g.PolyNode=q;q.m_polygon.length=m;g=g.Pts.Prev;for(var r=0;r<m;r++)q.m_polygon[r]=g.Pt,g=g.Prev}}f=0;for(h=this.m_PolyOuts.length;f<h;f++)g=this.m_PolyOuts[f],null!==g.PolyNode&&(g.IsOpen?(g.PolyNode.IsOpen=
!0,e.AddChild(g.PolyNode)):null!==g.FirstLeft&&null!==g.FirstLeft.PolyNode?g.FirstLeft.PolyNode.AddChild(g.PolyNode):e.AddChild(g.PolyNode))};b.Clipper.prototype.FixupOutPolyline=function(e){for(var f=e.Pts,h=f.Prev;f!==h;)if(f=f.Next,b.FPoint.op_Equality(f.Pt,f.Prev.Pt)){f===h&&(h=f.Prev);var g=f.Prev;g.Next=f.Next;f=f.Next.Prev=g}f===f.Prev&&(e.Pts=null)};b.Clipper.prototype.FixupOutPolygon=function(e){var f=null;e.BottomPt=null;for(var h=e.Pts,g=this.PreserveCollinear||this.StrictlySimple;;){if(h.Prev===
h||h.Prev===h.Next){e.Pts=null;return}if(b.FPoint.op_Equality(h.Pt,h.Next.Pt)||b.FPoint.op_Equality(h.Pt,h.Prev.Pt)||b.ClipperBase.SlopesEqual4(h.Prev.Pt,h.Pt,h.Next.Pt)&&(!g||!this.Pt2IsBetweenPt1AndPt3(h.Prev.Pt,h.Pt,h.Next.Pt)))f=null,h.Prev.Next=h.Next,h=h.Next.Prev=h.Prev;else if(h===f)break;else null===f&&(f=h),h=h.Next}e.Pts=h};b.Clipper.prototype.DupOutPt=function(e,f){var h=new b.OutPt;h.Pt.X=e.Pt.X;h.Pt.Y=e.Pt.Y;b.use_xyz&&(h.Pt.Z=e.Pt.Z);h.Idx=e.Idx;f?(h.Next=e.Next,h.Prev=e,e.Next.Prev=
h,e.Next=h):(h.Prev=e.Prev,h.Next=e,e.Prev.Next=h,e.Prev=h);return h};b.Clipper.prototype.GetOverlap=function(e,f,h,g,m){e<f?h<g?(m.Left=Math.max(e,h),m.Right=Math.min(f,g)):(m.Left=Math.max(e,g),m.Right=Math.min(f,h)):h<g?(m.Left=Math.max(f,h),m.Right=Math.min(e,g)):(m.Left=Math.max(f,g),m.Right=Math.min(e,h));return m.Left<m.Right};b.Clipper.prototype.JoinHorz=function(e,f,h,g,m,q){var r=e.Pt.X>f.Pt.X?b.Direction.dRightToLeft:b.Direction.dLeftToRight;g=h.Pt.X>g.Pt.X?b.Direction.dRightToLeft:b.Direction.dLeftToRight;
if(r===g)return!1;if(r===b.Direction.dLeftToRight){for(;e.Next.Pt.X<=m.X&&e.Next.Pt.X>=e.Pt.X&&e.Next.Pt.Y===m.Y;)e=e.Next;q&&e.Pt.X!==m.X&&(e=e.Next);f=this.DupOutPt(e,!q);b.FPoint.op_Inequality(f.Pt,m)&&(e=f,e.Pt.X=m.X,e.Pt.Y=m.Y,b.use_xyz&&(e.Pt.Z=m.Z),f=this.DupOutPt(e,!q))}else{for(;e.Next.Pt.X>=m.X&&e.Next.Pt.X<=e.Pt.X&&e.Next.Pt.Y===m.Y;)e=e.Next;q||e.Pt.X===m.X||(e=e.Next);f=this.DupOutPt(e,q);b.FPoint.op_Inequality(f.Pt,m)&&(e=f,e.Pt.X=m.X,e.Pt.Y=m.Y,b.use_xyz&&(e.Pt.Z=m.Z),f=this.DupOutPt(e,
q))}if(g===b.Direction.dLeftToRight){for(;h.Next.Pt.X<=m.X&&h.Next.Pt.X>=h.Pt.X&&h.Next.Pt.Y===m.Y;)h=h.Next;q&&h.Pt.X!==m.X&&(h=h.Next);g=this.DupOutPt(h,!q);b.FPoint.op_Inequality(g.Pt,m)&&(h=g,h.Pt.X=m.X,h.Pt.Y=m.Y,b.use_xyz&&(h.Pt.Z=m.Z),g=this.DupOutPt(h,!q))}else{for(;h.Next.Pt.X>=m.X&&h.Next.Pt.X<=h.Pt.X&&h.Next.Pt.Y===m.Y;)h=h.Next;q||h.Pt.X===m.X||(h=h.Next);g=this.DupOutPt(h,q);b.FPoint.op_Inequality(g.Pt,m)&&(h=g,h.Pt.X=m.X,h.Pt.Y=m.Y,b.use_xyz&&(h.Pt.Z=m.Z),g=this.DupOutPt(h,q))}r===b.Direction.dLeftToRight===
q?(e.Prev=h,h.Next=e,f.Next=g,g.Prev=f):(e.Next=h,h.Prev=e,f.Prev=g,g.Next=f);return!0};b.Clipper.prototype.JoinPoints=function(e,f,h){var g=e.OutPt1,m;new b.OutPt;var q=e.OutPt2,r;new b.OutPt;if((r=e.OutPt1.Pt.Y===e.OffPt.Y)&&b.FPoint.op_Equality(e.OffPt,e.OutPt1.Pt)&&b.FPoint.op_Equality(e.OffPt,e.OutPt2.Pt)){if(f!==h)return!1;for(m=e.OutPt1.Next;m!==g&&b.FPoint.op_Equality(m.Pt,e.OffPt);)m=m.Next;m=m.Pt.Y>e.OffPt.Y;for(r=e.OutPt2.Next;r!==q&&b.FPoint.op_Equality(r.Pt,e.OffPt);)r=r.Next;if(m===
r.Pt.Y>e.OffPt.Y)return!1;m?(m=this.DupOutPt(g,!1),r=this.DupOutPt(q,!0),g.Prev=q,q.Next=g,m.Next=r,r.Prev=m):(m=this.DupOutPt(g,!0),r=this.DupOutPt(q,!1),g.Next=q,q.Prev=g,m.Prev=r,r.Next=m);e.OutPt1=g;e.OutPt2=m;return!0}if(r){for(m=g;g.Prev.Pt.Y===g.Pt.Y&&g.Prev!==m&&g.Prev!==q;)g=g.Prev;for(;m.Next.Pt.Y===m.Pt.Y&&m.Next!==g&&m.Next!==q;)m=m.Next;if(m.Next===g||m.Next===q)return!1;for(r=q;q.Prev.Pt.Y===q.Pt.Y&&q.Prev!==r&&q.Prev!==m;)q=q.Prev;for(;r.Next.Pt.Y===r.Pt.Y&&r.Next!==q&&r.Next!==g;)r=
r.Next;if(r.Next===q||r.Next===g)return!1;h={Left:null,Right:null};if(!this.GetOverlap(g.Pt.X,m.Pt.X,q.Pt.X,r.Pt.X,h))return!1;f=h.Left;var B=h.Right;h=new b.FPoint0;g.Pt.X>=f&&g.Pt.X<=B?(h.X=g.Pt.X,h.Y=g.Pt.Y,b.use_xyz&&(h.Z=g.Pt.Z),f=g.Pt.X>m.Pt.X):q.Pt.X>=f&&q.Pt.X<=B?(h.X=q.Pt.X,h.Y=q.Pt.Y,b.use_xyz&&(h.Z=q.Pt.Z),f=q.Pt.X>r.Pt.X):m.Pt.X>=f&&m.Pt.X<=B?(h.X=m.Pt.X,h.Y=m.Pt.Y,b.use_xyz&&(h.Z=m.Pt.Z),f=m.Pt.X>g.Pt.X):(h.X=r.Pt.X,h.Y=r.Pt.Y,b.use_xyz&&(h.Z=r.Pt.Z),f=r.Pt.X>q.Pt.X);e.OutPt1=g;e.OutPt2=
q;return this.JoinHorz(g,m,q,r,h,f)}for(m=g.Next;b.FPoint.op_Equality(m.Pt,g.Pt)&&m!==g;)m=m.Next;if(B=m.Pt.Y>g.Pt.Y||!b.ClipperBase.SlopesEqual4(g.Pt,m.Pt,e.OffPt)){for(m=g.Prev;b.FPoint.op_Equality(m.Pt,g.Pt)&&m!==g;)m=m.Prev;if(m.Pt.Y>g.Pt.Y||!b.ClipperBase.SlopesEqual4(g.Pt,m.Pt,e.OffPt))return!1}for(r=q.Next;b.FPoint.op_Equality(r.Pt,q.Pt)&&r!==q;)r=r.Next;var D=r.Pt.Y>q.Pt.Y||!b.ClipperBase.SlopesEqual4(q.Pt,r.Pt,e.OffPt);if(D){for(r=q.Prev;b.FPoint.op_Equality(r.Pt,q.Pt)&&r!==q;)r=r.Prev;if(r.Pt.Y>
q.Pt.Y||!b.ClipperBase.SlopesEqual4(q.Pt,r.Pt,e.OffPt))return!1}if(m===g||r===q||m===r||f===h&&B===D)return!1;B?(m=this.DupOutPt(g,!1),r=this.DupOutPt(q,!0),g.Prev=q,q.Next=g,m.Next=r,r.Prev=m):(m=this.DupOutPt(g,!0),r=this.DupOutPt(q,!1),g.Next=q,q.Prev=g,m.Prev=r,r.Next=m);e.OutPt1=g;e.OutPt2=m;return!0};b.Clipper.GetBounds=function(e){for(var f=0,h=e.length;f<h&&0===e[f].length;)f++;if(f===h)return new b.FRect(0,0,0,0);var g=new b.FRect;g.left=e[f][0].X;g.right=g.left;g.top=e[f][0].Y;for(g.bottom=
g.top;f<h;f++)for(var m=0,q=e[f].length;m<q;m++)e[f][m].X<g.left?g.left=e[f][m].X:e[f][m].X>g.right&&(g.right=e[f][m].X),e[f][m].Y<g.top?g.top=e[f][m].Y:e[f][m].Y>g.bottom&&(g.bottom=e[f][m].Y);return g};b.Clipper.prototype.GetBounds2=function(e){var f=e,h=new b.FRect;h.left=e.Pt.X;h.right=e.Pt.X;h.top=e.Pt.Y;h.bottom=e.Pt.Y;for(e=e.Next;e!==f;)e.Pt.X<h.left&&(h.left=e.Pt.X),e.Pt.X>h.right&&(h.right=e.Pt.X),e.Pt.Y<h.top&&(h.top=e.Pt.Y),e.Pt.Y>h.bottom&&(h.bottom=e.Pt.Y),e=e.Next;return h};b.Clipper.PointInPolygon=
function(e,f){var h=0,g=f.length;if(3>g)return 0;for(var m=f[0],q=1;q<=g;++q){var r=q===g?f[0]:f[q];if(r.Y===e.Y&&(r.X===e.X||m.Y===e.Y&&r.X>e.X===m.X<e.X))return-1;if(m.Y<e.Y!==r.Y<e.Y)if(m.X>=e.X)if(r.X>e.X)h=1-h;else{var B=(m.X-e.X)*(r.Y-e.Y)-(r.X-e.X)*(m.Y-e.Y);if(0===B)return-1;0<B===r.Y>m.Y&&(h=1-h)}else if(r.X>e.X){B=(m.X-e.X)*(r.Y-e.Y)-(r.X-e.X)*(m.Y-e.Y);if(0===B)return-1;0<B===r.Y>m.Y&&(h=1-h)}m=r}return h};b.Clipper.prototype.PointInPolygon=function(e,f){var h=0,g=f,m=e.X;e=e.Y;var q=f.Pt.X,
r=f.Pt.Y;do{f=f.Next;var B=f.Pt.X,D=f.Pt.Y;if(D===e&&(B===m||r===e&&B>m===q<m))return-1;if(r<e!==D<e)if(q>=m)if(B>m)h=1-h;else{q=(q-m)*(D-e)-(B-m)*(r-e);if(0===q)return-1;0<q===D>r&&(h=1-h)}else if(B>m){q=(q-m)*(D-e)-(B-m)*(r-e);if(0===q)return-1;0<q===D>r&&(h=1-h)}q=B;r=D}while(g!==f);return h};b.Clipper.prototype.Poly2ContainsPoly1=function(e,f){var h=e;do{var g=this.PointInPolygon(h.Pt,f);if(0<=g)return 0<g;h=h.Next}while(h!==e);return!0};b.Clipper.prototype.FixupFirstLefts1=function(e,f){for(var h,
g,m=0,q=this.m_PolyOuts.length;m<q;m++)h=this.m_PolyOuts[m],g=b.Clipper.ParseFirstLeft(h.FirstLeft),null!==h.Pts&&g===e&&this.Poly2ContainsPoly1(h.Pts,f.Pts)&&(h.FirstLeft=f)};b.Clipper.prototype.FixupFirstLefts2=function(e,f){for(var h=f.FirstLeft,g,m,q=0,r=this.m_PolyOuts.length;q<r;q++)if(g=this.m_PolyOuts[q],null!==g.Pts&&g!==f&&g!==e&&(m=b.Clipper.ParseFirstLeft(g.FirstLeft),m===h||m===e||m===f))if(this.Poly2ContainsPoly1(g.Pts,e.Pts))g.FirstLeft=e;else if(this.Poly2ContainsPoly1(g.Pts,f.Pts))g.FirstLeft=
f;else if(g.FirstLeft===e||g.FirstLeft===f)g.FirstLeft=h};b.Clipper.prototype.FixupFirstLefts3=function(e,f){for(var h,g,m=0,q=this.m_PolyOuts.length;m<q;m++)h=this.m_PolyOuts[m],g=b.Clipper.ParseFirstLeft(h.FirstLeft),null!==h.Pts&&g===e&&(h.FirstLeft=f)};b.Clipper.ParseFirstLeft=function(e){for(;null!==e&&null===e.Pts;)e=e.FirstLeft;return e};b.Clipper.prototype.JoinCommonEdges=function(){for(var e=0,f=this.m_Joins.length;e<f;e++){var h=this.m_Joins[e],g=this.GetOutRec(h.OutPt1.Idx),m=this.GetOutRec(h.OutPt2.Idx);
if(null!==g.Pts&&null!==m.Pts&&!g.IsOpen&&!m.IsOpen){var q=g===m?g:this.OutRec1RightOfOutRec2(g,m)?m:this.OutRec1RightOfOutRec2(m,g)?g:this.GetLowermostRec(g,m);this.JoinPoints(h,g,m)&&(g===m?(g.Pts=h.OutPt1,g.BottomPt=null,m=this.CreateOutRec(),m.Pts=h.OutPt2,this.UpdateOutPtIdxs(m),this.Poly2ContainsPoly1(m.Pts,g.Pts)?(m.IsHole=!g.IsHole,m.FirstLeft=g,this.m_UsingPolyTree&&this.FixupFirstLefts2(m,g),(m.IsHole^this.ReverseSolution)==0<this.Area$1(m)&&this.ReversePolyPtLinks(m.Pts)):this.Poly2ContainsPoly1(g.Pts,
m.Pts)?(m.IsHole=g.IsHole,g.IsHole=!m.IsHole,m.FirstLeft=g.FirstLeft,g.FirstLeft=m,this.m_UsingPolyTree&&this.FixupFirstLefts2(g,m),(g.IsHole^this.ReverseSolution)==0<this.Area$1(g)&&this.ReversePolyPtLinks(g.Pts)):(m.IsHole=g.IsHole,m.FirstLeft=g.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(g,m))):(m.Pts=null,m.BottomPt=null,m.Idx=g.Idx,g.IsHole=q.IsHole,q===m&&(g.FirstLeft=m.FirstLeft),m.FirstLeft=g,this.m_UsingPolyTree&&this.FixupFirstLefts3(m,g)))}}};b.Clipper.prototype.UpdateOutPtIdxs=
function(e){var f=e.Pts;do f.Idx=e.Idx,f=f.Prev;while(f!==e.Pts)};b.Clipper.prototype.DoSimplePolygons=function(){for(var e=0;e<this.m_PolyOuts.length;){var f=this.m_PolyOuts[e++],h=f.Pts;if(null!==h&&!f.IsOpen){do{for(var g=h.Next;g!==f.Pts;){if(b.FPoint.op_Equality(h.Pt,g.Pt)&&g.Next!==h&&g.Prev!==h){var m=h.Prev,q=g.Prev;h.Prev=q;q.Next=h;g.Prev=m;m.Next=g;f.Pts=h;m=this.CreateOutRec();m.Pts=g;this.UpdateOutPtIdxs(m);this.Poly2ContainsPoly1(m.Pts,f.Pts)?(m.IsHole=!f.IsHole,m.FirstLeft=f,this.m_UsingPolyTree&&
this.FixupFirstLefts2(m,f)):this.Poly2ContainsPoly1(f.Pts,m.Pts)?(m.IsHole=f.IsHole,f.IsHole=!m.IsHole,m.FirstLeft=f.FirstLeft,f.FirstLeft=m,this.m_UsingPolyTree&&this.FixupFirstLefts2(f,m)):(m.IsHole=f.IsHole,m.FirstLeft=f.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(f,m));g=h}g=g.Next}h=h.Next}while(h!==f.Pts)}}};b.Clipper.Area=function(e){if(!Array.isArray(e))return 0;var f=e.length;if(3>f)return 0;for(var h=0,g=0,m=f-1;g<f;++g)h+=(e[m].X+e[g].X)*(e[m].Y-e[g].Y),m=g;return.5*-h};b.Clipper.prototype.Area=
function(e){var f=e;if(null===e)return 0;var h=0;do h+=(e.Prev.Pt.X+e.Pt.X)*(e.Prev.Pt.Y-e.Pt.Y),e=e.Next;while(e!==f);return.5*h};b.Clipper.prototype.Area$1=function(e){return this.Area(e.Pts)};b.Clipper.SimplifyPolygon=function(e,f){var h=[],g=new b.Clipper(0);g.StrictlySimple=!0;g.AddPath(e,b.PolyType.ptSubject,!0);g.Execute(b.ClipType.ctUnion,h,f,f);return h};b.Clipper.SimplifyPolygons=function(e,f){"undefined"===typeof f&&(f=b.PolyFillType.pftEvenOdd);var h=[],g=new b.Clipper(0);g.StrictlySimple=
!0;g.AddPaths(e,b.PolyType.ptSubject,!0);g.Execute(b.ClipType.ctUnion,h,f,f);return h};b.Clipper.DistanceSqrd=function(e,f){var h=e.X-f.X;e=e.Y-f.Y;return h*h+e*e};b.Clipper.DistanceFromLineSqrd=function(e,f,h){var g=f.Y-h.Y;h=h.X-f.X;f=g*f.X+h*f.Y;f=g*e.X+h*e.Y-f;return f*f/(g*g+h*h)};b.Clipper.SlopesNearCollinear=function(e,f,h,g){return Math.abs(e.X-f.X)>Math.abs(e.Y-f.Y)?e.X>f.X===e.X<h.X?b.Clipper.DistanceFromLineSqrd(e,f,h)<g:f.X>e.X===f.X<h.X?b.Clipper.DistanceFromLineSqrd(f,e,h)<g:b.Clipper.DistanceFromLineSqrd(h,
e,f)<g:e.Y>f.Y===e.Y<h.Y?b.Clipper.DistanceFromLineSqrd(e,f,h)<g:f.Y>e.Y===f.Y<h.Y?b.Clipper.DistanceFromLineSqrd(f,e,h)<g:b.Clipper.DistanceFromLineSqrd(h,e,f)<g};b.Clipper.PointsAreClose=function(e,f,h){var g=e.X-f.X;e=e.Y-f.Y;return g*g+e*e<=h};b.Clipper.ExcludeOp=function(e){var f=e.Prev;f.Next=e.Next;e.Next.Prev=f;f.Idx=0;return f};b.Clipper.CleanPolygon=function(e,f){"undefined"===typeof f&&(f=1.415);var h=e.length;if(0===h)return[];for(var g=Array(h),m=0;m<h;++m)g[m]=new b.OutPt;for(m=0;m<
h;++m)g[m].Pt=e[m],g[m].Next=g[(m+1)%h],g[m].Next.Prev=g[m],g[m].Idx=0;m=f*f;for(g=g[0];0===g.Idx&&g.Next!==g.Prev;)b.Clipper.PointsAreClose(g.Pt,g.Prev.Pt,m)?(g=b.Clipper.ExcludeOp(g),h--):b.Clipper.PointsAreClose(g.Prev.Pt,g.Next.Pt,m)?(b.Clipper.ExcludeOp(g.Next),g=b.Clipper.ExcludeOp(g),h-=2):b.Clipper.SlopesNearCollinear(g.Prev.Pt,g.Pt,g.Next.Pt,m)?(g=b.Clipper.ExcludeOp(g),h--):(g.Idx=1,g=g.Next);3>h&&(h=0);e=Array(h);for(m=0;m<h;++m)e[m]=new b.FPoint1(g.Pt),g=g.Next;return e};b.Clipper.CleanPolygons=
function(e,f){for(var h=Array(e.length),g=0,m=e.length;g<m;g++)h[g]=b.Clipper.CleanPolygon(e[g],f);return h};b.Clipper.Minkowski=function(e,f,h,g){g=g?1:0;var m=e.length,q=f.length,r=[];if(h)for(h=0;h<q;h++){for(var B=Array(m),D=0,F=e.length,G=e[D];D<F;D++,G=e[D])B[D]=new b.FPoint2(f[h].X+G.X,f[h].Y+G.Y);r.push(B)}else for(h=0;h<q;h++){B=Array(m);D=0;F=e.length;for(G=e[D];D<F;D++,G=e[D])B[D]=new b.FPoint2(f[h].X-G.X,f[h].Y-G.Y);r.push(B)}e=[];for(h=0;h<q-1+g;h++)for(D=0;D<m;D++)f=[],f.push(r[h%q][D%
m]),f.push(r[(h+1)%q][D%m]),f.push(r[(h+1)%q][(D+1)%m]),f.push(r[h%q][(D+1)%m]),b.Clipper.Orientation(f)||f.reverse(),e.push(f);return e};b.Clipper.MinkowskiSum=function(e,f,h){if(f[0]instanceof Array){q=f;f=new b.Paths;r=new b.Clipper;for(var g=0;g<q.length;++g){var m=b.Clipper.Minkowski(e,q[g],!0,h);r.AddPaths(m,b.PolyType.ptSubject,!0);h&&(m=b.Clipper.TranslatePath(q[g],e[0]),r.AddPath(m,b.PolyType.ptClip,!0))}r.Execute(b.ClipType.ctUnion,f,b.PolyFillType.pftNonZero,b.PolyFillType.pftNonZero);
return f}var q=b.Clipper.Minkowski(e,f,!0,h),r=new b.Clipper;r.AddPaths(q,b.PolyType.ptSubject,!0);r.Execute(b.ClipType.ctUnion,q,b.PolyFillType.pftNonZero,b.PolyFillType.pftNonZero);return q};b.Clipper.TranslatePath=function(e,f){for(var h=new b.Path,g=0;g<e.length;g++)h.push(new b.FPoint2(e[g].X+f.X,e[g].Y+f.Y));return h};b.Clipper.MinkowskiDiff=function(e,f){e=b.Clipper.Minkowski(e,f,!1,!0);f=new b.Clipper;f.AddPaths(e,b.PolyType.ptSubject,!0);f.Execute(b.ClipType.ctUnion,e,b.PolyFillType.pftNonZero,
b.PolyFillType.pftNonZero);return e};b.Clipper.PolyTreeToPaths=function(e){var f=[];b.Clipper.AddPolyNodeToPaths(e,b.Clipper.NodeType.ntAny,f);return f};b.Clipper.AddPolyNodeToPaths=function(e,f,h){var g=!0;switch(f){case b.Clipper.NodeType.ntOpen:return;case b.Clipper.NodeType.ntClosed:g=!e.IsOpen}0<e.m_polygon.length&&g&&h.push(e.m_polygon);g=0;e=e.Childs();for(var m=e.length,q=e[g];g<m;g++,q=e[g])b.Clipper.AddPolyNodeToPaths(q,f,h)};b.Clipper.OpenPathsFromPolyTree=function(e){for(var f=new b.Paths,
h=0,g=e.ChildCount();h<g;h++)e.Childs()[h].IsOpen&&f.push(e.Childs()[h].m_polygon);return f};b.Clipper.ClosedPathsFromPolyTree=function(e){var f=new b.Paths;b.Clipper.AddPolyNodeToPaths(e,b.Clipper.NodeType.ntClosed,f);return f};a(b.Clipper,b.ClipperBase);b.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2};b.ClipperOffset=function(e,f){"undefined"===typeof e&&(e=2);"undefined"===typeof f&&(f=b.ClipperOffset.def_arc_tolerance);this.m_destPolys=new b.Paths;this.m_srcPoly=new b.Path;this.m_destPoly=new b.Path;
this.m_normals=[];this.m_StepsPerRad=this.m_miterLim=this.m_cos=this.m_sin=this.m_sinA=this.m_delta=0;this.m_lowest=new b.FPoint0;this.m_polyNodes=new b.PolyNode;this.MiterLimit=e;this.ArcTolerance=f;this.m_lowest.X=-1};b.ClipperOffset.two_pi=6.28318530717959;b.ClipperOffset.def_arc_tolerance=.25;b.ClipperOffset.prototype.Clear=function(){b.Clear(this.m_polyNodes.Childs());this.m_lowest.X=-1};b.ClipperOffset.prototype.AddPath=function(e,f,h){var g=e.length-1;if(!(0>g)){var m=new b.PolyNode;m.m_jointype=
f;m.m_endtype=h;if(h===b.EndType.etClosedLine||h===b.EndType.etClosedPolygon)for(;0<g&&b.FPoint.op_Equality(e[0],e[g]);)g--;m.m_polygon.push(e[0]);var q=0;f=0;for(var r=1;r<=g;r++)b.FPoint.op_Inequality(m.m_polygon[q],e[r])&&(q++,m.m_polygon.push(e[r]),e[r].Y>m.m_polygon[f].Y||e[r].Y===m.m_polygon[f].Y&&e[r].X<m.m_polygon[f].X)&&(f=q);if(!(h===b.EndType.etClosedPolygon&&2>q)&&(this.m_polyNodes.AddChild(m),h===b.EndType.etClosedPolygon))if(0>this.m_lowest.X)this.m_lowest=new b.FPoint2(this.m_polyNodes.ChildCount()-
1,f);else if(e=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y],m.m_polygon[f].Y>e.Y||m.m_polygon[f].Y===e.Y&&m.m_polygon[f].X<e.X)this.m_lowest=new b.FPoint2(this.m_polyNodes.ChildCount()-1,f)}};b.ClipperOffset.prototype.AddPaths=function(e,f,h){for(var g=0,m=e.length;g<m;g++)this.AddPath(e[g],f,h)};b.ClipperOffset.prototype.FixOrientations=function(){if(0<=this.m_lowest.X&&!b.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var e=0;e<this.m_polyNodes.ChildCount();e++){var f=
this.m_polyNodes.Childs()[e];(f.m_endtype===b.EndType.etClosedPolygon||f.m_endtype===b.EndType.etClosedLine&&b.Clipper.Orientation(f.m_polygon))&&f.m_polygon.reverse()}else for(e=0;e<this.m_polyNodes.ChildCount();e++)f=this.m_polyNodes.Childs()[e],f.m_endtype!==b.EndType.etClosedLine||b.Clipper.Orientation(f.m_polygon)||f.m_polygon.reverse()};b.ClipperOffset.GetUnitNormal=function(e,f){var h=f.X-e.X;e=f.Y-e.Y;if(0===h&&0===e)return new b.FPoint2(0,0);f=1/Math.sqrt(h*h+e*e);return new b.FPoint2(e*
f,-(h*f))};b.ClipperOffset.prototype.DoOffset=function(e){this.m_destPolys=[];this.m_delta=e;if(b.ClipperBase.near_zero(e))for(var f=0;f<this.m_polyNodes.ChildCount();f++){var h=this.m_polyNodes.Childs()[f];h.m_endtype===b.EndType.etClosedPolygon&&this.m_destPolys.push(h.m_polygon)}else{this.m_miterLim=2/(this.MiterLimit*this.MiterLimit);var g=3.14159265358979/Math.acos(1-(0>=this.ArcTolerance?b.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(e)*b.ClipperOffset.def_arc_tolerance?Math.abs(e)*
b.ClipperOffset.def_arc_tolerance:this.ArcTolerance)/Math.abs(e));this.m_sin=Math.sin(b.ClipperOffset.two_pi/g);this.m_cos=Math.cos(b.ClipperOffset.two_pi/g);this.m_StepsPerRad=g/b.ClipperOffset.two_pi;0>e&&(this.m_sin=-this.m_sin);for(f=0;f<this.m_polyNodes.ChildCount();f++){h=this.m_polyNodes.Childs()[f];this.m_srcPoly=h.m_polygon;var m=this.m_srcPoly.length;if(!(0===m||0>=e&&(3>m||h.m_endtype!==b.EndType.etClosedPolygon))){this.m_destPoly=[];if(1===m)if(h.m_jointype===b.JoinType.jtRound){h=1;m=
0;for(var q=1;q<=g;q++){this.m_destPoly.push(new b.FPoint2(this.m_srcPoly[0].X+h*e,this.m_srcPoly[0].Y+m*e,this.m_srcPoly[0].Z));var r=h;h=h*this.m_cos-this.m_sin*m;m=r*this.m_sin+m*this.m_cos}}else for(m=h=-1,q=0;4>q;++q)this.m_destPoly.push(new b.FPoint2(this.m_srcPoly[0].X+h*e,this.m_srcPoly[0].Y+m*e,this.m_srcPoly[0].Z)),0>h?h=1:0>m?m=1:h=-1;else{for(q=this.m_normals.length=0;q<m-1;q++)this.m_normals.push(b.ClipperOffset.GetUnitNormal(this.m_srcPoly[q],this.m_srcPoly[q+1]));h.m_endtype===b.EndType.etClosedLine||
h.m_endtype===b.EndType.etClosedPolygon?this.m_normals.push(b.ClipperOffset.GetUnitNormal(this.m_srcPoly[m-1],this.m_srcPoly[0])):this.m_normals.push(new b.FPoint1(this.m_normals[m-2]));if(h.m_endtype===b.EndType.etClosedPolygon)for(r=m-1,q=0;q<m;q++)r=this.OffsetPoint(q,r,h.m_jointype);else if(h.m_endtype===b.EndType.etClosedLine){r=m-1;for(q=0;q<m;q++)r=this.OffsetPoint(q,r,h.m_jointype);this.m_destPolys.push(this.m_destPoly);this.m_destPoly=[];r=this.m_normals[m-1];for(q=m-1;0<q;q--)this.m_normals[q]=
new b.FPoint2(-this.m_normals[q-1].X,-this.m_normals[q-1].Y);this.m_normals[0]=new b.FPoint2(-r.X,-r.Y);r=0;for(q=m-1;0<=q;q--)r=this.OffsetPoint(q,r,h.m_jointype)}else{r=0;for(q=1;q<m-1;++q)r=this.OffsetPoint(q,r,h.m_jointype);h.m_endtype===b.EndType.etOpenButt?(q=m-1,r=new b.FPoint2(this.m_srcPoly[q].X+this.m_normals[q].X*e,this.m_srcPoly[q].Y+this.m_normals[q].Y*e,this.m_srcPoly[q].Z),this.m_destPoly.push(r),r=new b.FPoint2(this.m_srcPoly[q].X-this.m_normals[q].X*e,this.m_srcPoly[q].Y-this.m_normals[q].Y*
e,this.m_srcPoly[q].Z),this.m_destPoly.push(r)):(q=m-1,r=m-2,this.m_sinA=0,this.m_normals[q]=new b.FPoint2(-this.m_normals[q].X,-this.m_normals[q].Y),h.m_endtype===b.EndType.etOpenSquare?this.DoSquare(q,r):this.DoRound(q,r));for(q=m-1;0<q;q--)this.m_normals[q]=new b.FPoint2(-this.m_normals[q-1].X,-this.m_normals[q-1].Y);this.m_normals[0]=new b.FPoint2(-this.m_normals[1].X,-this.m_normals[1].Y);r=m-1;for(q=r-1;0<q;--q)r=this.OffsetPoint(q,r,h.m_jointype);h.m_endtype===b.EndType.etOpenButt?(r=new b.FPoint2(this.m_srcPoly[0].X-
this.m_normals[0].X*e,this.m_srcPoly[0].Y-this.m_normals[0].Y*e,this.m_srcPoly[0].Z),this.m_destPoly.push(r),r=new b.FPoint2(this.m_srcPoly[0].X+this.m_normals[0].X*e,this.m_srcPoly[0].Y+this.m_normals[0].Y*e,this.m_srcPoly[0].Z),this.m_destPoly.push(r)):(this.m_sinA=0,h.m_endtype===b.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1))}}this.m_destPolys.push(this.m_destPoly)}}}};b.ClipperOffset.prototype.Execute=function(){var e=arguments;if(e[0]instanceof b.PolyTree)if(f=e[0],h=e[1],f.Clear(),
this.FixOrientations(),this.DoOffset(h),e=new b.Clipper(0),e.AddPaths(this.m_destPolys,b.PolyType.ptSubject,!0),0<h)e.Execute(b.ClipType.ctUnion,f,b.PolyFillType.pftPositive,b.PolyFillType.pftPositive);else if(h=b.Clipper.GetBounds(this.m_destPolys),g=new b.Path,g.push(new b.FPoint2(h.left-10,h.bottom+10)),g.push(new b.FPoint2(h.right+10,h.bottom+10)),g.push(new b.FPoint2(h.right+10,h.top-10)),g.push(new b.FPoint2(h.left-10,h.top-10)),e.AddPath(g,b.PolyType.ptSubject,!0),e.ReverseSolution=!0,e.Execute(b.ClipType.ctUnion,
f,b.PolyFillType.pftNegative,b.PolyFillType.pftNegative),1===f.ChildCount()&&0<f.Childs()[0].ChildCount())for(e=f.Childs()[0],f.Childs()[0]=e.Childs()[0],f.Childs()[0].m_Parent=f,h=1;h<e.ChildCount();h++)f.AddChild(e.Childs()[h]);else f.Clear();else{var f=e[0],h=e[1];b.Clear(f);this.FixOrientations();this.DoOffset(h);e=new b.Clipper(0);e.ZFillFunction=this.ZFillFunction;e.AddPaths(this.m_destPolys,b.PolyType.ptSubject,!0);if(0<h)e.Execute(b.ClipType.ctUnion,f,b.PolyFillType.pftPositive,b.PolyFillType.pftPositive);
else{h=b.Clipper.GetBounds(this.m_destPolys);var g=new b.Path;g.push(new b.FPoint2(h.left-10,h.bottom+10));g.push(new b.FPoint2(h.right+10,h.bottom+10));g.push(new b.FPoint2(h.right+10,h.top-10));g.push(new b.FPoint2(h.left-10,h.top-10));e.AddPath(g,b.PolyType.ptSubject,!0);e.ReverseSolution=!0;e.Execute(b.ClipType.ctUnion,f,b.PolyFillType.pftNegative,b.PolyFillType.pftNegative);0<f.length&&f.splice(0,1)}}};b.ClipperOffset.prototype.OffsetPoint=function(e,f,h){this.m_sinA=this.m_normals[f].X*this.m_normals[e].Y-
this.m_normals[e].X*this.m_normals[f].Y;if(0===this.m_sinA)return f;1<this.m_sinA?this.m_sinA=1:-1>this.m_sinA&&(this.m_sinA=-1);if(0>this.m_sinA*this.m_delta)this.m_destPoly.push(new b.FPoint2(this.m_srcPoly[e].X+this.m_normals[f].X*this.m_delta,this.m_srcPoly[e].Y+this.m_normals[f].Y*this.m_delta,this.m_srcPoly[e].Z)),this.m_destPoly.push(new b.FPoint1(this.m_srcPoly[e])),this.m_destPoly.push(new b.FPoint2(this.m_srcPoly[e].X+this.m_normals[e].X*this.m_delta,this.m_srcPoly[e].Y+this.m_normals[e].Y*
this.m_delta,this.m_srcPoly[e].Z));else switch(h){case b.JoinType.jtMiter:case b.JoinType.jtMiterAlways:var g=1+(this.m_normals[e].X*this.m_normals[f].X+this.m_normals[e].Y*this.m_normals[f].Y);g>=this.m_miterLim||h===b.JoinType.jtMiterAlways?this.DoMiter(e,f,g):this.DoSquare(e,f);break;case b.JoinType.jtSquare:this.DoSquare(e,f);break;case b.JoinType.jtRound:this.DoRound(e,f)}return e};b.ClipperOffset.prototype.DoSquare=function(e,f){var h=Math.tan(Math.atan2(this.m_sinA,this.m_normals[f].X*this.m_normals[e].X+
this.m_normals[f].Y*this.m_normals[e].Y)/4);this.m_destPoly.push(new b.FPoint2(this.m_srcPoly[e].X+this.m_delta*(this.m_normals[f].X-this.m_normals[f].Y*h),this.m_srcPoly[e].Y+this.m_delta*(this.m_normals[f].Y+this.m_normals[f].X*h),this.m_srcPoly[e].Z));this.m_destPoly.push(new b.FPoint2(this.m_srcPoly[e].X+this.m_delta*(this.m_normals[e].X+this.m_normals[e].Y*h),this.m_srcPoly[e].Y+this.m_delta*(this.m_normals[e].Y-this.m_normals[e].X*h),this.m_srcPoly[e].Z))};b.ClipperOffset.prototype.DoMiter=
function(e,f,h){h=this.m_delta/h;this.m_destPoly.push(new b.FPoint2(this.m_srcPoly[e].X+(this.m_normals[f].X+this.m_normals[e].X)*h,this.m_srcPoly[e].Y+(this.m_normals[f].Y+this.m_normals[e].Y)*h,this.m_srcPoly[e].Z))};b.ClipperOffset.prototype.DoRound=function(e,f){var h=Math.max(Math.round(this.m_StepsPerRad*Math.abs(Math.atan2(this.m_sinA,this.m_normals[f].X*this.m_normals[e].X+this.m_normals[f].Y*this.m_normals[e].Y))),1),g=this.m_normals[f].X;f=this.m_normals[f].Y;for(var m,q=0;q<h;++q)this.m_destPoly.push(new b.FPoint2(this.m_srcPoly[e].X+
g*this.m_delta,this.m_srcPoly[e].Y+f*this.m_delta,this.m_srcPoly[e].Z)),m=g,g=g*this.m_cos-this.m_sin*f,f=m*this.m_sin+f*this.m_cos;this.m_destPoly.push(new b.FPoint2(this.m_srcPoly[e].X+this.m_normals[e].X*this.m_delta,this.m_srcPoly[e].Y+this.m_normals[e].Y*this.m_delta,this.m_srcPoly[e].Z))};b.Error=function(e){throw Error(e);};b.JS={};b.JS.AreaOfPolygon=function(e){return b.Clipper.Area(e)};b.JS.AreaOfPolygons=function(e){for(var f=0,h=0;h<e.length;h++)f+=b.Clipper.Area(e[h]);return f};b.JS.BoundsOfPath=
function(e){return b.JS.BoundsOfPaths([e])};b.JS.BoundsOfPaths=function(e){return b.Clipper.GetBounds(e)};b.JS.Clean=function(e,f){if(!(e instanceof Array))return[];var h=e[0]instanceof Array;e=b.JS.Clone(e);if("number"!==typeof f||null===f)return b.Error("Delta is not a number in Clean()."),e;if(0===e.length||1===e.length&&0===e[0].length||0>f)return e;h||(e=[e]);for(var g=e.length,m,q,r,B,D,F,G,N=[],T=0;T<g;T++)if(q=e[T],m=q.length,0!==m)if(3>m)r=q,N.push(r);else{r=q;B=f*f;D=q[0];for(G=F=1;G<m;G++)(q[G].X-
D.X)*(q[G].X-D.X)+(q[G].Y-D.Y)*(q[G].Y-D.Y)<=B||(r[F]=q[G],D=q[G],F++);D=q[F-1];(q[0].X-D.X)*(q[0].X-D.X)+(q[0].Y-D.Y)*(q[0].Y-D.Y)<=B&&F--;F<m&&r.splice(F,m-F);r.length&&N.push(r)}!h&&N.length?N=N[0]:h||0!==N.length?h&&0===N.length&&(N=[[]]):N=[];return N};b.JS.Clone=function(e){if(!(e instanceof Array)||0===e.length)return[];if(1===e.length&&0===e[0].length)return[[]];var f=e[0]instanceof Array;f||(e=[e]);var h=e.length,g,m,q=Array(h);for(g=0;g<h;g++){var r=e[g].length;var B=Array(r);for(m=0;m<
r;m++)B[m]={X:e[g][m].X,Y:e[g][m].Y,Z:e[g][m].Z};q[g]=B}f||(q=q[0]);return q};b.JS.Lighten=function(e,f){if(!(e instanceof Array))return[];if("number"!==typeof f||null===f)return b.Error("Tolerance is not a number in Lighten()."),b.JS.Clone(e);if(0===e.length||1===e.length&&0===e[0].length||0>f)return b.JS.Clone(e);var h=e[0]instanceof Array;h||(e=[e]);var g,m,q=e.length,r=f*f,B=[];for(f=0;f<q;f++){var D=e[f];var F=D.length;if(0!==F){for(m=0;1E6>m;m++){var G=[];F=D.length;if(D[F-1].X!==D[0].X||D[F-
1].Y!==D[0].Y){var N=1;D.push({X:D[0].X,Y:D[0].Y,Z:D[0].Z});F=D.length}else N=0;var T=[];for(g=0;g<F-2;g++){var V=D[g];var E=D[g+1];var Q=D[g+2];var aa=V.X;var qa=V.Y;V=Q.X-aa;var P=Q.Y-qa;if(0!==V||0!==P){var ea=((E.X-aa)*V+(E.Y-qa)*P)/(V*V+P*P);1<ea?(aa=Q.X,qa=Q.Y):0<ea&&(aa+=V*ea,qa+=P*ea)}V=E.X-aa;P=E.Y-qa;Q=V*V+P*P;Q<=r&&(T[g+1]=1,g++)}G.push({X:D[0].X,Y:D[0].Y,Z:D[0].Z});for(g=1;g<F-1;g++)T[g]||G.push({X:D[g].X,Y:D[g].Y,Z:D[g].Z});G.push({X:D[F-1].X,Y:D[F-1].Y,Z:D[F-1].Z});N&&D.pop();if(T.length)D=
G;else break}F=G.length;G[F-1].X===G[0].X&&G[F-1].Y===G[0].Y&&G.pop();2<G.length&&B.push(G)}}h||(B=B[0]);"undefined"===typeof B&&(B=[]);return B};b.JS.PerimeterOfPath=function(e,f){if("undefined"===typeof e)return 0;var h=Math.sqrt,g=0,m=e.length;if(2>m)return 0;f&&(e[m]=e[0],m++);for(;--m;){var q=e[m];var r=q.X;q=q.Y;var B=e[m-1];var D=B.X;B=B.Y;g+=h((r-D)*(r-D)+(q-B)*(q-B))}f&&e.pop();return g};b.JS.PerimeterOfPaths=function(e,f){for(var h=0,g=0;g<e.length;g++)h+=b.JS.PerimeterOfPath(e[g],f);return h};
b.ExPolygons=function(){return[]};b.ExPolygon=function(){this.holes=this.outer=null};b.JS.AddOuterPolyNodeToExPolygons=function(e,f){var h=new b.ExPolygon;h.outer=e.Contour();e=e.Childs();var g=e.length;h.holes=Array(g);var m,q;for(m=0;m<g;m++){var r=e[m];h.holes[m]=r.Contour();var B=0;var D=r.Childs();for(q=D.length;B<q;B++)r=D[B],b.JS.AddOuterPolyNodeToExPolygons(r,f)}f.push(h)};b.JS.ExPolygonsToPaths=function(e){var f,h,g=new b.Paths;var m=0;for(f=e.length;m<f;m++){g.push(e[m].outer);var q=0;for(h=
e[m].holes.length;q<h;q++)g.push(e[m].holes[q])}return g};b.JS.PolyTreeToExPolygons=function(e){var f=new b.ExPolygons,h;var g=0;var m=e.Childs();for(h=m.length;g<h;g++)e=m[g],b.JS.AddOuterPolyNodeToExPolygons(e,f);return f}})();
(function(){var a=function(){return this}();a||"undefined"==typeof window||(a=window);if("undefined"===typeof requirejs){var b=function(g,m,q){"string"!==typeof g?b.original?b.original.apply(this,arguments):(console.error("dropping module because define wasn't a string."),console.trace()):(2==arguments.length&&(q=m),b.modules[g]||(b.payloads[g]=q,b.modules[g]=null))};b.modules={};b.payloads={};var l=function(g,m,q){if("string"===typeof m){if(g=h(g,m),void 0!=g)return q&&q(),g}else if("[object Array]"===
Object.prototype.toString.call(m)){for(var r=[],B=0,D=m.length;B<D;++B){var F=h(g,m[B]);if(void 0==F&&e.original)return;r.push(F)}return q&&q.apply(null,r)||!0}},e=function(g,m){var q=l("",g,m);return void 0==q&&e.original?e.original.apply(this,arguments):q},f=function(g,m){if(-1!==m.indexOf("!"))return m=m.split("!"),f(g,m[0])+"!"+f(g,m[1]);if("."==m.charAt(0))for(m=g.split("/").slice(0,-1).join("/")+"/"+m;-1!==m.indexOf(".")&&q!=m;){var q=m;m=m.replace(/\/\.\//,"/").replace(/[^\/]+\/\.\.\//,"")}return m},
h=function(g,m){m=f(g,m);g=b.modules[m];if(!g){g=b.payloads[m];if("function"===typeof g){var q={},r={id:m,uri:"",exports:q,packaged:!0};q=g(function(B,D){return l(m,B,D)},q,r)||r.exports;b.modules[m]=q;delete b.payloads[m]}g=b.modules[m]=q||g}return g};(function(g){var m=a;g&&(a[g]||(a[g]={}),m=a[g]);m.define&&m.define.packaged||(b.original=m.define,m.define=b,m.define.packaged=!0);m.require&&m.require.packaged||(e.original=m.require,m.require=e,m.require.packaged=!0)})("")}})();
define("ace/lib/regexp",["require","exports","module"],function(){function a(g,m,q){if(Array.prototype.indexOf)return g.indexOf(m,q);for(q=q||0;q<g.length;q++)if(g[q]===m)return q;return-1}var b=RegExp.prototype.exec,l=RegExp.prototype.test,e=String.prototype.replace,f=void 0===b.call(/()??/,"")[1],h=function(){var g=/^/g;l.call(g,"");return!g.lastIndex}();h&&f||(RegExp.prototype.exec=function(g){var m=b.apply(this,arguments);if("string"==typeof g&&m){if(!f&&1<m.length&&-1<a(m,"")){var q=RegExp(this.source,
e.call((this.global?"g":"")+(this.ignoreCase?"i":"")+(this.multiline?"m":"")+(this.extended?"x":"")+(this.sticky?"y":""),"g",""));e.call(g.slice(m.index),q,function(){for(var B=1;B<arguments.length-2;B++)void 0===arguments[B]&&(m[B]=void 0)})}if(this._xregexp&&this._xregexp.captureNames)for(var r=1;r<m.length;r++)(q=this._xregexp.captureNames[r-1])&&(m[q]=m[r]);!h&&this.global&&!m[0].length&&this.lastIndex>m.index&&this.lastIndex--}return m},h||(RegExp.prototype.test=function(g){(g=b.call(this,g))&&
this.global&&!g[0].length&&this.lastIndex>g.index&&this.lastIndex--;return!!g}))});
define("ace/lib/es5-shim",["require","exports","module"],function(){function a(pa){if(null==pa)throw new TypeError("can't convert "+pa+" to object");return Object(pa)}function b(){}function l(pa){try{return Object.defineProperty(pa,"sentinel",{}),"sentinel"in pa}catch(ra){}}function e(pa){pa=+pa;pa!==pa?pa=0:0!==pa&&pa!==1/0&&pa!==-(1/0)&&(pa=(0<pa||-1)*Math.floor(Math.abs(pa)));return pa}Function.prototype.bind||(Function.prototype.bind=function(pa){function ra(){if(this instanceof ra){var Aa=Ca.apply(this,
Ga.concat(g.call(arguments)));return Object(Aa)===Aa?Aa:this}return Ca.apply(pa,Ga.concat(g.call(arguments)))}var Ca=this;if("function"!=typeof Ca)throw new TypeError("Function.prototype.bind called on incompatible "+Ca);var Ga=g.call(arguments,1);Ca.prototype&&(b.prototype=Ca.prototype,ra.prototype=new b,b.prototype=null);return ra});var f=Function.prototype.call,h=Object.prototype,g=Array.prototype.slice,m=f.bind(h.toString),q=f.bind(h.hasOwnProperty),r;if(r=q(h,"__defineGetter__")){var B=f.bind(h.__defineGetter__);
var D=f.bind(h.__defineSetter__);var F=f.bind(h.__lookupGetter__);var G=f.bind(h.__lookupSetter__)}if(2!=[1,2].splice(0).length)if(function(){function pa(Ga){Ga=Array(Ga+2);Ga[0]=Ga[1]=0;return Ga}var ra=[];ra.splice.apply(ra,pa(20));ra.splice.apply(ra,pa(26));var Ca=ra.length;ra.splice(5,0,"XXX");Ca+1==ra.length;if(Ca+1==ra.length)return!0}()){var N=Array.prototype.splice;Array.prototype.splice=function(pa,ra){return arguments.length?N.apply(this,[void 0===pa?0:pa,void 0===ra?this.length-pa:ra].concat(g.call(arguments,
2))):[]}}else Array.prototype.splice=function(pa,ra){var Ca=this.length;0<pa?pa>Ca&&(pa=Ca):void 0==pa?pa=0:0>pa&&(pa=Math.max(Ca+pa,0));pa+ra<Ca||(ra=Ca-pa);var Ga=this.slice(pa,pa+ra),Aa=g.call(arguments,2),xa=Aa.length;if(pa===Ca)xa&&this.push.apply(this,Aa);else{var za=Math.min(ra,Ca-pa),Na=pa+za,ya=Na+xa-za,Ia=Ca-Na;Ca-=za;if(ya<Na)for(za=0;za<Ia;++za)this[ya+za]=this[Na+za];else if(ya>Na)for(za=Ia;za--;)this[ya+za]=this[Na+za];if(xa&&pa===Ca)this.length=Ca,this.push.apply(this,Aa);else for(this.length=
Ca+xa,za=0;za<xa;++za)this[pa+za]=Aa[za]}return Ga};Array.isArray||(Array.isArray=function(pa){return"[object Array]"==m(pa)});f=Object("a");var T="a"!=f[0]||!(0 in f);Array.prototype.forEach||(Array.prototype.forEach=function(pa,ra){var Ca=a(this),Ga=T&&"[object String]"==m(this)?this.split(""):Ca,Aa=-1,xa=Ga.length>>>0;if("[object Function]"!=m(pa))throw new TypeError;for(;++Aa<xa;)Aa in Ga&&pa.call(ra,Ga[Aa],Aa,Ca)});Array.prototype.map||(Array.prototype.map=function(pa,ra){var Ca=a(this),Ga=T&&
"[object String]"==m(this)?this.split(""):Ca,Aa=Ga.length>>>0,xa=Array(Aa);if("[object Function]"!=m(pa))throw new TypeError(pa+" is not a function");for(var za=0;za<Aa;za++)za in Ga&&(xa[za]=pa.call(ra,Ga[za],za,Ca));return xa});Array.prototype.filter||(Array.prototype.filter=function(pa,ra){var Ca=a(this),Ga=T&&"[object String]"==m(this)?this.split(""):Ca,Aa=Ga.length>>>0,xa=[];if("[object Function]"!=m(pa))throw new TypeError(pa+" is not a function");for(var za=0;za<Aa;za++)if(za in Ga){var Na=
Ga[za];pa.call(ra,Na,za,Ca)&&xa.push(Na)}return xa});Array.prototype.every||(Array.prototype.every=function(pa,ra){var Ca=a(this),Ga=T&&"[object String]"==m(this)?this.split(""):Ca,Aa=Ga.length>>>0;if("[object Function]"!=m(pa))throw new TypeError(pa+" is not a function");for(var xa=0;xa<Aa;xa++)if(xa in Ga&&!pa.call(ra,Ga[xa],xa,Ca))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(pa,ra){var Ca=a(this),Ga=T&&"[object String]"==m(this)?this.split(""):Ca,Aa=Ga.length>>>0;if("[object Function]"!=
m(pa))throw new TypeError(pa+" is not a function");for(var xa=0;xa<Aa;xa++)if(xa in Ga&&pa.call(ra,Ga[xa],xa,Ca))return!0;return!1});Array.prototype.reduce||(Array.prototype.reduce=function(pa){var ra=a(this),Ca=T&&"[object String]"==m(this)?this.split(""):ra,Ga=Ca.length>>>0;if("[object Function]"!=m(pa))throw new TypeError(pa+" is not a function");if(!Ga&&1==arguments.length)throw new TypeError("reduce of empty array with no initial value");var Aa=0;if(2<=arguments.length)var xa=arguments[1];else{do{if(Aa in
Ca){xa=Ca[Aa++];break}if(++Aa>=Ga)throw new TypeError("reduce of empty array with no initial value");}while(1)}for(;Aa<Ga;Aa++)Aa in Ca&&(xa=pa.call(void 0,xa,Ca[Aa],Aa,ra));return xa});Array.prototype.reduceRight||(Array.prototype.reduceRight=function(pa){var ra=a(this),Ca=T&&"[object String]"==m(this)?this.split(""):ra,Ga=Ca.length>>>0;if("[object Function]"!=m(pa))throw new TypeError(pa+" is not a function");if(!Ga&&1==arguments.length)throw new TypeError("reduceRight of empty array with no initial value");
--Ga;if(2<=arguments.length)var Aa=arguments[1];else{do{if(Ga in Ca){Aa=Ca[Ga--];break}if(0>--Ga)throw new TypeError("reduceRight of empty array with no initial value");}while(1)}do Ga in this&&(Aa=pa.call(void 0,Aa,Ca[Ga],Ga,ra));while(Ga--);return Aa});Array.prototype.indexOf&&-1==[0,1].indexOf(1,2)||(Array.prototype.indexOf=function(pa){var ra=T&&"[object String]"==m(this)?this.split(""):a(this),Ca=ra.length>>>0;if(!Ca)return-1;var Ga=0;1<arguments.length&&(Ga=e(arguments[1]));for(Ga=0<=Ga?Ga:
Math.max(0,Ca+Ga);Ga<Ca;Ga++)if(Ga in ra&&ra[Ga]===pa)return Ga;return-1});Array.prototype.lastIndexOf&&-1==[0,1].lastIndexOf(0,-3)||(Array.prototype.lastIndexOf=function(pa){var ra=T&&"[object String]"==m(this)?this.split(""):a(this),Ca=ra.length>>>0;if(!Ca)return-1;var Ga=Ca-1;1<arguments.length&&(Ga=Math.min(Ga,e(arguments[1])));for(Ga=0<=Ga?Ga:Ca-Math.abs(Ga);0<=Ga;Ga--)if(Ga in ra&&pa===ra[Ga])return Ga;return-1});Object.getPrototypeOf||(Object.getPrototypeOf=function(pa){return pa.__proto__||
(pa.constructor?pa.constructor.prototype:h)});Object.getOwnPropertyDescriptor||(Object.getOwnPropertyDescriptor=function(pa,ra){if("object"!=typeof pa&&"function"!=typeof pa||null===pa)throw new TypeError("Object.getOwnPropertyDescriptor called on a non-object: "+pa);if(q(pa,ra)){var Ca={enumerable:!0,configurable:!0};if(r){var Ga=pa.__proto__;pa.__proto__=h;var Aa=F(pa,ra);var xa=G(pa,ra);pa.__proto__=Ga;if(Aa||xa)return Aa&&(Ca.get=Aa),xa&&(Ca.set=xa),Ca}Ca.value=pa[ra];return Ca}});Object.getOwnPropertyNames||
(Object.getOwnPropertyNames=function(pa){return Object.keys(pa)});if(!Object.create){var V=null===Object.prototype.__proto__?function(){return{__proto__:null}}:function(){var pa={},ra;for(ra in pa)pa[ra]=null;pa.constructor=pa.hasOwnProperty=pa.propertyIsEnumerable=pa.isPrototypeOf=pa.toLocaleString=pa.toString=pa.valueOf=pa.__proto__=null;return pa};Object.create=function(pa,ra){if(null===pa)var Ca=V();else{if("object"!=typeof pa)throw new TypeError("typeof prototype["+typeof pa+"] != 'object'");
Ca=function(){};Ca.prototype=pa;Ca=new Ca;Ca.__proto__=pa}void 0!==ra&&Object.defineProperties(Ca,ra);return Ca}}if(Object.defineProperty){f=l({});var E="undefined"==typeof document||l(document.createElement("div"));if(!f||!E)var Q=Object.defineProperty}if(!Object.defineProperty||Q)Object.defineProperty=function(pa,ra,Ca){if("object"!=typeof pa&&"function"!=typeof pa||null===pa)throw new TypeError("Object.defineProperty called on non-object: "+pa);if("object"!=typeof Ca&&"function"!=typeof Ca||null===
Ca)throw new TypeError("Property description must be an object: "+Ca);if(Q)try{return Q.call(Object,pa,ra,Ca)}catch(Aa){}if(q(Ca,"value"))if(r&&(F(pa,ra)||G(pa,ra))){var Ga=pa.__proto__;pa.__proto__=h;delete pa[ra];pa[ra]=Ca.value;pa.__proto__=Ga}else pa[ra]=Ca.value;else{if(!r)throw new TypeError("getters & setters can not be defined on this javascript engine");q(Ca,"get")&&B(pa,ra,Ca.get);q(Ca,"set")&&D(pa,ra,Ca.set)}return pa};Object.defineProperties||(Object.defineProperties=function(pa,ra){for(var Ca in ra)q(ra,
Ca)&&Object.defineProperty(pa,Ca,ra[Ca]);return pa});Object.seal||(Object.seal=function(pa){return pa});Object.freeze||(Object.freeze=function(pa){return pa});try{Object.freeze(function(){})}catch(pa){Object.freeze=function(ra){return function(Ca){return"function"==typeof Ca?Ca:ra(Ca)}}(Object.freeze)}Object.preventExtensions||(Object.preventExtensions=function(pa){return pa});Object.isSealed||(Object.isSealed=function(){return!1});Object.isFrozen||(Object.isFrozen=function(){return!1});Object.isExtensible||
(Object.isExtensible=function(pa){if(Object(pa)===pa)throw new TypeError;for(var ra="";q(pa,ra);)ra+="?";pa[ra]=!0;var Ca=q(pa,ra);delete pa[ra];return Ca});if(!Object.keys){var aa=!0,qa="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),P=qa.length,ea;for(ea in{toString:null})aa=!1;Object.keys=function(pa){if("object"!=typeof pa&&"function"!=typeof pa||null===pa)throw new TypeError("Object.keys called on a non-object");var ra=[],Ca;for(Ca in pa)q(pa,
Ca)&&ra.push(Ca);if(aa)for(Ca=0;Ca<P;Ca++){var Ga=qa[Ca];q(pa,Ga)&&ra.push(Ga)}return ra}}Date.now||(Date.now=function(){return(new Date).getTime()});if(!String.prototype.trim){var ua=RegExp("^[\t\n\v\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\v\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*"),Fa=RegExp("[\t\n\v\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\v\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$");
String.prototype.trim=function(){return String(this).replace(ua,"").replace(Fa,"")}}});define("ace/lib/fixoldbrowsers",["require","exports","module","ace/lib/regexp","ace/lib/es5-shim"],function(a){a("./regexp");a("./es5-shim");"undefined"==typeof Element||Element.prototype.remove||Object.defineProperty(Element.prototype,"remove",{enumerable:!1,writable:!0,configurable:!0,value:function(){this.parentNode&&this.parentNode.removeChild(this)}})});
define("ace/lib/useragent",["require","exports","module"],function(a,b){b.OS={LINUX:"LINUX",MAC:"MAC",WINDOWS:"WINDOWS"};b.getOS=function(){return b.isMac?b.OS.MAC:b.isLinux?b.OS.LINUX:b.OS.WINDOWS};var l="object"==typeof navigator?navigator:{};a=(/mac|win|linux/i.exec(l.platform)||["other"])[0].toLowerCase();var e=l.userAgent||"";l=l.appName||"";b.isWin="win"==a;b.isMac="mac"==a;b.isLinux="linux"==a;b.isIE="Microsoft Internet Explorer"==l||0<=l.indexOf("MSAppHost")?parseFloat((e.match(/(?:MSIE |Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||
[])[1]):parseFloat((e.match(/(?:Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||[])[1]);b.isOldIE=b.isIE&&9>b.isIE;b.isGecko=b.isMozilla=e.match(/ Gecko\/\d+/);b.isOpera="object"==typeof opera&&"[object Opera]"==Object.prototype.toString.call(window.opera);b.isWebKit=parseFloat(e.split("WebKit/")[1])||void 0;b.isChrome=parseFloat(e.split(" Chrome/")[1])||void 0;b.isEdge=parseFloat(e.split(" Edge/")[1])||void 0;b.isAIR=0<=e.indexOf("AdobeAIR");b.isAndroid=0<=e.indexOf("Android");b.isChromeOS=0<=
e.indexOf(" CrOS ");b.isIOS=/iPad|iPhone|iPod/.test(e)&&!window.MSStream;b.isIOS&&(b.isMac=!0);b.isMobile=b.isIOS||b.isAndroid});
define("ace/lib/dom",["require","exports","module","ace/lib/useragent"],function(a,b){a=a("./useragent");b.buildDom=function m(f,h,g){if("string"==typeof f&&f)return f=document.createTextNode(f),h&&h.appendChild(f),f;if(!Array.isArray(f))return f&&f.appendChild&&h&&h.appendChild(f),f;if("string"!=typeof f[0]||!f[0]){for(var q=[],r=0;r<f.length;r++){var B=m(f[r],h,g);B&&q.push(B)}return q}var D=document.createElement(f[0]),F=f[1];q=1;F&&"object"==typeof F&&!Array.isArray(F)&&(q=2);for(r=q;r<f.length;r++)m(f[r],
D,g);2==q&&Object.keys(F).forEach(function(G){var N=F[G];"class"===G?D.className=Array.isArray(N)?N.join(" "):N:"function"==typeof N||"value"==G||"$"==G[0]?D[G]=N:"ref"===G?g&&(g[N]=D):null!=N&&D.setAttribute(G,N)});h&&h.appendChild(D);return D};b.getDocumentHead=function(f){f||=document;return f.head||f.getElementsByTagName("head")[0]||f.documentElement};b.createElement=function(f,h){return document.createElementNS?document.createElementNS(h||"http://www.w3.org/1999/xhtml",f):document.createElement(f)};
b.removeChildren=function(f){f.innerHTML=""};b.createTextNode=function(f,h){return(h?h.ownerDocument:document).createTextNode(f)};b.createFragment=function(f){return(f?f.ownerDocument:document).createDocumentFragment()};b.hasCssClass=function(f,h){return-1!==(f.className+"").split(/\s+/g).indexOf(h)};b.addCssClass=function(f,h){b.hasCssClass(f,h)||(f.className+=" "+h)};b.removeCssClass=function(f,h){for(var g=f.className.split(/\s+/g);;){var m=g.indexOf(h);if(-1==m)break;g.splice(m,1)}f.className=
g.join(" ")};b.toggleCssClass=function(f,h){for(var g=f.className.split(/\s+/g),m=!0;;){var q=g.indexOf(h);if(-1==q)break;m=!1;g.splice(q,1)}m&&g.push(h);f.className=g.join(" ");return m};b.setCssClass=function(f,h,g){g?b.addCssClass(f,h):b.removeCssClass(f,h)};b.hasCssString=function(f,h){var g=0;h=h||document;if(h=h.querySelectorAll("style"))for(;g<h.length;)if(h[g++].id===f)return!0};b.importCssString=function(f,h,g){var m;g&&g.getRootNode?(m=g.getRootNode())&&m!=g||(m=document):m=document;g=m.ownerDocument||
m;if(h&&b.hasCssString(h,m))return null;h&&(f+="\n/*# sourceURL=ace/css/"+h+" */");var q=b.createElement("style");q.appendChild(g.createTextNode(f));h&&(q.id=h);m==g&&(m=b.getDocumentHead(g));m.insertBefore(q,m.firstChild)};b.importCssStylsheet=function(f,h){b.buildDom(["link",{rel:"stylesheet",href:f}],b.getDocumentHead(h))};b.scrollbarWidth=function(f){var h=b.createElement("ace_inner");h.style.width="100%";h.style.minWidth="0px";h.style.height="200px";h.style.display="block";var g=b.createElement("ace_outer"),
m=g.style;m.position="absolute";m.left="-10000px";m.overflow="hidden";m.width="200px";m.minWidth="0px";m.height="150px";m.display="block";g.appendChild(h);f=f.documentElement;f.appendChild(g);var q=h.offsetWidth;m.overflow="scroll";h=h.offsetWidth;q==h&&(h=g.clientWidth);f.removeChild(g);return q-h};"undefined"==typeof document&&(b.importCssString=function(){});b.computedStyle=function(f){return window.getComputedStyle(f,"")||{}};b.setStyle=function(f,h,g){f[h]!==g&&(f[h]=g)};b.HAS_CSS_ANIMATION=
!1;b.HAS_CSS_TRANSFORMS=!1;b.HI_DPI=a.isWin?"undefined"!==typeof window&&1.5<=window.devicePixelRatio:!0;if("undefined"!==typeof document){var l=document.createElement("div");b.HI_DPI&&void 0!==l.style.transform&&(b.HAS_CSS_TRANSFORMS=!0);a.isEdge||"undefined"===typeof l.style.animationName||(b.HAS_CSS_ANIMATION=!0);l=null}b.translate=b.HAS_CSS_TRANSFORMS?function(f,h,g){f.style.transform="translate("+Math.round(h)+"px, "+Math.round(g)+"px)"}:function(f,h,g){f.style.top=Math.round(g)+"px";f.style.left=
Math.round(h)+"px"}});define("ace/lib/oop",["require","exports","module"],function(a,b){b.inherits=function(l,e){l.super_=e;l.prototype=Object.create(e.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}})};b.mixin=function(l,e){for(var f in e)l[f]=e[f];return l};b.implement=function(l,e){b.mixin(l,e)}});
define("ace/lib/keys",["require","exports","module","ace/lib/oop"],function(a,b){var l=a("./oop"),e=function(){var f={MODIFIER_KEYS:{16:"Shift",17:"Ctrl",18:"Alt",224:"Meta",91:"MetaLeft",92:"MetaRight",93:"ContextMenu"},KEY_MODS:{ctrl:1,alt:2,option:2,shift:4,"super":8,meta:8,command:8,cmd:8,control:1},FUNCTION_KEYS:{8:"Backspace",9:"Tab",13:"Return",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"Print",45:"Insert",46:"Delete",
96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9","-13":"NumpadEnter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Numlock",145:"Scrolllock"},PRINTABLE_KEYS:{32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",
79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",111:"/",106:"*"}},h;for(h in f.FUNCTION_KEYS){var g=f.FUNCTION_KEYS[h].toLowerCase();f[g]=parseInt(h,10)}for(h in f.PRINTABLE_KEYS)g=f.PRINTABLE_KEYS[h].toLowerCase(),f[g]=parseInt(h,10);l.mixin(f,f.MODIFIER_KEYS);l.mixin(f,f.PRINTABLE_KEYS);l.mixin(f,f.FUNCTION_KEYS);f.enter=f["return"];f.escape=f.esc;
f.del=f["delete"];f[173]="-";(function(){for(var m=["cmd","ctrl","alt","shift"],q=Math.pow(2,m.length);q--;)f.KEY_MODS[q]=m.filter(function(r){return q&f.KEY_MODS[r]}).join("-")+"-"})();f.KEY_MODS[0]="";f.KEY_MODS[-1]="input-";return f}();l.mixin(b,e);b.keyCodeToString=function(f){var h=e[f];"string"!=typeof h&&(h=String.fromCharCode(f));return h.toLowerCase()}});
define("ace/lib/event",["require","exports","module","ace/lib/keys","ace/lib/useragent"],function(a,b){function l(V){return 0|(V.ctrlKey?1:0)|(V.altKey?2:0)|(V.shiftKey?4:0)|(V.metaKey?8:0)}function e(){F=!1;try{document.createComment("").addEventListener("test",function(){},{get passive(){F={passive:!1}}})}catch(V){}}function f(){void 0==F&&e();return F}function h(V,E,Q){this.elem=V;this.type=E;this.callback=Q}function g(V,E,Q){var aa=l(E);if(!r.isMac&&B){E.getModifierState&&(E.getModifierState("OS")||
E.getModifierState("Win"))&&(aa|=8);if(B.altGr)if(3!=(3&aa))B.altGr=0;else return;if(18===Q||17===Q){var qa="location"in E?E.location:E.keyLocation;17===Q&&1===qa?1==B[Q]&&(D=E.timeStamp):18===Q&&3===aa&&2===qa&&50>E.timeStamp-D&&(B.altGr=!0)}}Q in q.MODIFIER_KEYS&&(Q=-1);if(!aa&&13===Q&&(qa="location"in E?E.location:E.keyLocation,3===qa&&(V(E,aa,-Q),E.defaultPrevented)))return;if(r.isChromeOS&&aa&8){V(E,aa,Q);if(E.defaultPrevented)return;aa&=-9}return aa||Q in q.FUNCTION_KEYS||Q in q.PRINTABLE_KEYS?
V(E,aa,Q):!1}function m(){B=Object.create(null)}var q=a("./keys"),r=a("./useragent"),B=null,D=0,F;h.prototype.destroy=function(){N(this.elem,this.type,this.callback);this.elem=this.type=this.callback=void 0};var G=b.addListener=function(V,E,Q,aa){V.addEventListener(E,Q,f());aa&&aa.$toDestroy.push(new h(V,E,Q))},N=b.removeListener=function(V,E,Q){V.removeEventListener(E,Q,f())};b.stopEvent=function(V){b.stopPropagation(V);b.preventDefault(V);return!1};b.stopPropagation=function(V){V.stopPropagation&&
V.stopPropagation()};b.preventDefault=function(V){V.preventDefault&&V.preventDefault()};b.getButton=function(V){return"dblclick"==V.type?0:"contextmenu"==V.type||r.isMac&&V.ctrlKey&&!V.altKey&&!V.shiftKey?2:V.button};b.capture=function(V,E,Q){function aa(qa){E&&E(qa);Q&&Q(qa);N(document,"mousemove",E);N(document,"mouseup",aa);N(document,"dragstart",aa)}G(document,"mousemove",E);G(document,"mouseup",aa);G(document,"dragstart",aa);return aa};b.addMouseWheelListener=function(V,E,Q){"onmousewheel"in V?
G(V,"mousewheel",function(aa){void 0!==aa.wheelDeltaX?(aa.wheelX=-aa.wheelDeltaX/8,aa.wheelY=-aa.wheelDeltaY/8):(aa.wheelX=0,aa.wheelY=-aa.wheelDelta/8);E(aa)},Q):"onwheel"in V?G(V,"wheel",function(aa){switch(aa.deltaMode){case aa.DOM_DELTA_PIXEL:aa.wheelX=.35*aa.deltaX||0;aa.wheelY=.35*aa.deltaY||0;break;case aa.DOM_DELTA_LINE:case aa.DOM_DELTA_PAGE:aa.wheelX=5*(aa.deltaX||0),aa.wheelY=5*(aa.deltaY||0)}E(aa)},Q):G(V,"DOMMouseScroll",function(aa){aa.axis&&aa.axis==aa.HORIZONTAL_AXIS?(aa.wheelX=5*
(aa.detail||0),aa.wheelY=0):(aa.wheelX=0,aa.wheelY=5*(aa.detail||0));E(aa)},Q)};b.addMultiMouseDownListener=function(V,E,Q,aa,qa){function P(Ca){0!==b.getButton(Ca)?ea=0:1<Ca.detail?(ea++,4<ea&&(ea=1)):ea=1;if(r.isIE){var Ga=5<Math.abs(Ca.clientX-ua)||5<Math.abs(Ca.clientY-Fa);if(!pa||Ga)ea=1;pa&&clearTimeout(pa);pa=setTimeout(function(){pa=null},E[ea-1]||600);1==ea&&(ua=Ca.clientX,Fa=Ca.clientY)}Ca._clicks=ea;Q[aa]("mousedown",Ca);if(4<ea)ea=0;else if(1<ea)return Q[aa](ra[ea],Ca)}var ea=0,ua,Fa,
pa,ra={2:"dblclick",3:"tripleclick",4:"quadclick"};Array.isArray(V)||(V=[V]);V.forEach(function(Ca){G(Ca,"mousedown",P,qa)})};b.getModifierString=function(V){return q.KEY_MODS[l(V)]};b.addCommandKeyListener=function(V,E,Q){if(r.isOldGecko||r.isOpera&&!("KeyboardEvent"in window)){var aa=null;G(V,"keydown",function(P){aa=P.keyCode},Q);G(V,"keypress",function(P){return g(E,P,aa)},Q)}else{var qa=null;G(V,"keydown",function(P){B[P.keyCode]=(B[P.keyCode]||0)+1;var ea=g(E,P,P.keyCode);qa=P.defaultPrevented;
return ea},Q);G(V,"keypress",function(P){qa&&(P.ctrlKey||P.altKey||P.shiftKey||P.metaKey)&&(b.stopEvent(P),qa=null)},Q);G(V,"keyup",function(P){B[P.keyCode]=null},Q);B||(m(),G(window,"focus",m))}};if("object"==typeof window&&window.postMessage&&!r.isOldIE){var T=1;b.nextTick=function(V,E){function Q(qa){qa.data==aa&&(b.stopPropagation(qa),N(E,"message",Q),V())}E=E||window;var aa="zero-timeout-message-"+T++;G(E,"message",Q);E.postMessage(aa,"*")}}b.$idleBlocked=!1;b.onIdle=function(V,E){return setTimeout(function aa(){b.$idleBlocked?
setTimeout(aa,100):V()},E)};b.$idleBlockId=null;b.blockIdle=function(V){b.$idleBlockId&&clearTimeout(b.$idleBlockId);b.$idleBlocked=!0;b.$idleBlockId=setTimeout(function(){b.$idleBlocked=!1},V||100)};b.nextFrame="object"==typeof window&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame);b.nextFrame=b.nextFrame?b.nextFrame.bind(window):function(V){setTimeout(V,17)}});
define("ace/range",["require","exports","module"],function(a,b){function l(e,f,h,g){this.start={row:e,column:f};this.end={row:h,column:g}}(function(){this.isEqual=function(e){return this.start.row===e.start.row&&this.end.row===e.end.row&&this.start.column===e.start.column&&this.end.column===e.end.column};this.toString=function(){return"Range: ["+this.start.row+"/"+this.start.column+"] -> ["+this.end.row+"/"+this.end.column+"]"};this.contains=function(e,f){return 0==this.compare(e,f)};this.compareRange=
function(e){var f=e.end;e=e.start;f=this.compare(f.row,f.column);if(1==f)return f=this.compare(e.row,e.column),1==f?2:0==f?1:0;if(-1==f)return-2;f=this.compare(e.row,e.column);return-1==f?-1:1==f?42:0};this.comparePoint=function(e){return this.compare(e.row,e.column)};this.containsRange=function(e){return 0==this.comparePoint(e.start)&&0==this.comparePoint(e.end)};this.intersects=function(e){e=this.compareRange(e);return-1==e||0==e||1==e};this.isEnd=function(e,f){return this.end.row==e&&this.end.column==
f};this.isStart=function(e,f){return this.start.row==e&&this.start.column==f};this.setStart=function(e,f){"object"==typeof e?(this.start.column=e.column,this.start.row=e.row):(this.start.row=e,this.start.column=f)};this.setEnd=function(e,f){"object"==typeof e?(this.end.column=e.column,this.end.row=e.row):(this.end.row=e,this.end.column=f)};this.inside=function(e,f){return 0!=this.compare(e,f)||this.isEnd(e,f)||this.isStart(e,f)?!1:!0};this.insideStart=function(e,f){return 0!=this.compare(e,f)||this.isEnd(e,
f)?!1:!0};this.insideEnd=function(e,f){return 0!=this.compare(e,f)||this.isStart(e,f)?!1:!0};this.compare=function(e,f){return this.isMultiLine()||e!==this.start.row?e<this.start.row?-1:e>this.end.row?1:this.start.row===e?f>=this.start.column?0:-1:this.end.row===e?f<=this.end.column?0:1:0:f<this.start.column?-1:f>this.end.column?1:0};this.compareStart=function(e,f){return this.start.row==e&&this.start.column==f?-1:this.compare(e,f)};this.compareEnd=function(e,f){return this.end.row==e&&this.end.column==
f?1:this.compare(e,f)};this.compareInside=function(e,f){return this.end.row==e&&this.end.column==f?1:this.start.row==e&&this.start.column==f?-1:this.compare(e,f)};this.clipRows=function(e,f){if(this.end.row>f)var h={row:f+1,column:0};else this.end.row<e&&(h={row:e,column:0});if(this.start.row>f)var g={row:f+1,column:0};else this.start.row<e&&(g={row:e,column:0});return l.fromPoints(g||this.start,h||this.end)};this.extend=function(e,f){var h=this.compare(e,f);if(0==h)return this;if(-1==h)var g={row:e,
column:f};else var m={row:e,column:f};return l.fromPoints(g||this.start,m||this.end)};this.isEmpty=function(){return this.start.row===this.end.row&&this.start.column===this.end.column};this.isMultiLine=function(){return this.start.row!==this.end.row};this.clone=function(){return l.fromPoints(this.start,this.end)};this.collapseRows=function(){return 0==this.end.column?new l(this.start.row,0,Math.max(this.start.row,this.end.row-1),0):new l(this.start.row,0,this.end.row,0)};this.toScreenRange=function(e){var f=
e.documentToScreenPosition(this.start);e=e.documentToScreenPosition(this.end);return new l(f.row,f.column,e.row,e.column)};this.moveBy=function(e,f){this.start.row+=e;this.start.column+=f;this.end.row+=e;this.end.column+=f}}).call(l.prototype);l.fromPoints=function(e,f){return new l(e.row,e.column,f.row,f.column)};l.comparePoints=function(e,f){return e.row-f.row||e.column-f.column};l.comparePoints=function(e,f){return e.row-f.row||e.column-f.column};b.Range=l});
define("ace/lib/lang",["require","exports","module"],function(a,b){b.last=function(f){return f[f.length-1]};b.stringReverse=function(f){return f.split("").reverse().join("")};b.stringRepeat=function(f,h){for(var g="";0<h;)if(h&1&&(g+=f),h>>=1)f+=f;return g};var l=/^\s\s*/,e=/\s\s*$/;b.stringTrimLeft=function(f){return f.replace(l,"")};b.stringTrimRight=function(f){return f.replace(e,"")};b.copyObject=function(f){var h={},g;for(g in f)h[g]=f[g];return h};b.copyArray=function(f){for(var h=[],g=0,m=
f.length;g<m;g++)h[g]=f[g]&&"object"==typeof f[g]?this.copyObject(f[g]):f[g];return h};b.deepCopy=function g(h){if("object"!==typeof h||!h)return h;if(Array.isArray(h)){var m=[];for(var q=0;q<h.length;q++)m[q]=g(h[q]);return m}if("[object Object]"!==Object.prototype.toString.call(h))return h;m={};for(q in h)m[q]=g(h[q]);return m};b.arrayToMap=function(h){for(var g={},m=0;m<h.length;m++)g[h[m]]=1;return g};b.createMap=function(h){var g=Object.create(null),m;for(m in h)g[m]=h[m];return g};b.arrayRemove=
function(h,g){for(var m=0;m<=h.length;m++)g===h[m]&&h.splice(m,1)};b.escapeRegExp=function(h){return h.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1")};b.escapeHTML=function(h){return(""+h).replace(/&/g,"&#38;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&#60;")};b.getMatchOffsets=function(h,g){var m=[];h.replace(g,function(q){m.push({offset:arguments[arguments.length-2],length:q.length})});return m};b.deferredCall=function(h){function g(r){g.cancel();q=setTimeout(m,r||0);return g}function m(){q=
null;h()}var q=null;g.schedule=g;g.call=function(){this.cancel();h();return g};g.cancel=function(){clearTimeout(q);q=null;return g};g.isPending=function(){return q};return g};b.delayedCall=function(h,g){function m(B){null==r&&(r=setTimeout(q,B||g))}function q(){r=null;h()}var r=null;m.delay=function(B){r&&clearTimeout(r);r=setTimeout(q,B||g)};m.schedule=m;m.call=function(){this.cancel();h()};m.cancel=function(){r&&clearTimeout(r);r=null};m.isPending=function(){return r};return m}});
define("ace/clipboard",["require","exports","module"],function(a,b,l){var e;l.exports={lineMode:!1,pasteCancelled:function(){return e&&e>Date.now()-50?!0:e=!1},cancel:function(){e=Date.now()}}});
define("ace/keyboard/textinput","require exports module ace/lib/event ace/lib/useragent ace/lib/dom ace/lib/lang ace/clipboard ace/lib/keys".split(" "),function(a,b){var l=a("../lib/event"),e=a("../lib/useragent"),f=a("../lib/dom"),h=a("../lib/lang"),g=a("../clipboard"),m=18>e.isChrome,q=e.isIE,r=63<e.isChrome,B=a("../lib/keys"),D=B.KEY_MODS,F=e.isIOS,G=F?/\s/:/\n/,N=e.isMobile;b.TextInput=function(T,V){function E(qb){V.textInput.onContextMenu(qb);Ga()}function Q(qb){V.onCompositionEnd&&!V.$readOnly&&
(ya=!1,V.onCompositionEnd(),V.off("mousedown",Ca),qb&&pa())}function aa(){if(ya&&V.onCompositionUpdate&&!V.$readOnly){if(lb)return Ca();if(ya.useTextareaForIME)V.onCompositionUpdate(xa.value);else ra(xa.value),ya.markerRange&&(ya.context&&(ya.markerRange.start.column=ya.selectionStart=ya.context.compositionStartOffset),ya.markerRange.end.column=ya.markerRange.start.column+Sa-ya.selectionStart+Va)}}function qa(qb){var yb=Fa(qb);if(!g.pasteCancelled())if("string"==typeof yb){if(yb)V.onPaste(yb,qb);
e.isIE&&setTimeout(Qa);l.preventDefault(qb)}else xa.value="",Na=!0}function P(qb){ua(qb,!1)}function ea(qb){ua(qb,!0)}function ua(qb,yb){var Ib=V.getCopyText();if(!Ib)return l.preventDefault(qb);Fa(qb,Ib)?(F&&(Qa(Ib),za=Ib,setTimeout(function(){za=!1},10)),yb?V.onCut():V.onCopy(),l.preventDefault(qb)):(za=!0,xa.value=Ib,xa.select(),setTimeout(function(){za=!1;Qa();yb?V.onCut():V.onCopy()}))}function Fa(qb,yb,Ib){if((qb=qb.clipboardData||window.clipboardData)&&!m){var Pb=q||Ib?"Text":"text/plain";
try{return yb?!1!==qb.setData(Pb,yb):qb.getData(Pb)}catch(Eb){if(!Ib)return Fa(Eb,yb,!0)}}}function pa(qb){if(ya)return aa();if(qb&&qb.inputType){if("historyUndo"==qb.inputType)return V.execCommand("undo");if("historyRedo"==qb.inputType)return V.execCommand("redo")}qb=xa.value;var yb=ra(qb,!0);(500<qb.length||G.test(yb)||N&&1>ca&&ca==Sa)&&Qa()}function ra(qb,yb){mb&&=!1;if(Na){Qa();if(qb)V.onPaste(qb);Na=!1;return""}for(var Ib=xa.selectionStart,Pb=xa.selectionEnd,Eb=ca,z=Cb.length-Sa,Xb,Nb=qb.length-
Ib,Rb=qb.length-Pb,Fb=0;0<Eb&&Cb[Fb]==qb[Fb];)Fb++,Eb--;Xb=qb.slice(Fb);for(Fb=1;0<z&&Cb.length-Fb>ca-1&&Cb[Cb.length-Fb]==qb[qb.length-Fb];)Fb++,z--;Nb-=Fb-1;Rb-=Fb-1;Fb=Xb.length-Fb+1;0>Fb&&(Eb=-Fb,Fb=0);Xb=Xb.slice(0,Fb);if(!(yb||Xb||Nb||Eb||z||Rb))return"";Ia=!0;if(Xb&&!Eb&&!z&&!Nb&&!Rb||lb)V.onTextInput(Xb);else V.onTextInput(Xb,{extendLeft:Eb,extendRight:z,restoreStart:Nb,restoreEnd:Rb});Ia=!1;Cb=qb;ca=Ib;Sa=Pb;Va=Rb;return Xb}function Ca(){xb=!0;xa.blur();xa.focus();xb=!1}function Ga(){clearTimeout(Bb);
Bb=setTimeout(function(){$a&&(xa.style.cssText=$a,$a="");V.renderer.$isMousePressed=!1;V.renderer.$keepTextAreaAtCursor&&V.renderer.$moveTextAreaToCursor()},0)}function Aa(qb,yb,Ib){function Pb(){if(document.activeElement===Ib&&!(z||ya||yb.$mouseHandler.isMousePressed||za)){var Xb=Ib.selectionStart,Nb=Ib.selectionEnd,Rb=null,Fb=0;if(0==Xb)Rb=B.up;else if(1==Xb)Rb=B.home;else if(Nb>Sa&&"\n"==Cb[Nb])Rb=B.end;else if(Xb<ca&&" "==Cb[Xb-1])Rb=B.left,Fb=D.option;else if(Xb<ca||Xb==ca&&Sa!=ca&&Xb==Nb)Rb=
B.left;else if(Nb>Sa&&2<Cb.slice(0,Nb).split("\n").length)Rb=B.down;else if(Nb>Sa&&" "==Cb[Nb-1])Rb=B.right,Fb=D.option;else if(Nb>Sa||Nb==Sa&&Sa!=ca&&Xb==Nb)Rb=B.right;Xb!==Nb&&(Fb|=D.shift);Rb&&(!yb.onCommandKey({},Fb,Rb)&&yb.commands&&(Rb=B.keyCodeToString(Rb),(Rb=yb.commands.findKeyCommand(Fb,Rb))&&yb.execCommand(Rb)),ca=Xb,Sa=Nb,Qa(""))}}var Eb=null,z=!1;Ib.addEventListener("keydown",function(){Eb&&clearTimeout(Eb);z=!0},!0);Ib.addEventListener("keyup",function(){Eb=setTimeout(function(){z=!1},
100)},!0);document.addEventListener("selectionchange",Pb);yb.on("destroy",function(){document.removeEventListener("selectionchange",Pb)})}var xa=f.createElement("textarea");xa.className="ace_text-input";xa.setAttribute("wrap","off");xa.setAttribute("autocorrect","off");xa.setAttribute("autocapitalize","off");xa.setAttribute("spellcheck",!1);xa.style.opacity="0";T.insertBefore(xa,T.firstChild);var za=!1,Na=!1,ya=!1,Ia=!1,$a="";N||(xa.style.fontSize="1px");var lb=!1,xb=!1,Cb="",ca=0,Sa=0,Va=0;try{var fb=
document.activeElement===xa}catch(qb){}l.addListener(xa,"blur",function(qb){xb||(V.onBlur(qb),fb=!1)},V);l.addListener(xa,"focus",function(qb){if(!xb){fb=!0;if(e.isEdge)try{if(!document.hasFocus())return}catch(yb){}V.onFocus(qb);e.isEdge?setTimeout(Qa):Qa()}},V);this.$focusScroll=!1;this.focus=function(){if($a||r||"browser"==this.$focusScroll)return xa.focus({preventScroll:!0});var qb=xa.style.top;xa.style.position="fixed";xa.style.top="0px";try{var yb=0!=xa.getBoundingClientRect().top}catch(Eb){return}var Ib=
[];if(yb)for(var Pb=xa.parentElement;Pb&&1==Pb.nodeType;)Ib.push(Pb),Pb.setAttribute("ace_nocontext",!0),Pb=!Pb.parentElement&&Pb.getRootNode?Pb.getRootNode().host:Pb.parentElement;xa.focus({preventScroll:!0});yb&&Ib.forEach(function(Eb){Eb.removeAttribute("ace_nocontext")});setTimeout(function(){xa.style.position="";"0px"==xa.style.top&&(xa.style.top=qb)},0)};this.blur=function(){xa.blur()};this.isFocused=function(){return fb};V.on("beforeEndOperation",function(){var qb=V.curOp,yb=qb&&qb.command&&
qb.command.name;"insertstring"!=yb&&(qb=yb&&(qb.docChanged||qb.selectionChanged),ya&&qb&&(Cb=xa.value="",Q()),Qa())});var Qa=F?function(qb){if(fb&&(!za||qb)&&!Ia){qb||="";var yb="\n ab"+qb+"cde fg\n";yb!=xa.value&&(xa.value=Cb=yb);qb=4+(qb.length||(V.selection.isEmpty()?0:1));4==ca&&Sa==qb||xa.setSelectionRange(4,qb);ca=4;Sa=qb}}:function(){if(!ya&&!Ia&&(fb||mb)){ya=!0;var qb=0,yb=0,Ib="";if(V.session){qb=V.selection;var Pb=qb.getRange(),Eb=qb.cursor.row;qb=Pb.start.column;yb=Pb.end.column;Ib=V.session.getLine(Eb);
if(Pb.start.row!=Eb){var z=V.session.getLine(Eb-1);qb=Pb.start.row<Eb-1?0:qb;yb+=z.length+1;Ib=z+"\n"+Ib}else Pb.end.row!=Eb?(z=V.session.getLine(Eb+1),yb=Pb.end.row>Eb+1?z.length:yb,yb+=Ib.length+1,Ib=Ib+"\n"+z):N&&0<Eb&&(Ib="\n"+Ib,yb+=1,qb+=1);400<Ib.length&&(400>qb&&400>yb?Ib=Ib.slice(0,400):(Ib="\n",qb=0,yb=1))}Pb=Ib+"\n\n";Pb!=Cb&&(xa.value=Cb=Pb,ca=Sa=Pb.length);mb&&(ca=xa.selectionStart,Sa=xa.selectionEnd);if(Sa!=yb||ca!=qb||xa.selectionEnd!=Sa)try{xa.setSelectionRange(qb,yb),ca=qb,Sa=yb}catch(Xb){}ya=
!1}};this.resetSelection=Qa;if(fb)V.onFocus();var eb=null;this.setInputHandler=function(qb){eb=qb};this.getInputHandler=function(){return eb};var mb=!1;l.addCommandKeyListener(xa,V.onCommandKey.bind(V),V);l.addListener(xa,"select",function(){ya||(za?za=!1:0===xa.selectionStart&&xa.selectionEnd>=Cb.length&&xa.value===Cb&&Cb&&xa.selectionEnd!==Sa?(V.selectAll(),Qa()):N&&xa.selectionStart!=ca&&Qa())},V);l.addListener(xa,"input",pa,V);l.addListener(xa,"cut",ea,V);l.addListener(xa,"copy",P,V);l.addListener(xa,
"paste",qa,V);"oncut"in xa&&"oncopy"in xa&&"onpaste"in xa||l.addListener(T,"keydown",function(qb){if((!e.isMac||qb.metaKey)&&qb.ctrlKey)switch(qb.keyCode){case 67:P(qb);break;case 86:qa(qb);break;case 88:ea(qb)}},V);var ub=h.delayedCall(aa,50).schedule.bind(null,null);l.addListener(xa,"compositionstart",function(qb){ya||!V.onCompositionStart||V.$readOnly||(ya={},lb||(qb.data&&(ya.useTextareaForIME=!1),setTimeout(aa,0),V._signal("compositionStart"),V.on("mousedown",Ca),qb=V.getSelectionRange(),qb.end.row=
qb.start.row,qb.end.column=qb.start.column,ya.markerRange=qb,ya.selectionStart=ca,V.onCompositionStart(ya),ya.useTextareaForIME?(Cb=xa.value="",Sa=ca=0):(xa.msGetInputContext&&(ya.context=xa.msGetInputContext()),xa.getInputContext&&(ya.context=xa.getInputContext()))))},V);l.addListener(xa,"compositionupdate",aa,V);l.addListener(xa,"keyup",function(qb){27==qb.keyCode&&xa.value.length<xa.selectionStart&&(ya||(Cb=xa.value),ca=Sa=-1,Qa());ub()},V);l.addListener(xa,"keydown",ub,V);l.addListener(xa,"compositionend",
Q,V);this.getElement=function(){return xa};this.setCommandMode=function(qb){lb=qb;xa.readOnly=!1};this.setReadOnly=function(qb){lb||(xa.readOnly=qb)};this.setCopyWithEmptySelection=function(){};this.onContextMenu=function(qb){mb=!0;Qa();V._emit("nativecontextmenu",{target:V,domEvent:qb});this.moveToMouse(qb,!0)};this.moveToMouse=function(qb,yb){function Ib(Nb){f.translate(xa,Nb.clientX-z-2,Math.min(Nb.clientY-Eb-2,Xb))}$a||($a=xa.style.cssText);xa.style.cssText=(yb?"z-index:100000;":"")+(e.isIE?"opacity:0.1;":
"")+"text-indent: -"+(ca+Sa)*V.renderer.characterWidth*.5+"px;";yb=V.container.getBoundingClientRect();var Pb=f.computedStyle(V.container),Eb=yb.top+(parseInt(Pb.borderTopWidth)||0),z=yb.left+(parseInt(yb.borderLeftWidth)||0),Xb=yb.bottom-Eb-xa.clientHeight-2;Ib(qb);"mousedown"==qb.type&&(V.renderer.$isMousePressed=!0,clearTimeout(Bb),e.isWin&&l.capture(V.container,Ib,Ga))};this.onContextMenuClose=Ga;var Bb;l.addListener(xa,"mouseup",E,V);l.addListener(xa,"mousedown",function(qb){qb.preventDefault();
Ga()},V);l.addListener(V.renderer.scroller,"contextmenu",E,V);l.addListener(xa,"contextmenu",E,V);F&&Aa(T,V,xa)};b.$setUserAgentForTests=function(T,V){N=T;F=V}});
define("ace/mouse/default_handlers",["require","exports","module","ace/lib/useragent"],function(a,b){function l(h){h.$clickSelection=null;var g=h.editor;g.setDefaultHandler("mousedown",this.onMouseDown.bind(h));g.setDefaultHandler("dblclick",this.onDoubleClick.bind(h));g.setDefaultHandler("tripleclick",this.onTripleClick.bind(h));g.setDefaultHandler("quadclick",this.onQuadClick.bind(h));g.setDefaultHandler("mousewheel",this.onMouseWheel.bind(h));"select startSelect selectEnd selectAllEnd selectByWordsEnd selectByLinesEnd dragWait dragWaitEnd focusWait".split(" ").forEach(function(m){h[m]=
this[m]},this);h.selectByLines=this.extendSelectionBy.bind(h,"getLineRange");h.selectByWords=this.extendSelectionBy.bind(h,"getWordRange")}function e(h,g){return 0>(h.start.row==h.end.row?2*g.column-h.start.column-h.end.column:h.start.row!=h.end.row-1||h.start.column||h.end.column?2*g.row-h.start.row-h.end.row:g.column-4)?{cursor:h.start,anchor:h.end}:{cursor:h.end,anchor:h.start}}var f=a("../lib/useragent");(function(){this.onMouseDown=function(h){var g=h.inSelection(),m=h.getDocumentPosition();
this.mousedownEvent=h;var q=this.editor,r=h.getButton();if(0!==r)(q.getSelectionRange().isEmpty()||1==r)&&q.selection.moveToPosition(m),2==r&&(q.textInput.onContextMenu(h.domEvent),f.isMozilla||h.preventDefault());else{this.mousedownEvent.time=Date.now();if(g&&!q.isFocused()&&(q.focus(),this.$focusTimeout&&!this.$clickSelection&&!q.inMultiSelectMode)){this.setState("focusWait");this.captureMouse(h);return}this.captureMouse(h);this.startSelect(m,1<h.domEvent._clicks);return h.preventDefault()}};this.startSelect=
function(h,g){h=h||this.editor.renderer.screenToTextCoordinates(this.x,this.y);var m=this.editor;this.mousedownEvent&&(this.mousedownEvent.getShiftKey()?m.selection.selectToPosition(h):g||m.selection.moveToPosition(h),g||this.select(),m.renderer.scroller.setCapture&&m.renderer.scroller.setCapture(),m.setStyle("ace_selecting"),this.setState("select"))};this.select=function(){var h=this.editor,g=h.renderer.screenToTextCoordinates(this.x,this.y);if(this.$clickSelection){var m=this.$clickSelection.comparePoint(g);
-1==m?m=this.$clickSelection.end:1==m?m=this.$clickSelection.start:(m=e(this.$clickSelection,g),g=m.cursor,m=m.anchor);h.selection.setSelectionAnchor(m.row,m.column)}h.selection.selectToPosition(g);h.renderer.scrollCursorIntoView()};this.extendSelectionBy=function(h){var g=this.editor,m=g.renderer.screenToTextCoordinates(this.x,this.y);h=g.selection[h](m.row,m.column);if(this.$clickSelection){var q=this.$clickSelection.comparePoint(h.start);var r=this.$clickSelection.comparePoint(h.end);if(-1==q&&
0>=r){if(q=this.$clickSelection.end,h.end.row!=m.row||h.end.column!=m.column)m=h.start}else if(1==r&&0<=q){if(q=this.$clickSelection.start,h.start.row!=m.row||h.start.column!=m.column)m=h.end}else-1==q&&1==r?(m=h.end,q=h.start):(h=e(this.$clickSelection,m),m=h.cursor,q=h.anchor);g.selection.setSelectionAnchor(q.row,q.column)}g.selection.selectToPosition(m);g.renderer.scrollCursorIntoView()};this.selectEnd=this.selectAllEnd=this.selectByWordsEnd=this.selectByLinesEnd=function(){this.$clickSelection=
null;this.editor.unsetStyle("ace_selecting");this.editor.renderer.scroller.releaseCapture&&this.editor.renderer.scroller.releaseCapture()};this.focusWait=function(){var h=Math.sqrt(Math.pow(this.x-this.mousedownEvent.x,2)+Math.pow(this.y-this.mousedownEvent.y,2)),g=Date.now();(0<h||g-this.mousedownEvent.time>this.$focusTimeout)&&this.startSelect(this.mousedownEvent.getDocumentPosition())};this.onDoubleClick=function(h){h=h.getDocumentPosition();var g=this.editor,m=g.session.getBracketRange(h);m?(m.isEmpty()&&
(m.start.column--,m.end.column++),this.setState("select")):(m=g.selection.getWordRange(h.row,h.column),this.setState("selectByWords"));this.$clickSelection=m;this.select()};this.onTripleClick=function(h){h=h.getDocumentPosition();var g=this.editor;this.setState("selectByLines");var m=g.getSelectionRange();m.isMultiLine()&&m.contains(h.row,h.column)?(this.$clickSelection=g.selection.getLineRange(m.start.row),this.$clickSelection.end=g.selection.getLineRange(m.end.row).end):this.$clickSelection=g.selection.getLineRange(h.row);
this.select()};this.onQuadClick=function(){var h=this.editor;h.selectAll();this.$clickSelection=h.getSelectionRange();this.setState("selectAll")};this.onMouseWheel=function(h){if(!h.getAccelKey()){h.getShiftKey()&&h.wheelY&&!h.wheelX&&(h.wheelX=h.wheelY,h.wheelY=0);var g=this.editor;this.$lastScroll||(this.$lastScroll={t:0,vx:0,vy:0,allowed:0});var m=this.$lastScroll,q=h.domEvent.timeStamp,r=q-m.t,B=r?h.wheelX/r:m.vx,D=r?h.wheelY/r:m.vy;550>r&&(B=(B+m.vx)/2,D=(D+m.vy)/2);r=Math.abs(B/D);var F=!1;
1<=r&&g.renderer.isScrollableBy(h.wheelX*h.speed,0)&&(F=!0);1>=r&&g.renderer.isScrollableBy(0,h.wheelY*h.speed)&&(F=!0);F?m.allowed=q:550>q-m.allowed&&(Math.abs(B)<=1.5*Math.abs(m.vx)&&Math.abs(D)<=1.5*Math.abs(m.vy)?(F=!0,m.allowed=q):m.allowed=0);m.t=q;m.vx=B;m.vy=D;if(F)return g.renderer.scrollBy(h.wheelX*h.speed,h.wheelY*h.speed),h.stop()}}}).call(l.prototype);b.DefaultHandlers=l});
define("ace/tooltip",["require","exports","module","ace/lib/oop","ace/lib/dom"],function(a,b){function l(f){this.isOpen=!1;this.$element=null;this.$parentNode=f}a("./lib/oop");var e=a("./lib/dom");(function(){this.$init=function(){this.$element=e.createElement("div");this.$element.className="ace_tooltip";this.$element.style.display="none";this.$parentNode.appendChild(this.$element);return this.$element};this.getElement=function(){return this.$element||this.$init()};this.setText=function(f){this.getElement().textContent=
f};this.setHtml=function(f){this.getElement().innerHTML=f};this.setPosition=function(f,h){this.getElement().style.left=f+"px";this.getElement().style.top=h+"px"};this.setClassName=function(f){e.addCssClass(this.getElement(),f)};this.show=function(f,h,g){null!=f&&this.setText(f);null!=h&&null!=g&&this.setPosition(h,g);this.isOpen||(this.getElement().style.display="block",this.isOpen=!0)};this.hide=function(){this.isOpen&&(this.getElement().style.display="none",this.isOpen=!1)};this.getHeight=function(){return this.getElement().offsetHeight};
this.getWidth=function(){return this.getElement().offsetWidth};this.destroy=function(){this.isOpen=!1;this.$element&&this.$element.parentNode&&this.$element.parentNode.removeChild(this.$element)}}).call(l.prototype);b.Tooltip=l});
define("ace/mouse/default_gutter_handler","require exports module ace/lib/dom ace/lib/oop ace/lib/event ace/tooltip".split(" "),function(a,b){function l(m){g.call(this,m)}var e=a("../lib/dom"),f=a("../lib/oop"),h=a("../lib/event"),g=a("../tooltip").Tooltip;f.inherits(l,g);(function(){this.setPosition=function(m,q){var r=window.innerWidth||document.documentElement.clientWidth,B=window.innerHeight||document.documentElement.clientHeight,D=this.getWidth(),F=this.getHeight();m+=15;q+=15;m+D>r&&(m-=m+D-
r);q+F>B&&(q-=20+F);g.prototype.setPosition.call(this,m,q)}}).call(l.prototype);b.GutterHandler=function(m){function q(){F&&=clearTimeout(F);N&&(D.hide(),N=null,r._signal("hideGutterTooltip",D),r.off("mousewheel",q))}var r=m.editor,B=r.renderer.$gutterLayer,D=new l(r.container);m.editor.setDefaultHandler("guttermousedown",function(T){if(r.isFocused()&&0==T.getButton()&&"foldWidgets"!=B.getRegion(T)){var V=T.getDocumentPosition().row,E=r.session.selection;if(T.getShiftKey())E.selectTo(V,0);else{if(2==
T.domEvent.detail)return r.selectAll(),T.preventDefault();m.$clickSelection=r.selection.getLineRange(V)}m.setState("selectByLines");m.captureMouse(T);return T.preventDefault()}});var F,G,N;m.editor.setDefaultHandler("guttermousemove",function(T){if(e.hasCssClass(T.domEvent.target||T.domEvent.srcElement,"ace_fold-widget"))return q();N&&m.$tooltipFollowsMouse&&D.setPosition(T.x,T.y);G=T;F||=setTimeout(function(){F=null;if(G&&!m.isMousePressed)a:{var V=G.getDocumentPosition().row,E=B.$annotations[V];
if(E){var Q=r.session.getLength();if(V==Q&&(V=r.renderer.pixelToScreenCoordinates(0,G.y).row,Q=G.$pos,V>r.session.documentToScreenRow(Q.row,Q.column))){q();break a}N!=E&&(N=E.text.join("<br/>"),D.setHtml(N),D.show(),r._signal("showGutterTooltip",D),r.on("mousewheel",q),m.$tooltipFollowsMouse?D.setPosition(G.x,G.y):(E=G.domEvent.target.getBoundingClientRect(),V=D.getElement().style,V.left=E.right+"px",V.top=E.bottom+"px"))}else q()}else q()},50)});h.addListener(r.renderer.$gutter,"mouseout",function(){G=
null;N&&!F&&(F=setTimeout(function(){F=null;q()},50))},r);r.on("changeSession",q)}});
define("ace/mouse/mouse_event",["require","exports","module","ace/lib/event","ace/lib/useragent"],function(a,b){var l=a("../lib/event"),e=a("../lib/useragent");a=b.MouseEvent=function(f,h){this.domEvent=f;this.editor=h;this.x=this.clientX=f.clientX;this.y=this.clientY=f.clientY;this.$inSelection=this.$pos=null;this.defaultPrevented=this.propagationStopped=!1};(function(){this.stopPropagation=function(){l.stopPropagation(this.domEvent);this.propagationStopped=!0};this.preventDefault=function(){l.preventDefault(this.domEvent);
this.defaultPrevented=!0};this.stop=function(){this.stopPropagation();this.preventDefault()};this.getDocumentPosition=function(){return this.$pos?this.$pos:this.$pos=this.editor.renderer.screenToTextCoordinates(this.clientX,this.clientY)};this.inSelection=function(){if(null!==this.$inSelection)return this.$inSelection;var f=this.editor.getSelectionRange();if(f.isEmpty())this.$inSelection=!1;else{var h=this.getDocumentPosition();this.$inSelection=f.contains(h.row,h.column)}return this.$inSelection};
this.getButton=function(){return l.getButton(this.domEvent)};this.getShiftKey=function(){return this.domEvent.shiftKey};this.getAccelKey=e.isMac?function(){return this.domEvent.metaKey}:function(){return this.domEvent.ctrlKey}}).call(a.prototype)});
define("ace/mouse/dragdrop_handler","require exports module ace/lib/dom ace/lib/event ace/lib/useragent".split(" "),function(a,b){function l(g){var m,q;function r(){var xa=ua,za=ua=T.renderer.screenToTextCoordinates(aa,qa),Na=Date.now(),ya=!xa||za.row!=xa.row,Ia=!xa||za.column!=xa.column;!Ga||ya||Ia?(T.moveCursorToPosition(za),Ga=Na,m=aa,q=qa):5<Math.sqrt(Math.pow(aa-m,2)+Math.pow(qa-q,2))?Ga=null:200<=Na-Ga&&(T.renderer.scrollCursorIntoView(),Ga=null);za=ua;Na=Date.now();Ia=T.renderer.layerConfig.lineHeight;
var $a=T.renderer.layerConfig.characterWidth;ya=T.renderer.scroller.getBoundingClientRect();var lb=aa-ya.left,xb=ya.right-aa,Cb=qa-ya.top,ca=ya.bottom-qa,Sa=Math.min(Cb,ca);ya={row:za.row,column:za.column};2>=Math.min(lb,xb)/$a&&(ya.column+=lb<xb?-3:2);1>=Sa/Ia&&(ya.row+=Cb<ca?-1:1);Ia=za.column!=ya.column;xa=!xa||za.row!=xa.row;za.row!=ya.row||Ia&&!xa?Ca?200<=Na-Ca&&T.renderer.scrollCursorIntoView(ya):Ca=Na:Ca=null}function B(){ea=T.selection.toOrientedRange();Q=T.session.addMarker(ea,"ace_selection",
T.getSelectionStyle());T.clearSelection();T.isFocused()&&T.renderer.$cursorLayer.setBlinking(!1);clearInterval(P);r();P=setInterval(r,20);Fa=0;f.addListener(document,"mousemove",F)}function D(){clearInterval(P);T.session.removeMarker(Q);Q=null;T.selection.fromOrientedRange(ea);T.isFocused()&&!ra&&T.$resetCursorStyle();ua=ea=null;Fa=0;Ga=Ca=null;f.removeListener(document,"mousemove",F)}function F(){null==Aa&&(Aa=setTimeout(function(){null!=Aa&&Q&&D()},20))}function G(xa){xa=xa.types;return!xa||Array.prototype.some.call(xa,
function(za){return"text/plain"==za||"Text"==za})}function N(xa){var za=["copy","copymove","all","uninitialized"],Na=["move","copymove","linkmove","all","uninitialized"],ya=h.isMac?xa.altKey:xa.ctrlKey,Ia="uninitialized";try{Ia=xa.dataTransfer.effectAllowed.toLowerCase()}catch($a){}xa="none";ya&&0<=za.indexOf(Ia)?xa="copy":0<=Na.indexOf(Ia)?xa="move":0<=za.indexOf(Ia)&&(xa="copy");return xa}var T=g.editor,V=e.createElement("img");V.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";
h.isOpera&&(V.style.cssText="width:1px;height:1px;position:fixed;top:0;left:0;z-index:2147483647;opacity:0;");["dragWait","dragWaitEnd","startDrag","dragReadyEnd","onMouseDrag"].forEach(function(xa){g[xa]=this[xa]},this);T.on("mousedown",this.onMouseDown.bind(g));var E=T.container,Q,aa,qa,P,ea,ua,Fa=0,pa,ra,Ca,Ga;this.onDragStart=function(xa){if(this.cancelDrag||!E.draggable){var za=this;setTimeout(function(){za.startSelect();za.captureMouse(xa)},0);return xa.preventDefault()}ea=T.getSelectionRange();
var Na=xa.dataTransfer;Na.effectAllowed=T.getReadOnly()?"copy":"copyMove";h.isOpera&&(T.container.appendChild(V),V.scrollTop=0);Na.setDragImage&&Na.setDragImage(V,0,0);h.isOpera&&T.container.removeChild(V);Na.clearData();Na.setData("Text",T.session.getTextRange());ra=!0;this.setState("drag")};this.onDragEnd=function(xa){ra=E.draggable=!1;this.setState(null);T.getReadOnly()||(xa=xa.dataTransfer.dropEffect,pa||"move"!=xa||T.session.remove(T.getSelectionRange()),T.$resetCursorStyle());this.editor.unsetStyle("ace_dragging");
this.editor.renderer.setCursorStyle("")};this.onDragEnter=function(xa){if(!T.getReadOnly()&&G(xa.dataTransfer))return aa=xa.clientX,qa=xa.clientY,Q||B(),Fa++,xa.dataTransfer.dropEffect=pa=N(xa),f.preventDefault(xa)};this.onDragOver=function(xa){if(!T.getReadOnly()&&G(xa.dataTransfer))return aa=xa.clientX,qa=xa.clientY,Q||(B(),Fa++),null!==Aa&&(Aa=null),xa.dataTransfer.dropEffect=pa=N(xa),f.preventDefault(xa)};this.onDragLeave=function(xa){Fa--;if(0>=Fa&&Q)return D(),pa=null,f.preventDefault(xa)};
this.onDrop=function(xa){if(ua){var za=xa.dataTransfer;if(ra)switch(pa){case "move":ea=ea.contains(ua.row,ua.column)?{start:ua,end:ua}:T.moveText(ea,ua);break;case "copy":ea=T.moveText(ea,ua,!0)}else za=za.getData("Text"),ea={start:ua,end:T.session.insert(ua,za)},T.focus(),pa=null;D();return f.preventDefault(xa)}};f.addListener(E,"dragstart",this.onDragStart.bind(g),T);f.addListener(E,"dragend",this.onDragEnd.bind(g),T);f.addListener(E,"dragenter",this.onDragEnter.bind(g),T);f.addListener(E,"dragover",
this.onDragOver.bind(g),T);f.addListener(E,"dragleave",this.onDragLeave.bind(g),T);f.addListener(E,"drop",this.onDrop.bind(g),T);var Aa=null}var e=a("../lib/dom"),f=a("../lib/event"),h=a("../lib/useragent");(function(){this.dragWait=function(){Date.now()-this.mousedownEvent.time>this.editor.getDragDelay()&&this.startDrag()};this.dragWaitEnd=function(){this.editor.container.draggable=!1;this.startSelect(this.mousedownEvent.getDocumentPosition());this.selectEnd()};this.dragReadyEnd=function(){this.editor.$resetCursorStyle();
this.editor.unsetStyle("ace_dragging");this.editor.renderer.setCursorStyle("");this.dragWaitEnd()};this.startDrag=function(){this.cancelDrag=!1;var g=this.editor;g.container.draggable=!0;g.renderer.$cursorLayer.setBlinking(!1);g.setStyle("ace_dragging");g.renderer.setCursorStyle(h.isWin?"default":"move");this.setState("dragReady")};this.onMouseDrag=function(){var g=this.editor.container;if(h.isIE&&"dragReady"==this.state){var m=Math.sqrt(Math.pow(this.x-this.mousedownEvent.x,2)+Math.pow(this.y-this.mousedownEvent.y,
2));3<m&&g.dragDrop()}"dragWait"===this.state&&(m=Math.sqrt(Math.pow(this.x-this.mousedownEvent.x,2)+Math.pow(this.y-this.mousedownEvent.y,2)),0<m&&(g.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition())))};this.onMouseDown=function(g){if(this.$dragEnabled){this.mousedownEvent=g;var m=this.editor,q=g.inSelection(),r=g.getButton();1!==(g.domEvent.detail||1)||0!==r||!q||g.editor.inMultiSelectMode&&(g.getAccelKey()||g.getShiftKey())||(this.mousedownEvent.time=Date.now(),q=g.domEvent.target||
g.domEvent.srcElement,"unselectable"in q&&(q.unselectable="on"),m.getDragDelay()?(h.isWebKit&&(this.cancelDrag=!0,m.container.draggable=!0),this.setState("dragWait")):this.startDrag(),this.captureMouse(g,this.onMouseDrag.bind(this)),g.defaultPrevented=!0)}}}).call(l.prototype);b.DragdropHandler=l});
define("ace/mouse/touch_handler","require exports module ace/mouse/mouse_event ace/lib/event ace/lib/dom".split(" "),function(a,b){var l=a("./mouse_event").MouseEvent,e=a("../lib/event"),f=a("../lib/dom");b.addTouchListeners=function(h,g){function m(){function Ca(za){var Na=za.target.getAttribute("action");if("more"==Na||!xa)return xa=!xa,Ga();if("paste"==Na)Aa.readText().then(function(ya){g.execCommand(Na,ya)});else if(Na){if("cut"==Na||"copy"==Na)Aa?Aa.writeText(g.getCopyText()):document.execCommand("copy");
g.execCommand(Na)}ra.firstChild.style.display="none";xa=!1;"openCommandPallete"!=Na&&g.focus()}function Ga(){var za=g.getCopyText(),Na=g.session.getUndoManager().hasUndo();ra.replaceChild(f.buildDom(xa?["span",!za&&["span",{class:"ace_mobile-button",action:"selectall"},"Select All"],za&&["span",{class:"ace_mobile-button",action:"copy"},"Copy"],za&&["span",{class:"ace_mobile-button",action:"cut"},"Cut"],Aa&&["span",{class:"ace_mobile-button",action:"paste"},"Paste"],Na&&["span",{class:"ace_mobile-button",
action:"undo"},"Undo"],["span",{class:"ace_mobile-button",action:"find"},"Find"],["span",{class:"ace_mobile-button",action:"openCommandPallete"},"Pallete"]]:["span"]),ra.firstChild)}var Aa=window.navigator&&window.navigator.clipboard,xa=!1;ra=f.buildDom(["div",{class:"ace_mobile-menu",ontouchstart:function(za){G="menu";za.stopPropagation();za.preventDefault();g.textInput.focus()},ontouchend:function(za){za.stopPropagation();za.preventDefault();Ca(za)},onclick:Ca},["span"],["span",{class:"ace_mobile-button",
action:"more"},"..."]],g.container)}function q(){ra||m();var Ca=g.selection.cursor;Ca=g.renderer.textToScreenCoordinates(Ca.row,Ca.column);var Ga=g.container.getBoundingClientRect();ra.style.top=Ca.pageY-Ga.top-3+"px";ra.style.right="10px";ra.style.display="";ra.firstChild.style.display="none";g.on("input",r)}function r(){ra&&(ra.style.display="none");g.off("input",r)}function B(){Q=null;clearTimeout(Q);var Ca=g.selection.getRange(),Ga=Ca.contains(P.row,P.column);if(Ca.isEmpty()||!Ga)g.selection.moveToPosition(P),
g.selection.selectWord();G="wait";q()}function D(){Q=null;clearTimeout(Q);g.selection.moveToPosition(P);var Ca=2<=ea?g.selection.getLineRange(P.row):g.session.getBracketRange(P);Ca&&!Ca.isEmpty()?g.selection.setRange(Ca):g.selection.selectWord();G="wait"}function F(){qa+=60;aa=setInterval(function(){0>=qa--&&(clearInterval(aa),aa=null);.01>Math.abs(ua)&&(ua=0);.01>Math.abs(Fa)&&(Fa=0);20>qa&&(ua*=.9);20>qa&&(Fa*=.9);var Ca=g.session.getScrollTop();g.renderer.scrollBy(10*ua,10*Fa);Ca==g.session.getScrollTop()&&
(qa=0)},10)}var G="scroll",N,T,V,E,Q,aa,qa=0,P,ea=0,ua=0,Fa=0,pa,ra;e.addListener(h,"contextmenu",function(){pa&&g.textInput.getElement().focus()},g);e.addListener(h,"touchstart",function(Ca){var Ga=Ca.touches;if(Q||1<Ga.length)clearTimeout(Q),Q=null,V=-1,G="zoom";else{pa=g.$mouseHandler.isMousePressed=!0;var Aa=g.renderer.layerConfig.lineHeight,xa=g.renderer.layerConfig.lineHeight,za=Ca.timeStamp;E=za;var Na=Ga[0],ya=Na.clientX;Na=Na.clientY;Math.abs(N-ya)+Math.abs(T-Na)>Aa&&(V=-1);N=Ca.clientX=
ya;T=Ca.clientY=Na;ua=Fa=0;P=(new l(Ca,g)).getDocumentPosition();if(500>za-V&&1==Ga.length&&!qa)ea++,Ca.preventDefault(),Ca.button=0,D();else{ea=0;Ga=g.selection.cursor;ya=g.selection.isEmpty()?Ga:g.selection.anchor;Ga=g.renderer.$cursorLayer.getPixelPosition(Ga,!0);ya=g.renderer.$cursorLayer.getPixelPosition(ya,!0);Na=g.renderer.scroller.getBoundingClientRect();var Ia=function($a,lb){$a/=xa;lb=lb/Aa-.75;return $a*$a+lb*lb};if(Ca.clientX<Na.left){G="zoom";return}Ga=Ia(Ca.clientX-Na.left-Ga.left,Ca.clientY-
Na.top-Ga.top);Ca=Ia(Ca.clientX-Na.left-ya.left,Ca.clientY-Na.top-ya.top);3.5>Ga&&3.5>Ca&&(G=Ga>Ca?"cursor":"anchor");G=3.5>Ca?"anchor":3.5>Ga?"cursor":"scroll";Q=setTimeout(B,450)}V=za}},g);e.addListener(h,"touchend",function(){pa=g.$mouseHandler.isMousePressed=!1;aa&&clearInterval(aa);"zoom"==G?(G="",qa=0):Q?(g.selection.moveToPosition(P),qa=0,q()):"scroll"==G?(F(),r()):q();clearTimeout(Q);Q=null},g);e.addListener(h,"touchmove",function(Ca){Q&&(clearTimeout(Q),Q=null);var Ga=Ca.touches;if(!(1<Ga.length||
"zoom"==G)){var Aa=Ga[0];Ga=N-Aa.clientX;var xa=T-Aa.clientY;if("wait"==G)if(4<Ga*Ga+xa*xa)G="cursor";else return Ca.preventDefault();N=Aa.clientX;T=Aa.clientY;Ca.clientX=Aa.clientX;Ca.clientY=Aa.clientY;var za=Ca.timeStamp;Aa=za-E;E=za;"scroll"==G?(Ca=new l(Ca,g),Ca.speed=1,Ca.wheelX=Ga,Ca.wheelY=xa,10*Math.abs(Ga)<Math.abs(xa)&&(Ga=0),10*Math.abs(xa)<Math.abs(Ga)&&(xa=0),0!=Aa&&(ua=Ga/Aa,Fa=xa/Aa),g._emit("mousewheel",Ca),Ca.propagationStopped||(ua=Fa=0)):(Ga=(new l(Ca,g)).getDocumentPosition(),
"cursor"==G?g.selection.moveCursorToPosition(Ga):"anchor"==G&&g.selection.setSelectionAnchor(Ga.row,Ga.column),g.renderer.scrollCursorIntoView(Ga),Ca.preventDefault())}},g)}});
define("ace/lib/net",["require","exports","module","ace/lib/dom"],function(a,b){var l=a("./dom");b.get=function(e,f){var h=new XMLHttpRequest;h.open("GET",e,!0);h.onreadystatechange=function(){4===h.readyState&&f(h.responseText)};h.send(null)};b.loadScript=function(e,f){var h=l.getDocumentHead(),g=document.createElement("script");g.src=e;h.appendChild(g);g.onload=g.onreadystatechange=function(m,q){if(q||!g.readyState||"loaded"==g.readyState||"complete"==g.readyState)g=g.onload=g.onreadystatechange=
null,q||f()}};b.qualifyURL=function(e){var f=document.createElement("a");f.href=e;return f.href}});
define("ace/lib/event_emitter",["require","exports","module"],function(a,b){function l(){this.defaultPrevented=!0}function e(){this.propagationStopped=!0}a={};a._emit=a._dispatchEvent=function(f,h){this._eventRegistry||(this._eventRegistry={});this._defaultHandlers||(this._defaultHandlers={});var g=this._eventRegistry[f]||[],m=this._defaultHandlers[f];if(g.length||m){"object"==typeof h&&h||(h={});h.type||(h.type=f);h.stopPropagation||(h.stopPropagation=e);h.preventDefault||(h.preventDefault=l);g=
g.slice();for(f=0;f<g.length&&(g[f](h,this),!h.propagationStopped);f++);if(m&&!h.defaultPrevented)return m(h,this)}};a._signal=function(f,h){if(f=(this._eventRegistry||{})[f]){f=f.slice();for(var g=0;g<f.length;g++)f[g](h,this)}};a.once=function(f,h){var g=this;this.on(f,function q(){g.off(f,q);h.apply(null,arguments)});if(!h)return new Promise(function(q){h=q})};a.setDefaultHandler=function(f,h){var g=this._defaultHandlers;g||(g=this._defaultHandlers={_disabled_:{}});if(g[f]){var m=g[f],q=g._disabled_[f];
q||(g._disabled_[f]=q=[]);q.push(m);m=q.indexOf(h);-1!=m&&q.splice(m,1)}g[f]=h};a.removeDefaultHandler=function(f,h){var g=this._defaultHandlers;if(g){var m=g._disabled_[f];g[f]==h?m&&this.setDefaultHandler(f,m.pop()):m&&(f=m.indexOf(h),-1!=f&&m.splice(f,1))}};a.on=a.addEventListener=function(f,h,g){this._eventRegistry=this._eventRegistry||{};var m=this._eventRegistry[f];m||=this._eventRegistry[f]=[];if(-1==m.indexOf(h))m[g?"unshift":"push"](h);return h};a.off=a.removeListener=a.removeEventListener=
function(f,h){this._eventRegistry=this._eventRegistry||{};if(f=this._eventRegistry[f])h=f.indexOf(h),-1!==h&&f.splice(h,1)};a.removeAllListeners=function(f){f||(this._eventRegistry=this._defaultHandlers=void 0);this._eventRegistry&&(this._eventRegistry[f]=void 0);this._defaultHandlers&&(this._defaultHandlers[f]=void 0)};b.EventEmitter=a});
define("ace/lib/app_config",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(a,b){function l(){this.$defaultOptions={}}function e(q){"undefined"!=typeof console&&console.warn&&console.warn.apply(console,arguments)}function f(q,r){var B=Error(q);B.data=r;"object"==typeof console&&console.error&&console.error(B);setTimeout(function(){throw B;})}"no use strict";var h=a("./oop"),g=a("./event_emitter").EventEmitter,m={setOptions:function(q){Object.keys(q).forEach(function(r){this.setOption(r,
q[r])},this)},getOptions:function(q){var r={};if(q)Array.isArray(q)||(r=q,q=Object.keys(r));else{var B=this.$options;q=Object.keys(B).filter(function(D){return!B[D].hidden})}q.forEach(function(D){r[D]=this.getOption(D)},this);return r},setOption:function(q,r){if(this["$"+q]!==r){var B=this.$options[q];if(!B)return e('misspelled option "'+q+'"');if(B.forwardTo)return this[B.forwardTo]&&this[B.forwardTo].setOption(q,r);B.handlesSet||(this["$"+q]=r);B&&B.set&&B.set.call(this,r)}},getOption:function(q){var r=
this.$options[q];return r?r.forwardTo?this[r.forwardTo]&&this[r.forwardTo].getOption(q):r&&r.get?r.get.call(this):this["$"+q]:e('misspelled option "'+q+'"')}};(function(){h.implement(this,g);this.defineOptions=function(q,r,B){q.$options||(this.$defaultOptions[r]=q.$options={});Object.keys(B).forEach(function(D){var F=B[D];"string"==typeof F&&(F={forwardTo:F});F.name||(F.name=D);q.$options[F.name]=F;"initialValue"in F&&(q["$"+F.name]=F.initialValue)});h.implement(q,m);return this};this.resetOptions=
function(q){Object.keys(q.$options).forEach(function(r){var B=q.$options[r];"value"in B&&q.setOption(r,B.value)})};this.setDefaultValue=function(q,r,B){if(!q){for(q in this.$defaultOptions)if(this.$defaultOptions[q][r])break;if(!this.$defaultOptions[q][r])return!1}q=this.$defaultOptions[q]||(this.$defaultOptions[q]={});q[r]&&(q.forwardTo?this.setDefaultValue(q.forwardTo,r,B):q[r].value=B)};this.setDefaultValues=function(q,r){Object.keys(r).forEach(function(B){this.setDefaultValue(q,B,r[B])},this)};
this.warn=e;this.reportError=f}).call(l.prototype);b.AppConfig=l});
define("ace/config","require exports module ace/lib/lang ace/lib/oop ace/lib/net ace/lib/app_config".split(" "),function(a,b,l){function e(){B.basePath||B.workerPath||B.modePath||B.themePath||Object.keys(B.$moduleUrls).length||(console.error("Unable to infer path to ace from script src,","use ace.config.set('basePath', 'path') to enable dynamic loading of modes and themes","or with webpack use ace/webpack-resolver"),e=function(){})}function f(D){if(r&&r.document){B.packaged=D||a.packaged||l.packaged||
r.define&&define.packaged;D={};var F="",G=document.currentScript||document._currentScript;G=(G&&G.ownerDocument||document).getElementsByTagName("script");for(var N=0;N<G.length;N++){var T=G[N],V=T.src||T.getAttribute("src");if(V){T=T.attributes;for(var E=0,Q=T.length;E<Q;E++){var aa=T[E];0===aa.name.indexOf("data-ace-")&&(D[h(aa.name.replace(/^data-ace-/,""))]=aa.value)}(V=V.match(/^(.*)\/ace(\-\w+)?\.js(\?|$)/))&&(F=V[1])}}F&&(D.base=D.base||F,D.packaged=!0);D.basePath=D.base;D.workerPath=D.workerPath||
D.base;D.modePath=D.modePath||D.base;D.themePath=D.themePath||D.base;delete D.base;for(var qa in D)"undefined"!==typeof D[qa]&&b.set(qa,D[qa])}}function h(D){return D.replace(/-(.)/g,function(F,G){return G.toUpperCase()})}"no use strict";var g=a("./lib/lang");a("./lib/oop");var m=a("./lib/net"),q=a("./lib/app_config").AppConfig;l.exports=b=new q;var r=function(){return this||"undefined"!=typeof window&&window}(),B={packaged:!1,workerPath:null,modePath:null,themePath:null,basePath:"",suffix:".js",
$moduleUrls:{},loadWorkerFromBlob:!0,sharedPopups:!1};b.get=function(D){if(!B.hasOwnProperty(D))throw Error("Unknown config key: "+D);return B[D]};b.set=function(D,F){if(B.hasOwnProperty(D))B[D]=F;else if(0==this.setDefaultValue("",D,F))throw Error("Unknown config key: "+D);};b.all=function(){return g.copyObject(B)};b.$modes={};b.moduleUrl=function(D,F){if(B.$moduleUrls[D])return B.$moduleUrls[D];var G=D.split("/");F=F||G[G.length-2]||"";D="snippets"==F?"/":"-";var N=G[G.length-1];"worker"==F&&"-"==
D&&(N=N.replace(new RegExp("^"+F+"[\\-_]|[\\-_]"+F+"$","g"),""));(!N||N==F)&&1<G.length&&(N=G[G.length-2]);G=B[F+"Path"];null==G?G=B.basePath:"/"==D&&(F=D="");G&&"/"!=G.slice(-1)&&(G+="/");return G+F+D+N+this.get("suffix")};b.setModuleUrl=function(D,F){return B.$moduleUrls[D]=F};b.$loading={};b.loadModule=function(D,F){if(Array.isArray(D)){var G=D[0];D=D[1]}try{var N=a(D)}catch(T){}if(N&&!b.$loading[D])return F&&F(N);b.$loading[D]||(b.$loading[D]=[]);b.$loading[D].push(F);if(!(1<b.$loading[D].length)){F=
function(){a([D],function(T){b._emit("load.module",{name:D,module:T});var V=b.$loading[D];b.$loading[D]=null;V.forEach(function(E){E&&E(T)})})};if(!b.get("packaged"))return F();m.loadScript(b.moduleUrl(D,G),F);e()}};f(!0);b.init=f;b.version="1.4.10"});
define("ace/mouse/mouse_handler","require exports module ace/lib/event ace/lib/useragent ace/mouse/default_handlers ace/mouse/default_gutter_handler ace/mouse/mouse_event ace/mouse/dragdrop_handler ace/mouse/touch_handler ace/config".split(" "),function(a,b){function l(B){function D(){document.hasFocus&&document.hasFocus()&&(B.isFocused()||document.activeElement!=(B.textInput&&B.textInput.getElement()))||window.focus();B.focus()}var F=this;this.editor=B;new h(this);new g(this);new q(this);var G=B.renderer.getMouseEventTarget();
e.addListener(G,"click",this.onMouseEvent.bind(this,"click"),B);e.addListener(G,"mousemove",this.onMouseMove.bind(this,"mousemove"),B);e.addMultiMouseDownListener([G,B.renderer.scrollBarV&&B.renderer.scrollBarV.inner,B.renderer.scrollBarH&&B.renderer.scrollBarH.inner,B.textInput&&B.textInput.getElement()].filter(Boolean),[400,300,250],this,"onMouseEvent",B);e.addMouseWheelListener(B.container,this.onMouseWheel.bind(this,"mousewheel"),B);r(B.container,B);var N=B.renderer.$gutter;e.addListener(N,"mousedown",
this.onMouseEvent.bind(this,"guttermousedown"),B);e.addListener(N,"click",this.onMouseEvent.bind(this,"gutterclick"),B);e.addListener(N,"dblclick",this.onMouseEvent.bind(this,"gutterdblclick"),B);e.addListener(N,"mousemove",this.onMouseEvent.bind(this,"guttermousemove"),B);e.addListener(G,"mousedown",D,B);e.addListener(N,"mousedown",D,B);f.isIE&&B.renderer.scrollBarV&&(e.addListener(B.renderer.scrollBarV.element,"mousedown",D,B),e.addListener(B.renderer.scrollBarH.element,"mousedown",D,B));B.on("mousemove",
function(T){if(!F.state&&!F.$dragDelay&&F.$dragEnabled){T=B.renderer.screenToTextCoordinates(T.x,T.y);var V=B.session.selection.getRange(),E=B.renderer;!V.isEmpty()&&V.insideStart(T.row,T.column)?E.setCursorStyle("default"):E.setCursorStyle("")}},B)}var e=a("../lib/event"),f=a("../lib/useragent"),h=a("./default_handlers").DefaultHandlers,g=a("./default_gutter_handler").GutterHandler,m=a("./mouse_event").MouseEvent,q=a("./dragdrop_handler").DragdropHandler,r=a("./touch_handler").addTouchListeners;
a=a("../config");(function(){this.onMouseEvent=function(B,D){this.editor._emit(B,new m(D,this.editor))};this.onMouseMove=function(B,D){var F=this.editor._eventRegistry&&this.editor._eventRegistry.mousemove;F&&F.length&&this.editor._emit(B,new m(D,this.editor))};this.onMouseWheel=function(B,D){var F=new m(D,this.editor);F.speed=2*this.$scrollSpeed;F.wheelX=D.wheelX;F.wheelY=D.wheelY;this.editor._emit(B,F)};this.setState=function(B){this.state=B};this.captureMouse=function(B,D){function F(){Q.releaseMouse&&
V.curOp.command.name&&V.curOp.selectionChanged&&(Q[Q.state+"End"]&&Q[Q.state+"End"](),Q.state="",Q.releaseMouse())}function G(){Q[Q.state]&&Q[Q.state]();Q.$mouseMoved=!1}function N(qa){V.off("beforeEndOperation",F);clearInterval(aa);G();Q[Q.state+"End"]&&Q[Q.state+"End"](qa);Q.state="";Q.isMousePressed=E.$isMousePressed=!1;E.$keepTextAreaAtCursor&&E.$moveTextAreaToCursor();Q.$onCaptureMouseMove=Q.releaseMouse=null;qa&&Q.onMouseEvent("mouseup",qa);V.endOperation()}function T(qa){if(qa){if(f.isWebKit&&
!qa.which&&Q.releaseMouse)return Q.releaseMouse();Q.x=qa.clientX;Q.y=qa.clientY;D&&D(qa);Q.mouseEvent=new m(qa,Q.editor);Q.$mouseMoved=!0}}this.x=B.x;this.y=B.y;this.isMousePressed=!0;var V=this.editor,E=this.editor.renderer;E.$isMousePressed=!0;var Q=this;if(f.isOldIE&&"dblclick"==B.domEvent.type)return setTimeout(function(){N(B)});V.on("beforeEndOperation",F);V.startOperation({command:{name:"mouse"}});Q.$onCaptureMouseMove=T;Q.releaseMouse=e.capture(this.editor.container,T,N);var aa=setInterval(G,
20)};this.releaseMouse=null;this.cancelContextMenu=function(){var B=function(D){D&&D.domEvent&&"contextmenu"!=D.domEvent.type||(this.editor.off("nativecontextmenu",B),D&&D.domEvent&&e.stopEvent(D.domEvent))}.bind(this);setTimeout(B,10);this.editor.on("nativecontextmenu",B)}}).call(l.prototype);a.defineOptions(l.prototype,"mouseHandler",{scrollSpeed:{initialValue:2},dragDelay:{initialValue:f.isMac?150:0},dragEnabled:{initialValue:!0},focusTimeout:{initialValue:0},tooltipFollowsMouse:{initialValue:!0}});
b.MouseHandler=l});
define("ace/mouse/fold_handler",["require","exports","module","ace/lib/dom"],function(a,b){var l=a("../lib/dom");b.FoldHandler=function(e){e.on("click",function(f){var h=f.getDocumentPosition(),g=e.session;if(h=g.getFoldAt(h.row,h.column,1))f.getAccelKey()?g.removeFold(h):g.expandFold(h),f.stop();(f=f.domEvent&&f.domEvent.target)&&l.hasCssClass(f,"ace_inline_button")&&l.hasCssClass(f,"ace_toggle_wrap")&&(g.setOption("wrap",!g.getUseWrapMode()),e.renderer.scrollCursorIntoView())});e.on("gutterclick",
function(f){if("foldWidgets"==e.renderer.$gutterLayer.getRegion(f)){var h=f.getDocumentPosition().row,g=e.session;if(g.foldWidgets&&g.foldWidgets[h])e.session.onFoldWidgetClick(h,f);e.isFocused()||e.focus();f.stop()}});e.on("gutterdblclick",function(f){if("foldWidgets"==e.renderer.$gutterLayer.getRegion(f)){var h=f.getDocumentPosition().row,g=e.session,m=g.getParentFoldRangeData(h,!0);if(m=m.range||m.firstRange)h=m.start.row,(h=g.getFoldAt(h,g.getLine(h).length,1))?g.removeFold(h):(g.addFold("...",
m),e.renderer.scrollCursorIntoView({row:m.start.row,column:0}));f.stop()}})}});
define("ace/keyboard/keybinding",["require","exports","module","ace/lib/keys","ace/lib/event"],function(a,b){function l(h){this.$editor=h;this.$data={editor:h};this.$handlers=[];this.setDefaultHandler(h.commands)}var e=a("../lib/keys"),f=a("../lib/event");(function(){this.setDefaultHandler=function(h){this.removeKeyboardHandler(this.$defaultHandler);this.$defaultHandler=h;this.addKeyboardHandler(h,0)};this.setKeyboardHandler=function(h){var g=this.$handlers;if(g[g.length-1]!=h){for(;g[g.length-1]&&
g[g.length-1]!=this.$defaultHandler;)this.removeKeyboardHandler(g[g.length-1]);this.addKeyboardHandler(h,1)}};this.addKeyboardHandler=function(h,g){if(h){"function"!=typeof h||h.handleKeyboard||(h.handleKeyboard=h);var m=this.$handlers.indexOf(h);-1!=m&&this.$handlers.splice(m,1);void 0==g?this.$handlers.push(h):this.$handlers.splice(g,0,h);-1==m&&h.attach&&h.attach(this.$editor)}};this.removeKeyboardHandler=function(h){var g=this.$handlers.indexOf(h);if(-1==g)return!1;this.$handlers.splice(g,1);
h.detach&&h.detach(this.$editor);return!0};this.getKeyboardHandler=function(){return this.$handlers[this.$handlers.length-1]};this.getStatusText=function(){var h=this.$data,g=h.editor;return this.$handlers.map(function(m){return m.getStatusText&&m.getStatusText(g,h)||""}).filter(Boolean).join(" ")};this.$callKeyboardHandlers=function(h,g,m,q){for(var r,B=!1,D=this.$editor.commands,F=this.$handlers.length;F--&&!((r=this.$handlers[F].handleKeyboard(this.$data,h,g,m,q))&&r.command&&((B="null"==r.command?
!0:D.exec(r.command,this.$editor,r.args,q))&&q&&-1!=h&&1!=r.passEvent&&1!=r.command.passEvent&&f.stopEvent(q),B)););B||-1!=h||(r={command:"insertstring"},B=D.exec("insertstring",this.$editor,g));B&&this.$editor._signal&&this.$editor._signal("keyboardActivity",r);return B};this.onCommandKey=function(h,g,m){var q=e.keyCodeToString(m);return this.$callKeyboardHandlers(g,q,m,h)};this.onTextInput=function(h){return this.$callKeyboardHandlers(-1,h)}}).call(l.prototype);b.KeyBinding=l});
define("ace/lib/bidiutil",["require","exports","module"],function(a,b){function l(N,T,V){if(!(g<N))if(1!=N||1!=h||q)for(var E=V.length,Q=0,aa,qa,P;Q<E;){if(T[Q]>=N){for(aa=Q+1;aa<E&&T[aa]>=N;)aa++;for(qa=aa-1;Q<qa;Q++,qa--)P=V[Q],V[Q]=V[qa],V[qa]=P;Q=aa}Q++}else V.reverse()}function e(N,T,V,E){var Q=T[E],aa,qa;switch(Q){case 0:case 1:m=!1;case 4:case 3:return Q;case 2:return m?3:2;case 7:return m=!0,1;case 8:return 4;case 9:if(1>E||E+1>=T.length||2!=(aa=V[E-1])&&3!=aa||2!=(qa=T[E+1])&&3!=qa)return 4;
m&&(qa=3);return qa==aa?qa:4;case 10:return aa=0<E?V[E-1]:5,2==aa&&E+1<T.length&&2==T[E+1]?2:4;case 11:if(0<E&&2==V[E-1])return 2;if(m)return 4;aa=E+1;for(Q=T.length;aa<Q&&11==T[aa];)aa++;return aa<Q&&2==T[aa]?2:4;case 12:Q=T.length;for(aa=E+1;aa<Q&&12==T[aa];)aa++;return aa<Q&&(N=N[E],aa=T[aa],(1425<=N&&2303>=N||64286==N)&&(1==aa||7==aa))?1:1>E||5==T[E-1]?4:V[E-1];case 5:return m=!1,q=!0,h;case 6:return r=!0,4;case 13:case 14:case 16:case 17:case 15:m=!1;case 18:return 4}}function f(N){var T=N.charCodeAt(0),
V=T>>8;return 0==V?191<T?0:F[T]:5==V?/[\u0591-\u05f4]/.test(N)?1:0:6==V?/[\u0610-\u061a\u064b-\u065f\u06d6-\u06e4\u06e7-\u06ed]/.test(N)?12:/[\u0660-\u0669\u066b-\u066c]/.test(N)?3:1642==T?11:/[\u06f0-\u06f9]/.test(N)?2:7:32==V&&8287>=T?G[T&255]:254==V?65136<=T?7:4:4}var h=0,g=0,m=!1,q=!1,r=!1,B=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],D=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],F=[18,18,18,18,18,18,18,18,18,6,5,
6,8,5,18,18,18,18,18,18,18,18,18,18,18,18,18,18,5,5,5,6,8,4,4,11,11,11,4,4,4,4,4,10,9,10,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,18,18,18,18,18,18,5,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,9,4,11,11,11,11,4,4,4,4,0,4,4,18,4,4,11,11,2,2,4,0,4,4,4,2,0,4,4,4,4,4],G=[8,8,8,8,8,8,8,8,8,8,8,18,18,18,0,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
4,4,4,8,5,13,14,15,16,17,9,11,11,11,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8];b.L=0;b.R=1;b.EN=2;b.ON_R=3;b.AN=4;b.R_H=5;b.B=6;b.RLE=7;b.DOT="\u00b7";b.doBidiReorder=function(N,T,V){if(2>N.length)return{};N=N.split("");var E=Array(N.length),Q=Array(N.length),aa=[];h=V?1:0;V=N.length;var qa=T,P=h?D:B;var ea=0;var ua=-1,Fa,pa=[];if(!qa){var ra=0;for(qa=[];ra<V;ra++)qa[ra]=f(N[ra])}g=h;r=q=m=!1;for(Fa=0;Fa<V;Fa++){var Ca=ea;pa[Fa]=ea=e(N,qa,pa,Fa);ea=
P[Ca][ea];ra=ea&240;ea&=15;aa[Fa]=Ca=P[ea][5];if(0<ra){if(16==ra)for(ra=ua;ra<Fa;ra++)aa[ra]=1;ua=-1}if(ra=P[ea][6])-1==ua&&(ua=Fa);else if(-1<ua){for(ra=ua;ra<Fa;ra++)aa[ra]=Ca;ua=-1}5==qa[Fa]&&(aa[Fa]=0);g|=Ca}if(r)for(ra=0;ra<V;ra++)if(6==qa[ra])for(aa[ra]=h,P=ra-1;0<=P;P--)if(8==qa[P])aa[P]=h;else break;for(V=0;V<E.length;E[V]=V,V++);l(2,aa,E);l(1,aa,E);for(V=0;V<E.length-1;V++)3===T[V]?aa[V]=b.AN:1===aa[V]&&(7<T[V]&&13>T[V]||4===T[V]||18===T[V])?aa[V]=b.ON_R:0<V&&"\u0644"===N[V-1]&&/\u0622|\u0623|\u0625|\u0627/.test(N[V])&&
(aa[V-1]=aa[V]=b.R_H,V++);N[N.length-1]===b.DOT&&(aa[N.length-1]=b.B);"\u202b"===N[0]&&(aa[0]=b.RLE);for(V=0;V<E.length;V++)Q[V]=aa[E[V]];return{logicalFromVisual:E,bidiLevels:Q}};b.hasBidiCharacters=function(N,T){for(var V=!1,E=0;E<N.length;E++)T[E]=f(N.charAt(E)),V||1!=T[E]&&7!=T[E]&&3!=T[E]||(V=!0);return V};b.getVisualFromLogicalIdx=function(N,T){for(var V=0;V<T.logicalFromVisual.length;V++)if(T.logicalFromVisual[V]==N)return V;return 0}});
define("ace/bidihandler",["require","exports","module","ace/lib/bidiutil","ace/lib/lang"],function(a,b){function l(g){this.session=g;this.bidiMap={};this.currentRow=null;this.bidiUtil=e;this.charWidths=[];this.EOL="\u00ac";this.showInvisibles=!0;this.$isRtl=this.isRtlDir=!1;this.line="";this.wrapIndent=0;this.EOF="\u00b6";this.RLE="\u202b";this.contentWidth=0;this.fontMetrics=null;this.wrapOffset=this.rtlLineOffset=0;this.isMoveLeftOperation=!1;this.seenBidi=h.test(g.getValue())}var e=a("./lib/bidiutil"),
f=a("./lib/lang"),h=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\u202B]/;(function(){this.isBidiRow=function(g,m,q){if(!this.seenBidi)return!1;g!==this.currentRow&&(this.currentRow=g,this.updateRowLine(m,q),this.updateBidiMap());return this.bidiMap.bidiLevels};this.onChange=function(g){this.seenBidi?this.currentRow=null:"insert"==g.action&&h.test(g.lines.join("\n"))&&(this.seenBidi=!0,this.currentRow=null)};this.getDocumentRow=function(){var g=0,m=this.session.$screenRowCache;m.length&&(m=this.session.$getRowCacheIndex(m,
this.currentRow),0<=m&&(g=this.session.$docRowCache[m]));return g};this.getSplitIndex=function(){var g=0,m=this.session.$screenRowCache;if(m.length)for(var q,r=this.session.$getRowCacheIndex(m,this.currentRow);0<this.currentRow-g;){q=this.session.$getRowCacheIndex(m,this.currentRow-g-1);if(q!==r)break;r=q;g++}else g=this.currentRow;return g};this.updateRowLine=function(g,m){void 0===g&&(g=this.getDocumentRow());var q=g===this.session.getLength()-1?this.EOF:this.EOL;this.wrapIndent=0;this.line=this.session.getLine(g);
this.isRtlDir=this.$isRtl||this.line.charAt(0)===this.RLE;if(this.session.$useWrapMode){if(g=this.session.$wrapData[g])void 0===m&&(m=this.getSplitIndex()),0<m&&g.length?(this.wrapIndent=g.indent,this.wrapOffset=this.wrapIndent*this.charWidths[e.L],this.line=m<g.length?this.line.substring(g[m-1],g[m]):this.line.substring(g[g.length-1])):this.line=this.line.substring(0,g[m]);m==g.length&&(this.line+=this.showInvisibles?q:e.DOT)}else this.line+=this.showInvisibles?q:e.DOT;var r=this.session,B=0,D;this.line=
this.line.replace(/\t|[\u1100-\u2029, \u202F-\uFFE6]/g,function(F,G){return"\t"===F||r.isFullWidth(F.charCodeAt(0))?(D="\t"===F?r.getScreenTabSize(G+B):2,B+=D-1,f.stringRepeat(e.DOT,D)):F});this.isRtlDir&&(this.fontMetrics.$main.textContent=this.line.charAt(this.line.length-1)==e.DOT?this.line.substr(0,this.line.length-1):this.line,this.rtlLineOffset=this.contentWidth-this.fontMetrics.$main.getBoundingClientRect().width)};this.updateBidiMap=function(){var g=[];e.hasBidiCharacters(this.line,g)||this.isRtlDir?
this.bidiMap=e.doBidiReorder(this.line,g,this.isRtlDir):this.bidiMap={}};this.markAsDirty=function(){this.currentRow=null};this.updateCharacterWidths=function(g){if(this.characterWidth!==g.$characterSize.width){this.fontMetrics=g;var m=this.characterWidth=g.$characterSize.width;g=g.$measureCharWidth("\u05d4");this.charWidths[e.L]=this.charWidths[e.EN]=this.charWidths[e.ON_R]=m;this.charWidths[e.R]=this.charWidths[e.AN]=g;this.charWidths[e.R_H]=.45*g;this.charWidths[e.B]=this.charWidths[e.RLE]=0;this.currentRow=
null}};this.setShowInvisibles=function(g){this.showInvisibles=g;this.currentRow=null};this.setEolChar=function(g){this.EOL=g};this.setContentWidth=function(g){this.contentWidth=g};this.isRtlLine=function(g){return this.$isRtl?!0:void 0!=g?this.session.getLine(g).charAt(0)==this.RLE:this.isRtlDir};this.setRtlDirection=function(g,m){for(var q=g.getCursorPosition(),r=g.selection.getSelectionAnchor().row;r<=q.row;r++)m||g.session.getLine(r).charAt(0)!==g.session.$bidiHandler.RLE?m&&g.session.getLine(r).charAt(0)!==
g.session.$bidiHandler.RLE&&g.session.doc.insert({column:0,row:r},g.session.$bidiHandler.RLE):g.session.doc.removeInLine(r,0,1)};this.getPosLeft=function(g){g-=this.wrapIndent;var m=this.line.charAt(0)===this.RLE?1:0,q=g>m?this.session.getOverwrite()?g:g-1:m;q=e.getVisualFromLogicalIdx(q,this.bidiMap);var r=this.bidiMap.bidiLevels,B=0;!this.session.getOverwrite()&&g<=m&&0!==r[q]%2&&q++;for(var D=0;D<q;D++)B+=this.charWidths[r[D]];!this.session.getOverwrite()&&g>m&&0===r[q]%2&&(B+=this.charWidths[r[q]]);
this.wrapIndent&&(B+=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset);this.isRtlDir&&(B+=this.rtlLineOffset);return B};this.getSelections=function(g,m){var q=this.bidiMap,r=q.bidiLevels,B=[],D=0,F=Math.min(g,m)-this.wrapIndent;m=Math.max(g,m)-this.wrapIndent;var G=!1,N=!1,T=0;this.wrapIndent&&(D+=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset);for(var V=0;V<r.length;V++)G=q.logicalFromVisual[V],g=r[V],(G=G>=F&&G<m)&&!N?T=D:!G&&N&&B.push({left:T,width:D-T}),D+=this.charWidths[g],N=G;G&&V===r.length&&
B.push({left:T,width:D-T});if(this.isRtlDir)for(q=0;q<B.length;q++)B[q].left+=this.rtlLineOffset;return B};this.offsetToCol=function(g){this.isRtlDir&&(g-=this.rtlLineOffset);g=Math.max(g,0);var m=0,q=0,r=this.bidiMap.bidiLevels,B=this.charWidths[r[q]];for(this.wrapIndent&&(g-=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset);g>m+B/2;){m+=B;if(q===r.length-1){B=0;break}B=this.charWidths[r[++q]]}0<q&&0!==r[q-1]%2&&0===r[q]%2?(g<m&&q--,g=this.bidiMap.logicalFromVisual[q]):0<q&&0===r[q-1]%2&&0!==r[q]%
2?g=1+(g>m?this.bidiMap.logicalFromVisual[q]:this.bidiMap.logicalFromVisual[q-1]):this.isRtlDir&&q===r.length-1&&0===B&&0===r[q-1]%2||!this.isRtlDir&&0===q&&0!==r[q]%2?g=1+this.bidiMap.logicalFromVisual[q]:(0<q&&0!==r[q-1]%2&&0!==B&&q--,g=this.bidiMap.logicalFromVisual[q]);0===g&&this.isRtlDir&&g++;return g+this.wrapIndent}}).call(l.prototype);b.BidiHandler=l});
define("ace/selection","require exports module ace/lib/oop ace/lib/lang ace/lib/event_emitter ace/range".split(" "),function(a,b){function l(m){this.session=m;this.doc=m.getDocument();this.clearSelection();this.cursor=this.lead=this.doc.createAnchor(0,0);this.anchor=this.doc.createAnchor(0,0);this.$silent=!1;var q=this;this.cursor.on("change",function(r){q.$cursorChanged=!0;q.$silent||q._emit("changeCursor");q.$isEmpty||q.$silent||q._emit("changeSelection");q.$keepDesiredColumnOnChange||r.old.column==
r.value.column||(q.$desiredColumn=null)});this.anchor.on("change",function(){q.$anchorChanged=!0;q.$isEmpty||q.$silent||q._emit("changeSelection")})}var e=a("./lib/oop"),f=a("./lib/lang"),h=a("./lib/event_emitter").EventEmitter,g=a("./range").Range;(function(){e.implement(this,h);this.isEmpty=function(){return this.$isEmpty||this.anchor.row==this.lead.row&&this.anchor.column==this.lead.column};this.isMultiLine=function(){return!this.$isEmpty&&this.anchor.row!=this.cursor.row};this.getCursor=function(){return this.lead.getPosition()};
this.setSelectionAnchor=function(m,q){this.$isEmpty=!1;this.anchor.setPosition(m,q)};this.getAnchor=this.getSelectionAnchor=function(){return this.$isEmpty?this.getSelectionLead():this.anchor.getPosition()};this.getSelectionLead=function(){return this.lead.getPosition()};this.isBackwards=function(){var m=this.anchor,q=this.lead;return m.row>q.row||m.row==q.row&&m.column>q.column};this.getRange=function(){var m=this.anchor,q=this.lead;return this.$isEmpty?g.fromPoints(q,q):this.isBackwards()?g.fromPoints(q,
m):g.fromPoints(m,q)};this.clearSelection=function(){this.$isEmpty||(this.$isEmpty=!0,this._emit("changeSelection"))};this.selectAll=function(){this.$setSelection(0,0,Number.MAX_VALUE,Number.MAX_VALUE)};this.setRange=this.setSelectionRange=function(m,q){var r=q?m.end:m.start;m=q?m.start:m.end;this.$setSelection(r.row,r.column,m.row,m.column)};this.$setSelection=function(m,q,r,B){if(!this.$silent){var D=this.$isEmpty,F=this.inMultiSelectMode;this.$silent=!0;this.$cursorChanged=this.$anchorChanged=
!1;this.anchor.setPosition(m,q);this.cursor.setPosition(r,B);this.$isEmpty=!g.comparePoints(this.anchor,this.cursor);this.$silent=!1;this.$cursorChanged&&this._emit("changeCursor");(this.$cursorChanged||this.$anchorChanged||D!=this.$isEmpty||F)&&this._emit("changeSelection")}};this.$moveSelection=function(m){var q=this.lead;this.$isEmpty&&this.setSelectionAnchor(q.row,q.column);m.call(this)};this.selectTo=function(m,q){this.$moveSelection(function(){this.moveCursorTo(m,q)})};this.selectToPosition=
function(m){this.$moveSelection(function(){this.moveCursorToPosition(m)})};this.moveTo=function(m,q){this.clearSelection();this.moveCursorTo(m,q)};this.moveToPosition=function(m){this.clearSelection();this.moveCursorToPosition(m)};this.selectUp=function(){this.$moveSelection(this.moveCursorUp)};this.selectDown=function(){this.$moveSelection(this.moveCursorDown)};this.selectRight=function(){this.$moveSelection(this.moveCursorRight)};this.selectLeft=function(){this.$moveSelection(this.moveCursorLeft)};
this.selectLineStart=function(){this.$moveSelection(this.moveCursorLineStart)};this.selectLineEnd=function(){this.$moveSelection(this.moveCursorLineEnd)};this.selectFileEnd=function(){this.$moveSelection(this.moveCursorFileEnd)};this.selectFileStart=function(){this.$moveSelection(this.moveCursorFileStart)};this.selectWordRight=function(){this.$moveSelection(this.moveCursorWordRight)};this.selectWordLeft=function(){this.$moveSelection(this.moveCursorWordLeft)};this.getWordRange=function(m,q){"undefined"==
typeof q&&(q=m||this.lead,m=q.row,q=q.column);return this.session.getWordRange(m,q)};this.selectWord=function(){this.setSelectionRange(this.getWordRange())};this.selectAWord=function(){var m=this.getCursor();m=this.session.getAWordRange(m.row,m.column);this.setSelectionRange(m)};this.getLineRange=function(m,q){m="number"==typeof m?m:this.lead.row;var r;(r=this.session.getFoldLine(m))?(m=r.start.row,r=r.end.row):r=m;return!0===q?new g(m,0,r,this.session.getLine(r).length):new g(m,0,r+1,0)};this.selectLine=
function(){this.setSelectionRange(this.getLineRange())};this.moveCursorUp=function(){this.moveCursorBy(-1,0)};this.moveCursorDown=function(){this.moveCursorBy(1,0)};this.wouldMoveIntoSoftTab=function(m,q,r){var B=m.column,D=m.column+q;0>r&&(B=m.column-q,D=m.column);return this.session.isTabStop(m)&&this.doc.getLine(m.row).slice(B,D).split(" ").length-1==q};this.moveCursorLeft=function(){var m=this.lead.getPosition(),q;(q=this.session.getFoldAt(m.row,m.column,-1))?this.moveCursorTo(q.start.row,q.start.column):
0===m.column?0<m.row&&this.moveCursorTo(m.row-1,this.doc.getLine(m.row-1).length):(q=this.session.getTabSize(),this.wouldMoveIntoSoftTab(m,q,-1)&&!this.session.getNavigateWithinSoftTabs()?this.moveCursorBy(0,-q):this.moveCursorBy(0,-1))};this.moveCursorRight=function(){var m=this.lead.getPosition();if(m=this.session.getFoldAt(m.row,m.column,1))this.moveCursorTo(m.end.row,m.end.column);else if(this.lead.column==this.doc.getLine(this.lead.row).length)this.lead.row<this.doc.getLength()-1&&this.moveCursorTo(this.lead.row+
1,0);else{var q=this.session.getTabSize();m=this.lead;this.wouldMoveIntoSoftTab(m,q,1)&&!this.session.getNavigateWithinSoftTabs()?this.moveCursorBy(0,q):this.moveCursorBy(0,1)}};this.moveCursorLineStart=function(){var m=this.lead.row,q=this.lead.column,r=this.session.documentToScreenRow(m,q);r=this.session.screenToDocumentPosition(r,0);m=this.session.getDisplayLine(m,null,r.row,r.column).match(/^\s*/);m[0].length==q||this.session.$useEmacsStyleLineStart||(r.column+=m[0].length);this.moveCursorToPosition(r)};
this.moveCursorLineEnd=function(){var m=this.lead;m=this.session.getDocumentLastRowColumnPosition(m.row,m.column);if(this.lead.column==m.column){var q=this.session.getLine(m.row);m.column==q.length&&(q=q.search(/\s+$/),0<q&&(m.column=q))}this.moveCursorTo(m.row,m.column)};this.moveCursorFileEnd=function(){var m=this.doc.getLength()-1,q=this.doc.getLine(m).length;this.moveCursorTo(m,q)};this.moveCursorFileStart=function(){this.moveCursorTo(0,0)};this.moveCursorLongWordRight=function(){var m=this.lead.row,
q=this.lead.column,r=this.doc.getLine(m),B=r.substring(q);this.session.nonTokenRe.lastIndex=0;this.session.tokenRe.lastIndex=0;var D=this.session.getFoldAt(m,q,1);D?this.moveCursorTo(D.end.row,D.end.column):(this.session.nonTokenRe.exec(B)&&(q+=this.session.nonTokenRe.lastIndex,this.session.nonTokenRe.lastIndex=0,B=r.substring(q)),q>=r.length?(this.moveCursorTo(m,r.length),this.moveCursorRight(),m<this.doc.getLength()-1&&this.moveCursorWordRight()):(this.session.tokenRe.exec(B)&&(q+=this.session.tokenRe.lastIndex,
this.session.tokenRe.lastIndex=0),this.moveCursorTo(m,q)))};this.moveCursorLongWordLeft=function(){var m=this.lead.row,q=this.lead.column,r;(r=this.session.getFoldAt(m,q,-1))?this.moveCursorTo(r.start.row,r.start.column):(r=this.session.getFoldStringAt(m,q,-1),null==r&&(r=this.doc.getLine(m).substring(0,q)),r=f.stringReverse(r),this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0,this.session.nonTokenRe.exec(r)&&(q-=this.session.nonTokenRe.lastIndex,r=r.slice(this.session.nonTokenRe.lastIndex),
this.session.nonTokenRe.lastIndex=0),0>=q?(this.moveCursorTo(m,0),this.moveCursorLeft(),0<m&&this.moveCursorWordLeft()):(this.session.tokenRe.exec(r)&&(q-=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0),this.moveCursorTo(m,q)))};this.$shortWordEndIndex=function(m){var q=0,r,B=/\s/,D=this.session.tokenRe;D.lastIndex=0;if(this.session.tokenRe.exec(m))q=this.session.tokenRe.lastIndex;else{for(;(r=m[q])&&B.test(r);)q++;if(1>q)for(D.lastIndex=0;(r=m[q])&&!D.test(r);)if(D.lastIndex=0,q++,
B.test(r))if(2<q){q--;break}else{for(;(r=m[q])&&B.test(r);)q++;if(2<q)break}}D.lastIndex=0;return q};this.moveCursorShortWordRight=function(){var m=this.lead.row,q=this.lead.column,r=this.doc.getLine(m),B=r.substring(q),D=this.session.getFoldAt(m,q,1);if(D)return this.moveCursorTo(D.end.row,D.end.column);if(q==r.length){q=this.doc.getLength();do m++,B=this.doc.getLine(m);while(m<q&&/^\s*$/.test(B));/^\s+/.test(B)||(B="");q=0}B=this.$shortWordEndIndex(B);this.moveCursorTo(m,q+B)};this.moveCursorShortWordLeft=
function(){var m=this.lead.row,q=this.lead.column,r;if(r=this.session.getFoldAt(m,q,-1))return this.moveCursorTo(r.start.row,r.start.column);r=this.session.getLine(m).substring(0,q);if(0===q){do m--,r=this.doc.getLine(m);while(0<m&&/^\s*$/.test(r));q=r.length;/\s+$/.test(r)||(r="")}r=f.stringReverse(r);r=this.$shortWordEndIndex(r);return this.moveCursorTo(m,q-r)};this.moveCursorWordRight=function(){this.session.$selectLongWords?this.moveCursorLongWordRight():this.moveCursorShortWordRight()};this.moveCursorWordLeft=
function(){this.session.$selectLongWords?this.moveCursorLongWordLeft():this.moveCursorShortWordLeft()};this.moveCursorBy=function(m,q){var r=this.session.documentToScreenPosition(this.lead.row,this.lead.column);if(0===q){if(0!==m)if(this.session.$bidiHandler.isBidiRow(r.row,this.lead.row)){var B=this.session.$bidiHandler.getPosLeft(r.column);r.column=Math.round(B/this.session.$bidiHandler.charWidths[0])}else B=r.column*this.session.$bidiHandler.charWidths[0];this.$desiredColumn?r.column=this.$desiredColumn:
this.$desiredColumn=r.column}if(0!=m&&this.session.lineWidgets&&this.session.lineWidgets[this.lead.row]){var D=this.session.lineWidgets[this.lead.row];0>m?m-=D.rowsAbove||0:0<m&&(m+=D.rowCount-(D.rowsAbove||0))}m=this.session.screenToDocumentPosition(r.row+m,r.column,B);this.moveCursorTo(m.row,m.column+q,0===q)};this.moveCursorToPosition=function(m){this.moveCursorTo(m.row,m.column)};this.moveCursorTo=function(m,q,r){var B=this.session.getFoldAt(m,q,1);B&&(m=B.start.row,q=B.start.column);this.$keepDesiredColumnOnChange=
!0;B=this.session.getLine(m);/[\uDC00-\uDFFF]/.test(B.charAt(q))&&B.charAt(q-1)&&(q=this.lead.row==m&&this.lead.column==q+1?q-1:q+1);this.lead.setPosition(m,q);this.$keepDesiredColumnOnChange=!1;r||(this.$desiredColumn=null)};this.moveCursorToScreen=function(m,q,r){m=this.session.screenToDocumentPosition(m,q);this.moveCursorTo(m.row,m.column,r)};this.detach=function(){this.lead.detach();this.anchor.detach();this.session=this.doc=null};this.fromOrientedRange=function(m){this.setSelectionRange(m,m.cursor==
m.start);this.$desiredColumn=m.desiredColumn||this.$desiredColumn};this.toOrientedRange=function(m){var q=this.getRange();m?(m.start.column=q.start.column,m.start.row=q.start.row,m.end.column=q.end.column,m.end.row=q.end.row):m=q;m.cursor=this.isBackwards()?m.start:m.end;m.desiredColumn=this.$desiredColumn;return m};this.getRangeOfMovements=function(m){var q=this.getCursor();try{m(this);var r=this.getCursor();return g.fromPoints(q,r)}catch(B){return g.fromPoints(q,q)}finally{this.moveCursorToPosition(q)}};
this.toJSON=function(){if(this.rangeCount)var m=this.ranges.map(function(q){var r=q.clone();r.isBackwards=q.cursor==q.start;return r});else m=this.getRange(),m.isBackwards=this.isBackwards();return m};this.fromJSON=function(m){if(void 0==m.start){if(this.rangeList&&1<m.length){this.toSingleRange(m[0]);for(var q=m.length;q--;){var r=g.fromPoints(m[q].start,m[q].end);m[q].isBackwards&&(r.cursor=r.start);this.addRange(r,!0)}return}m=m[0]}this.rangeList&&this.toSingleRange(m);this.setSelectionRange(m,
m.isBackwards)};this.isEqual=function(m){if((m.length||this.rangeCount)&&m.length!=this.rangeCount)return!1;if(!m.length||!this.ranges)return this.getRange().isEqual(m);for(var q=this.ranges.length;q--;)if(!this.ranges[q].isEqual(m[q]))return!1;return!0}}).call(l.prototype);b.Selection=l});
define("ace/tokenizer",["require","exports","module","ace/config"],function(a,b){function l(h){this.states=h;this.regExps={};this.matchMappings={};for(var g in this.states){h=this.states[g];for(var m=[],q=0,r=this.matchMappings[g]={defaultToken:"text"},B="g",D=[],F=0;F<h.length;F++){var G=h[F];G.defaultToken&&(r.defaultToken=G.defaultToken);G.caseInsensitive&&(B="gi");if(null!=G.regex){G.regex instanceof RegExp&&(G.regex=G.regex.toString().slice(1,-1));var N=G.regex,T=(new RegExp("(?:("+N+")|(.))")).exec("a").length-
2;Array.isArray(G.token)?1==G.token.length||1==T?G.token=G.token[0]:T-1!=G.token.length?(this.reportError("number of classes and regexp groups doesn't match",{rule:G,groupCount:T-1}),G.token=G.token[0]):(G.tokenArray=G.token,G.token=null,G.onMatch=this.$arrayTokens):"function"!=typeof G.token||G.onMatch||(G.onMatch=1<T?this.$applyToken:G.token);1<T&&(/\\\d/.test(G.regex)?N=G.regex.replace(/\\([0-9]+)/g,function(V,E){return"\\"+(parseInt(E,10)+q+1)}):(T=1,N=this.removeCapturingGroups(G.regex)),G.splitRegex||
"string"==typeof G.token||D.push(G));r[q]=F;q+=T;m.push(N);G.onMatch||(G.onMatch=null)}}m.length||(r[0]=0,m.push("$"));D.forEach(function(V){V.splitRegex=this.createSplitterRegexp(V.regex,B)},this);this.regExps[g]=new RegExp("("+m.join(")|(")+")|($)",B)}}var e=a("./config"),f=2E3;(function(){this.$setMaxTokenCount=function(h){f=h|0};this.$applyToken=function(h){var g=this.splitRegex.exec(h).slice(1),m=this.token.apply(this,g);if("string"===typeof m)return[{type:m,value:h}];h=[];for(var q=0,r=m.length;q<
r;q++)g[q]&&(h[h.length]={type:m[q],value:g[q]});return h};this.$arrayTokens=function(h){if(!h)return[];h=this.splitRegex.exec(h);if(!h)return"text";for(var g=[],m=this.tokenArray,q=0,r=m.length;q<r;q++)h[q+1]&&(g[g.length]={type:m[q],value:h[q+1]});return g};this.removeCapturingGroups=function(h){return h.replace(/\\.|\[(?:\\.|[^\\\]])*|\(\?[:=!]|(\()/g,function(g,m){return m?"(?:":g})};this.createSplitterRegexp=function(h,g){if(-1!=h.indexOf("(?=")){var m=0,q=!1,r={};h.replace(/(\\.)|(\((?:\?[=!])?)|(\))|([\[\]])/g,
function(B,D,F,G,N,T){q?q="]"!=N:N?q=!0:G?(m==r.stack&&(r.end=T+1,r.stack=-1),m--):F&&(m++,1!=F.length&&(r.stack=m,r.start=T));return B});null!=r.end&&/^\)*$/.test(h.substr(r.end))&&(h=h.substring(0,r.start)+h.substr(r.end))}"^"!=h.charAt(0)&&(h="^"+h);"$"!=h.charAt(h.length-1)&&(h+="$");return new RegExp(h,(g||"").replace("g",""))};this.getLineTokens=function(h,g){if(g&&"string"!=typeof g){var m=g.slice(0);g=m[0];"#tmp"===g&&(m.shift(),g=m.shift())}else m=[];var q=g||"start",r=this.states[q];r||
(q="start",r=this.states[q]);var B=this.matchMappings[q],D=this.regExps[q];D.lastIndex=0;for(var F,G=[],N=0,T=0,V={type:null,value:""};F=D.exec(h);){var E=B.defaultToken,Q=null,aa=F[0],qa=D.lastIndex;if(qa-aa.length>N){var P=h.substring(N,qa-aa.length);V.type==E?V.value+=P:(V.type&&G.push(V),V={type:E,value:P})}for(P=0;P<F.length-2;P++)if(void 0!==F[P+1]){Q=r[B[P]];E=Q.onMatch?Q.onMatch(aa,q,m,h):Q.token;Q.next&&(q="string"==typeof Q.next?Q.next:Q.next(q,m),r=this.states[q],r||(this.reportError("state doesn't exist",
q),q="start",r=this.states[q]),B=this.matchMappings[q],N=qa,D=this.regExps[q],D.lastIndex=qa);Q.consumeLineEnd&&(N=qa);break}if(aa)if("string"===typeof E)Q&&!1===Q.merge||V.type!==E?(V.type&&G.push(V),V={type:E,value:aa}):V.value+=aa;else if(E)for(V.type&&G.push(V),V={type:null,value:""},P=0;P<E.length;P++)G.push(E[P]);if(N==h.length)break;N=qa;if(T++>f){for(T>2*h.length&&this.reportError("infinite loop with in ace tokenizer",{startState:g,line:h});N<h.length;)V.type&&G.push(V),V={value:h.substring(N,
N+=500),type:"overflow"};q="start";m=[];break}}V.type&&G.push(V);1<m.length&&m[0]!==q&&m.unshift("#tmp",q);return{tokens:G,state:m.length?m:q}};this.reportError=e.reportError}).call(l.prototype);b.Tokenizer=l});
define("ace/mode/text_highlight_rules",["require","exports","module","ace/lib/lang"],function(a,b){function l(){this.$rules={start:[{token:"empty_line",regex:"^$"},{defaultToken:"text"}]}}var e=a("../lib/lang");(function(){function f(g,m){m.shift();return m.shift()||"start"}function h(g,m){("start"!=g||m.length)&&m.unshift(this.nextState,g);return this.nextState}this.addRules=function(g,m){if(m)for(D in g){for(var q=g[D],r=0;r<q.length;r++){var B=q[r];if(B.next||B.onMatch)"string"==typeof B.next&&
0!==B.next.indexOf(m)&&(B.next=m+B.next),B.nextState&&0!==B.nextState.indexOf(m)&&(B.nextState=m+B.nextState)}this.$rules[m+D]=q}else for(var D in g)this.$rules[D]=g[D]};this.getRules=function(){return this.$rules};this.embedRules=function(g,m,q,r,B){g="function"==typeof g?(new g).getRules():g;if(r)for(var D=0;D<r.length;D++)r[D]=m+r[D];else for(D in r=[],g)r.push(m+D);this.addRules(g,m);if(q)for(B=Array.prototype[B?"push":"unshift"],D=0;D<r.length;D++)B.apply(this.$rules[r[D]],e.deepCopy(q));this.$embeds||
(this.$embeds=[]);this.$embeds.push(m)};this.getEmbeds=function(){return this.$embeds};this.normalizeRules=function(){function g(r){r=q[r];r.processed=!0;for(var B=0;B<r.length;B++){var D=r[B],F=null;Array.isArray(D)&&(F=D,D={});!D.regex&&D.start&&(D.regex=D.start,D.next||(D.next=[]),D.next.push({defaultToken:D.token},{token:D.token+".end",regex:D.end||D.start,next:"pop"}),D.token+=".start",D.push=!0);var G=D.next||D.push;if(G&&Array.isArray(G)){var N=D.stateName;N||(N=D.token,"string"!=typeof N&&
(N=N[0]||""),q[N]&&(N+=m++));q[N]=G;D.next=N;g(N)}else"pop"==G&&(D.next=f);D.push&&(D.nextState=D.next||D.push,D.next=h,delete D.push);if(D.rules)for(var T in D.rules)q[T]?q[T].push&&q[T].push.apply(q[T],D.rules[T]):q[T]=D.rules[T];(G="string"==typeof D?D:D.include)&&(F=Array.isArray(G)?G.map(function(V){return q[V]}):q[G]);F&&(F=[B,1].concat(F),D.noEscape&&(F=F.filter(function(V){return!V.next})),r.splice.apply(r,F),B--);D.keywordMap&&(D.token=this.createKeywordMapper(D.keywordMap,D.defaultToken||
"text",D.caseInsensitive),delete D.defaultToken)}}var m=0,q=this.$rules;Object.keys(q).forEach(g,this)};this.createKeywordMapper=function(g,m,q,r){var B=Object.create(null);Object.keys(g).forEach(function(D){var F=g[D];q&&(F=F.toLowerCase());F=F.split(r||"|");for(var G=F.length;G--;)B[F[G]]=D});Object.getPrototypeOf(B)&&(B.__proto__=null);this.$keywordList=Object.keys(B);g=null;return q?function(D){return B[D.toLowerCase()]||m}:function(D){return B[D]||m}};this.getKeywords=function(){return this.$keywords}}).call(l.prototype);
b.TextHighlightRules=l});
define("ace/mode/behaviour",["require","exports","module"],function(a,b){function l(){this.$behaviours={}}(function(){this.add=function(e,f,h){switch(void 0){case this.$behaviours:this.$behaviours={};case this.$behaviours[e]:this.$behaviours[e]={}}this.$behaviours[e][f]=h};this.addBehaviours=function(e){for(var f in e)for(var h in e[f])this.add(f,h,e[f][h])};this.remove=function(e){this.$behaviours&&this.$behaviours[e]&&delete this.$behaviours[e]};this.inherit=function(e,f){e="function"===typeof e?
(new e).getBehaviours(f):e.getBehaviours(f);this.addBehaviours(e)};this.getBehaviours=function(e){if(e){for(var f={},h=0;h<e.length;h++)this.$behaviours[e[h]]&&(f[e[h]]=this.$behaviours[e[h]]);return f}return this.$behaviours}}).call(l.prototype);b.Behaviour=l});
define("ace/token_iterator",["require","exports","module","ace/range"],function(a,b){function l(f,h,g){this.$session=f;this.$row=h;this.$rowTokens=f.getTokens(h);this.$tokenIndex=(f=f.getTokenAt(h,g))?f.index:-1}var e=a("./range").Range;(function(){this.stepBackward=function(){for(--this.$tokenIndex;0>this.$tokenIndex;){--this.$row;if(0>this.$row)return this.$row=0,null;this.$rowTokens=this.$session.getTokens(this.$row);this.$tokenIndex=this.$rowTokens.length-1}return this.$rowTokens[this.$tokenIndex]};
this.stepForward=function(){this.$tokenIndex+=1;for(var f;this.$tokenIndex>=this.$rowTokens.length;){this.$row+=1;f||=this.$session.getLength();if(this.$row>=f)return this.$row=f-1,null;this.$rowTokens=this.$session.getTokens(this.$row);this.$tokenIndex=0}return this.$rowTokens[this.$tokenIndex]};this.getCurrentToken=function(){return this.$rowTokens[this.$tokenIndex]};this.getCurrentTokenRow=function(){return this.$row};this.getCurrentTokenColumn=function(){var f=this.$rowTokens,h=this.$tokenIndex,
g=f[h].start;if(void 0!==g)return g;for(g=0;0<h;)--h,g+=f[h].value.length;return g};this.getCurrentTokenPosition=function(){return{row:this.$row,column:this.getCurrentTokenColumn()}};this.getCurrentTokenRange=function(){var f=this.$rowTokens[this.$tokenIndex],h=this.getCurrentTokenColumn();return new e(this.$row,h,this.$row,h+f.value.length)}}).call(l.prototype);b.TokenIterator=l});
define("ace/mode/behaviour/cstyle","require exports module ace/lib/oop ace/mode/behaviour ace/token_iterator ace/lib/lang".split(" "),function(a,b){function l(N){this.add("braces","insertion",function(T,V,E,Q,aa){T=E.getCursorPosition();V=Q.doc.getLine(T.row);if("{"==aa){f(E);aa=E.getSelectionRange();var qa=Q.doc.getTextRange(aa);if(""!==qa&&"{"!==qa&&E.getWrapBehavioursEnabled())return e(aa,qa,"{","}");if(l.isSaneInsertion(E,Q)){if(/[\]\}\)]/.test(V[T.column])||E.inMultiSelectMode||N&&N.braces)return l.recordAutoInsert(E,
Q,"}"),{text:"{}",selection:[1,1]};l.recordMaybeInsert(E,Q,"{");return{text:"{",selection:[1,1]}}}else if("}"==aa){if(f(E),qa=V.substring(T.column,T.column+1),"}"==qa&&null!==Q.$findOpeningBracket("}",{column:T.column+1,row:T.row})&&l.isAutoInsertedClosing(T,V,aa))return l.popAutoInsertedClosing(),{text:"",selection:[1,1]}}else{if("\n"==aa||"\r\n"==aa){f(E);E="";l.isMaybeInsertedClosing(T,V)&&(E=q.stringRepeat("}",D.maybeInsertedBrackets),l.clearMaybeInsertedClosing());qa=V.substring(T.column,T.column+
1);if("}"===qa){T=Q.findMatchingBracket({row:T.row,column:T.column+1},"}");if(!T)return null;T=this.$getIndent(Q.getLine(T.row))}else if(E)T=this.$getIndent(V);else{l.clearMaybeInsertedClosing();return}Q=T+Q.getTabString();return{text:"\n"+Q+"\n"+T+E,selection:[1,Q.length,1,Q.length]}}l.clearMaybeInsertedClosing()}});this.add("braces","deletion",function(T,V,E,Q,aa){T=Q.doc.getTextRange(aa);if(!aa.isMultiLine()&&"{"==T){f(E);if("}"==Q.doc.getLine(aa.start.row).substring(aa.end.column,aa.end.column+
1))return aa.end.column++,aa;D.maybeInsertedBrackets--}});this.add("parens","insertion",function(T,V,E,Q,aa){if("("==aa){f(E);aa=E.getSelectionRange();T=Q.doc.getTextRange(aa);if(""!==T&&E.getWrapBehavioursEnabled())return e(aa,T,"(",")");if(l.isSaneInsertion(E,Q))return l.recordAutoInsert(E,Q,")"),{text:"()",selection:[1,1]}}else if(")"==aa&&(f(E),E=E.getCursorPosition(),T=Q.doc.getLine(E.row),")"==T.substring(E.column,E.column+1)&&null!==Q.$findOpeningBracket(")",{column:E.column+1,row:E.row})&&
l.isAutoInsertedClosing(E,T,aa)))return l.popAutoInsertedClosing(),{text:"",selection:[1,1]}});this.add("parens","deletion",function(T,V,E,Q,aa){T=Q.doc.getTextRange(aa);if(!aa.isMultiLine()&&"("==T&&(f(E),")"==Q.doc.getLine(aa.start.row).substring(aa.start.column+1,aa.start.column+2)))return aa.end.column++,aa});this.add("brackets","insertion",function(T,V,E,Q,aa){if("["==aa){f(E);aa=E.getSelectionRange();T=Q.doc.getTextRange(aa);if(""!==T&&E.getWrapBehavioursEnabled())return e(aa,T,"[","]");if(l.isSaneInsertion(E,
Q))return l.recordAutoInsert(E,Q,"]"),{text:"[]",selection:[1,1]}}else if("]"==aa&&(f(E),E=E.getCursorPosition(),T=Q.doc.getLine(E.row),"]"==T.substring(E.column,E.column+1)&&null!==Q.$findOpeningBracket("]",{column:E.column+1,row:E.row})&&l.isAutoInsertedClosing(E,T,aa)))return l.popAutoInsertedClosing(),{text:"",selection:[1,1]}});this.add("brackets","deletion",function(T,V,E,Q,aa){T=Q.doc.getTextRange(aa);if(!aa.isMultiLine()&&"["==T&&(f(E),"]"==Q.doc.getLine(aa.start.row).substring(aa.start.column+
1,aa.start.column+2)))return aa.end.column++,aa});this.add("string_dquotes","insertion",function(T,V,E,Q,aa){T=Q.$mode.$quotes||G;if(1==aa.length&&T[aa]&&(!this.lineCommentStart||-1==this.lineCommentStart.indexOf(aa))){f(E);V=E.getSelectionRange();var qa=Q.doc.getTextRange(V);if(""!==qa&&(1!=qa.length||!T[qa])&&E.getWrapBehavioursEnabled())return e(V,qa,aa,aa);if(!qa){T=E.getCursorPosition();V=Q.doc.getLine(T.row);E=V.substring(T.column-1,T.column);qa=V.substring(T.column,T.column+1);var P=Q.getTokenAt(T.row,
T.column),ea=Q.getTokenAt(T.row,T.column+1);if("\\"==E&&P&&/escape/.test(P.type))return null;P=P&&/string|escape/.test(P.type);var ua=!ea||/string|escape/.test(ea.type);if(qa==aa)(Q=P!==ua)&&/string\.end/.test(ea.type)&&(Q=!1);else{if(P&&!ua||P&&ua)return null;Q=Q.$mode.tokenRe;Q.lastIndex=0;ea=Q.test(E);Q.lastIndex=0;P=Q.test(E);if(ea||P||qa&&!/[\s;,.})\]\\]/.test(qa))return null;T=V[T.column-2];if(E==aa&&(T==aa||Q.test(T)))return null;Q=!0}return{text:Q?aa+aa:"",selection:[1,1]}}}});this.add("string_dquotes",
"deletion",function(T,V,E,Q,aa){T=Q.$mode.$quotes||G;V=Q.doc.getTextRange(aa);if(!aa.isMultiLine()&&T.hasOwnProperty(V)&&(f(E),Q.doc.getLine(aa.start.row).substring(aa.start.column+1,aa.start.column+2)==V))return aa.end.column++,aa})}function e(N,T,V,E){var Q=N.end.row-N.start.row;return{text:V+T+E,selection:[0,N.start.column+1,Q,N.end.column+(Q?0:1)]}}function f(N){var T=-1;N.multiSelect&&(T=N.selection.index,F.rangeCount!=N.multiSelect.rangeCount&&(F={rangeCount:N.multiSelect.rangeCount}));if(F[T])return D=
F[T];D=F[T]={autoInsertedBrackets:0,autoInsertedRow:-1,autoInsertedLineEnd:"",maybeInsertedBrackets:0,maybeInsertedRow:-1,maybeInsertedLineStart:"",maybeInsertedLineEnd:""}}var h=a("../../lib/oop"),g=a("../behaviour").Behaviour,m=a("../../token_iterator").TokenIterator,q=a("../../lib/lang"),r=["text","paren.rparen","rparen","paren","punctuation.operator"],B="text paren.rparen rparen paren punctuation.operator comment".split(" "),D,F={},G={'"':'"',"'":"'"};l.isSaneInsertion=function(N,T){var V=N.getCursorPosition(),
E=new m(T,V.row,V.column);if(!this.$matchTokenType(E.getCurrentToken()||"text",r)){if(/[)}\]]/.test(N.session.getLine(V.row)[V.column]))return!0;N=new m(T,V.row,V.column+1);if(!this.$matchTokenType(N.getCurrentToken()||"text",r))return!1}E.stepForward();return E.getCurrentTokenRow()!==V.row||this.$matchTokenType(E.getCurrentToken()||"text",B)};l.$matchTokenType=function(N,T){return-1<T.indexOf(N.type||N)};l.recordAutoInsert=function(N,T,V){N=N.getCursorPosition();T=T.doc.getLine(N.row);this.isAutoInsertedClosing(N,
T,D.autoInsertedLineEnd[0])||(D.autoInsertedBrackets=0);D.autoInsertedRow=N.row;D.autoInsertedLineEnd=V+T.substr(N.column);D.autoInsertedBrackets++};l.recordMaybeInsert=function(N,T,V){N=N.getCursorPosition();T=T.doc.getLine(N.row);this.isMaybeInsertedClosing(N,T)||(D.maybeInsertedBrackets=0);D.maybeInsertedRow=N.row;D.maybeInsertedLineStart=T.substr(0,N.column)+V;D.maybeInsertedLineEnd=T.substr(N.column);D.maybeInsertedBrackets++};l.isAutoInsertedClosing=function(N,T,V){return 0<D.autoInsertedBrackets&&
N.row===D.autoInsertedRow&&V===D.autoInsertedLineEnd[0]&&T.substr(N.column)===D.autoInsertedLineEnd};l.isMaybeInsertedClosing=function(N,T){return 0<D.maybeInsertedBrackets&&N.row===D.maybeInsertedRow&&T.substr(N.column)===D.maybeInsertedLineEnd&&T.substr(0,N.column)==D.maybeInsertedLineStart};l.popAutoInsertedClosing=function(){D.autoInsertedLineEnd=D.autoInsertedLineEnd.substr(1);D.autoInsertedBrackets--};l.clearMaybeInsertedClosing=function(){D&&(D.maybeInsertedBrackets=0,D.maybeInsertedRow=-1)};
h.inherits(l,g);b.CstyleBehaviour=l});
define("ace/unicode",["require","exports","module"],function(a,b){a=[48,9,8,25,5,0,2,25,48,0,11,0,5,0,6,22,2,30,2,457,5,11,15,4,8,0,2,0,18,116,2,1,3,3,9,0,2,2,2,0,2,19,2,82,2,138,2,4,3,155,12,37,3,0,8,38,10,44,2,0,2,1,2,1,2,0,9,26,6,2,30,10,7,61,2,9,5,101,2,7,3,9,2,18,3,0,17,58,3,100,15,53,5,0,6,45,211,57,3,18,2,5,3,11,3,9,2,1,7,6,2,2,2,7,3,1,3,21,2,6,2,0,4,3,3,8,3,1,3,3,9,0,5,1,2,4,3,11,16,2,2,5,5,1,3,21,2,6,2,1,2,1,2,1,3,0,2,4,5,1,3,2,4,0,8,3,2,0,8,15,12,2,2,8,2,2,2,21,2,6,2,1,2,4,3,9,2,2,2,2,3,
0,16,3,3,9,18,2,2,7,3,1,3,21,2,6,2,1,2,4,3,8,3,1,3,2,9,1,5,1,2,4,3,9,2,0,17,1,2,5,4,2,2,3,4,1,2,0,2,1,4,1,4,2,4,11,5,4,4,2,2,3,3,0,7,0,15,9,18,2,2,7,2,2,2,22,2,9,2,4,4,7,2,2,2,3,8,1,2,1,7,3,3,9,19,1,2,7,2,2,2,22,2,9,2,4,3,8,2,2,2,3,8,1,8,0,2,3,3,9,19,1,2,7,2,2,2,22,2,15,4,7,2,2,2,3,10,0,9,3,3,9,11,5,3,1,2,17,4,23,2,8,2,0,3,6,4,0,5,5,2,0,2,7,19,1,14,57,6,14,2,9,40,1,2,0,3,1,2,0,3,0,7,3,2,6,2,2,2,0,2,0,3,1,2,12,2,2,3,4,2,0,2,5,3,9,3,1,35,0,24,1,7,9,12,0,2,0,2,0,5,9,2,35,5,19,2,5,5,7,2,35,10,0,58,73,
7,77,3,37,11,42,2,0,4,328,2,3,3,6,2,0,2,3,3,40,2,3,3,32,2,3,3,6,2,0,2,3,3,14,2,56,2,3,3,66,5,0,33,15,17,84,13,619,3,16,2,25,6,74,22,12,2,6,12,20,12,19,13,12,2,2,2,1,13,51,3,29,4,0,5,1,3,9,34,2,3,9,7,87,9,42,6,69,11,28,4,11,5,11,11,39,3,4,12,43,5,25,7,10,38,27,5,62,2,28,3,10,7,9,14,0,89,75,5,9,18,8,13,42,4,11,71,55,9,9,4,48,83,2,2,30,14,230,23,280,3,5,3,37,3,5,3,7,2,0,2,0,2,0,2,30,3,52,2,6,2,0,4,2,2,6,4,3,3,5,5,12,6,2,2,6,67,1,20,0,29,0,14,0,17,4,60,12,5,0,4,11,18,0,5,0,3,9,2,0,4,4,7,0,2,0,2,0,2,3,
2,10,3,3,6,4,5,0,53,1,2684,46,2,46,2,132,7,6,15,37,11,53,10,0,17,22,10,6,2,6,2,6,2,6,2,6,2,6,2,6,2,6,2,31,48,0,470,1,36,5,2,4,6,1,5,85,3,1,3,2,2,89,2,3,6,40,4,93,18,23,57,15,513,6581,75,20939,53,1164,68,45,3,268,4,27,21,31,3,13,13,1,2,24,9,69,11,1,38,8,3,102,3,1,111,44,25,51,13,68,12,9,7,23,4,0,5,45,3,35,13,28,4,64,15,10,39,54,10,13,3,9,7,22,4,1,5,66,25,2,227,42,2,1,3,9,7,11171,13,22,5,48,8453,301,3,61,3,105,39,6,13,4,6,11,2,12,2,4,2,0,2,1,2,1,2,107,34,362,19,63,3,53,41,11,5,15,17,6,13,1,25,2,33,
4,2,134,20,9,8,25,5,0,2,25,12,88,4,5,3,5,3,5,3,2];for(var l=0,e=[],f=0;f<a.length;f+=2)e.push(l+=a[f]),a[f+1]&&e.push(45,l+=a[f+1]);b.wordChars=String.fromCharCode.apply(null,e)});
define("ace/mode/text","require exports module ace/config ace/tokenizer ace/mode/text_highlight_rules ace/mode/behaviour/cstyle ace/unicode ace/lib/lang ace/token_iterator ace/range".split(" "),function(a,b){function l(){this.HighlightRules=h}var e=a("../config"),f=a("../tokenizer").Tokenizer,h=a("./text_highlight_rules").TextHighlightRules,g=a("./behaviour/cstyle").CstyleBehaviour,m=a("../unicode"),q=a("../lib/lang"),r=a("../token_iterator").TokenIterator,B=a("../range").Range;(function(){this.$defaultBehaviour=
new g;this.tokenRe=new RegExp("^["+m.wordChars+"\\$_]+","g");this.nonTokenRe=new RegExp("^(?:[^"+m.wordChars+"\\$_]|\\s])+","g");this.getTokenizer=function(){this.$tokenizer||(this.$highlightRules=this.$highlightRules||new this.HighlightRules(this.$highlightRuleConfig),this.$tokenizer=new f(this.$highlightRules.getRules()));return this.$tokenizer};this.blockComment=this.lineCommentStart="";this.toggleCommentLines=function(D,F,G,N){function T(za){for(var Na=G;Na<=N;Na++)za(V.getLine(Na),Na)}var V=
F.doc,E=!0,Q=!0,aa=Infinity,qa=F.getTabSize();D=!1;if(this.lineCommentStart){Array.isArray(this.lineCommentStart)?(pa=this.lineCommentStart.map(q.escapeRegExp).join("|"),ua=this.lineCommentStart[0]):(pa=q.escapeRegExp(this.lineCommentStart),ua=this.lineCommentStart);pa=new RegExp("^(\\s*)(?:"+pa+") ?");D=F.getUseSoftTabs();Ga=function(za,Na){var ya=za.match(pa);if(ya){var Ia=ya[1].length,$a=ya[0].length;ea(za,Ia,$a)||" "!=ya[0][$a-1]||$a--;V.removeInLine(Na,Ia,$a)}};var P=ua+" ";Ca=function(za,Na){if(!E||
/\S/.test(za))ea(za,aa,aa)?V.insertInLine({row:Na,column:aa},P):V.insertInLine({row:Na,column:aa},ua)};Aa=function(za){return pa.test(za)};var ea=function(za,Na,ya){for(var Ia=0;Na--&&" "==za.charAt(Na);)Ia++;if(0!=Ia%qa)return!1;for(Ia=0;" "==za.charAt(ya++);)Ia++;return 2<qa?Ia%qa!=qa-1:0==Ia%qa}}else{if(!this.blockComment)return!1;var ua=this.blockComment.start,Fa=this.blockComment.end,pa=new RegExp("^(\\s*)(?:"+q.escapeRegExp(ua)+")"),ra=new RegExp("(?:"+q.escapeRegExp(Fa)+")\\s*$"),Ca=function(za,
Na){Aa(za,Na)||E&&!/\S/.test(za)||(V.insertInLine({row:Na,column:za.length},Fa),V.insertInLine({row:Na,column:aa},ua))},Ga=function(za,Na){var ya;(ya=za.match(ra))&&V.removeInLine(Na,za.length-ya[0].length,za.length);(ya=za.match(pa))&&V.removeInLine(Na,ya[1].length,ya[0].length)},Aa=function(za,Na){if(pa.test(za))return!0;za=F.getTokens(Na);for(Na=0;Na<za.length;Na++)if("comment"===za[Na].type)return!0}}var xa=Infinity;T(function(za,Na){var ya=za.search(/\S/);-1!==ya?(ya<aa&&(aa=ya),Q&&!Aa(za,Na)&&
(Q=!1)):xa>za.length&&(xa=za.length)});Infinity==aa&&(aa=xa,Q=E=!1);D&&0!=aa%qa&&(aa=Math.floor(aa/qa)*qa);T(Q?Ga:Ca)};this.toggleBlockComment=function(D,F,G,N){if(D=this.blockComment){!D.start&&D[0]&&(D=D[0]);var T=new r(F,N.row,N.column),V=T.getCurrentToken(),E=F.selection.toOrientedRange();if(V&&/comment/.test(V.type)){for(var Q,aa;V&&/comment/.test(V.type);){V=V.value.indexOf(D.start);if(-1!=V){G=T.getCurrentTokenRow();T=T.getCurrentTokenColumn()+V;Q=new B(G,T,G,T+D.start.length);break}V=T.stepBackward()}T=
new r(F,N.row,N.column);for(V=T.getCurrentToken();V&&/comment/.test(V.type);){V=V.value.indexOf(D.end);if(-1!=V){G=T.getCurrentTokenRow();T=T.getCurrentTokenColumn()+V;aa=new B(G,T,G,T+D.end.length);break}V=T.stepForward()}aa&&F.remove(aa);if(Q){F.remove(Q);var qa=Q.start.row;var P=-D.start.length}}else P=D.start.length,qa=G.start.row,F.insert(G.end,D.end),F.insert(G.start,D.start);E.start.row==qa&&(E.start.column+=P);E.end.row==qa&&(E.end.column+=P);F.selection.fromOrientedRange(E)}};this.getNextLineIndent=
function(D,F){return this.$getIndent(F)};this.checkOutdent=function(){return!1};this.autoOutdent=function(){};this.$getIndent=function(D){return D.match(/^\s*/)[0]};this.createWorker=function(){return null};this.createModeDelegates=function(D){this.$embeds=[];this.$modes={};for(var F in D)if(D[F]){var G=D[F],N=G.prototype.$id,T=e.$modes[N];T||(e.$modes[N]=T=new G);e.$modes[F]||(e.$modes[F]=T);this.$embeds.push(F);this.$modes[F]=T}var V="toggleBlockComment toggleCommentLines getNextLineIndent checkOutdent autoOutdent transformAction getCompletions".split(" ");
for(F=0;F<V.length;F++)(function(E){var Q=V[F],aa=E[Q];E[V[F]]=function(){return this.$delegator(Q,arguments,aa)}})(this)};this.$delegator=function(D,F,G){var N=F[0]||"start";if("string"!=typeof N){if(Array.isArray(N[2])){var T=this.$modes[N[2][N[2].length-1]];if(T)return T[D].apply(T,[N[1]].concat([].slice.call(F,1)))}N=N[0]||"start"}for(T=0;T<this.$embeds.length;T++)if(this.$modes[this.$embeds[T]]){var V=N.split(this.$embeds[T]);if(!V[0]&&V[1])return F[0]=V[1],T=this.$modes[this.$embeds[T]],T[D].apply(T,
F)}D=G.apply(this,F);return G?D:void 0};this.transformAction=function(D,F,G,N,T){if(this.$behaviour){var V=this.$behaviour.getBehaviours(),E;for(E in V)if(V[E][F]){var Q=V[E][F].apply(this,arguments);if(Q)return Q}}};this.getKeywords=function(D){if(!this.completionKeywords){var F=this.$tokenizer.rules,G=[];for(aa in F)for(var N=F[aa],T=0,V=N.length;T<V;T++)if("string"===typeof N[T].token)/keyword|support|storage/.test(N[T].token)&&G.push(N[T].regex);else if("object"===typeof N[T].token)for(var E=
0,Q=N[T].token.length;E<Q;E++)if(/keyword|support|storage/.test(N[T].token[E])){var aa=N[T].regex.match(/\(.+?\)/g)[E];G.push(aa.substr(1,aa.length-2))}this.completionKeywords=G}return D?G.concat(this.$keywordList||[]):this.$keywordList};this.$createKeywordList=function(){this.$highlightRules||this.getTokenizer();return this.$keywordList=this.$highlightRules.$keywordList||[]};this.getCompletions=function(){return(this.$keywordList||this.$createKeywordList()).map(function(D){return{name:D,value:D,
score:0,meta:"keyword"}})};this.$id="ace/mode/text"}).call(l.prototype);b.Mode=l});
define("ace/apply_delta",["require","exports","module"],function(a,b){b.applyDelta=function(l,e){var f=e.start.row,h=e.start.column,g=l[f]||"";switch(e.action){case "insert":if(1===e.lines.length)l[f]=g.substring(0,h)+e.lines[0]+g.substring(h);else{var m=[f,1].concat(e.lines);l.splice.apply(l,m);l[f]=g.substring(0,h)+l[f];l[f+e.lines.length-1]+=g.substring(h)}break;case "remove":m=e.end.column,e=e.end.row,f===e?l[f]=g.substring(0,h)+g.substring(m):l.splice(f,e-f+1,g.substring(0,h)+l[e].substring(m))}}});
define("ace/anchor",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(a,b){var l=a("./lib/oop"),e=a("./lib/event_emitter").EventEmitter;a=b.Anchor=function(f,h,g){this.$onChange=this.onChange.bind(this);this.attach(f);"undefined"==typeof g?this.setPosition(h.row,h.column):this.setPosition(h,g)};(function(){function f(h,g,m){m=m?h.column<=g.column:h.column<g.column;return h.row<g.row||h.row==g.row&&m}l.implement(this,e);this.getPosition=function(){return this.$clipPositionToDocument(this.row,
this.column)};this.getDocument=function(){return this.document};this.$insertRight=!1;this.onChange=function(h){if(!(h.start.row==h.end.row&&h.start.row!=this.row||h.start.row>this.row)){var g={row:this.row,column:this.column};var m=this.$insertRight;var q="insert"==h.action,r=(q?1:-1)*(h.end.row-h.start.row),B=(q?1:-1)*(h.end.column-h.start.column),D=h.start;h=q?D:h.end;f(g,D,m)?(m=g.row,g=g.column):f(h,g,!m)?(m=g.row+r,g=g.column+(g.row==h.row?B:0)):(m=D.row,g=D.column);this.setPosition(m,g,!0)}};
this.setPosition=function(h,g,m){h=m?{row:h,column:g}:this.$clipPositionToDocument(h,g);if(this.row!=h.row||this.column!=h.column)g={row:this.row,column:this.column},this.row=h.row,this.column=h.column,this._signal("change",{old:g,value:h})};this.detach=function(){this.document.off("change",this.$onChange)};this.attach=function(h){this.document=h||this.document;this.document.on("change",this.$onChange)};this.$clipPositionToDocument=function(h,g){var m={};h>=this.document.getLength()?(m.row=Math.max(0,
this.document.getLength()-1),m.column=this.document.getLine(m.row).length):0>h?(m.row=0,m.column=0):(m.row=h,m.column=Math.min(this.document.getLine(m.row).length,Math.max(0,g)));0>g&&(m.column=0);return m}}).call(a.prototype)});
define("ace/document","require exports module ace/lib/oop ace/apply_delta ace/lib/event_emitter ace/range ace/anchor".split(" "),function(a,b){function l(q){this.$lines=[""];0===q.length?this.$lines=[""]:Array.isArray(q)?this.insertMergedLines({row:0,column:0},q):this.insert({row:0,column:0},q)}var e=a("./lib/oop"),f=a("./apply_delta").applyDelta,h=a("./lib/event_emitter").EventEmitter,g=a("./range").Range,m=a("./anchor").Anchor;(function(){e.implement(this,h);this.setValue=function(q){var r=this.getLength()-
1;this.remove(new g(0,0,r,this.getLine(r).length));this.insert({row:0,column:0},q)};this.getValue=function(){return this.getAllLines().join(this.getNewLineCharacter())};this.createAnchor=function(q,r){return new m(this,q,r)};0==="aaa".split(/a/).length?this.$split=function(q){return q.replace(/\r\n|\r/g,"\n").split("\n")}:this.$split=function(q){return q.split(/\r\n|\r|\n/)};this.$detectNewLine=function(q){this.$autoNewLine=(q=q.match(/^.*?(\r\n|\r|\n)/m))?q[1]:"\n";this._signal("changeNewLineMode")};
this.getNewLineCharacter=function(){switch(this.$newLineMode){case "windows":return"\r\n";case "unix":return"\n";default:return this.$autoNewLine||"\n"}};this.$autoNewLine="";this.$newLineMode="auto";this.setNewLineMode=function(q){this.$newLineMode!==q&&(this.$newLineMode=q,this._signal("changeNewLineMode"))};this.getNewLineMode=function(){return this.$newLineMode};this.isNewLine=function(q){return"\r\n"==q||"\r"==q||"\n"==q};this.getLine=function(q){return this.$lines[q]||""};this.getLines=function(q,
r){return this.$lines.slice(q,r+1)};this.getAllLines=function(){return this.getLines(0,this.getLength())};this.getLength=function(){return this.$lines.length};this.getTextRange=function(q){return this.getLinesForRange(q).join(this.getNewLineCharacter())};this.getLinesForRange=function(q){if(q.start.row===q.end.row)var r=[this.getLine(q.start.row).substring(q.start.column,q.end.column)];else{r=this.getLines(q.start.row,q.end.row);r[0]=(r[0]||"").substring(q.start.column);var B=r.length-1;q.end.row-
q.start.row==B&&(r[B]=r[B].substring(0,q.end.column))}return r};this.insertLines=function(q,r){console.warn("Use of document.insertLines is deprecated. Use the insertFullLines method instead.");return this.insertFullLines(q,r)};this.removeLines=function(q,r){console.warn("Use of document.removeLines is deprecated. Use the removeFullLines method instead.");return this.removeFullLines(q,r)};this.insertNewLine=function(q){console.warn("Use of document.insertNewLine is deprecated. Use insertMergedLines(position, ['', '']) instead.");
return this.insertMergedLines(q,["",""])};this.insert=function(q,r){1>=this.getLength()&&this.$detectNewLine(r);return this.insertMergedLines(q,this.$split(r))};this.insertInLine=function(q,r){var B=this.clippedPos(q.row,q.column);q=this.pos(q.row,q.column+r.length);this.applyDelta({start:B,end:q,action:"insert",lines:[r]},!0);return this.clonePos(q)};this.clippedPos=function(q,r){var B=this.getLength();void 0===q?q=B:0>q?q=0:q>=B&&(q=B-1,r=void 0);B=this.getLine(q);void 0==r&&(r=B.length);r=Math.min(Math.max(r,
0),B.length);return{row:q,column:r}};this.clonePos=function(q){return{row:q.row,column:q.column}};this.pos=function(q,r){return{row:q,column:r}};this.$clipPosition=function(q){var r=this.getLength();q.row>=r?(q.row=Math.max(0,r-1),q.column=this.getLine(r-1).length):(q.row=Math.max(0,q.row),q.column=Math.min(Math.max(q.column,0),this.getLine(q.row).length));return q};this.insertFullLines=function(q,r){q=Math.min(Math.max(q,0),this.getLength());if(q<this.getLength()){r=r.concat([""]);var B=0}else r=
[""].concat(r),q--,B=this.$lines[q].length;this.insertMergedLines({row:q,column:B},r)};this.insertMergedLines=function(q,r){q=this.clippedPos(q.row,q.column);var B={row:q.row+r.length-1,column:(1==r.length?q.column:0)+r[r.length-1].length};this.applyDelta({start:q,end:B,action:"insert",lines:r});return this.clonePos(B)};this.remove=function(q,r){var B=this.clippedPos(q.start.row,q.start.column);q=this.clippedPos(q.end.row,q.end.column);this.applyDelta({start:B,end:q,action:"remove",lines:this.getLinesForRange({start:B,
end:q}),add_inf:r});return this.clonePos(B)};this.removeInLine=function(q,r,B){r=this.clippedPos(q,r);q=this.clippedPos(q,B);this.applyDelta({start:r,end:q,action:"remove",lines:this.getLinesForRange({start:r,end:q})},!0);return this.clonePos(r)};this.removeFullLines=function(q,r){q=Math.min(Math.max(0,q),this.getLength()-1);r=Math.min(Math.max(0,r),this.getLength()-1);var B=r==this.getLength()-1&&0<q,D=r<this.getLength()-1,F=B?q-1:q;B=B?this.getLine(F).length:0;var G=D?r+1:r;D=D?0:this.getLine(G).length;
F=new g(F,B,G,D);q=this.$lines.slice(q,r+1);this.applyDelta({start:F.start,end:F.end,action:"remove",lines:this.getLinesForRange(F)});return q};this.removeNewLine=function(q){q<this.getLength()-1&&0<=q&&this.applyDelta({start:this.pos(q,this.getLine(q).length),end:this.pos(q+1,0),action:"remove",lines:["",""]})};this.replace=function(q,r){q instanceof g||(q=g.fromPoints(q.start,q.end));if(0===r.length&&q.isEmpty())return q.start;if(r==this.getTextRange(q))return q.end;this.remove(q);return r?this.insert(q.start,
r):q.start};this.applyDeltas=function(q){for(var r=0;r<q.length;r++)this.applyDelta(q[r])};this.revertDeltas=function(q){for(var r=q.length-1;0<=r;r--)this.revertDelta(q[r])};this.applyDelta=function(q,r){var B="insert"==q.action;(B?1>=q.lines.length&&!q.lines[0]:!g.comparePoints(q.start,q.end))||(B&&2E4<q.lines.length?this.$splitAndapplyLargeDelta(q,2E4):(f(this.$lines,q,r),this._signal("change",q)))};this.$safeApplyDelta=function(q){var r=this.$lines.length;("remove"==q.action&&q.start.row<r&&q.end.row<
r||"insert"==q.action&&q.start.row<=r)&&this.applyDelta(q)};this.$splitAndapplyLargeDelta=function(q,r){for(var B=q.lines,D=B.length-r+1,F=q.start.row,G=q.start.column,N=0,T=0;N<D;N=T){T+=r-1;var V=B.slice(N,T);V.push("");this.applyDelta({start:this.pos(F+N,G),end:this.pos(F+T,G=0),action:q.action,lines:V},!0)}q.lines=B.slice(N);q.start.row=F+N;q.start.column=G;this.applyDelta(q,!0)};this.revertDelta=function(q){this.$safeApplyDelta({start:this.clonePos(q.start),end:this.clonePos(q.end),action:"insert"==
q.action?"remove":"insert",lines:q.lines.slice()})};this.indexToPosition=function(q,r){var B=this.$lines||this.getAllLines(),D=this.getNewLineCharacter().length;r=r||0;for(var F=B.length;r<F;r++)if(q-=B[r].length+D,0>q)return{row:r,column:q+B[r].length+D};return{row:F-1,column:q+B[F-1].length+D}};this.positionToIndex=function(q,r){var B=this.$lines||this.getAllLines(),D=this.getNewLineCharacter().length,F=0,G=Math.min(q.row,B.length);for(r=r||0;r<G;++r)F+=B[r].length+D;return F+q.column}}).call(l.prototype);
b.Document=l});
define("ace/background_tokenizer",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(a,b){function l(h){this.running=!1;this.lines=[];this.states=[];this.currentLine=0;this.tokenizer=h;var g=this;this.$worker=function(){if(g.running){for(var m=new Date,q=g.currentLine,r=-1,B=g.doc,D=q;g.lines[q];)q++;B=B.getLength();var F=0;for(g.running=!1;q<B;){g.$tokenizeRow(q);r=q;do q++;while(g.lines[q]);F++;if(0===F%5&&20<new Date-m){g.running=setTimeout(g.$worker,20);break}}g.currentLine=
q;-1==r&&(r=q);D<=r&&g.fireUpdateEvent(D,r)}}}var e=a("./lib/oop"),f=a("./lib/event_emitter").EventEmitter;(function(){e.implement(this,f);this.setTokenizer=function(h){this.tokenizer=h;this.lines=[];this.states=[];this.start(0)};this.setDocument=function(h){this.doc=h;this.lines=[];this.states=[];this.stop()};this.fireUpdateEvent=function(h,g){this._signal("update",{data:{first:h,last:g}})};this.start=function(h){this.currentLine=Math.min(h||0,this.currentLine,this.doc.getLength());this.lines.splice(this.currentLine,
this.lines.length);this.states.splice(this.currentLine,this.states.length);this.stop();this.running=setTimeout(this.$worker,700)};this.scheduleStart=function(){this.running||(this.running=setTimeout(this.$worker,700))};this.$updateOnChange=function(h){var g=h.start.row,m=h.end.row-g;0===m?this.lines[g]=null:"remove"==h.action?(this.lines.splice(g,m+1,null),this.states.splice(g,m+1,null)):(h=Array(m+1),h.unshift(g,1),this.lines.splice.apply(this.lines,h),this.states.splice.apply(this.states,h));this.currentLine=
Math.min(g,this.currentLine,this.doc.getLength());this.stop()};this.stop=function(){this.running&&clearTimeout(this.running);this.running=!1};this.getTokens=function(h){return this.lines[h]||this.$tokenizeRow(h)};this.getState=function(h){this.currentLine==h&&this.$tokenizeRow(h);return this.states[h]||"start"};this.$tokenizeRow=function(h){var g=this.doc.getLine(h);g=this.tokenizer.getLineTokens(g,this.states[h-1],h);this.states[h]+""!==g.state+""?(this.states[h]=g.state,this.lines[h+1]=null,this.currentLine>
h+1&&(this.currentLine=h+1)):this.currentLine==h&&(this.currentLine=h+1);return this.lines[h]=g.tokens}}).call(l.prototype);b.BackgroundTokenizer=l});
define("ace/search_highlight","require exports module ace/lib/lang ace/lib/oop ace/range".split(" "),function(a,b){function l(h,g,m){this.setRegexp(h);this.clazz=g;this.type=m||"text"}var e=a("./lib/lang");a("./lib/oop");var f=a("./range").Range;(function(){this.MAX_RANGES=500;this.setRegexp=function(h){this.regExp+""!=h+""&&(this.regExp=h,this.cache=[])};this.update=function(h,g,m,q){if(this.regExp)for(var r=q.lastRow,B=q.firstRow;B<=r;B++){var D=this.cache[B];null==D&&(D=e.getMatchOffsets(m.getLine(B),
this.regExp),D.length>this.MAX_RANGES&&(D=D.slice(0,this.MAX_RANGES)),D=D.map(function(G){return new f(B,G.offset,B,G.offset+G.length)}),this.cache[B]=D.length?D:"");for(var F=D.length;F--;)g.drawSingleLineMarker(h,D[F].toScreenRange(m),this.clazz,q)}}}).call(l.prototype);b.SearchHighlight=l});
define("ace/edit_session/fold_line",["require","exports","module","ace/range"],function(a,b){function l(f,h){this.foldData=f;Array.isArray(h)?this.folds=h:h=this.folds=[h];f=h[h.length-1];this.range=new e(h[0].start.row,h[0].start.column,f.end.row,f.end.column);this.start=this.range.start;this.end=this.range.end;this.folds.forEach(function(g){g.setFoldLine(this)},this)}var e=a("../range").Range;(function(){this.shiftRow=function(f){this.start.row+=f;this.end.row+=f;this.folds.forEach(function(h){h.start.row+=
f;h.end.row+=f})};this.addFold=function(f){if(f.sameRow){if(f.start.row<this.startRow||f.endRow>this.endRow)throw Error("Can't add a fold to this FoldLine as it has no connection");this.folds.push(f);this.folds.sort(function(h,g){return-h.range.compareEnd(g.start.row,g.start.column)});0<this.range.compareEnd(f.start.row,f.start.column)?(this.end.row=f.end.row,this.end.column=f.end.column):0>this.range.compareStart(f.end.row,f.end.column)&&(this.start.row=f.start.row,this.start.column=f.start.column)}else if(f.start.row==
this.end.row)this.folds.push(f),this.end.row=f.end.row,this.end.column=f.end.column;else if(f.end.row==this.start.row)this.folds.unshift(f),this.start.row=f.start.row,this.start.column=f.start.column;else throw Error("Trying to add fold to FoldRow that doesn't have a matching row");f.foldLine=this};this.containsRow=function(f){return f>=this.start.row&&f<=this.end.row};this.walk=function(f,h,g){var m=0,q=this.folds;var r=!0;null==h&&(h=this.end.row,g=this.end.column);for(var B=0;B<q.length;B++){var D=
q[B];var F=D.range.compareStart(h,g);if(-1==F){f(null,h,g,m,r);return}r=f(null,D.start.row,D.start.column,m,r);if((r=!r&&f(D.placeholder,D.start.row,D.start.column,m))||0===F)return;r=!D.sameRow;m=D.end.column}f(null,h,g,m,r)};this.getNextFoldTo=function(f,h){for(var g,m,q=0;q<this.folds.length;q++){g=this.folds[q];m=g.range.compareEnd(f,h);if(-1==m)return{fold:g,kind:"after"};if(0===m)return{fold:g,kind:"inside"}}return null};this.addRemoveChars=function(f,h,g){var m=this.getNextFoldTo(f,h);if(m){var q=
m.fold;if("inside"==m.kind&&q.start.column!=h&&q.start.row!=f)window.console&&window.console.log(f,h,q);else if(q.start.row==f){f=this.folds;h=f.indexOf(q);0===h&&(this.start.column+=g);for(h;h<f.length;h++){q=f[h];q.start.column+=g;if(!q.sameRow)return;q.end.column+=g}this.end.column+=g}}};this.split=function(f,h){var g=this.getNextFoldTo(f,h);if(!g||"inside"==g.kind)return null;h=this.folds;f=this.foldData;g=h.indexOf(g.fold);var m=h[g-1];this.end.row=m.end.row;this.end.column=m.end.column;h=h.splice(g,
h.length-g);h=new l(f,h);f.splice(f.indexOf(this)+1,0,h);return h};this.merge=function(f){for(var h=f.folds,g=0;g<h.length;g++)this.addFold(h[g]);h=this.foldData;h.splice(h.indexOf(f),1)};this.toString=function(){var f=[this.range.toString()+": ["];this.folds.forEach(function(h){f.push("  "+h.toString())});f.push("]");return f.join("\n")};this.idxToPosition=function(f){for(var h=0,g=0;g<this.folds.length;g++){var m=this.folds[g];f-=m.start.column-h;if(0>f)return{row:m.start.row,column:m.start.column+
f};f-=m.placeholder.length;if(0>f)return m.start;h=m.end.column}return{row:this.end.row,column:this.end.column+f}}}).call(l.prototype);b.FoldLine=l});
define("ace/range_list",["require","exports","module","ace/range"],function(a,b){function l(){this.ranges=[];this.$bias=1}var e=a("./range").Range.comparePoints;(function(){this.comparePoints=e;this.pointIndex=function(f,h,g){var m=this.ranges;for(g=g||0;g<m.length;g++){var q=m[g],r=e(f,q.end);if(!(0<r)){f=e(f,q.start);if(0===r)return h&&0!==f?-g-2:g;if(0<f||0===f&&!h)return g;break}}return-g-1};this.add=function(f){var h=!f.isEmpty(),g=this.pointIndex(f.start,h);0>g&&(g=-g-1);h=this.pointIndex(f.end,
h,g);0>h?h=-h-1:h++;return this.ranges.splice(g,h-g,f)};this.addList=function(f){for(var h=[],g=f.length;g--;)h.push.apply(h,this.add(f[g]));return h};this.substractPoint=function(f){f=this.pointIndex(f);if(0<=f)return this.ranges.splice(f,1)};this.merge=function(){var f=[],h=this.ranges;h=h.sort(function(B,D){return e(B.start,D.start)});for(var g=h[0],m,q=1;q<h.length;q++){m=g;g=h[q];var r=e(m.end,g.start);0>r||0==r&&!m.isEmpty()&&!g.isEmpty()||(0>e(m.end,g.end)&&(m.end.row=g.end.row,m.end.column=
g.end.column),h.splice(q,1),f.push(g),g=m,q--)}this.ranges=h;return f};this.contains=function(f,h){return 0<=this.pointIndex({row:f,column:h})};this.containsPoint=function(f){return 0<=this.pointIndex(f)};this.rangeAtPoint=function(f){f=this.pointIndex(f);if(0<=f)return this.ranges[f]};this.clipRows=function(f,h){var g=this.ranges;if(g[0].start.row>h||g[g.length-1].start.row<f)return[];f=this.pointIndex({row:f,column:0});0>f&&(f=-f-1);h=this.pointIndex({row:h,column:0},f);0>h&&(h=-h-1);for(var m=
[];f<h;f++)m.push(g[f]);return m};this.removeAll=function(){return this.ranges.splice(0,this.ranges.length)};this.attach=function(f){this.session&&this.detach();this.session=f;this.onChange=this.$onChange.bind(this);this.session.on("change",this.onChange)};this.detach=function(){this.session&&(this.session.removeListener("change",this.onChange),this.session=null)};this.$onChange=function(f){for(var h=f.start,g=f.end,m=h.row,q=g.row,r=this.ranges,B=0,D=r.length;B<D;B++){var F=r[B];if(F.end.row>=m)break}if("insert"==
f.action){f=q-m;for(var G=-h.column+g.column;B<D;B++){F=r[B];if(F.start.row>m)break;F.start.row==m&&F.start.column>=h.column&&!(F.start.column==h.column&&0>=this.$bias)&&(F.start.column+=G,F.start.row+=f);F.end.row==m&&F.end.column>=h.column&&!(F.end.column==h.column&&0>this.$bias)&&(F.end.column==h.column&&0<G&&B<D-1&&F.end.column>F.start.column&&F.end.column==r[B+1].start.column&&(F.end.column-=G),F.end.column+=G,F.end.row+=f)}}else for(f=m-q,G=h.column-g.column;B<D;B++){F=r[B];if(F.start.row>q)break;
if(F.end.row<q&&(m<F.end.row||m==F.end.row&&h.column<F.end.column))F.end.row=m,F.end.column=h.column;else if(F.end.row==q)if(F.end.column<=g.column){if(f||F.end.column>h.column)F.end.column=h.column,F.end.row=h.row}else F.end.column+=G,F.end.row+=f;else F.end.row>q&&(F.end.row+=f);if(F.start.row<q&&(m<F.start.row||m==F.start.row&&h.column<F.start.column))F.start.row=m,F.start.column=h.column;else if(F.start.row==q)if(F.start.column<=g.column){if(f||F.start.column>h.column)F.start.column=h.column,
F.start.row=h.row}else F.start.column+=G,F.start.row+=f;else F.start.row>q&&(F.start.row+=f)}if(0!=f&&B<D)for(;B<D;B++)F=r[B],F.start.row+=f,F.end.row+=f}}).call(l.prototype);b.RangeList=l});
define("ace/edit_session/fold",["require","exports","module","ace/range_list","ace/lib/oop"],function(a,b){function l(g,m){g.row-=m.row;0==g.row&&(g.column-=m.column)}function e(g,m){0==g.row&&(g.column+=m.column);g.row+=m.row}var f=a("../range_list").RangeList;a=a("../lib/oop");var h=b.Fold=function(g,m){this.foldLine=null;this.placeholder=m;this.range=g;this.start=g.start;this.end=g.end;this.sameRow=g.start.row==g.end.row;this.subFolds=this.ranges=[]};a.inherits(h,f);(function(){this.toString=function(){return'"'+
this.placeholder+'" '+this.range.toString()};this.setFoldLine=function(g){this.foldLine=g;this.subFolds.forEach(function(m){m.setFoldLine(g)})};this.clone=function(){var g=this.range.clone(),m=new h(g,this.placeholder);this.subFolds.forEach(function(q){m.subFolds.push(q.clone())});m.collapseChildren=this.collapseChildren;return m};this.addSubFold=function(g){if(!this.range.isEqual(g)){var m=this.start;l(g.start,m);l(g.end,m);for(var q=g.start.row,r=g.start.column,B=0,D=-1;B<this.subFolds.length&&
(D=this.subFolds[B].range.compare(q,r),1==D);B++);q=this.subFolds[B];m=0;if(0==D){if(q.range.containsRange(g))return q.addSubFold(g);m=1}q=g.range.end.row;r=g.range.end.column;var F=B;for(D=-1;F<this.subFolds.length&&(D=this.subFolds[F].range.compare(q,r),1==D);F++);0==D&&F++;B=this.subFolds.splice(B,F-B,g);for(D=0==D?B.length-1:B.length;m<D;m++)g.addSubFold(B[m]);g.setFoldLine(this.foldLine);return g}};this.restoreRange=function(g){var m=this.start;e(g.start,m);e(g.end,m)}}).call(h.prototype)});
define("ace/edit_session/folding","require exports module ace/range ace/edit_session/fold_line ace/edit_session/fold ace/token_iterator".split(" "),function(a,b){var l=a("../range").Range,e=a("./fold_line").FoldLine,f=a("./fold").Fold,h=a("../token_iterator").TokenIterator;b.Folding=function(){this.getFoldAt=function(g,m,q){var r=this.getFoldLine(g);if(!r)return null;r=r.folds;for(var B=0;B<r.length;B++){var D=r[B].range;if(D.contains(g,m)&&(1!=q||!D.isEnd(g,m)||D.isEmpty())&&(-1!=q||!D.isStart(g,
m)||D.isEmpty()))return r[B]}};this.getFoldsInRange=function(g){var m=g.start,q=g.end,r=this.$foldData,B=[];m.column+=1;--q.column;for(var D=0;D<r.length;D++){var F=r[D].range.compareRange(g);if(2!=F){if(-2==F)break;for(var G=r[D].folds,N=0;N<G.length;N++){var T=G[N];F=T.range.compareRange(g);if(-2==F)break;else if(2==F)continue;else if(42==F)break;B.push(T)}}}--m.column;q.column+=1;return B};this.getFoldsInRangeList=function(g){if(Array.isArray(g)){var m=[];g.forEach(function(q){m=m.concat(this.getFoldsInRange(q))},
this)}else m=this.getFoldsInRange(g);return m};this.getAllFolds=function(){for(var g=[],m=this.$foldData,q=0;q<m.length;q++)for(var r=0;r<m[q].folds.length;r++)g.push(m[q].folds[r]);return g};this.getFoldStringAt=function(g,m,q,r){r=r||this.getFoldLine(g);if(!r)return null;for(var B={end:{column:0}},D,F,G=0;G<r.folds.length;G++){F=r.folds[G];var N=F.range.compareEnd(g,m);if(-1==N){D=this.getLine(F.start.row).substring(B.end.column,F.start.column);break}else if(0===N)return null;B=F}D||=this.getLine(F.start.row).substring(B.end.column);
return-1==q?D.substring(0,m-B.end.column):1==q?D.substring(m-B.end.column):D};this.getFoldLine=function(g,m){var q=this.$foldData,r=0;m&&(r=q.indexOf(m));-1==r&&(r=0);for(r;r<q.length;r++){m=q[r];if(m.start.row<=g&&m.end.row>=g)return m;if(m.end.row>g)break}return null};this.getNextFoldLine=function(g,m){var q=this.$foldData,r=0;m&&(r=q.indexOf(m));-1==r&&(r=0);for(r;r<q.length;r++)if(m=q[r],m.end.row>=g)return m;return null};this.getFoldedRowCount=function(g,m){for(var q=this.$foldData,r=m-g+1,B=
0;B<q.length;B++){var D=q[B],F=D.end.row;D=D.start.row;if(F>=m){D<m&&(r=D>=g?r-(m-D):0);break}else F>=g&&(r=D>=g?r-(F-D):r-(F-g+1))}return r};this.$addFoldLine=function(g){this.$foldData.push(g);this.$foldData.sort(function(m,q){return m.start.row-q.start.row});return g};this.addFold=function(g,m){var q=this.$foldData,r=!1;if(g instanceof f)var B=g;else B=new f(m,g),B.collapseChildren=m.collapseChildren;this.$clipRangeToDocument(B.range);m=B.start.row;var D=B.start.column;g=B.end.row;var F=B.end.column,
G=this.getFoldAt(m,D,1),N=this.getFoldAt(g,F,-1);if(G&&N==G)return G.addSubFold(B);G&&!G.range.isStart(m,D)&&this.removeFold(G);N&&!N.range.isEnd(g,F)&&this.removeFold(N);D=this.getFoldsInRange(B.range);0<D.length&&(this.removeFolds(D),D.forEach(function(V){B.addSubFold(V)}));for(D=0;D<q.length;D++){var T=q[D];if(g==T.start.row){T.addFold(B);r=!0;break}else if(m==T.end.row){T.addFold(B);r=!0;if(!B.sameRow&&(q=q[D+1])&&q.start.row==g){T.merge(q);break}break}else if(g<=T.start.row)break}r||(T=this.$addFoldLine(new e(this.$foldData,
B)));this.$useWrapMode?this.$updateWrapData(T.start.row,T.start.row):this.$updateRowLengthCache(T.start.row,T.start.row);this.$modified=!0;this._signal("changeFold",{data:B,action:"add"});return B};this.addFolds=function(g){g.forEach(function(m){this.addFold(m)},this)};this.removeFold=function(g){var m=g.foldLine,q=m.start.row,r=m.end.row,B=this.$foldData,D=m.folds;1==D.length?B.splice(B.indexOf(m),1):m.range.isEnd(g.end.row,g.end.column)?(D.pop(),m.end.row=D[D.length-1].end.row,m.end.column=D[D.length-
1].end.column):m.range.isStart(g.start.row,g.start.column)?(D.shift(),m.start.row=D[0].start.row,m.start.column=D[0].start.column):g.sameRow?D.splice(D.indexOf(g),1):(m=m.split(g.start.row,g.start.column),D=m.folds,D.shift(),m.start.row=D[0].start.row,m.start.column=D[0].start.column);this.$updating||(this.$useWrapMode?this.$updateWrapData(q,r):this.$updateRowLengthCache(q,r));this.$modified=!0;this._signal("changeFold",{data:g,action:"remove"})};this.removeFolds=function(g){for(var m=[],q=0;q<g.length;q++)m.push(g[q]);
m.forEach(function(r){this.removeFold(r)},this);this.$modified=!0};this.expandFold=function(g){this.removeFold(g);g.subFolds.forEach(function(m){g.restoreRange(m);this.addFold(m)},this);0<g.collapseChildren&&this.foldAll(g.start.row+1,g.end.row,g.collapseChildren-1);g.subFolds=[]};this.expandFolds=function(g){g.forEach(function(m){this.expandFold(m)},this)};this.unfold=function(g,m){null==g?(g=new l(0,0,this.getLength(),0),m=!0):g="number"==typeof g?new l(g,0,g,this.getLine(g).length):"row"in g?l.fromPoints(g,
g):g;var q=this.getFoldsInRangeList(g);if(m)this.removeFolds(q);else for(m=q;m.length;)this.expandFolds(m),m=this.getFoldsInRangeList(g);if(q.length)return q};this.isRowFolded=function(g,m){return!!this.getFoldLine(g,m)};this.getRowFoldEnd=function(g,m){return(m=this.getFoldLine(g,m))?m.end.row:g};this.getRowFoldStart=function(g,m){return(m=this.getFoldLine(g,m))?m.start.row:g};this.getFoldDisplayLine=function(g,m,q,r,B){null==r&&(r=g.start.row);null==B&&(B=0);null==m&&(m=g.end.row);null==q&&(q=this.getLine(m).length);
var D=this.doc,F="";g.walk(function(G,N,T,V){if(!(N<r)){if(N==r){if(T<B)return;V=Math.max(B,V)}F=null!=G?F+G:F+D.getLine(N).substring(V,T)}},m,q);return F};this.getDisplayLine=function(g,m,q,r){var B=this.getFoldLine(g);if(B)return this.getFoldDisplayLine(B,g,m,q,r);g=this.doc.getLine(g);return g.substring(r||0,m||g.length)};this.$cloneFoldData=function(){var g=[];return g=this.$foldData.map(function(m){m=m.folds.map(function(q){return q.clone()});return new e(g,m)})};this.toggleFold=function(g){var m=
this.selection.getRange(),q;if(m.isEmpty()){var r=m.start;if(q=this.getFoldAt(r.row,r.column)){this.expandFold(q);return}(g=this.findMatchingBracket(r))?1==m.comparePoint(g)?m.end=g:(m.start=g,m.start.column++,m.end.column--):(g=this.findMatchingBracket({row:r.row,column:r.column+1}))?(1==m.comparePoint(g)?m.end=g:m.start=g,m.start.column++):m=this.getCommentFoldRange(r.row,r.column)||m}else{r=this.getFoldsInRange(m);if(g&&r.length){this.expandFolds(r);return}1==r.length&&(q=r[0])}q||=this.getFoldAt(m.start.row,
m.start.column);if(q&&q.range.toString()==m.toString())this.expandFold(q);else{q="...";if(!m.isMultiLine()){q=this.getTextRange(m);if(4>q.length)return;q=q.trim().substring(0,2)+".."}this.addFold(q,m)}};this.getCommentFoldRange=function(g,m,q){var r=new h(this,g,m),B=r.getCurrentToken(),D=B.type;if(B&&/^comment|string/.test(D)){D=D.match(/comment|string/)[0];"comment"==D&&(D+="|doc-start");D=new RegExp(D);var F=new l;if(1!=q){do B=r.stepBackward();while(B&&D.test(B.type));r.stepForward()}F.start.row=
r.getCurrentTokenRow();F.start.column=r.getCurrentTokenColumn()+2;r=new h(this,g,m);if(-1!=q){g=-1;do if(B=r.stepForward(),-1==g)m=this.getState(r.$row),D.test(m)||(g=r.$row);else if(r.$row>g)break;while(B&&D.test(B.type));B=r.stepBackward()}else B=r.getCurrentToken();F.end.row=r.getCurrentTokenRow();F.end.column=r.getCurrentTokenColumn()+B.value.length-2;return F}};this.foldAll=function(g,m,q){void 0==q&&(q=1E5);var r=this.foldWidgets;if(r){m=m||this.getLength();for(var B=g=g||0;B<m;B++)if(null==
r[B]&&(r[B]=this.getFoldWidget(B)),"start"==r[B]){var D=this.getFoldWidgetRange(B);if(D&&D.isMultiLine()&&D.end.row<=m&&D.start.row>=g){B=D.end.row;try{var F=this.addFold("...",D);F&&(F.collapseChildren=q)}catch(G){}}}}};this.$foldStyles={manual:1,markbegin:1,markbeginend:1};this.$foldStyle="markbegin";this.setFoldStyle=function(g){if(!this.$foldStyles[g])throw Error("invalid fold style: "+g+"["+Object.keys(this.$foldStyles).join(", ")+"]");this.$foldStyle!=g&&(this.$foldStyle=g,"manual"==g&&this.unfold(),
g=this.$foldMode,this.$setFolding(null),this.$setFolding(g))};this.$setFolding=function(g){this.$foldMode!=g&&(this.$foldMode=g,this.off("change",this.$updateFoldWidgets),this.off("tokenizerUpdate",this.$tokenizerUpdateFoldWidgets),this._signal("changeAnnotation"),g&&"manual"!=this.$foldStyle?(this.foldWidgets=[],this.getFoldWidget=g.getFoldWidget.bind(g,this,this.$foldStyle),this.getFoldWidgetRange=g.getFoldWidgetRange.bind(g,this,this.$foldStyle),this.$updateFoldWidgets=this.updateFoldWidgets.bind(this),
this.$tokenizerUpdateFoldWidgets=this.tokenizerUpdateFoldWidgets.bind(this),this.on("change",this.$updateFoldWidgets),this.on("tokenizerUpdate",this.$tokenizerUpdateFoldWidgets)):this.foldWidgets=null)};this.getParentFoldRangeData=function(g,m){var q=this.foldWidgets;if(!q||m&&q[g])return{};m=g-1;for(var r;0<=m;){var B=q[m];null==B&&(B=q[m]=this.getFoldWidget(m));if("start"==B){var D=this.getFoldWidgetRange(m);r||=D;if(D&&D.end.row>=g)break}m--}return{range:-1!==m&&D,firstRange:r}};this.onFoldWidgetClick=
function(g,m){m=m.domEvent;this.$toggleFoldWidget(g,{children:m.shiftKey,all:m.ctrlKey||m.metaKey,siblings:m.altKey})||(g=m.target||m.srcElement)&&/ace_fold-widget/.test(g.className)&&(g.className+=" ace_invalid")};this.$toggleFoldWidget=function(g,m){if(this.getFoldWidget){var q=this.getFoldWidget(g),r=this.getLine(g);q="end"===q?-1:1;if(q=this.getFoldAt(g,-1===q?0:r.length,q))return m.children||m.all?this.removeFold(q):this.expandFold(q),q;if((r=this.getFoldWidgetRange(g,!0))&&!r.isMultiLine()&&
(q=this.getFoldAt(r.start.row,r.start.column,1))&&r.isEqual(q.range))return this.removeFold(q),q;if(m.siblings){g=this.getParentFoldRangeData(g);if(g.range)var B=g.range.start.row+1,D=g.range.end.row;this.foldAll(B,D,m.all?1E4:0)}else m.children?(D=r?r.end.row:this.getLength(),this.foldAll(g+1,D,m.all?1E4:0)):r&&(m.all&&(r.collapseChildren=1E4),this.addFold("...",r));return r}};this.toggleFoldWidget=function(){var g=this.selection.getCursor().row;g=this.getRowFoldStart(g);var m=this.$toggleFoldWidget(g,
{});!m&&(m=this.getParentFoldRangeData(g,!0),m=m.range||m.firstRange)&&(g=m.start.row,(g=this.getFoldAt(g,this.getLine(g).length,1))?this.removeFold(g):this.addFold("...",m))};this.updateFoldWidgets=function(g){var m=g.start.row,q=g.end.row-m;0===q?this.foldWidgets[m]=null:"remove"==g.action?this.foldWidgets.splice(m,q+1,null):(g=Array(q+1),g.unshift(m,1),this.foldWidgets.splice.apply(this.foldWidgets,g))};this.tokenizerUpdateFoldWidgets=function(g){g=g.data;g.first!=g.last&&this.foldWidgets.length>
g.first&&this.foldWidgets.splice(g.first,this.foldWidgets.length)}}});
define("ace/edit_session/bracket_match",["require","exports","module","ace/token_iterator","ace/range"],function(a,b){var l=a("../token_iterator").TokenIterator,e=a("../range").Range;b.BracketMatch=function(){this.findMatchingBracket=function(f,h){if(0==f.column)return null;h=h||this.getLine(f.row).charAt(f.column-1);return""==h?null:(h=h.match(/([\(\[\{])|([\)\]\}])/))?h[1]?this.$findClosingBracket(h[1],f):this.$findOpeningBracket(h[2],f):null};this.getBracketRange=function(f){var h=this.getLine(f.row),
g=!0,m=h.charAt(f.column-1);m=m&&m.match(/([\(\[\{])|([\)\]\}])/);m||(m=h.charAt(f.column),f={row:f.row,column:f.column+1},m=m&&m.match(/([\(\[\{])|([\)\]\}])/),g=!1);if(!m)return null;if(m[1]){h=this.$findClosingBracket(m[1],f);if(!h)return null;f=e.fromPoints(f,h);g||(f.end.column++,f.start.column--);f.cursor=f.end}else{h=this.$findOpeningBracket(m[2],f);if(!h)return null;f=e.fromPoints(h,f);g||(f.start.column++,f.end.column--);f.cursor=f.start}return f};this.getMatchingBracketRanges=function(f){var h=
this.getLine(f.row),g=h.charAt(f.column-1);g=g&&g.match(/([\(\[\{])|([\)\]\}])/);g||(g=h.charAt(f.column),f={row:f.row,column:f.column+1},g=g&&g.match(/([\(\[\{])|([\)\]\}])/));if(!g)return null;h=new e(f.row,f.column-1,f.row,f.column);f=g[1]?this.$findClosingBracket(g[1],f):this.$findOpeningBracket(g[2],f);if(!f)return[h];f=new e(f.row,f.column,f.row,f.column+1);return[h,f]};this.$brackets={")":"(","(":")","]":"[","[":"]","{":"}","}":"{","<":">",">":"<"};this.$findOpeningBracket=function(f,h,g){var m=
this.$brackets[f],q=1,r=new l(this,h.row,h.column),B=r.getCurrentToken();B||=r.stepForward();if(B){g||=new RegExp("(\\.?"+B.type.replace(".","\\.").replace("rparen",".paren").replace(/\b(?:end)\b/,"(?:start|begin|end)")+")+");h=h.column-r.getCurrentTokenColumn()-2;for(B=B.value;;){for(;0<=h;){var D=B.charAt(h);if(D==m){if(--q,0==q)return{row:r.getCurrentTokenRow(),column:h+r.getCurrentTokenColumn()}}else D==f&&(q+=1);--h}do B=r.stepBackward();while(B&&!g.test(B.type));if(null==B)break;B=B.value;h=
B.length-1}return null}};this.$findClosingBracket=function(f,h,g){var m=this.$brackets[f],q=1,r=new l(this,h.row,h.column),B=r.getCurrentToken();B||=r.stepForward();if(B){g||=new RegExp("(\\.?"+B.type.replace(".","\\.").replace("lparen",".paren").replace(/\b(?:start|begin)\b/,"(?:start|begin|end)")+")+");for(h=h.column-r.getCurrentTokenColumn();;){B=B.value;for(var D=B.length;h<D;){var F=B.charAt(h);if(F==m){if(--q,0==q)return{row:r.getCurrentTokenRow(),column:h+r.getCurrentTokenColumn()}}else F==
f&&(q+=1);h+=1}do B=r.stepForward();while(B&&!g.test(B.type));if(null==B)break;h=0}return null}}}});
define("ace/edit_session","require exports module ace/lib/oop ace/lib/lang ace/bidihandler ace/config ace/lib/event_emitter ace/selection ace/mode/text ace/range ace/document ace/background_tokenizer ace/search_highlight ace/edit_session/folding ace/edit_session/bracket_match".split(" "),function(a,b){function l(N,T){this.$breakpoints=[];this.$decorations=[];this.$frontMarkers={};this.$backMarkers={};this.$markerId=1;this.$undoSelect=!0;this.$foldData=[];this.id="session"+ ++l.$uid;this.$foldData.toString=
function(){return this.join("\n")};this.on("changeFold",this.onChangeFold.bind(this));this.$onChange=this.onChange.bind(this);"object"==typeof N&&N.getLine||(N=new D(N));this.setDocument(N);this.selection=new q(this);this.$bidiHandler=new h(this);g.resetOptions(this);this.setMode(T);g._signal("session",this)}var e=a("./lib/oop"),f=a("./lib/lang"),h=a("./bidihandler").BidiHandler,g=a("./config"),m=a("./lib/event_emitter").EventEmitter,q=a("./selection").Selection,r=a("./mode/text").Mode,B=a("./range").Range,
D=a("./document").Document,F=a("./background_tokenizer").BackgroundTokenizer,G=a("./search_highlight").SearchHighlight;l.$uid=0;(function(){function N(E){return 4352>E?!1:4352<=E&&4447>=E||4515<=E&&4519>=E||4602<=E&&4607>=E||9001<=E&&9002>=E||11904<=E&&11929>=E||11931<=E&&12019>=E||12032<=E&&12245>=E||12272<=E&&12283>=E||12288<=E&&12350>=E||12353<=E&&12438>=E||12441<=E&&12543>=E||12549<=E&&12589>=E||12593<=E&&12686>=E||12688<=E&&12730>=E||12736<=E&&12771>=E||12784<=E&&12830>=E||12832<=E&&12871>=E||
12880<=E&&13054>=E||13056<=E&&19903>=E||19968<=E&&42124>=E||42128<=E&&42182>=E||43360<=E&&43388>=E||44032<=E&&55203>=E||55216<=E&&55238>=E||55243<=E&&55291>=E||63744<=E&&64255>=E||65040<=E&&65049>=E||65072<=E&&65106>=E||65108<=E&&65126>=E||65128<=E&&65131>=E||65281<=E&&65376>=E||65504<=E&&65510>=E}e.implement(this,m);this.setDocument=function(E){this.doc&&this.doc.removeListener("change",this.$onChange);this.doc=E;E.on("change",this.$onChange);this.bgTokenizer&&this.bgTokenizer.setDocument(this.getDocument());
this.resetCaches()};this.getDocument=function(){return this.doc};this.$resetRowCache=function(E){if(E){var Q=this.$docRowCache.length;E=this.$getRowCacheIndex(this.$docRowCache,E)+1;Q>E&&(this.$docRowCache.splice(E,Q),this.$screenRowCache.splice(E,Q))}else this.$docRowCache=[],this.$screenRowCache=[]};this.$getRowCacheIndex=function(E,Q){for(var aa=0,qa=E.length-1;aa<=qa;){var P=aa+qa>>1,ea=E[P];if(Q>ea)aa=P+1;else if(Q<ea)qa=P-1;else return P}return aa-1};this.resetCaches=function(){this.$modified=
!0;this.$wrapData=[];this.$rowLengthCache=[];this.$resetRowCache(0);this.bgTokenizer&&this.bgTokenizer.start(0)};this.onChangeFold=function(E){this.$resetRowCache(E.data.start.row)};this.onChange=function(E){this.$modified=!0;this.$bidiHandler.onChange(E);this.$resetRowCache(E.start.row);var Q=this.$updateInternalDataOnChange(E);!this.$fromUndo&&this.$undoManager&&(Q&&Q.length&&(this.$undoManager.add({action:"removeFolds",folds:Q},this.mergeUndoDeltas),this.mergeUndoDeltas=!0),this.$undoManager.add(E,
this.mergeUndoDeltas),this.mergeUndoDeltas=!0,this.$informUndoManager.schedule());this.bgTokenizer&&this.bgTokenizer.$updateOnChange(E);this._signal("change",E)};this.setValue=function(E){this.doc.setValue(E);this.selection.moveTo(0,0);this.$resetRowCache(0);this.setUndoManager(this.$undoManager);this.getUndoManager().reset()};this.getValue=this.toString=function(){return this.doc.getValue()};this.getSelection=function(){return this.selection};this.getState=function(E){return this.bgTokenizer.getState(E)};
this.getTokens=function(E){return this.bgTokenizer.getTokens(E)};this.getTokenAt=function(E,Q){var aa=this.bgTokenizer.getTokens(E),qa=0;if(null==Q){var P=aa.length-1;qa=this.getLine(E).length}else for(P=0;P<aa.length&&!(qa+=aa[P].value.length,qa>=Q);P++);E=aa[P];if(!E)return null;E.index=P;E.start=qa-E.value.length;return E};this.setUndoManager=function(E){this.$undoManager=E;this.$informUndoManager&&this.$informUndoManager.cancel();if(E){var Q=this;E.addSession(this);this.$syncInformUndoManager=
function(){Q.$informUndoManager.cancel();Q.mergeUndoDeltas=!1};this.$informUndoManager=f.delayedCall(this.$syncInformUndoManager)}else this.$syncInformUndoManager=function(){}};this.markUndoGroup=function(){this.$syncInformUndoManager&&this.$syncInformUndoManager()};this.$defaultUndoManager={undo:function(){},redo:function(){},hasUndo:function(){},hasRedo:function(){},reset:function(){},add:function(){},addSelection:function(){},startNewGroup:function(){},addSession:function(){}};this.getUndoManager=
function(){return this.$undoManager||this.$defaultUndoManager};this.getTabString=function(){return this.getUseSoftTabs()?f.stringRepeat(" ",this.getTabSize()):"\t"};this.setUseSoftTabs=function(E){this.setOption("useSoftTabs",E)};this.getUseSoftTabs=function(){return this.$useSoftTabs&&!this.$mode.$indentWithTabs};this.setTabSize=function(E){this.setOption("tabSize",E)};this.getTabSize=function(){return this.$tabSize};this.isTabStop=function(E){return this.$useSoftTabs&&0===E.column%this.$tabSize};
this.setNavigateWithinSoftTabs=function(E){this.setOption("navigateWithinSoftTabs",E)};this.getNavigateWithinSoftTabs=function(){return this.$navigateWithinSoftTabs};this.$overwrite=!1;this.setOverwrite=function(E){this.setOption("overwrite",E)};this.getOverwrite=function(){return this.$overwrite};this.toggleOverwrite=function(){this.setOverwrite(!this.$overwrite)};this.addGutterDecoration=function(E,Q){this.$decorations[E]||(this.$decorations[E]="");this.$decorations[E]+=" "+Q;this._signal("changeBreakpoint",
{})};this.removeGutterDecoration=function(E,Q){this.$decorations[E]=(this.$decorations[E]||"").replace(" "+Q,"");this._signal("changeBreakpoint",{})};this.getBreakpoints=function(){return this.$breakpoints};this.setBreakpoints=function(E){this.$breakpoints=[];for(var Q=0;Q<E.length;Q++)this.$breakpoints[E[Q]]="ace_breakpoint";this._signal("changeBreakpoint",{})};this.clearBreakpoints=function(){this.$breakpoints=[];this._signal("changeBreakpoint",{})};this.setBreakpoint=function(E,Q){void 0===Q&&
(Q="ace_breakpoint");Q?this.$breakpoints[E]=Q:delete this.$breakpoints[E];this._signal("changeBreakpoint",{})};this.clearBreakpoint=function(E){delete this.$breakpoints[E];this._signal("changeBreakpoint",{})};this.addMarker=function(E,Q,aa,qa){var P=this.$markerId++;E={range:E,type:aa||"line",renderer:"function"==typeof aa?aa:null,clazz:Q,inFront:!!qa,id:P};qa?(this.$frontMarkers[P]=E,this._signal("changeFrontMarker")):(this.$backMarkers[P]=E,this._signal("changeBackMarker"));return P};this.addDynamicMarker=
function(E,Q){if(E.update){var aa=this.$markerId++;E.id=aa;E.inFront=!!Q;Q?(this.$frontMarkers[aa]=E,this._signal("changeFrontMarker")):(this.$backMarkers[aa]=E,this._signal("changeBackMarker"));return E}};this.removeMarker=function(E){var Q=this.$frontMarkers[E]||this.$backMarkers[E];Q&&(delete (Q.inFront?this.$frontMarkers:this.$backMarkers)[E],this._signal(Q.inFront?"changeFrontMarker":"changeBackMarker"))};this.getMarkers=function(E){return E?this.$frontMarkers:this.$backMarkers};this.highlight=
function(E){if(!this.$searchHighlight){var Q=new G(null,"ace_selected-word","text");this.$searchHighlight=this.addDynamicMarker(Q)}this.$searchHighlight.setRegexp(E)};this.highlightLines=function(E,Q,aa,qa){"number"!=typeof Q&&(aa=Q,Q=E);aa||="ace_step";E=new B(E,0,Q,Infinity);E.id=this.addMarker(E,aa,"fullLine",qa);return E};this.setAnnotations=function(E){this.$annotations=E;this._signal("changeAnnotation",{})};this.getAnnotations=function(){return this.$annotations||[]};this.clearAnnotations=function(){this.setAnnotations([])};
this.$detectNewLine=function(E){this.$autoNewLine=(E=E.match(/^.*?(\r?\n)/m))?E[1]:"\n"};this.getWordRange=function(E,Q){var aa=this.getLine(E),qa=!1;0<Q&&(qa=!!aa.charAt(Q-1).match(this.tokenRe));qa||=!!aa.charAt(Q).match(this.tokenRe);qa=qa?this.tokenRe:/^\s+$/.test(aa.slice(Q-1,Q+1))?/\s/:this.nonTokenRe;var P=Q;if(0<P){do P--;while(0<=P&&aa.charAt(P).match(qa));P++}for(;Q<aa.length&&aa.charAt(Q).match(qa);)Q++;return new B(E,P,E,Q)};this.getAWordRange=function(E,Q){E=this.getWordRange(E,Q);for(Q=
this.getLine(E.end.row);Q.charAt(E.end.column).match(/[ \t]/);)E.end.column+=1;return E};this.setNewLineMode=function(E){this.doc.setNewLineMode(E)};this.getNewLineMode=function(){return this.doc.getNewLineMode()};this.setUseWorker=function(E){this.setOption("useWorker",E)};this.getUseWorker=function(){return this.$useWorker};this.onReloadTokenizer=function(E){this.bgTokenizer.start(E.data.first);this._signal("tokenizerUpdate",E)};this.$modes=g.$modes;this.$modeId=this.$mode=null;this.setMode=function(E,
Q){if(E&&"object"===typeof E){if(E.getTokenizer)return this.$onChangeMode(E);var aa=E,qa=aa.path}else qa=E||"ace/mode/text";this.$modes["ace/mode/text"]||(this.$modes["ace/mode/text"]=new r);this.$modes[qa]&&!aa?(this.$onChangeMode(this.$modes[qa]),Q&&Q()):(this.$modeId=qa,g.loadModule(["mode",qa],function(P){if(this.$modeId!==qa)return Q&&Q();this.$modes[qa]&&!aa?this.$onChangeMode(this.$modes[qa]):P&&P.Mode&&(P=new P.Mode(aa),aa||(this.$modes[qa]=P,P.$id=qa),this.$onChangeMode(P));Q&&Q()}.bind(this)),
this.$mode||this.$onChangeMode(this.$modes["ace/mode/text"],!0))};this.$onChangeMode=function(E,Q){Q||(this.$modeId=E.$id);if(this.$mode!==E){var aa=this.$mode;this.$mode=E;this.$stopWorker();this.$useWorker&&this.$startWorker();var qa=E.getTokenizer();if(void 0!==qa.on){var P=this.onReloadTokenizer.bind(this);qa.on("update",P)}if(this.bgTokenizer)this.bgTokenizer.setTokenizer(qa);else{this.bgTokenizer=new F(qa);var ea=this;this.bgTokenizer.on("update",function(ua){ea._signal("tokenizerUpdate",ua)})}this.bgTokenizer.setDocument(this.getDocument());
this.tokenRe=E.tokenRe;this.nonTokenRe=E.nonTokenRe;Q||(E.attachToSession&&E.attachToSession(this),this.$options.wrapMethod.set.call(this,this.$wrapMethod),this.$setFolding(E.foldingRules),this.bgTokenizer.start(0),this._emit("changeMode",{oldMode:aa,mode:E}))}};this.$stopWorker=function(){this.$worker&&(this.$worker.terminate(),this.$worker=null)};this.$startWorker=function(){try{this.$worker=this.$mode.createWorker(this)}catch(E){g.warn("Could not load worker",E),this.$worker=null}};this.getMode=
function(){return this.$mode};this.$scrollTop=0;this.setScrollTop=function(E){this.$scrollTop===E||isNaN(E)||(this.$scrollTop=E,this._signal("changeScrollTop",E))};this.getScrollTop=function(){return this.$scrollTop};this.$scrollLeft=0;this.setScrollLeft=function(E){this.$scrollLeft===E||isNaN(E)||(this.$scrollLeft=E,this._signal("changeScrollLeft",E))};this.getScrollLeft=function(){return this.$scrollLeft};this.getScreenWidth=function(){this.$computeWidth();return this.lineWidgets?Math.max(this.getLineWidgetMaxWidth(),
this.screenWidth):this.screenWidth};this.getLineWidgetMaxWidth=function(){if(null!=this.lineWidgetsWidth)return this.lineWidgetsWidth;var E=0;this.lineWidgets.forEach(function(Q){Q&&Q.screenWidth>E&&(E=Q.screenWidth)});return this.lineWidgetWidth=E};this.$computeWidth=function(E){if(this.$modified||E){this.$modified=!1;if(this.$useWrapMode)return this.screenWidth=this.$wrapLimit;E=this.doc.getAllLines();for(var Q=this.$rowLengthCache,aa=0,qa=0,P=this.$foldData[qa],ea=P?P.start.row:Infinity,ua=E.length,
Fa=0;Fa<ua;Fa++){if(Fa>ea){Fa=P.end.row+1;if(Fa>=ua)break;ea=(P=this.$foldData[qa++])?P.start.row:Infinity}null==Q[Fa]&&(Q[Fa]=this.$getStringScreenWidth(E[Fa])[0]);Q[Fa]>aa&&(aa=Q[Fa])}this.screenWidth=aa}};this.getLine=function(E){return this.doc.getLine(E)};this.getLines=function(E,Q){return this.doc.getLines(E,Q)};this.getLength=function(){return this.doc.getLength()};this.getTextRange=function(E){return this.doc.getTextRange(E||this.selection.getRange())};this.insert=function(E,Q){return this.doc.insert(E,
Q)};this.remove=function(E,Q){return this.doc.remove(E,Q)};this.removeFullLines=function(E,Q){return this.doc.removeFullLines(E,Q)};this.undoChanges=function(E,Q){if(E.length){this.$fromUndo=!0;for(var aa=E.length-1;-1!=aa;aa--){var qa=E[aa];"insert"==qa.action||"remove"==qa.action?this.doc.revertDelta(qa):qa.folds&&this.addFolds(qa.folds)}!Q&&this.$undoSelect&&(E.selectionBefore?this.selection.fromJSON(E.selectionBefore):this.selection.setRange(this.$getUndoSelection(E,!0)));this.$fromUndo=!1}};
this.redoChanges=function(E,Q){if(E.length){this.$fromUndo=!0;for(var aa=0;aa<E.length;aa++){var qa=E[aa];"insert"!=qa.action&&"remove"!=qa.action||this.doc.$safeApplyDelta(qa)}!Q&&this.$undoSelect&&(E.selectionAfter?this.selection.fromJSON(E.selectionAfter):this.selection.setRange(this.$getUndoSelection(E,!1)));this.$fromUndo=!1}};this.setUndoSelect=function(E){this.$undoSelect=E};this.$getUndoSelection=function(E,Q){for(var aa,qa,P=0;P<E.length;P++){var ea=E[P];ea.start&&(aa?(Q?"insert"!==ea.action:
"insert"===ea.action)?(qa=ea.start,-1==aa.compare(qa.row,qa.column)&&aa.setStart(qa),qa=ea.end,1==aa.compare(qa.row,qa.column)&&aa.setEnd(qa)):(qa=ea.start,-1==aa.compare(qa.row,qa.column)&&(aa=B.fromPoints(ea.start,ea.start))):aa=(Q?"insert"!==ea.action:"insert"===ea.action)?B.fromPoints(ea.start,ea.end):B.fromPoints(ea.start,ea.start))}return aa};this.replace=function(E,Q){return this.doc.replace(E,Q)};this.moveText=function(E,Q,aa){var qa=this.getTextRange(E),P=this.getFoldsInRange(E);Q=B.fromPoints(Q,
Q);if(!aa){this.remove(E);var ea=E.start.row-E.end.row,ua=ea?-E.end.column:E.start.column-E.end.column;ua&&(Q.start.row==E.end.row&&Q.start.column>E.end.column&&(Q.start.column+=ua),Q.end.row==E.end.row&&Q.end.column>E.end.column&&(Q.end.column+=ua));ea&&Q.start.row>=E.end.row&&(Q.start.row+=ea,Q.end.row+=ea)}Q.end=this.insert(Q.start,qa);if(P.length){var Fa=E.start;E=Q.start;ea=E.row-Fa.row;ua=E.column-Fa.column;this.addFolds(P.map(function(pa){pa=pa.clone();pa.start.row==Fa.row&&(pa.start.column+=
ua);pa.end.row==Fa.row&&(pa.end.column+=ua);pa.start.row+=ea;pa.end.row+=ea;return pa}))}return Q};this.indentRows=function(E,Q,aa){for(aa=aa.replace(/\t/g,this.getTabString());E<=Q;E++)this.doc.insertInLine({row:E,column:0},aa)};this.outdentRows=function(E){E=E.collapseRows();for(var Q=new B(0,0,0,0),aa=this.getTabSize(),qa=E.start.row;qa<=E.end.row;++qa){var P=this.getLine(qa);Q.start.row=qa;Q.end.row=qa;for(var ea=0;ea<aa&&" "==P.charAt(ea);++ea);ea<aa&&"\t"==P.charAt(ea)?(Q.start.column=ea,Q.end.column=
ea+1):(Q.start.column=0,Q.end.column=ea);this.remove(Q)}};this.$moveLines=function(E,Q,aa){E=this.getRowFoldStart(E);Q=this.getRowFoldEnd(Q);if(0>aa){var qa=this.getRowFoldStart(E+aa);if(0>qa)return 0;var P=qa-E}else if(0<aa){qa=this.getRowFoldEnd(Q+aa);if(qa>this.doc.getLength()-1)return 0;P=qa-Q}else E=this.$clipRowToDocument(E),Q=this.$clipRowToDocument(Q),P=Q-E+1;qa=new B(E,0,Q,Number.MAX_VALUE);qa=this.getFoldsInRange(qa).map(function(ea){ea=ea.clone();ea.start.row+=P;ea.end.row+=P;return ea});
Q=0==aa?this.doc.getLines(E,Q):this.doc.removeFullLines(E,Q);this.doc.insertFullLines(E+P,Q);qa.length&&this.addFolds(qa);return P};this.moveLinesUp=function(E,Q){return this.$moveLines(E,Q,-1)};this.moveLinesDown=function(E,Q){return this.$moveLines(E,Q,1)};this.duplicateLines=function(E,Q){return this.$moveLines(E,Q,0)};this.$clipRowToDocument=function(E){return Math.max(0,Math.min(E,this.doc.getLength()-1))};this.$clipColumnToRow=function(E,Q){return 0>Q?0:Math.min(this.doc.getLine(E).length,Q)};
this.$clipPositionToDocument=function(E,Q){Q=Math.max(0,Q);if(0>E)Q=E=0;else{var aa=this.doc.getLength();E>=aa?(E=aa-1,Q=this.doc.getLine(aa-1).length):Q=Math.min(this.doc.getLine(E).length,Q)}return{row:E,column:Q}};this.$clipRangeToDocument=function(E){0>E.start.row?(E.start.row=0,E.start.column=0):E.start.column=this.$clipColumnToRow(E.start.row,E.start.column);var Q=this.doc.getLength()-1;E.end.row>Q?(E.end.row=Q,E.end.column=this.doc.getLine(Q).length):E.end.column=this.$clipColumnToRow(E.end.row,
E.end.column);return E};this.$wrapLimit=80;this.$useWrapMode=!1;this.$wrapLimitRange={min:null,max:null};this.setUseWrapMode=function(E){E!=this.$useWrapMode&&(this.$useWrapMode=E,this.$modified=!0,this.$resetRowCache(0),E&&(E=this.getLength(),this.$wrapData=Array(E),this.$updateWrapData(0,E-1)),this._signal("changeWrapMode"))};this.getUseWrapMode=function(){return this.$useWrapMode};this.setWrapLimitRange=function(E,Q){if(this.$wrapLimitRange.min!==E||this.$wrapLimitRange.max!==Q)this.$wrapLimitRange=
{min:E,max:Q},this.$modified=!0,this.$bidiHandler.markAsDirty(),this.$useWrapMode&&this._signal("changeWrapMode")};this.adjustWrapLimit=function(E,Q){var aa=this.$wrapLimitRange;0>aa.max&&(aa={min:Q,max:Q});E=this.$constrainWrapLimit(E,aa.min,aa.max);return E!=this.$wrapLimit&&1<E?(this.$wrapLimit=E,this.$modified=!0,this.$useWrapMode&&(this.$updateWrapData(0,this.getLength()-1),this.$resetRowCache(0),this._signal("changeWrapLimit")),!0):!1};this.$constrainWrapLimit=function(E,Q,aa){Q&&(E=Math.max(Q,
E));aa&&(E=Math.min(aa,E));return E};this.getWrapLimit=function(){return this.$wrapLimit};this.setWrapLimit=function(E){this.setWrapLimitRange(E,E)};this.getWrapLimitRange=function(){return{min:this.$wrapLimitRange.min,max:this.$wrapLimitRange.max}};this.$updateInternalDataOnChange=function(E){var Q=this.$useWrapMode,aa=E.action,qa=E.start,P=E.end,ea=qa.row,ua=P.row,Fa=ua-ea,pa=null;this.$updating=!0;if(0!=Fa)if("remove"===aa){this[Q?"$wrapData":"$rowLengthCache"].splice(ea,Fa);aa=this.$foldData;
pa=this.getFoldsInRange(E);this.removeFolds(pa);E=this.getFoldLine(P.row);var ra=0;E&&(E.addRemoveChars(P.row,P.column,qa.column-P.column),E.shiftRow(-Fa),(qa=this.getFoldLine(ea))&&qa!==E&&(qa.merge(E),E=qa),ra=aa.indexOf(E)+1);for(ra;ra<aa.length;ra++)E=aa[ra],E.start.row>=P.row&&E.shiftRow(-Fa);ua=ea}else{aa=Array(Fa);aa.unshift(ea,0);E=Q?this.$wrapData:this.$rowLengthCache;E.splice.apply(E,aa);aa=this.$foldData;E=this.getFoldLine(ea);ra=0;if(E){ra=E.range.compareInside(qa.row,qa.column);if(0==
ra){if(E=E.split(qa.row,qa.column))E.shiftRow(Fa),E.addRemoveChars(ua,0,P.column-qa.column)}else-1==ra&&(E.addRemoveChars(ea,0,P.column-qa.column),E.shiftRow(Fa));ra=aa.indexOf(E)+1}for(ra;ra<aa.length;ra++)E=aa[ra],E.start.row>=ea&&E.shiftRow(Fa)}else Fa=Math.abs(E.start.column-E.end.column),"remove"===aa&&(pa=this.getFoldsInRange(E),this.removeFolds(pa),Fa=-Fa),(E=this.getFoldLine(ea))&&E.addRemoveChars(ea,qa.column,Fa);Q&&this.$wrapData.length!=this.doc.getLength()&&console.error("doc.getLength() and $wrapData.length have to be the same!");
this.$updating=!1;Q?this.$updateWrapData(ea,ua):this.$updateRowLengthCache(ea,ua);return pa};this.$updateRowLengthCache=function(E,Q){this.$rowLengthCache[E]=null;this.$rowLengthCache[Q]=null};this.$updateWrapData=function(E,Q){var aa=this.doc.getAllLines(),qa=this.getTabSize(),P=this.$wrapData,ea=this.$wrapLimit,ua;for(Q=Math.min(Q,aa.length-1);E<=Q;)if(ua=this.getFoldLine(E,ua)){var Fa=[];ua.walk(function(pa,ra,Ca,Ga){if(null!=pa)for(pa=this.$getDisplayTokens(pa,Fa.length),pa[0]=T,ra=1;ra<pa.length;ra++)pa[ra]=
V;else pa=this.$getDisplayTokens(aa[ra].substring(Ga,Ca),Fa.length);Fa=Fa.concat(pa)}.bind(this),ua.end.row,aa[ua.end.row].length+1);P[ua.start.row]=this.$computeWrapSplits(Fa,ea,qa);E=ua.end.row+1}else Fa=this.$getDisplayTokens(aa[E]),P[E]=this.$computeWrapSplits(Fa,ea,qa),E++};var T=3,V=4;this.$computeWrapSplits=function(E,Q,aa){function qa(za){for(var Na=za-ua,ya=ua;ya<za;ya++){var Ia=E[ya];12!==Ia&&2!==Ia||--Na}if(!P.length){ya=0;if(0===Ca)Ga=ya;else{if(ra)for(Ia=0;Ia<E.length;Ia++){var $a=E[Ia];
if(10==$a)ya+=1;else if(11==$a)ya+=aa;else if(12!=$a)break}pa&&!1!==ra&&(ya+=aa);Ga=Math.min(ya,Ca)}P.indent=Ga}Fa+=Na;P.push(Fa);ua=za}if(0==E.length)return[];for(var P=[],ea=E.length,ua=0,Fa=0,pa=this.$wrapAsCode,ra=this.$indentedSoftWrap,Ca=Q<=Math.max(2*aa,8)||!1===ra?0:Math.floor(Q/2),Ga=0;ea-ua>Q-Ga;){var Aa=ua+Q-Ga;if(10<=E[Aa-1]&&10<=E[Aa])qa(Aa);else if(E[Aa]==T||E[Aa]==V){for(Aa;Aa!=ua-1&&E[Aa]!=T;Aa--);if(!(Aa>ua)){Aa=ua+Q;for(Aa;Aa<E.length&&E[Aa]==V;Aa++);if(Aa==E.length)break}qa(Aa)}else{for(var xa=
Math.max(Aa-(Q-(Q>>2)),ua-1);Aa>xa&&E[Aa]<T;)Aa--;if(pa){for(;Aa>xa&&E[Aa]<T;)Aa--;for(;Aa>xa&&9==E[Aa];)Aa--}else for(;Aa>xa&&10>E[Aa];)Aa--;Aa>xa?qa(++Aa):(Aa=ua+Q,2==E[Aa]&&Aa--,qa(Aa-Ga))}}return P};this.$getDisplayTokens=function(E,Q){var aa=[];Q=Q||0;for(var qa=0;qa<E.length;qa++){var P=E.charCodeAt(qa);if(9==P){P=this.getScreenTabSize(aa.length+Q);aa.push(11);for(var ea=1;ea<P;ea++)aa.push(12)}else 32==P?aa.push(10):39<P&&48>P||57<P&&64>P?aa.push(9):4352<=P&&N(P)?aa.push(1,2):aa.push(1)}return aa};
this.$getStringScreenWidth=function(E,Q,aa){if(0==Q)return[0,0];null==Q&&(Q=Infinity);aa=aa||0;var qa;for(qa=0;qa<E.length;qa++){var P=E.charCodeAt(qa);aa=9==P?aa+this.getScreenTabSize(aa):4352<=P&&N(P)?aa+2:aa+1;if(aa>Q)break}return[aa,qa]};this.lineWidgets=null;this.getRowLength=function(E){var Q=1;this.lineWidgets&&(Q+=this.lineWidgets[E]&&this.lineWidgets[E].rowCount||0);return this.$useWrapMode&&this.$wrapData[E]?this.$wrapData[E].length+Q:Q};this.getRowLineCount=function(E){return this.$useWrapMode&&
this.$wrapData[E]?this.$wrapData[E].length+1:1};this.getRowWrapIndent=function(E){if(this.$useWrapMode){E=this.screenToDocumentPosition(E,Number.MAX_VALUE);var Q=this.$wrapData[E.row];return Q.length&&Q[0]<E.column?Q.indent:0}return 0};this.getScreenLastRowColumn=function(E){E=this.screenToDocumentPosition(E,Number.MAX_VALUE);return this.documentToScreenColumn(E.row,E.column)};this.getDocumentLastRowColumn=function(E,Q){E=this.documentToScreenRow(E,Q);return this.getScreenLastRowColumn(E)};this.getDocumentLastRowColumnPosition=
function(E,Q){E=this.documentToScreenRow(E,Q);return this.screenToDocumentPosition(E,Number.MAX_VALUE/10)};this.getRowSplitData=function(E){if(this.$useWrapMode)return this.$wrapData[E]};this.getScreenTabSize=function(E){return this.$tabSize-(E%this.$tabSize|0)};this.screenToDocumentRow=function(E,Q){return this.screenToDocumentPosition(E,Q).row};this.screenToDocumentColumn=function(E,Q){return this.screenToDocumentPosition(E,Q).column};this.screenToDocumentPosition=function(E,Q,aa){if(0>E)return{row:0,
column:0};var qa=0,P=0,ea=0;var ua=0;var Fa=this.$screenRowCache,pa=this.$getRowCacheIndex(Fa,E),ra=Fa.length;ra&&0<=pa?(ea=Fa[pa],qa=this.$docRowCache[pa],pa=E>Fa[ra-1]):pa=!ra;ra=this.getLength()-1;for(var Ca=(Fa=this.getNextFoldLine(qa))?Fa.start.row:Infinity;ea<=E;){ua=this.getRowLength(qa);if(ea+ua>E||qa>=ra)break;else ea+=ua,qa++,qa>Ca&&(qa=Fa.end.row+1,Ca=(Fa=this.getNextFoldLine(qa,Fa))?Fa.start.row:Infinity);pa&&(this.$docRowCache.push(qa),this.$screenRowCache.push(ea))}if(Fa&&Fa.start.row<=
qa)ua=this.getFoldDisplayLine(Fa),qa=Fa.start.row;else{if(ea+ua<=E||qa>ra)return{row:ra,column:this.getLine(ra).length};ua=this.getLine(qa);Fa=null}pa=0;E=Math.floor(E-ea);if(this.$useWrapMode&&(ra=this.$wrapData[qa])){var Ga=ra[E];0<E&&ra.length&&(pa=ra.indent,P=ra[E-1]||ra[ra.length-1],ua=ua.substring(P))}void 0!==aa&&this.$bidiHandler.isBidiRow(ea+E,qa,E)&&(Q=this.$bidiHandler.offsetToCol(aa));P+=this.$getStringScreenWidth(ua,Q-pa)[1];this.$useWrapMode&&P>=Ga&&(P=Ga-1);return Fa?Fa.idxToPosition(P):
{row:qa,column:P}};this.documentToScreenPosition=function(E,Q){var aa="undefined"===typeof Q?this.$clipPositionToDocument(E.row,E.column):this.$clipPositionToDocument(E,Q);E=aa.row;Q=aa.column;aa=0;var qa;if(qa=this.getFoldAt(E,Q,1))E=qa.start.row,Q=qa.start.column;qa=0;var P=this.$docRowCache;var ea=this.$getRowCacheIndex(P,E);var ua=P.length;ua&&0<=ea?(qa=P[ea],aa=this.$screenRowCache[ea],ua=E>P[ua-1]):ua=!ua;for(var Fa=(P=this.getNextFoldLine(qa))?P.start.row:Infinity;qa<E;){if(qa>=Fa){ea=P.end.row+
1;if(ea>E)break;Fa=(P=this.getNextFoldLine(ea,P))?P.start.row:Infinity}else ea=qa+1;aa+=this.getRowLength(qa);qa=ea;ua&&(this.$docRowCache.push(qa),this.$screenRowCache.push(aa))}P&&qa>=Fa?(Q=this.getFoldDisplayLine(P,E,Q),P=P.start.row):(Q=this.getLine(E).substring(0,Q),P=E);E=0;if(this.$useWrapMode&&(P=this.$wrapData[P])){for(E=0;Q.length>=P[E];)aa++,E++;Q=Q.substring(P[E-1]||0,Q.length);E=0<E?P.indent:0}this.lineWidgets&&this.lineWidgets[qa]&&this.lineWidgets[qa].rowsAbove&&(aa+=this.lineWidgets[qa].rowsAbove);
return{row:aa,column:E+this.$getStringScreenWidth(Q)[0]}};this.documentToScreenColumn=function(E,Q){return this.documentToScreenPosition(E,Q).column};this.documentToScreenRow=function(E,Q){return this.documentToScreenPosition(E,Q).row};this.getScreenLength=function(){var E=0,Q;if(this.$useWrapMode){var aa=this.$wrapData.length,qa=0;ua=0;for(var P=(Q=this.$foldData[ua++])?Q.start.row:Infinity;qa<aa;){var ea=this.$wrapData[qa];E+=ea?ea.length+1:1;qa++;qa>P&&(qa=Q.end.row+1,P=(Q=this.$foldData[ua++])?
Q.start.row:Infinity)}}else{E=this.getLength();aa=this.$foldData;for(var ua=0;ua<aa.length;ua++)Q=aa[ua],E-=Q.end.row-Q.start.row}this.lineWidgets&&(E+=this.$getWidgetScreenLength());return E};this.$setFontMetrics=function(E){this.$enableVarChar&&(this.$getStringScreenWidth=function(Q,aa,qa){if(0===aa)return[0,0];aa||=Infinity;qa=qa||0;var P;for(P=0;P<Q.length;P++){var ea=Q.charAt(P);qa="\t"===ea?qa+this.getScreenTabSize(qa):qa+E.getCharacterWidth(ea);if(qa>aa)break}return[qa,P]})};this.destroy=function(){this.bgTokenizer&&
(this.bgTokenizer.setDocument(null),this.bgTokenizer=null);this.$stopWorker();this.removeAllListeners();this.selection.detach()};this.isFullWidth=N}).call(l.prototype);a("./edit_session/folding").Folding.call(l.prototype);a("./edit_session/bracket_match").BracketMatch.call(l.prototype);g.defineOptions(l.prototype,"session",{wrap:{set:function(N){N&&"off"!=N?"free"==N?N=!0:"printMargin"==N?N=-1:"string"==typeof N&&(N=parseInt(N,10)||!1):N=!1;this.$wrap!=N&&((this.$wrap=N)?(N="number"==typeof N?N:null,
this.setWrapLimitRange(N,N),this.setUseWrapMode(!0)):this.setUseWrapMode(!1))},get:function(){return this.getUseWrapMode()?-1==this.$wrap?"printMargin":this.getWrapLimitRange().min?this.$wrap:"free":"off"},handlesSet:!0},wrapMethod:{set:function(N){N="auto"==N?"text"!=this.$mode.type:"text"!=N;N!=this.$wrapAsCode&&(this.$wrapAsCode=N,this.$useWrapMode&&(this.$useWrapMode=!1,this.setUseWrapMode(!0)))},initialValue:"auto"},indentedSoftWrap:{set:function(){this.$useWrapMode&&(this.$useWrapMode=!1,this.setUseWrapMode(!0))},
initialValue:!0},firstLineNumber:{set:function(){this._signal("changeBreakpoint")},initialValue:1},useWorker:{set:function(N){this.$useWorker=N;this.$stopWorker();N&&this.$startWorker()},initialValue:!0},useSoftTabs:{initialValue:!0},tabSize:{set:function(N){N=parseInt(N);0<N&&this.$tabSize!==N&&(this.$modified=!0,this.$rowLengthCache=[],this.$tabSize=N,this._signal("changeTabSize"))},initialValue:4,handlesSet:!0},navigateWithinSoftTabs:{initialValue:!1},foldStyle:{set:function(N){this.setFoldStyle(N)},
handlesSet:!0},overwrite:{set:function(){this._signal("changeOverwrite")},initialValue:!1},newLineMode:{set:function(N){this.doc.setNewLineMode(N)},get:function(){return this.doc.getNewLineMode()},handlesSet:!0},mode:{set:function(N){this.setMode(N)},get:function(){return this.$modeId},handlesSet:!0}});b.EditSession=l});
define("ace/search","require exports module ace/lib/lang ace/lib/oop ace/range".split(" "),function(a,b){function l(){this.$options={}}var e=a("./lib/lang"),f=a("./lib/oop"),h=a("./range").Range;(function(){this.set=function(g){f.mixin(this.$options,g);return this};this.getOptions=function(){return e.copyObject(this.$options)};this.setOptions=function(g){this.$options=g};this.find=function(g){var m=this.$options;g=this.$matchIterator(g,m);if(!g)return!1;var q=null;g.forEach(function(r,B,D,F){q=new h(r,
B,D,F);return B==F&&m.start&&m.start.start&&0!=m.skipCurrent&&q.isEqual(m.start)?(q=null,!1):!0});return q};this.findAll=function(g){var m=this.$options;if(!m.needle)return[];this.$assembleRegExp(m);var q=m.range,r=q?g.getLines(q.start.row,q.end.row):g.doc.getAllLines();g=[];var B=m.re;if(m.$isMultiLine){var D=B.length,F=r.length-D,G,N=B.offset||0;a:for(;N<=F;N++){for(m=0;m<D;m++)if(-1==r[N+m].search(B[m]))continue a;var T=r[N];m=r[N+D-1];T=T.length-T.match(B[0])[0].length;m=m.match(B[D-1])[0].length;
G&&G.end.row===N&&G.end.column>T||(g.push(G=new h(N,T,N+D-1,m)),2<D&&(N=N+D-2))}}else for(G=0;G<r.length;G++)for(D=e.getMatchOffsets(r[G],B),m=0;m<D.length;m++)F=D[m],g.push(new h(G,F.offset,G,F.offset+F.length));if(q){B=r=q.start.column;G=0;for(m=g.length-1;G<m&&g[G].start.column<r&&g[G].start.row==q.start.row;)G++;for(;G<m&&g[m].end.column>B&&g[m].end.row==q.end.row;)m--;g=g.slice(G,m+1);G=0;for(m=g.length;G<m;G++)g[G].start.row+=q.start.row,g[G].end.row+=q.start.row}return g};this.replace=function(g,
m){var q=this.$options,r=this.$assembleRegExp(q);if(q.$isMultiLine)return m;if(r){var B=r.exec(g);if(!B||B[0].length!=g.length)return null;m=g.replace(r,m);if(q.preserveCase){m=m.split("");for(q=Math.min(g.length,g.length);q--;)(r=g[q])&&r.toLowerCase()!=r?m[q]=m[q].toUpperCase():m[q]=m[q].toLowerCase();m=m.join("")}return m}};this.$assembleRegExp=function(g,m){if(g.needle instanceof RegExp)return g.re=g.needle;var q=g.needle;if(!g.needle)return g.re=!1;g.regExp||(q=e.escapeRegExp(q));g.wholeWord&&
(q=(/\w/.test(q[0])||g.regExp?"\\b":"")+q+(/\w/.test(q[q.length-1])||g.regExp?"\\b":""));var r=g.caseSensitive?"gm":"gmi";g.$isMultiLine=!m&&/[\n\r]/.test(q);if(g.$isMultiLine)return g.re=this.$assembleMultilineRegExp(q,r);try{var B=new RegExp(q,r)}catch(D){B=!1}return g.re=B};this.$assembleMultilineRegExp=function(g,m){g=g.replace(/\r\n|\r|\n/g,"$\n^").split("\n");for(var q=[],r=0;r<g.length;r++)try{q.push(new RegExp(g[r],m))}catch(B){return!1}return q};this.$matchIterator=function(g,m){var q=this.$assembleRegExp(m);
if(!q)return!1;var r=1==m.backwards,B=0!=m.skipCurrent,D=m.range,F=m.start;F||=D?D[r?"end":"start"]:g.selection.getRange();F.start&&(F=F[B!=r?"end":"start"]);var G=D?D.start.row:0,N=D?D.end.row:g.getLength()-1;B=r?function(E){var Q=F.row;if(!V(Q,F.column,E)){for(Q--;Q>=G;Q--)if(V(Q,Number.MAX_VALUE,E))return;if(0!=m.wrap)for(Q=N,G=F.row;Q>=G&&!V(Q,Number.MAX_VALUE,E);Q--);}}:function(E){var Q=F.row;if(!V(Q,F.column,E)){for(Q+=1;Q<=N;Q++)if(V(Q,0,E))return;if(0!=m.wrap)for(Q=G,N=F.row;Q<=N&&!V(Q,0,
E);Q++);}};if(m.$isMultiLine)var T=q.length,V=function(E,Q,aa){E=r?E-T+1:E;if(!(0>E)){var qa=g.getLine(E),P=qa.search(q[0]);if(!(!r&&P<Q||-1===P)){for(var ea=1;ea<T;ea++)if(qa=g.getLine(E+ea),-1==qa.search(q[ea]))return;qa=qa.match(q[T-1])[0].length;if(!(r&&qa>Q)&&aa(E,P,E+T-1,qa))return!0}}};else V=r?function(E,Q,aa){var qa=g.getLine(E),P=[],ea;for(q.lastIndex=0;ea=q.exec(qa);){var ua=ea[0].length;var Fa=ea.index;if(!ua){if(Fa>=qa.length)break;q.lastIndex=Fa+1}if(ea.index+ua>Q)break;P.push(ea.index,
ua)}for(Q=P.length-1;0<=Q;Q-=2)if(qa=P[Q-1],ua=P[Q],aa(E,qa,E,qa+ua))return!0}:function(E,Q,aa){var qa=g.getLine(E),P;for(q.lastIndex=Q;P=q.exec(qa);){Q=P[0].length;P=P.index;if(aa(E,P,E,P+Q))return!0;if(!Q&&(q.lastIndex=P+=1,P>=qa.length))return!1}};return{forEach:B}}}).call(l.prototype);b.Search=l});
define("ace/keyboard/hash_handler",["require","exports","module","ace/lib/keys","ace/lib/useragent"],function(a,b){function l(m,q){this.platform=q||(h.isMac?"mac":"win");this.commands={};this.commandKeyBinding={};this.addCommands(m);this.$singleCommand=!0}function e(m,q){l.call(this,m,q);this.$singleCommand=!1}var f=a("../lib/keys"),h=a("../lib/useragent"),g=f.KEY_MODS;e.prototype=l.prototype;(function(){function m(q){return"object"==typeof q&&q.bindKey&&q.bindKey.position||(q.isDefault?-100:0)}this.addCommand=
function(q){this.commands[q.name]&&this.removeCommand(q);this.commands[q.name]=q;q.bindKey&&this._buildKeyHash(q)};this.removeCommand=function(q,r){var B=q&&("string"===typeof q?q:q.name);q=this.commands[B];r||delete this.commands[B];r=this.commandKeyBinding;for(var D in r)if(B=r[D],B==q)delete r[D];else if(Array.isArray(B)){var F=B.indexOf(q);-1!=F&&(B.splice(F,1),1==B.length&&(r[D]=B[0]))}};this.bindKey=function(q,r,B){"object"==typeof q&&q&&(void 0==B&&(B=q.position),q=q[this.platform]);if(q){if("function"==
typeof r)return this.addCommand({exec:r,bindKey:q,name:r.name||q});q.split("|").forEach(function(D){var F="";if(-1!=D.indexOf(" ")){var G=D.split(/\s+/);D=G.pop();G.forEach(function(N){N=this.parseKeys(N);F+=(F?" ":"")+(g[N.hashId]+N.key);this._addCommandToBinding(F,"chainKeys")},this);F+=" "}D=this.parseKeys(D);this._addCommandToBinding(F+(g[D.hashId]+D.key),r,B)},this)}};this._addCommandToBinding=function(q,r,B){var D=this.commandKeyBinding,F;if(r)if(!D[q]||this.$singleCommand)D[q]=r;else{Array.isArray(D[q])?
-1!=(F=D[q].indexOf(r))&&D[q].splice(F,1):D[q]=[D[q]];"number"!=typeof B&&(B=m(r));q=D[q];for(F=0;F<q.length&&!(m(q[F])>B);F++);q.splice(F,0,r)}else delete D[q]};this.addCommands=function(q){q&&Object.keys(q).forEach(function(r){var B=q[r];if(B){if("string"===typeof B)return this.bindKey(B,r);"function"===typeof B&&(B={exec:B});"object"===typeof B&&(B.name||(B.name=r),this.addCommand(B))}},this)};this.removeCommands=function(q){Object.keys(q).forEach(function(r){this.removeCommand(q[r])},this)};this.bindKeys=
function(q){Object.keys(q).forEach(function(r){this.bindKey(r,q[r])},this)};this._buildKeyHash=function(q){this.bindKey(q.bindKey,q)};this.parseKeys=function(q){var r=q.toLowerCase().split(/[\-\+]([\-\+])?/).filter(function(N){return N}),B=r.pop(),D=f[B];if(f.FUNCTION_KEYS[D])B=f.FUNCTION_KEYS[D].toLowerCase();else{if(!r.length)return{key:B,hashId:-1};if(1==r.length&&"shift"==r[0])return{key:B.toUpperCase(),hashId:-1}}D=0;for(var F=r.length;F--;){var G=f.KEY_MODS[r[F]];if(null==G)return"undefined"!=
typeof console&&console.error("invalid modifier "+r[F]+" in "+q),!1;D|=G}return{key:B,hashId:D}};this.findKeyCommand=function(q,r){return this.commandKeyBinding[g[q]+r]};this.handleKeyboard=function(q,r,B,D){if(!(0>D)){var F=g[r]+B,G=this.commandKeyBinding[F];q.$keyChain&&(q.$keyChain+=" "+F,G=this.commandKeyBinding[q.$keyChain]||G);if(G&&("chainKeys"==G||"chainKeys"==G[G.length-1]))return q.$keyChain=q.$keyChain||F,{command:"null"};if(q.$keyChain)if((!r||4==r)&&1==B.length)q.$keyChain=q.$keyChain.slice(0,
-F.length-1);else if(-1==r||0<D)q.$keyChain="";return{command:G}}};this.getStatusText=function(q,r){return r.$keyChain||""}}).call(l.prototype);b.HashHandler=l;b.MultiHashHandler=e});
define("ace/commands/command_manager","require exports module ace/lib/oop ace/keyboard/hash_handler ace/lib/event_emitter".split(" "),function(a,b){function l(g,m){f.call(this,m,g);this.byName=this.commands;this.setDefaultHandler("exec",function(q){return q.command.exec(q.editor,q.args||{})})}var e=a("../lib/oop"),f=a("../keyboard/hash_handler").MultiHashHandler,h=a("../lib/event_emitter").EventEmitter;e.inherits(l,f);(function(){e.implement(this,h);this.exec=function(g,m,q){if(Array.isArray(g)){for(var r=
g.length;r--;)if(this.exec(g[r],m,q))return!0;return!1}"string"===typeof g&&(g=this.commands[g]);if(!g||m&&m.$readOnly&&!g.readOnly||0!=this.$checkCommandState&&g.isAvailable&&!g.isAvailable(m))return!1;g={editor:m,command:g,args:q};g.returnValue=this._emit("exec",g);this._signal("afterExec",g);return!1===g.returnValue?!1:!0};this.toggleRecording=function(g){if(!this.$inReplay){g&&g._emit("changeStatus");if(this.recording)return this.macro.pop(),this.off("exec",this.$addCommandToMacro),this.macro.length||
(this.macro=this.oldMacro),this.recording=!1;this.$addCommandToMacro||(this.$addCommandToMacro=function(m){this.macro.push([m.command,m.args])}.bind(this));this.oldMacro=this.macro;this.macro=[];this.on("exec",this.$addCommandToMacro);return this.recording=!0}};this.replay=function(g){if(!this.$inReplay&&this.macro){if(this.recording)return this.toggleRecording(g);try{this.$inReplay=!0,this.macro.forEach(function(m){"string"==typeof m?this.exec(m,g):this.exec(m[0],g,m[1])},this)}finally{this.$inReplay=
!1}}};this.trimMacro=function(g){return g.map(function(m){"string"!=typeof m[0]&&(m[0]=m[0].name);m[1]||(m=m[0]);return m})}}).call(l.prototype);b.CommandManager=l});
define("ace/commands/default_commands","require exports module ace/lib/lang ace/config ace/range".split(" "),function(a,b){function l(g,m){return{win:g,mac:m}}var e=a("../lib/lang"),f=a("../config"),h=a("../range").Range;b.commands=[{name:"showSettingsMenu",bindKey:l("Ctrl-,","Command-,"),exec:function(g){f.loadModule("ace/ext/settings_menu",function(m){m.init(g);g.showSettingsMenu()})},readOnly:!0},{name:"goToNextError",bindKey:l("Alt-E","F4"),exec:function(g){f.loadModule("./ext/error_marker",function(m){m.showErrorMarker(g,
1)})},scrollIntoView:"animate",readOnly:!0},{name:"goToPreviousError",bindKey:l("Alt-Shift-E","Shift-F4"),exec:function(g){f.loadModule("./ext/error_marker",function(m){m.showErrorMarker(g,-1)})},scrollIntoView:"animate",readOnly:!0},{name:"selectall",description:"Select all",bindKey:l("Ctrl-A","Command-A"),exec:function(g){g.selectAll()},readOnly:!0},{name:"centerselection",description:"Center selection",bindKey:l(null,"Ctrl-L"),exec:function(g){g.centerSelection()},readOnly:!0},{name:"gotoline",
description:"Go to line...",bindKey:l("Ctrl-L","Command-L"),exec:function(g,m){"number"!==typeof m||isNaN(m)||g.gotoLine(m);g.prompt({$type:"gotoLine"})},readOnly:!0},{name:"fold",bindKey:l("Alt-L|Ctrl-F1","Command-Alt-L|Command-F1"),exec:function(g){g.session.toggleFold(!1)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"unfold",bindKey:l("Alt-Shift-L|Ctrl-Shift-F1","Command-Alt-Shift-L|Command-Shift-F1"),exec:function(g){g.session.toggleFold(!0)},multiSelectAction:"forEach",
scrollIntoView:"center",readOnly:!0},{name:"toggleFoldWidget",bindKey:l("F2","F2"),exec:function(g){g.session.toggleFoldWidget()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"toggleParentFoldWidget",bindKey:l("Alt-F2","Alt-F2"),exec:function(g){g.session.toggleFoldWidget(!0)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"foldall",description:"Fold all",bindKey:l(null,"Ctrl-Command-Option-0"),exec:function(g){g.session.foldAll()},scrollIntoView:"center",
readOnly:!0},{name:"foldOther",description:"Fold other",bindKey:l("Alt-0","Command-Option-0"),exec:function(g){g.session.foldAll();g.session.unfold(g.selection.getAllRanges())},scrollIntoView:"center",readOnly:!0},{name:"unfoldall",description:"Unfold all",bindKey:l("Alt-Shift-0","Command-Option-Shift-0"),exec:function(g){g.session.unfold()},scrollIntoView:"center",readOnly:!0},{name:"findnext",description:"Find next",bindKey:l("Ctrl-K","Command-G"),exec:function(g){g.findNext()},multiSelectAction:"forEach",
scrollIntoView:"center",readOnly:!0},{name:"findprevious",description:"Find previous",bindKey:l("Ctrl-Shift-K","Command-Shift-G"),exec:function(g){g.findPrevious()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"selectOrFindNext",description:"Select or find next",bindKey:l("Alt-K","Ctrl-G"),exec:function(g){g.selection.isEmpty()?g.selection.selectWord():g.findNext()},readOnly:!0},{name:"selectOrFindPrevious",description:"Select or find previous",bindKey:l("Alt-Shift-K","Ctrl-Shift-G"),
exec:function(g){g.selection.isEmpty()?g.selection.selectWord():g.findPrevious()},readOnly:!0},{name:"find",description:"Find",bindKey:l("Ctrl-F","Command-F"),exec:function(g){f.loadModule("ace/ext/searchbox",function(m){m.Search(g)})},readOnly:!0},{name:"overwrite",description:"Overwrite",bindKey:"Insert",exec:function(g){g.toggleOverwrite()},readOnly:!0},{name:"selecttostart",description:"Select to start",bindKey:l("Ctrl-Shift-Home","Command-Shift-Home|Command-Shift-Up"),exec:function(g){g.getSelection().selectFileStart()},
multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotostart",description:"Go to start",bindKey:l("Ctrl-Home","Command-Home|Command-Up"),exec:function(g){g.navigateFileStart()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectup",description:"Select up",bindKey:l("Shift-Up","Shift-Up|Ctrl-Shift-P"),exec:function(g){g.getSelection().selectUp()},multiSelectAction:"forEach",scrollIntoView:"cursor",
readOnly:!0},{name:"golineup",description:"Go line up",bindKey:l("Up","Up|Ctrl-P"),exec:function(g,m){g.navigateUp(m.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttoend",description:"Select to end",bindKey:l("Ctrl-Shift-End","Command-Shift-End|Command-Shift-Down"),exec:function(g){g.getSelection().selectFileEnd()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotoend",description:"Go to end",bindKey:l("Ctrl-End",
"Command-End|Command-Down"),exec:function(g){g.navigateFileEnd()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectdown",description:"Select down",bindKey:l("Shift-Down","Shift-Down|Ctrl-Shift-N"),exec:function(g){g.getSelection().selectDown()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"golinedown",description:"Go line down",bindKey:l("Down","Down|Ctrl-N"),exec:function(g,m){g.navigateDown(m.times)},multiSelectAction:"forEach",
scrollIntoView:"cursor",readOnly:!0},{name:"selectwordleft",description:"Select word left",bindKey:l("Ctrl-Shift-Left","Option-Shift-Left"),exec:function(g){g.getSelection().selectWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotowordleft",description:"Go to word left",bindKey:l("Ctrl-Left","Option-Left"),exec:function(g){g.navigateWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttolinestart",description:"Select to line start",
bindKey:l("Alt-Shift-Left","Command-Shift-Left|Ctrl-Shift-A"),exec:function(g){g.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotolinestart",description:"Go to line start",bindKey:l("Alt-Left|Home","Command-Left|Home|Ctrl-A"),exec:function(g){g.navigateLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectleft",description:"Select left",bindKey:l("Shift-Left","Shift-Left|Ctrl-Shift-B"),exec:function(g){g.getSelection().selectLeft()},
multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotoleft",description:"Go to left",bindKey:l("Left","Left|Ctrl-B"),exec:function(g,m){g.navigateLeft(m.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectwordright",description:"Select word right",bindKey:l("Ctrl-Shift-Right","Option-Shift-Right"),exec:function(g){g.getSelection().selectWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotowordright",description:"Go to word right",
bindKey:l("Ctrl-Right","Option-Right"),exec:function(g){g.navigateWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttolineend",description:"Select to line end",bindKey:l("Alt-Shift-Right","Command-Shift-Right|Shift-End|Ctrl-Shift-E"),exec:function(g){g.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotolineend",description:"Go to line end",bindKey:l("Alt-Right|End","Command-Right|End|Ctrl-E"),exec:function(g){g.navigateLineEnd()},
multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectright",description:"Select right",bindKey:l("Shift-Right","Shift-Right"),exec:function(g){g.getSelection().selectRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotoright",description:"Go to right",bindKey:l("Right","Right|Ctrl-F"),exec:function(g,m){g.navigateRight(m.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectpagedown",description:"Select page down",
bindKey:"Shift-PageDown",exec:function(g){g.selectPageDown()},readOnly:!0},{name:"pagedown",description:"Page down",bindKey:l(null,"Option-PageDown"),exec:function(g){g.scrollPageDown()},readOnly:!0},{name:"gotopagedown",description:"Go to page down",bindKey:l("PageDown","PageDown|Ctrl-V"),exec:function(g){g.gotoPageDown()},readOnly:!0},{name:"selectpageup",description:"Select page up",bindKey:"Shift-PageUp",exec:function(g){g.selectPageUp()},readOnly:!0},{name:"pageup",description:"Page up",bindKey:l(null,
"Option-PageUp"),exec:function(g){g.scrollPageUp()},readOnly:!0},{name:"gotopageup",description:"Go to page up",bindKey:"PageUp",exec:function(g){g.gotoPageUp()},readOnly:!0},{name:"scrollup",description:"Scroll up",bindKey:l("Ctrl-Up",null),exec:function(g){g.renderer.scrollBy(0,-2*g.renderer.layerConfig.lineHeight)},readOnly:!0},{name:"scrolldown",description:"Scroll down",bindKey:l("Ctrl-Down",null),exec:function(g){g.renderer.scrollBy(0,2*g.renderer.layerConfig.lineHeight)},readOnly:!0},{name:"selectlinestart",
description:"Select line start",bindKey:"Shift-Home",exec:function(g){g.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectlineend",description:"Select line end",bindKey:"Shift-End",exec:function(g){g.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"togglerecording",description:"Toggle recording",bindKey:l("Ctrl-Alt-E","Command-Option-E"),exec:function(g){g.commands.toggleRecording(g)},
readOnly:!0},{name:"replaymacro",description:"Replay macro",bindKey:l("Ctrl-Shift-E","Command-Shift-E"),exec:function(g){g.commands.replay(g)},readOnly:!0},{name:"jumptomatching",description:"Jump to matching",bindKey:l("Ctrl-\\|Ctrl-P","Command-\\"),exec:function(g){g.jumpToMatching()},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"selecttomatching",description:"Select to matching",bindKey:l("Ctrl-Shift-\\|Ctrl-Shift-P","Command-Shift-\\"),exec:function(g){g.jumpToMatching(!0)},
multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"expandToMatching",description:"Expand to matching",bindKey:l("Ctrl-Shift-M","Ctrl-Shift-M"),exec:function(g){g.jumpToMatching(!0,!0)},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"passKeysToBrowser",description:"Pass keys to browser",bindKey:l(null,null),exec:function(){},passEvent:!0,readOnly:!0},{name:"copy",description:"Copy",exec:function(){},readOnly:!0},{name:"cut",description:"Cut",exec:function(g){var m=
g.$copyWithEmptySelection&&g.selection.isEmpty()?g.selection.getLineRange():g.selection.getRange();g._emit("cut",m);m.isEmpty()||g.session.remove(m);g.clearSelection()},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"paste",description:"Paste",exec:function(g,m){g.$handlePaste(m)},scrollIntoView:"cursor"},{name:"removeline",description:"Remove line",bindKey:l("Ctrl-D","Command-D"),exec:function(g){g.removeLines()},scrollIntoView:"cursor",multiSelectAction:"forEachLine"},{name:"duplicateSelection",
description:"Duplicate selection",bindKey:l("Ctrl-Shift-D","Command-Shift-D"),exec:function(g){g.duplicateSelection()},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"sortlines",description:"Sort lines",bindKey:l("Ctrl-Alt-S","Command-Alt-S"),exec:function(g){g.sortLines()},scrollIntoView:"selection",multiSelectAction:"forEachLine"},{name:"togglecomment",description:"Toggle comment",bindKey:l("Ctrl-/","Command-/"),exec:function(g){g.toggleCommentLines()},multiSelectAction:"forEachLine",
scrollIntoView:"selectionPart"},{name:"toggleBlockComment",description:"Toggle block comment",bindKey:l("Ctrl-Shift-/","Command-Shift-/"),exec:function(g){g.toggleBlockComment()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"modifyNumberUp",description:"Modify number up",bindKey:l("Ctrl-Shift-Up","Alt-Shift-Up"),exec:function(g){g.modifyNumber(1)},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"modifyNumberDown",description:"Modify number down",bindKey:l("Ctrl-Shift-Down",
"Alt-Shift-Down"),exec:function(g){g.modifyNumber(-1)},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"replace",description:"Replace",bindKey:l("Ctrl-H","Command-Option-F"),exec:function(g){f.loadModule("ace/ext/searchbox",function(m){m.Search(g,!0)})}},{name:"undo",description:"Undo",bindKey:l("Ctrl-Z","Command-Z"),exec:function(g){g.undo()}},{name:"redo",description:"Redo",bindKey:l("Ctrl-Shift-Z|Ctrl-Y","Command-Shift-Z|Command-Y"),exec:function(g){g.redo()}},{name:"copylinesup",description:"Copy lines up",
bindKey:l("Alt-Shift-Up","Command-Option-Up"),exec:function(g){g.copyLinesUp()},scrollIntoView:"cursor"},{name:"movelinesup",description:"Move lines up",bindKey:l("Alt-Up","Option-Up"),exec:function(g){g.moveLinesUp()},scrollIntoView:"cursor"},{name:"copylinesdown",description:"Copy lines down",bindKey:l("Alt-Shift-Down","Command-Option-Down"),exec:function(g){g.copyLinesDown()},scrollIntoView:"cursor"},{name:"movelinesdown",description:"Move lines down",bindKey:l("Alt-Down","Option-Down"),exec:function(g){g.moveLinesDown()},
scrollIntoView:"cursor"},{name:"del",description:"Delete",bindKey:l("Delete","Delete|Ctrl-D|Shift-Delete"),exec:function(g){g.remove("right")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"backspace",description:"Backspace",bindKey:l("Shift-Backspace|Backspace","Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"),exec:function(g){g.remove("left")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"cut_or_delete",description:"Cut or delete",bindKey:l("Shift-Delete",null),exec:function(g){if(g.selection.isEmpty())g.remove("left");
else return!1},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolinestart",description:"Remove to line start",bindKey:l("Alt-Backspace","Command-Backspace"),exec:function(g){g.removeToLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolineend",description:"Remove to line end",bindKey:l("Alt-Delete","Ctrl-K|Command-Delete"),exec:function(g){g.removeToLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolinestarthard",description:"Remove to line start hard",
bindKey:l("Ctrl-Shift-Backspace",null),exec:function(g){var m=g.selection.getRange();m.start.column=0;g.session.remove(m)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolineendhard",description:"Remove to line end hard",bindKey:l("Ctrl-Shift-Delete",null),exec:function(g){var m=g.selection.getRange();m.end.column=Number.MAX_VALUE;g.session.remove(m)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordleft",description:"Remove word left",bindKey:l("Ctrl-Backspace",
"Alt-Backspace|Ctrl-Alt-Backspace"),exec:function(g){g.removeWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordright",description:"Remove word right",bindKey:l("Ctrl-Delete","Alt-Delete"),exec:function(g){g.removeWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"outdent",description:"Outdent",bindKey:l("Shift-Tab","Shift-Tab"),exec:function(g){g.blockOutdent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"indent",description:"Indent",
bindKey:l("Tab","Tab"),exec:function(g){g.indent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"blockoutdent",description:"Block outdent",bindKey:l("Ctrl-[","Ctrl-["),exec:function(g){g.blockOutdent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"blockindent",description:"Block indent",bindKey:l("Ctrl-]","Ctrl-]"),exec:function(g){g.blockIndent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"insertstring",description:"Insert string",
exec:function(g,m){g.insert(m)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"inserttext",description:"Insert text",exec:function(g,m){g.insert(e.stringRepeat(m.text||"",m.times||1))},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"splitline",description:"Split line",bindKey:l(null,"Ctrl-O"),exec:function(g){g.splitLine()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"transposeletters",description:"Transpose letters",bindKey:l("Alt-Shift-X","Ctrl-T"),exec:function(g){g.transposeLetters()},
multiSelectAction:function(g){g.transposeSelections(1)},scrollIntoView:"cursor"},{name:"touppercase",description:"To uppercase",bindKey:l("Ctrl-U","Ctrl-U"),exec:function(g){g.toUpperCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"tolowercase",description:"To lowercase",bindKey:l("Ctrl-Shift-U","Ctrl-Shift-U"),exec:function(g){g.toLowerCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"autoindent",description:"Auto Indent",bindKey:l(null,null),exec:function(g){g.autoIndent()},
multiSelectAction:"forEachLine",scrollIntoView:"animate"},{name:"expandtoline",description:"Expand to line",bindKey:l("Ctrl-Shift-L","Command-Shift-L"),exec:function(g){var m=g.selection.getRange();m.start.column=m.end.column=0;m.end.row++;g.selection.setRange(m,!1)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"joinlines",description:"Join lines",bindKey:l(null,null),exec:function(g){var m=g.selection.isBackwards(),q=m?g.selection.getSelectionLead():g.selection.getSelectionAnchor();
m=m?g.selection.getSelectionAnchor():g.selection.getSelectionLead();for(var r=g.session.doc.getLine(q.row).length,B=g.session.doc.getTextRange(g.selection.getRange()).replace(/\n\s*/," ").length,D=g.session.doc.getLine(q.row),F=q.row+1;F<=m.row+1;F++){var G=e.stringTrimLeft(e.stringTrimRight(g.session.doc.getLine(F)));0!==G.length&&(G=" "+G);D+=G}m.row+1<g.session.doc.getLength()-1&&(D+=g.session.doc.getNewLineCharacter());g.clearSelection();g.session.doc.replace(new h(q.row,0,m.row+2,0),D);0<B?(g.selection.moveCursorTo(q.row,
q.column),g.selection.selectTo(q.row,q.column+B)):(r=g.session.doc.getLine(q.row).length>r?r+1:r,g.selection.moveCursorTo(q.row,r))},multiSelectAction:"forEach",readOnly:!0},{name:"invertSelection",description:"Invert selection",bindKey:l(null,null),exec:function(g){var m=g.session.doc.getLength()-1,q=g.session.doc.getLine(m).length,r=g.selection.rangeList.ranges,B=[];1>r.length&&(r=[g.selection.getRange()]);for(var D=0;D<r.length;D++)D!=r.length-1||r[D].end.row===m&&r[D].end.column===q||B.push(new h(r[D].end.row,
r[D].end.column,m,q)),0===D?(0!==r[D].start.row||0!==r[D].start.column)&&B.push(new h(0,0,r[D].start.row,r[D].start.column)):B.push(new h(r[D-1].end.row,r[D-1].end.column,r[D].start.row,r[D].start.column));g.exitMultiSelectMode();g.clearSelection();for(D=0;D<B.length;D++)g.selection.addRange(B[D],!1)},readOnly:!0,scrollIntoView:"none"},{name:"addLineAfter",exec:function(g){g.selection.clearSelection();g.navigateLineEnd();g.insert("\n")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"addLineBefore",
exec:function(g){g.selection.clearSelection();var m=g.getCursorPosition();g.selection.moveTo(m.row-1,Number.MAX_VALUE);g.insert("\n");0===m.row&&g.navigateUp()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"openCommandPallete",description:"Open command pallete",bindKey:l("F1","F1"),exec:function(g){g.prompt({$type:"commands"})},readOnly:!0},{name:"modeSelect",description:"Change language mode...",bindKey:l(null,null),exec:function(g){g.prompt({$type:"modes"})},readOnly:!0}]});
define("ace/editor","require exports module ace/lib/fixoldbrowsers ace/lib/oop ace/lib/dom ace/lib/lang ace/lib/useragent ace/keyboard/textinput ace/mouse/mouse_handler ace/mouse/fold_handler ace/keyboard/keybinding ace/edit_session ace/search ace/range ace/lib/event_emitter ace/commands/command_manager ace/commands/default_commands ace/config ace/token_iterator ace/clipboard".split(" "),function(a,b){function l(P,ea,ua){this.$toDestroy=[];this.container=P.getContainerElement();this.renderer=P;this.id=
"editor"+ ++l.$uid;this.commands=new T(g.isMac?"mac":"win",V);"object"==typeof document&&(this.textInput=new m(P.getTextAreaContainer(),this),this.renderer.textarea=this.textInput.getElement(),this.$mouseHandler=new q(this),new r(this));this.keyBinding=new B(this);this.$search=(new F).set({wrap:!0});this.$historyTracker=this.$historyTracker.bind(this);this.commands.on("exec",this.$historyTracker);this.$initOperationListeners();this._$emitInputEvent=h.delayedCall(function(){this._signal("input",{});
this.session&&this.session.bgTokenizer&&this.session.bgTokenizer.scheduleStart()}.bind(this));this.on("change",function(Fa,pa){pa._$emitInputEvent.schedule(31)});this.setSession(ea||ua&&ua.session||new D(""));E.resetOptions(this);ua&&this.setOptions(ua);E._signal("editor",this)}a("./lib/fixoldbrowsers");var e=a("./lib/oop"),f=a("./lib/dom"),h=a("./lib/lang"),g=a("./lib/useragent"),m=a("./keyboard/textinput").TextInput,q=a("./mouse/mouse_handler").MouseHandler,r=a("./mouse/fold_handler").FoldHandler,
B=a("./keyboard/keybinding").KeyBinding,D=a("./edit_session").EditSession,F=a("./search").Search,G=a("./range").Range,N=a("./lib/event_emitter").EventEmitter,T=a("./commands/command_manager").CommandManager,V=a("./commands/default_commands").commands,E=a("./config"),Q=a("./token_iterator").TokenIterator,aa=a("./clipboard");l.$uid=0;(function(){e.implement(this,N);this.$initOperationListeners=function(){this.commands.on("exec",this.startOperation.bind(this),!0);this.commands.on("afterExec",this.endOperation.bind(this),
!0);this.$opResetTimer=h.delayedCall(this.endOperation.bind(this,!0));this.on("change",function(){this.curOp||(this.startOperation(),this.curOp.selectionBefore=this.$lastSel);this.curOp.docChanged=!0}.bind(this),!0);this.on("changeSelection",function(){this.curOp||(this.startOperation(),this.curOp.selectionBefore=this.$lastSel);this.curOp.selectionChanged=!0}.bind(this),!0)};this.curOp=null;this.prevOp={};this.startOperation=function(P){if(this.curOp){if(!P||this.curOp.command)return;this.prevOp=
this.curOp}P||(this.previousCommand=null,P={});this.$opResetTimer.schedule();this.curOp=this.session.curOp={command:P.command||{},args:P.args,scrollTop:this.renderer.scrollTop};this.curOp.selectionBefore=this.selection.toJSON()};this.endOperation=function(P){if(this.curOp&&this.session){if(P&&!1===P.returnValue||!this.session)return this.curOp=null;if(1!=P||!this.curOp.command||"mouse"!=this.curOp.command.name)if(this._signal("beforeEndOperation"),this.curOp){if(P=(P=this.curOp.command)&&P.scrollIntoView){switch(P){case "center-animate":P=
"animate";case "center":this.renderer.scrollCursorIntoView(null,.5);break;case "animate":case "cursor":this.renderer.scrollCursorIntoView();break;case "selectionPart":var ea=this.selection.getRange(),ua=this.renderer.layerConfig;(ea.start.row>=ua.lastRow||ea.end.row<=ua.firstRow)&&this.renderer.scrollSelectionIntoView(this.selection.anchor,this.selection.lead)}"animate"==P&&this.renderer.animateScrolling(this.curOp.scrollTop)}P=this.selection.toJSON();this.curOp.selectionAfter=P;this.$lastSel=this.selection.toJSON();
this.session.getUndoManager().addSelection(P);this.prevOp=this.curOp;this.curOp=null}}};this.$mergeableCommands=["backspace","del","insertstring"];this.$historyTracker=function(P){if(this.$mergeUndoDeltas){var ea=this.prevOp,ua=this.$mergeableCommands,Fa=ea.command&&P.command.name==ea.command.name;if("insertstring"==P.command.name){var pa=P.args;void 0===this.mergeNextCommand&&(this.mergeNextCommand=!0);Fa=Fa&&this.mergeNextCommand&&(!/\s/.test(pa)||/\s/.test(ea.args));this.mergeNextCommand=!0}else Fa=
Fa&&-1!==ua.indexOf(P.command.name);"always"!=this.$mergeUndoDeltas&&2E3<Date.now()-this.sequenceStartTime&&(Fa=!1);Fa?this.session.mergeUndoDeltas=!0:-1!==ua.indexOf(P.command.name)&&(this.sequenceStartTime=Date.now())}};this.setKeyboardHandler=function(P,ea){if(P&&"string"===typeof P&&"ace"!=P){this.$keybindingId=P;var ua=this;E.loadModule(["keybinding",P],function(Fa){ua.$keybindingId==P&&ua.keyBinding.setKeyboardHandler(Fa&&Fa.handler);ea&&ea()})}else this.$keybindingId=null,this.keyBinding.setKeyboardHandler(P),
ea&&ea()};this.getKeyboardHandler=function(){return this.keyBinding.getKeyboardHandler()};this.setSession=function(P){if(this.session!=P){this.curOp&&this.endOperation();this.curOp={};var ea=this.session;if(ea){this.session.off("change",this.$onDocumentChange);this.session.off("changeMode",this.$onChangeMode);this.session.off("tokenizerUpdate",this.$onTokenizerUpdate);this.session.off("changeTabSize",this.$onChangeTabSize);this.session.off("changeWrapLimit",this.$onChangeWrapLimit);this.session.off("changeWrapMode",
this.$onChangeWrapMode);this.session.off("changeFold",this.$onChangeFold);this.session.off("changeFrontMarker",this.$onChangeFrontMarker);this.session.off("changeBackMarker",this.$onChangeBackMarker);this.session.off("changeBreakpoint",this.$onChangeBreakpoint);this.session.off("changeAnnotation",this.$onChangeAnnotation);this.session.off("changeOverwrite",this.$onCursorChange);this.session.off("changeScrollTop",this.$onScrollTopChange);this.session.off("changeScrollLeft",this.$onScrollLeftChange);
var ua=this.session.getSelection();ua.off("changeCursor",this.$onCursorChange);ua.off("changeSelection",this.$onSelectionChange)}(this.session=P)?(this.$onDocumentChange=this.onDocumentChange.bind(this),P.on("change",this.$onDocumentChange),this.renderer.setSession(P),this.$onChangeMode=this.onChangeMode.bind(this),P.on("changeMode",this.$onChangeMode),this.$onTokenizerUpdate=this.onTokenizerUpdate.bind(this),P.on("tokenizerUpdate",this.$onTokenizerUpdate),this.$onChangeTabSize=this.renderer.onChangeTabSize.bind(this.renderer),
P.on("changeTabSize",this.$onChangeTabSize),this.$onChangeWrapLimit=this.onChangeWrapLimit.bind(this),P.on("changeWrapLimit",this.$onChangeWrapLimit),this.$onChangeWrapMode=this.onChangeWrapMode.bind(this),P.on("changeWrapMode",this.$onChangeWrapMode),this.$onChangeFold=this.onChangeFold.bind(this),P.on("changeFold",this.$onChangeFold),this.$onChangeFrontMarker=this.onChangeFrontMarker.bind(this),this.session.on("changeFrontMarker",this.$onChangeFrontMarker),this.$onChangeBackMarker=this.onChangeBackMarker.bind(this),
this.session.on("changeBackMarker",this.$onChangeBackMarker),this.$onChangeBreakpoint=this.onChangeBreakpoint.bind(this),this.session.on("changeBreakpoint",this.$onChangeBreakpoint),this.$onChangeAnnotation=this.onChangeAnnotation.bind(this),this.session.on("changeAnnotation",this.$onChangeAnnotation),this.$onCursorChange=this.onCursorChange.bind(this),this.session.on("changeOverwrite",this.$onCursorChange),this.$onScrollTopChange=this.onScrollTopChange.bind(this),this.session.on("changeScrollTop",
this.$onScrollTopChange),this.$onScrollLeftChange=this.onScrollLeftChange.bind(this),this.session.on("changeScrollLeft",this.$onScrollLeftChange),this.selection=P.getSelection(),this.selection.on("changeCursor",this.$onCursorChange),this.$onSelectionChange=this.onSelectionChange.bind(this),this.selection.on("changeSelection",this.$onSelectionChange),this.onChangeMode(),this.onCursorChange(),this.onScrollTopChange(),this.onScrollLeftChange(),this.onSelectionChange(),this.onChangeFrontMarker(),this.onChangeBackMarker(),
this.onChangeBreakpoint(),this.onChangeAnnotation(),this.session.getUseWrapMode()&&this.renderer.adjustWrapLimit(),this.renderer.updateFull()):(this.selection=null,this.renderer.setSession(P));this._signal("changeSession",{session:P,oldSession:ea});this.curOp=null;ea&&ea._signal("changeEditor",{oldEditor:this});P&&P._signal("changeEditor",{editor:this});P&&P.bgTokenizer&&P.bgTokenizer.scheduleStart()}};this.getSession=function(){return this.session};this.setValue=function(P,ea){this.session.doc.setValue(P);
ea?1==ea?this.navigateFileEnd():-1==ea&&this.navigateFileStart():this.selectAll();return P};this.getValue=function(){return this.session.getValue()};this.getSelection=function(){return this.selection};this.resize=function(P){this.renderer.onResize(P)};this.setTheme=function(P,ea){this.renderer.setTheme(P,ea)};this.getTheme=function(){return this.renderer.getTheme()};this.setStyle=function(P){this.renderer.setStyle(P)};this.unsetStyle=function(P){this.renderer.unsetStyle(P)};this.getFontSize=function(){return this.getOption("fontSize")||
f.computedStyle(this.container).fontSize};this.setFontSize=function(P){this.setOption("fontSize",P)};this.$highlightBrackets=function(){if(!this.$highlightPending){var P=this;this.$highlightPending=!0;setTimeout(function(){P.$highlightPending=!1;var ea=P.session;if(ea&&ea.bgTokenizer){ea.$bracketHighlight&&(ea.$bracketHighlight.markerIds.forEach(function(pa){ea.removeMarker(pa)}),ea.$bracketHighlight=null);var ua=ea.getMatchingBracketRanges(P.getCursorPosition());!ua&&ea.$mode.getMatching&&(ua=ea.$mode.getMatching(P.session));
if(ua){var Fa="ace_bracket";Array.isArray(ua)?1==ua.length&&(Fa="ace_error_bracket"):ua=[ua];2==ua.length&&(0==G.comparePoints(ua[0].end,ua[1].start)?ua=[G.fromPoints(ua[0].start,ua[1].end)]:0==G.comparePoints(ua[0].start,ua[1].end)&&(ua=[G.fromPoints(ua[1].start,ua[0].end)]));ea.$bracketHighlight={ranges:ua,markerIds:ua.map(function(pa){return ea.addMarker(pa,Fa,"text")})}}}},50)}};this.$highlightTags=function(){if(!this.$highlightTagPending){var P=this;this.$highlightTagPending=!0;setTimeout(function(){P.$highlightTagPending=
!1;var ea=P.session;if(ea&&ea.bgTokenizer){var ua=P.getCursorPosition(),Fa=new Q(P.session,ua.row,ua.column);if((ua=Fa.getCurrentToken())&&/\b(?:tag-open|tag-name)/.test(ua.type)){if(-1!=ua.type.indexOf("tag-open")&&(ua=Fa.stepForward(),!ua))return;var pa=ua.value,ra=0,Ca=Fa.stepBackward();if("<"==Ca.value){do Ca=ua,(ua=Fa.stepForward())&&ua.value===pa&&-1!==ua.type.indexOf("tag-name")&&("<"===Ca.value?ra++:"</"===Ca.value&&ra--);while(ua&&0<=ra)}else{do ua=Ca,Ca=Fa.stepBackward(),ua&&ua.value===
pa&&-1!==ua.type.indexOf("tag-name")&&("<"===Ca.value?ra++:"</"===Ca.value&&ra--);while(Ca&&0>=ra);Fa.stepForward()}ua?(pa=Fa.getCurrentTokenRow(),Fa=Fa.getCurrentTokenColumn(),ua=new G(pa,Fa,pa,Fa+ua.value.length),Fa=ea.$backMarkers[ea.$tagHighlight],ea.$tagHighlight&&void 0!=Fa&&0!==ua.compareRange(Fa.range)&&(ea.removeMarker(ea.$tagHighlight),ea.$tagHighlight=null),ea.$tagHighlight||(ea.$tagHighlight=ea.addMarker(ua,"ace_bracket","text"))):(ea.removeMarker(ea.$tagHighlight),ea.$tagHighlight=null)}else ea.removeMarker(ea.$tagHighlight),
ea.$tagHighlight=null}},50)}};this.focus=function(){var P=this;setTimeout(function(){P.isFocused()||P.textInput.focus()});this.textInput.focus()};this.isFocused=function(){return this.textInput.isFocused()};this.blur=function(){this.textInput.blur()};this.onFocus=function(P){this.$isFocused||(this.$isFocused=!0,this.renderer.showCursor(),this.renderer.visualizeFocus(),this._emit("focus",P))};this.onBlur=function(P){this.$isFocused&&(this.$isFocused=!1,this.renderer.hideCursor(),this.renderer.visualizeBlur(),
this._emit("blur",P))};this.$cursorChange=function(){this.renderer.updateCursor();this.$highlightBrackets();this.$highlightTags();this.$updateHighlightActiveLine()};this.onDocumentChange=function(P){this.renderer.updateLines(P.start.row,P.start.row==P.end.row?P.end.row:Infinity,this.session.$useWrapMode);this._signal("change",P);this.$cursorChange()};this.onTokenizerUpdate=function(P){P=P.data;this.renderer.updateLines(P.first,P.last)};this.onScrollTopChange=function(){this.renderer.scrollToY(this.session.getScrollTop())};
this.onScrollLeftChange=function(){this.renderer.scrollToX(this.session.getScrollLeft())};this.onCursorChange=function(){this.$cursorChange();this._signal("changeSelection")};this.$updateHighlightActiveLine=function(){var P=this.getSession(),ea;this.$highlightActiveLine&&("line"==this.$selectionStyle&&this.selection.isMultiLine()||(ea=this.getCursorPosition()),this.renderer.theme&&this.renderer.theme.$selectionColorConflict&&!this.selection.isEmpty()&&(ea=!1),!this.renderer.$maxLines||1!==this.session.getLength()||
1<this.renderer.$minLines||(ea=!1));P.$highlightLineMarker&&!ea?(P.removeMarker(P.$highlightLineMarker.id),P.$highlightLineMarker=null):!P.$highlightLineMarker&&ea?(ea=new G(ea.row,ea.column,ea.row,Infinity),ea.id=P.addMarker(ea,"ace_active-line","screenLine"),P.$highlightLineMarker=ea):ea&&(P.$highlightLineMarker.start.row=ea.row,P.$highlightLineMarker.end.row=ea.row,P.$highlightLineMarker.start.column=ea.column,P._signal("changeBackMarker"))};this.onSelectionChange=function(){var P=this.session;
P.$selectionMarker&&P.removeMarker(P.$selectionMarker);P.$selectionMarker=null;if(this.selection.isEmpty())this.$updateHighlightActiveLine();else{var ea=this.selection.getRange(),ua=this.getSelectionStyle();P.$selectionMarker=P.addMarker(ea,"ace_selection",ua)}P=this.$highlightSelectedWord&&this.$getSelectionHighLightRegexp();this.session.highlight(P);this._signal("changeSelection")};this.$getSelectionHighLightRegexp=function(){var P=this.session,ea=this.getSelectionRange();if(!ea.isEmpty()&&!ea.isMultiLine()){var ua=
ea.start.column,Fa=ea.end.column;P=P.getLine(ea.start.row);ea=P.substring(ua,Fa);if(!(5E3<ea.length)&&/[\w\d]/.test(ea)&&(ea=this.$search.$assembleRegExp({wholeWord:!0,caseSensitive:!0,needle:ea}),ua=P.substring(ua-1,Fa+1),ea.test(ua)))return ea}};this.onChangeFrontMarker=function(){this.renderer.updateFrontMarkers()};this.onChangeBackMarker=function(){this.renderer.updateBackMarkers()};this.onChangeBreakpoint=function(){this.renderer.updateBreakpoints()};this.onChangeAnnotation=function(){this.renderer.setAnnotations(this.session.getAnnotations())};
this.onChangeMode=function(P){this.renderer.updateText();this._emit("changeMode",P)};this.onChangeWrapLimit=function(){this.renderer.updateFull()};this.onChangeWrapMode=function(){this.renderer.onResize(!0)};this.onChangeFold=function(){this.$updateHighlightActiveLine();this.renderer.updateFull()};this.getSelectedText=function(){return this.session.getTextRange(this.getSelectionRange())};this.getCopyText=function(){var P=this.getSelectedText(),ea=this.session.doc.getNewLineCharacter(),ua=!1;if(!P&&
this.$copyWithEmptySelection){ua=!0;for(var Fa=this.selection.getAllRanges(),pa=0;pa<Fa.length;pa++){var ra=Fa[pa];pa&&Fa[pa-1].start.row==ra.start.row||(P+=this.session.getLine(ra.start.row)+ea)}}P={text:P};this._signal("copy",P);aa.lineMode=ua?P.text:"";return P.text};this.onCopy=function(){this.commands.exec("copy",this)};this.onCut=function(){this.commands.exec("cut",this)};this.onPaste=function(P,ea){this.commands.exec("paste",this,{text:P,event:ea})};this.$handlePaste=function(P){"string"==
typeof P&&(P={text:P});this._signal("paste",P);var ea=P.text;P=ea==aa.lineMode;var ua=this.session;if(!this.inMultiSelectMode||this.inVirtualSelectionMode)P?ua.insert({row:this.selection.lead.row,column:0},ea):this.insert(ea);else if(P)this.selection.rangeList.ranges.forEach(function(Ca){ua.insert({row:Ca.start.row,column:0},ea)});else{P=ea.split(/\r\n|\r|\n/);var Fa=this.selection.rangeList.ranges,pa=2==P.length&&(!P[0]||!P[1]);if(P.length!=Fa.length||pa)return this.commands.exec("insertstring",
this,ea);for(pa=Fa.length;pa--;){var ra=Fa[pa];ra.isEmpty()||ua.remove(ra);ua.insert(ra.start,P[pa])}}};this.execCommand=function(P,ea){return this.commands.exec(P,this,ea)};this.insert=function(P,ea){var ua=this.session,Fa=ua.getMode(),pa=this.getCursorPosition();if(this.getBehavioursEnabled()&&!ea){var ra=Fa.transformAction(ua.getState(pa.row),"insertion",this,ua,P);ra&&(P===ra.text||this.inVirtualSelectionMode||(this.mergeNextCommand=this.session.mergeUndoDeltas=!1),P=ra.text)}"\t"==P&&(P=this.session.getTabString());
this.selection.isEmpty()?this.session.getOverwrite()&&-1==P.indexOf("\n")&&(ea=new G.fromPoints(pa,pa),ea.end.column+=P.length,this.session.remove(ea)):(ea=this.getSelectionRange(),pa=this.session.remove(ea,"remove_in_insert"),this.clearSelection());if("\n"==P||"\r\n"==P){var Ca=ua.getLine(pa.row);pa.column>Ca.search(/\S|$/)&&(ea=Ca.substr(pa.column).search(/\S|$/),ua.doc.removeInLine(pa.row,pa.column,pa.column+ea))}this.clearSelection();var Ga=pa.column;ea=ua.getState(pa.row);Ca=ua.getLine(pa.row);
var Aa=Fa.checkOutdent(ea,Ca,P);ua.insert(pa,P);ra&&ra.selection&&(2==ra.selection.length?this.selection.setSelectionRange(new G(pa.row,Ga+ra.selection[0],pa.row,Ga+ra.selection[1])):this.selection.setSelectionRange(new G(pa.row+ra.selection[0],ra.selection[1],pa.row+ra.selection[2],ra.selection[3])));this.$enableAutoIndent&&(ua.getDocument().isNewLine(P)&&(P=Fa.getNextLineIndent(ea,Ca.slice(0,pa.column),ua.getTabString()),ua.insert({row:pa.row+1,column:0},P)),Aa&&Fa.autoOutdent(ea,ua,pa.row))};this.autoIndent=
function(){var P=this.session,ea=P.getMode();if(this.selection.isEmpty()){var ua=0;var Fa=P.doc.getLength()-1}else Fa=this.getSelectionRange(),ua=Fa.start.row,Fa=Fa.end.row;var pa="";var ra="";for(var Ca,Ga=P.getTabString();ua<=Fa;ua++)0<ua&&(pa=P.getState(ua-1),ra=P.getLine(ua-1),ra=ea.getNextLineIndent(pa,ra,Ga)),Ca=P.getLine(ua),Ca=ea.$getIndent(Ca),ra!==Ca&&(0<Ca.length&&(Ca=new G(ua,0,ua,Ca.length),P.remove(Ca)),0<ra.length&&P.insert({row:ua,column:0},ra)),ea.autoOutdent(pa,P,ua)};this.onTextInput=
function(P,ea){if(!ea)return this.keyBinding.onTextInput(P);this.startOperation({command:{name:"insertstring"}});P=this.applyComposition.bind(this,P,ea);this.selection.rangeCount?this.forEachSelection(P):P();this.endOperation()};this.applyComposition=function(P,ea){if(ea.extendLeft||ea.extendRight){var ua=this.selection.getRange();ua.start.column-=ea.extendLeft;ua.end.column+=ea.extendRight;0>ua.start.column&&(ua.start.row--,ua.start.column+=this.session.getLine(ua.start.row).length+1);this.selection.setRange(ua);
P||ua.isEmpty()||this.remove()}!P&&this.selection.isEmpty()||this.insert(P,!0);if(ea.restoreStart||ea.restoreEnd)ua=this.selection.getRange(),ua.start.column-=ea.restoreStart,ua.end.column-=ea.restoreEnd,this.selection.setRange(ua)};this.onCommandKey=function(P,ea,ua){return this.keyBinding.onCommandKey(P,ea,ua)};this.setOverwrite=function(P){this.session.setOverwrite(P)};this.getOverwrite=function(){return this.session.getOverwrite()};this.toggleOverwrite=function(){this.session.toggleOverwrite()};
this.setScrollSpeed=function(P){this.setOption("scrollSpeed",P)};this.getScrollSpeed=function(){return this.getOption("scrollSpeed")};this.setDragDelay=function(P){this.setOption("dragDelay",P)};this.getDragDelay=function(){return this.getOption("dragDelay")};this.setSelectionStyle=function(P){this.setOption("selectionStyle",P)};this.getSelectionStyle=function(){return this.getOption("selectionStyle")};this.setHighlightActiveLine=function(P){this.setOption("highlightActiveLine",P)};this.getHighlightActiveLine=
function(){return this.getOption("highlightActiveLine")};this.setHighlightGutterLine=function(P){this.setOption("highlightGutterLine",P)};this.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")};this.setHighlightSelectedWord=function(P){this.setOption("highlightSelectedWord",P)};this.getHighlightSelectedWord=function(){return this.$highlightSelectedWord};this.setAnimatedScroll=function(P){this.renderer.setAnimatedScroll(P)};this.getAnimatedScroll=function(){return this.renderer.getAnimatedScroll()};
this.setShowInvisibles=function(P){this.renderer.setShowInvisibles(P)};this.getShowInvisibles=function(){return this.renderer.getShowInvisibles()};this.setDisplayIndentGuides=function(P){this.renderer.setDisplayIndentGuides(P)};this.getDisplayIndentGuides=function(){return this.renderer.getDisplayIndentGuides()};this.setShowPrintMargin=function(P){this.renderer.setShowPrintMargin(P)};this.getShowPrintMargin=function(){return this.renderer.getShowPrintMargin()};this.setPrintMarginColumn=function(P){this.renderer.setPrintMarginColumn(P)};
this.getPrintMarginColumn=function(){return this.renderer.getPrintMarginColumn()};this.setReadOnly=function(P){this.setOption("readOnly",P)};this.getReadOnly=function(){return this.getOption("readOnly")};this.setBehavioursEnabled=function(P){this.setOption("behavioursEnabled",P)};this.getBehavioursEnabled=function(){return this.getOption("behavioursEnabled")};this.setWrapBehavioursEnabled=function(P){this.setOption("wrapBehavioursEnabled",P)};this.getWrapBehavioursEnabled=function(){return this.getOption("wrapBehavioursEnabled")};
this.setShowFoldWidgets=function(P){this.setOption("showFoldWidgets",P)};this.getShowFoldWidgets=function(){return this.getOption("showFoldWidgets")};this.setFadeFoldWidgets=function(P){this.setOption("fadeFoldWidgets",P)};this.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")};this.remove=function(P){this.selection.isEmpty()&&("left"==P?this.selection.selectLeft():this.selection.selectRight());P=this.getSelectionRange();if(this.getBehavioursEnabled()){var ea=this.session,ua=
ea.getState(P.start.row);ua=ea.getMode().transformAction(ua,"deletion",this,ea,P);if(0===P.end.column){var Fa=ea.getTextRange(P);"\n"==Fa[Fa.length-1]&&(ea=ea.getLine(P.end.row),/^\s+$/.test(ea)&&(P.end.column=ea.length))}ua&&(P=ua)}this.session.remove(P);this.clearSelection()};this.removeWordRight=function(){this.selection.isEmpty()&&this.selection.selectWordRight();this.session.remove(this.getSelectionRange());this.clearSelection()};this.removeWordLeft=function(){this.selection.isEmpty()&&this.selection.selectWordLeft();
this.session.remove(this.getSelectionRange());this.clearSelection()};this.removeToLineStart=function(){this.selection.isEmpty()&&this.selection.selectLineStart();this.selection.isEmpty()&&this.selection.selectLeft();this.session.remove(this.getSelectionRange());this.clearSelection()};this.removeToLineEnd=function(){this.selection.isEmpty()&&this.selection.selectLineEnd();var P=this.getSelectionRange();P.start.column==P.end.column&&P.start.row==P.end.row&&(P.end.column=0,P.end.row++);this.session.remove(P);
this.clearSelection()};this.splitLine=function(){this.selection.isEmpty()||(this.session.remove(this.getSelectionRange()),this.clearSelection());var P=this.getCursorPosition();this.insert("\n");this.moveCursorToPosition(P)};this.transposeLetters=function(){if(this.selection.isEmpty()){var P=this.getCursorPosition(),ea=P.column;if(0!==ea){var ua=this.session.getLine(P.row);ea<ua.length?(ua=ua.charAt(ea)+ua.charAt(ea-1),P=new G(P.row,ea-1,P.row,ea+1)):(ua=ua.charAt(ea-1)+ua.charAt(ea-2),P=new G(P.row,
ea-2,P.row,ea));this.session.replace(P,ua);this.session.selection.moveToPosition(P.end)}}};this.toLowerCase=function(){var P=this.getSelectionRange();this.selection.isEmpty()&&this.selection.selectWord();var ea=this.getSelectionRange(),ua=this.session.getTextRange(ea);this.session.replace(ea,ua.toLowerCase());this.selection.setSelectionRange(P)};this.toUpperCase=function(){var P=this.getSelectionRange();this.selection.isEmpty()&&this.selection.selectWord();var ea=this.getSelectionRange(),ua=this.session.getTextRange(ea);
this.session.replace(ea,ua.toUpperCase());this.selection.setSelectionRange(P)};this.indent=function(){var P=this.session,ea=this.getSelectionRange();if(ea.start.row<ea.end.row)ea=this.$getSelectedRows(),P.indentRows(ea.first,ea.last,"\t");else{if(ea.start.column<ea.end.column){var ua=P.getTextRange(ea);if(!/^\s+$/.test(ua)){ea=this.$getSelectedRows();P.indentRows(ea.first,ea.last,"\t");return}}ua=P.getLine(ea.start.row);var Fa=ea.start,pa=P.getTabSize();P=P.documentToScreenColumn(Fa.row,Fa.column);
if(this.session.getUseSoftTabs())ea=h.stringRepeat(" ",pa-P%pa);else{for(P%=pa;" "==ua[ea.start.column-1]&&P;)ea.start.column--,P--;this.selection.setSelectionRange(ea);ea="\t"}return this.insert(ea)}};this.blockIndent=function(){var P=this.$getSelectedRows();this.session.indentRows(P.first,P.last,"\t")};this.blockOutdent=function(){var P=this.session.getSelection();this.session.outdentRows(P.getRange())};this.sortLines=function(){for(var P=this.$getSelectedRows(),ea=this.session,ua=[],Fa=P.first;Fa<=
P.last;Fa++)ua.push(ea.getLine(Fa));ua.sort(function(Ca,Ga){return Ca.toLowerCase()<Ga.toLowerCase()?-1:Ca.toLowerCase()>Ga.toLowerCase()?1:0});var pa=new G(0,0,0,0);for(Fa=P.first;Fa<=P.last;Fa++){var ra=ea.getLine(Fa);pa.start.row=Fa;pa.end.row=Fa;pa.end.column=ra.length;ea.replace(pa,ua[Fa-P.first])}};this.toggleCommentLines=function(){var P=this.session.getState(this.getCursorPosition().row),ea=this.$getSelectedRows();this.session.getMode().toggleCommentLines(P,this.session,ea.first,ea.last)};
this.toggleBlockComment=function(){var P=this.getCursorPosition(),ea=this.session.getState(P.row),ua=this.getSelectionRange();this.session.getMode().toggleBlockComment(ea,this.session,ua,P)};this.getNumberAt=function(P,ea){var ua=/[\-]?[0-9]+(?:\.[0-9]+)?/g;ua.lastIndex=0;for(P=this.session.getLine(P);ua.lastIndex<ea;){var Fa=ua.exec(P);if(Fa.index<=ea&&Fa.index+Fa[0].length>=ea)return{value:Fa[0],start:Fa.index,end:Fa.index+Fa[0].length}}return null};this.modifyNumber=function(P){var ea=this.selection.getCursor().row,
ua=this.selection.getCursor().column,Fa=new G(ea,ua-1,ea,ua);Fa=this.session.getTextRange(Fa);if(!isNaN(parseFloat(Fa))&&isFinite(Fa)){if(Fa=this.getNumberAt(ea,ua)){var pa=0<=Fa.value.indexOf(".")?Fa.start+Fa.value.indexOf(".")+1:Fa.end,ra=Fa.start+Fa.value.length-pa,Ca=parseFloat(Fa.value);Ca*=Math.pow(10,ra);P=pa!==Fa.end&&ua<pa?P*Math.pow(10,Fa.end-ua-1):P*Math.pow(10,Fa.end-ua);Ca=(Ca+P)/Math.pow(10,ra);P=Ca.toFixed(ra);pa=new G(ea,Fa.start,ea,Fa.end);this.session.replace(pa,P);this.moveCursorTo(ea,
Math.max(Fa.start+1,ua+P.length-Fa.value.length))}}else this.toggleWord()};this.$toggleWordPairs=[["first","last"],["true","false"],["yes","no"],["width","height"],["top","bottom"],["right","left"],["on","off"],["x","y"],["get","set"],["max","min"],["horizontal","vertical"],["show","hide"],["add","remove"],["up","down"],["before","after"],["even","odd"],["in","out"],["inside","outside"],["next","previous"],["increase","decrease"],["attach","detach"],["&&","||"],["==","!="]];this.toggleWord=function(){var P=
this.selection.getCursor().row,ea=this.selection.getCursor().column;this.selection.selectWord();var ua=this.getSelectedText(),Fa=this.selection.getWordRange().start.column,pa=ua.replace(/([a-z]+|[A-Z]+)(?=[A-Z_]|$)/g,"$1 ").split(/\s/),ra=ea-Fa-1;0>ra&&(ra=0);var Ca=0,Ga=0,Aa=this;ua.match(/[A-Za-z0-9_]+/)&&pa.forEach(function(Ia){Ga=Ca+Ia.length;ra>=Ca&&ra<=Ga&&(ua=Ia,Aa.selection.clearSelection(),Aa.moveCursorTo(P,Ca+Fa),Aa.selection.selectTo(P,Ga+Fa));Ca=Ga});ea=this.$toggleWordPairs;var xa;for(pa=
0;pa<ea.length;pa++)for(var za=ea[pa],Na=0;1>=Na;Na++){var ya=+!Na;(xa=ua.match(new RegExp("^\\s?_?("+h.escapeRegExp(za[Na])+")\\s?$","i")))&&ua.match(new RegExp("([_]|^|\\s)("+h.escapeRegExp(xa[1])+")($|\\s)","g"))&&(xa=ua.replace(new RegExp(h.escapeRegExp(za[Na]),"i"),function(Ia){var $a=za[ya];Ia.toUpperCase()==Ia?$a=$a.toUpperCase():Ia.charAt(0).toUpperCase()==Ia.charAt(0)&&($a=$a.substr(0,0)+za[ya].charAt(0).toUpperCase()+$a.substr(1));return $a}),this.insert(xa),xa="")}};this.removeLines=function(){var P=
this.$getSelectedRows();this.session.removeFullLines(P.first,P.last);this.clearSelection()};this.duplicateSelection=function(){var P=this.selection,ea=this.session,ua=P.getRange(),Fa=P.isBackwards();if(ua.isEmpty())P=ua.start.row,ea.duplicateLines(P,P);else{var pa=Fa?ua.start:ua.end;ea=ea.insert(pa,ea.getTextRange(ua),!1);ua.start=pa;ua.end=ea;P.setSelectionRange(ua,Fa)}};this.moveLinesDown=function(){this.$moveLines(1,!1)};this.moveLinesUp=function(){this.$moveLines(-1,!1)};this.moveText=function(P,
ea,ua){return this.session.moveText(P,ea,ua)};this.copyLinesUp=function(){this.$moveLines(-1,!0)};this.copyLinesDown=function(){this.$moveLines(1,!0)};this.$moveLines=function(P,ea){var ua=this.selection;if(!ua.inMultiSelectMode||this.inVirtualSelectionMode){var Fa=ua.toOrientedRange();var pa=this.$getSelectedRows(Fa);var ra=this.session.$moveLines(pa.first,pa.last,ea?0:P);ea&&-1==P&&(ra=0);Fa.moveBy(ra,0);ua.fromOrientedRange(Fa)}else{Fa=ua.rangeList.ranges;ua.rangeList.detach(this.session);this.inVirtualSelectionMode=
!0;var Ca=0;ra=0;for(var Ga=Fa.length,Aa=0;Aa<Ga;Aa++){var xa=Aa;Fa[Aa].moveBy(Ca,0);pa=this.$getSelectedRows(Fa[Aa]);Ca=pa.first;for(pa=pa.last;++Aa<Ga;){ra&&Fa[Aa].moveBy(ra,0);var za=this.$getSelectedRows(Fa[Aa]);if(ea&&za.first!=pa)break;else if(!ea&&za.first>pa+1)break;pa=za.last}Aa--;Ca=this.session.$moveLines(Ca,pa,ea?0:P);for(ea&&-1==P&&(xa=Aa+1);xa<=Aa;)Fa[xa].moveBy(Ca,0),xa++;ea||(Ca=0);ra+=Ca}ua.fromOrientedRange(ua.ranges[0]);ua.rangeList.attach(this.session);this.inVirtualSelectionMode=
!1}};this.$getSelectedRows=function(P){P=(P||this.getSelectionRange()).collapseRows();return{first:this.session.getRowFoldStart(P.start.row),last:this.session.getRowFoldEnd(P.end.row)}};this.onCompositionStart=function(P){this.renderer.showComposition(P)};this.onCompositionUpdate=function(P){this.renderer.setCompositionText(P)};this.onCompositionEnd=function(){this.renderer.hideComposition()};this.getFirstVisibleRow=function(){return this.renderer.getFirstVisibleRow()};this.getLastVisibleRow=function(){return this.renderer.getLastVisibleRow()};
this.isRowVisible=function(P){return P>=this.getFirstVisibleRow()&&P<=this.getLastVisibleRow()};this.isRowFullyVisible=function(P){return P>=this.renderer.getFirstFullyVisibleRow()&&P<=this.renderer.getLastFullyVisibleRow()};this.$getVisibleRowCount=function(){return this.renderer.getScrollBottomRow()-this.renderer.getScrollTopRow()+1};this.$moveByPage=function(P,ea){var ua=this.renderer,Fa=this.renderer.layerConfig,pa=P*Math.floor(Fa.height/Fa.lineHeight);!0===ea?this.selection.$moveSelection(function(){this.moveCursorBy(pa,
0)}):!1===ea&&(this.selection.moveCursorBy(pa,0),this.selection.clearSelection());P=ua.scrollTop;ua.scrollBy(0,pa*Fa.lineHeight);null!=ea&&ua.scrollCursorIntoView(null,.5);ua.animateScrolling(P)};this.selectPageDown=function(){this.$moveByPage(1,!0)};this.selectPageUp=function(){this.$moveByPage(-1,!0)};this.gotoPageDown=function(){this.$moveByPage(1,!1)};this.gotoPageUp=function(){this.$moveByPage(-1,!1)};this.scrollPageDown=function(){this.$moveByPage(1)};this.scrollPageUp=function(){this.$moveByPage(-1)};
this.scrollToRow=function(P){this.renderer.scrollToRow(P)};this.scrollToLine=function(P,ea,ua,Fa){this.renderer.scrollToLine(P,ea,ua,Fa)};this.centerSelection=function(){var P=this.getSelectionRange();this.renderer.alignCursor({row:Math.floor(P.start.row+(P.end.row-P.start.row)/2),column:Math.floor(P.start.column+(P.end.column-P.start.column)/2)},.5)};this.getCursorPosition=function(){return this.selection.getCursor()};this.getCursorPositionScreen=function(){return this.session.documentToScreenPosition(this.getCursorPosition())};
this.getSelectionRange=function(){return this.selection.getRange()};this.selectAll=function(){this.selection.selectAll()};this.clearSelection=function(){this.selection.clearSelection()};this.moveCursorTo=function(P,ea){this.selection.moveCursorTo(P,ea)};this.moveCursorToPosition=function(P){this.selection.moveCursorToPosition(P)};this.jumpToMatching=function(P,ea){var ua=this.getCursorPosition(),Fa=new Q(this.session,ua.row,ua.column),pa=Fa.getCurrentToken(),ra=pa||Fa.stepForward();if(ra){var Ca=
!1,Ga={},Aa=ua.column-ra.start,xa={")":"(","(":"(","]":"[","[":"[","{":"{","}":"{"};do{if(ra.value.match(/[{}()\[\]]/g))for(;Aa<ra.value.length&&!Ca;Aa++){if(xa[ra.value[Aa]]){var za=xa[ra.value[Aa]]+"."+ra.type.replace("rparen","lparen");isNaN(Ga[za])&&(Ga[za]=0);switch(ra.value[Aa]){case "(":case "[":case "{":Ga[za]++;break;case ")":case "]":case "}":if(Ga[za]--,-1===Ga[za]){var Na="bracket";Ca=!0}}}}else-1!==ra.type.indexOf("tag-name")&&(isNaN(Ga[ra.value])&&(Ga[ra.value]=0),"<"===pa.value?Ga[ra.value]++:
"</"===pa.value&&Ga[ra.value]--,-1===Ga[ra.value]&&(Na="tag",Ca=!0));Ca||(pa=ra,ra=Fa.stepForward(),Aa=0)}while(ra&&!Ca);if(Na){if("bracket"===Na){var ya=this.session.getBracketRange(ua);if(!ya){ya=new G(Fa.getCurrentTokenRow(),Fa.getCurrentTokenColumn()+Aa-1,Fa.getCurrentTokenRow(),Fa.getCurrentTokenColumn()+Aa-1);var Ia=ya.start;if(ea||Ia.row===ua.row&&2>Math.abs(Ia.column-ua.column))ya=this.session.getBracketRange(Ia)}}else if("tag"===Na){if(ra&&-1!==ra.type.indexOf("tag-name"))Na=ra.value;else return;
ya=new G(Fa.getCurrentTokenRow(),Fa.getCurrentTokenColumn()-2,Fa.getCurrentTokenRow(),Fa.getCurrentTokenColumn()-2);if(0===ya.compare(ua.row,ua.column)){Ca=!1;do if(ra=pa,pa=Fa.stepBackward())-1!==pa.type.indexOf("tag-close")&&ya.setEnd(Fa.getCurrentTokenRow(),Fa.getCurrentTokenColumn()+1),ra.value===Na&&-1!==ra.type.indexOf("tag-name")&&("<"===pa.value?Ga[Na]++:"</"===pa.value&&Ga[Na]--,0===Ga[Na]&&(Ca=!0));while(pa&&!Ca)}ra&&ra.type.indexOf("tag-name")&&(Ia=ya.start,Ia.row==ua.row&&2>Math.abs(Ia.column-
ua.column)&&(Ia=ya.end))}(Ia=ya&&ya.cursor||Ia)&&(P?ya&&ea?this.selection.setRange(ya):ya&&ya.isEqual(this.getSelectionRange())?this.clearSelection():this.selection.selectTo(Ia.row,Ia.column):this.selection.moveTo(Ia.row,Ia.column))}}};this.gotoLine=function(P,ea,ua){this.selection.clearSelection();this.session.unfold({row:P-1,column:ea||0});this.exitMultiSelectMode&&this.exitMultiSelectMode();this.moveCursorTo(P-1,ea||0);this.isRowFullyVisible(P-1)||this.scrollToLine(P-1,!0,ua)};this.navigateTo=
function(P,ea){this.selection.moveTo(P,ea)};this.navigateUp=function(P){if(this.selection.isMultiLine()&&!this.selection.isBackwards())return P=this.selection.anchor.getPosition(),this.moveCursorToPosition(P);this.selection.clearSelection();this.selection.moveCursorBy(-P||-1,0)};this.navigateDown=function(P){if(this.selection.isMultiLine()&&this.selection.isBackwards())return P=this.selection.anchor.getPosition(),this.moveCursorToPosition(P);this.selection.clearSelection();this.selection.moveCursorBy(P||
1,0)};this.navigateLeft=function(P){if(this.selection.isEmpty())for(P=P||1;P--;)this.selection.moveCursorLeft();else P=this.getSelectionRange().start,this.moveCursorToPosition(P);this.clearSelection()};this.navigateRight=function(P){if(this.selection.isEmpty())for(P=P||1;P--;)this.selection.moveCursorRight();else P=this.getSelectionRange().end,this.moveCursorToPosition(P);this.clearSelection()};this.navigateLineStart=function(){this.selection.moveCursorLineStart();this.clearSelection()};this.navigateLineEnd=
function(){this.selection.moveCursorLineEnd();this.clearSelection()};this.navigateFileEnd=function(){this.selection.moveCursorFileEnd();this.clearSelection()};this.navigateFileStart=function(){this.selection.moveCursorFileStart();this.clearSelection()};this.navigateWordRight=function(){this.selection.moveCursorWordRight();this.clearSelection()};this.navigateWordLeft=function(){this.selection.moveCursorWordLeft();this.clearSelection()};this.replace=function(P,ea){ea&&this.$search.set(ea);ea=this.$search.find(this.session);
var ua=0;if(!ea)return ua;this.$tryReplace(ea,P)&&(ua=1);this.selection.setSelectionRange(ea);this.renderer.scrollSelectionIntoView(ea.start,ea.end);return ua};this.replaceAll=function(P,ea){ea&&this.$search.set(ea);ea=this.$search.findAll(this.session);var ua=0;if(!ea.length)return ua;var Fa=this.getSelectionRange();this.selection.moveTo(0,0);for(var pa=ea.length-1;0<=pa;--pa)this.$tryReplace(ea[pa],P)&&ua++;this.selection.setSelectionRange(Fa);return ua};this.$tryReplace=function(P,ea){var ua=this.session.getTextRange(P);
ea=this.$search.replace(ua,ea);return null!==ea?(P.end=this.session.replace(P,ea),P):null};this.getLastSearchOptions=function(){return this.$search.getOptions()};this.find=function(P,ea,ua){ea||={};"string"==typeof P||P instanceof RegExp?ea.needle=P:"object"==typeof P&&e.mixin(ea,P);var Fa=this.selection.getRange();null==ea.needle&&(P=this.session.getTextRange(Fa)||this.$search.$options.needle,P||(Fa=this.session.getWordRange(Fa.start.row,Fa.start.column),P=this.session.getTextRange(Fa)),this.$search.set({needle:P}));
this.$search.set(ea);ea.start||this.$search.set({start:Fa});P=this.$search.find(this.session);if(ea.preventScroll)return P;if(P)return this.revealRange(P,ua),P;ea.backwards?Fa.start=Fa.end:Fa.end=Fa.start;this.selection.setRange(Fa)};this.findNext=function(P,ea){this.find({skipCurrent:!0,backwards:!1},P,ea)};this.findPrevious=function(P,ea){this.find(P,{skipCurrent:!0,backwards:!0},ea)};this.revealRange=function(P,ea){this.session.unfold(P);this.selection.setSelectionRange(P);var ua=this.renderer.scrollTop;
this.renderer.scrollSelectionIntoView(P.start,P.end,.5);!1!==ea&&this.renderer.animateScrolling(ua)};this.undo=function(){this.session.getUndoManager().undo(this.session);this.renderer.scrollCursorIntoView(null,.5)};this.redo=function(){this.session.getUndoManager().redo(this.session);this.renderer.scrollCursorIntoView(null,.5)};this.destroy=function(){this.$toDestroy&&(this.$toDestroy.forEach(function(P){P.destroy()}),this.$toDestroy=null);this.renderer.destroy();this._signal("destroy",this);this.session&&
this.session.destroy();this._$emitInputEvent&&this._$emitInputEvent.cancel();this.removeAllListeners()};this.setAutoScrollEditorIntoView=function(P){if(P){var ea,ua=this,Fa=!1;this.$scrollAnchor||(this.$scrollAnchor=document.createElement("div"));var pa=this.$scrollAnchor;pa.style.cssText="position:absolute";this.container.insertBefore(pa,this.container.firstChild);var ra=this.on("changeSelection",function(){Fa=!0}),Ca=this.renderer.on("beforeRender",function(){Fa&&(ea=ua.renderer.container.getBoundingClientRect())}),
Ga=this.renderer.on("afterRender",function(){if(Fa&&ea&&(ua.isFocused()||ua.searchBox&&ua.searchBox.isFocused())){var Aa=ua.renderer,xa=Aa.$cursorLayer.$pixelPos;Aa=Aa.layerConfig;var za=xa.top-Aa.offset;Fa=0<=xa.top&&0>za+ea.top?!0:xa.top<Aa.height&&xa.top+ea.top+Aa.lineHeight>window.innerHeight?!1:null;null!=Fa&&(pa.style.top=za+"px",pa.style.left=xa.left+"px",pa.style.height=Aa.lineHeight+"px",pa.scrollIntoView(Fa));Fa=ea=null}});this.setAutoScrollEditorIntoView=function(Aa){Aa||(delete this.setAutoScrollEditorIntoView,
this.off("changeSelection",ra),this.renderer.off("afterRender",Ga),this.renderer.off("beforeRender",Ca))}}};this.$resetCursorStyle=function(){var P=this.$cursorStyle||"ace",ea=this.renderer.$cursorLayer;ea&&(ea.setSmoothBlinking(/smooth/.test(P)),ea.isBlinking=!this.$readOnly&&"wide"!=P,f.setCssClass(ea.element,"ace_slim-cursors",/slim/.test(P)))};this.prompt=function(P,ea,ua){var Fa=this;E.loadModule("./ext/prompt",function(pa){pa.prompt(Fa,P,ea,ua)})}}).call(l.prototype);E.defineOptions(l.prototype,
"editor",{selectionStyle:{set:function(P){this.onSelectionChange();this._signal("changeSelectionStyle",{data:P})},initialValue:"line"},highlightActiveLine:{set:function(){this.$updateHighlightActiveLine()},initialValue:!0},highlightSelectedWord:{set:function(){this.$onSelectionChange()},initialValue:!0},readOnly:{set:function(P){this.textInput.setReadOnly(P);this.$resetCursorStyle()},initialValue:!1},copyWithEmptySelection:{set:function(P){this.textInput.setCopyWithEmptySelection(P)},initialValue:!1},
cursorStyle:{set:function(){this.$resetCursorStyle()},values:["ace","slim","smooth","wide"],initialValue:"ace"},mergeUndoDeltas:{values:[!1,!0,"always"],initialValue:!0},behavioursEnabled:{initialValue:!0},wrapBehavioursEnabled:{initialValue:!0},enableAutoIndent:{initialValue:!0},autoScrollEditorIntoView:{set:function(P){this.setAutoScrollEditorIntoView(P)}},keyboardHandler:{set:function(P){this.setKeyboardHandler(P)},get:function(){return this.$keybindingId},handlesSet:!0},value:{set:function(P){this.session.setValue(P)},
get:function(){return this.getValue()},handlesSet:!0,hidden:!0},session:{set:function(P){this.setSession(P)},get:function(){return this.session},handlesSet:!0,hidden:!0},showLineNumbers:{set:function(P){this.renderer.$gutterLayer.setShowLineNumbers(P);this.renderer.$loop.schedule(this.renderer.CHANGE_GUTTER);P&&this.$relativeLineNumbers?qa.attach(this):qa.detach(this)},initialValue:!0},relativeLineNumbers:{set:function(P){this.$showLineNumbers&&P?qa.attach(this):qa.detach(this)}},placeholder:{set:function(){this.$updatePlaceholder||
(this.$updatePlaceholder=function(){var P=this.session&&(this.renderer.$composition||this.getValue());P&&this.renderer.placeholderNode?(this.renderer.off("afterRender",this.$updatePlaceholder),f.removeCssClass(this.container,"ace_hasPlaceholder"),this.renderer.placeholderNode.remove(),this.renderer.placeholderNode=null):P||this.renderer.placeholderNode?!P&&this.renderer.placeholderNode&&(this.renderer.placeholderNode.textContent=this.$placeholder||""):(this.renderer.on("afterRender",this.$updatePlaceholder),
f.addCssClass(this.container,"ace_hasPlaceholder"),P=f.createElement("div"),P.className="ace_placeholder",P.textContent=this.$placeholder||"",this.renderer.placeholderNode=P,this.renderer.content.appendChild(this.renderer.placeholderNode))}.bind(this),this.on("input",this.$updatePlaceholder));this.$updatePlaceholder()}},hScrollBarAlwaysVisible:"renderer",vScrollBarAlwaysVisible:"renderer",highlightGutterLine:"renderer",animatedScroll:"renderer",showInvisibles:"renderer",showPrintMargin:"renderer",
printMarginColumn:"renderer",printMargin:"renderer",fadeFoldWidgets:"renderer",showFoldWidgets:"renderer",displayIndentGuides:"renderer",showGutter:"renderer",fontSize:"renderer",fontFamily:"renderer",maxLines:"renderer",minLines:"renderer",scrollPastEnd:"renderer",fixedWidthGutter:"renderer",theme:"renderer",hasCssTransforms:"renderer",maxPixelHeight:"renderer",useTextareaForIME:"renderer",scrollSpeed:"$mouseHandler",dragDelay:"$mouseHandler",dragEnabled:"$mouseHandler",focusTimeout:"$mouseHandler",
tooltipFollowsMouse:"$mouseHandler",firstLineNumber:"session",overwrite:"session",newLineMode:"session",useWorker:"session",useSoftTabs:"session",navigateWithinSoftTabs:"session",tabSize:"session",wrap:"session",indentedSoftWrap:"session",foldStyle:"session",mode:"session"});var qa={getText:function(P,ea){return(Math.abs(P.selection.lead.row-ea)||ea+1+(9>ea?"\u00b7":""))+""},getWidth:function(P,ea,ua){return Math.max(ea.toString().length,(ua.lastRow+1).toString().length,2)*ua.characterWidth},update:function(P,
ea){ea.renderer.$loop.schedule(ea.renderer.CHANGE_GUTTER)},attach:function(P){P.renderer.$gutterLayer.$renderer=this;P.on("changeSelection",this.update);this.update(null,P)},detach:function(P){P.renderer.$gutterLayer.$renderer==this&&(P.renderer.$gutterLayer.$renderer=null);P.off("changeSelection",this.update);this.update(null,P)}};b.Editor=l});
define("ace/undomanager",["require","exports","module","ace/range"],function(a,b){function l(){this.$maxRev=0;this.$fromUndo=!1;this.reset()}function e(G){return{row:G.row,column:G.column}}function f(G){G=G||this;if(Array.isArray(G))return G.map(f).join("\n");var N="";G.action?(N="insert"==G.action?"+":"-",N+="["+G.lines+"]"):G.value&&(N=Array.isArray(G.value)?G.value.map(h).join("\n"):h(G.value));G.start&&(N+=h(G));if(G.id||G.rev)N+="\t("+(G.id||G.rev)+")";return N}function h(G){return G.start.row+
":"+G.start.column+"=>"+G.end.row+":"+G.end.column}function g(G,N){var T="insert"==G.action,V="insert"==N.action;if(T&&V)if(0<=F(N.start,G.end))m(N,G,-1);else if(0>=F(N.start,G.start))m(G,N,1);else return null;else if(T&&!V)if(0<=F(N.start,G.end))m(N,G,-1);else if(0>=F(N.end,G.start))m(G,N,-1);else return null;else if(!T&&V)if(0<=F(N.start,G.start))m(N,G,1);else if(0>=F(N.start,G.start))m(G,N,1);else return null;else if(!T&&!V)if(0<=F(N.start,G.start))m(N,G,1);else if(0>=F(N.end,G.start))m(G,N,-1);
else return null;return[N,G]}function m(G,N,T){q(G.start,N.start,N.end,T);q(G.end,N.start,N.end,T)}function q(G,N,T,V){G.row==(1==V?N:T).row&&(G.column+=V*(T.column-N.column));G.row+=V*(T.row-N.row)}function r(G,N){var T=G.lines,V=G.end;G.end=e(N);var E=G.end.row-G.start.row,Q=T.splice(E,T.length);E=E?N.column:N.column-G.start.column;T.push(Q[0].substring(0,E));Q[0]=Q[0].substr(E);return{start:e(N),end:V,lines:Q,action:G.action}}function B(G,N){for(var T=0;T<N.length;T++)for(var V=N[T],E=0;E<V.length;E++){var Q=
G,aa=V[E],qa=aa;aa={start:e(qa.start),end:e(qa.end),action:qa.action,lines:qa.lines.slice()};for(qa=Q.length;qa--;){for(var P=Q[qa],ea=0;ea<P.length;ea++){var ua;a:{var Fa=ua=void 0,pa=P[ea],ra="insert"==pa.action,Ca="insert"==aa.action;if(ra&&Ca)0>F(pa.start,aa.start)?m(aa,pa,1):m(pa,aa,1);else if(ra&&!Ca)0<=F(pa.start,aa.end)?m(pa,aa,-1):(0>=F(pa.start,aa.start)||m(pa,D.fromPoints(aa.start,pa.start),-1),m(aa,pa,1));else if(!ra&&Ca)0<=F(aa.start,pa.end)?m(aa,pa,-1):(0>=F(aa.start,pa.start)||m(aa,
D.fromPoints(pa.start,aa.start),-1),m(pa,aa,1));else if(!ra&&!Ca)if(0<=F(aa.start,pa.end))m(aa,pa,-1);else if(0>=F(aa.end,pa.start))m(pa,aa,-1);else{0>F(pa.start,aa.start)&&(Fa=pa,pa=r(pa,aa.start));0<F(pa.end,aa.end)&&(ua=r(pa,aa.end));q(aa.end,pa.start,pa.end,-1);ua&&!Fa&&(pa.lines=ua.lines,pa.start=ua.start,pa.end=ua.end,ua=pa);ua=[aa,Fa,ua].filter(Boolean);break a}ua=[aa,pa]}aa=ua[0];2!=ua.length&&(ua[2]?(P.splice(ea+1,1,ua[1],ua[2]),ea++):ua[1]||(P.splice(ea,1),ea--))}P.length||Q.splice(qa,1)}}}
(function(){this.addSession=function(G){this.$session=G};this.add=function(G,N){if(!this.$fromUndo&&G!=this.$lastDelta){this.$keepRedoStack||(this.$redoStack.length=0);!1!==N&&this.lastDeltas||(this.lastDeltas=[],this.$undoStack.push(this.lastDeltas),G.id=this.$rev=++this.$maxRev);if("remove"==G.action||"insert"==G.action)this.$lastDelta=G;this.lastDeltas.push(G)}};this.addSelection=function(G,N){this.selections.push({value:G,rev:N||this.$rev})};this.startNewGroup=function(){this.lastDeltas=null;
return this.$rev};this.markIgnored=function(G,N){null==N&&(N=this.$rev+1);for(var T=this.$undoStack,V=T.length;V--;){var E=T[V][0];if(E.id<=G)break;E.id<N&&(E.ignore=!0)}this.lastDeltas=null};this.getSelection=function(G,N){for(var T=this.selections,V=T.length;V--;){var E=T[V];if(E.rev<G)return N&&(E=T[V+1]),E}};this.getRevision=function(){return this.$rev};this.getDeltas=function(G,N){null==N&&(N=this.$rev+1);for(var T=this.$undoStack,V=null,E=0,Q=T.length;Q--;){var aa=T[Q][0];aa.id<N&&!V&&(V=Q+
1);if(aa.id<=G){E=Q+1;break}}return T.slice(E,V)};this.getChangedRanges=function(){};this.getChangedLines=function(){};this.undo=function(G,N){this.lastDeltas=null;var T=this.$undoStack,V;a:{for(var E=V=T.length;E--;){var Q=T[E];if(Q&&!Q[0].ignore){for(;E<V-1;){b:{Q=T[E];for(var aa=T[E+1],qa=Q.length;qa--;)for(var P=0;P<aa.length;P++)if(!g(Q[qa],aa[P])){for(;qa<Q.length;){for(;P--;)g(aa[P],Q[qa]);P=aa.length;qa++}Q=[Q,aa];break b}Q.selectionBefore=aa.selectionBefore=Q.selectionAfter=aa.selectionAfter=
null;Q=[aa,Q]}T[E]=Q[0];T[E+1]=Q[1];E++}V=!0;break a}}V=void 0}if(V)return G||(G=this.$session),this.$redoStackBaseRev!==this.$rev&&this.$redoStack.length&&(this.$redoStack=[]),this.$fromUndo=!0,T=T.pop(),V=null,T&&(V=G.undoChanges(T,N),this.$redoStack.push(T),this.$syncRev()),this.$fromUndo=!1,V};this.redo=function(G,N){this.lastDeltas=null;G||(G=this.$session);this.$fromUndo=!0;if(this.$redoStackBaseRev!=this.$rev){var T=this.getDeltas(this.$redoStackBaseRev,this.$rev+1);B(this.$redoStack,T);this.$redoStackBaseRev=
this.$rev;this.$redoStack.forEach(function(E){E[0].id=++this.$maxRev},this)}T=this.$redoStack.pop();var V=null;T&&(V=G.redoChanges(T,N),this.$undoStack.push(T),this.$syncRev());this.$fromUndo=!1;return V};this.$syncRev=function(){var G=this.$undoStack;this.$rev=this.$redoStackBaseRev=G=(G=G[G.length-1])&&G[0].id||0};this.reset=function(){this.$lastDelta=this.lastDeltas=null;this.$undoStack=[];this.$redoStack=[];this.$redoStackBaseRev=this.mark=this.$rev=0;this.selections=[]};this.canUndo=function(){return 0<
this.$undoStack.length};this.canRedo=function(){return 0<this.$redoStack.length};this.bookmark=function(G){void 0==G&&(G=this.$rev);this.mark=G};this.isAtBookmark=function(){return this.$rev===this.mark};this.toJSON=function(){};this.fromJSON=function(){};this.hasUndo=this.canUndo;this.hasRedo=this.canRedo;this.isClean=this.isAtBookmark;this.markClean=this.bookmark;this.$prettyPrint=function(G){return G?f(G):f(this.$undoStack)+"\n---\n"+f(this.$redoStack)}}).call(l.prototype);var D=a("./range").Range,
F=D.comparePoints;b.UndoManager=l});
define("ace/layer/lines",["require","exports","module","ace/lib/dom"],function(a,b){function l(f,h){this.element=f;this.canvasHeight=h||5E5;this.element.style.height=2*this.canvasHeight+"px";this.cells=[];this.cellCache=[];this.$offsetCoefficient=0}var e=a("../lib/dom");(function(){this.moveContainer=function(f){e.translate(this.element,0,-(f.firstRowScreen*f.lineHeight%this.canvasHeight)-f.offset*this.$offsetCoefficient)};this.pageChanged=function(f,h){return Math.floor(f.firstRowScreen*f.lineHeight/
this.canvasHeight)!==Math.floor(h.firstRowScreen*h.lineHeight/this.canvasHeight)};this.computeLineTop=function(f,h,g){var m=Math.floor(h.firstRowScreen*h.lineHeight/this.canvasHeight);return g.documentToScreenRow(f,0)*h.lineHeight-m*this.canvasHeight};this.computeLineHeight=function(f,h,g){return h.lineHeight*g.getRowLineCount(f)};this.getLength=function(){return this.cells.length};this.get=function(f){return this.cells[f]};this.shift=function(){this.$cacheCell(this.cells.shift())};this.pop=function(){this.$cacheCell(this.cells.pop())};
this.push=function(f){if(Array.isArray(f)){this.cells.push.apply(this.cells,f);for(var h=e.createFragment(this.element),g=0;g<f.length;g++)h.appendChild(f[g].element);this.element.appendChild(h)}else this.cells.push(f),this.element.appendChild(f.element)};this.unshift=function(f){if(Array.isArray(f)){this.cells.unshift.apply(this.cells,f);for(var h=e.createFragment(this.element),g=0;g<f.length;g++)h.appendChild(f[g].element);this.element.firstChild?this.element.insertBefore(h,this.element.firstChild):
this.element.appendChild(h)}else this.cells.unshift(f),this.element.insertAdjacentElement("afterbegin",f.element)};this.last=function(){return this.cells.length?this.cells[this.cells.length-1]:null};this.$cacheCell=function(f){f&&(f.element.remove(),this.cellCache.push(f))};this.createCell=function(f,h,g,m){h=this.cellCache.pop();h||(h=e.createElement("div"),m&&m(h),this.element.appendChild(h),h={element:h,text:"",row:f});h.row=f;return h}}).call(l.prototype);b.Lines=l});
define("ace/layer/gutter","require exports module ace/lib/dom ace/lib/oop ace/lib/lang ace/lib/event_emitter ace/layer/lines".split(" "),function(a,b){function l(r){this.element=f.createElement("div");this.element.className="ace_layer ace_gutter-layer";r.appendChild(this.element);this.setShowFoldWidgets(this.$showFoldWidgets);this.gutterWidth=0;this.$annotations=[];this.$updateAnnotations=this.$updateAnnotations.bind(this);this.$lines=new q(this.element);this.$lines.$offsetCoefficient=1}function e(r){var B=
document.createTextNode("");r.appendChild(B);B=f.createElement("span");r.appendChild(B);return r}var f=a("../lib/dom"),h=a("../lib/oop"),g=a("../lib/lang"),m=a("../lib/event_emitter").EventEmitter,q=a("./lines").Lines;(function(){h.implement(this,m);this.setSession=function(r){this.session&&this.session.off("change",this.$updateAnnotations);if(this.session=r)r.on("change",this.$updateAnnotations)};this.addGutterDecoration=function(r,B){window.console&&console.warn&&console.warn("deprecated use session.addGutterDecoration");
this.session.addGutterDecoration(r,B)};this.removeGutterDecoration=function(r,B){window.console&&console.warn&&console.warn("deprecated use session.removeGutterDecoration");this.session.removeGutterDecoration(r,B)};this.setAnnotations=function(r){this.$annotations=[];for(var B=0;B<r.length;B++){var D=r[B],F=D.row,G=this.$annotations[F];G||=this.$annotations[F]={text:[]};F=(F=D.text)?g.escapeHTML(F):D.html||"";-1===G.text.indexOf(F)&&G.text.push(F);D=D.type;"error"==D?G.className=" ace_error":"warning"==
D&&" ace_error"!=G.className?G.className=" ace_warning":"info"!=D||G.className||(G.className=" ace_info")}};this.$updateAnnotations=function(r){if(this.$annotations.length){var B=r.start.row,D=r.end.row-B;0!==D&&("remove"==r.action?this.$annotations.splice(B,D+1,null):(r=Array(D+1),r.unshift(B,1),this.$annotations.splice.apply(this.$annotations,r)))}};this.update=function(r){this.config=r;var B=this.session,D=r.firstRow,F=Math.min(r.lastRow+r.gutterOffset,B.getLength()-1);this.oldLastRow=F;this.config=
r;this.$lines.moveContainer(r);this.$updateCursorRow();for(var G=B.getNextFoldLine(D),N=G?G.start.row:Infinity,T=-1,V=D;;){V>N&&(V=G.end.row+1,N=(G=B.getNextFoldLine(V,G))?G.start.row:Infinity);if(V>F){for(;this.$lines.getLength()>T+1;)this.$lines.pop();break}(D=this.$lines.get(++T))?D.row=V:(D=this.$lines.createCell(V,r,this.session,e),this.$lines.push(D));this.$renderCell(D,r,G,V);V++}this._signal("afterRender");this.$updateGutterWidth(r)};this.$updateGutterWidth=function(r){var B=this.session,
D=B.gutterRenderer||this.$renderer,F=B.$firstLineNumber,G=this.$lines.last()?this.$lines.last().text:"";if(this.$fixedWidth||B.$useWrapMode)G=B.getLength()+F-1;r=D?D.getWidth(B,G,r):G.toString().length*r.characterWidth;B=this.$padding||this.$computePadding();r+=B.left+B.right;r===this.gutterWidth||isNaN(r)||(this.gutterWidth=r,this.element.parentNode.style.width=this.element.style.width=Math.ceil(this.gutterWidth)+"px",this._signal("changeGutterWidth",r))};this.$updateCursorRow=function(){if(this.$highlightGutterLine){var r=
this.session.selection.getCursor();this.$cursorRow!==r.row&&(this.$cursorRow=r.row)}};this.updateLineHighlight=function(){if(this.$highlightGutterLine){var r=this.session.selection.cursor.row;this.$cursorRow=r;if(!this.$cursorCell||this.$cursorCell.row!=r){this.$cursorCell&&(this.$cursorCell.element.className=this.$cursorCell.element.className.replace("ace_gutter-active-line ",""));r=this.$lines.cells;this.$cursorCell=null;for(var B=0;B<r.length;B++){var D=r[B];if(D.row>=this.$cursorRow){if(D.row>
this.$cursorRow)if(D=this.session.getFoldLine(this.$cursorRow),0<B&&D&&D.start.row==r[B-1].row)D=r[B-1];else break;D.element.className="ace_gutter-active-line "+D.element.className;this.$cursorCell=D;break}}}}};this.scrollLines=function(r){var B=this.config;this.config=r;this.$updateCursorRow();if(this.$lines.pageChanged(B,r))return this.update(r);this.$lines.moveContainer(r);var D=Math.min(r.lastRow+r.gutterOffset,this.session.getLength()-1),F=this.oldLastRow;this.oldLastRow=D;if(!B||F<r.firstRow||
D<B.firstRow)return this.update(r);if(B.firstRow<r.firstRow)for(var G=this.session.getFoldedRowCount(B.firstRow,r.firstRow-1);0<G;G--)this.$lines.shift();if(F>D)for(G=this.session.getFoldedRowCount(D+1,F);0<G;G--)this.$lines.pop();r.firstRow<B.firstRow&&this.$lines.unshift(this.$renderLines(r,r.firstRow,B.firstRow-1));D>F&&this.$lines.push(this.$renderLines(r,F+1,D));this.updateLineHighlight();this._signal("afterRender");this.$updateGutterWidth(r)};this.$renderLines=function(r,B,D){for(var F=[],G=
this.session.getNextFoldLine(B),N=G?G.start.row:Infinity;;){B>N&&(B=G.end.row+1,N=(G=this.session.getNextFoldLine(B,G))?G.start.row:Infinity);if(B>D)break;var T=this.$lines.createCell(B,r,this.session,e);this.$renderCell(T,r,G,B);F.push(T);B++}return F};this.$renderCell=function(r,B,D,F){var G=r.element,N=this.session,T=G.childNodes[0],V=G.childNodes[1],E=N.$firstLineNumber,Q=N.$breakpoints,aa=N.$decorations,qa=N.gutterRenderer||this.$renderer,P=this.$showFoldWidgets&&N.foldWidgets,ea=D?D.start.row:
Number.MAX_VALUE,ua="ace_gutter-cell ";this.$highlightGutterLine&&(F==this.$cursorRow||D&&F<this.$cursorRow&&F>=ea&&this.$cursorRow<=D.end.row)&&(ua+="ace_gutter-active-line ",this.$cursorCell!=r&&(this.$cursorCell&&(this.$cursorCell.element.className=this.$cursorCell.element.className.replace("ace_gutter-active-line ","")),this.$cursorCell=r));Q[F]&&(ua+=Q[F]);aa[F]&&(ua+=aa[F]);this.$annotations[F]&&(ua+=this.$annotations[F].className);G.className!=ua&&(G.className=ua);if(P){var Fa=P[F];null==Fa&&
(Fa=P[F]=N.getFoldWidget(F))}Fa?(ua="ace_fold-widget ace_"+Fa,ua="start"==Fa&&F==ea&&F<D.end.row?ua+" ace_closed":ua+" ace_open",V.className!=ua&&(V.className=ua),f.setStyle(V.style,"height",B.lineHeight+"px"),f.setStyle(V.style,"display","inline-block")):V&&f.setStyle(V.style,"display","none");D=(qa?qa.getText(N,F):F+E).toString();D!==T.data&&(T.data=D);f.setStyle(r.element.style,"height",this.$lines.computeLineHeight(F,B,N)+"px");f.setStyle(r.element.style,"top",this.$lines.computeLineTop(F,B,N)+
"px");r.text=D;return r};this.$fixedWidth=!1;this.$highlightGutterLine=!0;this.$renderer="";this.setHighlightGutterLine=function(r){this.$highlightGutterLine=r};this.$showLineNumbers=!0;this.$renderer="";this.setShowLineNumbers=function(r){this.$renderer=!r&&{getWidth:function(){return 0},getText:function(){return""}}};this.getShowLineNumbers=function(){return this.$showLineNumbers};this.$showFoldWidgets=!0;this.setShowFoldWidgets=function(r){r?f.addCssClass(this.element,"ace_folding-enabled"):f.removeCssClass(this.element,
"ace_folding-enabled");this.$showFoldWidgets=r;this.$padding=null};this.getShowFoldWidgets=function(){return this.$showFoldWidgets};this.$computePadding=function(){if(!this.element.firstChild)return{left:0,right:0};var r=f.computedStyle(this.element.firstChild);this.$padding={};this.$padding.left=(parseInt(r.borderLeftWidth)||0)+(parseInt(r.paddingLeft)||0)+1;this.$padding.right=(parseInt(r.borderRightWidth)||0)+(parseInt(r.paddingRight)||0);return this.$padding};this.getRegion=function(r){var B=
this.$padding||this.$computePadding(),D=this.element.getBoundingClientRect();if(r.x<B.left+D.left)return"markers";if(this.$showFoldWidgets&&r.x>D.right-B.right)return"foldWidgets"}}).call(l.prototype);b.Gutter=l});
define("ace/layer/marker",["require","exports","module","ace/range","ace/lib/dom"],function(a,b){function l(h){this.element=f.createElement("div");this.element.className="ace_layer ace_marker-layer";h.appendChild(this.element)}var e=a("../range").Range,f=a("../lib/dom");(function(){this.$padding=0;this.setPadding=function(h){this.$padding=h};this.setSession=function(h){this.session=h};this.setMarkers=function(h){this.markers=h};this.elt=function(h,g){var m=-1!=this.i&&this.element.childNodes[this.i];
m?this.i++:(m=document.createElement("div"),this.element.appendChild(m),this.i=-1);m.style.cssText=g;m.className=h};this.update=function(h){if(h){this.config=h;this.i=0;for(var g in this.markers){var m=this.markers[g];if(m.range){var q=m.range.clipRows(h.firstRow,h.lastRow);if(!q.isEmpty())if(q=q.toScreenRange(this.session),m.renderer){var r=this.$getTop(q.start.row,h);m.renderer(void 0,q,this.$padding+q.start.column*h.characterWidth,r,h)}else"fullLine"==m.type?this.drawFullLineMarker(void 0,q,m.clazz,
h):"screenLine"==m.type?this.drawScreenLineMarker(void 0,q,m.clazz,h):q.isMultiLine()?"text"==m.type?this.drawTextMarker(void 0,q,m.clazz,h):this.drawMultiLineMarker(void 0,q,m.clazz,h):this.drawSingleLineMarker(void 0,q,m.clazz+" ace_start ace_br15",h)}else m.update(void 0,this,this.session,h)}if(-1!=this.i)for(;this.i<this.element.childElementCount;)this.element.removeChild(this.element.lastChild)}};this.$getTop=function(h,g){return(h-g.firstRowScreen)*g.lineHeight};this.drawTextMarker=function(h,
g,m,q,r){for(var B=this.session,D=g.start.row,F=g.end.row,G=D,N,T=0,V=B.getScreenLastRowColumn(G),E=new e(G,g.start.column,G,T);G<=F;G++)E.start.row=E.end.row=G,E.start.column=G==D?g.start.column:B.getRowWrapIndent(G),E.end.column=V,N=T,T=V,V=G+1<F?B.getScreenLastRowColumn(G+1):G==F?0:g.end.column,this.drawSingleLineMarker(h,E,m+(G==D?" ace_start":"")+" ace_br"+((G==D||G==D+1&&g.start.column?1:0)|(N<T?2:0)|(T>V?4:0)|(G==F?8:0)),q,G==F?0:1,r)};this.drawMultiLineMarker=function(h,g,m,q,r){var B=this.$padding,
D=q.lineHeight,F=this.$getTop(g.start.row,q),G=B+g.start.column*q.characterWidth;r=r||"";this.session.$bidiHandler.isBidiRow(g.start.row)?(F=g.clone(),F.end.row=F.start.row,F.end.column=this.session.getLine(F.start.row).length,this.drawBidiSingleLineMarker(h,F,m+" ace_br1 ace_start",q,null,r)):this.elt(m+" ace_br1 ace_start","height:"+D+"px;right:0;top:"+F+"px;left:"+G+"px;"+(r||""));this.session.$bidiHandler.isBidiRow(g.end.row)?(F=g.clone(),F.start.row=F.end.row,F.start.column=0,this.drawBidiSingleLineMarker(h,
F,m+" ace_br12",q,null,r)):(F=this.$getTop(g.end.row,q),this.elt(m+" ace_br12","height:"+D+"px;width:"+g.end.column*q.characterWidth+"px;top:"+F+"px;left:"+B+"px;"+(r||"")));D=(g.end.row-g.start.row-1)*q.lineHeight;0>=D||(F=this.$getTop(g.start.row+1,q),h=(g.start.column?1:0)|(g.end.column?0:8),this.elt(m+(h?" ace_br"+h:""),"height:"+D+"px;right:0;top:"+F+"px;left:"+B+"px;"+(r||"")))};this.drawSingleLineMarker=function(h,g,m,q,r,B){if(this.session.$bidiHandler.isBidiRow(g.start.row))return this.drawBidiSingleLineMarker(h,
g,m,q,r,B);h=q.lineHeight;r=(g.end.column+(r||0)-g.start.column)*q.characterWidth;var D=this.$getTop(g.start.row,q);this.elt(m,"height:"+h+"px;width:"+r+"px;top:"+D+"px;left:"+(this.$padding+g.start.column*q.characterWidth)+"px;"+(B||""))};this.drawBidiSingleLineMarker=function(h,g,m,q,r,B){var D=q.lineHeight,F=this.$getTop(g.start.row,q),G=this.$padding;this.session.$bidiHandler.getSelections(g.start.column,g.end.column).forEach(function(N){this.elt(m,"height:"+D+"px;width:"+N.width+(r||0)+"px;top:"+
F+"px;left:"+(G+N.left)+"px;"+(B||""))},this)};this.drawFullLineMarker=function(h,g,m,q,r){h=this.$getTop(g.start.row,q);var B=q.lineHeight;g.start.row!=g.end.row&&(B+=this.$getTop(g.end.row,q)-h);this.elt(m,"height:"+B+"px;top:"+h+"px;left:0;right:0;"+(r||""))};this.drawScreenLineMarker=function(h,g,m,q,r){h=this.$getTop(g.start.row,q);this.elt(m,"height:"+q.lineHeight+"px;top:"+h+"px;left:0;right:0;"+(r||""))}}).call(l.prototype);b.Marker=l});
define("ace/layer/text","require exports module ace/lib/oop ace/lib/dom ace/lib/lang ace/layer/lines ace/lib/event_emitter".split(" "),function(a,b){function l(q){this.dom=f;this.element=this.dom.createElement("div");this.element.className="ace_layer ace_text-layer";q.appendChild(this.element);this.$updateEolChar=this.$updateEolChar.bind(this);this.$lines=new g(this.element)}var e=a("../lib/oop"),f=a("../lib/dom"),h=a("../lib/lang"),g=a("./lines").Lines,m=a("../lib/event_emitter").EventEmitter;(function(){e.implement(this,
m);this.EOF_CHAR="\u00b6";this.EOL_CHAR_LF="\u00ac";this.EOL_CHAR_CRLF="\u00a4";this.EOL_CHAR=this.EOL_CHAR_LF;this.TAB_CHAR="\u2014";this.SPACE_CHAR="\u00b7";this.$padding=0;this.MAX_LINE_LENGTH=1E4;this.$updateEolChar=function(){var q=this.session.doc;q="\n"==q.getNewLineCharacter()&&"windows"!=q.getNewLineMode()?this.EOL_CHAR_LF:this.EOL_CHAR_CRLF;if(this.EOL_CHAR!=q)return this.EOL_CHAR=q,!0};this.setPadding=function(q){this.$padding=q;this.element.style.margin="0 "+q+"px"};this.getLineHeight=
function(){return this.$fontMetrics.$characterSize.height||0};this.getCharacterWidth=function(){return this.$fontMetrics.$characterSize.width||0};this.$setFontMetrics=function(q){this.$fontMetrics=q;this.$fontMetrics.on("changeCharacterSize",function(r){this._signal("changeCharacterSize",r)}.bind(this));this.$pollSizeChanges()};this.checkForSizeChanges=function(){this.$fontMetrics.checkForSizeChanges()};this.$pollSizeChanges=function(){return this.$pollSizeChangesTimer=this.$fontMetrics.$pollSizeChanges()};
this.setSession=function(q){(this.session=q)&&this.$computeTabString()};this.showEOL=this.showTabs=this.showSpaces=this.showInvisibles=!1;this.setShowInvisibles=function(q){if(this.showInvisibles==q)return!1;this.showInvisibles=q;"string"==typeof q?(this.showSpaces=/tab/i.test(q),this.showTabs=/space/i.test(q),this.showEOL=/eol/i.test(q)):this.showSpaces=this.showTabs=this.showEOL=q;this.$computeTabString();return!0};this.displayIndentGuides=!0;this.setDisplayIndentGuides=function(q){if(this.displayIndentGuides==
q)return!1;this.displayIndentGuides=q;this.$computeTabString();return!0};this.$tabStrings=[];this.onChangeTabSize=this.$computeTabString=function(){var q=this.session.getTabSize();this.tabSize=q;for(var r=this.$tabStrings=[0],B=1;B<q+1;B++)if(this.showTabs){var D=this.dom.createElement("span");D.className="ace_invisible ace_invisible_tab";D.textContent=h.stringRepeat(this.TAB_CHAR,B);r.push(D)}else r.push(this.dom.createTextNode(h.stringRepeat(" ",B),this.element));if(this.displayIndentGuides){this.$indentGuideRe=
/\s\S| \t|\t |\s$/;q=this.showSpaces?" ace_invisible ace_invisible_space":"";r=this.showSpaces?h.stringRepeat(this.SPACE_CHAR,this.tabSize):h.stringRepeat(" ",this.tabSize);B=this.showTabs?" ace_invisible ace_invisible_tab":"";var F=this.showTabs?h.stringRepeat(this.TAB_CHAR,this.tabSize):r;D=this.dom.createElement("span");D.className="ace_indent-guide"+q;D.textContent=r;this.$tabStrings[" "]=D;D=this.dom.createElement("span");D.className="ace_indent-guide"+B;D.textContent=F;this.$tabStrings["\t"]=
D}};this.updateLines=function(q,r,B){if(this.config.lastRow!=q.lastRow||this.config.firstRow!=q.firstRow)return this.update(q);this.config=q;var D=Math.max(r,q.firstRow);r=Math.min(B,q.lastRow);var F=this.element.childNodes;B=0;for(var G=q.firstRow;G<D;G++){var N=this.session.getFoldLine(G);if(N)if(N.containsRow(D)){D=N.start.row;break}else G=N.end.row;B++}var T=!1;G=D;for(D=(N=this.session.getNextFoldLine(G))?N.start.row:Infinity;;){G>D&&(G=N.end.row+1,D=(N=this.session.getNextFoldLine(G,N))?N.start.row:
Infinity);if(G>r)break;var V=F[B++];if(V){this.dom.removeChildren(V);this.$renderLine(V,G,G==D?N:!1);T&&(V.style.top=this.$lines.computeLineTop(G,q,this.session)+"px");var E=q.lineHeight*this.session.getRowLength(G)+"px";V.style.height!=E&&(T=!0,V.style.height=E)}G++}if(T)for(;B<this.$lines.cells.length;)r=this.$lines.cells[B++],r.element.style.top=this.$lines.computeLineTop(r.row,q,this.session)+"px"};this.scrollLines=function(q){var r=this.config;this.config=q;if(this.$lines.pageChanged(r,q))return this.update(q);
this.$lines.moveContainer(q);var B=q.lastRow,D=r?r.lastRow:-1;if(!r||D<q.firstRow||B<r.firstRow||!r||r.lastRow<q.firstRow||q.lastRow<r.firstRow)return this.update(q);if(r.firstRow<q.firstRow)for(B=this.session.getFoldedRowCount(r.firstRow,q.firstRow-1);0<B;B--)this.$lines.shift();if(r.lastRow>q.lastRow)for(B=this.session.getFoldedRowCount(q.lastRow+1,r.lastRow);0<B;B--)this.$lines.pop();q.firstRow<r.firstRow&&this.$lines.unshift(this.$renderLinesFragment(q,q.firstRow,r.firstRow-1));q.lastRow>r.lastRow&&
this.$lines.push(this.$renderLinesFragment(q,r.lastRow+1,q.lastRow))};this.$renderLinesFragment=function(q,r,B){for(var D=[],F=this.session.getNextFoldLine(r),G=F?F.start.row:Infinity;;){r>G&&(r=F.end.row+1,G=(F=this.session.getNextFoldLine(r,F))?F.start.row:Infinity);if(r>B)break;var N=this.$lines.createCell(r,q,this.session),T=N.element;this.dom.removeChildren(T);f.setStyle(T.style,"height",this.$lines.computeLineHeight(r,q,this.session)+"px");f.setStyle(T.style,"top",this.$lines.computeLineTop(r,
q,this.session)+"px");this.$renderLine(T,r,r==G?F:!1);this.$useLineGroups()?T.className="ace_line_group":T.className="ace_line";D.push(N);r++}return D};this.update=function(q){this.$lines.moveContainer(q);this.config=q;for(var r=q.firstRow,B=q.lastRow,D=this.$lines;D.getLength();)D.pop();D.push(this.$renderLinesFragment(q,r,B))};this.$textToken={text:!0,rparen:!0,lparen:!0};this.$renderToken=function(q,r,B,D){for(var F=/(\t)|( +)|([\x00-\x1f\x80-\xa0\xad\u1680\u180E\u2000-\u200f\u2028\u2029\u202F\u205F\uFEFF\uFFF9-\uFFFC]+)|(\u3000)|([\u1100-\u115F\u11A3-\u11A7\u11FA-\u11FF\u2329-\u232A\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3001-\u303E\u3041-\u3096\u3099-\u30FF\u3105-\u312D\u3131-\u318E\u3190-\u31BA\u31C0-\u31E3\u31F0-\u321E\u3220-\u3247\u3250-\u32FE\u3300-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFAFF\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFF01-\uFF60\uFFE0-\uFFE6]|[\uD800-\uDBFF][\uDC00-\uDFFF])/g,
G=this.dom.createFragment(this.element),N,T=0;N=F.exec(D);){var V=N[1],E=N[2],Q=N[3],aa=N[4],qa=N[5];if(this.showSpaces||!E){var P=T!=N.index?D.slice(T,N.index):"";T=N.index+N[0].length;P&&G.appendChild(this.dom.createTextNode(P,this.element));V?(E=this.session.getScreenTabSize(r+N.index),G.appendChild(this.$tabStrings[E].cloneNode(!0)),r+=E-1):E?this.showSpaces?(N=this.dom.createElement("span"),N.className="ace_invisible ace_invisible_space",N.textContent=h.stringRepeat(this.SPACE_CHAR,E.length),
G.appendChild(N)):G.appendChild(this.com.createTextNode(E,this.element)):Q?(N=this.dom.createElement("span"),N.className="ace_invisible ace_invisible_space ace_invalid",N.textContent=h.stringRepeat(this.SPACE_CHAR,Q.length),G.appendChild(N)):aa?(r+=1,N=this.dom.createElement("span"),N.style.width=2*this.config.characterWidth+"px",N.className=this.showSpaces?"ace_cjk ace_invisible ace_invisible_space":"ace_cjk",N.textContent=this.showSpaces?this.SPACE_CHAR:aa,G.appendChild(N)):qa&&(r+=1,N=this.dom.createElement("span"),
N.style.width=2*this.config.characterWidth+"px",N.className="ace_cjk",N.textContent=qa,G.appendChild(N))}}G.appendChild(this.dom.createTextNode(T?D.slice(T):D,this.element));this.$textToken[B.type]?q.appendChild(G):(F="ace_"+B.type.replace(/\./g," ace_"),N=this.dom.createElement("span"),"fold"==B.type&&(N.style.width=B.value.length*this.config.characterWidth+"px"),N.className=F,N.appendChild(G),q.appendChild(N));return r+D.length};this.renderIndentGuide=function(q,r,B){var D=r.search(this.$indentGuideRe);
if(0>=D||D>=B)return r;if(" "==r[0]){D-=D%this.tabSize;B=D/this.tabSize;for(var F=0;F<B;F++)q.appendChild(this.$tabStrings[" "].cloneNode(!0));return r.substr(D)}if("\t"==r[0]){for(F=0;F<D;F++)q.appendChild(this.$tabStrings["\t"].cloneNode(!0));return r.substr(D)}return r};this.$createLineElement=function(){var q=this.dom.createElement("div");q.className="ace_line";q.style.height=this.config.lineHeight+"px";return q};this.$renderWrappedLine=function(q,r,B){var D=0,F=0,G=B[0],N=0,T=this.$createLineElement();
q.appendChild(T);for(var V=0;V<r.length;V++){var E=r[V],Q=E.value;if(0==V&&this.displayIndentGuides){D=Q.length;Q=this.renderIndentGuide(T,Q,G);if(!Q)continue;D-=Q.length}if(D+Q.length<G)N=this.$renderToken(T,N,E,Q),D+=Q.length;else{for(;D+Q.length>=G;)this.$renderToken(T,N,E,Q.substring(0,G-D)),Q=Q.substring(G-D),D=G,T=this.$createLineElement(),q.appendChild(T),T.appendChild(this.dom.createTextNode(h.stringRepeat("\u00a0",B.indent),this.element)),F++,N=0,G=B[F]||Number.MAX_VALUE;0!=Q.length&&(D+=
Q.length,N=this.$renderToken(T,N,E,Q))}}B[B.length-1]>this.MAX_LINE_LENGTH&&this.$renderOverflowMessage(T,N,null,"",!0)};this.$renderSimpleLine=function(q,r){var B=0,D=r[0],F=D.value;this.displayIndentGuides&&(F=this.renderIndentGuide(q,F));F&&(B=this.$renderToken(q,B,D,F));for(var G=1;G<r.length;G++){D=r[G];F=D.value;if(B+F.length>this.MAX_LINE_LENGTH)return this.$renderOverflowMessage(q,B,D,F);B=this.$renderToken(q,B,D,F)}};this.$renderOverflowMessage=function(q,r,B,D,F){B&&this.$renderToken(q,
r,B,D.slice(0,this.MAX_LINE_LENGTH-r));r=this.dom.createElement("span");r.className="ace_inline_button ace_keyword ace_toggle_wrap";r.textContent=F?"<hide>":"<click to see more...>";q.appendChild(r)};this.$renderLine=function(q,r,B){B||0==B||(B=this.session.getFoldLine(r));var D=B?this.$getFoldLineTokens(r,B):this.session.getTokens(r),F=q;D.length?(F=this.session.getRowSplitData(r))&&F.length?(this.$renderWrappedLine(q,D,F),F=q.lastChild):(F=q,this.$useLineGroups()&&(F=this.$createLineElement(),q.appendChild(F)),
this.$renderSimpleLine(F,D)):this.$useLineGroups()&&(F=this.$createLineElement(),q.appendChild(F));this.showEOL&&F&&(B&&(r=B.end.row),q=this.dom.createElement("span"),q.className="ace_invisible ace_invisible_eol",q.textContent=r==this.session.getLength()-1?this.EOF_CHAR:this.EOL_CHAR,F.appendChild(q))};this.$getFoldLineTokens=function(q,r){var B=this.session,D=[],F=B.getTokens(q);r.walk(function(G,N,T,V,E){if(null!=G)D.push({type:"fold",value:G});else if(E&&(F=B.getTokens(N)),F.length)a:{G=F;for(E=
N=0;E+G[N].value.length<V;)if(E+=G[N].value.length,N++,N==G.length)break a;if(E!=V){var Q=G[N].value.substring(V-E);Q.length>T-V&&(Q=Q.substring(0,T-V));D.push({type:G[N].type,value:Q});E=V+Q.length;N+=1}for(;E<T&&N<G.length;)Q=G[N].value,Q.length+E>T?D.push({type:G[N].type,value:Q.substring(0,T-E)}):D.push(G[N]),E+=Q.length,N+=1}},r.end.row,this.session.getLine(r.end.row).length);return D};this.$useLineGroups=function(){return this.session.getUseWrapMode()};this.destroy=function(){}}).call(l.prototype);
b.Text=l});
define("ace/layer/cursor",["require","exports","module","ace/lib/dom"],function(a,b){function l(f){this.element=e.createElement("div");this.element.className="ace_layer ace_cursor-layer";f.appendChild(this.element);this.isVisible=!1;this.isBlinking=!0;this.blinkInterval=1E3;this.smoothBlinking=!1;this.cursors=[];this.cursor=this.addCursor();e.addCssClass(this.element,"ace_hidden-cursors");this.$updateCursors=this.$updateOpacity.bind(this)}var e=a("../lib/dom");(function(){this.$updateOpacity=function(f){for(var h=
this.cursors,g=h.length;g--;)e.setStyle(h[g].style,"opacity",f?"":"0")};this.$startCssAnimation=function(){for(var f=this.cursors,h=f.length;h--;)f[h].style.animationDuration=this.blinkInterval+"ms";setTimeout(function(){e.addCssClass(this.element,"ace_animate-blinking")}.bind(this))};this.$stopCssAnimation=function(){e.removeCssClass(this.element,"ace_animate-blinking")};this.$padding=0;this.setPadding=function(f){this.$padding=f};this.setSession=function(f){this.session=f};this.setBlinking=function(f){f!=
this.isBlinking&&(this.isBlinking=f,this.restartTimer())};this.setBlinkInterval=function(f){f!=this.blinkInterval&&(this.blinkInterval=f,this.restartTimer())};this.setSmoothBlinking=function(f){f!=this.smoothBlinking&&(this.smoothBlinking=f,e.setCssClass(this.element,"ace_smooth-blinking",f),this.$updateCursors(!0),this.restartTimer())};this.addCursor=function(){var f=e.createElement("div");f.className="ace_cursor";this.element.appendChild(f);this.cursors.push(f);return f};this.removeCursor=function(){if(1<
this.cursors.length){var f=this.cursors.pop();f.parentNode.removeChild(f);return f}};this.hideCursor=function(){this.isVisible=!1;e.addCssClass(this.element,"ace_hidden-cursors");this.restartTimer()};this.showCursor=function(){this.isVisible=!0;e.removeCssClass(this.element,"ace_hidden-cursors");this.restartTimer()};this.restartTimer=function(){var f=this.$updateCursors;clearInterval(this.intervalId);clearTimeout(this.timeoutId);this.$stopCssAnimation();this.smoothBlinking&&e.removeCssClass(this.element,
"ace_smooth-blinking");f(!0);if(this.isBlinking&&this.blinkInterval&&this.isVisible)if(this.smoothBlinking&&setTimeout(function(){e.addCssClass(this.element,"ace_smooth-blinking")}.bind(this)),e.HAS_CSS_ANIMATION)this.$startCssAnimation();else{var h=function(){this.timeoutId=setTimeout(function(){f(!1)},.6*this.blinkInterval)}.bind(this);this.intervalId=setInterval(function(){f(!0);h()},this.blinkInterval);h()}else this.$stopCssAnimation()};this.getPixelPosition=function(f,h){if(!this.config||!this.session)return{left:0,
top:0};f||=this.session.selection.getCursor();var g=this.session.documentToScreenPosition(f);return{left:this.$padding+(this.session.$bidiHandler.isBidiRow(g.row,f.row)?this.session.$bidiHandler.getPosLeft(g.column):g.column*this.config.characterWidth),top:(g.row-(h?this.config.firstRowScreen:0))*this.config.lineHeight}};this.isCursorInView=function(f,h){return 0<=f.top&&f.top<h.maxHeight};this.update=function(f){this.config=f;var h=this.session.$selectionMarkers,g=0;if(void 0===h||0===h.length)h=
[{cursor:null}];var m=0;for(var q=h.length;m<q;m++){var r=this.getPixelPosition(h[m].cursor,!0);if(!((r.top>f.height+f.offset||0>r.top)&&1<m)){var B=this.cursors[g++]||this.addCursor(),D=B.style;this.drawCursor?this.drawCursor(B,r,f,h[m],this.session):this.isCursorInView(r,f)?(e.setStyle(D,"display","block"),e.translate(B,r.left,r.top),e.setStyle(D,"width",Math.round(f.characterWidth)+"px"),e.setStyle(D,"height",f.lineHeight+"px")):e.setStyle(D,"display","none")}}for(;this.cursors.length>g;)this.removeCursor();
f=this.session.getOverwrite();this.$setOverwrite(f);this.$pixelPos=r;this.restartTimer()};this.drawCursor=null;this.$setOverwrite=function(f){f!=this.overwrite&&((this.overwrite=f)?e.addCssClass(this.element,"ace_overwrite-cursors"):e.removeCssClass(this.element,"ace_overwrite-cursors"))};this.destroy=function(){clearInterval(this.intervalId);clearTimeout(this.timeoutId)}}).call(l.prototype);b.Cursor=l});
define("ace/scrollbar","require exports module ace/lib/oop ace/lib/dom ace/lib/event ace/lib/event_emitter".split(" "),function(a,b){function l(r,B){f.call(this,r);this.scrollLeft=0;this.height=B.$scrollbarWidth;this.inner.style.height=this.element.style.height=(this.height||15)+5+"px"}function e(r,B){f.call(this,r);this.scrollHeight=this.scrollTop=0;B.$scrollbarWidth=this.width=g.scrollbarWidth(r.ownerDocument);this.inner.style.width=this.element.style.width=(this.width||15)+5+"px";this.$minWidth=
0}function f(r){this.element=g.createElement("div");this.element.className="ace_scrollbar ace_scrollbar"+this.classSuffix;this.inner=g.createElement("div");this.inner.className="ace_scrollbar-inner";this.inner.textContent="\u00a0";this.element.appendChild(this.inner);r.appendChild(this.element);this.setVisible(!1);this.skipEvent=!1;m.addListener(this.element,"scroll",this.onScroll.bind(this));m.addListener(this.element,"mousedown",m.preventDefault)}var h=a("./lib/oop"),g=a("./lib/dom"),m=a("./lib/event"),
q=a("./lib/event_emitter").EventEmitter;(function(){h.implement(this,q);this.setVisible=function(r){this.element.style.display=r?"":"none";this.isVisible=r;this.coeff=1}}).call(f.prototype);h.inherits(e,f);(function(){this.classSuffix="-v";this.onScroll=function(){if(!this.skipEvent){this.scrollTop=this.element.scrollTop;if(1!=this.coeff){var r=this.element.clientHeight/this.scrollHeight;this.scrollTop=this.scrollTop*(1-r)/(this.coeff-r)}this._emit("scroll",{data:this.scrollTop})}this.skipEvent=!1};
this.getWidth=function(){return Math.max(this.isVisible?this.width:0,this.$minWidth||0)};this.setHeight=function(r){this.element.style.height=r+"px"};this.setInnerHeight=this.setScrollHeight=function(r){this.scrollHeight=r;32768<r?(this.coeff=32768/r,r=32768):1!=this.coeff&&(this.coeff=1);this.inner.style.height=r+"px"};this.setScrollTop=function(r){this.scrollTop!=r&&(this.skipEvent=!0,this.scrollTop=r,this.element.scrollTop=r*this.coeff)}}).call(e.prototype);h.inherits(l,f);(function(){this.classSuffix=
"-h";this.onScroll=function(){this.skipEvent||(this.scrollLeft=this.element.scrollLeft,this._emit("scroll",{data:this.scrollLeft}));this.skipEvent=!1};this.getHeight=function(){return this.isVisible?this.height:0};this.setWidth=function(r){this.element.style.width=r+"px"};this.setInnerWidth=function(r){this.inner.style.width=r+"px"};this.setScrollWidth=function(r){this.inner.style.width=r+"px"};this.setScrollLeft=function(r){this.scrollLeft!=r&&(this.skipEvent=!0,this.scrollLeft=this.element.scrollLeft=
r)}}).call(l.prototype);b.ScrollBar=e;b.ScrollBarV=e;b.ScrollBarH=l;b.VScrollBar=e;b.HScrollBar=l});
define("ace/renderloop",["require","exports","module","ace/lib/event"],function(a,b){function l(f,h){this.onRender=f;this.pending=!1;this.changes=0;this.$recursionLimit=2;this.window=h||window;var g=this;this._flush=function(){g.pending=!1;var m=g.changes;m&&(e.blockIdle(100),g.changes=0,g.onRender(m));g.changes?0>g.$recursionLimit--||g.schedule():g.$recursionLimit=2}}var e=a("./lib/event");(function(){this.schedule=function(f){(this.changes|=f)&&!this.pending&&(e.nextFrame(this._flush),this.pending=
!0)};this.clear=function(){var f=this.changes;this.changes=0;return f}}).call(l.prototype);b.RenderLoop=l});
define("ace/layer/font_metrics","require exports module ace/lib/oop ace/lib/dom ace/lib/lang ace/lib/event ace/lib/useragent ace/lib/event_emitter".split(" "),function(a,b){var l=a("../lib/oop"),e=a("../lib/dom"),f=a("../lib/lang"),h=a("../lib/event"),g=a("../lib/useragent"),m=a("../lib/event_emitter").EventEmitter,q="function"==typeof ResizeObserver;a=b.FontMetrics=function(r){this.el=e.createElement("div");this.$setMeasureNodeStyles(this.el.style,!0);this.$main=e.createElement("div");this.$setMeasureNodeStyles(this.$main.style);
this.$measureNode=e.createElement("div");this.$setMeasureNodeStyles(this.$measureNode.style);this.el.appendChild(this.$main);this.el.appendChild(this.$measureNode);r.appendChild(this.el);this.$measureNode.textContent=f.stringRepeat("X",256);this.$characterSize={width:0,height:0};q?this.$addObserver():this.checkForSizeChanges()};(function(){l.implement(this,m);this.$characterSize={width:0,height:0};this.$setMeasureNodeStyles=function(r,B){r.width=r.height="auto";r.left=r.top="0px";r.visibility="hidden";
r.position="absolute";r.whiteSpace="pre";8>g.isIE?r["font-family"]="inherit":r.font="inherit";r.overflow=B?"hidden":"visible"};this.checkForSizeChanges=function(r){void 0===r&&(r=this.$measureSizes());if(r&&(this.$characterSize.width!==r.width||this.$characterSize.height!==r.height)){this.$measureNode.style.fontWeight="bold";var B=this.$measureSizes();this.$measureNode.style.fontWeight="";this.$characterSize=r;this.charSizes=Object.create(null);this.allowBoldFonts=B&&B.width===r.width&&B.height===
r.height;this._emit("changeCharacterSize",{data:r})}};this.$addObserver=function(){var r=this;this.$observer=new window.ResizeObserver(function(){r.checkForSizeChanges()});this.$observer.observe(this.$measureNode)};this.$pollSizeChanges=function(){if(this.$pollSizeChangesTimer||this.$observer)return this.$pollSizeChangesTimer;var r=this;return this.$pollSizeChangesTimer=h.onIdle(function D(){r.checkForSizeChanges();h.onIdle(D,500)},500)};this.setPolling=function(r){r?this.$pollSizeChanges():this.$pollSizeChangesTimer&&
(clearInterval(this.$pollSizeChangesTimer),this.$pollSizeChangesTimer=0)};this.$measureSizes=function(r){r={height:(r||this.$measureNode).clientHeight,width:(r||this.$measureNode).clientWidth/256};return 0===r.width||0===r.height?null:r};this.$measureCharWidth=function(r){this.$main.textContent=f.stringRepeat(r,256);return this.$main.getBoundingClientRect().width/256};this.getCharacterWidth=function(r){var B=this.charSizes[r];void 0===B&&(B=this.charSizes[r]=this.$measureCharWidth(r)/this.$characterSize.width);
return B};this.destroy=function(){clearInterval(this.$pollSizeChangesTimer);this.$observer&&this.$observer.disconnect();this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el)};this.$getZoom=function D(B){return B?(window.getComputedStyle(B).zoom||1)*D(B.parentElement):1};this.$initTransformMeasureNodes=function(){function B(D,F){return["div",{style:"position: absolute;top:"+D+"px;left:"+F+"px;"}]}this.els=e.buildDom([B(0,0),B(200,0),B(0,200),B(200,200)],this.el)};this.transformCoordinates=
function(B,D){function F(P,ea,ua){var Fa=P[1]*ea[0]-P[0]*ea[1];return[(-ea[1]*ua[0]+ea[0]*ua[1])/Fa,(+P[1]*ua[0]-P[0]*ua[1])/Fa]}function G(P,ea){return[P[0]-ea[0],P[1]-ea[1]]}function N(P,ea){return[P[0]+ea[0],P[1]+ea[1]]}function T(P,ea){return[P*ea[0],P*ea[1]]}function V(P){P=P.getBoundingClientRect();return[P.left,P.top]}if(B){var E=this.$getZoom(this.el);B=T(1/E,B)}this.els||this.$initTransformMeasureNodes();E=V(this.els[0]);var Q=V(this.els[1]),aa=V(this.els[2]),qa=V(this.els[3]);qa=F(G(qa,
Q),G(qa,aa),G(N(Q,aa),N(qa,E)));Q=T(1+qa[0],G(Q,E));aa=T(1+qa[1],G(aa,E));if(D)return B=qa[0]*D[0]/200+qa[1]*D[1]/200+1,D=N(T(D[0],Q),T(D[1],aa)),N(T(1/B/200,D),E);D=G(B,E);D=F(G(Q,T(qa[0],D)),G(aa,T(qa[1],D)),D);return T(200,D)}}).call(a.prototype)});
define("ace/virtual_renderer","require exports module ace/lib/oop ace/lib/dom ace/config ace/layer/gutter ace/layer/marker ace/layer/text ace/layer/cursor ace/scrollbar ace/scrollbar ace/renderloop ace/layer/font_metrics ace/lib/event_emitter ace/lib/useragent".split(" "),function(a,b){function l(E,Q){var aa=this;this.container=E||f.createElement("div");f.addCssClass(this.container,"ace_editor");f.HI_DPI&&f.addCssClass(this.container,"ace_hidpi");this.setTheme(Q);this.$gutter=f.createElement("div");
this.$gutter.className="ace_gutter";this.container.appendChild(this.$gutter);this.$gutter.setAttribute("aria-hidden",!0);this.scroller=f.createElement("div");this.scroller.className="ace_scroller";this.container.appendChild(this.scroller);this.content=f.createElement("div");this.content.className="ace_content";this.scroller.appendChild(this.content);this.$gutterLayer=new g(this.$gutter);this.$gutterLayer.on("changeGutterWidth",this.onGutterResize.bind(this));this.$markerBack=new m(this.content);this.canvas=
(this.$textLayer=new q(this.content)).element;this.$markerFront=new m(this.content);this.$cursorLayer=new r(this.content);this.$vScroll=this.$horizScroll=!1;this.scrollBar=this.scrollBarV=new D(this.container,this);this.scrollBarH=new B(this.container,this);this.scrollBarV.on("scroll",function(qa){aa.$scrollAnimation||aa.session.setScrollTop(qa.data-aa.scrollMargin.top)});this.scrollBarH.on("scroll",function(qa){aa.$scrollAnimation||aa.session.setScrollLeft(qa.data-aa.scrollMargin.left)});this.scrollLeft=
this.scrollTop=0;this.cursorPos={row:0,column:0};this.$fontMetrics=new G(this.container);this.$textLayer.$setFontMetrics(this.$fontMetrics);this.$textLayer.on("changeCharacterSize",function(qa){aa.updateCharacterSize();aa.onResize(!0,aa.gutterWidth,aa.$size.width,aa.$size.height);aa._signal("changeCharacterSize",qa)});this.$size={width:0,height:0,scrollerHeight:0,scrollerWidth:0,$dirty:!0};this.layerConfig={width:1,padding:0,firstRow:0,firstRowScreen:0,lastRow:0,lineHeight:0,characterWidth:0,minHeight:1,
maxHeight:1,offset:0,height:1,gutterOffset:1};this.scrollMargin={left:0,right:0,top:0,bottom:0,v:0,h:0};this.margin={left:0,right:0,top:0,bottom:0,v:0,h:0};this.$keepTextAreaAtCursor=!T.isIOS;this.$loop=new F(this.$renderChanges.bind(this),this.container.ownerDocument.defaultView);this.$loop.schedule(this.CHANGE_FULL);this.updateCharacterSize();this.setPadding(4);h.resetOptions(this);h._signal("renderer",this)}var e=a("./lib/oop"),f=a("./lib/dom"),h=a("./config"),g=a("./layer/gutter").Gutter,m=a("./layer/marker").Marker,
q=a("./layer/text").Text,r=a("./layer/cursor").Cursor,B=a("./scrollbar").HScrollBar,D=a("./scrollbar").VScrollBar,F=a("./renderloop").RenderLoop,G=a("./layer/font_metrics").FontMetrics,N=a("./lib/event_emitter").EventEmitter,T=a("./lib/useragent"),V=T.isIE;f.importCssString('.ace_br1 {border-top-left-radius    : 3px;}.ace_br2 {border-top-right-radius   : 3px;}.ace_br3 {border-top-left-radius    : 3px; border-top-right-radius:    3px;}.ace_br4 {border-bottom-right-radius: 3px;}.ace_br5 {border-top-left-radius    : 3px; border-bottom-right-radius: 3px;}.ace_br6 {border-top-right-radius   : 3px; border-bottom-right-radius: 3px;}.ace_br7 {border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px;}.ace_br8 {border-bottom-left-radius : 3px;}.ace_br9 {border-top-left-radius    : 3px; border-bottom-left-radius:  3px;}.ace_br10{border-top-right-radius   : 3px; border-bottom-left-radius:  3px;}.ace_br11{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-left-radius:  3px;}.ace_br12{border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br13{border-top-left-radius    : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br14{border-top-right-radius   : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br15{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;}.ace_editor {position: relative;overflow: hidden;padding: 0;font: 12px/normal \'Monaco\', \'Menlo\', \'Ubuntu Mono\', \'Consolas\', \'source-code-pro\', monospace;direction: ltr;text-align: left;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);}.ace_scroller {position: absolute;overflow: hidden;top: 0;bottom: 0;background-color: inherit;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;cursor: text;}.ace_content {position: absolute;box-sizing: border-box;min-width: 100%;contain: style size layout;font-variant-ligatures: no-common-ligatures;}.ace_dragging .ace_scroller:before{position: absolute;top: 0;left: 0;right: 0;bottom: 0;content: \'\';background: rgba(250, 250, 250, 0.01);z-index: 1000;}.ace_dragging.ace_dark .ace_scroller:before{background: rgba(0, 0, 0, 0.01);}.ace_selecting, .ace_selecting * {cursor: text !important;}.ace_gutter {position: absolute;overflow : hidden;width: auto;top: 0;bottom: 0;left: 0;cursor: default;z-index: 4;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;contain: style size layout;}.ace_gutter-active-line {position: absolute;left: 0;right: 0;}.ace_scroller.ace_scroll-left {box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;}.ace_gutter-cell {position: absolute;top: 0;left: 0;right: 0;padding-left: 19px;padding-right: 6px;background-repeat: no-repeat;}.ace_gutter-cell.ace_error {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: 2px center;}.ace_gutter-cell.ace_warning {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==");background-position: 2px center;}.ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=");background-position: 2px center;}.ace_dark .ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC");}.ace_scrollbar {contain: strict;position: absolute;right: 0;bottom: 0;z-index: 6;}.ace_scrollbar-inner {position: absolute;cursor: text;left: 0;top: 0;}.ace_scrollbar-v{overflow-x: hidden;overflow-y: scroll;top: 0;}.ace_scrollbar-h {overflow-x: scroll;overflow-y: hidden;left: 0;}.ace_print-margin {position: absolute;height: 100%;}.ace_text-input {position: absolute;z-index: 0;width: 0.5em;height: 1em;opacity: 0;background: transparent;-moz-appearance: none;appearance: none;border: none;resize: none;outline: none;overflow: hidden;font: inherit;padding: 0 1px;margin: 0 -1px;contain: strict;-ms-user-select: text;-moz-user-select: text;-webkit-user-select: text;user-select: text;white-space: pre!important;}.ace_text-input.ace_composition {background: transparent;color: inherit;z-index: 1000;opacity: 1;}.ace_composition_placeholder { color: transparent }.ace_composition_marker { border-bottom: 1px solid;position: absolute;border-radius: 0;margin-top: 1px;}[ace_nocontext=true] {transform: none!important;filter: none!important;clip-path: none!important;mask : none!important;contain: none!important;perspective: none!important;mix-blend-mode: initial!important;z-index: auto;}.ace_layer {z-index: 1;position: absolute;overflow: hidden;word-wrap: normal;white-space: pre;height: 100%;width: 100%;box-sizing: border-box;pointer-events: none;}.ace_gutter-layer {position: relative;width: auto;text-align: right;pointer-events: auto;height: 1000000px;contain: style size layout;}.ace_text-layer {font: inherit !important;position: absolute;height: 1000000px;width: 1000000px;contain: style size layout;}.ace_text-layer > .ace_line, .ace_text-layer > .ace_line_group {contain: style size layout;position: absolute;top: 0;left: 0;right: 0;}.ace_hidpi .ace_text-layer,.ace_hidpi .ace_gutter-layer,.ace_hidpi .ace_content,.ace_hidpi .ace_gutter {contain: strict;will-change: transform;}.ace_hidpi .ace_text-layer > .ace_line, .ace_hidpi .ace_text-layer > .ace_line_group {contain: strict;}.ace_cjk {display: inline-block;text-align: center;}.ace_cursor-layer {z-index: 4;}.ace_cursor {z-index: 4;position: absolute;box-sizing: border-box;border-left: 2px solid;transform: translatez(0);}.ace_multiselect .ace_cursor {border-left-width: 1px;}.ace_slim-cursors .ace_cursor {border-left-width: 1px;}.ace_overwrite-cursors .ace_cursor {border-left-width: 0;border-bottom: 1px solid;}.ace_hidden-cursors .ace_cursor {opacity: 0.2;}.ace_hasPlaceholder .ace_hidden-cursors .ace_cursor {opacity: 0;}.ace_smooth-blinking .ace_cursor {transition: opacity 0.18s;}.ace_animate-blinking .ace_cursor {animation-duration: 1000ms;animation-timing-function: step-end;animation-name: blink-ace-animate;animation-iteration-count: infinite;}.ace_animate-blinking.ace_smooth-blinking .ace_cursor {animation-duration: 1000ms;animation-timing-function: ease-in-out;animation-name: blink-ace-animate-smooth;}@keyframes blink-ace-animate {from, to { opacity: 1; }60% { opacity: 0; }}@keyframes blink-ace-animate-smooth {from, to { opacity: 1; }45% { opacity: 1; }60% { opacity: 0; }85% { opacity: 0; }}.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {position: absolute;z-index: 3;}.ace_marker-layer .ace_selection {position: absolute;z-index: 5;}.ace_marker-layer .ace_bracket {position: absolute;z-index: 6;}.ace_marker-layer .ace_error_bracket {position: absolute;border-bottom: 1px solid #DE5555;border-radius: 0;}.ace_marker-layer .ace_active-line {position: absolute;z-index: 2;}.ace_marker-layer .ace_selected-word {position: absolute;z-index: 4;box-sizing: border-box;}.ace_line .ace_fold {box-sizing: border-box;display: inline-block;height: 11px;margin-top: -2px;vertical-align: middle;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=");background-repeat: no-repeat, repeat-x;background-position: center center, top left;color: transparent;border: 1px solid black;border-radius: 2px;cursor: pointer;pointer-events: auto;}.ace_dark .ace_fold {}.ace_fold:hover{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC");}.ace_tooltip {background-color: #FFF;background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));border: 1px solid gray;border-radius: 1px;box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);color: black;max-width: 100%;padding: 3px 4px;position: fixed;z-index: 999999;box-sizing: border-box;cursor: default;white-space: pre;word-wrap: break-word;line-height: normal;font-style: normal;font-weight: normal;letter-spacing: normal;pointer-events: none;}.ace_folding-enabled > .ace_gutter-cell {padding-right: 13px;}.ace_fold-widget {box-sizing: border-box;margin: 0 -12px 0 1px;display: none;width: 11px;vertical-align: top;background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: center;border-radius: 3px;border: 1px solid transparent;cursor: pointer;}.ace_folding-enabled .ace_fold-widget {display: inline-block;   }.ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==");}.ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==");}.ace_fold-widget:hover {border: 1px solid rgba(0, 0, 0, 0.3);background-color: rgba(255, 255, 255, 0.2);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);}.ace_fold-widget:active {border: 1px solid rgba(0, 0, 0, 0.4);background-color: rgba(0, 0, 0, 0.05);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);}.ace_dark .ace_fold-widget {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC");}.ace_dark .ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget:hover {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);background-color: rgba(255, 255, 255, 0.1);}.ace_dark .ace_fold-widget:active {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);}.ace_inline_button {border: 1px solid lightgray;display: inline-block;margin: -1px 8px;padding: 0 5px;pointer-events: auto;cursor: pointer;}.ace_inline_button:hover {border-color: gray;background: rgba(200,200,200,0.2);display: inline-block;pointer-events: auto;}.ace_fold-widget.ace_invalid {background-color: #FFB4B4;border-color: #DE5555;}.ace_fade-fold-widgets .ace_fold-widget {transition: opacity 0.4s ease 0.05s;opacity: 0;}.ace_fade-fold-widgets:hover .ace_fold-widget {transition: opacity 0.05s ease 0.05s;opacity:1;}.ace_underline {text-decoration: underline;}.ace_bold {font-weight: bold;}.ace_nobold .ace_bold {font-weight: normal;}.ace_italic {font-style: italic;}.ace_error-marker {background-color: rgba(255, 0, 0,0.2);position: absolute;z-index: 9;}.ace_highlight-marker {background-color: rgba(255, 255, 0,0.2);position: absolute;z-index: 8;}.ace_mobile-menu {position: absolute;line-height: 1.5;border-radius: 4px;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;background: white;box-shadow: 1px 3px 2px grey;border: 1px solid #dcdcdc;color: black;}.ace_dark > .ace_mobile-menu {background: #333;color: #ccc;box-shadow: 1px 3px 2px grey;border: 1px solid #444;}.ace_mobile-button {padding: 2px;cursor: pointer;overflow: hidden;}.ace_mobile-button:hover {background-color: #eee;opacity:1;}.ace_mobile-button:active {background-color: #ddd;}.ace_placeholder {font-family: arial;transform: scale(0.9);transform-origin: left;white-space: pre;opacity: 0.7;margin: 0 10px;}',
"ace_editor.css");(function(){this.CHANGE_CURSOR=1;this.CHANGE_MARKER=2;this.CHANGE_GUTTER=4;this.CHANGE_SCROLL=8;this.CHANGE_LINES=16;this.CHANGE_TEXT=32;this.CHANGE_SIZE=64;this.CHANGE_MARKER_BACK=128;this.CHANGE_MARKER_FRONT=256;this.CHANGE_FULL=512;this.CHANGE_H_SCROLL=1024;e.implement(this,N);this.updateCharacterSize=function(){this.$textLayer.allowBoldFonts!=this.$allowBoldFonts&&(this.$allowBoldFonts=this.$textLayer.allowBoldFonts,this.setStyle("ace_nobold",!this.$allowBoldFonts));this.layerConfig.characterWidth=
this.characterWidth=this.$textLayer.getCharacterWidth();this.layerConfig.lineHeight=this.lineHeight=this.$textLayer.getLineHeight();this.$updatePrintMargin();f.setStyle(this.scroller.style,"line-height",this.lineHeight+"px")};this.setSession=function(E){this.session&&this.session.doc.off("changeNewLineMode",this.onChangeNewLineMode);(this.session=E)&&this.scrollMargin.top&&0>=E.getScrollTop()&&E.setScrollTop(-this.scrollMargin.top);this.$cursorLayer.setSession(E);this.$markerBack.setSession(E);this.$markerFront.setSession(E);
this.$gutterLayer.setSession(E);this.$textLayer.setSession(E);E&&(this.$loop.schedule(this.CHANGE_FULL),this.session.$setFontMetrics(this.$fontMetrics),this.scrollBarH.scrollLeft=this.scrollBarV.scrollTop=null,this.onChangeNewLineMode=this.onChangeNewLineMode.bind(this),this.onChangeNewLineMode(),this.session.doc.on("changeNewLineMode",this.onChangeNewLineMode))};this.updateLines=function(E,Q,aa){void 0===Q&&(Q=Infinity);this.$changedLines?(this.$changedLines.firstRow>E&&(this.$changedLines.firstRow=
E),this.$changedLines.lastRow<Q&&(this.$changedLines.lastRow=Q)):this.$changedLines={firstRow:E,lastRow:Q};if(this.$changedLines.lastRow<this.layerConfig.firstRow)if(aa)this.$changedLines.lastRow=this.layerConfig.lastRow;else return;this.$changedLines.firstRow>this.layerConfig.lastRow||this.$loop.schedule(this.CHANGE_LINES)};this.onChangeNewLineMode=function(){this.$loop.schedule(this.CHANGE_TEXT);this.$textLayer.$updateEolChar();this.session.$bidiHandler.setEolChar(this.$textLayer.EOL_CHAR)};this.onChangeTabSize=
function(){this.$loop.schedule(this.CHANGE_TEXT|this.CHANGE_MARKER);this.$textLayer.onChangeTabSize()};this.updateText=function(){this.$loop.schedule(this.CHANGE_TEXT)};this.updateFull=function(E){E?this.$renderChanges(this.CHANGE_FULL,!0):this.$loop.schedule(this.CHANGE_FULL)};this.updateFontSize=function(){this.$textLayer.checkForSizeChanges()};this.$changes=0;this.$updateSizeAsync=function(){if(this.$loop.pending)this.$size.$dirty=!0;else this.onResize()};this.onResize=function(E,Q,aa,qa){if(!(2<
this.resizing)){0<this.resizing?this.resizing++:this.resizing=E?1:0;var P=this.container;qa||=P.clientHeight||P.scrollHeight;aa||=P.clientWidth||P.scrollWidth;Q=this.$updateCachedSize(E,Q,aa,qa);if(!this.$size.scrollerHeight||!aa&&!qa)return this.resizing=0;E&&(this.$gutterLayer.$padding=null);E?this.$renderChanges(Q|this.$changes,!0):this.$loop.schedule(Q|this.$changes);this.resizing&&(this.resizing=0);this.scrollBarV.scrollLeft=this.scrollBarV.scrollTop=null}};this.$updateCachedSize=function(E,
Q,aa,qa){qa-=this.$extraHeight||0;var P=0,ea=this.$size,ua={width:ea.width,height:ea.height,scrollerHeight:ea.scrollerHeight,scrollerWidth:ea.scrollerWidth};qa&&(E||ea.height!=qa)&&(ea.height=qa,P|=this.CHANGE_SIZE,ea.scrollerHeight=ea.height,this.$horizScroll&&(ea.scrollerHeight-=this.scrollBarH.getHeight()),this.scrollBarV.element.style.bottom=this.scrollBarH.getHeight()+"px",P|=this.CHANGE_SCROLL);aa&&(E||ea.width!=aa)&&(P|=this.CHANGE_SIZE,ea.width=aa,null==Q&&(Q=this.$showGutter?this.$gutter.offsetWidth:
0),this.gutterWidth=Q,f.setStyle(this.scrollBarH.element.style,"left",Q+"px"),f.setStyle(this.scroller.style,"left",Q+this.margin.left+"px"),ea.scrollerWidth=Math.max(0,aa-Q-this.scrollBarV.getWidth()-this.margin.h),f.setStyle(this.$gutter.style,"left",this.margin.left+"px"),Q=this.scrollBarV.getWidth()+"px",f.setStyle(this.scrollBarH.element.style,"right",Q),f.setStyle(this.scroller.style,"right",Q),f.setStyle(this.scroller.style,"bottom",this.scrollBarH.getHeight()),this.session&&this.session.getUseWrapMode()&&
this.adjustWrapLimit()||E)&&(P|=this.CHANGE_FULL);ea.$dirty=!aa||!qa;P&&this._signal("resize",ua);return P};this.onGutterResize=function(E){E=this.$showGutter?E:0;E!=this.gutterWidth&&(this.$changes|=this.$updateCachedSize(!0,E,this.$size.width,this.$size.height));this.session.getUseWrapMode()&&this.adjustWrapLimit()?this.$loop.schedule(this.CHANGE_FULL):this.$size.$dirty?this.$loop.schedule(this.CHANGE_FULL):this.$computeLayerConfig()};this.adjustWrapLimit=function(){return this.session.adjustWrapLimit(Math.floor((this.$size.scrollerWidth-
2*this.$padding)/this.characterWidth),this.$showPrintMargin&&this.$printMarginColumn)};this.setAnimatedScroll=function(E){this.setOption("animatedScroll",E)};this.getAnimatedScroll=function(){return this.$animatedScroll};this.setShowInvisibles=function(E){this.setOption("showInvisibles",E);this.session.$bidiHandler.setShowInvisibles(E)};this.getShowInvisibles=function(){return this.getOption("showInvisibles")};this.getDisplayIndentGuides=function(){return this.getOption("displayIndentGuides")};this.setDisplayIndentGuides=
function(E){this.setOption("displayIndentGuides",E)};this.setShowPrintMargin=function(E){this.setOption("showPrintMargin",E)};this.getShowPrintMargin=function(){return this.getOption("showPrintMargin")};this.setPrintMarginColumn=function(E){this.setOption("printMarginColumn",E)};this.getPrintMarginColumn=function(){return this.getOption("printMarginColumn")};this.getShowGutter=function(){return this.getOption("showGutter")};this.setShowGutter=function(E){return this.setOption("showGutter",E)};this.getFadeFoldWidgets=
function(){return this.getOption("fadeFoldWidgets")};this.setFadeFoldWidgets=function(E){this.setOption("fadeFoldWidgets",E)};this.setHighlightGutterLine=function(E){this.setOption("highlightGutterLine",E)};this.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")};this.$updatePrintMargin=function(){if(this.$showPrintMargin||this.$printMarginEl){if(!this.$printMarginEl){var E=f.createElement("div");E.className="ace_layer ace_print-margin-layer";this.$printMarginEl=f.createElement("div");
this.$printMarginEl.className="ace_print-margin";E.appendChild(this.$printMarginEl);this.content.insertBefore(E,this.content.firstChild)}E=this.$printMarginEl.style;E.left=Math.round(this.characterWidth*this.$printMarginColumn+this.$padding)+"px";E.visibility=this.$showPrintMargin?"visible":"hidden";this.session&&-1==this.session.$wrap&&this.adjustWrapLimit()}};this.getContainerElement=function(){return this.container};this.getMouseEventTarget=function(){return this.scroller};this.getTextAreaContainer=
function(){return this.container};this.$moveTextAreaToCursor=function(){if(!this.$isMousePressed){var E=this.textarea.style,Q=this.$composition;if(this.$keepTextAreaAtCursor||Q){var aa=this.$cursorLayer.$pixelPos;if(aa){Q&&Q.markerRange&&(aa=this.$cursorLayer.getPixelPosition(Q.markerRange.start,!0));var qa=this.layerConfig,P=aa.top;aa=aa.left;P-=qa.offset;var ea=Q&&Q.useTextareaForIME?this.lineHeight:V?0:1;if(0>P||P>qa.height-ea)f.translate(this.textarea,0,0);else{qa=1;var ua=this.$size.height-ea;
Q?Q.useTextareaForIME?qa=this.characterWidth*this.session.$getStringScreenWidth(this.textarea.value)[0]:P+=this.lineHeight+2:P+=this.lineHeight;aa-=this.scrollLeft;aa>this.$size.scrollerWidth-qa&&(aa=this.$size.scrollerWidth-qa);aa+=this.gutterWidth+this.margin.left;f.setStyle(E,"height",ea+"px");f.setStyle(E,"width",qa+"px");f.translate(this.textarea,Math.min(aa,this.$size.scrollerWidth-qa),Math.min(P,ua))}}}else f.translate(this.textarea,-100,0)}};this.getFirstVisibleRow=function(){return this.layerConfig.firstRow};
this.getFirstFullyVisibleRow=function(){return this.layerConfig.firstRow+(0===this.layerConfig.offset?0:1)};this.getLastFullyVisibleRow=function(){var E=this.layerConfig,Q=E.lastRow;return this.session.documentToScreenRow(Q,0)*E.lineHeight-this.session.getScrollTop()>E.height-E.lineHeight?Q-1:Q};this.getLastVisibleRow=function(){return this.layerConfig.lastRow};this.$padding=null;this.setPadding=function(E){this.$padding=E;this.$textLayer.setPadding(E);this.$cursorLayer.setPadding(E);this.$markerFront.setPadding(E);
this.$markerBack.setPadding(E);this.$loop.schedule(this.CHANGE_FULL);this.$updatePrintMargin()};this.setScrollMargin=function(E,Q,aa,qa){var P=this.scrollMargin;P.top=E|0;P.bottom=Q|0;P.right=qa|0;P.left=aa|0;P.v=P.top+P.bottom;P.h=P.left+P.right;P.top&&0>=this.scrollTop&&this.session&&this.session.setScrollTop(-P.top);this.updateFull()};this.setMargin=function(E,Q,aa,qa){var P=this.margin;P.top=E|0;P.bottom=Q|0;P.right=qa|0;P.left=aa|0;P.v=P.top+P.bottom;P.h=P.left+P.right;this.$updateCachedSize(!0,
this.gutterWidth,this.$size.width,this.$size.height);this.updateFull()};this.getHScrollBarAlwaysVisible=function(){return this.$hScrollBarAlwaysVisible};this.setHScrollBarAlwaysVisible=function(E){this.setOption("hScrollBarAlwaysVisible",E)};this.getVScrollBarAlwaysVisible=function(){return this.$vScrollBarAlwaysVisible};this.setVScrollBarAlwaysVisible=function(E){this.setOption("vScrollBarAlwaysVisible",E)};this.$updateScrollBarV=function(){var E=this.layerConfig.maxHeight,Q=this.$size.scrollerHeight;
!this.$maxLines&&this.$scrollPastEnd&&(E-=(Q-this.lineHeight)*this.$scrollPastEnd,this.scrollTop>E-Q&&(E=this.scrollTop+Q,this.scrollBarV.scrollTop=null));this.scrollBarV.setScrollHeight(E+this.scrollMargin.v);this.scrollBarV.setScrollTop(this.scrollTop+this.scrollMargin.top)};this.$updateScrollBarH=function(){this.scrollBarH.setScrollWidth(this.layerConfig.width+2*this.$padding+this.scrollMargin.h);this.scrollBarH.setScrollLeft(this.scrollLeft+this.scrollMargin.left)};this.$frozen=!1;this.freeze=
function(){this.$frozen=!0};this.unfreeze=function(){this.$frozen=!1};this.$renderChanges=function(E,Q){this.$changes&&(E|=this.$changes,this.$changes=0);if(this.session&&this.container.offsetWidth&&!this.$frozen&&(E||Q)){if(this.$size.$dirty)return this.$changes|=E,this.onResize(!0);this.lineHeight||this.$textLayer.checkForSizeChanges();this._signal("beforeRender",E);this.session&&this.session.$bidiHandler&&this.session.$bidiHandler.updateCharacterWidths(this.$fontMetrics);Q=this.layerConfig;if(E&
this.CHANGE_FULL||E&this.CHANGE_SIZE||E&this.CHANGE_TEXT||E&this.CHANGE_LINES||E&this.CHANGE_SCROLL||E&this.CHANGE_H_SCROLL){E|=this.$computeLayerConfig()|this.$loop.clear();Q.firstRow!=this.layerConfig.firstRow&&Q.firstRowScreen==this.layerConfig.firstRowScreen&&(Q=this.scrollTop+(Q.firstRow-this.layerConfig.firstRow)*this.lineHeight,0<Q&&(this.scrollTop=Q,E|=this.CHANGE_SCROLL,E|=this.$computeLayerConfig()|this.$loop.clear()));Q=this.layerConfig;this.$updateScrollBarV();E&this.CHANGE_H_SCROLL&&
this.$updateScrollBarH();f.translate(this.content,-this.scrollLeft,-Q.offset);var aa=Q.minHeight+"px";f.setStyle(this.content.style,"width",Q.width+2*this.$padding+"px");f.setStyle(this.content.style,"height",aa)}E&this.CHANGE_H_SCROLL&&(f.translate(this.content,-this.scrollLeft,-Q.offset),this.scroller.className=0>=this.scrollLeft?"ace_scroller":"ace_scroller ace_scroll-left");E&this.CHANGE_FULL?(this.$changedLines=null,this.$textLayer.update(Q),this.$showGutter&&this.$gutterLayer.update(Q),this.$markerBack.update(Q),
this.$markerFront.update(Q),this.$cursorLayer.update(Q),this.$moveTextAreaToCursor()):E&this.CHANGE_SCROLL?(this.$changedLines=null,E&this.CHANGE_TEXT||E&this.CHANGE_LINES?this.$textLayer.update(Q):this.$textLayer.scrollLines(Q),this.$showGutter&&(E&this.CHANGE_GUTTER||E&this.CHANGE_LINES?this.$gutterLayer.update(Q):this.$gutterLayer.scrollLines(Q)),this.$markerBack.update(Q),this.$markerFront.update(Q),this.$cursorLayer.update(Q),this.$moveTextAreaToCursor()):(E&this.CHANGE_TEXT?(this.$changedLines=
null,this.$textLayer.update(Q),this.$showGutter&&this.$gutterLayer.update(Q)):E&this.CHANGE_LINES?(this.$updateLines()||E&this.CHANGE_GUTTER&&this.$showGutter)&&this.$gutterLayer.update(Q):E&this.CHANGE_TEXT||E&this.CHANGE_GUTTER?this.$showGutter&&this.$gutterLayer.update(Q):E&this.CHANGE_CURSOR&&this.$highlightGutterLine&&this.$gutterLayer.updateLineHighlight(Q),E&this.CHANGE_CURSOR&&(this.$cursorLayer.update(Q),this.$moveTextAreaToCursor()),E&(this.CHANGE_MARKER|this.CHANGE_MARKER_FRONT)&&this.$markerFront.update(Q),
E&(this.CHANGE_MARKER|this.CHANGE_MARKER_BACK)&&this.$markerBack.update(Q));this._signal("afterRender",E)}else this.$changes|=E};this.$autosize=function(){var E=this.session.getScreenLength()*this.lineHeight,Q=this.$maxLines*this.lineHeight,aa=Math.min(Q,Math.max((this.$minLines||1)*this.lineHeight,E))+this.scrollMargin.v+(this.$extraHeight||0);this.$horizScroll&&(aa+=this.scrollBarH.getHeight());this.$maxPixelHeight&&aa>this.$maxPixelHeight&&(aa=this.$maxPixelHeight);E=!(aa<=2*this.lineHeight)&&
E>Q;if(aa!=this.desiredHeight||this.$size.height!=this.desiredHeight||E!=this.$vScroll)E!=this.$vScroll&&(this.$vScroll=E,this.scrollBarV.setVisible(E)),E=this.container.clientWidth,this.container.style.height=aa+"px",this.$updateCachedSize(!0,this.$gutterWidth,E,aa),this.desiredHeight=aa,this._signal("autosize")};this.$computeLayerConfig=function(){var E=this.session,Q=this.$size,aa=Q.height<=2*this.lineHeight,qa=this.session.getScreenLength()*this.lineHeight,P=this.$getLongestLine(),ea=!aa&&(this.$hScrollBarAlwaysVisible||
0>Q.scrollerWidth-P-2*this.$padding),ua=this.$horizScroll!==ea;ua&&(this.$horizScroll=ea,this.scrollBarH.setVisible(ea));var Fa=this.$vScroll;this.$maxLines&&1<this.lineHeight&&this.$autosize();ea=Q.scrollerHeight+this.lineHeight;var pa=!this.$maxLines&&this.$scrollPastEnd?(Q.scrollerHeight-this.lineHeight)*this.$scrollPastEnd:0;qa+=pa;var ra=this.scrollMargin;this.session.setScrollTop(Math.max(-ra.top,Math.min(this.scrollTop,qa-Q.scrollerHeight+ra.bottom)));this.session.setScrollLeft(Math.max(-ra.left,
Math.min(this.scrollLeft,P+2*this.$padding-Q.scrollerWidth+ra.right)));pa=!aa&&(this.$vScrollBarAlwaysVisible||0>Q.scrollerHeight-qa+pa||this.scrollTop>ra.top);if(aa=Fa!==pa)this.$vScroll=pa,this.scrollBarV.setVisible(pa);var Ca=this.scrollTop%this.lineHeight;Fa=Math.max(0,Math.round((this.scrollTop-Ca)/this.lineHeight));pa=Fa+(Math.ceil(ea/this.lineHeight)-1);ra=this.lineHeight;Fa=E.screenToDocumentRow(Fa,0);if(ea=E.getFoldLine(Fa))Fa=ea.start.row;var Ga=E.documentToScreenRow(Fa,0);ea=E.getRowLength(Fa)*
ra;pa=Math.min(E.screenToDocumentRow(pa,0),E.getLength()-1);ea=Q.scrollerHeight+E.getRowLength(pa)*ra+ea;Ca=this.scrollTop-Ga*ra;E=0;if(this.layerConfig.width!=P||ua)E=this.CHANGE_H_SCROLL;if(ua||aa)E|=this.$updateCachedSize(!0,this.gutterWidth,Q.width,Q.height),this._signal("scrollbarVisibilityChanged"),aa&&(P=this.$getLongestLine());this.layerConfig={width:P,padding:this.$padding,firstRow:Fa,firstRowScreen:Ga,lastRow:pa,lineHeight:ra,characterWidth:this.characterWidth,minHeight:ea,maxHeight:qa,
offset:Ca,gutterOffset:ra?Math.max(0,Math.ceil((Ca+Q.height-Q.scrollerHeight)/ra)):0,height:this.$size.scrollerHeight};this.session.$bidiHandler&&this.session.$bidiHandler.setContentWidth(P-this.$padding);return E};this.$updateLines=function(){if(this.$changedLines){var E=this.$changedLines.firstRow,Q=this.$changedLines.lastRow;this.$changedLines=null;var aa=this.layerConfig;if(!(E>aa.lastRow+1||Q<aa.firstRow))if(Infinity===Q)this.$showGutter&&this.$gutterLayer.update(aa),this.$textLayer.update(aa);
else return this.$textLayer.updateLines(aa,E,Q),!0}};this.$getLongestLine=function(){var E=this.session.getScreenWidth();this.showInvisibles&&!this.session.$useWrapMode&&(E+=1);this.$textLayer&&E>this.$textLayer.MAX_LINE_LENGTH&&(E=this.$textLayer.MAX_LINE_LENGTH+30);return Math.max(this.$size.scrollerWidth-2*this.$padding,Math.round(E*this.characterWidth))};this.updateFrontMarkers=function(){this.$markerFront.setMarkers(this.session.getMarkers(!0));this.$loop.schedule(this.CHANGE_MARKER_FRONT)};
this.updateBackMarkers=function(){this.$markerBack.setMarkers(this.session.getMarkers());this.$loop.schedule(this.CHANGE_MARKER_BACK)};this.addGutterDecoration=function(E,Q){this.$gutterLayer.addGutterDecoration(E,Q)};this.removeGutterDecoration=function(E,Q){this.$gutterLayer.removeGutterDecoration(E,Q)};this.updateBreakpoints=function(){this.$loop.schedule(this.CHANGE_GUTTER)};this.setAnnotations=function(E){this.$gutterLayer.setAnnotations(E);this.$loop.schedule(this.CHANGE_GUTTER)};this.updateCursor=
function(){this.$loop.schedule(this.CHANGE_CURSOR)};this.hideCursor=function(){this.$cursorLayer.hideCursor()};this.showCursor=function(){this.$cursorLayer.showCursor()};this.scrollSelectionIntoView=function(E,Q,aa){this.scrollCursorIntoView(E,aa);this.scrollCursorIntoView(Q,aa)};this.scrollCursorIntoView=function(E,Q,aa){if(0!==this.$size.scrollerHeight){var qa=this.$cursorLayer.getPixelPosition(E);E=qa.left;qa=qa.top;var P=aa&&aa.top||0;aa=aa&&aa.bottom||0;var ea=this.$scrollAnimation?this.session.getScrollTop():
this.scrollTop;ea+P>qa?(Q&&ea+P>qa+this.lineHeight&&(qa-=Q*this.$size.scrollerHeight),0===qa&&(qa=-this.scrollMargin.top),this.session.setScrollTop(qa)):ea+this.$size.scrollerHeight-aa<qa+this.lineHeight&&(Q&&ea+this.$size.scrollerHeight-aa<qa-this.lineHeight&&(qa+=Q*this.$size.scrollerHeight),this.session.setScrollTop(qa+this.lineHeight+aa-this.$size.scrollerHeight));Q=this.scrollLeft;Q>E?(E<this.$padding+2*this.layerConfig.characterWidth&&(E=-this.scrollMargin.left),this.session.setScrollLeft(E)):
Q+this.$size.scrollerWidth<E+this.characterWidth?this.session.setScrollLeft(Math.round(E+this.characterWidth-this.$size.scrollerWidth)):Q<=this.$padding&&E-Q<this.characterWidth&&this.session.setScrollLeft(0)}};this.getScrollTop=function(){return this.session.getScrollTop()};this.getScrollLeft=function(){return this.session.getScrollLeft()};this.getScrollTopRow=function(){return this.scrollTop/this.lineHeight};this.getScrollBottomRow=function(){return Math.max(0,Math.floor((this.scrollTop+this.$size.scrollerHeight)/
this.lineHeight)-1)};this.scrollToRow=function(E){this.session.setScrollTop(E*this.lineHeight)};this.alignCursor=function(E,Q){"number"==typeof E&&(E={row:E,column:0});E=this.$cursorLayer.getPixelPosition(E).top-(this.$size.scrollerHeight-this.lineHeight)*(Q||0);this.session.setScrollTop(E);return E};this.STEPS=8;this.$calcSteps=function(E,Q){var aa,qa=this.STEPS,P=[];for(aa=0;aa<qa;++aa)P.push((Q-E)*(Math.pow(aa/this.STEPS-1,3)+1)+E);return P};this.scrollToLine=function(E,Q,aa,qa){E=this.$cursorLayer.getPixelPosition({row:E,
column:0}).top;Q&&(E-=this.$size.scrollerHeight/2);Q=this.scrollTop;this.session.setScrollTop(E);!1!==aa&&this.animateScrolling(Q,qa)};this.animateScrolling=function(E,Q){var aa=this.scrollTop;if(this.$animatedScroll){var qa=this;if(E!=aa){if(this.$scrollAnimation){var P=this.$scrollAnimation.steps;if(P.length&&(E=P[0],E==aa))return}var ea=qa.$calcSteps(E,aa);this.$scrollAnimation={from:E,to:aa,steps:ea};clearInterval(this.$timer);qa.session.setScrollTop(ea.shift());qa.session.$scrollTop=aa;this.$timer=
setInterval(function(){if(!qa.session)return clearInterval(qa.$timer);ea.length?(qa.session.setScrollTop(ea.shift()),qa.session.$scrollTop=aa):null!=aa?(qa.session.$scrollTop=-1,qa.session.setScrollTop(aa),aa=null):(qa.$timer=clearInterval(qa.$timer),qa.$scrollAnimation=null,Q&&Q())},10)}}};this.scrollToY=function(E){this.scrollTop!==E&&(this.$loop.schedule(this.CHANGE_SCROLL),this.scrollTop=E)};this.scrollToX=function(E){this.scrollLeft!==E&&(this.scrollLeft=E);this.$loop.schedule(this.CHANGE_H_SCROLL)};
this.scrollTo=function(E,Q){this.session.setScrollTop(Q);this.session.setScrollLeft(Q)};this.scrollBy=function(E,Q){Q&&this.session.setScrollTop(this.session.getScrollTop()+Q);E&&this.session.setScrollLeft(this.session.getScrollLeft()+E)};this.isScrollableBy=function(E,Q){if(0>Q&&this.session.getScrollTop()>=1-this.scrollMargin.top||0<Q&&this.session.getScrollTop()+this.$size.scrollerHeight-this.layerConfig.maxHeight<-1+this.scrollMargin.bottom||0>E&&this.session.getScrollLeft()>=1-this.scrollMargin.left||
0<E&&this.session.getScrollLeft()+this.$size.scrollerWidth-this.layerConfig.width<-1+this.scrollMargin.right)return!0};this.pixelToScreenCoordinates=function(E,Q){if(this.$hasCssTransforms){var aa={top:0,left:0};Q=this.$fontMetrics.transformCoordinates([E,Q]);E=Q[1]-this.gutterWidth-this.margin.left;Q=Q[0]}else aa=this.scroller.getBoundingClientRect();E=E+this.scrollLeft-aa.left-this.$padding;var qa=E/this.characterWidth,P=this.$blockCursor?Math.floor(qa):Math.round(qa);return{row:Math.floor((Q+this.scrollTop-
aa.top)/this.lineHeight),column:P,side:0<qa-P?1:-1,offsetX:E}};this.screenToTextCoordinates=function(E,Q){if(this.$hasCssTransforms){var aa={top:0,left:0};Q=this.$fontMetrics.transformCoordinates([E,Q]);E=Q[1]-this.gutterWidth-this.margin.left;Q=Q[0]}else aa=this.scroller.getBoundingClientRect();E=E+this.scrollLeft-aa.left-this.$padding;var qa=E/this.characterWidth;return this.session.screenToDocumentPosition(Math.floor((Q+this.scrollTop-aa.top)/this.lineHeight),Math.max(this.$blockCursor?Math.floor(qa):
Math.round(qa),0),E)};this.textToScreenCoordinates=function(E,Q){var aa=this.scroller.getBoundingClientRect();Q=this.session.documentToScreenPosition(E,Q);E=this.$padding+(this.session.$bidiHandler.isBidiRow(Q.row,E)?this.session.$bidiHandler.getPosLeft(Q.column):Math.round(Q.column*this.characterWidth));return{pageX:aa.left+E-this.scrollLeft,pageY:aa.top+Q.row*this.lineHeight-this.scrollTop}};this.visualizeFocus=function(){f.addCssClass(this.container,"ace_focus")};this.visualizeBlur=function(){f.removeCssClass(this.container,
"ace_focus")};this.showComposition=function(E){this.$composition=E;E.cssText||(E.cssText=this.textarea.style.cssText);void 0==E.useTextareaForIME&&(E.useTextareaForIME=this.$useTextareaForIME);this.$useTextareaForIME?(f.addCssClass(this.textarea,"ace_composition"),this.textarea.style.cssText="",this.$moveTextAreaToCursor(),this.$cursorLayer.element.style.display="none"):E.markerId=this.session.addMarker(E.markerRange,"ace_composition_marker","text")};this.setCompositionText=function(E){var Q=this.session.selection.cursor;
this.addToken(E,"composition_placeholder",Q.row,Q.column);this.$moveTextAreaToCursor()};this.hideComposition=function(){if(this.$composition){this.$composition.markerId&&this.session.removeMarker(this.$composition.markerId);f.removeCssClass(this.textarea,"ace_composition");this.textarea.style.cssText=this.$composition.cssText;var E=this.session.selection.cursor;this.removeExtraToken(E.row,E.column);this.$composition=null;this.$cursorLayer.element.style.display=""}};this.addToken=function(E,Q,aa,qa){var P=
this.session;P.bgTokenizer.lines[aa]=null;E={type:Q,value:E};P=P.getTokens(aa);if(null==qa)P.push(E);else{var ea=0;for(Q=0;Q<P.length;Q++){var ua=P[Q];ea+=ua.value.length;if(qa<=ea){ea=ua.value.length-(ea-qa);qa=ua.value.slice(0,ea);ea=ua.value.slice(ea);P.splice(Q,1,{type:ua.type,value:qa},E,{type:ua.type,value:ea});break}}}this.updateLines(aa,aa)};this.removeExtraToken=function(E){this.updateLines(E,E)};this.setTheme=function(E,Q){function aa(P){if(qa.$themeId!=E)return Q&&Q();if(!P||!P.cssClass)throw Error("couldn't load module "+
E+" or it didn't call define");P.$id&&(qa.$themeId=P.$id);f.importCssString(P.cssText,P.cssClass,qa.container);qa.theme&&f.removeCssClass(qa.container,qa.theme.cssClass);var ea="padding"in P?P.padding:"padding"in(qa.theme||{})?4:qa.$padding;qa.$padding&&ea!=qa.$padding&&qa.setPadding(ea);qa.$theme=P.cssClass;qa.theme=P;f.addCssClass(qa.container,P.cssClass);f.setCssClass(qa.container,"ace_dark",P.isDark);qa.$size&&(qa.$size.width=0,qa.$updateSizeAsync());qa._dispatchEvent("themeLoaded",{theme:P});
Q&&Q()}var qa=this;this.$themeId=E;qa._dispatchEvent("themeChange",{theme:E});E&&"string"!=typeof E?aa(E):h.loadModule(["theme",E||this.$options.theme.initialValue],aa)};this.getTheme=function(){return this.$themeId};this.setStyle=function(E,Q){f.setCssClass(this.container,E,!1!==Q)};this.unsetStyle=function(E){f.removeCssClass(this.container,E)};this.setCursorStyle=function(E){f.setStyle(this.scroller.style,"cursor",E)};this.setMouseCursor=function(E){f.setStyle(this.scroller.style,"cursor",E)};
this.attachToShadowRoot=function(){f.importCssString('.ace_br1 {border-top-left-radius    : 3px;}.ace_br2 {border-top-right-radius   : 3px;}.ace_br3 {border-top-left-radius    : 3px; border-top-right-radius:    3px;}.ace_br4 {border-bottom-right-radius: 3px;}.ace_br5 {border-top-left-radius    : 3px; border-bottom-right-radius: 3px;}.ace_br6 {border-top-right-radius   : 3px; border-bottom-right-radius: 3px;}.ace_br7 {border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px;}.ace_br8 {border-bottom-left-radius : 3px;}.ace_br9 {border-top-left-radius    : 3px; border-bottom-left-radius:  3px;}.ace_br10{border-top-right-radius   : 3px; border-bottom-left-radius:  3px;}.ace_br11{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-left-radius:  3px;}.ace_br12{border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br13{border-top-left-radius    : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br14{border-top-right-radius   : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br15{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;}.ace_editor {position: relative;overflow: hidden;padding: 0;font: 12px/normal \'Monaco\', \'Menlo\', \'Ubuntu Mono\', \'Consolas\', \'source-code-pro\', monospace;direction: ltr;text-align: left;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);}.ace_scroller {position: absolute;overflow: hidden;top: 0;bottom: 0;background-color: inherit;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;cursor: text;}.ace_content {position: absolute;box-sizing: border-box;min-width: 100%;contain: style size layout;font-variant-ligatures: no-common-ligatures;}.ace_dragging .ace_scroller:before{position: absolute;top: 0;left: 0;right: 0;bottom: 0;content: \'\';background: rgba(250, 250, 250, 0.01);z-index: 1000;}.ace_dragging.ace_dark .ace_scroller:before{background: rgba(0, 0, 0, 0.01);}.ace_selecting, .ace_selecting * {cursor: text !important;}.ace_gutter {position: absolute;overflow : hidden;width: auto;top: 0;bottom: 0;left: 0;cursor: default;z-index: 4;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;contain: style size layout;}.ace_gutter-active-line {position: absolute;left: 0;right: 0;}.ace_scroller.ace_scroll-left {box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;}.ace_gutter-cell {position: absolute;top: 0;left: 0;right: 0;padding-left: 19px;padding-right: 6px;background-repeat: no-repeat;}.ace_gutter-cell.ace_error {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: 2px center;}.ace_gutter-cell.ace_warning {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==");background-position: 2px center;}.ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=");background-position: 2px center;}.ace_dark .ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC");}.ace_scrollbar {contain: strict;position: absolute;right: 0;bottom: 0;z-index: 6;}.ace_scrollbar-inner {position: absolute;cursor: text;left: 0;top: 0;}.ace_scrollbar-v{overflow-x: hidden;overflow-y: scroll;top: 0;}.ace_scrollbar-h {overflow-x: scroll;overflow-y: hidden;left: 0;}.ace_print-margin {position: absolute;height: 100%;}.ace_text-input {position: absolute;z-index: 0;width: 0.5em;height: 1em;opacity: 0;background: transparent;-moz-appearance: none;appearance: none;border: none;resize: none;outline: none;overflow: hidden;font: inherit;padding: 0 1px;margin: 0 -1px;contain: strict;-ms-user-select: text;-moz-user-select: text;-webkit-user-select: text;user-select: text;white-space: pre!important;}.ace_text-input.ace_composition {background: transparent;color: inherit;z-index: 1000;opacity: 1;}.ace_composition_placeholder { color: transparent }.ace_composition_marker { border-bottom: 1px solid;position: absolute;border-radius: 0;margin-top: 1px;}[ace_nocontext=true] {transform: none!important;filter: none!important;clip-path: none!important;mask : none!important;contain: none!important;perspective: none!important;mix-blend-mode: initial!important;z-index: auto;}.ace_layer {z-index: 1;position: absolute;overflow: hidden;word-wrap: normal;white-space: pre;height: 100%;width: 100%;box-sizing: border-box;pointer-events: none;}.ace_gutter-layer {position: relative;width: auto;text-align: right;pointer-events: auto;height: 1000000px;contain: style size layout;}.ace_text-layer {font: inherit !important;position: absolute;height: 1000000px;width: 1000000px;contain: style size layout;}.ace_text-layer > .ace_line, .ace_text-layer > .ace_line_group {contain: style size layout;position: absolute;top: 0;left: 0;right: 0;}.ace_hidpi .ace_text-layer,.ace_hidpi .ace_gutter-layer,.ace_hidpi .ace_content,.ace_hidpi .ace_gutter {contain: strict;will-change: transform;}.ace_hidpi .ace_text-layer > .ace_line, .ace_hidpi .ace_text-layer > .ace_line_group {contain: strict;}.ace_cjk {display: inline-block;text-align: center;}.ace_cursor-layer {z-index: 4;}.ace_cursor {z-index: 4;position: absolute;box-sizing: border-box;border-left: 2px solid;transform: translatez(0);}.ace_multiselect .ace_cursor {border-left-width: 1px;}.ace_slim-cursors .ace_cursor {border-left-width: 1px;}.ace_overwrite-cursors .ace_cursor {border-left-width: 0;border-bottom: 1px solid;}.ace_hidden-cursors .ace_cursor {opacity: 0.2;}.ace_hasPlaceholder .ace_hidden-cursors .ace_cursor {opacity: 0;}.ace_smooth-blinking .ace_cursor {transition: opacity 0.18s;}.ace_animate-blinking .ace_cursor {animation-duration: 1000ms;animation-timing-function: step-end;animation-name: blink-ace-animate;animation-iteration-count: infinite;}.ace_animate-blinking.ace_smooth-blinking .ace_cursor {animation-duration: 1000ms;animation-timing-function: ease-in-out;animation-name: blink-ace-animate-smooth;}@keyframes blink-ace-animate {from, to { opacity: 1; }60% { opacity: 0; }}@keyframes blink-ace-animate-smooth {from, to { opacity: 1; }45% { opacity: 1; }60% { opacity: 0; }85% { opacity: 0; }}.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {position: absolute;z-index: 3;}.ace_marker-layer .ace_selection {position: absolute;z-index: 5;}.ace_marker-layer .ace_bracket {position: absolute;z-index: 6;}.ace_marker-layer .ace_error_bracket {position: absolute;border-bottom: 1px solid #DE5555;border-radius: 0;}.ace_marker-layer .ace_active-line {position: absolute;z-index: 2;}.ace_marker-layer .ace_selected-word {position: absolute;z-index: 4;box-sizing: border-box;}.ace_line .ace_fold {box-sizing: border-box;display: inline-block;height: 11px;margin-top: -2px;vertical-align: middle;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=");background-repeat: no-repeat, repeat-x;background-position: center center, top left;color: transparent;border: 1px solid black;border-radius: 2px;cursor: pointer;pointer-events: auto;}.ace_dark .ace_fold {}.ace_fold:hover{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC");}.ace_tooltip {background-color: #FFF;background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));border: 1px solid gray;border-radius: 1px;box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);color: black;max-width: 100%;padding: 3px 4px;position: fixed;z-index: 999999;box-sizing: border-box;cursor: default;white-space: pre;word-wrap: break-word;line-height: normal;font-style: normal;font-weight: normal;letter-spacing: normal;pointer-events: none;}.ace_folding-enabled > .ace_gutter-cell {padding-right: 13px;}.ace_fold-widget {box-sizing: border-box;margin: 0 -12px 0 1px;display: none;width: 11px;vertical-align: top;background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: center;border-radius: 3px;border: 1px solid transparent;cursor: pointer;}.ace_folding-enabled .ace_fold-widget {display: inline-block;   }.ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==");}.ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==");}.ace_fold-widget:hover {border: 1px solid rgba(0, 0, 0, 0.3);background-color: rgba(255, 255, 255, 0.2);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);}.ace_fold-widget:active {border: 1px solid rgba(0, 0, 0, 0.4);background-color: rgba(0, 0, 0, 0.05);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);}.ace_dark .ace_fold-widget {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC");}.ace_dark .ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget:hover {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);background-color: rgba(255, 255, 255, 0.1);}.ace_dark .ace_fold-widget:active {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);}.ace_inline_button {border: 1px solid lightgray;display: inline-block;margin: -1px 8px;padding: 0 5px;pointer-events: auto;cursor: pointer;}.ace_inline_button:hover {border-color: gray;background: rgba(200,200,200,0.2);display: inline-block;pointer-events: auto;}.ace_fold-widget.ace_invalid {background-color: #FFB4B4;border-color: #DE5555;}.ace_fade-fold-widgets .ace_fold-widget {transition: opacity 0.4s ease 0.05s;opacity: 0;}.ace_fade-fold-widgets:hover .ace_fold-widget {transition: opacity 0.05s ease 0.05s;opacity:1;}.ace_underline {text-decoration: underline;}.ace_bold {font-weight: bold;}.ace_nobold .ace_bold {font-weight: normal;}.ace_italic {font-style: italic;}.ace_error-marker {background-color: rgba(255, 0, 0,0.2);position: absolute;z-index: 9;}.ace_highlight-marker {background-color: rgba(255, 255, 0,0.2);position: absolute;z-index: 8;}.ace_mobile-menu {position: absolute;line-height: 1.5;border-radius: 4px;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;background: white;box-shadow: 1px 3px 2px grey;border: 1px solid #dcdcdc;color: black;}.ace_dark > .ace_mobile-menu {background: #333;color: #ccc;box-shadow: 1px 3px 2px grey;border: 1px solid #444;}.ace_mobile-button {padding: 2px;cursor: pointer;overflow: hidden;}.ace_mobile-button:hover {background-color: #eee;opacity:1;}.ace_mobile-button:active {background-color: #ddd;}.ace_placeholder {font-family: arial;transform: scale(0.9);transform-origin: left;white-space: pre;opacity: 0.7;margin: 0 10px;}',
"ace_editor.css",this.container)};this.destroy=function(){this.freeze();this.$fontMetrics.destroy();this.$cursorLayer.destroy();this.removeAllListeners();this.container.textContent=""}}).call(l.prototype);h.defineOptions(l.prototype,"renderer",{animatedScroll:{initialValue:!1},showInvisibles:{set:function(E){this.$textLayer.setShowInvisibles(E)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!1},showPrintMargin:{set:function(){this.$updatePrintMargin()},initialValue:!0},printMarginColumn:{set:function(){this.$updatePrintMargin()},
initialValue:80},printMargin:{set:function(E){"number"==typeof E&&(this.$printMarginColumn=E);this.$showPrintMargin=!!E;this.$updatePrintMargin()},get:function(){return this.$showPrintMargin&&this.$printMarginColumn}},showGutter:{set:function(E){this.$gutter.style.display=E?"block":"none";this.$loop.schedule(this.CHANGE_FULL);this.onGutterResize()},initialValue:!0},fadeFoldWidgets:{set:function(E){f.setCssClass(this.$gutter,"ace_fade-fold-widgets",E)},initialValue:!1},showFoldWidgets:{set:function(E){this.$gutterLayer.setShowFoldWidgets(E);
this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},displayIndentGuides:{set:function(E){this.$textLayer.setDisplayIndentGuides(E)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!0},highlightGutterLine:{set:function(E){this.$gutterLayer.setHighlightGutterLine(E);this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},hScrollBarAlwaysVisible:{set:function(){this.$hScrollBarAlwaysVisible&&this.$horizScroll||this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},vScrollBarAlwaysVisible:{set:function(){this.$vScrollBarAlwaysVisible&&
this.$vScroll||this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},fontSize:{set:function(E){"number"==typeof E&&(E+="px");this.container.style.fontSize=E;this.updateFontSize()},initialValue:12},fontFamily:{set:function(E){this.container.style.fontFamily=E;this.updateFontSize()}},maxLines:{set:function(){this.updateFull()}},minLines:{set:function(){562949953421311>this.$minLines||(this.$minLines=0);this.updateFull()}},maxPixelHeight:{set:function(){this.updateFull()},initialValue:0},scrollPastEnd:{set:function(E){E=
+E||0;this.$scrollPastEnd!=E&&(this.$scrollPastEnd=E,this.$loop.schedule(this.CHANGE_SCROLL))},initialValue:0,handlesSet:!0},fixedWidthGutter:{set:function(E){this.$gutterLayer.$fixedWidth=!!E;this.$loop.schedule(this.CHANGE_GUTTER)}},theme:{set:function(E){this.setTheme(E)},get:function(){return this.$themeId||this.theme},initialValue:"./theme/textmate",handlesSet:!0},hasCssTransforms:{},useTextareaForIME:{initialValue:!T.isMobile&&!T.isIE}});b.VirtualRenderer=l});
define("ace/worker/worker_client","require exports module ace/lib/oop ace/lib/net ace/lib/event_emitter ace/config".split(" "),function(a,b){function l(r){r.postMessage||(r=this.$createWorkerFromOldConfig.apply(this,arguments));this.$worker=r;this.$sendDeltaQueue=this.$sendDeltaQueue.bind(this);this.changeListener=this.changeListener.bind(this);this.onMessage=this.onMessage.bind(this);this.callbackId=1;this.callbacks={};this.$worker.onmessage=this.onMessage}function e(r){r="importScripts('"+g.qualifyURL(r)+
"');";try{return new Blob([r],{type:"application/javascript"})}catch(D){var B=new (window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder);B.append(r);return B.getBlob("application/javascript")}}function f(r){return"undefined"==typeof Worker?{postMessage:function(){},terminate:function(){}}:q.get("loadWorkerFromBlob")?(r=e(r),r=(window.URL||window.webkitURL).createObjectURL(r),new Worker(r)):new Worker(r)}var h=a("../lib/oop"),g=a("../lib/net"),m=a("../lib/event_emitter").EventEmitter,
q=a("../config");(function(){h.implement(this,m);this.$createWorkerFromOldConfig=function(r,B,D,F,G){a.nameToUrl&&!a.toUrl&&(a.toUrl=a.nameToUrl);if(q.get("packaged")||!a.toUrl)F=F||q.moduleUrl(B,"worker");else{var N=this.$normalizePath;F=F||N(a.toUrl("ace/worker/worker.js",null,"_"));var T={};r.forEach(function(V){T[V]=N(a.toUrl(V,null,"_").replace(/(\.js)?(\?.*)?$/,""))})}this.$worker=f(F);G&&this.send("importScripts",G);this.$worker.postMessage({init:!0,tlns:T,module:B,classname:D});return this.$worker};
this.onMessage=function(r){r=r.data;switch(r.type){case "event":this._signal(r.name,{data:r.data});break;case "call":var B=this.callbacks[r.id];B&&(B(r.data),delete this.callbacks[r.id]);break;case "error":this.reportError(r.data);break;case "log":window.console&&console.log&&console.log.apply(console,r.data)}};this.reportError=function(r){window.console&&console.error&&console.error(r)};this.$normalizePath=function(r){return g.qualifyURL(r)};this.terminate=function(){this._signal("terminate",{});
this.deltaQueue=null;this.$worker.terminate();this.$worker=null;this.$doc&&this.$doc.off("change",this.changeListener);this.$doc=null};this.send=function(r,B){this.$worker.postMessage({command:r,args:B})};this.call=function(r,B,D){if(D){var F=this.callbackId++;this.callbacks[F]=D;B.push(F)}this.send(r,B)};this.emit=function(r,B){try{B.data&&B.data.err&&(B.data.err={message:B.data.err.message,stack:B.data.err.stack,code:B.data.err.code}),this.$worker.postMessage({event:r,data:{data:B.data}})}catch(D){console.error(D.stack)}};
this.attachToDocument=function(r){this.$doc&&this.terminate();this.$doc=r;this.call("setValue",[r.getValue()]);r.on("change",this.changeListener)};this.changeListener=function(r){this.deltaQueue||(this.deltaQueue=[],setTimeout(this.$sendDeltaQueue,0));"insert"==r.action?this.deltaQueue.push(r.start,r.lines):this.deltaQueue.push(r.start,r.end)};this.$sendDeltaQueue=function(){var r=this.deltaQueue;r&&(this.deltaQueue=null,50<r.length&&r.length>this.$doc.getLength()>>1?this.call("setValue",[this.$doc.getValue()]):
this.emit("change",{data:r}))}}).call(l.prototype);b.UIWorkerClient=function(r,B,D){function F(){var Q=V.shift();Q.command?G[Q.command].apply(G,Q.args):Q.event&&T._signal(Q.event,Q.data)}var G=null,N=!1,T=Object.create(m),V=[],E=new l({messageBuffer:V,terminate:function(){},postMessage:function(Q){V.push(Q);G&&(N?setTimeout(F):F())}});E.setEmitSync=function(Q){N=Q};T.postMessage=function(Q){E.onMessage({data:Q})};T.callback=function(Q,aa){this.postMessage({type:"call",id:aa,data:Q})};T.emit=function(Q,
aa){this.postMessage({type:"event",name:Q,data:aa})};q.loadModule(["worker",B],function(Q){for(G=new Q[D](T);V.length;)F()});return E};b.WorkerClient=l;b.createWorker=f});
define("ace/placeholder","require exports module ace/range ace/lib/event_emitter ace/lib/oop".split(" "),function(a,b){function l(g,m,q,r,B,D){var F=this;this.length=m;this.session=g;this.doc=g.getDocument();this.mainClass=B;this.othersClass=D;this.$onUpdate=this.onUpdate.bind(this);this.doc.on("change",this.$onUpdate);this.$others=r;this.$onCursorChange=function(){setTimeout(function(){F.onCursorChange()})};this.$pos=q;this.$undoStackDepth=(g.getUndoManager().$undoStack||g.getUndoManager().$undostack||
{length:-1}).length;this.setup();g.selection.on("changeCursor",this.$onCursorChange)}var e=a("./range").Range,f=a("./lib/event_emitter").EventEmitter,h=a("./lib/oop");(function(){h.implement(this,f);this.setup=function(){var g=this,m=this.doc,q=this.session;this.selectionBefore=q.selection.toJSON();q.selection.inMultiSelectMode&&q.selection.toSingleRange();var r=this.pos=m.createAnchor(this.$pos.row,this.$pos.column);r.$insertRight=!0;r.detach();r.markerId=q.addMarker(new e(r.row,r.column,r.row,r.column+
this.length),this.mainClass,null,!1);this.others=[];this.$others.forEach(function(B){B=m.createAnchor(B.row,B.column);B.$insertRight=!0;B.detach();g.others.push(B)});q.setUndoSelect(!1)};this.showOtherMarkers=function(){if(!this.othersActive){var g=this.session,m=this;this.othersActive=!0;this.others.forEach(function(q){q.markerId=g.addMarker(new e(q.row,q.column,q.row,q.column+m.length),m.othersClass,null,!1)})}};this.hideOtherMarkers=function(){if(this.othersActive){this.othersActive=!1;for(var g=
0;g<this.others.length;g++)this.session.removeMarker(this.others[g].markerId)}};this.onUpdate=function(g){if(this.$updating)return this.updateAnchors(g);if(g.start.row===g.end.row&&g.start.row===this.pos.row){this.$updating=!0;var m="insert"===g.action?g.end.column-g.start.column:g.start.column-g.end.column,q=g.start.column>=this.pos.column&&g.start.column<=this.pos.column+this.length+1,r=g.start.column-this.pos.column;this.updateAnchors(g);q&&(this.length+=m);if(q&&!this.session.$fromUndo)if("insert"===
g.action)for(q=this.others.length-1;0<=q;q--){var B=this.others[q];B={row:B.row,column:B.column+r};this.doc.insertMergedLines(B,g.lines)}else if("remove"===g.action)for(q=this.others.length-1;0<=q;q--)B=this.others[q],B={row:B.row,column:B.column+r},this.doc.remove(new e(B.row,B.column,B.row,B.column-m));this.$updating=!1;this.updateMarkers()}};this.updateAnchors=function(g){this.pos.onChange(g);for(var m=this.others.length;m--;)this.others[m].onChange(g);this.updateMarkers()};this.updateMarkers=
function(){if(!this.$updating){var g=this,m=this.session,q=function(B,D){m.removeMarker(B.markerId);B.markerId=m.addMarker(new e(B.row,B.column,B.row,B.column+g.length),D,null,!1)};q(this.pos,this.mainClass);for(var r=this.others.length;r--;)q(this.others[r],this.othersClass)}};this.onCursorChange=function(g){if(!this.$updating&&this.session){var m=this.session.selection.getCursor();m.row===this.pos.row&&m.column>=this.pos.column&&m.column<=this.pos.column+this.length?(this.showOtherMarkers(),this._emit("cursorEnter",
g)):(this.hideOtherMarkers(),this._emit("cursorLeave",g))}};this.detach=function(){this.session.removeMarker(this.pos&&this.pos.markerId);this.hideOtherMarkers();this.doc.off("change",this.$onUpdate);this.session.selection.off("changeCursor",this.$onCursorChange);this.session.setUndoSelect(!0);this.session=null};this.cancel=function(){if(-1!==this.$undoStackDepth){for(var g=this.session.getUndoManager(),m=(g.$undoStack||g.$undostack).length-this.$undoStackDepth,q=0;q<m;q++)g.undo(this.session,!0);
this.selectionBefore&&this.session.selection.fromJSON(this.selectionBefore)}}}).call(l.prototype);b.PlaceHolder=l});
define("ace/mouse/multi_select_handler",["require","exports","module","ace/lib/event","ace/lib/useragent"],function(a,b){function l(h,g){return h.row==g.row&&h.column==g.column}var e=a("../lib/event"),f=a("../lib/useragent");b.onMouseDown=function(h){var g=h.domEvent,m=g.altKey,q=g.shiftKey,r=g.ctrlKey,B=h.getAccelKey(),D=h.getButton();r&&f.isMac&&(D=g.button);if(h.editor.inMultiSelectMode&&2==D)h.editor.textInput.onContextMenu(h.domEvent);else if(!r&&!m&&!B)0===D&&h.editor.inMultiSelectMode&&h.editor.exitMultiSelectMode();
else if(0===D){var F=h.editor,G=F.selection;D=F.inMultiSelectMode;var N=h.getDocumentPosition(),T=G.getCursor();T=h.inSelection()||G.isEmpty()&&l(N,T);var V=h.x,E=h.y,Q=function(Aa){V=Aa.clientX;E=Aa.clientY},aa=F.session,qa=F.renderer.pixelToScreenCoordinates(V,E),P=qa,ea;if(F.$mouseHandler.$enableJumpToDef)r&&m||B&&m?ea=q?"block":"add":m&&F.$blockSelectEnabled&&(ea="block");else if(B&&!m){if(ea="add",!D&&q)return}else m&&F.$blockSelectEnabled&&(ea="block");ea&&f.isMac&&g.ctrlKey&&F.$mouseHandler.cancelContextMenu();
if("add"==ea){if(D||!T){if(!D){var ua=G.toOrientedRange();F.addSelectionMarker(ua)}var Fa=G.rangeList.rangeAtPoint(N);F.inVirtualSelectionMode=!0;q&&(Fa=null,ua=G.ranges[0]||ua,F.removeSelectionMarker(ua));F.once("mouseup",function(){var Aa=G.toOrientedRange();Fa&&Aa.isEmpty()&&l(Fa.cursor,Aa.cursor)?G.substractPoint(Aa.cursor):(q?G.substractPoint(ua.cursor):ua&&(F.removeSelectionMarker(ua),G.addRange(ua)),G.addRange(Aa));F.inVirtualSelectionMode=!1})}}else if("block"==ea){h.stop();F.inVirtualSelectionMode=
!0;var pa=[],ra=function(){var Aa=F.renderer.pixelToScreenCoordinates(V,E),xa=aa.screenToDocumentPosition(Aa.row,Aa.column,Aa.offsetX);l(P,Aa)&&l(xa,G.lead)||(P=Aa,F.selection.moveToPosition(xa),F.renderer.scrollCursorIntoView(),F.removeSelectionMarkers(pa),pa=G.rectangularRangeBlock(P,qa),F.$mouseHandler.$clickSelection&&1==pa.length&&pa[0].isEmpty()&&(pa[0]=F.$mouseHandler.$clickSelection.clone()),pa.forEach(F.addSelectionMarker,F),F.updateSelectionMarkers())};if(D&&!B)G.toSingleRange();else if(!D&&
B){var Ca=G.toOrientedRange();F.addSelectionMarker(Ca)}q?qa=aa.documentToScreenPosition(G.lead):G.moveToPosition(N);P={row:-1,column:-1};e.capture(F.container,Q,function(){ra();clearInterval(Ga);F.removeSelectionMarkers(pa);pa.length||(pa=[G.toOrientedRange()]);Ca&&(F.removeSelectionMarker(Ca),G.toSingleRange(Ca));for(var Aa=0;Aa<pa.length;Aa++)G.addRange(pa[Aa]);F.inVirtualSelectionMode=!1;F.$mouseHandler.$clickSelection=null});var Ga=setInterval(function(){ra()},20);return h.preventDefault()}}}});
define("ace/commands/multi_select_commands",["require","exports","module","ace/keyboard/hash_handler"],function(a,b){b.defaultCommands=[{name:"addCursorAbove",description:"Add cursor above",exec:function(l){l.selectMoreLines(-1)},bindKey:{win:"Ctrl-Alt-Up",mac:"Ctrl-Alt-Up"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorBelow",description:"Add cursor below",exec:function(l){l.selectMoreLines(1)},bindKey:{win:"Ctrl-Alt-Down",mac:"Ctrl-Alt-Down"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorAboveSkipCurrent",
description:"Add cursor above (skip current)",exec:function(l){l.selectMoreLines(-1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Up",mac:"Ctrl-Alt-Shift-Up"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorBelowSkipCurrent",description:"Add cursor below (skip current)",exec:function(l){l.selectMoreLines(1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Down",mac:"Ctrl-Alt-Shift-Down"},scrollIntoView:"cursor",readOnly:!0},{name:"selectMoreBefore",description:"Select more before",exec:function(l){l.selectMore(-1)},bindKey:{win:"Ctrl-Alt-Left",
mac:"Ctrl-Alt-Left"},scrollIntoView:"cursor",readOnly:!0},{name:"selectMoreAfter",description:"Select more after",exec:function(l){l.selectMore(1)},bindKey:{win:"Ctrl-Alt-Right",mac:"Ctrl-Alt-Right"},scrollIntoView:"cursor",readOnly:!0},{name:"selectNextBefore",description:"Select next before",exec:function(l){l.selectMore(-1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Left",mac:"Ctrl-Alt-Shift-Left"},scrollIntoView:"cursor",readOnly:!0},{name:"selectNextAfter",description:"Select next after",exec:function(l){l.selectMore(1,
!0)},bindKey:{win:"Ctrl-Alt-Shift-Right",mac:"Ctrl-Alt-Shift-Right"},scrollIntoView:"cursor",readOnly:!0},{name:"toggleSplitSelectionIntoLines",description:"Split into lines",exec:function(l){1<l.multiSelect.rangeCount?l.multiSelect.joinSelections():l.multiSelect.splitIntoLines()},bindKey:{win:"Ctrl-Alt-L",mac:"Ctrl-Alt-L"},readOnly:!0},{name:"splitSelectionIntoLines",description:"Split into lines",exec:function(l){l.multiSelect.splitIntoLines()},readOnly:!0},{name:"alignCursors",description:"Align cursors",
exec:function(l){l.alignCursors()},bindKey:{win:"Ctrl-Alt-A",mac:"Ctrl-Alt-A"},scrollIntoView:"cursor"},{name:"findAll",description:"Find all",exec:function(l){l.findAll()},bindKey:{win:"Ctrl-Alt-K",mac:"Ctrl-Alt-G"},scrollIntoView:"cursor",readOnly:!0}];b.multiSelectCommands=[{name:"singleSelection",description:"Single selection",bindKey:"esc",exec:function(l){l.exitMultiSelectMode()},scrollIntoView:"cursor",readOnly:!0,isAvailable:function(l){return l&&l.inMultiSelectMode}}];a=a("../keyboard/hash_handler").HashHandler;
b.keyboardHandler=new a(b.multiSelectCommands)});
define("ace/multi_select","require exports module ace/range_list ace/range ace/selection ace/mouse/multi_select_handler ace/lib/event ace/lib/lang ace/commands/multi_select_commands ace/search ace/edit_session ace/editor ace/config".split(" "),function(a,b){function l(G){G.$multiselectOnSessionChange||(G.$onAddRange=G.$onAddRange.bind(G),G.$onRemoveRange=G.$onRemoveRange.bind(G),G.$onMultiSelect=G.$onMultiSelect.bind(G),G.$onSingleSelect=G.$onSingleSelect.bind(G),G.$multiselectOnSessionChange=b.onSessionChange.bind(G),
G.$checkMultiselectChange=G.$checkMultiselectChange.bind(G),G.$multiselectOnSessionChange(G),G.on("changeSession",G.$multiselectOnSessionChange),G.on("mousedown",m),G.commands.addCommands(B.defaultCommands),e(G))}function e(G){function N(){V&&(G.renderer.setMouseCursor(""),V=!1)}if(G.textInput){var T=G.textInput.getElement(),V=!1;q.addListener(T,"keydown",function(E){E=18==E.keyCode&&!(E.ctrlKey||E.shiftKey||E.metaKey);G.$blockSelectEnabled&&E?V||(G.renderer.setMouseCursor("crosshair"),V=!0):V&&N()},
G);q.addListener(T,"keyup",N,G);q.addListener(T,"blur",N,G)}}var f=a("./range_list").RangeList,h=a("./range").Range,g=a("./selection").Selection,m=a("./mouse/multi_select_handler").onMouseDown,q=a("./lib/event"),r=a("./lib/lang"),B=a("./commands/multi_select_commands");b.commands=B.defaultCommands.concat(B.multiSelectCommands);var D=new (a("./search").Search),F=a("./edit_session").EditSession;(function(){this.getSelectionMarkers=function(){return this.$selectionMarkers}}).call(F.prototype);(function(){this.rangeList=
this.ranges=null;this.addRange=function(G,N){if(G){if(!this.inMultiSelectMode&&0===this.rangeCount){var T=this.toOrientedRange();this.rangeList.add(T);this.rangeList.add(G);if(2!=this.rangeList.ranges.length)return this.rangeList.removeAll(),N||this.fromOrientedRange(G);this.rangeList.removeAll();this.rangeList.add(T);this.$onAddRange(T)}G.cursor||(G.cursor=G.end);T=this.rangeList.add(G);this.$onAddRange(G);T.length&&this.$onRemoveRange(T);1<this.rangeCount&&!this.inMultiSelectMode&&(this._signal("multiSelect"),
this.inMultiSelectMode=!0,this.session.$undoSelect=!1,this.rangeList.attach(this.session));return N||this.fromOrientedRange(G)}};this.toSingleRange=function(G){G=G||this.ranges[0];var N=this.rangeList.removeAll();N.length&&this.$onRemoveRange(N);G&&this.fromOrientedRange(G)};this.substractPoint=function(G){if(G=this.rangeList.substractPoint(G))return this.$onRemoveRange(G),G[0]};this.mergeOverlappingRanges=function(){var G=this.rangeList.merge();G.length&&this.$onRemoveRange(G)};this.$onAddRange=
function(G){this.rangeCount=this.rangeList.ranges.length;this.ranges.unshift(G);this._signal("addRange",{range:G})};this.$onRemoveRange=function(G){this.rangeCount=this.rangeList.ranges.length;if(1==this.rangeCount&&this.inMultiSelectMode){var N=this.rangeList.ranges.pop();G.push(N);this.rangeCount=0}for(var T=G.length;T--;){var V=this.ranges.indexOf(G[T]);this.ranges.splice(V,1)}this._signal("removeRange",{ranges:G});0===this.rangeCount&&this.inMultiSelectMode&&(this.inMultiSelectMode=!1,this._signal("singleSelect"),
this.session.$undoSelect=!0,this.rangeList.detach(this.session));(N=N||this.ranges[0])&&!N.isEqual(this.getRange())&&this.fromOrientedRange(N)};this.$initRangeList=function(){this.rangeList||(this.rangeList=new f,this.ranges=[],this.rangeCount=0)};this.getAllRanges=function(){return this.rangeCount?this.rangeList.ranges.concat():[this.getRange()]};this.splitIntoLines=function(){for(var G=this.ranges.length?this.ranges:[this.getRange()],N=[],T=0;T<G.length;T++){var V=G[T],E=V.start.row,Q=V.end.row;
if(E===Q)N.push(V.clone());else{for(N.push(new h(E,V.start.column,E,this.session.getLine(E).length));++E<Q;)N.push(this.getLineRange(E,!0));N.push(new h(Q,0,Q,V.end.column))}0!=T||this.isBackwards()||(N=N.reverse())}this.toSingleRange();for(T=N.length;T--;)this.addRange(N[T])};this.joinSelections=function(){var G=this.rangeList.ranges,N=G[G.length-1];G=h.fromPoints(G[0].start,N.end);this.toSingleRange();this.setSelectionRange(G,N.cursor==N.start)};this.toggleBlockSelection=function(){if(1<this.rangeCount){var G=
this.rangeList.ranges,N=G[G.length-1];G=h.fromPoints(G[0].start,N.end);this.toSingleRange();this.setSelectionRange(G,N.cursor==N.start)}else N=this.session.documentToScreenPosition(this.cursor),G=this.session.documentToScreenPosition(this.anchor),this.rectangularRangeBlock(N,G).forEach(this.addRange,this)};this.rectangularRangeBlock=function(G,N,T){var V=[],E=G.column<N.column;if(E)var Q=G.column,aa=N.column,qa=G.offsetX,P=N.offsetX;else Q=N.column,aa=G.column,qa=N.offsetX,P=G.offsetX;var ea=G.row<
N.row;if(ea){var ua=G.row;G=N.row}else ua=N.row,G=G.row;0>Q&&(Q=0);0>ua&&(ua=0);ua==G&&(T=!0);for(var Fa;ua<=G;ua++){N=h.fromPoints(this.session.screenToDocumentPosition(ua,Q,qa),this.session.screenToDocumentPosition(ua,aa,P));if(N.isEmpty()){var pa;if(pa=Fa)pa=N.end,pa=pa.row==Fa.row&&pa.column==Fa.column;if(pa)break;Fa=N.end}N.cursor=E?N.start:N.end;V.push(N)}ea&&V.reverse();if(!T){for(T=V.length-1;V[T].isEmpty()&&0<T;)T--;if(0<T)for(var ra=0;V[ra].isEmpty();)ra++;for(;T>=ra;T--)V[T].isEmpty()&&
V.splice(T,1)}return V}}).call(g.prototype);F=a("./editor").Editor;(function(){this.updateSelectionMarkers=function(){this.renderer.updateCursor();this.renderer.updateBackMarkers()};this.addSelectionMarker=function(G){G.cursor||(G.cursor=G.end);var N=this.getSelectionStyle();G.marker=this.session.addMarker(G,"ace_selection",N);this.session.$selectionMarkers.push(G);this.session.selectionMarkerCount=this.session.$selectionMarkers.length;return G};this.removeSelectionMarker=function(G){G.marker&&(this.session.removeMarker(G.marker),
G=this.session.$selectionMarkers.indexOf(G),-1!=G&&this.session.$selectionMarkers.splice(G,1),this.session.selectionMarkerCount=this.session.$selectionMarkers.length)};this.removeSelectionMarkers=function(G){for(var N=this.session.$selectionMarkers,T=G.length;T--;){var V=G[T];V.marker&&(this.session.removeMarker(V.marker),V=N.indexOf(V),-1!=V&&N.splice(V,1))}this.session.selectionMarkerCount=N.length};this.$onAddRange=function(G){this.addSelectionMarker(G.range);this.renderer.updateCursor();this.renderer.updateBackMarkers()};
this.$onRemoveRange=function(G){this.removeSelectionMarkers(G.ranges);this.renderer.updateCursor();this.renderer.updateBackMarkers()};this.$onMultiSelect=function(){this.inMultiSelectMode||(this.inMultiSelectMode=!0,this.setStyle("ace_multiselect"),this.keyBinding.addKeyboardHandler(B.keyboardHandler),this.commands.setDefaultHandler("exec",this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers())};this.$onSingleSelect=function(){this.session.multiSelect.inVirtualMode||
(this.inMultiSelectMode=!1,this.unsetStyle("ace_multiselect"),this.keyBinding.removeKeyboardHandler(B.keyboardHandler),this.commands.removeDefaultHandler("exec",this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers(),this._emit("changeSelection"))};this.$onMultiSelectExec=function(G){var N=G.command,T=G.editor;if(T.multiSelect)return N.multiSelectAction?"forEach"==N.multiSelectAction?G=T.forEachSelection(N,G.args):"forEachLine"==N.multiSelectAction?G=T.forEachSelection(N,
G.args,!0):"single"==N.multiSelectAction?(T.exitMultiSelectMode(),G=N.exec(T,G.args||{})):G=N.multiSelectAction(T,G.args||{}):(G=N.exec(T,G.args||{}),T.multiSelect.addRange(T.multiSelect.toOrientedRange()),T.multiSelect.mergeOverlappingRanges()),G};this.forEachSelection=function(G,N,T){if(!this.inVirtualSelectionMode){var V=1==T||T&&T.$byLines,E=this.session,Q=this.selection,aa=Q.rangeList;T=(T&&T.keepOrder?Q:aa).ranges;var qa;if(!T.length)return G.exec?G.exec(this,N||{}):G(this,N||{});aa=Q._eventRegistry;
Q._eventRegistry={};var P=new g(E);this.inVirtualSelectionMode=!0;for(var ea=T.length;ea--;){if(V)for(;0<ea&&T[ea].start.row==T[ea-1].end.row;)ea--;P.fromOrientedRange(T[ea]);P.index=ea;this.selection=E.selection=P;var ua=G.exec?G.exec(this,N||{}):G(this,N||{});qa||void 0===ua||(qa=ua);P.toOrientedRange(T[ea])}P.detach();this.selection=E.selection=Q;this.inVirtualSelectionMode=!1;Q._eventRegistry=aa;Q.mergeOverlappingRanges();Q.ranges[0]&&Q.fromOrientedRange(Q.ranges[0]);G=this.renderer.$scrollAnimation;
this.onCursorChange();this.onSelectionChange();G&&G.from==G.to&&this.renderer.animateScrolling(G.from);return qa}};this.exitMultiSelectMode=function(){this.inMultiSelectMode&&!this.inVirtualSelectionMode&&this.multiSelect.toSingleRange()};this.getSelectedText=function(){var G="";if(this.inMultiSelectMode&&!this.inVirtualSelectionMode){G=this.multiSelect.rangeList.ranges;for(var N=[],T=0;T<G.length;T++)N.push(this.session.getTextRange(G[T]));T=this.session.getDocument().getNewLineCharacter();G=N.join(T);
G.length==(N.length-1)*T.length&&(G="")}else this.selection.isEmpty()||(G=this.session.getTextRange(this.getSelectionRange()));return G};this.$checkMultiselectChange=function(G,N){this.inMultiSelectMode&&!this.inVirtualSelectionMode&&(G=this.multiSelect.ranges[0],this.multiSelect.isEmpty()&&N==this.multiSelect.anchor||(G=N==this.multiSelect.anchor?G.cursor==G.start?G.end:G.start:G.cursor,G.row!=N.row||this.session.$clipPositionToDocument(G.row,G.column).column!=N.column?this.multiSelect.toSingleRange(this.multiSelect.toOrientedRange()):
this.multiSelect.mergeOverlappingRanges()))};this.findAll=function(G,N,T){N=N||{};N.needle=G||N.needle;if(void 0==N.needle){var V=this.selection.isEmpty()?this.selection.getWordRange():this.selection.getRange();N.needle=this.session.getTextRange(V)}this.$search.set(N);G=this.$search.findAll(this.session);if(!G.length)return 0;N=this.multiSelect;T||N.toSingleRange(G[0]);for(T=G.length;T--;)N.addRange(G[T],!0);V&&N.rangeList.rangeAtPoint(V.start)&&N.addRange(V,!0);return G.length};this.selectMoreLines=
function(G,N){var T=this.selection.toOrientedRange(),V=T.cursor==T.end,E=this.session.documentToScreenPosition(T.cursor);this.selection.$desiredColumn&&(E.column=this.selection.$desiredColumn);var Q=this.session.screenToDocumentPosition(E.row+G,E.column);if(T.isEmpty())G=Q;else{var aa=this.session.documentToScreenPosition(V?T.end:T.start);G=this.session.screenToDocumentPosition(aa.row+G,aa.column)}V?(V=h.fromPoints(Q,G),V.cursor=V.start):(V=h.fromPoints(G,Q),V.cursor=V.end);V.desiredColumn=E.column;
if(!this.selection.inMultiSelectMode)this.selection.addRange(T);else if(N)var qa=T.cursor;this.selection.addRange(V);qa&&this.selection.substractPoint(qa)};this.transposeSelections=function(G){for(var N=this.session,T=N.multiSelect,V=T.ranges,E=V.length;E--;){var Q=V[E];if(Q.isEmpty()){var aa=N.getWordRange(Q.start.row,Q.start.column);Q.start.row=aa.start.row;Q.start.column=aa.start.column;Q.end.row=aa.end.row;Q.end.column=aa.end.column}}T.mergeOverlappingRanges();var qa=[];for(E=V.length;E--;)Q=
V[E],qa.unshift(N.getTextRange(Q));0>G?qa.unshift(qa.pop()):qa.push(qa.shift());for(E=V.length;E--;)Q=V[E],aa=Q.clone(),N.replace(Q,qa[E]),Q.start.row=aa.start.row,Q.start.column=aa.start.column;T.fromOrientedRange(T.ranges[0])};this.selectMore=function(G,N,T){var V=this.session,E=V.multiSelect.toOrientedRange();if(E.isEmpty()&&(E=V.getWordRange(E.start.row,E.start.column),E.cursor=-1==G?E.start:E.end,this.multiSelect.addRange(E),T))return;T=V.getTextRange(E);D.$options.wrap=!0;D.$options.needle=
T;D.$options.backwards=-1==G;if(V=D.find(V))V.cursor=-1==G?V.start:V.end,this.session.unfold(V),this.multiSelect.addRange(V),this.renderer.scrollCursorIntoView(null,.5);N&&this.multiSelect.substractPoint(E.cursor)};this.alignCursors=function(){var G=this.session,N=G.multiSelect,T=N.ranges,V=-1,E=T.filter(function(pa){if(pa.cursor.row==V)return!0;V=pa.cursor.row});if(T.length&&E.length!=T.length-1){E.forEach(function(pa){N.substractPoint(pa.cursor)});var Q=0,aa=Infinity,qa=T.map(function(pa){pa=pa.cursor;
var ra=G.getLine(pa.row).substr(pa.column).search(/\S/g);-1==ra&&(ra=0);pa.column>Q&&(Q=pa.column);ra<aa&&(aa=ra);return ra});T.forEach(function(pa,ra){var Ca=pa.cursor,Ga=Q-Ca.column;ra=qa[ra]-aa;Ga>ra?G.insert(Ca,r.stringRepeat(" ",Ga-ra)):G.remove(new h(Ca.row,Ca.column,Ca.row,Ca.column-Ga+ra));pa.start.column=pa.end.column=Q;pa.start.row=pa.end.row=Ca.row;pa.cursor=pa.end});N.fromOrientedRange(T[0]);this.renderer.updateCursor();this.renderer.updateBackMarkers()}else{T=this.selection.getRange();
E=T.start.row;var P=T.end.row,ea=E==P;if(ea){var ua=this.session.getLength();do var Fa=this.session.getLine(P);while(/[=:]/.test(Fa)&&++P<ua);do Fa=this.session.getLine(E);while(/[=:]/.test(Fa)&&0<--E);0>E&&(E=0);P>=ua&&(P=ua-1)}P=this.session.removeFullLines(E,P);P=this.$reAlignText(P,ea);this.session.insert({row:E,column:0},P.join("\n")+"\n");ea||(T.start.column=0,T.end.column=P[P.length-1].length);this.selection.setRange(T)}};this.$reAlignText=function(G,N){function T(Fa){return r.stringRepeat(" ",
Fa)}function V(Fa){return Fa[2]?T(P)+Fa[2]+T(ea-Fa[2].length+ua)+Fa[4].replace(/^([=:])\s+/,"$1 "):Fa[0]}function E(Fa){return Fa[2]?T(P+ea-Fa[2].length)+Fa[2]+T(ua)+Fa[4].replace(/^([=:])\s+/,"$1 "):Fa[0]}function Q(Fa){return Fa[2]?T(P)+Fa[2]+T(ua)+Fa[4].replace(/^([=:])\s+/,"$1 "):Fa[0]}var aa=!0,qa=!0,P,ea,ua;return G.map(function(Fa){var pa=Fa.match(/(\s*)(.*?)(\s*)([=:].*)/);if(!pa)return[Fa];if(null==P)return P=pa[1].length,ea=pa[2].length,ua=pa[3].length,pa;P+ea+ua!=pa[1].length+pa[2].length+
pa[3].length&&(qa=!1);P!=pa[1].length&&(aa=!1);P>pa[1].length&&(P=pa[1].length);ea<pa[2].length&&(ea=pa[2].length);ua>pa[3].length&&(ua=pa[3].length);return pa}).map(N?V:aa?qa?E:V:Q)}}).call(F.prototype);b.onSessionChange=function(G){var N=G.session;N&&!N.multiSelect&&(N.$selectionMarkers=[],N.selection.$initRangeList(),N.multiSelect=N.selection);this.multiSelect=N&&N.multiSelect;if(G=G.oldSession)G.multiSelect.off("addRange",this.$onAddRange),G.multiSelect.off("removeRange",this.$onRemoveRange),
G.multiSelect.off("multiSelect",this.$onMultiSelect),G.multiSelect.off("singleSelect",this.$onSingleSelect),G.multiSelect.lead.off("change",this.$checkMultiselectChange),G.multiSelect.anchor.off("change",this.$checkMultiselectChange);N&&(N.multiSelect.on("addRange",this.$onAddRange),N.multiSelect.on("removeRange",this.$onRemoveRange),N.multiSelect.on("multiSelect",this.$onMultiSelect),N.multiSelect.on("singleSelect",this.$onSingleSelect),N.multiSelect.lead.on("change",this.$checkMultiselectChange),
N.multiSelect.anchor.on("change",this.$checkMultiselectChange));N&&this.inMultiSelectMode!=N.selection.inMultiSelectMode&&(N.selection.inMultiSelectMode?this.$onMultiSelect():this.$onSingleSelect())};b.MultiSelect=l;a("./config").defineOptions(F.prototype,"editor",{enableMultiselect:{set:function(G){l(this);G?(this.on("changeSession",this.$multiselectOnSessionChange),this.on("mousedown",m)):(this.off("changeSession",this.$multiselectOnSessionChange),this.off("mousedown",m))},value:!0},enableBlockSelect:{set:function(G){this.$blockSelectEnabled=
G},value:!0}})});
define("ace/mode/folding/fold_mode",["require","exports","module","ace/range"],function(a,b){var l=a("../../range").Range;a=b.FoldMode=function(){};(function(){this.foldingStopMarker=this.foldingStartMarker=null;this.getFoldWidget=function(e,f,h){e=e.getLine(h);return this.foldingStartMarker.test(e)?"start":"markbeginend"==f&&this.foldingStopMarker&&this.foldingStopMarker.test(e)?"end":""};this.getFoldWidgetRange=function(){return null};this.indentationBlock=function(e,f,h){var g=/\S/,m=e.getLine(f),
q=m.search(g);if(-1!=q){h=h||m.length;for(var r=e.getLength(),B=m=f;++f<r;){var D=e.getLine(f).search(g);if(-1!=D){if(D<=q&&(D=e.getTokenAt(f,0),!D||"string"!==D.type))break;B=f}}if(B>m)return e=e.getLine(B).length,new l(m,h,B,e)}};this.openingBracketBlock=function(e,f,h,g,m){h={row:h,column:g+1};if(f=e.$findClosingBracket(f,h,m))return m=e.foldWidgets[f.row],null==m&&(m=e.getFoldWidget(f.row)),"start"==m&&f.row>h.row&&(f.row--,f.column=e.getLine(f.row).length),l.fromPoints(h,f)};this.closingBracketBlock=
function(e,f,h,g){h={row:h,column:g};if(e=e.$findOpeningBracket(f,h))return e.column++,h.column--,l.fromPoints(e,h)}}).call(a.prototype)});
define("ace/theme/textmate",["require","exports","module","ace/lib/dom"],function(a,b){b.isDark=!1;b.cssClass="ace-tm";b.cssText='.ace-tm .ace_gutter {background: #f0f0f0;color: #333;}.ace-tm .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-tm .ace_fold {background-color: #6B72E6;}.ace-tm {background-color: #FFFFFF;color: black;}.ace-tm .ace_cursor {color: black;}.ace-tm .ace_invisible {color: rgb(191, 191, 191);}.ace-tm .ace_storage,.ace-tm .ace_keyword {color: blue;}.ace-tm .ace_constant {color: rgb(197, 6, 11);}.ace-tm .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-tm .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-tm .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-tm .ace_invalid {background-color: rgba(255, 0, 0, 0.1);color: red;}.ace-tm .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-tm .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-tm .ace_support.ace_type,.ace-tm .ace_support.ace_class {color: rgb(109, 121, 222);}.ace-tm .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-tm .ace_string {color: rgb(3, 106, 7);}.ace-tm .ace_comment {color: rgb(76, 136, 107);}.ace-tm .ace_comment.ace_doc {color: rgb(0, 102, 255);}.ace-tm .ace_comment.ace_doc.ace_tag {color: rgb(128, 159, 191);}.ace-tm .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-tm .ace_variable {color: rgb(49, 132, 149);}.ace-tm .ace_xml-pe {color: rgb(104, 104, 91);}.ace-tm .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-tm .ace_heading {color: rgb(12, 7, 255);}.ace-tm .ace_list {color:rgb(185, 6, 144);}.ace-tm .ace_meta.ace_tag {color:rgb(0, 22, 142);}.ace-tm .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-tm .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-tm.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px white;}.ace-tm .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-tm .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-tm .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-tm .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-tm .ace_gutter-active-line {background-color : #dcdcdc;}.ace-tm .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-tm .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}';b.$id=
"ace/theme/textmate";a("../lib/dom").importCssString(b.cssText,b.cssClass)});
define("ace/line_widgets",["require","exports","module","ace/lib/dom"],function(a,b){function l(f){this.session=f;this.session.widgetManager=this;this.session.getRowLength=this.getRowLength;this.session.$getWidgetScreenLength=this.$getWidgetScreenLength;this.updateOnChange=this.updateOnChange.bind(this);this.renderWidgets=this.renderWidgets.bind(this);this.measureWidgets=this.measureWidgets.bind(this);this.session._changedWidgets=[];this.$onChangeEditor=this.$onChangeEditor.bind(this);this.session.on("change",
this.updateOnChange);this.session.on("changeFold",this.updateOnFold);this.session.on("changeEditor",this.$onChangeEditor)}var e=a("./lib/dom");(function(){this.getRowLength=function(f){var h=this.lineWidgets?this.lineWidgets[f]&&this.lineWidgets[f].rowCount||0:0;return this.$useWrapMode&&this.$wrapData[f]?this.$wrapData[f].length+1+h:1+h};this.$getWidgetScreenLength=function(){var f=0;this.lineWidgets.forEach(function(h){h&&h.rowCount&&!h.hidden&&(f+=h.rowCount)});return f};this.$onChangeEditor=function(f){this.attach(f.editor)};
this.attach=function(f){f&&f.widgetManager&&f.widgetManager!=this&&f.widgetManager.detach();this.editor!=f&&(this.detach(),this.editor=f)&&(f.widgetManager=this,f.renderer.on("beforeRender",this.measureWidgets),f.renderer.on("afterRender",this.renderWidgets))};this.detach=function(){var f=this.editor;f&&(this.editor=null,f.widgetManager=null,f.renderer.off("beforeRender",this.measureWidgets),f.renderer.off("afterRender",this.renderWidgets),(f=this.session.lineWidgets)&&f.forEach(function(h){h&&h.el&&
h.el.parentNode&&(h._inDocument=!1,h.el.parentNode.removeChild(h.el))}))};this.updateOnFold=function(f,h){if((h=h.lineWidgets)&&f.action){var g=f.data,m=g.start.row;g=g.end.row;f="add"==f.action;for(var q=m+1;q<g;q++)h[q]&&(h[q].hidden=f);h[g]&&(f?h[m]?h[g].hidden=f:h[m]=h[g]:(h[m]==h[g]&&(h[m]=void 0),h[g].hidden=f))}};this.updateOnChange=function(f){var h=this.session.lineWidgets;if(h){var g=f.start.row,m=f.end.row-g;0!==m&&("remove"==f.action?(f=h.splice(g+1,m),!h[g]&&f[f.length-1]&&(h[g]=f.pop()),
f.forEach(function(q){q&&this.removeLineWidget(q)},this)):(m=Array(m),h[g]&&null!=h[g].column&&f.start.column>h[g].column&&g++,m.unshift(g,0),h.splice.apply(h,m)),this.$updateRows())}};this.$updateRows=function(){var f=this.session.lineWidgets;if(f){var h=!0;f.forEach(function(g,m){if(g)for(h=!1,g.row=m;g.$oldWidget;)g.$oldWidget.row=m,g=g.$oldWidget});h&&(this.session.lineWidgets=null)}};this.$registerLineWidget=function(f){this.session.lineWidgets||(this.session.lineWidgets=Array(this.session.getLength()));
var h=this.session.lineWidgets[f.row];h&&(f.$oldWidget=h,h.el&&h.el.parentNode&&(h.el.parentNode.removeChild(h.el),h._inDocument=!1));return this.session.lineWidgets[f.row]=f};this.addLineWidget=function(f){this.$registerLineWidget(f);f.session=this.session;if(!this.editor)return f;var h=this.editor.renderer;f.html&&!f.el&&(f.el=e.createElement("div"),f.el.innerHTML=f.html);f.el&&(e.addCssClass(f.el,"ace_lineWidgetContainer"),f.el.style.position="absolute",f.el.style.zIndex=5,h.container.appendChild(f.el),
f._inDocument=!0,f.coverGutter||(f.el.style.zIndex=3),null==f.pixelHeight&&(f.pixelHeight=f.el.offsetHeight));null==f.rowCount&&(f.rowCount=f.pixelHeight/h.layerConfig.lineHeight);var g=this.session.getFoldAt(f.row,0);if(f.$fold=g){var m=this.session.lineWidgets;f.row!=g.end.row||m[g.start.row]?f.hidden=!0:m[g.start.row]=f}this.session._emit("changeFold",{data:{start:{row:f.row}}});this.$updateRows();this.renderWidgets(null,h);this.onWidgetChanged(f);return f};this.removeLineWidget=function(f){f._inDocument=
!1;f.session=null;f.el&&f.el.parentNode&&f.el.parentNode.removeChild(f.el);if(f.editor&&f.editor.destroy)try{f.editor.destroy()}catch(g){}if(this.session.lineWidgets){var h=this.session.lineWidgets[f.row];if(h==f){if(this.session.lineWidgets[f.row]=f.$oldWidget)this.onWidgetChanged(f.$oldWidget)}else for(;h;){if(h.$oldWidget==f){h.$oldWidget=f.$oldWidget;break}h=h.$oldWidget}}this.session._emit("changeFold",{data:{start:{row:f.row}}});this.$updateRows()};this.getWidgetsAtRow=function(f){var h=this.session.lineWidgets;
f=h&&h[f];for(h=[];f;)h.push(f),f=f.$oldWidget;return h};this.onWidgetChanged=function(f){this.session._changedWidgets.push(f);this.editor&&this.editor.renderer.updateFull()};this.measureWidgets=function(f,h){f=this.session._changedWidgets;var g=h.layerConfig;if(f&&f.length){for(var m=Infinity,q=0;q<f.length;q++){var r=f[q];if(r&&r.el&&r.session==this.session){if(!r._inDocument){if(this.session.lineWidgets[r.row]!=r)continue;r._inDocument=!0;h.container.appendChild(r.el)}r.h=r.el.offsetHeight;r.fixedWidth||
(r.w=r.el.offsetWidth,r.screenWidth=Math.ceil(r.w/g.characterWidth));var B=r.h/g.lineHeight;r.coverLine&&(B-=this.session.getRowLineCount(r.row),0>B&&(B=0));r.rowCount!=B&&(r.rowCount=B,r.row<m&&(m=r.row))}}Infinity!=m&&(this.session._emit("changeFold",{data:{start:{row:m}}}),this.session.lineWidgetWidth=null);this.session._changedWidgets=[]}};this.renderWidgets=function(f,h){f=h.layerConfig;var g=this.session.lineWidgets;if(g){for(var m=Math.min(this.firstRow,f.firstRow),q=Math.max(this.lastRow,
f.lastRow,g.length);0<m&&!g[m];)m--;this.firstRow=f.firstRow;this.lastRow=f.lastRow;for(h.$cursorLayer.config=f;m<=q;m++){var r=g[m];if(r&&r.el)if(r.hidden)r.el.style.top=-100-(r.pixelHeight||0)+"px";else{r._inDocument||(r._inDocument=!0,h.container.appendChild(r.el));var B=h.$cursorLayer.getPixelPosition({row:m,column:0},!0).top;r.coverLine||(B+=f.lineHeight*this.session.getRowLineCount(r.row));r.el.style.top=B-f.offset+"px";B=r.coverGutter?0:h.gutterWidth;r.fixedWidth||(B-=h.scrollLeft);r.el.style.left=
B+"px";r.fullWidth&&r.screenWidth&&(r.el.style.minWidth=f.width+2*f.padding+"px");r.el.style.right=r.fixedWidth?h.scrollBar.getWidth()+"px":""}}}}}).call(l.prototype);b.LineWidgets=l});
define("ace/ext/error_marker","require exports module ace/line_widgets ace/lib/dom ace/range".split(" "),function(a,b){function l(g,m,q){g=g.getAnnotations().sort(h.comparePoints);if(g.length){a:{var r={row:m,column:-1};for(var B=h.comparePoints,D=0,F=g.length-1;D<=F;){var G=D+F>>1,N=B(r,g[G]);if(0<N)D=G+1;else if(0>N)F=G-1;else{r=G;break a}}r=-(D+1)}0>r&&(r=-r-1);r>=g.length?r=0<q?0:g.length-1:0===r&&0>q&&(r=g.length-1);if((B=g[r])&&q){if(B.row===m){do B=g[r+=q];while(B&&B.row===m);if(!B)return g.slice()}D=
[];m=B.row;do D[0>q?"unshift":"push"](B),B=g[r+=q];while(B&&B.row==m);return D.length&&D}}}var e=a("../line_widgets").LineWidgets,f=a("../lib/dom"),h=a("../range").Range;b.showErrorMarker=function(g,m){function q(N,T,V){if(0===T&&("esc"===V||"return"===V))return G.destroy(),{command:"null"}}var r=g.session;r.widgetManager||(r.widgetManager=new e(r),r.widgetManager.attach(g));var B=g.getCursorPosition(),D=B.row,F=r.widgetManager.getWidgetsAtRow(D).filter(function(N){return"errorMarker"==N.type})[0];
F?F.destroy():D-=m;if(m=l(r,D,m))F=m[0],B.column=(F.pos&&"number"!=typeof F.column?F.pos.sc:F.column)||0,B.row=F.row,F=g.renderer.$gutterLayer.$annotations[B.row];else{if(F)return;F={text:["Looks good!"],className:"ace_ok"}}g.session.unfold(B.row);g.selection.moveToPosition(B);var G={row:B.row,fixedWidth:!0,coverGutter:!0,el:f.createElement("div"),type:"errorMarker"};m=G.el.appendChild(f.createElement("div"));D=G.el.appendChild(f.createElement("div"));D.className="error_widget_arrow "+F.className;
B=g.renderer.$cursorLayer.getPixelPosition(B).left;D.style.left=B+g.renderer.gutterWidth-5+"px";G.el.className="error_widget_wrapper";m.className="error_widget "+F.className;m.innerHTML=F.text.join("<br>");m.appendChild(f.createElement("div"));G.destroy=function(){g.$mouseHandler.isMousePressed||(g.keyBinding.removeKeyboardHandler(q),r.widgetManager.removeLineWidget(G),g.off("changeSelection",G.destroy),g.off("changeSession",G.destroy),g.off("mouseup",G.destroy),g.off("change",G.destroy))};g.keyBinding.addKeyboardHandler(q);
g.on("changeSelection",G.destroy);g.on("changeSession",G.destroy);g.on("mouseup",G.destroy);g.on("change",G.destroy);g.session.widgetManager.addLineWidget(G);G.el.onmousedown=g.focus.bind(g);g.renderer.scrollCursorIntoView(null,.5,{bottom:G.el.offsetHeight})};f.importCssString("    .error_widget_wrapper {        background: inherit;        color: inherit;        border:none    }    .error_widget {        border-top: solid 2px;        border-bottom: solid 2px;        margin: 5px 0;        padding: 10px 40px;        white-space: pre-wrap;    }    .error_widget.ace_error, .error_widget_arrow.ace_error{        border-color: #ff5a5a    }    .error_widget.ace_warning, .error_widget_arrow.ace_warning{        border-color: #F1D817    }    .error_widget.ace_info, .error_widget_arrow.ace_info{        border-color: #5a5a5a    }    .error_widget.ace_ok, .error_widget_arrow.ace_ok{        border-color: #5aaa5a    }    .error_widget_arrow {        position: absolute;        border: solid 5px;        border-top-color: transparent!important;        border-right-color: transparent!important;        border-left-color: transparent!important;        top: -5px;    }",
"")});
define("ace/ace","require exports module ace/lib/fixoldbrowsers ace/lib/dom ace/lib/event ace/range ace/editor ace/edit_session ace/undomanager ace/virtual_renderer ace/worker/worker_client ace/keyboard/hash_handler ace/placeholder ace/multi_select ace/mode/folding/fold_mode ace/theme/textmate ace/ext/error_marker ace/config".split(" "),function(a,b){a("./lib/fixoldbrowsers");var l=a("./lib/dom"),e=a("./lib/event"),f=a("./range").Range,h=a("./editor").Editor,g=a("./edit_session").EditSession,m=a("./undomanager").UndoManager,
q=a("./virtual_renderer").VirtualRenderer;a("./worker/worker_client");a("./keyboard/hash_handler");a("./placeholder");a("./multi_select");a("./mode/folding/fold_mode");a("./theme/textmate");a("./ext/error_marker");b.config=a("./config");b.require=a;"function"===typeof define&&(b.define=define);b.edit=function(r,B){if("string"==typeof r){var D=r;r=document.getElementById(D);if(!r)throw Error("ace.edit can't find div #"+D);}if(r&&r.env&&r.env.editor instanceof h)return r.env.editor;D="";if(r&&/input|textarea/i.test(r.tagName)){var F=
r;D=F.value;r=l.createElement("pre");F.parentNode.replaceChild(r,F)}else r&&(D=r.textContent,r.innerHTML="");D=b.createEditSession(D);r=new h(new q(r),D,B);var G={document:D,editor:r,onResize:r.resize.bind(r,null)};F&&(G.textarea=F);e.addListener(window,"resize",G.onResize);r.on("destroy",function(){e.removeListener(window,"resize",G.onResize);G.editor.container.env=null});r.container.env=r.env=G;return r};b.createEditSession=function(r,B){r=new g(r,B);r.setUndoManager(new m);return r};b.Range=f;
b.Editor=h;b.EditSession=g;b.UndoManager=m;b.VirtualRenderer=q;b.version=b.config.version});window.require(["ace/ace"],function(a){a&&(a.config.init(!0),a.define=window.define);window.ace||(window.ace=a);for(var b in a)a.hasOwnProperty(b)&&(window.ace[b]=a[b]);window.ace["default"]=window.ace;"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=window.ace)});
define("ace/mode/doc_comment_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(a,b){function l(){this.$rules={start:[{token:"comment.doc.tag",regex:"@[\\w\\d_]+"},l.getTagRule(),{defaultToken:"comment.doc",caseInsensitive:!0}]}}var e=a("../lib/oop");a=a("./text_highlight_rules").TextHighlightRules;e.inherits(l,a);l.getTagRule=function(){return{token:"comment.doc.tag.storage.type",regex:"\\b(?:TODO|FIXME|XXX|HACK)\\b"}};l.getStartRule=function(f){return{token:"comment.doc",
regex:"\\/\\*(?=\\*)",next:f}};l.getEndRule=function(f){return{token:"comment.doc",regex:"\\*\\/",next:f}};b.DocCommentHighlightRules=l});
define("ace/mode/c_cpp_highlight_rules","require exports module ace/lib/oop ace/mode/doc_comment_highlight_rules ace/mode/text_highlight_rules".split(" "),function(a,b){function l(){var g=this.$keywords=this.createKeywordMapper({"keyword.control":"break|case|continue|default|do|else|for|goto|if|_Pragma|return|switch|while|catch|operator|try|throw|using","storage.type":"asm|__asm__|auto|bool|_Bool|char|_Complex|double|enum|float|_Imaginary|int|long|short|signed|struct|typedef|union|unsigned|void|class|wchar_t|template|char16_t|char32_t","storage.modifier":"const|extern|register|restrict|static|volatile|inline|private|protected|public|friend|explicit|virtual|export|mutable|typename|constexpr|new|delete|alignas|alignof|decltype|noexcept|thread_local",
"keyword.operator":"and|and_eq|bitand|bitor|compl|not|not_eq|or|or_eq|typeid|xor|xor_eq|const_cast|dynamic_cast|reinterpret_cast|static_cast|sizeof|namespace","variable.language":"this","constant.language":"NULL|true|false|TRUE|FALSE|nullptr"},"identifier"),m=/\\(?:['"?\\abfnrtv]|[0-7]{1,3}|x[a-fA-F\d]{2}|u[a-fA-F\d]{4}U[a-fA-F\d]{8}|.)/.source,q="%"+/(\d+\$)?/.source+/[#0\- +']*/.source+/[,;:_]?/.source+/((-?\d+)|\*(-?\d+\$)?)?/.source+/(\.((-?\d+)|\*(-?\d+\$)?)?)?/.source+/(hh|h|ll|l|j|t|z|q|L|vh|vl|v|hv|hl)?/.source+
/(\[[^"\]]+\]|[diouxXDOUeEfFgGaACcSspn%])/.source;this.$rules={start:[{token:"comment",regex:"//$",next:"start"},{token:"comment",regex:"//",next:"singleLineComment"},{token:"comment",regex:"#",next:"singleLineComment"},f.getStartRule("doc-start"),{token:"comment",regex:"\\/\\*",next:"comment"},{token:"string",regex:"'(?:"+m+"|.)?'"},{token:"string.start",regex:'"',stateName:"qqstring",next:[{token:"string",regex:/\\\s*$/,next:"qqstring"},{token:"constant.language.escape",regex:m},{token:"constant.language.escape",
regex:q},{token:"string.end",regex:'"|$',next:"start"},{defaultToken:"string"}]},{token:"string.start",regex:'R"\\(',stateName:"rawString",next:[{token:"string.end",regex:'\\)"',next:"start"},{defaultToken:"string"}]},{token:"constant.numeric",regex:"0[xX][0-9a-fA-F]+(L|l|UL|ul|u|U|F|f|ll|LL|ull|ULL)?\\b"},{token:"constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?(L|l|UL|ul|u|U|F|f|ll|LL|ull|ULL)?\\b"},{token:"keyword",regex:"#\\s*(?:include|import|pragma|line|define|undef)\\b",
next:"directive"},{token:"keyword",regex:"#\\s*(?:endif|if|ifdef|else|elif|ifndef)\\b"},{token:"support.function.C99.c",regex:h},{token:g,regex:"[a-zA-Z_$][a-zA-Z0-9_$]*"},{token:"keyword.operator",regex:/--|\+\+|<<=|>>=|>>>=|<>|&&|\|\||\?:|[*%\/+\-&\^|~!<>=]=?/},{token:"punctuation.operator",regex:"\\?|\\:|\\,|\\;|\\."},{token:"paren.lparen",regex:"[[({]"},{token:"paren.rparen",regex:"[\\])}]"},{token:"text",regex:"\\s+"}],comment:[{token:"comment",regex:"\\*\\/",next:"start"},{defaultToken:"comment"}],
singleLineComment:[{token:"comment",regex:/\\$/,next:"singleLineComment"},{token:"comment",regex:/$/,next:"start"},{defaultToken:"comment"}],directive:[{token:"constant.other.multiline",regex:/\\/},{token:"constant.other.multiline",regex:/.*\\/},{token:"constant.other",regex:"\\s*<.+?>",next:"start"},{token:"constant.other",regex:'\\s*["](?:(?:\\\\.)|(?:[^"\\\\]))*?["]',next:"start"},{token:"constant.other",regex:"\\s*['](?:(?:\\\\.)|(?:[^'\\\\]))*?[']",next:"start"},{token:"constant.other",regex:/[^\\\/]+/,
next:"start"}]};this.embedRules(f,"doc-",[f.getEndRule("start")]);this.normalizeRules()}var e=a("../lib/oop"),f=a("./doc_comment_highlight_rules").DocCommentHighlightRules;a=a("./text_highlight_rules").TextHighlightRules;var h=b.cFunctions="\\b(?:hypot(?:f|l)?|s(?:scanf|ystem|nprintf|ca(?:nf|lb(?:n(?:f|l)?|ln(?:f|l)?))|i(?:n(?:h(?:f|l)?|f|l)?|gn(?:al|bit))|tr(?:s(?:tr|pn)|nc(?:py|at|mp)|c(?:spn|hr|oll|py|at|mp)|to(?:imax|d|u(?:l(?:l)?|max)|k|f|l(?:d|l)?)|error|pbrk|ftime|len|rchr|xfrm)|printf|et(?:jmp|vbuf|locale|buf)|qrt(?:f|l)?|w(?:scanf|printf)|rand)|n(?:e(?:arbyint(?:f|l)?|xt(?:toward(?:f|l)?|after(?:f|l)?))|an(?:f|l)?)|c(?:s(?:in(?:h(?:f|l)?|f|l)?|qrt(?:f|l)?)|cos(?:h(?:f)?|f|l)?|imag(?:f|l)?|t(?:ime|an(?:h(?:f|l)?|f|l)?)|o(?:s(?:h(?:f|l)?|f|l)?|nj(?:f|l)?|pysign(?:f|l)?)|p(?:ow(?:f|l)?|roj(?:f|l)?)|e(?:il(?:f|l)?|xp(?:f|l)?)|l(?:o(?:ck|g(?:f|l)?)|earerr)|a(?:sin(?:h(?:f|l)?|f|l)?|cos(?:h(?:f|l)?|f|l)?|tan(?:h(?:f|l)?|f|l)?|lloc|rg(?:f|l)?|bs(?:f|l)?)|real(?:f|l)?|brt(?:f|l)?)|t(?:ime|o(?:upper|lower)|an(?:h(?:f|l)?|f|l)?|runc(?:f|l)?|gamma(?:f|l)?|mp(?:nam|file))|i(?:s(?:space|n(?:ormal|an)|cntrl|inf|digit|u(?:nordered|pper)|p(?:unct|rint)|finite|w(?:space|c(?:ntrl|type)|digit|upper|p(?:unct|rint)|lower|al(?:num|pha)|graph|xdigit|blank)|l(?:ower|ess(?:equal|greater)?)|al(?:num|pha)|gr(?:eater(?:equal)?|aph)|xdigit|blank)|logb(?:f|l)?|max(?:div|abs))|di(?:v|fftime)|_Exit|unget(?:c|wc)|p(?:ow(?:f|l)?|ut(?:s|c(?:har)?|wc(?:har)?)|error|rintf)|e(?:rf(?:c(?:f|l)?|f|l)?|x(?:it|p(?:2(?:f|l)?|f|l|m1(?:f|l)?)?))|v(?:s(?:scanf|nprintf|canf|printf|w(?:scanf|printf))|printf|f(?:scanf|printf|w(?:scanf|printf))|w(?:scanf|printf)|a_(?:start|copy|end|arg))|qsort|f(?:s(?:canf|e(?:tpos|ek))|close|tell|open|dim(?:f|l)?|p(?:classify|ut(?:s|c|w(?:s|c))|rintf)|e(?:holdexcept|set(?:e(?:nv|xceptflag)|round)|clearexcept|testexcept|of|updateenv|r(?:aiseexcept|ror)|get(?:e(?:nv|xceptflag)|round))|flush|w(?:scanf|ide|printf|rite)|loor(?:f|l)?|abs(?:f|l)?|get(?:s|c|pos|w(?:s|c))|re(?:open|e|ad|xp(?:f|l)?)|m(?:in(?:f|l)?|od(?:f|l)?|a(?:f|l|x(?:f|l)?)?))|l(?:d(?:iv|exp(?:f|l)?)|o(?:ngjmp|cal(?:time|econv)|g(?:1(?:p(?:f|l)?|0(?:f|l)?)|2(?:f|l)?|f|l|b(?:f|l)?)?)|abs|l(?:div|abs|r(?:int(?:f|l)?|ound(?:f|l)?))|r(?:int(?:f|l)?|ound(?:f|l)?)|gamma(?:f|l)?)|w(?:scanf|c(?:s(?:s(?:tr|pn)|nc(?:py|at|mp)|c(?:spn|hr|oll|py|at|mp)|to(?:imax|d|u(?:l(?:l)?|max)|k|f|l(?:d|l)?|mbs)|pbrk|ftime|len|r(?:chr|tombs)|xfrm)|to(?:b|mb)|rtomb)|printf|mem(?:set|c(?:hr|py|mp)|move))|a(?:s(?:sert|ctime|in(?:h(?:f|l)?|f|l)?)|cos(?:h(?:f|l)?|f|l)?|t(?:o(?:i|f|l(?:l)?)|exit|an(?:h(?:f|l)?|2(?:f|l)?|f|l)?)|b(?:s|ort))|g(?:et(?:s|c(?:har)?|env|wc(?:har)?)|mtime)|r(?:int(?:f|l)?|ound(?:f|l)?|e(?:name|alloc|wind|m(?:ove|quo(?:f|l)?|ainder(?:f|l)?))|a(?:nd|ise))|b(?:search|towc)|m(?:odf(?:f|l)?|em(?:set|c(?:hr|py|mp)|move)|ktime|alloc|b(?:s(?:init|towcs|rtowcs)|towc|len|r(?:towc|len))))\\b";
e.inherits(l,a);b.c_cppHighlightRules=l});
define("ace/mode/matching_brace_outdent",["require","exports","module","ace/range"],function(a,b){function l(){}var e=a("../range").Range;(function(){this.checkOutdent=function(f,h){return/^\s+$/.test(f)?/^\s*\}/.test(h):!1};this.autoOutdent=function(f,h){var g=f.getLine(h).match(/^(\s*\})/);if(!g)return 0;g=g[1].length;var m=f.findMatchingBracket({row:h,column:g});if(!m||m.row==h)return 0;m=this.$getIndent(f.getLine(m.row));f.replace(new e(h,0,h,g-1),m)};this.$getIndent=function(f){return f.match(/^\s*/)[0]}}).call(l.prototype);
b.MatchingBraceOutdent=l});
define("ace/mode/folding/cstyle","require exports module ace/lib/oop ace/range ace/mode/folding/fold_mode".split(" "),function(a,b){var l=a("../../lib/oop"),e=a("../../range").Range;a=a("./fold_mode").FoldMode;b=b.FoldMode=function(f){f&&(this.foldingStartMarker=new RegExp(this.foldingStartMarker.source.replace(/\|[^|]*?$/,"|"+f.start)),this.foldingStopMarker=new RegExp(this.foldingStopMarker.source.replace(/\|[^|]*?$/,"|"+f.end)))};l.inherits(b,a);(function(){this.foldingStartMarker=/([\{\[\(])[^\}\]\)]*$|^\s*(\/\*)/;
this.foldingStopMarker=/^[^\[\{\(]*([\}\]\)])|^[\s\*]*(\*\/)/;this.singleLineBlockCommentRe=/^\s*(\/\*).*\*\/\s*$/;this.tripleStarBlockCommentRe=/^\s*(\/\*\*\*).*\*\/\s*$/;this.startRegionRe=/^\s*(\/\*|\/\/)#?region\b/;this._getFoldWidgetBase=this.getFoldWidget;this.getFoldWidget=function(f,h,g){var m=f.getLine(g);if(this.singleLineBlockCommentRe.test(m)&&!this.startRegionRe.test(m)&&!this.tripleStarBlockCommentRe.test(m))return"";f=this._getFoldWidgetBase(f,h,g);return!f&&this.startRegionRe.test(m)?
"start":f};this.getFoldWidgetRange=function(f,h,g,m){var q=f.getLine(g);if(this.startRegionRe.test(q))return this.getCommentRegionBlock(f,q,g);var r=q.match(this.foldingStartMarker);if(r){q=r.index;if(r[1])return this.openingBracketBlock(f,r[1],g,q);(r=f.getCommentFoldRange(g,q+r[0].length,1))&&!r.isMultiLine()&&(m?r=this.getSectionRange(f,g):"all"!=h&&(r=null));return r}if("markbegin"!==h&&(r=q.match(this.foldingStopMarker)))return q=r.index+r[0].length,r[1]?this.closingBracketBlock(f,r[1],g,q):
f.getCommentFoldRange(g,q,-1)};this.getSectionRange=function(f,h){for(var g=f.getLine(h),m=g.search(/\S/),q=h,r=g.length,B=h+=1,D=f.getLength();++h<D;)if(g=f.getLine(h),g=g.search(/\S/),-1!==g){if(m>g)break;var F=this.getFoldWidgetRange(f,"all",h);if(F)if(F.start.row<=q)break;else if(F.isMultiLine())h=F.end.row;else if(m==g)break;B=h}return new e(q,r,B,f.getLine(B).length)};this.getCommentRegionBlock=function(f,h,g){for(var m=h.search(/\s*$/),q=f.getLength(),r=g,B=/^\s*(?:\/\*|\/\/|--)#?(end)?region\b/,
D=1;++g<q;){h=f.getLine(g);var F=B.exec(h);if(F&&(F[1]?D--:D++,!D))break}f=g;if(f>r)return new e(r,m,f,h.length)}}).call(b.prototype)});
define("ace/mode/c_cpp","require exports module ace/lib/oop ace/mode/text ace/mode/c_cpp_highlight_rules ace/mode/matching_brace_outdent ace/range ace/mode/behaviour/cstyle ace/mode/folding/cstyle".split(" "),function(a,b){function l(){this.HighlightRules=h;this.$outdent=new g;this.$behaviour=new m;this.foldingRules=new q}var e=a("../lib/oop"),f=a("./text").Mode,h=a("./c_cpp_highlight_rules").c_cppHighlightRules,g=a("./matching_brace_outdent").MatchingBraceOutdent;a("../range");var m=a("./behaviour/cstyle").CstyleBehaviour,
q=a("./folding/cstyle").FoldMode;e.inherits(l,f);(function(){this.lineCommentStart="//";this.blockComment={start:"/*",end:"*/"};this.getNextLineIndent=function(r,B,D){var F=this.$getIndent(B),G=this.getTokenizer().getLineTokens(B,r),N=G.tokens;G=G.state;if(N.length&&"comment"==N[N.length-1].type)return F;if("start"==r)(r=B.match(/^.*[\{\(\[]\s*$/))&&(F+=D);else if("doc-start"==r){if("start"==G)return"";if(r=B.match(/^\s*(\/?)\*/))r[1]&&(F+=" "),F+="* "}return F};this.checkOutdent=function(r,B,D){return this.$outdent.checkOutdent(B,
D)};this.autoOutdent=function(r,B,D){this.$outdent.autoOutdent(B,D)};this.$id="ace/mode/c_cpp";this.snippetFileId="ace/snippets/c_cpp"}).call(l.prototype);b.Mode=l});
define("ace/mode/glsl_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/c_cpp_highlight_rules"],function(a,b){function l(){var h=this.createKeywordMapper({"variable.language":"this",keyword:"attribute|const|uniform|varying|break|continue|do|for|while|if|else|in|out|inout|float|int|void|bool|true|false|lowp|mediump|highp|precision|invariant|discard|return|mat2|mat3|mat4|vec2|vec3|vec4|ivec2|ivec3|ivec4|bvec2|bvec3|bvec4|sampler2D|samplerCube|struct","constant.language":"radians|degrees|sin|cos|tan|asin|acos|atan|pow|exp|log|exp2|log2|sqrt|inversesqrt|abs|sign|floor|ceil|fract|mod|min|max|clamp|mix|step|smoothstep|length|distance|dot|cross|normalize|faceforward|reflect|refract|matrixCompMult|lessThan|lessThanEqual|greaterThan|greaterThanEqual|equal|notEqual|any|all|not|dFdx|dFdy|fwidth|texture2D|texture2DProj|texture2DLod|texture2DProjLod|textureCube|textureCubeLod|gl_MaxVertexAttribs|gl_MaxVertexUniformVectors|gl_MaxVaryingVectors|gl_MaxVertexTextureImageUnits|gl_MaxCombinedTextureImageUnits|gl_MaxTextureImageUnits|gl_MaxFragmentUniformVectors|gl_MaxDrawBuffers|gl_DepthRangeParameters|gl_DepthRange|gl_Position|gl_PointSize|gl_FragCoord|gl_FrontFacing|gl_PointCoord|gl_FragColor|gl_FragData"},
"identifier");this.$rules=(new f).$rules;this.$rules.start.forEach(function(g){"function"==typeof g.token&&(g.token=h)})}var e=a("../lib/oop"),f=a("./c_cpp_highlight_rules").c_cppHighlightRules;e.inherits(l,f);b.glslHighlightRules=l});
define("ace/mode/glsl","require exports module ace/lib/oop ace/mode/c_cpp ace/mode/glsl_highlight_rules ace/mode/matching_brace_outdent ace/range ace/mode/behaviour/cstyle ace/mode/folding/cstyle".split(" "),function(a,b){function l(){this.HighlightRules=h;this.$outdent=new g;this.$behaviour=new m;this.foldingRules=new q}var e=a("../lib/oop"),f=a("./c_cpp").Mode,h=a("./glsl_highlight_rules").glslHighlightRules,g=a("./matching_brace_outdent").MatchingBraceOutdent;a("../range");var m=a("./behaviour/cstyle").CstyleBehaviour,
q=a("./folding/cstyle").FoldMode;e.inherits(l,f);l.prototype.$id="ace/mode/glsl";b.Mode=l});window.require(["ace/mode/glsl"],function(a){"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=a)});
define("ace/theme/tomorrow_night_bright",["require","exports","module","ace/lib/dom"],function(a,b){b.isDark=!0;b.cssClass="ace-tomorrow-night-bright";b.cssText=".ace-tomorrow-night-bright .ace_gutter {background: #333333;color: #9e9e9e}.ace-tomorrow-night-bright .ace_print-margin {width: 1px;background: #1a1a1a}.ace-tomorrow-night-bright {background-color: #404040;color: #fff}.ace-tomorrow-night-bright .ace_cursor {color: #9F9F9F}.ace-tomorrow-night-bright .ace_marker-layer .ace_selection {background: #6e72a5}.ace-tomorrow-night-bright.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #000000;}.ace-tomorrow-night-bright .ace_marker-layer .ace_step {background: rgb(102, 82, 0)}.ace-tomorrow-night-bright .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid #888888}.ace-tomorrow-night-bright .ace_marker-layer .ace_highlight {border: 1px solid rgb(110, 119, 0);border-bottom: 0;box-shadow: inset 0 -1px rgb(110, 119, 0);margin: -1px 0 0 -1px;background: rgba(255, 235, 0, 0.1)}.ace-tomorrow-night-bright .ace_marker-layer .ace_active-line {background: #505050}.ace-tomorrow-night-bright .ace_gutter-active-line {background-color: #404040}.ace-tomorrow-night-bright .ace_stack {background-color: rgb(66, 90, 44)}.ace-tomorrow-night-bright .ace_marker-layer .ace_selected-word {border: 1px solid #888888}.ace-tomorrow-night-bright .ace_invisible {color: #343434}.ace-tomorrow-night-bright .ace_keyword,.ace-tomorrow-night-bright .ace_meta,.ace-tomorrow-night-bright .ace_storage,.ace-tomorrow-night-bright .ace_storage.ace_type,.ace-tomorrow-night-bright .ace_support.ace_type {color: #5ef7e9}.ace-tomorrow-night-bright .ace_keyword.ace_operator {color: #ffffff}.ace-tomorrow-night-bright .ace_constant.ace_character,.ace-tomorrow-night-bright .ace_constant.ace_language,.ace-tomorrow-night-bright .ace_constant.ace_numeric,.ace-tomorrow-night-bright .ace_keyword.ace_other.ace_unit,.ace-tomorrow-night-bright .ace_support.ace_constant,.ace-tomorrow-night-bright .ace_variable.ace_parameter {color: #ffff00}.ace-tomorrow-night-bright .ace_constant.ace_other {color: #EEEEEE}.ace-tomorrow-night-bright .ace_invalid {color: #CED2CF;background-color: #DF5F5F}.ace-tomorrow-night-bright .ace_invalid.ace_deprecated {color: #CED2CF;background-color: #B798BF}.ace-tomorrow-night-bright .ace_fold {background-color: #7AA6DA;border-color: #DEDEDE}.ace-tomorrow-night-bright .ace_entity.ace_name.ace_function,.ace-tomorrow-night-bright .ace_support.ace_function,.ace-tomorrow-night-bright .ace_variable {color: #aad1ff}.ace-tomorrow-night-bright .ace_support.ace_class,.ace-tomorrow-night-bright .ace_support.ace_type {color: #E7C547}.ace-tomorrow-night-bright .ace_heading,.ace-tomorrow-night-bright .ace_markup.ace_heading,.ace-tomorrow-night-bright .ace_string {color: #B9CA4A}.ace-tomorrow-night-bright .ace_entity.ace_name.ace_tag,.ace-tomorrow-night-bright .ace_entity.ace_other.ace_attribute-name,.ace-tomorrow-night-bright .ace_meta.ace_tag,.ace-tomorrow-night-bright .ace_string.ace_regexp,.ace-tomorrow-night-bright .ace_variable {color: #D54E53}.ace-tomorrow-night-bright .ace_comment {color: #969896}.ace-tomorrow-night-bright .ace_c9searchresults.ace_keyword {color: #88fbf0}.ace-tomorrow-night-bright .ace_indent-guide {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWNgYGBgYFBXV/8PAAJoAXX4kT2EAAAAAElFTkSuQmCC) right repeat-y}";a("../lib/dom").importCssString(b.cssText,
b.cssClass)});window.require(["ace/theme/tomorrow_night_bright"],function(a){"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=a)});
function sc(a,b){function l(G,N){return G-N}function e(G){return function(){return G}}function f(){}function h(){function G(P){var ea=aa(P);if(Array.isArray(ea))ea=ea.slice().sort(l);else{var ua=b.extent(P),Fa=ua[0];ua=ua[1];ea=b.tickStep(Fa,ua,ea);ea=b.range(Math.floor(Fa/ea)*ea,Math.floor(ua/ea)*ea,ea)}return ea.map(function(pa){return N(P,pa)})}function N(P,ea){var ua=[],Fa=[];T(P,ea,function(pa){qa(pa,P,ea);for(var ra=0,Ca=pa.length,Ga=pa[Ca-1][1]*pa[0][0]-pa[Ca-1][0]*pa[0][1];++ra<Ca;)Ga+=pa[ra-
1][1]*pa[ra][0]-pa[ra-1][0]*pa[ra][1];0<Ga?ua.push([pa]):Fa.push(pa)});Fa.forEach(function(pa){for(var ra=0,Ca=ua.length,Ga;ra<Ca;++ra){a:{var Aa=(Ga=ua[ra])[0];for(var xa=pa,za=-1,Na=xa.length;++za<Na;){b:{var ya=Aa;for(var Ia=xa[za],$a=Ia[0],lb=Ia[1],xb=-1,Cb=0,ca=ya.length,Sa=ca-1;Cb<ca;Sa=Cb++){var Va=ya[Cb],fb=Va[0],Qa=Va[1],eb=ya[Sa];Sa=eb[0];var mb=eb[1],ub,Bb=Va;Va=eb;eb=Ia;if(ub=(Va[0]-Bb[0])*(eb[1]-Bb[1])===(eb[0]-Bb[0])*(Va[1]-Bb[1]))Bb=Bb[ub=+(Bb[0]===Va[0])],eb=eb[ub],Va=Va[ub],ub=Bb<=
eb&&eb<=Va||Va<=eb&&eb<=Bb;if(ub){ya=0;break b}Qa>lb!==mb>lb&&$a<(Sa-fb)*(lb-Qa)/(mb-Qa)+fb&&(xb=-xb)}ya=xb}if(ya){Aa=ya;break a}}Aa=0}if(-1!==Aa){Ga.push(pa);break}}});return{type:"MultiPolygon",value:ea,coordinates:ua}}function T(P,ea,ua){function Fa(ya){var Ia=[ya[0][0]+Ga,ya[0][1]+Ca];ya=[ya[1][0]+Ga,ya[1][1]+Ca];var $a=2*Ia[0]+Ia[1]*(E+1)*4,lb=2*ya[0]+ya[1]*(E+1)*4,xb,Cb;(xb=ra[$a])?(Cb=pa[lb])?(delete ra[xb.end],delete pa[Cb.start],xb===Cb?(xb.ring.push(ya),ua(xb.ring)):pa[xb.start]=ra[Cb.end]=
{start:xb.start,end:Cb.end,ring:xb.ring.concat(Cb.ring)}):(delete ra[xb.end],xb.ring.push(ya),ra[xb.end=lb]=xb):(xb=pa[lb])?(Cb=ra[$a])?(delete pa[xb.start],delete ra[Cb.end],xb===Cb?(xb.ring.push(ya),ua(xb.ring)):pa[Cb.start]=ra[xb.end]={start:Cb.start,end:xb.end,ring:Cb.ring.concat(xb.ring)}):(delete pa[xb.start],xb.ring.unshift(Ia),pa[xb.start=$a]=xb):pa[$a]=ra[lb]={start:$a,end:lb,ring:[Ia,ya]}}var pa=[],ra=[],Ca;var Ga=Ca=-1;var Aa=P[0]>=ea;for(F[Aa<<1].forEach(Fa);++Ga<E-1;){var xa=Aa;Aa=P[Ga+
1]>=ea;F[xa|Aa<<1].forEach(Fa)}for(F[Aa<<0].forEach(Fa);++Ca<Q-1;){Ga=-1;Aa=P[Ca*E+E]>=ea;var za=P[Ca*E]>=ea;for(F[Aa<<1|za<<2].forEach(Fa);++Ga<E-1;){xa=Aa;Aa=P[Ca*E+E+Ga+1]>=ea;var Na=za;za=P[Ca*E+Ga+1]>=ea;F[xa|Aa<<1|za<<2|Na<<3].forEach(Fa)}F[Aa|za<<3].forEach(Fa)}Ga=-1;za=P[Ca*E]>=ea;for(F[za<<2].forEach(Fa);++Ga<E-1;)Na=za,za=P[Ca*E+Ga+1]>=ea,F[za<<2|Na<<3].forEach(Fa);F[za<<3].forEach(Fa)}function V(P,ea,ua){P.forEach(function(Fa){var pa=Fa[0],ra=Fa[1],Ca=pa|0,Ga=ra|0,Aa=ea[Ga*E+Ca];if(0<pa&&
pa<E&&Ca===pa){var xa=ea[Ga*E+Ca-1];Fa[0]=pa+(ua-xa)/(Aa-xa)-.5}0<ra&&ra<Q&&Ga===ra&&(xa=ea[(Ga-1)*E+Ca],Fa[1]=ra+(ua-xa)/(Aa-xa)-.5)})}var E=1,Q=1,aa=b.thresholdSturges,qa=V;G.contour=N;G.size=function(P){if(!arguments.length)return[E,Q];var ea=Math.ceil(P[0]),ua=Math.ceil(P[1]);if(!(0<ea&&0<ua))throw Error("invalid size");return E=ea,Q=ua,G};G.thresholds=function(P){return arguments.length?(aa="function"===typeof P?P:Array.isArray(P)?e(D.call(P)):e(P),G):aa};G.smooth=function(P){return arguments.length?
(qa=P?V:f,G):qa===V};return G}function g(G,N,T){for(var V=G.width,E=G.height,Q=(T<<1)+1,aa=0;aa<E;++aa)for(var qa=0,P=0;qa<V+T;++qa)qa<V&&(P+=G.data[qa+aa*V]),qa>=T&&(qa>=Q&&(P-=G.data[qa-Q+aa*V]),N.data[qa-T+aa*V]=P/Math.min(qa+1,V-1+Q-qa,Q))}function m(G,N,T){for(var V=G.width,E=G.height,Q=(T<<1)+1,aa=0;aa<V;++aa)for(var qa=0,P=0;qa<E+T;++qa)qa<E&&(P+=G.data[aa+qa*V]),qa>=T&&(qa>=Q&&(P-=G.data[aa+(qa-Q)*V]),N.data[aa+(qa-T)*V]=P/Math.min(qa+1,E-1+Q-qa,Q))}function q(G){return G[0]}function r(G){return G[1]}
function B(){return 1}var D=Array.prototype.slice,F=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];a.contours=h;a.contourDensity=function(){function G(xa){var za=new Float32Array(Ca*Ga),Na=new Float32Array(Ca*Ga);xa.forEach(function(ya,Ia,$a){var lb=
+aa(ya,Ia,$a)+ra>>pa,xb=+qa(ya,Ia,$a)+ra>>pa;ya=+P(ya,Ia,$a);0<=lb&&lb<Ca&&0<=xb&&xb<Ga&&(za[lb+xb*Ca]+=ya)});g({width:Ca,height:Ga,data:za},{width:Ca,height:Ga,data:Na},Fa>>pa);m({width:Ca,height:Ga,data:Na},{width:Ca,height:Ga,data:za},Fa>>pa);g({width:Ca,height:Ga,data:za},{width:Ca,height:Ga,data:Na},Fa>>pa);m({width:Ca,height:Ga,data:Na},{width:Ca,height:Ga,data:za},Fa>>pa);g({width:Ca,height:Ga,data:za},{width:Ca,height:Ga,data:Na},Fa>>pa);m({width:Ca,height:Ga,data:Na},{width:Ca,height:Ga,
data:za},Fa>>pa);xa=Aa(za);Array.isArray(xa)||(Na=b.max(za),xa=b.tickStep(0,Na,xa),xa=b.range(0,Math.floor(Na/xa)*xa,xa),xa.shift());return h().thresholds(xa).size([Ca,Ga])(za).map(N)}function N(xa){xa.value*=Math.pow(2,-2*pa);xa.coordinates.forEach(T);return xa}function T(xa){xa.forEach(V)}function V(xa){xa.forEach(E)}function E(xa){xa[0]=xa[0]*Math.pow(2,pa)-ra;xa[1]=xa[1]*Math.pow(2,pa)-ra}function Q(){ra=3*Fa;Ca=ea+2*ra>>pa;Ga=ua+2*ra>>pa;return G}var aa=q,qa=r,P=B,ea=960,ua=500,Fa=20,pa=2,ra=
3*Fa,Ca=ea+2*ra>>pa,Ga=ua+2*ra>>pa,Aa=e(20);G.x=function(xa){return arguments.length?(aa="function"===typeof xa?xa:e(+xa),G):aa};G.y=function(xa){return arguments.length?(qa="function"===typeof xa?xa:e(+xa),G):qa};G.weight=function(xa){return arguments.length?(P="function"===typeof xa?xa:e(+xa),G):P};G.size=function(xa){if(!arguments.length)return[ea,ua];var za=Math.ceil(xa[0]),Na=Math.ceil(xa[1]);if(!(0<=za||0<=za))throw Error("invalid size");return ea=za,ua=Na,Q()};G.cellSize=function(xa){if(!arguments.length)return 1<<
pa;if(!(1<=(xa=+xa)))throw Error("invalid cell size");return pa=Math.floor(Math.log(xa)/Math.LN2),Q()};G.thresholds=function(xa){return arguments.length?(Aa="function"===typeof xa?xa:Array.isArray(xa)?e(D.call(xa)):e(xa),G):Aa};G.bandwidth=function(xa){if(!arguments.length)return Math.sqrt(Fa*(Fa+1));if(!(0<=(xa=+xa)))throw Error("invalid bandwidth");return Fa=Math.round((Math.sqrt(4*xa*xa+1)-1)/2),Q()};return G};Object.defineProperty(a,"__esModule",{value:!0})}
"object"===typeof exports&&"undefined"!==typeof module?sc(exports,require("d3-array")):"function"===typeof define&&define.amd?define(["exports","d3-array"],sc):sc(this.d3=this.d3||{},this.d3);
var vc=function(){function a(B,D){this.x=B;this.y=D}function b(B,D,F,G){this.w=D;this.h=F;this.size=D*F;this.thresh=G;this.data=B}function l(){this.len=this.area=0;this.curve={};this.pt=[];this.minY=this.minX=1E5;this.maxY=this.maxX=-1}function e(B){this.n=B;this.tag=Array(B);this.c=Array(3*B);this.alphaCurve=0;this.vertex=Array(B);this.alpha=Array(B);this.alpha0=Array(B);this.beta=Array(B)}function f(){function B(E){for(E=N.w*E.y+E.x;E<N.size&&N.data[E]<N.thresh;)E++;return E<N.size&&N.index(E)}
function D(E,Q){var aa,qa;for(aa=2;5>aa;aa++){var P=0;for(qa=-aa+1;qa<=aa-1;qa++)P+=N.at(E+qa,Q+aa-1)?1:-1,P+=N.at(E+aa-1,Q+qa-1)?1:-1,P+=N.at(E+qa-1,Q-aa)?1:-1,P+=N.at(E-aa,Q+qa)?1:-1;if(0<P)return 1;if(0>P)break}return 0}function F(E){var Q=new l,aa=E.x,qa=E.y,P=0,ea=1;for(Q.sign=m.at(E.x,E.y)?"+":"-";;){Q.pt.push(new a(aa,qa));aa>Q.maxX&&(Q.maxX=aa);aa<Q.minX&&(Q.minX=aa);qa>Q.maxY&&(Q.maxY=qa);qa<Q.minY&&(Q.minY=qa);Q.len++;aa+=P;qa+=ea;Q.area-=aa*ea;if(aa===E.x&&qa===E.y)break;var ua=N.at(aa+
(P+ea-1)/2,qa+(ea-P-1)/2);var Fa=N.at(aa+(P-ea-1)/2,qa+(ea+P-1)/2);Fa&&!ua?"right"===r.turnpolicy||"black"===r.turnpolicy&&"+"===Q.sign||"white"===r.turnpolicy&&"-"===Q.sign||"majority"===r.turnpolicy&&D(aa,qa)||"minority"===r.turnpolicy&&!D(aa,qa)?(ua=P,P=-ea,ea=ua):(ua=P,P=ea,ea=-ua):Fa?(ua=P,P=-ea,ea=ua):ua||(ua=P,P=ea,ea=-ua)}return Q}function G(E){var Q=E.pt[0].y,aa=E.len,qa;for(qa=1;qa<aa;qa++){var P=E.pt[qa].x;var ea=E.pt[qa].y;if(ea!==Q){var ua=Q<ea?Q:ea;for(Q=E.maxX;P<Q;P++)N.flip(P,ua);
Q=ea}}}for(var N=m.copy(),T=new a(0,0),V;T=B(T);){V=F(T);G(V);if(-1===V.area)throw Error("bad potrace");V.area>r.turdsize&&q.push(V)}}function h(){function B(){this.data=[0,0,0,0,0,0,0,0,0]}function D(ya,Ia,$a,lb,xb){this.x=ya;this.y=Ia;this.xy=$a;this.x2=lb;this.y2=xb}function F(ya,Ia){return ya>=Ia?ya%Ia:0<=ya?ya:Ia-1-(-1-ya)%Ia}function G(ya,Ia){return ya.x*Ia.y-ya.y*Ia.x}function N(ya,Ia,$a){return ya<=$a?ya<=Ia&&Ia<$a:ya<=Ia||Ia<$a}function T(ya){return 0<ya?1:0>ya?-1:0}function V(ya,Ia){var $a=
Array(3),lb,xb;$a[0]=Ia.x;$a[1]=Ia.y;$a[2]=1;for(Ia=xb=0;3>Ia;Ia++)for(lb=0;3>lb;lb++)xb+=$a[Ia]*ya.at(Ia,lb)*$a[lb];return xb}function E(ya,Ia,$a){var lb=new a;lb.x=Ia.x+ya*($a.x-Ia.x);lb.y=Ia.y+ya*($a.y-Ia.y);return lb}function Q(ya,Ia,$a){return(Ia.x-ya.x)*($a.y-ya.y)-($a.x-ya.x)*(Ia.y-ya.y)}function aa(ya,Ia,$a,lb){return(Ia.x-ya.x)*(lb.y-$a.y)-(lb.x-$a.x)*(Ia.y-ya.y)}function qa(ya,Ia,$a){return(Ia.x-ya.x)*($a.x-ya.x)+(Ia.y-ya.y)*($a.y-ya.y)}function P(ya,Ia){return Math.sqrt((ya.x-Ia.x)*(ya.x-
Ia.x)+(ya.y-Ia.y)*(ya.y-Ia.y))}function ea(ya,Ia,$a,lb,xb){var Cb=1-ya,ca=new a;ca.x=Cb*Cb*Cb*Ia.x+3*Cb*Cb*ya*$a.x+3*ya*ya*Cb*lb.x+ya*ya*ya*xb.x;ca.y=Cb*Cb*Cb*Ia.y+3*Cb*Cb*ya*$a.y+3*ya*ya*Cb*lb.y+ya*ya*ya*xb.y;return ca}function ua(ya,Ia,$a,lb,xb,Cb){ya=aa(ya,Ia,xb,Cb);Ia=aa(Ia,$a,xb,Cb);$a=aa($a,lb,xb,Cb);$a=ya-2*Ia+$a;lb=-2*ya+2*Ia;ya=lb*lb-4*$a*ya;if(0===$a||0>ya)return-1;xb=Math.sqrt(ya);ya=(-lb+xb)/(2*$a);$a=(-lb-xb)/(2*$a);return 0<=ya&&1>=ya?ya:0<=$a&&1>=$a?$a:-1}function Fa(ya){var Ia;ya.x0=
ya.pt[0].x;ya.y0=ya.pt[0].y;ya.sums=[];var $a=ya.sums;$a.push(new D(0,0,0,0,0));for(Ia=0;Ia<ya.len;Ia++){var lb=ya.pt[Ia].x-ya.x0;var xb=ya.pt[Ia].y-ya.y0;$a.push(new D($a[Ia].x+lb,$a[Ia].y+xb,$a[Ia].xy+lb*xb,$a[Ia].x2+lb*lb,$a[Ia].y2+xb*xb))}}function pa(ya){var Ia=ya.len,$a=ya.pt,lb=Array(Ia),xb=Array(Ia),Cb=Array(4);ya.lon=Array(Ia);var ca=[new a,new a],Sa=new a,Va=new a,fb=new a,Qa,eb;var mb=0;for(Qa=Ia-1;0<=Qa;Qa--)$a[Qa].x!=$a[mb].x&&$a[Qa].y!=$a[mb].y&&(mb=Qa+1),xb[Qa]=mb;for(Qa=Ia-1;0<=Qa;Qa--){Cb[0]=
Cb[1]=Cb[2]=Cb[3]=0;var ub=(3+3*($a[F(Qa+1,Ia)].x-$a[Qa].x)+($a[F(Qa+1,Ia)].y-$a[Qa].y))/2;Cb[ub]++;ca[0].x=0;ca[0].y=0;ca[1].x=0;ca[1].y=0;mb=xb[Qa];for(eb=Qa;;){var Bb=0;ub=(3+3*T($a[mb].x-$a[eb].x)+T($a[mb].y-$a[eb].y))/2;Cb[ub]++;if(Cb[0]&&Cb[1]&&Cb[2]&&Cb[3]){lb[Qa]=eb;Bb=1;break}Sa.x=$a[mb].x-$a[Qa].x;Sa.y=$a[mb].y-$a[Qa].y;if(0>G(ca[0],Sa)||0<G(ca[1],Sa))break;1>=Math.abs(Sa.x)&&1>=Math.abs(Sa.y)||(Va.x=Sa.x+(0<=Sa.y&&(0<Sa.y||0>Sa.x)?1:-1),Va.y=Sa.y+(0>=Sa.x&&(0>Sa.x||0>Sa.y)?1:-1),0<=G(ca[0],
Va)&&(ca[0].x=Va.x,ca[0].y=Va.y),Va.x=Sa.x+(0>=Sa.y&&(0>Sa.y||0>Sa.x)?1:-1),Va.y=Sa.y+(0<=Sa.x&&(0<Sa.x||0>Sa.y)?1:-1),0>=G(ca[1],Va)&&(ca[1].x=Va.x,ca[1].y=Va.y));eb=mb;mb=xb[eb];if(!N(mb,Qa,eb))break}if(0===Bb){fb.x=T($a[mb].x-$a[eb].x);fb.y=T($a[mb].y-$a[eb].y);Sa.x=$a[eb].x-$a[Qa].x;Sa.y=$a[eb].y-$a[Qa].y;Bb=G(ca[0],Sa);mb=G(ca[0],fb);var qb=G(ca[1],Sa);var yb=G(ca[1],fb);ub=1E7;0>mb&&(ub=Math.floor(Bb/-mb));0<yb&&(ub=Math.min(ub,Math.floor(-qb/yb)));lb[Qa]=F(eb+ub,Ia)}}ub=lb[Ia-1];ya.lon[Ia-
1]=ub;for(Qa=Ia-2;0<=Qa;Qa--)N(Qa+1,lb[Qa],ub)&&(ub=lb[Qa]),ya.lon[Qa]=ub;for(Qa=Ia-1;N(F(Qa+1,Ia),ub,ya.lon[Qa]);Qa--)ya.lon[Qa]=ub}function ra(ya){var Ia,$a,lb=ya.len,xb=Array(lb+1),Cb=Array(lb+1);var ca=Array(lb);var Sa=Array(lb+1),Va=Array(lb+1),fb=Array(lb+1);for(Ia=0;Ia<lb;Ia++){var Qa=F(ya.lon[F(Ia-1,lb)]-1,lb);Qa==Ia&&(Qa=F(Ia+1,lb));ca[Ia]=Qa<Ia?lb:Qa}Qa=1;for(Ia=0;Ia<lb;Ia++)for(;Qa<=ca[Ia];)Sa[Qa]=Ia,Qa++;for(Qa=Ia=0;Ia<lb;Qa++)Va[Qa]=Ia,Ia=ca[Ia];Va[Qa]=lb;ca=Qa;Ia=lb;for(Qa=ca;0<Qa;Qa--)fb[Qa]=
Ia,Ia=Sa[Ia];fb[0]=0;xb[0]=0;for(Qa=1;Qa<=ca;Qa++)for(Ia=fb[Qa];Ia<=Va[Qa];Ia++){var eb=-1;for($a=Va[Qa-1];$a>=Sa[Ia];$a--){var mb=Ia;var ub=ya.len;var Bb=ya.pt;var qb=ya.sums;var yb=0;mb>=ub&&(mb-=ub,yb=1);if(0===yb){var Ib=qb[mb+1].x-qb[$a].x;var Pb=qb[mb+1].y-qb[$a].y;yb=qb[mb+1].x2-qb[$a].x2;var Eb=qb[mb+1].xy-qb[$a].xy;qb=qb[mb+1].y2-qb[$a].y2;var z=mb+1-$a}else Ib=qb[mb+1].x-qb[$a].x+qb[ub].x,Pb=qb[mb+1].y-qb[$a].y+qb[ub].y,yb=qb[mb+1].x2-qb[$a].x2+qb[ub].x2,Eb=qb[mb+1].xy-qb[$a].xy+qb[ub].xy,
qb=qb[mb+1].y2-qb[$a].y2+qb[ub].y2,z=mb+1-$a+ub;var Xb=(Bb[$a].x+Bb[mb].x)/2-Bb[0].x;var Nb=(Bb[$a].y+Bb[mb].y)/2-Bb[0].y;ub=Bb[mb].x-Bb[$a].x;mb=-(Bb[mb].y-Bb[$a].y);yb=Math.sqrt(mb*mb*((yb-2*Ib*Xb)/z+Xb*Xb)+2*mb*ub*((Eb-Ib*Nb-Pb*Xb)/z+Xb*Nb)+ub*ub*((qb-2*Pb*Nb)/z+Nb*Nb))+xb[$a];if(0>eb||yb<eb)Cb[Ia]=$a,eb=yb}xb[Ia]=eb}ya.m=ca;ya.po=Array(ca);Ia=lb;for(Qa=ca-1;0<Ia;Qa--)Ia=Cb[Ia],ya.po[Qa]=Ia}function Ca(ya){var Ia=ya.m,$a=ya.po,lb=ya.len,xb=ya.pt,Cb=ya.x0,ca=ya.y0,Sa=Array(Ia),Va=Array(Ia),fb=Array(Ia),
Qa=Array(3),eb,mb=new a;ya.curve=new e(Ia);for(eb=0;eb<Ia;eb++){var ub=$a[F(eb+1,Ia)];ub=F(ub-$a[eb],lb)+$a[eb];Sa[eb]=new a;Va[eb]=new a;var Bb=$a[eb];var qb=ub,yb=Sa[eb];var Ib=Va[eb];var Pb=ya.len;var Eb=ya.sums;for(var z=0;qb>=Pb;)qb-=Pb,z+=1;for(;Bb>=Pb;)Bb-=Pb,--z;for(;0>qb;)qb+=Pb,--z;for(;0>Bb;)Bb+=Pb,z+=1;var Xb=Eb[qb+1].x-Eb[Bb].x+z*Eb[Pb].x;ub=Eb[qb+1].y-Eb[Bb].y+z*Eb[Pb].y;var Nb=Eb[qb+1].x2-Eb[Bb].x2+z*Eb[Pb].x2;var Rb=Eb[qb+1].xy-Eb[Bb].xy+z*Eb[Pb].xy;Eb=Eb[qb+1].y2-Eb[Bb].y2+z*Eb[Pb].y2;
Bb=qb+1-Bb+z*Pb;yb.x=Xb/Bb;yb.y=ub/Bb;Nb=(Nb-Xb*Xb/Bb)/Bb;Rb=(Rb-Xb*ub/Bb)/Bb;ub=(Eb-ub*ub/Bb)/Bb;Eb=(Nb+ub+Math.sqrt((Nb-ub)*(Nb-ub)+4*Rb*Rb))/2;Nb-=Eb;ub-=Eb;Math.abs(Nb)>=Math.abs(ub)?(Eb=Math.sqrt(Nb*Nb+Rb*Rb),0!==Eb&&(Ib.x=-Rb/Eb,Ib.y=Nb/Eb)):(Eb=Math.sqrt(ub*ub+Rb*Rb),0!==Eb&&(Ib.x=-ub/Eb,Ib.y=Rb/Eb));0===Eb&&(Ib.x=Ib.y=0)}for(eb=0;eb<Ia;eb++)if(fb[eb]=new B,ub=Va[eb].x*Va[eb].x+Va[eb].y*Va[eb].y,0===ub)for(ub=0;3>ub;ub++)for(lb=0;3>lb;lb++)fb[eb].data[3*ub+lb]=0;else for(Qa[0]=Va[eb].y,Qa[1]=
-Va[eb].x,Qa[2]=-Qa[1]*Sa[eb].y-Qa[0]*Sa[eb].x,Ib=0;3>Ib;Ib++)for(lb=0;3>lb;lb++)fb[eb].data[3*Ib+lb]=Qa[Ib]*Qa[lb]/ub;for(eb=0;eb<Ia;eb++){Sa=new B;Va=new a;mb.x=xb[$a[eb]].x-Cb;mb.y=xb[$a[eb]].y-ca;ub=F(eb-1,Ia);for(Ib=0;3>Ib;Ib++)for(lb=0;3>lb;lb++)Sa.data[3*Ib+lb]=fb[ub].at(Ib,lb)+fb[eb].at(Ib,lb);for(;;){lb=Sa.at(0,0)*Sa.at(1,1)-Sa.at(0,1)*Sa.at(1,0);if(0!==lb){Va.x=(-Sa.at(0,2)*Sa.at(1,1)+Sa.at(1,2)*Sa.at(0,1))/lb;Va.y=(Sa.at(0,2)*Sa.at(1,0)-Sa.at(1,2)*Sa.at(0,0))/lb;break}Sa.at(0,0)>Sa.at(1,
1)?(Qa[0]=-Sa.at(0,1),Qa[1]=Sa.at(0,0)):Sa.at(1,1)?(Qa[0]=-Sa.at(1,1),Qa[1]=Sa.at(1,0)):(Qa[0]=1,Qa[1]=0);ub=Qa[0]*Qa[0]+Qa[1]*Qa[1];Qa[2]=-Qa[1]*mb.y-Qa[0]*mb.x;for(Ib=0;3>Ib;Ib++)for(lb=0;3>lb;lb++)Sa.data[3*Ib+lb]+=Qa[Ib]*Qa[lb]/ub}lb=Math.abs(Va.x-mb.x);Ib=Math.abs(Va.y-mb.y);if(.5>=lb&&.5>=Ib)ya.curve.vertex[eb]=new a(Va.x+Cb,Va.y+ca);else{ub=V(Sa,mb);Rb=mb.x;Xb=mb.y;if(0!==Sa.at(0,0))for(Nb=0;2>Nb;Nb++)Va.y=mb.y-.5+Nb,Va.x=-(Sa.at(0,1)*Va.y+Sa.at(0,2))/Sa.at(0,0),lb=Math.abs(Va.x-mb.x),Eb=V(Sa,
Va),.5>=lb&&Eb<ub&&(ub=Eb,Rb=Va.x,Xb=Va.y);if(0!==Sa.at(1,1))for(Nb=0;2>Nb;Nb++)Va.x=mb.x-.5+Nb,Va.y=-(Sa.at(1,0)*Va.x+Sa.at(1,2))/Sa.at(1,1),Ib=Math.abs(Va.y-mb.y),Eb=V(Sa,Va),.5>=Ib&&Eb<ub&&(ub=Eb,Rb=Va.x,Xb=Va.y);for(Ib=0;2>Ib;Ib++)for(lb=0;2>lb;lb++)Va.x=mb.x-.5+Ib,Va.y=mb.y-.5+lb,Eb=V(Sa,Va),Eb<ub&&(ub=Eb,Rb=Va.x,Xb=Va.y);ya.curve.vertex[eb]=new a(Rb+Cb,Xb+ca)}}}function Ga(ya){ya=ya.curve;var Ia=ya.n;ya=ya.vertex;var $a=0;for(--Ia;$a<Ia;$a++,Ia--){var lb=ya[$a];ya[$a]=ya[Ia];ya[Ia]=lb}}function Aa(ya){var Ia=
ya.curve.n;ya=ya.curve;var $a;for($a=0;$a<Ia;$a++){var lb=F($a+1,Ia);var xb=F($a+2,Ia);var Cb=E(.5,ya.vertex[xb],ya.vertex[lb]);var ca=ya.vertex[$a];var Sa=ya.vertex[xb];var Va=ca;var fb=Sa,Qa=new a;Qa.y=T(fb.x-Va.x);Qa.x=-T(fb.y-Va.y);Va=Qa;ca=Va.y*(Sa.x-ca.x)-Va.x*(Sa.y-ca.y);0!==ca?(ca=Q(ya.vertex[$a],ya.vertex[lb],ya.vertex[xb])/ca,ca=Math.abs(ca),ca=1<ca?1-1/ca:0,ca/=.75):ca=4/3;ya.alpha0[lb]=ca;ca>=r.alphamax?(ya.tag[lb]="CORNER",ya.c[3*lb+1]=ya.vertex[lb]):(.55>ca?ca=.55:1<ca&&(ca=1),Sa=E(.5+
.5*ca,ya.vertex[$a],ya.vertex[lb]),xb=E(.5+.5*ca,ya.vertex[xb],ya.vertex[lb]),ya.tag[lb]="CURVE",ya.c[3*lb]=Sa,ya.c[3*lb+1]=xb);ya.c[3*lb+2]=Cb;ya.alpha[lb]=ca;ya.beta[lb]=.5}ya.alphacurve=1}function xa(ya){function Ia(){this.pen=0;this.c=[new a,new a];this.alpha=this.s=this.t=0}function $a(Pb,Eb,z,Xb,Nb,Rb,Fb){var Wb=Pb.curve.n;Pb=Pb.curve;var ib=Pb.vertex;if(Eb==z)return 1;var rb=Eb;var ab=F(Eb+1,Wb);var ob=F(rb+1,Wb);var J=Rb[ob];if(0===J)return 1;var S=P(ib[Eb],ib[ab]);for(rb=ob;rb!=z;rb=ob){ob=
F(rb+1,Wb);var fa=F(rb+2,Wb);if(Rb[ob]!=J||T(aa(ib[Eb],ib[ab],ib[ob],ib[fa]))!=J)return 1;rb=ib[Eb];var oa=ib[ab];var na=ib[ob],ja=ib[fa];if((oa.x-rb.x)*(ja.x-na.x)+(oa.y-rb.y)*(ja.y-na.y)<S*P(ib[ob],ib[fa])*-.999847695156)return 1}Rb=Pb.c[3*F(Eb,Wb)+2].copy();J=ib[F(Eb+1,Wb)].copy();ab=ib[F(z,Wb)].copy();fa=Pb.c[3*F(z,Wb)+2].copy();ob=Fb[z]-Fb[Eb];ob-=Q(ib[0],Pb.c[3*Eb+2],Pb.c[3*z+2])/2;Eb>=z&&(ob+=Fb[Wb]);rb=Q(Rb,J,ab);S=Q(Rb,J,fa);Fb=Q(Rb,ab,fa);if(S==rb)return 1;Fb/=Fb-(rb+Fb-S);rb=S/(S-rb);S=
S*Fb/2;if(0===S)return 1;ob=2-Math.sqrt(4-ob/S/.3);Xb.c[0]=E(Fb*ob,Rb,J);Xb.c[1]=E(rb*ob,fa,ab);Xb.alpha=ob;Xb.t=Fb;Xb.s=rb;J=Xb.c[0].copy();ab=Xb.c[1].copy();Xb.pen=0;for(rb=F(Eb+1,Wb);rb!=z;rb=ob){ob=F(rb+1,Wb);Fb=ua(Rb,J,ab,fa,ib[rb],ib[ob]);if(-.5>Fb)return 1;oa=ea(Fb,Rb,J,ab,fa);S=P(ib[rb],ib[ob]);if(0===S)return 1;Fb=Q(ib[rb],ib[ob],oa)/S;if(Math.abs(Fb)>Nb||0>qa(ib[rb],ib[ob],oa)||0>qa(ib[ob],ib[rb],oa))return 1;Xb.pen+=Fb*Fb}for(rb=Eb;rb!=z;rb=ob){ob=F(rb+1,Wb);Fb=ua(Rb,J,ab,fa,Pb.c[3*rb+
2],Pb.c[3*ob+2]);if(-.5>Fb)return 1;oa=ea(Fb,Rb,J,ab,fa);S=P(Pb.c[3*rb+2],Pb.c[3*ob+2]);if(0===S)return 1;Fb=Q(Pb.c[3*rb+2],Pb.c[3*ob+2],oa)/S;Eb=Q(Pb.c[3*rb+2],Pb.c[3*ob+2],ib[ob])/S;Eb*=.75*Pb.alpha[ob];0>Eb&&(Fb=-Fb,Eb=-Eb);if(Fb<Eb-Nb)return 1;Fb<Eb&&(Xb.pen+=(Fb-Eb)*(Fb-Eb))}return 0}var lb=ya.curve,xb=lb.n,Cb=lb.vertex,ca=Array(xb+1),Sa=Array(xb+1),Va=Array(xb+1),fb=Array(xb+1),Qa,eb=new Ia;var mb=Array(xb);var ub=Array(xb+1);for(Qa=0;Qa<xb;Qa++)mb[Qa]="CURVE"==lb.tag[Qa]?T(Q(Cb[F(Qa-1,xb)],
Cb[Qa],Cb[F(Qa+1,xb)])):0;var Bb=0;ub[0]=0;var qb=lb.vertex[0];for(Qa=0;Qa<xb;Qa++){var yb=F(Qa+1,xb);if("CURVE"==lb.tag[yb]){var Ib=lb.alpha[yb];Bb+=.3*Ib*(4-Ib)*Q(lb.c[3*Qa+2],Cb[yb],lb.c[3*yb+2])/2;Bb+=Q(qb,lb.c[3*Qa+2],lb.c[3*yb+2])/2}ub[Qa+1]=Bb}ca[0]=-1;Sa[0]=0;Va[0]=0;for(yb=1;yb<=xb;yb++)for(ca[yb]=yb-1,Sa[yb]=Sa[yb-1],Va[yb]=Va[yb-1]+1,Qa=yb-2;0<=Qa&&!(qb=$a(ya,Qa,F(yb,xb),eb,r.opttolerance,mb,ub));Qa--)if(Va[yb]>Va[Qa]+1||Va[yb]==Va[Qa]+1&&Sa[yb]>Sa[Qa]+eb.pen)ca[yb]=Qa,Sa[yb]=Sa[Qa]+eb.pen,
Va[yb]=Va[Qa]+1,fb[yb]=eb,eb=new Ia;Sa=Va[xb];Va=new e(Sa);eb=Array(Sa);mb=Array(Sa);yb=xb;for(Qa=Sa-1;0<=Qa;Qa--)ca[yb]==yb-1?(Va.tag[Qa]=lb.tag[F(yb,xb)],Va.c[3*Qa]=lb.c[3*F(yb,xb)],Va.c[3*Qa+1]=lb.c[3*F(yb,xb)+1],Va.c[3*Qa+2]=lb.c[3*F(yb,xb)+2],Va.vertex[Qa]=lb.vertex[F(yb,xb)],Va.alpha[Qa]=lb.alpha[F(yb,xb)],Va.alpha0[Qa]=lb.alpha0[F(yb,xb)],Va.beta[Qa]=lb.beta[F(yb,xb)],eb[Qa]=mb[Qa]=1):(Va.tag[Qa]="CURVE",Va.c[3*Qa]=fb[yb].c[0],Va.c[3*Qa+1]=fb[yb].c[1],Va.c[3*Qa+2]=lb.c[3*F(yb,xb)+2],Va.vertex[Qa]=
E(fb[yb].s,lb.c[3*F(yb,xb)+2],Cb[F(yb,xb)]),Va.alpha[Qa]=fb[yb].alpha,Va.alpha0[Qa]=fb[yb].alpha,eb[Qa]=fb[yb].s,mb[Qa]=fb[yb].t),yb=ca[yb];for(Qa=0;Qa<Sa;Qa++)yb=F(Qa+1,Sa),Va.beta[Qa]=eb[Qa]/(eb[Qa]+mb[yb]);Va.alphacurve=1;ya.curve=Va}B.prototype.at=function(ya,Ia){return this.data[3*ya+Ia]};for(var za=0;za<q.length;za++){var Na=q[za];Fa(Na);pa(Na);ra(Na);Ca(Na);"-"===Na.sign&&Ga(Na);Aa(Na);r.optcurve&&xa(Na)}}function g(){m=null;q=[];r.isReady=!1}a.prototype.copy=function(){return new a(this.x,
this.y)};b.prototype.at=function(B,D){return 0<=B&&B<this.w&&0<=D&&D<this.h&&this.data[this.w*D+B]>=this.thresh};b.prototype.index=function(B){var D=new a;D.y=Math.floor(B/this.w);D.x=B-D.y*this.w;return D};b.prototype.flip=function(B,D){this.at(B,D)?this.data[this.w*D+B]=0:this.data[this.w*D+B]=this.thresh};b.prototype.copy=function(){var B=new Uint8Array(this.w*this.h);B.set(this.data);return new b(B,this.w,this.h,this.thresh)};var m=null,q=[],r={isReady:!1,turnpolicy:"minority",turdsize:2,optcurve:!0,
alphamax:1,opttolerance:.2};return{loadImageFromFile:function(B){r.isReady&&g();var D=new FileReader;D.onload=function(F){return function(G){F.src=G.target.result}}(null);D.readAsDataURL(B)},loadImageFromUrl:function(){r.isReady&&g()},setParameter:function(B){for(var D in B)B.hasOwnProperty(D)&&(r[D]=B[D])},process:function(){f();h();return q},getSVG:function(B,D){function F(E){function Q(ua){var Fa="C "+(E.c[3*ua].x*B).toFixed(3)+" "+(E.c[3*ua].y*B).toFixed(3)+",";Fa+=(E.c[3*ua+1].x*B).toFixed(3)+
" "+(E.c[3*ua+1].y*B).toFixed(3)+",";return Fa+=(E.c[3*ua+2].x*B).toFixed(3)+" "+(E.c[3*ua+2].y*B).toFixed(3)+" "}function aa(ua){var Fa="L "+(E.c[3*ua+1].x*B).toFixed(3)+" "+(E.c[3*ua+1].y*B).toFixed(3)+" ";return Fa+=(E.c[3*ua+2].x*B).toFixed(3)+" "+(E.c[3*ua+2].y*B).toFixed(3)+" "}var qa=E.n,P,ea="M "+(E.c[3*(qa-1)+2].x*B).toFixed(3)+" "+(E.c[3*(qa-1)+2].y*B).toFixed(3)+" ";for(P=0;P<qa;P++)"CURVE"===E.tag[P]?ea+=Q(P):"CORNER"===E.tag[P]&&(ea+=aa(P));return ea}var G=q.length,N;var T='<svg id="svg" version="1.1" width="'+
m.w*B+'" height="'+m.h*B+'" xmlns="http://www.w3.org/2000/svg"><path d="';for(N=0;N<G;N++){var V=q[N].curve;T+=F(V)}"curve"===D?(D="black",G="none",V=""):(D="none",G="black",V=' fill-rule="evenodd"');return T+('" stroke="'+D+'" fill="'+G+'"'+V+"/></svg>")},setBm:function(B,D,F,G){m=new b(B,D,F,G);r.isReady=!0},clear:g,do_processPath:function(B){q=B;h();return q}}}(),zc=this;
function Cc(a){function b(d,n){return void 0!==d?d:n}function l(d,n){const u=Array(d);for(let C=0;C<d;++C)u[C]=n(C);return u}function e(d,n=0){const u=Array(d);for(let C=0;C<d;++C)u[C]=n;return u}function f(d,n){return d<n?d:n}function h(d,n){return d>n?d:n}function g(d,n,u){return d<n?n:d>u?u:d}function m(d){return d*d}function q(d){return 1/Math.sqrt(d)}function r(d,n,u){++a.gjkCalls;const C=u.proxyA;var I=u.proxyB;const L=u.transformA,U=u.transformB,Z=X;Z.ReadCache(n,C,L,I,U);const ka=Z.m_vertices,
ia=Y,ta=la;let Ja,Oa=0;for(;20>Oa;){Ja=Z.m_count;for(var Xa=0;Xa<Ja;++Xa)ia[Xa]=ka[Xa].indexA,ta[Xa]=ka[Xa].indexB;switch(Z.m_count){case 2:Z.Solve2();break;case 3:Z.Solve3()}if(3===Z.m_count)break;var zb=Z.GetSearchDirection(va);if(zb.LengthSquared()<lb)break;Xa=ka[Z.m_count];Xa.indexA=C.GetSupport(ib.MulTRV(L.q,z.NegV(zb,z.s_t0),ha));rb.MulXV(L,C.GetVertex(Xa.indexA),Xa.wA);Xa.indexB=I.GetSupport(ib.MulTRV(U.q,zb,k));rb.MulXV(U,I.GetVertex(Xa.indexB),Xa.wB);z.SubVV(Xa.wB,Xa.wA,Xa.w);++Oa;++a.gjkIters;
zb=!1;for(let Hb=0;Hb<Ja;++Hb)if(Xa.indexA===ia[Hb]&&Xa.indexB===ta[Hb]){zb=!0;break}if(zb)break;++Z.m_count}a.gjkMaxIters=h(a.gjkMaxIters,Oa);Z.GetWitnessPoints(d.pointA,d.pointB);d.distance=z.DistanceVV(d.pointA,d.pointB);d.iterations=Oa;Z.WriteCache(n);u.useRadii&&(n=C.m_radius,I=I.m_radius,d.distance>n+I&&1E-5<d.distance?(d.distance-=n+I,u=z.SubVV(d.pointB,d.pointA,ba),u.Normalize(),d.pointA.SelfMulAdd(n,u),d.pointB.SelfMulSub(I,u)):(I=z.MidVV(d.pointA,d.pointB,sa),d.pointA.Copy(I),d.pointB.Copy(I),
d.distance=0))}function B(d,n){return d.upperBound.x<n.lowerBound.x||d.upperBound.y<n.lowerBound.y||n.upperBound.x<d.lowerBound.x||n.upperBound.y<d.lowerBound.y?!1:!0}function D(d,n,u,C,I){let L=0;const U=n[0];n=n[1];const Z=z.DotVV(u,U.v)-C;u=z.DotVV(u,n.v)-C;0>=Z&&d[L++].Copy(U);0>=u&&d[L++].Copy(n);0>Z*u&&(u=Z/(Z-u),C=d[L].v,C.x=U.v.x+u*(n.v.x-U.v.x),C.y=U.v.y+u*(n.v.y-U.v.y),d=d[L].id,d.cf.indexA=I,d.cf.indexB=U.id.cf.indexB,d.cf.typeA=a.ContactFeatureType.e_vertex,d.cf.typeB=a.ContactFeatureType.e_face,
++L);return L}function F(d,n,u,C,I,L){const U=bb.Reset();U.proxyA.SetShape(d,n);U.proxyB.SetShape(u,C);U.transformA.Copy(I);U.transformB.Copy(L);U.useRadii=!0;d=hb.Reset();d.count=0;n=sb.Reset();r(n,d,U);return 1E-4>n.distance}function G(d){if(null===d)throw Error();return d}function N(d,n,u,C,I){d.pointCount=0;u=rb.MulXV(u,n.m_p,Ob);I=rb.MulXV(I,C.m_p,Mb);I=z.DistanceSquaredVV(u,I);u=n.m_radius+C.m_radius;I>u*u||(d.type=a.ManifoldType.e_circles,d.localPoint.Copy(n.m_p),d.localNormal.SetZero(),d.pointCount=
1,d.points[0].localPoint.Copy(C.m_p),d.points[0].id.key=0)}function T(d,n,u,C,I){d.pointCount=0;I=rb.MulXV(I,C.m_p,ec);u=rb.MulTXV(u,I,kc);var L=0,U=-1E37;I=n.m_radius+C.m_radius;var Z=n.m_count;const ka=n.m_vertices;n=n.m_normals;for(var ia=0;ia<Z;++ia){var ta=z.DotVV(n[ia],z.SubVV(u,ka[ia],z.s_t0));if(ta>I)return;ta>U&&(U=ta,L=ia)}ia=L;ta=ka[ia];Z=ka[(ia+1)%Z];if(1E-5>U)d.pointCount=1,d.type=a.ManifoldType.e_faceA,d.localNormal.Copy(n[L]),z.MidVV(ta,Z,d.localPoint);else if(L=z.DotVV(z.SubVV(u,ta,
z.s_t0),z.SubVV(Z,ta,z.s_t1)),U=z.DotVV(z.SubVV(u,Z,z.s_t0),z.SubVV(ta,Z,z.s_t1)),0>=L){if(z.DistanceSquaredVV(u,ta)>I*I)return;d.pointCount=1;d.type=a.ManifoldType.e_faceA;z.SubVV(u,ta,d.localNormal).SelfNormalize();d.localPoint.Copy(ta)}else if(0>=U){if(z.DistanceSquaredVV(u,Z)>I*I)return;d.pointCount=1;d.type=a.ManifoldType.e_faceA;z.SubVV(u,Z,d.localNormal).SelfNormalize();d.localPoint.Copy(Z)}else{L=z.MidVV(ta,Z,Oc);if(z.DotVV(z.SubVV(u,L,z.s_t1),n[ia])>I)return;d.pointCount=1;d.type=a.ManifoldType.e_faceA;
d.localNormal.Copy(n[ia]).SelfNormalize();d.localPoint.Copy(L)}d.points[0].localPoint.Copy(C.m_p);d.points[0].id.key=0}function V(d,n,u,C,I){d.pointCount=0;I=rb.MulTXV(u,rb.MulXV(I,C.m_p,z.s_t0),tc);var L=n.m_vertex1,U=n.m_vertex2,Z=z.SubVV(U,L,xc);const ka=$d.Set(Z.y,-Z.x),ia=z.DotVV(ka,z.SubVV(I,L,z.s_t0));if(!(n.m_oneSided&&0>ia)){var ta=z.DotVV(Z,z.SubVV(U,I,z.s_t0)),Ja=z.DotVV(Z,z.SubVV(I,L,z.s_t0)),Oa=n.m_radius+C.m_radius;u=Ad;u.cf.indexB=0;u.cf.typeB=a.ContactFeatureType.e_vertex;if(0>=Ja){if(U=
z.SubVV(I,L,oc),!(z.DotVV(U,U)>Oa*Oa)){if(n.m_oneSided&&(Oa=z.SubVV(L,n.m_vertex0,Ac),0<z.DotVV(Oa,z.SubVV(L,I,z.s_t0))))return;u.cf.indexA=0;u.cf.typeA=a.ContactFeatureType.e_vertex;d.pointCount=1;d.type=a.ManifoldType.e_circles;d.localNormal.SetZero();d.localPoint.Copy(L);d.points[0].id.Copy(u);d.points[0].localPoint.Copy(C.m_p)}}else if(0>=ta){if(L=z.SubVV(I,U,oc),!(z.DotVV(L,L)>Oa*Oa)){if(n.m_oneSided&&(L=z.SubVV(n.m_vertex3,U,Pc),0<z.DotVV(L,z.SubVV(I,U,z.s_t0))))return;u.cf.indexA=1;u.cf.typeA=
a.ContactFeatureType.e_vertex;d.pointCount=1;d.type=a.ManifoldType.e_circles;d.localNormal.SetZero();d.localPoint.Copy(U);d.points[0].id.Copy(u);d.points[0].localPoint.Copy(C.m_p)}}else n=z.DotVV(Z,Z),Z=Wc,Z.x=1/n*(ta*L.x+Ja*U.x),Z.y=1/n*(ta*L.y+Ja*U.y),I=z.SubVV(I,Z,oc),z.DotVV(I,I)>Oa*Oa||(0>ia&&ka.Set(-ka.x,-ka.y),ka.Normalize(),u.cf.indexA=0,u.cf.typeA=a.ContactFeatureType.e_face,d.pointCount=1,d.type=a.ManifoldType.e_faceA,d.localNormal.Copy(ka),d.localPoint.Copy(L),d.points[0].id.Copy(u),d.points[0].localPoint.Copy(C.m_p))}}
function E(d,n,u,C,I){d.pointCount=0;u=rb.MulTXX(u,I,Zd);I=rb.MulXV(u,C.m_centroid,Ze);var L=n.m_vertex1,U=n.m_vertex2,Z=z.SubVV(U,L,md);Z.Normalize();var ka=tf.Set(Z.y,-Z.x);I=z.DotVV(ka,z.SubVV(I,L,z.s_t0));var ia=n.m_oneSided;if(!(ia&&0>I)){var ta=Yk;ta.count=C.m_count;for(I=0;I<C.m_count;++I)ta.vertices.length<=I&&ta.vertices.push(new z),ta.normals.length<=I&&ta.normals.push(new z),rb.MulXV(u,C.m_vertices[I],ta.vertices[I]),ib.MulRV(u.q,C.m_normals[I],ta.normals[I]);I=C.m_radius+n.m_radius;var Ja=
Nc;Ja.type=Xc.e_edgeA;Ja.index=-1;Ja.separation=-Number.MAX_VALUE;Ja.normal.SetZero();var Oa=td;Oa[0].Copy(ka);Oa[1].Copy(ka).SelfNeg();for(ka=0;2>ka;++ka){var Xa=Number.MAX_VALUE;for(var zb=0;zb<ta.count;++zb){var Hb=z.DotVV(Oa[ka],z.SubVV(ta.vertices[zb],L,z.s_t0));Hb<Xa&&(Xa=Hb)}Xa>Ja.separation&&(Ja.index=ka,Ja.separation=Xa,Ja.normal.Copy(Oa[ka]))}if(!(Ja.separation>I)){Oa=pd;Oa.type=Xc.e_unknown;Oa.index=-1;Oa.separation=-Number.MAX_VALUE;Oa.normal.SetZero();for(ka=0;ka<ta.count;++ka)Xa=z.NegV(ta.normals[ka],
Vd),zb=z.DotVV(Xa,z.SubVV(ta.vertices[ka],L,z.s_t0)),Hb=z.DotVV(Xa,z.SubVV(ta.vertices[ka],U,z.s_t0)),zb=f(zb,Hb),zb>Oa.separation&&(Oa.type=Xc.e_edgeB,Oa.index=ka,Oa.separation=zb,Oa.normal.Copy(Xa));if(!(Oa.separation>I)){Oa=Oa.separation-I>.98*(Ja.separation-I)+.001?Oa:Ja;if(ia)if(ka=z.SubVV(L,n.m_vertex0,Zk),ka.Normalize(),ia=$k.Set(ka.y,-ka.x),ka=0<=z.CrossVV(ka,Z),Xa=z.SubVV(n.m_vertex3,U,al),Xa.Normalize(),n=bl.Set(Xa.y,-Xa.x),Xa=0<=z.CrossVV(Z,Xa),0>=z.DotVV(Oa.normal,Z))if(ka){if(.1<z.CrossVV(Oa.normal,
ia))return}else Oa=Ja;else if(Xa){if(.1<z.CrossVV(n,Oa.normal))return}else Oa=Ja;Ja=cl;n=dl;if(Oa.type===Xc.e_edgeA){d.type=a.ManifoldType.e_faceA;ia=0;ka=z.DotVV(Oa.normal,ta.normals[0]);for(Xa=1;Xa<ta.count;++Xa)zb=z.DotVV(Oa.normal,ta.normals[Xa]),zb<ka&&(ka=zb,ia=Xa);ka=ia+1<ta.count?ia+1:0;Ja[0].v.Copy(ta.vertices[ia]);Ja[0].id.cf.indexA=0;Ja[0].id.cf.indexB=ia;Ja[0].id.cf.typeA=a.ContactFeatureType.e_face;Ja[0].id.cf.typeB=a.ContactFeatureType.e_vertex;Ja[1].v.Copy(ta.vertices[ka]);Ja[1].id.cf.indexA=
0;Ja[1].id.cf.indexB=ka;Ja[1].id.cf.typeA=a.ContactFeatureType.e_face;Ja[1].id.cf.typeB=a.ContactFeatureType.e_vertex;n.i1=0;n.i2=1;n.v1.Copy(L);n.v2.Copy(U);n.normal.Copy(Oa.normal);n.sideNormal1.Copy(Z).SelfNeg();n.sideNormal2.Copy(Z)}else d.type=a.ManifoldType.e_faceB,Ja[0].v.Copy(U),Ja[0].id.cf.indexA=1,Ja[0].id.cf.indexB=Oa.index,Ja[0].id.cf.typeA=a.ContactFeatureType.e_vertex,Ja[0].id.cf.typeB=a.ContactFeatureType.e_face,Ja[1].v.Copy(L),Ja[1].id.cf.indexA=0,Ja[1].id.cf.indexB=Oa.index,Ja[1].id.cf.typeA=
a.ContactFeatureType.e_vertex,Ja[1].id.cf.typeB=a.ContactFeatureType.e_face,n.i1=Oa.index,n.i2=n.i1+1<ta.count?n.i1+1:0,n.v1.Copy(ta.vertices[n.i1]),n.v2.Copy(ta.vertices[n.i2]),n.normal.Copy(ta.normals[n.i1]),n.sideNormal1.Set(n.normal.y,-n.normal.x),n.sideNormal2.Copy(n.sideNormal1).SelfNeg();n.sideOffset1=z.DotVV(n.sideNormal1,n.v1);n.sideOffset2=z.DotVV(n.sideNormal2,n.v2);U=el;L=fl;Z=D(U,Ja,n.sideNormal1,n.sideOffset1,n.i1);if(!(2>Z||(Z=D(L,U,n.sideNormal2,n.sideOffset2,n.i2),2>Z))){Oa.type===
Xc.e_edgeA?(d.localNormal.Copy(n.normal),d.localPoint.Copy(n.v1)):(d.localNormal.Copy(C.m_normals[n.i1]),d.localPoint.Copy(C.m_vertices[n.i1]));C=0;for(U=0;2>U;++U)z.DotVV(n.normal,z.SubVV(L[U].v,n.v1,z.s_t0))<=I&&(Z=d.points[C],Oa.type===Xc.e_edgeA?(rb.MulTXV(u,L[U].v,Z.localPoint),Z.id.Copy(L[U].id)):(Z.localPoint.Copy(L[U].v),Z.id.cf.typeA=L[U].id.cf.typeB,Z.id.cf.typeB=L[U].id.cf.typeA,Z.id.cf.indexA=L[U].id.cf.indexB,Z.id.cf.indexB=L[U].id.cf.indexA),++C);d.pointCount=C}}}}}function Q(d,n,u,
C,I){const L=n.m_count,U=C.m_count,Z=n.m_normals;n=n.m_vertices;C=C.m_vertices;u=rb.MulTXX(I,u,gl);I=0;let ka=-1E37;for(let ia=0;ia<L;++ia){const ta=ib.MulRV(u.q,Z[ia],hl),Ja=rb.MulXV(u,n[ia],il);let Oa=1E37;for(let Xa=0;Xa<U;++Xa){const zb=z.DotVV(ta,z.SubVV(C[Xa],Ja,z.s_t0));zb<Oa&&(Oa=zb)}Oa>ka&&(ka=Oa,I=ia)}d[0]=I;return ka}function aa(d,n,u,C,I){d.pointCount=0;const L=n.m_radius+C.m_radius;var U=jl;U[0]=0;var Z=Q(U,n,u,C,I);if(!(Z>L)){var ka=kl;ka[0]=0;var ia=Q(ka,C,I,n,u);if(!(ia>L)){if(ia>
Z+5E-4){Z=C;var ta=n;n=I;I=ka[0];d.type=a.ManifoldType.e_faceB;U=1}else Z=n,ta=C,n=u,u=I,I=U[0],d.type=a.ManifoldType.e_faceA,U=0;ka=ll;C=I;ia=u;var Ja=ta.m_count,Oa=ta.m_vertices;ta=ta.m_normals;var Xa=ib.MulTRV(ia.q,ib.MulRV(n.q,Z.m_normals[C],z.s_t0),ml),zb=0,Hb=1E37;for(var Jb=0;Jb<Ja;++Jb){const Tb=z.DotVV(Xa,ta[Jb]);Tb<Hb&&(Hb=Tb,zb=Jb)}ta=zb;Ja=ta+1<Ja?ta+1:0;Xa=ka[0];rb.MulXV(ia,Oa[ta],Xa.v);Xa=Xa.id.cf;Xa.indexA=C;Xa.indexB=ta;Xa.typeA=a.ContactFeatureType.e_face;Xa.typeB=a.ContactFeatureType.e_vertex;
ta=ka[1];rb.MulXV(ia,Oa[Ja],ta.v);ia=ta.id.cf;ia.indexA=C;ia.indexB=Ja;ia.typeA=a.ContactFeatureType.e_face;ia.typeB=a.ContactFeatureType.e_vertex;ia=Z.m_vertices;C=I;I=I+1<Z.m_count?I+1:0;ta=ia[C];Xa=ia[I];Z=z.SubVV(Xa,ta,nl);Z.Normalize();ia=z.CrossVOne(Z,ol);Oa=z.MidVV(ta,Xa,pl);Ja=ib.MulRV(n.q,Z,ql);Z=z.CrossVOne(Ja,rl);ta=rb.MulXV(n,ta,sl);zb=rb.MulXV(n,Xa,tl);n=z.DotVV(Z,ta);Xa=-z.DotVV(Ja,ta)+L;zb=z.DotVV(Ja,zb)+L;Hb=ul;ta=vl;Jb=z.NegV(Ja,wl);ka=D(Hb,ka,Jb,Xa,C);if(!(2>ka||(ka=D(ta,Hb,Ja,zb,
I),2>ka))){d.localNormal.Copy(ia);d.localPoint.Copy(Oa);ka=0;for(I=0;2>I;++I)ia=ta[I],z.DotVV(Z,ia.v)-n<=L&&(C=d.points[ka],rb.MulTXV(u,ia.v,C.localPoint),C.id.Copy(ia.id),U&&(ia=C.id.cf,C.id.cf.indexA=ia.indexB,C.id.cf.indexB=ia.indexA,C.id.cf.typeA=ia.typeB,C.id.cf.typeB=ia.typeA),++ka);d.pointCount=ka}}}}function qa(d,n){const u=xl.Reset();++a.toiCalls;d.state=a.TOIOutputState.e_unknown;d.t=n.tMax;const C=n.proxyA,I=n.proxyB,L=h(8,h(C.m_count,I.m_count)),U=yl.Copy(n.sweepA),Z=zl.Copy(n.sweepB);
U.Normalize();Z.Normalize();const ka=n.tMax,ia=h(.005,C.m_radius+I.m_radius-.015);let ta=0,Ja=0;const Oa=Al;Oa.count=0;const Xa=Bl;Xa.proxyA.Copy(n.proxyA);Xa.proxyB.Copy(n.proxyB);for(Xa.useRadii=!1;;){n=Vf;var zb=Wf;U.GetTransform(n,ta);Z.GetTransform(zb,ta);Xa.transformA.Copy(n);Xa.transformB.Copy(zb);n=Cl;r(n,Oa,Xa);if(0>=n.distance){d.state=a.TOIOutputState.e_overlapped;d.t=0;break}if(n.distance<ia+.00125){d.state=a.TOIOutputState.e_touching;d.t=ta;break}n=Dl;n.Initialize(Oa,C,U,I,Z,ta);zb=!1;
let Hb=ka,Jb=0;for(;;){const Tb=El,Vb=Fl;let Qb=n.FindMinSeparation(Tb,Vb,Hb);if(Qb>ia+.00125){d.state=a.TOIOutputState.e_separated;d.t=ka;zb=!0;break}if(Qb>ia-.00125){ta=Hb;break}let fc=n.Evaluate(Tb[0],Vb[0],ta);if(fc<ia-.00125){d.state=a.TOIOutputState.e_failed;d.t=ta;zb=!0;break}if(fc<=ia+.00125){d.state=a.TOIOutputState.e_touching;d.t=ta;zb=!0;break}let cc=0,jc=ta,mc=Hb;for(;;){let qc;qc=cc&1?jc+(ia-fc)*(mc-jc)/(Qb-fc):.5*(jc+mc);++cc;++a.toiRootIters;const yc=n.Evaluate(Tb[0],Vb[0],qc);if(.00125>
eb(yc-ia)){Hb=qc;break}yc>ia?(jc=qc,fc=yc):(mc=qc,Qb=yc);if(50===cc)break}a.toiMaxRootIters=h(a.toiMaxRootIters,cc);++Jb;if(Jb===L)break}++Ja;++a.toiIters;if(zb)break;if(20===Ja){d.state=a.TOIOutputState.e_failed;d.t=ta;break}}a.toiMaxIters=h(a.toiMaxIters,Ja);d=u.GetMilliseconds();a.toiMaxTime=h(a.toiMaxTime,d);a.toiTime+=d}function P(d,n){return d>n?d:n}function ea(d,n){return d<n?d:n}function ua(d,n,u){return g(Math.ceil(Math.sqrt(d/(.01*n))*u),1,8)}function Fa(d,n,u){const C=d[n];d[n]=d[u];d[u]=
C}function pa(d,n){return d<n}function ra(d,n=0,u=d.length-n,C=pa){const I=[];let L=0;for(;;){for(;n+1<u;u++){const U=d[n+Math.floor(Math.random()*(u-n))];I[L++]=u;for(let Z=n-1;;){for(;C(d[++Z],U););for(;C(U,d[--u]););if(Z>=u)break;Fa(d,Z,u)}}if(0===L)break;n=u;u=I[--L]}return d}function Ca(d,n=0,u=d.length-n,C=pa){return ra(d,n,u,C)}function Ga(d,n,u=d.length){let C=0;for(let I=0;I<u;++I)n(d[I])||(I===C?++C:Fa(d,C++,I));return C}function Aa(d,n,u,C,I){for(u-=n;0<u;){const L=Math.floor(u/2);let U=
n+L;I(d[U],C)?(n=++U,u-=L+1):u=L}return n}function xa(d,n,u,C,I){for(u-=n;0<u;){const L=Math.floor(u/2);let U=n+L;I(C,d[U])?u=L:(n=++U,u-=L+1)}return n}function za(d,n,u,C){let I=u;for(;n!==I;)Fa(d,n++,I++),I===C?I=u:n===u&&(u=I)}class Na{}class ya{constructor(d=.5,n=.5,u=.5,C=1){this.r=d;this.g=n;this.b=u;this.a=C}Clone(){return(new ya).Copy(this)}Copy(d){this.r=d.r;this.g=d.g;this.b=d.b;this.a=d.a;return this}IsEqual(d){return this.r===d.r&&this.g===d.g&&this.b===d.b&&this.a===d.a}IsZero(){return 0===
this.r&&0===this.g&&0===this.b&&0===this.a}Set(d,n,u,C=this.a){this.SetRGBA(d,n,u,C)}SetByteRGB(d,n,u){this.r=d/255;this.g=n/255;this.b=u/255;return this}SetByteRGBA(d,n,u,C){this.r=d/255;this.g=n/255;this.b=u/255;this.a=C/255;return this}SetRGB(d,n,u){this.r=d;this.g=n;this.b=u;return this}SetRGBA(d,n,u,C){this.r=d;this.g=n;this.b=u;this.a=C;return this}SelfAdd(d){this.r+=d.r;this.g+=d.g;this.b+=d.b;this.a+=d.a;return this}Add(d,n){n.r=this.r+d.r;n.g=this.g+d.g;n.b=this.b+d.b;n.a=this.a+d.a;return n}SelfSub(d){this.r-=
d.r;this.g-=d.g;this.b-=d.b;this.a-=d.a;return this}Sub(d,n){n.r=this.r-d.r;n.g=this.g-d.g;n.b=this.b-d.b;n.a=this.a-d.a;return n}SelfMul(d){this.r*=d;this.g*=d;this.b*=d;this.a*=d;return this}Mul(d,n){n.r=this.r*d;n.g=this.g*d;n.b=this.b*d;n.a=this.a*d;return n}Mix(d,n){ya.MixColors(this,d,n)}static MixColors(d,n,u){const C=u*(n.r-d.r),I=u*(n.g-d.g),L=u*(n.b-d.b);u*=n.a-d.a;d.r+=C;d.g+=I;d.b+=L;d.a+=u;n.r-=C;n.g-=I;n.b-=L;n.a-=u}MakeStyleString(d=this.a){return ya.MakeStyleString(this.r,this.g,this.b,
d)}static MakeStyleString(d,n,u,C=1){d*=255;n*=255;u*=255;return 1>C?`rgba(${d},${n},${u},${C})`:`rgb(${d},${n},${u})`}}ya.ZERO=new ya(0,0,0,0);ya.RED=new ya(1,0,0);ya.GREEN=new ya(0,1,0);ya.BLUE=new ya(0,0,1);class Ia{constructor(...d){if(d[0]instanceof Float32Array){if(4!==d[0].length)throw Error();this.data=d[0]}else this.data=new Float32Array(["number"===typeof d[0]?d[0]:.5,"number"===typeof d[1]?d[1]:.5,"number"===typeof d[2]?d[2]:.5,"number"===typeof d[3]?d[3]:1])}get r(){return this.data[0]}set r(d){this.data[0]=
d}get g(){return this.data[1]}set g(d){this.data[1]=d}get b(){return this.data[2]}set b(d){this.data[2]=d}get a(){return this.data[3]}set a(d){this.data[3]=d}Clone(){return new Ia(new Float32Array(this.data))}Copy(d){d instanceof Ia?this.data.set(d.data):(this.r=d.r,this.g=d.g,this.b=d.b,this.a=d.a);return this}IsEqual(d){return this.r===d.r&&this.g===d.g&&this.b===d.b&&this.a===d.a}IsZero(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a}Set(d,n,u,C=this.a){this.SetRGBA(d,n,u,C)}SetByteRGB(d,
n,u){this.r=d/255;this.g=n/255;this.b=u/255;return this}SetByteRGBA(d,n,u,C){this.r=d/255;this.g=n/255;this.b=u/255;this.a=C/255;return this}SetRGB(d,n,u){this.r=d;this.g=n;this.b=u;return this}SetRGBA(d,n,u,C){this.r=d;this.g=n;this.b=u;this.a=C;return this}SelfAdd(d){this.r+=d.r;this.g+=d.g;this.b+=d.b;this.a+=d.a;return this}Add(d,n){n.r=this.r+d.r;n.g=this.g+d.g;n.b=this.b+d.b;n.a=this.a+d.a;return n}SelfSub(d){this.r-=d.r;this.g-=d.g;this.b-=d.b;this.a-=d.a;return this}Sub(d,n){n.r=this.r-d.r;
n.g=this.g-d.g;n.b=this.b-d.b;n.a=this.a-d.a;return n}SelfMul(d){this.r*=d;this.g*=d;this.b*=d;this.a*=d;return this}Mul(d,n){n.r=this.r*d;n.g=this.g*d;n.b=this.b*d;n.a=this.a*d;return n}Mix(d,n){ya.MixColors(this,d,n)}MakeStyleString(d=this.a){return ya.MakeStyleString(this.r,this.g,this.b,d)}}(function(d){d[d.e_none=0]="e_none";d[d.e_shapeBit=1]="e_shapeBit";d[d.e_jointBit=2]="e_jointBit";d[d.e_aabbBit=4]="e_aabbBit";d[d.e_pairBit=8]="e_pairBit";d[d.e_centerOfMassBit=16]="e_centerOfMassBit";d[d.e_particleBit=
32]="e_particleBit";d[d.e_controllerBit=64]="e_controllerBit";d[d.e_all=63]="e_all"})(a.DrawFlags||(a.DrawFlags={}));class $a{constructor(){this.m_drawFlags=0}SetFlags(d){this.m_drawFlags=d}GetFlags(){return this.m_drawFlags}AppendFlags(d){this.m_drawFlags|=d}ClearFlags(d){this.m_drawFlags&=~d}}const lb=1E-5*1E-5,xb=2/180*3.14159265359,Cb=8/180*3.14159265359,ca=2/180*3.14159265359;class Sa{constructor(d=0,n=0,u=0){this.revision=0;this.major=d;this.minor=n;this.revision=u}toString(){return this.major+
"."+this.minor+"."+this.revision}}const Va=new Sa(2,4,1);class fb{constructor(d){this.m_stack=[];this.m_count=0;this.m_stack=l(d,()=>null);this.m_count=0}Reset(){this.m_count=0;return this}Push(d){this.m_stack[this.m_count]=d;this.m_count++}Pop(){this.m_count--;const d=this.m_stack[this.m_count];this.m_stack[this.m_count]=null;return d}GetCount(){return this.m_count}}const Qa=3.14159265359/180,eb=Math.abs,mb=isFinite,ub=Math.sqrt,Bb=Math.pow,qb=Math.cos,yb=Math.sin,Ib=Math.acos,Pb=Math.asin,Eb=Math.atan2;
class z{constructor(d=0,n=0){this.x=d;this.y=n}Clone(){return new z(this.x,this.y)}SetZero(){this.y=this.x=0;return this}Set(d,n){this.x=d;this.y=n;return this}Copy(d){this.x=d.x;this.y=d.y;return this}SelfAdd(d){this.x+=d.x;this.y+=d.y;return this}SelfAddXY(d,n){this.x+=d;this.y+=n;return this}SelfSub(d){this.x-=d.x;this.y-=d.y;return this}SelfSubXY(d,n){this.x-=d;this.y-=n;return this}SelfMul(d){this.x*=d;this.y*=d;return this}SelfMulAdd(d,n){this.x+=d*n.x;this.y+=d*n.y;return this}SelfMulSub(d,
n){this.x-=d*n.x;this.y-=d*n.y;return this}Dot(d){return this.x*d.x+this.y*d.y}Cross(d){return this.x*d.y-this.y*d.x}Length(){const d=this.x,n=this.y;return Math.sqrt(d*d+n*n)}LengthSquared(){const d=this.x,n=this.y;return d*d+n*n}Normalize(){const d=this.Length();if(1E-5<=d){const n=1/d;this.x*=n;this.y*=n}return d}SelfNormalize(){var d=this.Length();1E-5<=d&&(d=1/d,this.x*=d,this.y*=d);return this}SelfRotate(d){const n=Math.cos(d);d=Math.sin(d);const u=this.x;this.x=n*u-d*this.y;this.y=d*u+n*this.y;
return this}SelfRotateCosSin(d,n){const u=this.x;this.x=d*u-n*this.y;this.y=n*u+d*this.y;return this}IsValid(){return isFinite(this.x)&&isFinite(this.y)}SelfCrossVS(d){const n=this.x;this.x=d*this.y;this.y=-d*n;return this}SelfCrossSV(d){const n=this.x;this.x=-d*this.y;this.y=d*n;return this}SelfMinV(d){this.x=f(this.x,d.x);this.y=f(this.y,d.y);return this}SelfMaxV(d){this.x=h(this.x,d.x);this.y=h(this.y,d.y);return this}SelfAbs(){this.x=eb(this.x);this.y=eb(this.y);return this}SelfNeg(){this.x=-this.x;
this.y=-this.y;return this}SelfSkew(){const d=this.x;this.x=-this.y;this.y=d;return this}static MakeArray(d){return l(d,()=>new z)}static AbsV(d,n){n.x=eb(d.x);n.y=eb(d.y);return n}static MinV(d,n,u){u.x=f(d.x,n.x);u.y=f(d.y,n.y);return u}static MaxV(d,n,u){u.x=h(d.x,n.x);u.y=h(d.y,n.y);return u}static ClampV(d,n,u,C){C.x=g(d.x,n.x,u.x);C.y=g(d.y,n.y,u.y);return C}static RotateV(d,n,u){const C=d.x;d=d.y;const I=Math.cos(n);n=Math.sin(n);u.x=I*C-n*d;u.y=n*C+I*d;return u}static DotVV(d,n){return d.x*
n.x+d.y*n.y}static CrossVV(d,n){return d.x*n.y-d.y*n.x}static CrossVS(d,n,u){const C=d.x;u.x=n*d.y;u.y=-n*C;return u}static CrossVOne(d,n){const u=d.x;n.x=d.y;n.y=-u;return n}static CrossSV(d,n,u){const C=n.x;u.x=-d*n.y;u.y=d*C;return u}static CrossOneV(d,n){const u=d.x;n.x=-d.y;n.y=u;return n}static AddVV(d,n,u){u.x=d.x+n.x;u.y=d.y+n.y;return u}static SubVV(d,n,u){u.x=d.x-n.x;u.y=d.y-n.y;return u}static MulSV(d,n,u){u.x=n.x*d;u.y=n.y*d;return u}static MulVS(d,n,u){u.x=d.x*n;u.y=d.y*n;return u}static AddVMulSV(d,
n,u,C){C.x=d.x+n*u.x;C.y=d.y+n*u.y;return C}static SubVMulSV(d,n,u,C){C.x=d.x-n*u.x;C.y=d.y-n*u.y;return C}static AddVCrossSV(d,n,u,C){const I=u.x;C.x=d.x-n*u.y;C.y=d.y+n*I;return C}static MidVV(d,n,u){u.x=.5*(d.x+n.x);u.y=.5*(d.y+n.y);return u}static ExtVV(d,n,u){u.x=.5*(n.x-d.x);u.y=.5*(n.y-d.y);return u}static IsEqualToV(d,n){return d.x===n.x&&d.y===n.y}static DistanceVV(d,n){const u=d.x-n.x;d=d.y-n.y;return Math.sqrt(u*u+d*d)}static DistanceSquaredVV(d,n){const u=d.x-n.x;d=d.y-n.y;return u*u+
d*d}static NegV(d,n){n.x=-d.x;n.y=-d.y;return n}}z.ZERO=new z(0,0);z.UNITX=new z(1,0);z.UNITY=new z(0,1);z.s_t0=new z;z.s_t1=new z;z.s_t2=new z;z.s_t3=new z;const Xb=new z(0,0);class Nb{constructor(...d){if(d[0]instanceof Float32Array){if(2!==d[0].length)throw Error();this.data=d[0]}else this.data=new Float32Array(["number"===typeof d[0]?d[0]:0,"number"===typeof d[1]?d[1]:0])}get x(){return this.data[0]}set x(d){this.data[0]=d}get y(){return this.data[1]}set y(d){this.data[1]=d}Clone(){return new Nb(new Float32Array(this.data))}SetZero(){this.y=
this.x=0;return this}Set(d,n){this.x=d;this.y=n;return this}Copy(d){d instanceof Nb?this.data.set(d.data):(this.x=d.x,this.y=d.y);return this}SelfAdd(d){this.x+=d.x;this.y+=d.y;return this}SelfAddXY(d,n){this.x+=d;this.y+=n;return this}SelfSub(d){this.x-=d.x;this.y-=d.y;return this}SelfSubXY(d,n){this.x-=d;this.y-=n;return this}SelfMul(d){this.x*=d;this.y*=d;return this}SelfMulAdd(d,n){this.x+=d*n.x;this.y+=d*n.y;return this}SelfMulSub(d,n){this.x-=d*n.x;this.y-=d*n.y;return this}Dot(d){return this.x*
d.x+this.y*d.y}Cross(d){return this.x*d.y-this.y*d.x}Length(){const d=this.x,n=this.y;return Math.sqrt(d*d+n*n)}LengthSquared(){const d=this.x,n=this.y;return d*d+n*n}Normalize(){const d=this.Length();if(1E-5<=d){const n=1/d;this.x*=n;this.y*=n}return d}SelfNormalize(){var d=this.Length();1E-5<=d&&(d=1/d,this.x*=d,this.y*=d);return this}SelfRotate(d){const n=Math.cos(d);d=Math.sin(d);const u=this.x;this.x=n*u-d*this.y;this.y=d*u+n*this.y;return this}SelfRotateCosSin(d,n){const u=this.x;this.x=d*u-
n*this.y;this.y=n*u+d*this.y;return this}IsValid(){return isFinite(this.x)&&isFinite(this.y)}SelfCrossVS(d){const n=this.x;this.x=d*this.y;this.y=-d*n;return this}SelfCrossSV(d){const n=this.x;this.x=-d*this.y;this.y=d*n;return this}SelfMinV(d){this.x=f(this.x,d.x);this.y=f(this.y,d.y);return this}SelfMaxV(d){this.x=h(this.x,d.x);this.y=h(this.y,d.y);return this}SelfAbs(){this.x=eb(this.x);this.y=eb(this.y);return this}SelfNeg(){this.x=-this.x;this.y=-this.y;return this}SelfSkew(){const d=this.x;
this.x=-this.y;this.y=d;return this}}class Rb{constructor(...d){if(d[0]instanceof Float32Array){if(3!==d[0].length)throw Error();this.data=d[0]}else this.data=new Float32Array(["number"===typeof d[0]?d[0]:0,"number"===typeof d[1]?d[1]:0,"number"===typeof d[2]?d[2]:0])}get x(){return this.data[0]}set x(d){this.data[0]=d}get y(){return this.data[1]}set y(d){this.data[1]=d}get z(){return this.data[2]}set z(d){this.data[2]=d}Clone(){return new Rb(this.x,this.y,this.z)}SetZero(){this.z=this.y=this.x=0;
return this}SetXYZ(d,n,u){this.x=d;this.y=n;this.z=u;return this}Copy(d){this.x=d.x;this.y=d.y;this.z=d.z;return this}SelfNeg(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this}SelfAdd(d){this.x+=d.x;this.y+=d.y;this.z+=d.z;return this}SelfAddXYZ(d,n,u){this.x+=d;this.y+=n;this.z+=u;return this}SelfSub(d){this.x-=d.x;this.y-=d.y;this.z-=d.z;return this}SelfSubXYZ(d,n,u){this.x-=d;this.y-=n;this.z-=u;return this}SelfMul(d){this.x*=d;this.y*=d;this.z*=d;return this}static DotV3V3(d,n){return d.x*
n.x+d.y*n.y+d.z*n.z}static CrossV3V3(d,n,u){const C=d.x,I=d.y;d=d.z;const L=n.x,U=n.y;n=n.z;u.x=I*n-d*U;u.y=d*L-C*n;u.z=C*U-I*L;return u}}Rb.ZERO=new Rb(0,0,0);Rb.s_t0=new Rb;class Fb{constructor(){this.ex=new z(1,0);this.ey=new z(0,1)}Clone(){return(new Fb).Copy(this)}static FromVV(d,n){return(new Fb).SetVV(d,n)}static FromSSSS(d,n,u,C){return(new Fb).SetSSSS(d,n,u,C)}static FromAngle(d){return(new Fb).SetAngle(d)}SetSSSS(d,n,u,C){this.ex.Set(d,u);this.ey.Set(n,C);return this}SetVV(d,n){this.ex.Copy(d);
this.ey.Copy(n);return this}SetAngle(d){const n=Math.cos(d);d=Math.sin(d);this.ex.Set(n,d);this.ey.Set(-d,n);return this}Copy(d){this.ex.Copy(d.ex);this.ey.Copy(d.ey);return this}SetIdentity(){this.ex.Set(1,0);this.ey.Set(0,1);return this}SetZero(){this.ex.SetZero();this.ey.SetZero();return this}GetAngle(){return Math.atan2(this.ex.y,this.ex.x)}GetInverse(d){const n=this.ex.x,u=this.ey.x,C=this.ex.y,I=this.ey.y;let L=n*I-u*C;0!==L&&(L=1/L);d.ex.x=L*I;d.ey.x=-L*u;d.ex.y=-L*C;d.ey.y=L*n;return d}Solve(d,
n,u){const C=this.ex.x,I=this.ey.x,L=this.ex.y,U=this.ey.y;let Z=C*U-I*L;0!==Z&&(Z=1/Z);u.x=Z*(U*d-I*n);u.y=Z*(C*n-L*d);return u}SelfAbs(){this.ex.SelfAbs();this.ey.SelfAbs();return this}SelfInv(){this.GetInverse(this);return this}SelfAddM(d){this.ex.SelfAdd(d.ex);this.ey.SelfAdd(d.ey);return this}SelfSubM(d){this.ex.SelfSub(d.ex);this.ey.SelfSub(d.ey);return this}static AbsM(d,n){const u=d.ex;d=d.ey;n.ex.x=eb(u.x);n.ex.y=eb(u.y);n.ey.x=eb(d.x);n.ey.y=eb(d.y);return n}static MulMV(d,n,u){const C=
d.ex;d=d.ey;const I=n.x;n=n.y;u.x=C.x*I+d.x*n;u.y=C.y*I+d.y*n;return u}static MulTMV(d,n,u){const C=d.ex;d=d.ey;const I=n.x;n=n.y;u.x=C.x*I+C.y*n;u.y=d.x*I+d.y*n;return u}static AddMM(d,n,u){const C=d.ex;d=d.ey;const I=n.ex;n=n.ey;u.ex.x=C.x+I.x;u.ex.y=C.y+I.y;u.ey.x=d.x+n.x;u.ey.y=d.y+n.y;return u}static MulMM(d,n,u){const C=d.ex.x,I=d.ex.y,L=d.ey.x;d=d.ey.y;const U=n.ex.x,Z=n.ex.y,ka=n.ey.x;n=n.ey.y;u.ex.x=C*U+L*Z;u.ex.y=I*U+d*Z;u.ey.x=C*ka+L*n;u.ey.y=I*ka+d*n;return u}static MulTMM(d,n,u){const C=
d.ex.x,I=d.ex.y,L=d.ey.x;d=d.ey.y;const U=n.ex.x,Z=n.ex.y,ka=n.ey.x;n=n.ey.y;u.ex.x=C*U+I*Z;u.ex.y=L*U+d*Z;u.ey.x=C*ka+I*n;u.ey.y=L*ka+d*n;return u}}Fb.IDENTITY=new Fb;class Wb{constructor(){this.data=new Float32Array([1,0,0,0,1,0,0,0,1]);this.ex=new Rb(this.data.subarray(0,3));this.ey=new Rb(this.data.subarray(3,6));this.ez=new Rb(this.data.subarray(6,9))}Clone(){return(new Wb).Copy(this)}SetVVV(d,n,u){this.ex.Copy(d);this.ey.Copy(n);this.ez.Copy(u);return this}Copy(d){this.ex.Copy(d.ex);this.ey.Copy(d.ey);
this.ez.Copy(d.ez);return this}SetIdentity(){this.ex.SetXYZ(1,0,0);this.ey.SetXYZ(0,1,0);this.ez.SetXYZ(0,0,1);return this}SetZero(){this.ex.SetZero();this.ey.SetZero();this.ez.SetZero();return this}SelfAddM(d){this.ex.SelfAdd(d.ex);this.ey.SelfAdd(d.ey);this.ez.SelfAdd(d.ez);return this}Solve33(d,n,u,C){const I=this.ex.x,L=this.ex.y,U=this.ex.z,Z=this.ey.x,ka=this.ey.y,ia=this.ey.z,ta=this.ez.x,Ja=this.ez.y,Oa=this.ez.z;let Xa=I*(ka*Oa-ia*Ja)+L*(ia*ta-Z*Oa)+U*(Z*Ja-ka*ta);0!==Xa&&(Xa=1/Xa);C.x=Xa*
(d*(ka*Oa-ia*Ja)+n*(ia*ta-Z*Oa)+u*(Z*Ja-ka*ta));C.y=Xa*(I*(n*Oa-u*Ja)+L*(u*ta-d*Oa)+U*(d*Ja-n*ta));C.z=Xa*(I*(ka*u-ia*n)+L*(ia*d-Z*u)+U*(Z*n-ka*d));return C}Solve22(d,n,u){const C=this.ex.x,I=this.ey.x,L=this.ex.y,U=this.ey.y;let Z=C*U-I*L;0!==Z&&(Z=1/Z);u.x=Z*(U*d-I*n);u.y=Z*(C*n-L*d);return u}GetInverse22(d){const n=this.ex.x,u=this.ey.x,C=this.ex.y,I=this.ey.y;let L=n*I-u*C;0!==L&&(L=1/L);d.ex.x=L*I;d.ey.x=-L*u;d.ex.z=0;d.ex.y=-L*C;d.ey.y=L*n;d.ey.z=0;d.ez.x=0;d.ez.y=0;d.ez.z=0}GetSymInverse33(d){let n=
Rb.DotV3V3(this.ex,Rb.CrossV3V3(this.ey,this.ez,Rb.s_t0));0!==n&&(n=1/n);const u=this.ex.x,C=this.ey.x,I=this.ez.x,L=this.ey.y,U=this.ez.y,Z=this.ez.z;d.ex.x=n*(L*Z-U*U);d.ex.y=n*(I*U-C*Z);d.ex.z=n*(C*U-I*L);d.ey.x=d.ex.y;d.ey.y=n*(u*Z-I*I);d.ey.z=n*(I*C-u*U);d.ez.x=d.ex.z;d.ez.y=d.ey.z;d.ez.z=n*(u*L-C*C)}static MulM33V3(d,n,u){const C=n.x,I=n.y;n=n.z;u.x=d.ex.x*C+d.ey.x*I+d.ez.x*n;u.y=d.ex.y*C+d.ey.y*I+d.ez.y*n;u.z=d.ex.z*C+d.ey.z*I+d.ez.z*n;return u}static MulM33XYZ(d,n,u,C,I){I.x=d.ex.x*n+d.ey.x*
u+d.ez.x*C;I.y=d.ex.y*n+d.ey.y*u+d.ez.y*C;I.z=d.ex.z*n+d.ey.z*u+d.ez.z*C;return I}static MulM33V2(d,n,u){const C=n.x;n=n.y;u.x=d.ex.x*C+d.ey.x*n;u.y=d.ex.y*C+d.ey.y*n;return u}static MulM33XY(d,n,u,C){C.x=d.ex.x*n+d.ey.x*u;C.y=d.ex.y*n+d.ey.y*u;return C}}Wb.IDENTITY=new Wb;class ib{constructor(d=0){this.s=0;this.c=1;d&&(this.s=Math.sin(d),this.c=Math.cos(d))}Clone(){return(new ib).Copy(this)}Copy(d){this.s=d.s;this.c=d.c;return this}SetAngle(d){this.s=Math.sin(d);this.c=Math.cos(d);return this}SetIdentity(){this.s=
0;this.c=1;return this}GetAngle(){return Math.atan2(this.s,this.c)}GetXAxis(d){d.x=this.c;d.y=this.s;return d}GetYAxis(d){d.x=-this.s;d.y=this.c;return d}static MulRR(d,n,u){const C=d.c;d=d.s;const I=n.c;n=n.s;u.s=d*I+C*n;u.c=C*I-d*n;return u}static MulTRR(d,n,u){const C=d.c;d=d.s;const I=n.c;n=n.s;u.s=C*n-d*I;u.c=C*I+d*n;return u}static MulRV(d,n,u){const C=d.c;d=d.s;const I=n.x;n=n.y;u.x=C*I-d*n;u.y=d*I+C*n;return u}static MulTRV(d,n,u){const C=d.c;d=d.s;const I=n.x;n=n.y;u.x=C*I+d*n;u.y=-d*I+C*
n;return u}}ib.IDENTITY=new ib;class rb{constructor(){this.p=new z;this.q=new ib}Clone(){return(new rb).Copy(this)}Copy(d){this.p.Copy(d.p);this.q.Copy(d.q);return this}SetIdentity(){this.p.SetZero();this.q.SetIdentity();return this}SetPositionRotation(d,n){this.p.Copy(d);this.q.Copy(n);return this}SetPositionAngle(d,n){this.p.Copy(d);this.q.SetAngle(n);return this}SetPosition(d){this.p.Copy(d);return this}SetPositionXY(d,n){this.p.Set(d,n);return this}SetRotation(d){this.q.Copy(d);return this}SetRotationAngle(d){this.q.SetAngle(d);
return this}GetPosition(){return this.p}GetRotation(){return this.q}GetRotationAngle(){return this.q.GetAngle()}GetAngle(){return this.q.GetAngle()}static MulXV(d,n,u){const C=d.q.c,I=d.q.s,L=n.x;n=n.y;u.x=C*L-I*n+d.p.x;u.y=I*L+C*n+d.p.y;return u}static MulTXV(d,n,u){const C=d.q.c,I=d.q.s,L=n.x-d.p.x;d=n.y-d.p.y;u.x=C*L+I*d;u.y=-I*L+C*d;return u}static MulXX(d,n,u){ib.MulRR(d.q,n.q,u.q);z.AddVV(ib.MulRV(d.q,n.p,u.p),d.p,u.p);return u}static MulTXX(d,n,u){ib.MulTRR(d.q,n.q,u.q);ib.MulTRV(d.q,z.SubVV(n.p,
d.p,u.p),u.p);return u}}rb.IDENTITY=new rb;class ab{constructor(){this.localCenter=new z;this.c0=new z;this.c=new z;this.alpha0=this.a=this.a0=0}Clone(){return(new ab).Copy(this)}Copy(d){this.localCenter.Copy(d.localCenter);this.c0.Copy(d.c0);this.c.Copy(d.c);this.a0=d.a0;this.a=d.a;this.alpha0=d.alpha0;return this}GetTransform(d,n){d.p.x=(1-n)*this.c0.x+n*this.c.x;d.p.y=(1-n)*this.c0.y+n*this.c.y;d.q.SetAngle((1-n)*this.a0+n*this.a);d.p.SelfSub(ib.MulRV(d.q,this.localCenter,z.s_t0));return d}Advance(d){const n=
(d-this.alpha0)/(1-this.alpha0),u=1-n;this.c0.x=u*this.c0.x+n*this.c.x;this.c0.y=u*this.c0.y+n*this.c.y;this.a0=u*this.a0+n*this.a;this.alpha0=d}Normalize(){const d=6.28318530718*Math.floor(this.a0/6.28318530718);this.a0-=d;this.a-=d}}class ob{}class J{constructor(){this.m_start=Date.now()}Reset(){this.m_start=Date.now();return this}GetMilliseconds(){return Date.now()-this.m_start}}class S{constructor(){this.m_max_count=this.m_min_count=this.m_count=0}GetCount(){return this.m_count}GetMinCount(){return this.m_min_count}GetMaxCount(){return this.m_max_count}ResetCount(){const d=
this.m_count;this.m_count=0;return d}ResetMinCount(){this.m_min_count=0}ResetMaxCount(){this.m_max_count=0}Increment(){this.m_count++;this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)}Decrement(){this.m_count--;this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)}}class fa{constructor(){this.m_vertices=this.m_buffer=z.MakeArray(2);this.m_radius=this.m_count=0}Copy(d){d.m_vertices===d.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(d.m_buffer[0]),this.m_buffer[1].Copy(d.m_buffer[1])):
this.m_vertices=d.m_vertices;this.m_count=d.m_count;this.m_radius=d.m_radius;return this}Reset(){this.m_vertices=this.m_buffer;this.m_radius=this.m_count=0;return this}SetShape(d,n){d.SetupDistanceProxy(this,n)}SetVerticesRadius(d,n,u){this.m_vertices=d;this.m_count=n;this.m_radius=u}GetSupport(d){let n=0,u=z.DotVV(this.m_vertices[0],d);for(let C=1;C<this.m_count;++C){const I=z.DotVV(this.m_vertices[C],d);I>u&&(n=C,u=I)}return n}GetSupportVertex(d){let n=0,u=z.DotVV(this.m_vertices[0],d);for(let C=
1;C<this.m_count;++C){const I=z.DotVV(this.m_vertices[C],d);I>u&&(n=C,u=I)}return this.m_vertices[n]}GetVertexCount(){return this.m_count}GetVertex(d){return this.m_vertices[d]}}class oa{constructor(){this.count=this.metric=0;this.indexA=[0,0,0];this.indexB=[0,0,0]}Reset(){this.count=this.metric=0;return this}}class na{constructor(){this.proxyA=new fa;this.proxyB=new fa;this.transformA=new rb;this.transformB=new rb;this.useRadii=!1}Reset(){this.proxyA.Reset();this.proxyB.Reset();this.transformA.SetIdentity();
this.transformB.SetIdentity();this.useRadii=!1;return this}}class ja{constructor(){this.pointA=new z;this.pointB=new z;this.iterations=this.distance=0}Reset(){this.pointA.SetZero();this.pointB.SetZero();this.iterations=this.distance=0;return this}}class Ba{constructor(){this.proxyA=new fa;this.proxyB=new fa;this.transformA=new rb;this.transformB=new rb;this.translationB=new z}}class Ua{constructor(){this.point=new z;this.normal=new z;this.iterations=this.lambda=0}}a.gjkCalls=0;a.gjkIters=0;a.gjkMaxIters=
0;class Ya{constructor(){this.wA=new z;this.wB=new z;this.w=new z;this.indexB=this.indexA=this.a=0}Copy(d){this.wA.Copy(d.wA);this.wB.Copy(d.wB);this.w.Copy(d.w);this.a=d.a;this.indexA=d.indexA;this.indexB=d.indexB;return this}}class K{constructor(){this.m_v1=new Ya;this.m_v2=new Ya;this.m_v3=new Ya;this.m_vertices=[];this.m_count=0;this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3}ReadCache(d,n,u,C,I){this.m_count=d.count;var L=this.m_vertices;for(var U=0;U<this.m_count;++U){const Z=
L[U];Z.indexA=d.indexA[U];Z.indexB=d.indexB[U];const ka=n.GetVertex(Z.indexA),ia=C.GetVertex(Z.indexB);rb.MulXV(u,ka,Z.wA);rb.MulXV(I,ia,Z.wB);z.SubVV(Z.wB,Z.wA,Z.w);Z.a=0}1<this.m_count&&(d=d.metric,U=this.GetMetric(),U<.5*d||2*d<U||1E-5>U)&&(this.m_count=0);0===this.m_count&&(L=L[0],L.indexA=0,L.indexB=0,n=n.GetVertex(0),C=C.GetVertex(0),rb.MulXV(u,n,L.wA),rb.MulXV(I,C,L.wB),z.SubVV(L.wB,L.wA,L.w),this.m_count=L.a=1)}WriteCache(d){d.metric=this.GetMetric();d.count=this.m_count;const n=this.m_vertices;
for(let u=0;u<this.m_count;++u)d.indexA[u]=n[u].indexA,d.indexB[u]=n[u].indexB}GetSearchDirection(d){switch(this.m_count){case 1:return z.NegV(this.m_v1.w,d);case 2:const n=z.SubVV(this.m_v2.w,this.m_v1.w,d);return 0<z.CrossVV(n,z.NegV(this.m_v1.w,z.s_t0))?z.CrossOneV(n,d):z.CrossVOne(n,d);default:return d.SetZero()}}GetClosestPoint(d){switch(this.m_count){case 0:return d.SetZero();case 1:return d.Copy(this.m_v1.w);case 2:return d.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*
this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:return d.SetZero();default:return d.SetZero()}}GetWitnessPoints(d,n){switch(this.m_count){case 1:d.Copy(this.m_v1.wA);n.Copy(this.m_v1.wB);break;case 2:d.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;d.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;n.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;n.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:n.x=d.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+
this.m_v3.a*this.m_v3.wA.x,n.y=d.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}}GetMetric(){switch(this.m_count){case 0:return 0;case 1:return 0;case 2:return z.DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return z.CrossVV(z.SubVV(this.m_v2.w,this.m_v1.w,z.s_t0),z.SubVV(this.m_v3.w,this.m_v1.w,z.s_t1));default:return 0}}Solve2(){var d=this.m_v1.w,n=this.m_v2.w,u=z.SubVV(n,d,K.s_e12);d=-z.DotVV(d,u);0>=d?this.m_count=this.m_v1.a=1:(n=z.DotVV(n,u),0>=n?(this.m_count=
this.m_v2.a=1,this.m_v1.Copy(this.m_v2)):(u=1/(n+d),this.m_v1.a=n*u,this.m_v2.a=d*u,this.m_count=2))}Solve3(){var d=this.m_v1.w;const n=this.m_v2.w;var u=this.m_v3.w,C=z.SubVV(n,d,K.s_e12),I=z.DotVV(d,C),L=z.DotVV(n,C);I=-I;var U=z.SubVV(u,d,K.s_e13),Z=z.DotVV(d,U),ka=z.DotVV(u,U);Z=-Z;var ia=z.SubVV(u,n,K.s_e23),ta=z.DotVV(n,ia);ia=z.DotVV(u,ia);ta=-ta;U=z.CrossVV(C,U);C=U*z.CrossVV(n,u);u=U*z.CrossVV(u,d);d=U*z.CrossVV(d,n);0>=I&&0>=Z?this.m_count=this.m_v1.a=1:0<L&&0<I&&0>=d?(ka=1/(L+I),this.m_v1.a=
L*ka,this.m_v2.a=I*ka,this.m_count=2):0<ka&&0<Z&&0>=u?(L=1/(ka+Z),this.m_v1.a=ka*L,this.m_v3.a=Z*L,this.m_count=2,this.m_v2.Copy(this.m_v3)):0>=L&&0>=ta?(this.m_count=this.m_v2.a=1,this.m_v1.Copy(this.m_v2)):0>=ka&&0>=ia?(this.m_count=this.m_v3.a=1,this.m_v1.Copy(this.m_v3)):0<ia&&0<ta&&0>=C?(L=1/(ia+ta),this.m_v2.a=ia*L,this.m_v3.a=ta*L,this.m_count=2,this.m_v1.Copy(this.m_v3)):(L=1/(C+u+d),this.m_v1.a=C*L,this.m_v2.a=u*L,this.m_v3.a=d*L,this.m_count=3)}}K.s_e12=new z;K.s_e13=new z;K.s_e23=new z;
const X=new K,Y=[0,0,0],la=[0,0,0],sa=new z,va=new z,ba=new z,ha=new z,k=new z,p=new z,A=new K,H=new z,O=new z,M=new z,R=new z,W=new z,ma=new z;(function(d){d[d.e_vertex=0]="e_vertex";d[d.e_face=1]="e_face"})(a.ContactFeatureType||(a.ContactFeatureType={}));class wa{constructor(){this._key=0;this._key_invalid=!1;this._typeB=this._typeA=this._indexB=this._indexA=0}get key(){this._key_invalid&&(this._key_invalid=!1,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24);return this._key}set key(d){this._key=
d;this._key_invalid=!1;this._indexA=this._key&255;this._indexB=this._key>>8&255;this._typeA=this._key>>16&255;this._typeB=this._key>>24&255}get indexA(){return this._indexA}set indexA(d){this._indexA=d;this._key_invalid=!0}get indexB(){return this._indexB}set indexB(d){this._indexB=d;this._key_invalid=!0}get typeA(){return this._typeA}set typeA(d){this._typeA=d;this._key_invalid=!0}get typeB(){return this._typeB}set typeB(d){this._typeB=d;this._key_invalid=!0}}class Da{constructor(){this.cf=new wa}Copy(d){this.key=
d.key;return this}Clone(){return(new Da).Copy(this)}get key(){return this.cf.key}set key(d){this.cf.key=d}}class Ea{constructor(){this.localPoint=new z;this.tangentImpulse=this.normalImpulse=0;this.id=new Da}static MakeArray(d){return l(d,()=>new Ea)}Reset(){this.localPoint.SetZero();this.tangentImpulse=this.normalImpulse=0;this.id.key=0}Copy(d){this.localPoint.Copy(d.localPoint);this.normalImpulse=d.normalImpulse;this.tangentImpulse=d.tangentImpulse;this.id.Copy(d.id);return this}}(function(d){d[d.e_unknown=
-1]="e_unknown";d[d.e_circles=0]="e_circles";d[d.e_faceA=1]="e_faceA";d[d.e_faceB=2]="e_faceB"})(a.ManifoldType||(a.ManifoldType={}));class Pa{constructor(){this.points=Ea.MakeArray(2);this.localNormal=new z;this.localPoint=new z;this.type=a.ManifoldType.e_unknown;this.pointCount=0}Reset(){for(let d=0;2>d;++d)this.points[d].Reset();this.localNormal.SetZero();this.localPoint.SetZero();this.type=a.ManifoldType.e_unknown;this.pointCount=0}Copy(d){this.pointCount=d.pointCount;for(let n=0;2>n;++n)this.points[n].Copy(d.points[n]);
this.localNormal.Copy(d.localNormal);this.localPoint.Copy(d.localPoint);this.type=d.type;return this}Clone(){return(new Pa).Copy(this)}}class Ha{constructor(){this.normal=new z;this.points=z.MakeArray(2);this.separations=e(2)}Initialize(d,n,u,C,I){if(0!==d.pointCount)switch(d.type){case a.ManifoldType.e_circles:this.normal.Set(1,0);n=rb.MulXV(n,d.localPoint,Ha.Initialize_s_pointA);d=rb.MulXV(C,d.points[0].localPoint,Ha.Initialize_s_pointB);z.DistanceSquaredVV(n,d)>lb&&z.SubVV(d,n,this.normal).SelfNormalize();
u=z.AddVMulSV(n,u,this.normal,Ha.Initialize_s_cA);I=z.SubVMulSV(d,I,this.normal,Ha.Initialize_s_cB);z.MidVV(u,I,this.points[0]);this.separations[0]=z.DotVV(z.SubVV(I,u,z.s_t0),this.normal);break;case a.ManifoldType.e_faceA:ib.MulRV(n.q,d.localNormal,this.normal);n=rb.MulXV(n,d.localPoint,Ha.Initialize_s_planePoint);for(var L=0;L<d.pointCount;++L){var U=rb.MulXV(C,d.points[L].localPoint,Ha.Initialize_s_clipPoint),Z=u-z.DotVV(z.SubVV(U,n,z.s_t0),this.normal);Z=z.AddVMulSV(U,Z,this.normal,Ha.Initialize_s_cA);
U=z.SubVMulSV(U,I,this.normal,Ha.Initialize_s_cB);z.MidVV(Z,U,this.points[L]);this.separations[L]=z.DotVV(z.SubVV(U,Z,z.s_t0),this.normal)}break;case a.ManifoldType.e_faceB:ib.MulRV(C.q,d.localNormal,this.normal);C=rb.MulXV(C,d.localPoint,Ha.Initialize_s_planePoint);for(L=0;L<d.pointCount;++L)U=rb.MulXV(n,d.points[L].localPoint,Ha.Initialize_s_clipPoint),Z=I-z.DotVV(z.SubVV(U,C,z.s_t0),this.normal),Z=z.AddVMulSV(U,Z,this.normal,Ha.Initialize_s_cB),U=z.SubVMulSV(U,u,this.normal,Ha.Initialize_s_cA),
z.MidVV(U,Z,this.points[L]),this.separations[L]=z.DotVV(z.SubVV(U,Z,z.s_t0),this.normal);this.normal.SelfNeg()}}}Ha.Initialize_s_pointA=new z;Ha.Initialize_s_pointB=new z;Ha.Initialize_s_cA=new z;Ha.Initialize_s_cB=new z;Ha.Initialize_s_planePoint=new z;Ha.Initialize_s_clipPoint=new z;(function(d){d[d.b2_nullState=0]="b2_nullState";d[d.b2_addState=1]="b2_addState";d[d.b2_persistState=2]="b2_persistState";d[d.b2_removeState=3]="b2_removeState"})(a.PointState||(a.PointState={}));class Ma{constructor(){this.v=
new z;this.id=new Da}static MakeArray(d){return l(d,()=>new Ma)}Copy(d){this.v.Copy(d.v);this.id.Copy(d.id);return this}}class Ta{constructor(){this.p1=new z;this.p2=new z;this.maxFraction=1}Copy(d){this.p1.Copy(d.p1);this.p2.Copy(d.p2);this.maxFraction=d.maxFraction;return this}}class Ka{constructor(){this.normal=new z;this.fraction=0}Copy(d){this.normal.Copy(d.normal);this.fraction=d.fraction;return this}}class Wa{constructor(){this.lowerBound=new z;this.upperBound=new z;this.m_cache_center=new z;
this.m_cache_extent=new z}Copy(d){this.lowerBound.Copy(d.lowerBound);this.upperBound.Copy(d.upperBound);return this}IsValid(){return!this.lowerBound.IsValid()||!this.upperBound.IsValid()||this.upperBound.x<this.lowerBound.x||this.upperBound.y<this.lowerBound.y?!1:!0}GetCenter(){return z.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)}GetExtents(){return z.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)}GetPerimeter(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-
this.lowerBound.y))}Combine1(d){this.lowerBound.x=f(this.lowerBound.x,d.lowerBound.x);this.lowerBound.y=f(this.lowerBound.y,d.lowerBound.y);this.upperBound.x=h(this.upperBound.x,d.upperBound.x);this.upperBound.y=h(this.upperBound.y,d.upperBound.y);return this}Combine2(d,n){this.lowerBound.x=f(d.lowerBound.x,n.lowerBound.x);this.lowerBound.y=f(d.lowerBound.y,n.lowerBound.y);this.upperBound.x=h(d.upperBound.x,n.upperBound.x);this.upperBound.y=h(d.upperBound.y,n.upperBound.y);return this}static Combine(d,
n,u){u.Combine2(d,n);return u}Contains(d){let n;return n=(n=(n=(n=this.lowerBound.x<=d.lowerBound.x)&&this.lowerBound.y<=d.lowerBound.y)&&d.upperBound.x<=this.upperBound.x)&&d.upperBound.y<=this.upperBound.y}RayCast(d,n){let u=-1E37,C=1E37;var I=n.p1.x,L=n.p1.y,U=n.p2.x-n.p1.x,Z=n.p2.y-n.p1.y,ka=eb(U),ia=eb(Z);const ta=d.normal;if(1E-5>ka){if(I<this.lowerBound.x||this.upperBound.x<I)return!1}else if(ka=1/U,U=(this.lowerBound.x-I)*ka,I=(this.upperBound.x-I)*ka,ka=-1,U>I&&(ka=U,U=I,I=ka,ka=1),U>u&&
(ta.x=ka,ta.y=0,u=U),C=f(C,I),u>C)return!1;if(1E-5>ia){if(L<this.lowerBound.y||this.upperBound.y<L)return!1}else if(ia=1/Z,Z=(this.lowerBound.y-L)*ia,L=(this.upperBound.y-L)*ia,ia=-1,Z>L&&(ia=Z,Z=L,L=ia,ia=1),Z>u&&(ta.x=0,ta.y=ia,u=Z),C=f(C,L),u>C)return!1;if(0>u||n.maxFraction<u)return!1;d.fraction=u;return!0}TestContain(d){return d.x<this.lowerBound.x||this.upperBound.x<d.x||d.y<this.lowerBound.y||this.upperBound.y<d.y?!1:!0}TestOverlap(d){return this.upperBound.x<d.lowerBound.x||this.upperBound.y<
d.lowerBound.y||d.upperBound.x<this.lowerBound.x||d.upperBound.y<this.lowerBound.y?!1:!0}}const bb=new na,hb=new oa,sb=new ja;class Ab{constructor(d=0){this.m_id=0;this.aabb=new Wa;this.child2=this.child1=this.parent=this._userData=null;this.height=0;this.moved=!1;this.m_id=d}get userData(){if(null===this._userData)throw Error();return this._userData}set userData(d){if(null!==this._userData)throw Error();this._userData=d}Reset(){this._userData=null}IsLeaf(){return null===this.child1}}class La{constructor(){this.m_freeList=
this.m_root=null;this.m_insertionCount=0;this.m_stack=new fb(256)}Query(d,n){const u=this.m_stack.Reset();for(u.Push(this.m_root);0<u.GetCount();){const C=u.Pop();if(null!==C&&C.aabb.TestOverlap(d))if(C.IsLeaf()){if(!n(C))break}else u.Push(C.child1),u.Push(C.child2)}}QueryPoint(d,n){const u=this.m_stack.Reset();for(u.Push(this.m_root);0<u.GetCount();){const C=u.Pop();if(null!==C&&C.aabb.TestContain(d))if(C.IsLeaf()){if(!n(C))break}else u.Push(C.child1),u.Push(C.child2)}}RayCast(d,n){const u=d.p1,
C=d.p2;var I=z.SubVV(C,u,La.s_r);I.Normalize();I=z.CrossOneV(I,La.s_v);const L=z.AbsV(I,La.s_abs_v);let U=d.maxFraction;const Z=La.s_segmentAABB;var ka=u.x+U*(C.x-u.x),ia=u.y+U*(C.y-u.y);Z.lowerBound.x=f(u.x,ka);Z.lowerBound.y=f(u.y,ia);Z.upperBound.x=h(u.x,ka);Z.upperBound.y=h(u.y,ia);const ta=this.m_stack.Reset();for(ta.Push(this.m_root);0<ta.GetCount();){ka=ta.Pop();if(null===ka)continue;if(!B(ka.aabb,Z))continue;ia=ka.aabb.GetCenter();const Ja=ka.aabb.GetExtents();if(!(0<eb(z.DotVV(I,z.SubVV(u,
ia,z.s_t0)))-z.DotVV(L,Ja)))if(ka.IsLeaf()){ia=La.s_subInput;ia.p1.Copy(d.p1);ia.p2.Copy(d.p2);ia.maxFraction=U;ka=n(ia,ka);if(0===ka)break;0<ka&&(U=ka,ka=u.x+U*(C.x-u.x),ia=u.y+U*(C.y-u.y),Z.lowerBound.x=f(u.x,ka),Z.lowerBound.y=f(u.y,ia),Z.upperBound.x=h(u.x,ka),Z.upperBound.y=h(u.y,ia))}else ta.Push(ka.child1),ta.Push(ka.child2)}}AllocateNode(){if(null!==this.m_freeList){const d=this.m_freeList;this.m_freeList=d.parent;d.parent=null;d.child1=null;d.child2=null;d.height=0;d.moved=!1;return d}return new Ab(La.s_node_id++)}FreeNode(d){d.parent=
this.m_freeList;d.child1=null;d.child2=null;d.height=-1;d.Reset();this.m_freeList=d}CreateProxy(d,n){const u=this.AllocateNode();u.aabb.lowerBound.x=d.lowerBound.x-.1;u.aabb.lowerBound.y=d.lowerBound.y-.1;u.aabb.upperBound.x=d.upperBound.x+.1;u.aabb.upperBound.y=d.upperBound.y+.1;u.userData=n;u.height=0;u.moved=!0;this.InsertLeaf(u);return u}DestroyProxy(d){this.RemoveLeaf(d);this.FreeNode(d)}MoveProxy(d,n,u){const C=La.MoveProxy_s_fatAABB;C.lowerBound.x=n.lowerBound.x-.1;C.lowerBound.y=n.lowerBound.y-
.1;C.upperBound.x=n.upperBound.x+.1;C.upperBound.y=n.upperBound.y+.1;var I=4*u.x;u=4*u.y;0>I?C.lowerBound.x+=I:C.upperBound.x+=I;0>u?C.lowerBound.y+=u:C.upperBound.y+=u;I=d.aabb;if(I.Contains(n)&&(n=La.MoveProxy_s_hugeAABB,n.lowerBound.x=C.lowerBound.x-.4,n.lowerBound.y=C.lowerBound.y-.4,n.upperBound.x=C.upperBound.x+.4,n.upperBound.y=C.upperBound.y+.4,n.Contains(I)))return!1;this.RemoveLeaf(d);d.aabb.Copy(C);this.InsertLeaf(d);return d.moved=!0}InsertLeaf(d){++this.m_insertionCount;if(null===this.m_root)this.m_root=
d,this.m_root.parent=null;else{for(var n=d.aabb,u=this.m_root;!u.IsLeaf();){var C=G(u.child1),I=G(u.child2),L=u.aabb.GetPerimeter(),U=La.s_combinedAABB;U.Combine2(u.aabb,n);var Z=U.GetPerimeter();U=2*Z;Z=2*(Z-L);const ka=La.s_aabb;let ia,ta;C.IsLeaf()?(ka.Combine2(n,C.aabb),L=ka.GetPerimeter()+Z):(ka.Combine2(n,C.aabb),ia=C.aabb.GetPerimeter(),ta=ka.GetPerimeter(),L=ta-ia+Z);I.IsLeaf()?(ka.Combine2(n,I.aabb),Z=ka.GetPerimeter()+Z):(ka.Combine2(n,I.aabb),ia=I.aabb.GetPerimeter(),ta=ka.GetPerimeter(),
Z=ta-ia+Z);if(U<L&&U<Z)break;u=L<Z?C:I}C=u.parent;I=this.AllocateNode();I.parent=C;I.aabb.Combine2(n,u.aabb);I.height=u.height+1;null!==C?(C.child1===u?C.child1=I:C.child2=I,I.child1=u,I.child2=d,u.parent=I,d.parent=I):(I.child1=u,I.child2=d,u.parent=I,this.m_root=d.parent=I);for(d=d.parent;null!==d;)d=this.Balance(d),n=G(d.child1),u=G(d.child2),d.height=1+h(n.height,u.height),d.aabb.Combine2(n.aabb,u.aabb),d=d.parent}}RemoveLeaf(d){if(d===this.m_root)this.m_root=null;else{var n=G(d.parent),u=n&&
n.parent;d=G(n.child1===d?n.child2:n.child1);if(null!==u)for(u.child1===n?u.child1=d:u.child2=d,d.parent=u,this.FreeNode(n),n=u;null!==n;)n=this.Balance(n),u=G(n.child1),d=G(n.child2),n.aabb.Combine2(u.aabb,d.aabb),n.height=1+h(u.height,d.height),n=n.parent;else this.m_root=d,d.parent=null,this.FreeNode(n)}}Balance(d){if(d.IsLeaf()||2>d.height)return d;const n=G(d.child1),u=G(d.child2);var C=u.height-n.height;if(1<C){C=G(u.child1);var I=G(u.child2);u.child1=d;u.parent=d.parent;d.parent=u;null!==u.parent?
u.parent.child1===d?u.parent.child1=u:u.parent.child2=u:this.m_root=u;C.height>I.height?(u.child2=C,d.child2=I,I.parent=d,d.aabb.Combine2(n.aabb,I.aabb),u.aabb.Combine2(d.aabb,C.aabb),d.height=1+h(n.height,I.height),u.height=1+h(d.height,C.height)):(u.child2=I,d.child2=C,C.parent=d,d.aabb.Combine2(n.aabb,C.aabb),u.aabb.Combine2(d.aabb,I.aabb),d.height=1+h(n.height,C.height),u.height=1+h(d.height,I.height));return u}return-1>C?(C=G(n.child1),I=G(n.child2),n.child1=d,n.parent=d.parent,d.parent=n,null!==
n.parent?n.parent.child1===d?n.parent.child1=n:n.parent.child2=n:this.m_root=n,C.height>I.height?(n.child2=C,d.child1=I,I.parent=d,d.aabb.Combine2(u.aabb,I.aabb),n.aabb.Combine2(d.aabb,C.aabb),d.height=1+h(u.height,I.height),n.height=1+h(d.height,C.height)):(n.child2=I,d.child1=C,C.parent=d,d.aabb.Combine2(u.aabb,C.aabb),n.aabb.Combine2(d.aabb,I.aabb),d.height=1+h(u.height,C.height),n.height=1+h(d.height,I.height)),n):d}GetHeight(){return null===this.m_root?0:this.m_root.height}static GetAreaNode(d){if(null===
d||d.IsLeaf())return 0;let n=d.aabb.GetPerimeter();n+=La.GetAreaNode(d.child1);return n+=La.GetAreaNode(d.child2)}GetAreaRatio(){if(null===this.m_root)return 0;const d=this.m_root.aabb.GetPerimeter();return La.GetAreaNode(this.m_root)/d}static ComputeHeightNode(d){if(null===d||d.IsLeaf())return 0;const n=La.ComputeHeightNode(d.child1);d=La.ComputeHeightNode(d.child2);return 1+h(n,d)}ComputeHeight(){return La.ComputeHeightNode(this.m_root)}ValidateStructure(d){if(null!==d&&!d.IsLeaf()){var n=G(d.child1);
d=G(d.child2);this.ValidateStructure(n);this.ValidateStructure(d)}}ValidateMetrics(d){if(null!==d&&!d.IsLeaf()){var n=G(d.child1);d=G(d.child2);La.s_aabb.Combine2(n.aabb,d.aabb);this.ValidateMetrics(n);this.ValidateMetrics(d)}}Validate(){}static GetMaxBalanceNode(d,n){if(null===d||1>=d.height)return n;var u=G(d.child1);d=G(d.child2);u=eb(d.height-u.height);return h(n,u)}GetMaxBalance(){return La.GetMaxBalanceNode(this.m_root,0)}RebuildBottomUp(){this.Validate()}static ShiftOriginNode(d,n){if(null!==
d&&!(1>=d.height)){var u=d.child2;La.ShiftOriginNode(d.child1,n);La.ShiftOriginNode(u,n);d.aabb.lowerBound.SelfSub(n);d.aabb.upperBound.SelfSub(n)}}ShiftOrigin(d){La.ShiftOriginNode(this.m_root,d)}}La.s_r=new z;La.s_v=new z;La.s_abs_v=new z;La.s_segmentAABB=new Wa;La.s_subInput=new Ta;La.s_combinedAABB=new Wa;La.s_aabb=new Wa;La.s_node_id=0;La.MoveProxy_s_fatAABB=new Wa;La.MoveProxy_s_hugeAABB=new Wa;class Ra{constructor(d,n){this.proxyA=d;this.proxyB=n}}class Za{constructor(){this.m_tree=new La;
this.m_moveCount=this.m_proxyCount=0;this.m_moveBuffer=[];this.m_pairCount=0;this.m_pairBuffer=[]}CreateProxy(d,n){d=this.m_tree.CreateProxy(d,n);++this.m_proxyCount;this.BufferMove(d);return d}DestroyProxy(d){this.UnBufferMove(d);--this.m_proxyCount;this.m_tree.DestroyProxy(d)}MoveProxy(d,n,u){this.m_tree.MoveProxy(d,n,u)&&this.BufferMove(d)}TouchProxy(d){this.BufferMove(d)}GetProxyCount(){return this.m_proxyCount}UpdatePairs(d){this.m_pairCount=0;for(var n=0;n<this.m_moveCount;++n){const u=this.m_moveBuffer[n];
null!==u&&this.m_tree.Query(u.aabb,C=>{if(C.m_id===u.m_id||C.moved&&C.m_id>u.m_id)return!0;let I;C.m_id<u.m_id?(I=C,C=u):I=u;if(this.m_pairCount===this.m_pairBuffer.length)this.m_pairBuffer[this.m_pairCount]=new Ra(I,C);else{const L=this.m_pairBuffer[this.m_pairCount];L.proxyA=I;L.proxyB=C}++this.m_pairCount;return!0})}for(n=0;n<this.m_pairCount;++n){const u=this.m_pairBuffer[n];d(u.proxyA.userData,u.proxyB.userData)}for(d=0;d<this.m_moveCount;++d)n=this.m_moveBuffer[d],null!==n&&(n.moved=!1);this.m_moveCount=
0}Query(d,n){this.m_tree.Query(d,n)}QueryPoint(d,n){this.m_tree.QueryPoint(d,n)}RayCast(d,n){this.m_tree.RayCast(d,n)}GetTreeHeight(){return this.m_tree.GetHeight()}GetTreeBalance(){return this.m_tree.GetMaxBalance()}GetTreeQuality(){return this.m_tree.GetAreaRatio()}ShiftOrigin(d){this.m_tree.ShiftOrigin(d)}BufferMove(d){this.m_moveBuffer[this.m_moveCount]=d;++this.m_moveCount}UnBufferMove(d){d=this.m_moveBuffer.indexOf(d);this.m_moveBuffer[d]=null}}class cb{constructor(){this.mass=0;this.center=
new z(0,0);this.I=0}}(function(d){d[d.e_unknown=-1]="e_unknown";d[d.e_circleShape=0]="e_circleShape";d[d.e_edgeShape=1]="e_edgeShape";d[d.e_polygonShape=2]="e_polygonShape";d[d.e_chainShape=3]="e_chainShape";d[d.e_shapeTypeCount=4]="e_shapeTypeCount"})(a.ShapeType||(a.ShapeType={}));class gb{constructor(d,n){this.m_type=d;this.m_radius=n}Copy(d){this.m_radius=d.m_radius;return this}GetType(){return this.m_type}}class kb extends gb{constructor(){super(a.ShapeType.e_edgeShape,.01);this.m_vertex1=new z;
this.m_vertex2=new z;this.m_vertex0=new z;this.m_vertex3=new z;this.m_oneSided=!1}SetOneSided(d,n,u,C){this.m_vertex0.Copy(d);this.m_vertex1.Copy(n);this.m_vertex2.Copy(u);this.m_vertex3.Copy(C);this.m_oneSided=!0;return this}SetTwoSided(d,n){this.m_vertex1.Copy(d);this.m_vertex2.Copy(n);this.m_oneSided=!1;return this}Clone(){return(new kb).Copy(this)}Copy(d){super.Copy(d);this.m_vertex1.Copy(d.m_vertex1);this.m_vertex2.Copy(d.m_vertex2);this.m_vertex0.Copy(d.m_vertex0);this.m_vertex3.Copy(d.m_vertex3);
this.m_oneSided=d.m_oneSided;return this}GetChildCount(){return 1}TestPoint(){return!1}ComputeDistance(d,n,u){var C=rb.MulXV(d,this.m_vertex1,kb.ComputeDistance_s_v1);d=rb.MulXV(d,this.m_vertex2,kb.ComputeDistance_s_v2);const I=z.SubVV(n,C,kb.ComputeDistance_s_d);C=z.SubVV(d,C,kb.ComputeDistance_s_s);const L=z.DotVV(I,C);if(0<L){const U=z.DotVV(C,C);L>U?z.SubVV(n,d,I):I.SelfMulSub(L/U,C)}u.Copy(I);return u.Normalize()}RayCast(d,n,u){var C=rb.MulTXV(u,n.p1,kb.RayCast_s_p1),I=rb.MulTXV(u,n.p2,kb.RayCast_s_p2);
const L=z.SubVV(I,C,kb.RayCast_s_d);I=this.m_vertex1;var U=this.m_vertex2,Z=z.SubVV(U,I,kb.RayCast_s_e),ka=d.normal.Set(Z.y,-Z.x).SelfNormalize();Z=z.DotVV(ka,z.SubVV(I,C,z.s_t0));if(this.m_oneSided&&0<Z)return!1;ka=z.DotVV(ka,L);if(0===ka)return!1;ka=Z/ka;if(0>ka||n.maxFraction<ka)return!1;n=z.AddVMulSV(C,ka,L,kb.RayCast_s_q);C=z.SubVV(U,I,kb.RayCast_s_r);U=z.DotVV(C,C);if(0===U)return!1;I=z.DotVV(z.SubVV(n,I,z.s_t0),C)/U;if(0>I||1<I)return!1;d.fraction=ka;ib.MulRV(u.q,d.normal,d.normal);0<Z&&d.normal.SelfNeg();
return!0}ComputeAABB(d,n){var u=rb.MulXV(n,this.m_vertex1,kb.ComputeAABB_s_v1);n=rb.MulXV(n,this.m_vertex2,kb.ComputeAABB_s_v2);z.MinV(u,n,d.lowerBound);z.MaxV(u,n,d.upperBound);u=this.m_radius;d.lowerBound.SelfSubXY(u,u);d.upperBound.SelfAddXY(u,u)}ComputeMass(d){d.mass=0;z.MidVV(this.m_vertex1,this.m_vertex2,d.center);d.I=0}SetupDistanceProxy(d){d.m_vertices=d.m_buffer;d.m_vertices[0].Copy(this.m_vertex1);d.m_vertices[1].Copy(this.m_vertex2);d.m_count=2;d.m_radius=this.m_radius}ComputeSubmergedArea(d,
n,u,C){C.SetZero();return 0}Dump(d){d("    const shape: b2EdgeShape = new b2EdgeShape();\n");d("    shape.m_radius = %.15f;\n",this.m_radius);d("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y);d("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y);d("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y);d("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y);d("    shape.m_oneSided = %s;\n",this.m_oneSided)}}
kb.ComputeDistance_s_v1=new z;kb.ComputeDistance_s_v2=new z;kb.ComputeDistance_s_d=new z;kb.ComputeDistance_s_s=new z;kb.RayCast_s_p1=new z;kb.RayCast_s_p2=new z;kb.RayCast_s_d=new z;kb.RayCast_s_e=new z;kb.RayCast_s_q=new z;kb.RayCast_s_r=new z;kb.ComputeAABB_s_v1=new z;kb.ComputeAABB_s_v2=new z;class jb extends gb{constructor(){super(a.ShapeType.e_chainShape,.01);this.m_vertices=[];this.m_count=0;this.m_prevVertex=new z;this.m_nextVertex=new z}CreateLoop(...d){if("number"===typeof d[0][0]){const u=
d[0];if(0!==u.length%2)throw Error();return this._CreateLoop(C=>({x:u[2*C],y:u[2*C+1]}),u.length/2)}const n=d[0];return this._CreateLoop(u=>n[u],d[1]||n.length)}_CreateLoop(d,n){if(3>n)return this;this.m_count=n+1;this.m_vertices=z.MakeArray(this.m_count);for(let u=0;u<n;++u)this.m_vertices[u].Copy(d(u));this.m_vertices[n].Copy(this.m_vertices[0]);this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]);this.m_nextVertex.Copy(this.m_vertices[1]);return this}CreateChain(...d){if("number"===typeof d[0][0]){const u=
d[0],C=d[1];d=d[2];if(0!==u.length%2)throw Error();return this._CreateChain(I=>({x:u[2*I],y:u[2*I+1]}),u.length/2,C,d)}const n=d[0];return this._CreateChain(u=>n[u],d[1]||n.length,d[2],d[3])}_CreateChain(d,n,u,C){this.m_count=n;this.m_vertices=z.MakeArray(n);for(let I=0;I<n;++I)this.m_vertices[I].Copy(d(I));this.m_prevVertex.Copy(u);this.m_nextVertex.Copy(C);return this}Clone(){return(new jb).Copy(this)}Copy(d){super.Copy(d);this._CreateChain(n=>d.m_vertices[n],d.m_count,d.m_prevVertex,d.m_nextVertex);
this.m_prevVertex.Copy(d.m_prevVertex);this.m_nextVertex.Copy(d.m_nextVertex);return this}GetChildCount(){return this.m_count-1}GetChildEdge(d,n){d.m_radius=this.m_radius;d.m_vertex1.Copy(this.m_vertices[n]);d.m_vertex2.Copy(this.m_vertices[n+1]);d.m_oneSided=!0;0<n?d.m_vertex0.Copy(this.m_vertices[n-1]):d.m_vertex0.Copy(this.m_prevVertex);n<this.m_count-2?d.m_vertex3.Copy(this.m_vertices[n+2]):d.m_vertex3.Copy(this.m_nextVertex)}TestPoint(){return!1}ComputeDistance(d,n,u,C){const I=jb.ComputeDistance_s_edgeShape;
this.GetChildEdge(I,C);return I.ComputeDistance(d,n,u,0)}RayCast(d,n,u,C){const I=jb.RayCast_s_edgeShape;I.m_vertex1.Copy(this.m_vertices[C]);I.m_vertex2.Copy(this.m_vertices[(C+1)%this.m_count]);return I.RayCast(d,n,u,0)}ComputeAABB(d,n,u){var C=this.m_vertices[(u+1)%this.m_count];u=rb.MulXV(n,this.m_vertices[u],jb.ComputeAABB_s_v1);C=rb.MulXV(n,C,jb.ComputeAABB_s_v2);n=z.MinV(u,C,jb.ComputeAABB_s_lower);u=z.MaxV(u,C,jb.ComputeAABB_s_upper);d.lowerBound.x=n.x-this.m_radius;d.lowerBound.y=n.y-this.m_radius;
d.upperBound.x=u.x+this.m_radius;d.upperBound.y=u.y+this.m_radius}ComputeMass(d){d.mass=0;d.center.SetZero();d.I=0}SetupDistanceProxy(d,n){d.m_vertices=d.m_buffer;d.m_vertices[0].Copy(this.m_vertices[n]);n+1<this.m_count?d.m_vertices[1].Copy(this.m_vertices[n+1]):d.m_vertices[1].Copy(this.m_vertices[0]);d.m_count=2;d.m_radius=this.m_radius}ComputeSubmergedArea(d,n,u,C){C.SetZero();return 0}Dump(d){d("    const shape: b2ChainShape = new b2ChainShape();\n");d("    const vs: b2Vec2[] = [];\n");for(let n=
0;n<this.m_count;++n)d("    vs[%d] = new bVec2(%.15f, %.15f);\n",n,this.m_vertices[n].x,this.m_vertices[n].y);d("    shape.CreateChain(vs, %d);\n",this.m_count);d("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y);d("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y)}}jb.ComputeDistance_s_edgeShape=new kb;jb.RayCast_s_edgeShape=new kb;jb.ComputeAABB_s_v1=new z;jb.ComputeAABB_s_v2=new z;jb.ComputeAABB_s_lower=new z;jb.ComputeAABB_s_upper=
new z;class Db extends gb{constructor(d=0){super(a.ShapeType.e_circleShape,d);this.m_p=new z}Set(d,n=this.m_radius){this.m_p.Copy(d);this.m_radius=n;return this}Clone(){return(new Db).Copy(this)}Copy(d){super.Copy(d);this.m_p.Copy(d.m_p);return this}GetChildCount(){return 1}TestPoint(d,n){d=rb.MulXV(d,this.m_p,Db.TestPoint_s_center);n=z.SubVV(n,d,Db.TestPoint_s_d);return z.DotVV(n,n)<=m(this.m_radius)}ComputeDistance(d,n,u){d=rb.MulXV(d,this.m_p,Db.ComputeDistance_s_center);z.SubVV(n,d,u);return u.Normalize()-
this.m_radius}RayCast(d,n,u){u=rb.MulXV(u,this.m_p,Db.RayCast_s_position);u=z.SubVV(n.p1,u,Db.RayCast_s_s);var C=z.DotVV(u,u)-m(this.m_radius);const I=z.SubVV(n.p2,n.p1,Db.RayCast_s_r);var L=z.DotVV(u,I);const U=z.DotVV(I,I);C=L*L-U*C;if(0>C||1E-5>U)return!1;L=-(L+ub(C));return 0<=L&&L<=n.maxFraction*U?(L/=U,d.fraction=L,z.AddVMulSV(u,L,I,d.normal).SelfNormalize(),!0):!1}ComputeAABB(d,n){n=rb.MulXV(n,this.m_p,Db.ComputeAABB_s_p);d.lowerBound.Set(n.x-this.m_radius,n.y-this.m_radius);d.upperBound.Set(n.x+
this.m_radius,n.y+this.m_radius)}ComputeMass(d,n){const u=m(this.m_radius);d.mass=3.14159265359*n*u;d.center.Copy(this.m_p);d.I=d.mass*(.5*u+z.DotVV(this.m_p,this.m_p))}SetupDistanceProxy(d){d.m_vertices=d.m_buffer;d.m_vertices[0].Copy(this.m_p);d.m_count=1;d.m_radius=this.m_radius}ComputeSubmergedArea(d,n,u,C){u=rb.MulXV(u,this.m_p,new z);var I=-(z.DotVV(d,u)-n);if(I<-this.m_radius+1E-5)return 0;if(I>this.m_radius)return C.Copy(u),3.14159265359*this.m_radius*this.m_radius;n=this.m_radius*this.m_radius;
const L=I*I;I=n*(Pb(I/this.m_radius)+1.570796326795)+I*ub(n-L);n=-2/3*Bb(n-L,1.5)/I;C.x=u.x+d.x*n;C.y=u.y+d.y*n;return I}Dump(d){d("    const shape: b2CircleShape = new b2CircleShape();\n");d("    shape.m_radius = %.15f;\n",this.m_radius);d("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)}}Db.TestPoint_s_center=new z;Db.TestPoint_s_d=new z;Db.ComputeDistance_s_center=new z;Db.RayCast_s_position=new z;Db.RayCast_s_s=new z;Db.RayCast_s_r=new z;Db.ComputeAABB_s_p=new z;const Ob=new z,Mb=new z,
ec=new z,kc=new z,Oc=new z,tc=new z,xc=new z,oc=new z,Ac=new z,Pc=new z,Wc=new z,$d=new z,Ad=new Da;var Xc;(function(d){d[d.e_unknown=0]="e_unknown";d[d.e_edgeA=1]="e_edgeA";d[d.e_edgeB=2]="e_edgeB"})(Xc||={});class hd{constructor(){this.normal=new z;this.type=Xc.e_unknown;this.separation=this.index=0}}class Zc{constructor(){this.vertices=[];this.normals=[];this.count=0}}class id{constructor(){this.i2=this.i1=0;this.v1=new z;this.v2=new z;this.normal=new z;this.sideNormal1=new z;this.sideOffset1=
0;this.sideNormal2=new z;this.sideOffset2=0}}const Nc=new hd,td=[new z,new z],pd=new hd,Vd=new z,Zd=new rb,Ze=new z,md=new z,tf=new z,Zk=new z,$k=new z,al=new z,bl=new z,Yk=new Zc,dl=new id,cl=[new Ma,new Ma],el=[new Ma,new Ma],fl=[new Ma,new Ma],gl=new rb,hl=new z,il=new z,ml=new z,ll=[new Ma,new Ma],ul=[new Ma,new Ma],vl=[new Ma,new Ma],jl=[0],kl=[0],nl=new z,ol=new z,pl=new z,rl=new z,ql=new z,wl=new z,sl=new z,tl=new z;class ac extends gb{constructor(){super(a.ShapeType.e_polygonShape,.01);this.m_centroid=
new z(0,0);this.m_vertices=[];this.m_normals=[];this.m_count=0}Clone(){return(new ac).Copy(this)}Copy(d){super.Copy(d);this.m_centroid.Copy(d.m_centroid);this.m_count=d.m_count;this.m_vertices=z.MakeArray(this.m_count);this.m_normals=z.MakeArray(this.m_count);for(let n=0;n<this.m_count;++n)this.m_vertices[n].Copy(d.m_vertices[n]),this.m_normals[n].Copy(d.m_normals[n]);return this}GetChildCount(){return 1}Set(...d){if("number"===typeof d[0][0]){const u=d[0];if(0!==u.length%2)throw Error();return this._Set(C=>
({x:u[2*C],y:u[2*C+1]}),u.length/2)}const n=d[0];return this._Set(u=>n[u],d[1]||n.length)}_Set(d,n){if(3>n)return this.SetAsBox(1,1);var u=n;n=[];for(var C=0;C<u;++C){var I=d(C),L=!0;for(var U=0;U<n.length;++U)if(6.25E-6>z.DistanceSquaredVV(I,n[U])){L=!1;break}L&&n.push(I)}u=n.length;if(3>u)return this.SetAsBox(1,1);d=0;C=n[0].x;for(I=1;I<u;++I)if(L=n[I].x,L>C||L===C&&n[I].y<n[d].y)d=I,C=L;I=[];C=0;for(L=d;;){I[C]=L;U=0;for(let Z=1;Z<u;++Z){if(U===L){U=Z;continue}const ka=z.SubVV(n[U],n[I[C]],ac.Set_s_r),
ia=z.SubVV(n[Z],n[I[C]],ac.Set_s_v),ta=z.CrossVV(ka,ia);0>ta&&(U=Z);0===ta&&ia.LengthSquared()>ka.LengthSquared()&&(U=Z)}++C;L=U;if(U===d)break}this.m_count=C;this.m_vertices=z.MakeArray(this.m_count);this.m_normals=z.MakeArray(this.m_count);for(u=0;u<C;++u)this.m_vertices[u].Copy(n[I[u]]);for(n=0;n<C;++n)u=z.SubVV(this.m_vertices[(n+1)%C],this.m_vertices[n],z.s_t0),z.CrossVOne(u,this.m_normals[n]).SelfNormalize();ac.ComputeCentroid(this.m_vertices,C,this.m_centroid);return this}SetAsBox(d,n,u,C=
0){this.m_count=4;this.m_vertices=z.MakeArray(this.m_count);this.m_normals=z.MakeArray(this.m_count);this.m_vertices[0].Set(-d,-n);this.m_vertices[1].Set(d,-n);this.m_vertices[2].Set(d,n);this.m_vertices[3].Set(-d,n);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero();if(u)for(this.m_centroid.Copy(u),d=new rb,d.SetPosition(u),d.SetRotationAngle(C),u=0;u<this.m_count;++u)rb.MulXV(d,this.m_vertices[u],this.m_vertices[u]),
ib.MulRV(d.q,this.m_normals[u],this.m_normals[u]);return this}TestPoint(d,n){d=rb.MulTXV(d,n,ac.TestPoint_s_pLocal);for(n=0;n<this.m_count;++n)if(0<z.DotVV(this.m_normals[n],z.SubVV(d,this.m_vertices[n],z.s_t0)))return!1;return!0}ComputeDistance(d,n,u){n=rb.MulTXV(d,n,ac.ComputeDistance_s_pLocal);var C=-1E37,I=ac.ComputeDistance_s_normalForMaxDistance.Copy(n);for(var L=0;L<this.m_count;++L){var U=z.DotVV(this.m_normals[L],z.SubVV(n,this.m_vertices[L],z.s_t0));U>C&&(C=U,I.Copy(this.m_normals[L]))}if(0<
C){I=ac.ComputeDistance_s_minDistance.Copy(I);C*=C;for(L=0;L<this.m_count;++L){U=z.SubVV(n,this.m_vertices[L],ac.ComputeDistance_s_distance);const Z=U.LengthSquared();C>Z&&(I.Copy(U),C=Z)}ib.MulRV(d.q,I,u);u.Normalize();return Math.sqrt(C)}ib.MulRV(d.q,I,u);return C}RayCast(d,n,u){const C=rb.MulTXV(u,n.p1,ac.RayCast_s_p1);var I=rb.MulTXV(u,n.p2,ac.RayCast_s_p2);I=z.SubVV(I,C,ac.RayCast_s_d);let L=0;n=n.maxFraction;let U=-1;for(let Z=0;Z<this.m_count;++Z){const ka=z.DotVV(this.m_normals[Z],z.SubVV(this.m_vertices[Z],
C,z.s_t0)),ia=z.DotVV(this.m_normals[Z],I);if(0===ia){if(0>ka)return!1}else 0>ia&&ka<L*ia?(L=ka/ia,U=Z):0<ia&&ka<n*ia&&(n=ka/ia);if(n<L)return!1}return 0<=U?(d.fraction=L,ib.MulRV(u.q,this.m_normals[U],d.normal),!0):!1}ComputeAABB(d,n){const u=rb.MulXV(n,this.m_vertices[0],d.lowerBound);d=d.upperBound.Copy(u);for(let C=0;C<this.m_count;++C){const I=rb.MulXV(n,this.m_vertices[C],ac.ComputeAABB_s_v);z.MinV(I,u,u);z.MaxV(I,d,d)}n=this.m_radius;u.SelfSubXY(n,n);d.SelfAddXY(n,n)}ComputeMass(d,n){const u=
ac.ComputeMass_s_center.SetZero();let C=0,I=0;const L=ac.ComputeMass_s_s.Copy(this.m_vertices[0]),U=1/3;for(let ta=0;ta<this.m_count;++ta){var Z=z.SubVV(this.m_vertices[ta],L,ac.ComputeMass_s_e1),ka=z.SubVV(this.m_vertices[(ta+1)%this.m_count],L,ac.ComputeMass_s_e2);const Ja=z.CrossVV(Z,ka);var ia=.5*Ja;C+=ia;u.SelfAdd(z.MulSV(ia*U,z.AddVV(Z,ka,z.s_t0),z.s_t1));ia=Z.x;Z=Z.y;const Oa=ka.x;ka=ka.y;I+=.25*U*Ja*(ia*ia+Oa*ia+Oa*Oa+(Z*Z+ka*Z+ka*ka))}d.mass=n*C;u.SelfMul(1/C);z.AddVV(u,L,d.center);d.I=n*
I;d.I+=d.mass*(z.DotVV(d.center,d.center)-z.DotVV(u,u))}Validate(){for(let d=0;d<this.m_count;++d){const n=d,u=(d+1)%this.m_count,C=this.m_vertices[n],I=z.SubVV(this.m_vertices[u],C,ac.Validate_s_e);for(let L=0;L<this.m_count;++L){if(L===n||L===u)continue;const U=z.SubVV(this.m_vertices[L],C,ac.Validate_s_v);if(0>z.CrossVV(I,U))return!1}}return!0}SetupDistanceProxy(d){d.m_vertices=this.m_vertices;d.m_count=this.m_count;d.m_radius=this.m_radius}ComputeSubmergedArea(d,n,u,C){var I=ib.MulTRV(u.q,d,ac.ComputeSubmergedArea_s_normalL),
L=n-z.DotVV(d,u.p),U=[],Z=0;d=n=-1;var ka=!1;for(var ia=0;ia<this.m_count;++ia){U[ia]=z.DotVV(I,this.m_vertices[ia])-L;var ta=-1E-5>U[ia];0<ia&&(ta?ka||(n=ia-1,Z++):ka&&(d=ia-1,Z++));ka=ta}switch(Z){case 0:return ka?(I=ac.ComputeSubmergedArea_s_md,this.ComputeMass(I,1),rb.MulXV(u,I.center,C),I.mass):0;case 1:-1===n?n=this.m_count-1:d=this.m_count-1}L=(n+1)%this.m_count;I=(d+1)%this.m_count;Z=(0-U[n])/(U[L]-U[n]);U=(0-U[d])/(U[I]-U[d]);n=ac.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[n].x*(1-
Z)+this.m_vertices[L].x*Z,this.m_vertices[n].y*(1-Z)+this.m_vertices[L].y*Z);d=ac.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[d].x*(1-U)+this.m_vertices[I].x*U,this.m_vertices[d].y*(1-U)+this.m_vertices[I].y*U);U=0;Z=ac.ComputeSubmergedArea_s_center.SetZero();ka=this.m_vertices[L];for(ia=L;ia!==I;)ia=(ia+1)%this.m_count,L=ia===I?d:this.m_vertices[ia],ta=.5*((ka.x-n.x)*(L.y-n.y)-(ka.y-n.y)*(L.x-n.x)),U+=ta,Z.x+=ta*(n.x+ka.x+L.x)/3,Z.y+=ta*(n.y+ka.y+L.y)/3,ka=L;Z.SelfMul(1/U);rb.MulXV(u,Z,C);
return U}Dump(d){d("    const shape: b2PolygonShape = new b2PolygonShape();\n");d("    const vs: b2Vec2[] = [];\n");for(let n=0;n<this.m_count;++n)d("    vs[%d] = new b2Vec2(%.15f, %.15f);\n",n,this.m_vertices[n].x,this.m_vertices[n].y);d("    shape.Set(vs, %d);\n",this.m_count)}static ComputeCentroid(d,n,u){u.SetZero();let C=0;const I=ac.ComputeCentroid_s_s.Copy(d[0]),L=1/3;for(let Z=0;Z<n;++Z){const ka=z.SubVV(d[0],I,ac.ComputeCentroid_s_p1),ia=z.SubVV(d[Z],I,ac.ComputeCentroid_s_p2),ta=z.SubVV(d[(Z+
1)%n],I,ac.ComputeCentroid_s_p3);var U=z.SubVV(ia,ka,ac.ComputeCentroid_s_e1);const Ja=z.SubVV(ta,ka,ac.ComputeCentroid_s_e2);U=.5*z.CrossVV(U,Ja);C+=U;u.x+=U*L*(ka.x+ia.x+ta.x);u.y+=U*L*(ka.y+ia.y+ta.y)}u.x=1/C*u.x+I.x;u.y=1/C*u.y+I.y;return u}}ac.Set_s_r=new z;ac.Set_s_v=new z;ac.TestPoint_s_pLocal=new z;ac.ComputeDistance_s_pLocal=new z;ac.ComputeDistance_s_normalForMaxDistance=new z;ac.ComputeDistance_s_minDistance=new z;ac.ComputeDistance_s_distance=new z;ac.RayCast_s_p1=new z;ac.RayCast_s_p2=
new z;ac.RayCast_s_d=new z;ac.ComputeAABB_s_v=new z;ac.ComputeMass_s_center=new z;ac.ComputeMass_s_s=new z;ac.ComputeMass_s_e1=new z;ac.ComputeMass_s_e2=new z;ac.Validate_s_e=new z;ac.Validate_s_v=new z;ac.ComputeSubmergedArea_s_normalL=new z;ac.ComputeSubmergedArea_s_md=new cb;ac.ComputeSubmergedArea_s_intoVec=new z;ac.ComputeSubmergedArea_s_outoVec=new z;ac.ComputeSubmergedArea_s_center=new z;ac.ComputeCentroid_s_s=new z;ac.ComputeCentroid_s_p1=new z;ac.ComputeCentroid_s_p2=new z;ac.ComputeCentroid_s_p3=
new z;ac.ComputeCentroid_s_e1=new z;ac.ComputeCentroid_s_e2=new z;a.toiTime=0;a.toiMaxTime=0;a.toiCalls=0;a.toiIters=0;a.toiMaxIters=0;a.toiRootIters=0;a.toiMaxRootIters=0;const Vf=new rb,Wf=new rb,ae=new z,be=new z,$e=new z,hi=new z,ii=new z;class Tg{constructor(){this.proxyA=new fa;this.proxyB=new fa;this.sweepA=new ab;this.sweepB=new ab;this.tMax=0}}(function(d){d[d.e_unknown=0]="e_unknown";d[d.e_failed=1]="e_failed";d[d.e_overlapped=2]="e_overlapped";d[d.e_touching=3]="e_touching";d[d.e_separated=
4]="e_separated"})(a.TOIOutputState||(a.TOIOutputState={}));class Ug{constructor(){this.state=a.TOIOutputState.e_unknown;this.t=0}}(function(d){d[d.e_unknown=-1]="e_unknown";d[d.e_points=0]="e_points";d[d.e_faceA=1]="e_faceA";d[d.e_faceB=2]="e_faceB"})(a.SeparationFunctionType||(a.SeparationFunctionType={}));class ji{constructor(){this.m_sweepA=new ab;this.m_sweepB=new ab;this.m_type=a.SeparationFunctionType.e_unknown;this.m_localPoint=new z;this.m_axis=new z}Initialize(d,n,u,C,I,L){this.m_proxyA=
n;this.m_proxyB=C;n=d.count;this.m_sweepA.Copy(u);this.m_sweepB.Copy(I);I=Vf;u=Wf;this.m_sweepA.GetTransform(I,L);this.m_sweepB.GetTransform(u,L);if(1===n)return this.m_type=a.SeparationFunctionType.e_points,L=this.m_proxyA.GetVertex(d.indexA[0]),d=this.m_proxyB.GetVertex(d.indexB[0]),I=rb.MulXV(I,L,ae),d=rb.MulXV(u,d,be),z.SubVV(d,I,this.m_axis),d=this.m_axis.Normalize(),this.m_localPoint.SetZero(),d;if(d.indexA[0]===d.indexA[1])return this.m_type=a.SeparationFunctionType.e_faceB,n=this.m_proxyB.GetVertex(d.indexB[0]),
C=this.m_proxyB.GetVertex(d.indexB[1]),z.CrossVOne(z.SubVV(C,n,z.s_t0),this.m_axis).SelfNormalize(),L=ib.MulRV(u.q,this.m_axis,$e),z.MidVV(n,C,this.m_localPoint),u=rb.MulXV(u,this.m_localPoint,be),d=this.m_proxyA.GetVertex(d.indexA[0]),d=rb.MulXV(I,d,ae),d=z.DotVV(z.SubVV(d,u,z.s_t0),L),0>d&&(this.m_axis.SelfNeg(),d=-d),d;this.m_type=a.SeparationFunctionType.e_faceA;n=this.m_proxyA.GetVertex(d.indexA[0]);C=this.m_proxyA.GetVertex(d.indexA[1]);z.CrossVOne(z.SubVV(C,n,z.s_t0),this.m_axis).SelfNormalize();
L=ib.MulRV(I.q,this.m_axis,$e);z.MidVV(n,C,this.m_localPoint);I=rb.MulXV(I,this.m_localPoint,ae);d=this.m_proxyB.GetVertex(d.indexB[0]);d=rb.MulXV(u,d,be);d=z.DotVV(z.SubVV(d,I,z.s_t0),L);0>d&&(this.m_axis.SelfNeg(),d=-d);return d}FindMinSeparation(d,n,u){var C=Vf,I=Wf;this.m_sweepA.GetTransform(C,u);this.m_sweepB.GetTransform(I,u);switch(this.m_type){case a.SeparationFunctionType.e_points:u=ib.MulTRV(C.q,this.m_axis,hi);var L=ib.MulTRV(I.q,z.NegV(this.m_axis,z.s_t0),ii);d[0]=this.m_proxyA.GetSupport(u);
n[0]=this.m_proxyB.GetSupport(L);d=this.m_proxyA.GetVertex(d[0]);n=this.m_proxyB.GetVertex(n[0]);C=rb.MulXV(C,d,ae);I=rb.MulXV(I,n,be);return z.DotVV(z.SubVV(I,C,z.s_t0),this.m_axis);case a.SeparationFunctionType.e_faceA:return u=ib.MulRV(C.q,this.m_axis,$e),C=rb.MulXV(C,this.m_localPoint,ae),L=ib.MulTRV(I.q,z.NegV(u,z.s_t0),ii),d[0]=-1,n[0]=this.m_proxyB.GetSupport(L),n=this.m_proxyB.GetVertex(n[0]),I=rb.MulXV(I,n,be),z.DotVV(z.SubVV(I,C,z.s_t0),u);case a.SeparationFunctionType.e_faceB:return u=
ib.MulRV(I.q,this.m_axis,$e),I=rb.MulXV(I,this.m_localPoint,be),L=ib.MulTRV(C.q,z.NegV(u,z.s_t0),hi),n[0]=-1,d[0]=this.m_proxyA.GetSupport(L),n=this.m_proxyA.GetVertex(d[0]),n=rb.MulXV(C,n,ae),z.DotVV(z.SubVV(n,I,z.s_t0),u);default:return d[0]=-1,n[0]=-1,0}}Evaluate(d,n,u){var C=Vf,I=Wf;this.m_sweepA.GetTransform(C,u);this.m_sweepB.GetTransform(I,u);switch(this.m_type){case a.SeparationFunctionType.e_points:return d=this.m_proxyA.GetVertex(d),n=this.m_proxyB.GetVertex(n),C=rb.MulXV(C,d,ae),I=rb.MulXV(I,
n,be),z.DotVV(z.SubVV(I,C,z.s_t0),this.m_axis);case a.SeparationFunctionType.e_faceA:return d=ib.MulRV(C.q,this.m_axis,$e),C=rb.MulXV(C,this.m_localPoint,ae),n=this.m_proxyB.GetVertex(n),I=rb.MulXV(I,n,be),z.DotVV(z.SubVV(I,C,z.s_t0),d);case a.SeparationFunctionType.e_faceB:return n=ib.MulRV(I.q,this.m_axis,$e),I=rb.MulXV(I,this.m_localPoint,be),d=this.m_proxyA.GetVertex(d),C=rb.MulXV(C,d,ae),z.DotVV(z.SubVV(C,I,z.s_t0),n);default:return 0}}}const xl=new J,Al=new oa,Bl=new na,Cl=new ja,Dl=new ji,
El=[0],Fl=[0],yl=new ab,zl=new ab;(function(d){d[d.e_unknownJoint=0]="e_unknownJoint";d[d.e_revoluteJoint=1]="e_revoluteJoint";d[d.e_prismaticJoint=2]="e_prismaticJoint";d[d.e_distanceJoint=3]="e_distanceJoint";d[d.e_pulleyJoint=4]="e_pulleyJoint";d[d.e_mouseJoint=5]="e_mouseJoint";d[d.e_gearJoint=6]="e_gearJoint";d[d.e_wheelJoint=7]="e_wheelJoint";d[d.e_weldJoint=8]="e_weldJoint";d[d.e_frictionJoint=9]="e_frictionJoint";d[d.e_ropeJoint=10]="e_ropeJoint";d[d.e_motorJoint=11]="e_motorJoint";d[d.e_areaJoint=
12]="e_areaJoint"})(a.JointType||(a.JointType={}));class Gl{constructor(){this.linear=new z;this.angularB=this.angularA=0}SetZero(){this.linear.SetZero();this.angularB=this.angularA=0;return this}Set(d,n,u){this.linear.Copy(d);this.angularA=n;this.angularB=u;return this}}class Vg{constructor(d){this.next=this.prev=this._other=null;this.joint=d}get other(){if(null===this._other)throw Error();return this._other}set other(d){if(null!==this._other)throw Error();this._other=d}Reset(){this.next=this.prev=
this._other=null}}class Dd{constructor(d){this.type=a.JointType.e_unknownJoint;this.userData=null;this.collideConnected=!1;this.type=d}}class $c{constructor(d){this.m_type=a.JointType.e_unknownJoint;this.m_next=this.m_prev=null;this.m_edgeA=new Vg(this);this.m_edgeB=new Vg(this);this.m_index=0;this.m_collideConnected=this.m_islandFlag=!1;this.m_userData=null;this.m_type=d.type;this.m_edgeA.other=d.bodyB;this.m_bodyA=this.m_edgeB.other=d.bodyA;this.m_bodyB=d.bodyB;this.m_collideConnected=b(d.collideConnected,
!1);this.m_userData=b(d.userData,null)}GetType(){return this.m_type}GetBodyA(){return this.m_bodyA}GetBodyB(){return this.m_bodyB}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(d){this.m_userData=d}IsEnabled(){return this.m_bodyA.IsEnabled()&&this.m_bodyB.IsEnabled()}GetCollideConnected(){return this.m_collideConnected}Dump(d){d("// Dump is not supported for this joint type.\n")}ShiftOrigin(){}Draw(d){var n=this.m_bodyA.GetTransform(),u=this.m_bodyB.GetTransform(),C=
n.p,I=u.p;u=this.GetAnchorA($c.Draw_s_p1);n=this.GetAnchorB($c.Draw_s_p2);var L=$c.Draw_s_color.SetRGB(.5,.8,.8);switch(this.m_type){case a.JointType.e_distanceJoint:d.DrawSegment(u,n,L);break;case a.JointType.e_pulleyJoint:C=this.GetGroundAnchorA();I=this.GetGroundAnchorB();d.DrawSegment(C,u,L);d.DrawSegment(I,n,L);d.DrawSegment(C,I,L);break;case a.JointType.e_mouseJoint:L=$c.Draw_s_c;L.Set(0,1,0);d.DrawPoint(u,4,L);d.DrawPoint(n,4,L);L.Set(.8,.8,.8);d.DrawSegment(u,n,L);break;default:d.DrawSegment(C,
u,L),d.DrawSegment(u,n,L),d.DrawSegment(I,n,L)}}}$c.Draw_s_p1=new z;$c.Draw_s_p2=new z;$c.Draw_s_color=new ya(.5,.8,.8);$c.Draw_s_c=new ya;class ki extends Dd{constructor(){super(a.JointType.e_distanceJoint);this.localAnchorA=new z;this.localAnchorB=new z;this.length=1;this.minLength=0;this.maxLength=1E37;this.damping=this.stiffness=0}Initialize(d,n,u,C){this.bodyA=d;this.bodyB=n;this.bodyA.GetLocalPoint(u,this.localAnchorA);this.bodyB.GetLocalPoint(C,this.localAnchorB);this.maxLength=this.minLength=
this.length=h(z.DistanceVV(u,C),.005)}}class rc extends $c{constructor(d){super(d);this.m_maxLength=this.m_minLength=this.m_length=this.m_bias=this.m_damping=this.m_stiffness=0;this.m_localAnchorA=new z;this.m_localAnchorB=new z;this.m_indexB=this.m_indexA=this.m_upperImpulse=this.m_lowerImpulse=this.m_impulse=this.m_gamma=0;this.m_u=new z;this.m_rA=new z;this.m_rB=new z;this.m_localCenterA=new z;this.m_localCenterB=new z;this.m_mass=this.m_softMass=this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=
this.m_currentLength=0;this.m_qA=new ib;this.m_qB=new ib;this.m_lalcA=new z;this.m_lalcB=new z;this.m_localAnchorA.Copy(b(d.localAnchorA,z.ZERO));this.m_localAnchorB.Copy(b(d.localAnchorB,z.ZERO));this.m_length=h(b(d.length,this.GetCurrentLength()),.005);this.m_minLength=h(b(d.minLength,this.m_length),.005);this.m_maxLength=h(b(d.maxLength,this.m_length),this.m_minLength);this.m_stiffness=b(d.stiffness,0);this.m_damping=b(d.damping,0)}GetAnchorA(d){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,
d)}GetAnchorB(d){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,d)}GetReactionForce(d,n){n.x=d*(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_u.x;n.y=d*(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_u.y;return n}GetReactionTorque(){return 0}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetLength(d){this.m_impulse=0;return this.m_length=h(.005,d)}GetLength(){return this.m_length}SetMinLength(d){this.m_lowerImpulse=
0;return this.m_minLength=g(d,.005,this.m_maxLength)}SetMaxLength(d){this.m_upperImpulse=0;return this.m_maxLength=h(d,this.m_minLength)}GetCurrentLength(){const d=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,new z),n=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,new z);return z.DistanceVV(d,n)}SetStiffness(d){this.m_stiffness=d}GetStiffness(){return this.m_stiffness}SetDamping(d){this.m_damping=d}GetDamping(){return this.m_damping}Dump(d){const n=this.m_bodyA.m_islandIndex,u=this.m_bodyB.m_islandIndex;
d("  const jd: b2DistanceJointDef = new b2DistanceJointDef();\n");d("  jd.bodyA = bodies[%d];\n",n);d("  jd.bodyB = bodies[%d];\n",u);d("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false");d("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);d("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);d("  jd.length = %.15f;\n",this.m_length);d("  jd.minLength = %.15f;\n",this.m_minLength);d("  jd.maxLength = %.15f;\n",
this.m_maxLength);d("  jd.stiffness = %.15f;\n",this.m_stiffness);d("  jd.damping = %.15f;\n",this.m_damping);d("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}InitVelocityConstraints(d){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;
this.m_invIB=this.m_bodyB.m_invI;var n=d.positions[this.m_indexA].c;const u=d.velocities[this.m_indexA].v;let C=d.velocities[this.m_indexA].w;var I=d.positions[this.m_indexB].c,L=d.positions[this.m_indexB].a;const U=d.velocities[this.m_indexB].v;let Z=d.velocities[this.m_indexB].w;var ka=this.m_qA.SetAngle(d.positions[this.m_indexA].a);L=this.m_qB.SetAngle(L);z.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);ib.MulRV(ka,this.m_lalcA,this.m_rA);z.SubVV(this.m_localAnchorB,this.m_localCenterB,
this.m_lalcB);ib.MulRV(L,this.m_lalcB,this.m_rB);this.m_u.x=I.x+this.m_rB.x-n.x-this.m_rA.x;this.m_u.y=I.y+this.m_rB.y-n.y-this.m_rA.y;this.m_currentLength=this.m_u.Length();.005<this.m_currentLength?this.m_u.SelfMul(1/this.m_currentLength):(this.m_u.SetZero(),this.m_upperImpulse=this.m_lowerImpulse=this.m_impulse=this.m_mass=0);n=z.CrossVV(this.m_rA,this.m_u);I=z.CrossVV(this.m_rB,this.m_u);n=this.m_invMassA+this.m_invIA*n*n+this.m_invMassB+this.m_invIB*I*I;this.m_mass=0!==n?1/n:0;0<this.m_stiffness&&
this.m_minLength<this.m_maxLength?(I=this.m_currentLength-this.m_length,ka=this.m_stiffness,L=d.step.dt,this.m_gamma=L*(this.m_damping+L*ka),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=I*L*ka*this.m_gamma,n+=this.m_gamma,this.m_softMass=0!==n?1/n:0):(this.m_bias=this.m_gamma=0,this.m_softMass=this.m_mass);d.step.warmStarting?(this.m_impulse*=d.step.dtRatio,this.m_lowerImpulse*=d.step.dtRatio,this.m_upperImpulse*=d.step.dtRatio,n=z.MulSV(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse,
this.m_u,rc.InitVelocityConstraints_s_P),u.SelfMulSub(this.m_invMassA,n),C-=this.m_invIA*z.CrossVV(this.m_rA,n),U.SelfMulAdd(this.m_invMassB,n),Z+=this.m_invIB*z.CrossVV(this.m_rB,n)):this.m_impulse=0;d.velocities[this.m_indexA].w=C;d.velocities[this.m_indexB].w=Z}SolveVelocityConstraints(d){const n=d.velocities[this.m_indexA].v;let u=d.velocities[this.m_indexA].w;const C=d.velocities[this.m_indexB].v;let I=d.velocities[this.m_indexB].w;if(this.m_minLength<this.m_maxLength){if(0<this.m_stiffness){var L=
z.AddVCrossSV(n,u,this.m_rA,rc.SolveVelocityConstraints_s_vpA),U=z.AddVCrossSV(C,I,this.m_rB,rc.SolveVelocityConstraints_s_vpB);L=z.DotVV(this.m_u,z.SubVV(U,L,z.s_t0));L=-this.m_softMass*(L+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=L;L=z.MulSV(L,this.m_u,rc.SolveVelocityConstraints_s_P);n.SelfMulSub(this.m_invMassA,L);u-=this.m_invIA*z.CrossVV(this.m_rA,L);C.SelfMulAdd(this.m_invMassB,L);I+=this.m_invIB*z.CrossVV(this.m_rB,L)}L=h(0,this.m_currentLength-this.m_minLength)*d.step.inv_dt;
U=z.AddVCrossSV(n,u,this.m_rA,rc.SolveVelocityConstraints_s_vpA);var Z=z.AddVCrossSV(C,I,this.m_rB,rc.SolveVelocityConstraints_s_vpB);U=z.DotVV(this.m_u,z.SubVV(Z,U,z.s_t0));L=-this.m_mass*(U+L);U=this.m_lowerImpulse;this.m_lowerImpulse=h(0,this.m_lowerImpulse+L);L=this.m_lowerImpulse-U;L=z.MulSV(L,this.m_u,rc.SolveVelocityConstraints_s_P);n.SelfMulSub(this.m_invMassA,L);u-=this.m_invIA*z.CrossVV(this.m_rA,L);C.SelfMulAdd(this.m_invMassB,L);I+=this.m_invIB*z.CrossVV(this.m_rB,L);L=h(0,this.m_maxLength-
this.m_currentLength)*d.step.inv_dt;U=z.AddVCrossSV(n,u,this.m_rA,rc.SolveVelocityConstraints_s_vpA);Z=z.AddVCrossSV(C,I,this.m_rB,rc.SolveVelocityConstraints_s_vpB);U=z.DotVV(this.m_u,z.SubVV(U,Z,z.s_t0));L=-this.m_mass*(U+L);U=this.m_upperImpulse;this.m_upperImpulse=h(0,this.m_upperImpulse+L);L=this.m_upperImpulse-U;L=z.MulSV(-L,this.m_u,rc.SolveVelocityConstraints_s_P);n.SelfMulSub(this.m_invMassA,L);u-=this.m_invIA*z.CrossVV(this.m_rA,L);C.SelfMulAdd(this.m_invMassB,L);I+=this.m_invIB*z.CrossVV(this.m_rB,
L)}else L=z.AddVCrossSV(n,u,this.m_rA,rc.SolveVelocityConstraints_s_vpA),U=z.AddVCrossSV(C,I,this.m_rB,rc.SolveVelocityConstraints_s_vpB),L=z.DotVV(this.m_u,z.SubVV(U,L,z.s_t0)),L*=-this.m_mass,this.m_impulse+=L,L=z.MulSV(L,this.m_u,rc.SolveVelocityConstraints_s_P),n.SelfMulSub(this.m_invMassA,L),u-=this.m_invIA*z.CrossVV(this.m_rA,L),C.SelfMulAdd(this.m_invMassB,L),I+=this.m_invIB*z.CrossVV(this.m_rB,L);d.velocities[this.m_indexA].w=u;d.velocities[this.m_indexB].w=I}SolvePositionConstraints(d){const n=
d.positions[this.m_indexA].c;let u=d.positions[this.m_indexA].a;const C=d.positions[this.m_indexB].c;let I=d.positions[this.m_indexB].a;var L=this.m_qA.SetAngle(u),U=this.m_qB.SetAngle(I);L=ib.MulRV(L,this.m_lalcA,this.m_rA);U=ib.MulRV(U,this.m_lalcB,this.m_rB);var Z=this.m_u;Z.x=C.x+U.x-n.x-L.x;Z.y=C.y+U.y-n.y-L.y;var ka=this.m_u.Normalize();if(this.m_minLength==this.m_maxLength)ka-=this.m_minLength;else if(ka<this.m_minLength)ka-=this.m_minLength;else if(this.m_maxLength<ka)ka-=this.m_maxLength;
else return!0;Z=z.MulSV(-this.m_mass*ka,Z,rc.SolvePositionConstraints_s_P);n.SelfMulSub(this.m_invMassA,Z);u-=this.m_invIA*z.CrossVV(L,Z);C.SelfMulAdd(this.m_invMassB,Z);I+=this.m_invIB*z.CrossVV(U,Z);d.positions[this.m_indexA].a=u;d.positions[this.m_indexB].a=I;return.005>eb(ka)}Draw(d){var n=this.m_bodyA.GetTransform(),u=this.m_bodyB.GetTransform();n=rb.MulXV(n,this.m_localAnchorA,rc.Draw_s_pA);var C=rb.MulXV(u,this.m_localAnchorB,rc.Draw_s_pB);const I=z.SubVV(C,n,rc.Draw_s_axis);I.Normalize();
var L=rc.Draw_s_c1;const U=rc.Draw_s_c2;u=rc.Draw_s_c3;d.DrawSegment(n,C,rc.Draw_s_c4);C=z.AddVMulSV(n,this.m_length,I,rc.Draw_s_pRest);d.DrawPoint(C,8,L);this.m_minLength!=this.m_maxLength&&(.005<this.m_minLength&&(L=z.AddVMulSV(n,this.m_minLength,I,rc.Draw_s_pMin),d.DrawPoint(L,4,U)),1E37>this.m_maxLength&&(n=z.AddVMulSV(n,this.m_maxLength,I,rc.Draw_s_pMax),d.DrawPoint(n,4,u)))}}rc.InitVelocityConstraints_s_P=new z;rc.SolveVelocityConstraints_s_vpA=new z;rc.SolveVelocityConstraints_s_vpB=new z;
rc.SolveVelocityConstraints_s_P=new z;rc.SolvePositionConstraints_s_P=new z;rc.Draw_s_pA=new z;rc.Draw_s_pB=new z;rc.Draw_s_axis=new z;rc.Draw_s_c1=new ya(.7,.7,.7);rc.Draw_s_c2=new ya(.3,.9,.3);rc.Draw_s_c3=new ya(.9,.3,.3);rc.Draw_s_c4=new ya(.4,.4,.4);rc.Draw_s_pRest=new z;rc.Draw_s_pMin=new z;rc.Draw_s_pMax=new z;class Hl extends Dd{constructor(){super(a.JointType.e_areaJoint);this.bodies=[];this.damping=this.stiffness=0}AddBody(d){this.bodies.push(d);1===this.bodies.length?this.bodyA=d:2===this.bodies.length&&
(this.bodyB=d)}}class li extends $c{constructor(d){super(d);this.m_targetArea=this.m_impulse=this.m_damping=this.m_stiffness=0;this.m_delta=new z;this.m_bodies=d.bodies;this.m_stiffness=b(d.stiffness,0);this.m_damping=b(d.damping,0);this.m_targetLengths=e(d.bodies.length);this.m_normals=z.MakeArray(d.bodies.length);this.m_joints=[];this.m_deltas=z.MakeArray(d.bodies.length);d=new ki;d.stiffness=this.m_stiffness;d.damping=this.m_damping;this.m_targetArea=0;for(let n=0;n<this.m_bodies.length;++n){const u=
this.m_bodies[n],C=this.m_bodies[(n+1)%this.m_bodies.length],I=u.GetWorldCenter(),L=C.GetWorldCenter();this.m_targetLengths[n]=z.DistanceVV(I,L);this.m_targetArea+=z.CrossVV(I,L);d.Initialize(u,C,I,L);this.m_joints[n]=u.GetWorld().CreateJoint(d)}this.m_targetArea*=.5}GetAnchorA(d){return d}GetAnchorB(d){return d}GetReactionForce(d,n){return n}GetReactionTorque(){return 0}SetStiffness(d){this.m_stiffness=d;for(let n=0;n<this.m_joints.length;++n)this.m_joints[n].SetStiffness(d)}GetStiffness(){return this.m_stiffness}SetDamping(d){this.m_damping=
d;for(let n=0;n<this.m_joints.length;++n)this.m_joints[n].SetDamping(d)}GetDamping(){return this.m_damping}Dump(d){d("Area joint dumping is not supported.\n")}InitVelocityConstraints(d){for(var n=0;n<this.m_bodies.length;++n)z.SubVV(d.positions[this.m_bodies[(n+1)%this.m_bodies.length].m_islandIndex].c,d.positions[this.m_bodies[(n+this.m_bodies.length-1)%this.m_bodies.length].m_islandIndex].c,this.m_deltas[n]);if(d.step.warmStarting)for(this.m_impulse*=d.step.dtRatio,n=0;n<this.m_bodies.length;++n){const u=
this.m_bodies[n],C=d.velocities[u.m_islandIndex].v,I=this.m_deltas[n];C.x+=u.m_invMass*I.y*.5*this.m_impulse;C.y+=u.m_invMass*-I.x*.5*this.m_impulse}else this.m_impulse=0}SolveVelocityConstraints(d){var n=0,u=0;for(var C=0;C<this.m_bodies.length;++C){var I=this.m_bodies[C],L=d.velocities[I.m_islandIndex].v;const U=this.m_deltas[C];n+=U.LengthSquared()/I.GetMass();u+=z.CrossVV(L,U)}n=-2*u/n;this.m_impulse+=n;for(u=0;u<this.m_bodies.length;++u)C=this.m_bodies[u],I=d.velocities[C.m_islandIndex].v,L=
this.m_deltas[u],I.x+=C.m_invMass*L.y*.5*n,I.y+=C.m_invMass*-L.x*.5*n}SolvePositionConstraints(d){var n=0,u=0;for(var C=0;C<this.m_bodies.length;++C){var I=d.positions[this.m_bodies[C].m_islandIndex].c,L=d.positions[this.m_bodies[(C+1)%this.m_bodies.length].m_islandIndex].c,U=z.SubVV(L,I,this.m_delta);let Z=U.Length();1E-5>Z&&(Z=1);this.m_normals[C].x=U.y/Z;this.m_normals[C].y=-U.x/Z;n+=Z;u+=z.CrossVV(I,L)}n=.5*(this.m_targetArea-.5*u)/n;u=!0;for(C=0;C<this.m_bodies.length;++C)I=d.positions[this.m_bodies[C].m_islandIndex].c,
L=z.AddVV(this.m_normals[C],this.m_normals[(C+1)%this.m_bodies.length],this.m_delta),L.SelfMul(n),U=L.LengthSquared(),U>.2*.2&&L.SelfMul(.2/ub(U)),2.5E-5<U&&(u=!1),I.x+=L.x,I.y+=L.y;return u}}class Ge{constructor(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0}Clone(){return(new Ge).Copy(this)}Copy(d){this.categoryBits=d.categoryBits;this.maskBits=d.maskBits;this.groupIndex=d.groupIndex||0;return this}}Ge.DEFAULT=new Ge;class mi{constructor(){this.userData=null;this.friction=.2;this.restitution=
0;this.restitutionThreshold=1;this.density=0;this.isSensor=!1;this.filter=new Ge}}class me{constructor(d,n){this.aabb=new Wa;this.fixture=d;this.childIndex=n;this.fixture.m_shape.ComputeAABB(this.aabb,this.fixture.m_body.GetTransform(),n);this.treeNode=this.fixture.m_body.m_world.m_contactManager.m_broadPhase.CreateProxy(this.aabb,this)}Reset(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.DestroyProxy(this.treeNode)}Touch(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.TouchProxy(this.treeNode)}Synchronize(d,
n){if(d===n)this.fixture.m_shape.ComputeAABB(this.aabb,d,this.childIndex),this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,this.aabb,z.ZERO);else{const u=me.Synchronize_s_aabb1,C=me.Synchronize_s_aabb2;this.fixture.m_shape.ComputeAABB(u,d,this.childIndex);this.fixture.m_shape.ComputeAABB(C,n,this.childIndex);this.aabb.Combine2(u,C);d=me.Synchronize_s_displacement;d.Copy(C.GetCenter()).SelfSub(u.GetCenter());this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,
this.aabb,d)}}}me.Synchronize_s_aabb1=new Wa;me.Synchronize_s_aabb2=new Wa;me.Synchronize_s_displacement=new z;class ni{constructor(d,n){this.m_density=0;this.m_next=null;this.m_restitution=this.m_friction=0;this.m_restitutionThreshold=1;this.m_proxies=[];this.m_filter=new Ge;this.m_isSensor=!1;this.m_userData=null;this.m_body=d;this.m_shape=n.shape.Clone();this.m_userData=b(n.userData,null);this.m_friction=b(n.friction,.2);this.m_restitution=b(n.restitution,0);this.m_restitutionThreshold=b(n.restitutionThreshold,
0);this.m_filter.Copy(b(n.filter,Ge.DEFAULT));this.m_isSensor=b(n.isSensor,!1);this.m_density=b(n.density,0)}get m_proxyCount(){return this.m_proxies.length}Reset(){}GetType(){return this.m_shape.GetType()}GetShape(){return this.m_shape}SetSensor(d){d!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=d)}IsSensor(){return this.m_isSensor}SetFilterData(d){this.m_filter.Copy(d);this.Refilter()}GetFilterData(){return this.m_filter}Refilter(){let d=this.m_body.GetContactList();for(;d;){const n=
d.contact,u=n.GetFixtureA(),C=n.GetFixtureB();u!==this&&C!==this||n.FlagForFiltering();d=d.next}this.TouchProxies()}GetBody(){return this.m_body}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(d){this.m_userData=d}TestPoint(d){return this.m_shape.TestPoint(this.m_body.GetTransform(),d)}ComputeDistance(d,n,u){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),d,n,u)}RayCast(d,n,u){return this.m_shape.RayCast(d,n,this.m_body.GetTransform(),u)}GetMassData(d=
new cb){this.m_shape.ComputeMass(d,this.m_density);return d}SetDensity(d){this.m_density=d}GetDensity(){return this.m_density}GetFriction(){return this.m_friction}SetFriction(d){this.m_friction=d}GetRestitution(){return this.m_restitution}SetRestitution(d){this.m_restitution=d}GetRestitutionThreshold(){return this.m_restitutionThreshold}SetRestitutionThreshold(d){this.m_restitutionThreshold=d}GetAABB(d){return this.m_proxies[d].aabb}Dump(d,n){d("    const fd: b2FixtureDef = new b2FixtureDef();\n");
d("    fd.friction = %.15f;\n",this.m_friction);d("    fd.restitution = %.15f;\n",this.m_restitution);d("    fd.restitutionThreshold = %.15f;\n",this.m_restitutionThreshold);d("    fd.density = %.15f;\n",this.m_density);d("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false");d("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits);d("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits);d("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex);this.m_shape.Dump(d);d("\n");d("    fd.shape = shape;\n");
d("\n");d("    bodies[%d].CreateFixture(fd);\n",n)}CreateProxies(){if(0!==this.m_proxies.length)throw Error();for(let d=0;d<this.m_shape.GetChildCount();++d)this.m_proxies[d]=new me(this,d)}DestroyProxies(){for(const d of this.m_proxies)d.Reset();this.m_proxies.length=0}TouchProxies(){for(const d of this.m_proxies)d.Touch()}SynchronizeProxies(d,n){for(const u of this.m_proxies)u.Synchronize(d,n)}}(function(d){d[d.b2_unknown=-1]="b2_unknown";d[d.b2_staticBody=0]="b2_staticBody";d[d.b2_kinematicBody=
1]="b2_kinematicBody";d[d.b2_dynamicBody=2]="b2_dynamicBody"})(a.BodyType||(a.BodyType={}));class Il{constructor(){this.type=a.BodyType.b2_staticBody;this.position=new z(0,0);this.angle=0;this.linearVelocity=new z(0,0);this.angularDamping=this.linearDamping=this.angularVelocity=0;this.awake=this.allowSleep=!0;this.bullet=this.fixedRotation=!1;this.enabled=!0;this.userData=null;this.gravityScale=1}}class ud{constructor(d,n){this.m_type=a.BodyType.b2_staticBody;this.m_toiFlag=this.m_enabledFlag=this.m_fixedRotationFlag=
this.m_bulletFlag=this.m_autoSleepFlag=this.m_awakeFlag=this.m_islandFlag=!1;this.m_islandIndex=0;this.m_xf=new rb;this.m_xf0=new rb;this.m_sweep=new ab;this.m_linearVelocity=new z;this.m_angularVelocity=0;this.m_force=new z;this.m_torque=0;this.m_fixtureList=this.m_next=this.m_prev=null;this.m_fixtureCount=0;this.m_contactList=this.m_jointList=null;this.m_invMass=this.m_mass=1;this.m_angularDamping=this.m_linearDamping=this.m_invI=this.m_I=0;this.m_gravityScale=1;this.m_sleepTime=0;this.m_controllerList=
this.m_userData=null;this.m_controllerCount=0;this.m_bulletFlag=b(d.bullet,!1);this.m_fixedRotationFlag=b(d.fixedRotation,!1);this.m_autoSleepFlag=b(d.allowSleep,!0);b(d.awake,!1)&&b(d.type,a.BodyType.b2_staticBody)!==a.BodyType.b2_staticBody&&(this.m_awakeFlag=!0);this.m_enabledFlag=b(d.enabled,!0);this.m_world=n;this.m_xf.p.Copy(b(d.position,z.ZERO));this.m_xf.q.SetAngle(b(d.angle,0));this.m_xf0.Copy(this.m_xf);this.m_sweep.localCenter.SetZero();this.m_sweep.c0.Copy(this.m_xf.p);this.m_sweep.c.Copy(this.m_xf.p);
this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle();this.m_sweep.alpha0=0;this.m_linearVelocity.Copy(b(d.linearVelocity,z.ZERO));this.m_angularVelocity=b(d.angularVelocity,0);this.m_linearDamping=b(d.linearDamping,0);this.m_angularDamping=b(d.angularDamping,0);this.m_gravityScale=b(d.gravityScale,1);this.m_force.SetZero();this.m_sleepTime=this.m_torque=0;this.m_type=b(d.type,a.BodyType.b2_staticBody);this.m_invI=this.m_I=this.m_invMass=this.m_mass=0;this.m_userData=d.userData;this.m_fixtureList=
null;this.m_fixtureCount=0;this.m_controllerList=null;this.m_controllerCount=0}CreateFixture(d,n=0){return d instanceof gb?this.CreateFixtureShapeDensity(d,n):this.CreateFixtureDef(d)}CreateFixtureDef(d){if(this.m_world.IsLocked())throw Error();d=new ni(this,d);this.m_enabledFlag&&d.CreateProxies();d.m_next=this.m_fixtureList;this.m_fixtureList=d;++this.m_fixtureCount;0<d.m_density&&this.ResetMassData();this.m_world.m_newContacts=!0;return d}CreateFixtureShapeDensity(d,n=0){const u=ud.CreateFixtureShapeDensity_s_def;
u.shape=d;u.density=n;return this.CreateFixtureDef(u)}DestroyFixture(d){if(this.m_world.IsLocked())throw Error();for(var n=this.m_fixtureList,u=null;null!==n;){if(n===d){u?u.m_next=d.m_next:this.m_fixtureList=d.m_next;break}u=n;n=n.m_next}for(n=this.m_contactList;n;){u=n.contact;n=n.next;const C=u.GetFixtureA(),I=u.GetFixtureB();d!==C&&d!==I||this.m_world.m_contactManager.Destroy(u)}this.m_enabledFlag&&d.DestroyProxies();d.m_next=null;d.Reset();--this.m_fixtureCount;this.ResetMassData()}SetTransformVec(d,
n){this.SetTransformXY(d.x,d.y,n)}SetTransformXY(d,n,u){if(this.m_world.IsLocked())throw Error();this.m_xf.q.SetAngle(u);this.m_xf.p.Set(d,n);this.m_xf0.Copy(this.m_xf);rb.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c);this.m_sweep.a=u;this.m_sweep.c0.Copy(this.m_sweep.c);this.m_sweep.a0=u;for(d=this.m_fixtureList;d;d=d.m_next)d.SynchronizeProxies(this.m_xf,this.m_xf);this.m_world.m_newContacts=!0}SetTransform(d){this.SetTransformVec(d.p,d.GetAngle())}GetTransform(){return this.m_xf}GetPosition(){return this.m_xf.p}SetPosition(d){this.SetTransformVec(d,
this.GetAngle())}SetPositionXY(d,n){this.SetTransformXY(d,n,this.GetAngle())}GetAngle(){return this.m_sweep.a}SetAngle(d){this.SetTransformVec(this.GetPosition(),d)}GetWorldCenter(){return this.m_sweep.c}GetLocalCenter(){return this.m_sweep.localCenter}SetLinearVelocity(d){this.m_type!==a.BodyType.b2_staticBody&&(0<z.DotVV(d,d)&&this.SetAwake(!0),this.m_linearVelocity.Copy(d))}GetLinearVelocity(){return this.m_linearVelocity}SetAngularVelocity(d){this.m_type!==a.BodyType.b2_staticBody&&(0<d*d&&this.SetAwake(!0),
this.m_angularVelocity=d)}GetAngularVelocity(){return this.m_angularVelocity}GetDefinition(d){d.type=this.GetType();d.allowSleep=this.m_autoSleepFlag;d.angle=this.GetAngle();d.angularDamping=this.m_angularDamping;d.gravityScale=this.m_gravityScale;d.angularVelocity=this.m_angularVelocity;d.fixedRotation=this.m_fixedRotationFlag;d.bullet=this.m_bulletFlag;d.awake=this.m_awakeFlag;d.linearDamping=this.m_linearDamping;d.linearVelocity.Copy(this.GetLinearVelocity());d.position.Copy(this.GetPosition());
d.userData=this.GetUserData();return d}ApplyForce(d,n,u=!0){this.m_type===a.BodyType.b2_dynamicBody&&(u&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=d.x,this.m_force.y+=d.y,this.m_torque+=(n.x-this.m_sweep.c.x)*d.y-(n.y-this.m_sweep.c.y)*d.x))}ApplyForceToCenter(d,n=!0){this.m_type===a.BodyType.b2_dynamicBody&&(n&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=d.x,this.m_force.y+=d.y))}ApplyTorque(d,n=!0){this.m_type===a.BodyType.b2_dynamicBody&&
(n&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=d))}ApplyLinearImpulse(d,n,u=!0){this.m_type===a.BodyType.b2_dynamicBody&&(u&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*d.x,this.m_linearVelocity.y+=this.m_invMass*d.y,this.m_angularVelocity+=this.m_invI*((n.x-this.m_sweep.c.x)*d.y-(n.y-this.m_sweep.c.y)*d.x)))}ApplyLinearImpulseToCenter(d,n=!0){this.m_type===a.BodyType.b2_dynamicBody&&(n&&!this.m_awakeFlag&&this.SetAwake(!0),
this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*d.x,this.m_linearVelocity.y+=this.m_invMass*d.y))}ApplyAngularImpulse(d,n=!0){this.m_type===a.BodyType.b2_dynamicBody&&(n&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*d))}GetMass(){return this.m_mass}GetInertia(){return this.m_I+this.m_mass*z.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)}GetMassData(d){d.mass=this.m_mass;d.I=this.m_I+this.m_mass*z.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter);
d.center.Copy(this.m_sweep.localCenter);return d}SetMassData(d){if(this.m_world.IsLocked())throw Error();if(this.m_type===a.BodyType.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0;this.m_mass=d.mass;0>=this.m_mass&&(this.m_mass=1);this.m_invMass=1/this.m_mass;0<d.I&&!this.m_fixedRotationFlag&&(this.m_I=d.I-this.m_mass*z.DotVV(d.center,d.center),this.m_invI=1/this.m_I);var n=ud.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(d.center);rb.MulXV(this.m_xf,this.m_sweep.localCenter,
this.m_sweep.c);this.m_sweep.c0.Copy(this.m_sweep.c);z.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,z.SubVV(this.m_sweep.c,n,z.s_t0),this.m_linearVelocity)}}ResetMassData(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0;this.m_sweep.localCenter.SetZero();if(this.m_type===a.BodyType.b2_staticBody||this.m_type===a.BodyType.b2_kinematicBody)this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a;else{var d=ud.ResetMassData_s_localCenter.SetZero();
for(var n=this.m_fixtureList;n;n=n.m_next){if(0===n.m_density)continue;const u=n.GetMassData(ud.ResetMassData_s_massData);this.m_mass+=u.mass;d.x+=u.center.x*u.mass;d.y+=u.center.y*u.mass;this.m_I+=u.I}0<this.m_mass&&(this.m_invMass=1/this.m_mass,d.x*=this.m_invMass,d.y*=this.m_invMass);0<this.m_I&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*z.DotVV(d,d),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0;n=ud.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(d);rb.MulXV(this.m_xf,
this.m_sweep.localCenter,this.m_sweep.c);this.m_sweep.c0.Copy(this.m_sweep.c);z.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,z.SubVV(this.m_sweep.c,n,z.s_t0),this.m_linearVelocity)}}GetWorldPoint(d,n){return rb.MulXV(this.m_xf,d,n)}GetWorldVector(d,n){return ib.MulRV(this.m_xf.q,d,n)}GetLocalPoint(d,n){return rb.MulTXV(this.m_xf,d,n)}GetLocalVector(d,n){return ib.MulTRV(this.m_xf.q,d,n)}GetLinearVelocityFromWorldPoint(d,n){return z.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,
z.SubVV(d,this.m_sweep.c,z.s_t0),n)}GetLinearVelocityFromLocalPoint(d,n){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(d,n),n)}GetLinearDamping(){return this.m_linearDamping}SetLinearDamping(d){this.m_linearDamping=d}GetAngularDamping(){return this.m_angularDamping}SetAngularDamping(d){this.m_angularDamping=d}GetGravityScale(){return this.m_gravityScale}SetGravityScale(d){this.m_gravityScale=d}SetType(d){if(this.m_world.IsLocked())throw Error();if(this.m_type!==d){this.m_type=d;this.ResetMassData();
this.m_type===a.BodyType.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_awakeFlag=!1,this.SynchronizeFixtures());this.SetAwake(!0);this.m_force.SetZero();this.m_torque=0;for(d=this.m_contactList;d;){const n=d;d=d.next;this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null;for(d=this.m_fixtureList;d;d=d.m_next)d.TouchProxies()}}GetType(){return this.m_type}SetBullet(d){this.m_bulletFlag=
d}IsBullet(){return this.m_bulletFlag}SetSleepingAllowed(d){(this.m_autoSleepFlag=d)||this.SetAwake(!0)}IsSleepingAllowed(){return this.m_autoSleepFlag}SetAwake(d){this.m_type!==a.BodyType.b2_staticBody&&(d?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0))}IsAwake(){return this.m_awakeFlag}SetEnabled(d){if(this.m_world.IsLocked())throw Error();if(d!==this.IsEnabled())if(this.m_enabledFlag=
d){for(d=this.m_fixtureList;d;d=d.m_next)d.CreateProxies();this.m_world.m_newContacts=!0}else{for(d=this.m_fixtureList;d;d=d.m_next)d.DestroyProxies();for(d=this.m_contactList;d;){const n=d;d=d.next;this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null}}IsEnabled(){return this.m_enabledFlag}SetFixedRotation(d){this.m_fixedRotationFlag!==d&&(this.m_fixedRotationFlag=d,this.m_angularVelocity=0,this.ResetMassData())}IsFixedRotation(){return this.m_fixedRotationFlag}GetFixtureList(){return this.m_fixtureList}GetJointList(){return this.m_jointList}GetContactList(){return this.m_contactList}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(d){this.m_userData=
d}GetWorld(){return this.m_world}Dump(d){const n=this.m_islandIndex;d("{\n");d("  const bd: b2BodyDef = new b2BodyDef();\n");var u="";switch(this.m_type){case a.BodyType.b2_staticBody:u="b2BodyType.b2_staticBody";break;case a.BodyType.b2_kinematicBody:u="b2BodyType.b2_kinematicBody";break;case a.BodyType.b2_dynamicBody:u="b2BodyType.b2_dynamicBody"}d("  bd.type = %s;\n",u);d("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y);d("  bd.angle = %.15f;\n",this.m_sweep.a);d("  bd.linearVelocity.Set(%.15f, %.15f);\n",
this.m_linearVelocity.x,this.m_linearVelocity.y);d("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity);d("  bd.linearDamping = %.15f;\n",this.m_linearDamping);d("  bd.angularDamping = %.15f;\n",this.m_angularDamping);d("  bd.allowSleep = %s;\n",this.m_autoSleepFlag?"true":"false");d("  bd.awake = %s;\n",this.m_awakeFlag?"true":"false");d("  bd.fixedRotation = %s;\n",this.m_fixedRotationFlag?"true":"false");d("  bd.bullet = %s;\n",this.m_bulletFlag?"true":"false");d("  bd.active = %s;\n",this.m_enabledFlag?
"true":"false");d("  bd.gravityScale = %.15f;\n",this.m_gravityScale);d("\n");d("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex);d("\n");for(u=this.m_fixtureList;u;u=u.m_next)d("  {\n"),u.Dump(d,n),d("  }\n");d("}\n")}SynchronizeFixtures(){if(this.m_awakeFlag){var d=ud.SynchronizeFixtures_s_xf1;d.q.SetAngle(this.m_sweep.a0);ib.MulRV(d.q,this.m_sweep.localCenter,d.p);z.SubVV(this.m_sweep.c0,d.p,d.p);for(let n=this.m_fixtureList;n;n=n.m_next)n.SynchronizeProxies(d,this.m_xf)}else for(d=
this.m_fixtureList;d;d=d.m_next)d.SynchronizeProxies(this.m_xf,this.m_xf)}SynchronizeTransform(){this.m_xf.q.SetAngle(this.m_sweep.a);ib.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p);z.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}ShouldCollide(d){return this.m_type===a.BodyType.b2_staticBody&&d.m_type===a.BodyType.b2_staticBody?!1:this.ShouldCollideConnected(d)}ShouldCollideConnected(d){for(let n=this.m_jointList;n;n=n.next)if(n.other===d&&!n.joint.m_collideConnected)return!1;return!0}Advance(d){this.m_sweep.Advance(d);
this.m_sweep.c.Copy(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.m_xf.q.SetAngle(this.m_sweep.a);ib.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p);z.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}GetControllerList(){return this.m_controllerList}GetControllerCount(){return this.m_controllerCount}}ud.CreateFixtureShapeDensity_s_def=new mi;ud.SetMassData_s_oldCenter=new z;ud.ResetMassData_s_localCenter=new z;ud.ResetMassData_s_oldCenter=new z;ud.ResetMassData_s_massData=new cb;ud.SynchronizeFixtures_s_xf1=
new rb;class Wg{constructor(d){this.next=this.prev=this._other=null;this.contact=d}get other(){if(null===this._other)throw Error();return this._other}set other(d){if(null!==this._other)throw Error();this._other=d}Reset(){this.next=this.prev=this._other=null}}class Ed{constructor(){this.m_toiFlag=this.m_bulletHitFlag=this.m_filterFlag=this.m_enabledFlag=this.m_touchingFlag=this.m_islandFlag=!1;this.m_next=this.m_prev=null;this.m_nodeA=new Wg(this);this.m_nodeB=new Wg(this);this.m_indexB=this.m_indexA=
0;this.m_manifold=new Pa;this.m_tangentSpeed=this.m_restitutionThreshold=this.m_restitution=this.m_friction=this.m_toi=this.m_toiCount=0;this.m_oldManifold=new Pa}GetManifold(){return this.m_manifold}GetWorldManifold(d){const n=this.m_fixtureA.GetBody(),u=this.m_fixtureB.GetBody(),C=this.GetShapeA(),I=this.GetShapeB();d.Initialize(this.m_manifold,n.GetTransform(),C.m_radius,u.GetTransform(),I.m_radius)}IsTouching(){return this.m_touchingFlag}SetEnabled(d){this.m_enabledFlag=d}IsEnabled(){return this.m_enabledFlag}GetNext(){return this.m_next}GetFixtureA(){return this.m_fixtureA}GetChildIndexA(){return this.m_indexA}GetShapeA(){return this.m_fixtureA.GetShape()}GetFixtureB(){return this.m_fixtureB}GetChildIndexB(){return this.m_indexB}GetShapeB(){return this.m_fixtureB.GetShape()}FlagForFiltering(){this.m_filterFlag=
!0}SetFriction(d){this.m_friction=d}GetFriction(){return this.m_friction}ResetFriction(){this.m_friction=ub(this.m_fixtureA.m_friction*this.m_fixtureB.m_friction)}SetRestitution(d){this.m_restitution=d}GetRestitution(){return this.m_restitution}ResetRestitution(){this.m_restitution=P(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}SetRestitutionThreshold(d){this.m_restitutionThreshold=d}GetRestitutionThreshold(){return this.m_restitutionThreshold}ResetRestitutionThreshold(){this.m_restitutionThreshold=
ea(this.m_fixtureA.m_restitutionThreshold,this.m_fixtureB.m_restitutionThreshold)}SetTangentSpeed(d){this.m_tangentSpeed=d}GetTangentSpeed(){return this.m_tangentSpeed}Reset(d,n,u,C){this.m_touchingFlag=this.m_islandFlag=!1;this.m_enabledFlag=!0;this.m_toiFlag=this.m_bulletHitFlag=this.m_filterFlag=!1;this.m_fixtureA=d;this.m_fixtureB=u;this.m_indexA=n;this.m_indexB=C;this.m_manifold.pointCount=0;this.m_next=this.m_prev=null;this.m_nodeA.Reset();this.m_nodeB.Reset();this.m_toiCount=0;this.m_friction=
ub(this.m_fixtureA.m_friction*this.m_fixtureB.m_friction);this.m_restitution=P(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution);this.m_restitutionThreshold=ea(this.m_fixtureA.m_restitutionThreshold,this.m_fixtureB.m_restitutionThreshold)}Update(d){var n=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=n;this.m_enabledFlag=!0;n=this.m_touchingFlag;var u=this.m_fixtureA.IsSensor(),C=this.m_fixtureB.IsSensor();u=u||C;C=this.m_fixtureA.GetBody();var I=this.m_fixtureB.GetBody();
var L=C.GetTransform();var U=I.GetTransform();if(u)C=this.GetShapeA(),I=this.GetShapeB(),L=F(C,this.m_indexA,I,this.m_indexB,L,U),this.m_manifold.pointCount=0;else{this.Evaluate(this.m_manifold,L,U);L=0<this.m_manifold.pointCount;for(U=0;U<this.m_manifold.pointCount;++U){const Z=this.m_manifold.points[U];Z.normalImpulse=0;Z.tangentImpulse=0;const ka=Z.id;for(let ia=0;ia<this.m_oldManifold.pointCount;++ia){const ta=this.m_oldManifold.points[ia];if(ta.id.key===ka.key){Z.normalImpulse=ta.normalImpulse;
Z.tangentImpulse=ta.tangentImpulse;break}}}L!==n&&(C.SetAwake(!0),I.SetAwake(!0))}this.m_touchingFlag=L;!n&&L&&d&&d.BeginContact(this);n&&!L&&d&&d.EndContact(this);!u&&L&&d&&d.PreSolve(this,this.m_oldManifold)}ComputeTOI(d,n){const u=Ed.ComputeTOI_s_input;u.proxyA.SetShape(this.GetShapeA(),this.m_indexA);u.proxyB.SetShape(this.GetShapeB(),this.m_indexB);u.sweepA.Copy(d);u.sweepB.Copy(n);u.tMax=.005;d=Ed.ComputeTOI_s_output;qa(d,u);return d.t}}Ed.ComputeTOI_s_input=new Tg;Ed.ComputeTOI_s_output=new Ug;
class af extends Ed{static Create(){return new af}static Destroy(){}Evaluate(d,n,u){const C=af.Evaluate_s_edge;this.GetShapeA().GetChildEdge(C,this.m_indexA);V(d,C,n,this.GetShapeB(),u)}}af.Evaluate_s_edge=new kb;class bf extends Ed{static Create(){return new bf}static Destroy(){}Evaluate(d,n,u){const C=bf.Evaluate_s_edge;this.GetShapeA().GetChildEdge(C,this.m_indexA);E(d,C,n,this.GetShapeB(),u)}}bf.Evaluate_s_edge=new kb;class Xf extends Ed{static Create(){return new Xf}static Destroy(){}Evaluate(d,
n,u){N(d,this.GetShapeA(),n,this.GetShapeB(),u)}}class Yf extends Ed{static Create(){return new Yf}static Destroy(){}Evaluate(d,n,u){aa(d,this.GetShapeA(),n,this.GetShapeB(),u)}}class Zf extends Ed{static Create(){return new Zf}static Destroy(){}Evaluate(d,n,u){T(d,this.GetShapeA(),n,this.GetShapeB(),u)}}class $f extends Ed{static Create(){return new $f}static Destroy(){}Evaluate(d,n,u){V(d,this.GetShapeA(),n,this.GetShapeB(),u)}}class ag extends Ed{static Create(){return new ag}static Destroy(){}Evaluate(d,
n,u){E(d,this.GetShapeA(),n,this.GetShapeB(),u)}}class oi{constructor(){this.pool=[];this.destroyFcn=this.createFcn=null;this.primary=!1}}class pi{constructor(){this.m_registers=[];this.InitializeRegisters()}AddType(d,n,u,C){function I(){return U.pop()||d()}function L(Z){U.push(Z)}const U=[];this.m_registers[u][C].pool=U;this.m_registers[u][C].createFcn=I;this.m_registers[u][C].destroyFcn=L;this.m_registers[u][C].primary=!0;u!==C&&(this.m_registers[C][u].pool=U,this.m_registers[C][u].createFcn=I,
this.m_registers[C][u].destroyFcn=L,this.m_registers[C][u].primary=!1)}InitializeRegisters(){for(let d=0;d<a.ShapeType.e_shapeTypeCount;d++){this.m_registers[d]=[];for(let n=0;n<a.ShapeType.e_shapeTypeCount;n++)this.m_registers[d][n]=new oi}this.AddType(Xf.Create,Xf.Destroy,a.ShapeType.e_circleShape,a.ShapeType.e_circleShape);this.AddType(Zf.Create,Zf.Destroy,a.ShapeType.e_polygonShape,a.ShapeType.e_circleShape);this.AddType(Yf.Create,Yf.Destroy,a.ShapeType.e_polygonShape,a.ShapeType.e_polygonShape);
this.AddType($f.Create,$f.Destroy,a.ShapeType.e_edgeShape,a.ShapeType.e_circleShape);this.AddType(ag.Create,ag.Destroy,a.ShapeType.e_edgeShape,a.ShapeType.e_polygonShape);this.AddType(af.Create,af.Destroy,a.ShapeType.e_chainShape,a.ShapeType.e_circleShape);this.AddType(bf.Create,bf.Destroy,a.ShapeType.e_chainShape,a.ShapeType.e_polygonShape)}Create(d,n,u,C){var I=d.GetType(),L=u.GetType();I=this.m_registers[I][L];return I.createFcn?(L=I.createFcn(),I.primary?L.Reset(d,n,u,C):L.Reset(u,C,d,n),L):null}Destroy(d){var n=
d.m_fixtureA.GetType();const u=d.m_fixtureB.GetType();n=this.m_registers[n][u];n.destroyFcn&&n.destroyFcn(d)}}class Jl{SayGoodbyeJoint(){}SayGoodbyeFixture(){}SayGoodbyeParticleGroup(){}SayGoodbyeParticle(){}}class bg{ShouldCollide(d,n){const u=d.GetBody(),C=n.GetBody();if(C.GetType()===a.BodyType.b2_staticBody&&u.GetType()===a.BodyType.b2_staticBody||!C.ShouldCollideConnected(u))return!1;d=d.GetFilterData();n=n.GetFilterData();return d.groupIndex===n.groupIndex&&0!==d.groupIndex?0<d.groupIndex:0!==
(d.maskBits&n.categoryBits)&&0!==(d.categoryBits&n.maskBits)}ShouldCollideFixtureParticle(){return!0}ShouldCollideParticleParticle(){return!0}}bg.b2_defaultFilter=new bg;class qi{constructor(){this.normalImpulses=e(2);this.tangentImpulses=e(2);this.count=0}}class cg{BeginContact(){}EndContact(){}BeginContactFixtureParticle(){}EndContactFixtureParticle(){}BeginContactParticleParticle(){}EndContactParticleParticle(){}PreSolve(){}PostSolve(){}}cg.b2_defaultListener=new cg;class Wd{ReportFixture(){return!0}ReportParticle(){return!1}ShouldQueryParticleSystem(){return!0}}
class ri{ReportFixture(d,n,u,C){return C}ReportParticle(){return 0}ShouldQueryParticleSystem(){return!0}}class si{constructor(){this.m_broadPhase=new Za;this.m_contactList=null;this.m_contactCount=0;this.m_contactFilter=bg.b2_defaultFilter;this.m_contactListener=cg.b2_defaultListener;this.m_contactFactory=new pi}AddPair(d,n){let u=d.fixture,C=n.fixture;d=d.childIndex;let I=n.childIndex;n=u.GetBody();var L=C.GetBody();if(n!==L){for(L=L.GetContactList();L;){if(L.other===n){const U=L.contact.GetFixtureA(),
Z=L.contact.GetFixtureB(),ka=L.contact.GetChildIndexA(),ia=L.contact.GetChildIndexB();if(U===u&&Z===C&&ka===d&&ia===I||U===C&&Z===u&&ka===I&&ia===d)return}L=L.next}if(!this.m_contactFilter||this.m_contactFilter.ShouldCollide(u,C))d=this.m_contactFactory.Create(u,d,C,I),null!==d&&(u=d.GetFixtureA(),C=d.GetFixtureB(),d.GetChildIndexA(),d.GetChildIndexB(),n=u.m_body,L=C.m_body,d.m_prev=null,d.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=d),this.m_contactList=d,d.m_nodeA.other=
L,d.m_nodeA.prev=null,d.m_nodeA.next=n.m_contactList,null!==n.m_contactList&&(n.m_contactList.prev=d.m_nodeA),n.m_contactList=d.m_nodeA,d.m_nodeB.other=n,d.m_nodeB.prev=null,d.m_nodeB.next=L.m_contactList,null!==L.m_contactList&&(L.m_contactList.prev=d.m_nodeB),L.m_contactList=d.m_nodeB,++this.m_contactCount)}}FindNewContacts(){this.m_broadPhase.UpdatePairs((d,n)=>{this.AddPair(d,n)})}Destroy(d){const n=d.GetFixtureA(),u=d.GetFixtureB(),C=n.GetBody(),I=u.GetBody();this.m_contactListener&&d.IsTouching()&&
this.m_contactListener.EndContact(d);d.m_prev&&(d.m_prev.m_next=d.m_next);d.m_next&&(d.m_next.m_prev=d.m_prev);d===this.m_contactList&&(this.m_contactList=d.m_next);d.m_nodeA.prev&&(d.m_nodeA.prev.next=d.m_nodeA.next);d.m_nodeA.next&&(d.m_nodeA.next.prev=d.m_nodeA.prev);d.m_nodeA===C.m_contactList&&(C.m_contactList=d.m_nodeA.next);d.m_nodeB.prev&&(d.m_nodeB.prev.next=d.m_nodeB.next);d.m_nodeB.next&&(d.m_nodeB.next.prev=d.m_nodeB.prev);d.m_nodeB===I.m_contactList&&(I.m_contactList=d.m_nodeB.next);
0<d.m_manifold.pointCount&&!n.IsSensor()&&!u.IsSensor()&&(n.GetBody().SetAwake(!0),u.GetBody().SetAwake(!0));this.m_contactFactory.Destroy(d);--this.m_contactCount}Collide(){let d=this.m_contactList;for(;d;){var n=d.GetFixtureA();const I=d.GetFixtureB(),L=d.GetChildIndexA(),U=d.GetChildIndexB();var u=n.GetBody(),C=I.GetBody();if(d.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(n,I)){n=d;d=n.m_next;this.Destroy(n);continue}d.m_filterFlag=!1}u=u.IsAwake()&&u.m_type!==a.BodyType.b2_staticBody;
C=C.IsAwake()&&C.m_type!==a.BodyType.b2_staticBody;u||C?B(n.m_proxies[L].treeNode.aabb,I.m_proxies[U].treeNode.aabb)?(d.Update(this.m_contactListener),d=d.m_next):(n=d,d=n.m_next,this.Destroy(n)):d=d.m_next}}}class Xg{constructor(){this.solveTOI=this.broadphase=this.solvePosition=this.solveVelocity=this.solveInit=this.solve=this.collide=this.step=0}Reset(){this.solveTOI=this.broadphase=this.solvePosition=this.solveVelocity=this.solveInit=this.solve=this.collide=this.step=0;return this}}class He{constructor(){this.particleIterations=
this.positionIterations=this.velocityIterations=this.dtRatio=this.inv_dt=this.dt=0;this.warmStarting=!1}Copy(d){this.dt=d.dt;this.inv_dt=d.inv_dt;this.dtRatio=d.dtRatio;this.positionIterations=d.positionIterations;this.velocityIterations=d.velocityIterations;this.particleIterations=d.particleIterations;this.warmStarting=d.warmStarting;return this}}class dg{constructor(){this.c=new z;this.a=0}static MakeArray(d){return l(d,()=>new dg)}}class eg{constructor(){this.v=new z;this.w=0}static MakeArray(d){return l(d,
()=>new eg)}}class ti{constructor(){this.step=new He}}a.blockSolve=!1;class Yg{constructor(){this.rA=new z;this.rB=new z;this.velocityBias=this.tangentMass=this.normalMass=this.tangentImpulse=this.normalImpulse=0}static MakeArray(d){return l(d,()=>new Yg)}}class fg{constructor(){this.points=Yg.MakeArray(2);this.normal=new z;this.tangent=new z;this.normalMass=new Fb;this.K=new Fb;this.contactIndex=this.pointCount=this.tangentSpeed=this.threshold=this.restitution=this.friction=this.invIB=this.invIA=
this.invMassB=this.invMassA=this.indexB=this.indexA=0}static MakeArray(d){return l(d,()=>new fg)}}class gg{constructor(){this.localPoints=z.MakeArray(2);this.localNormal=new z;this.localPoint=new z;this.invMassB=this.invMassA=this.indexB=this.indexA=0;this.localCenterA=new z;this.localCenterB=new z;this.invIB=this.invIA=0;this.type=a.ManifoldType.e_unknown;this.pointCount=this.radiusB=this.radiusA=0}static MakeArray(d){return l(d,()=>new gg)}}class ui{constructor(){this.step=new He;this.count=0}}
class Nd{constructor(){this.normal=new z;this.point=new z;this.separation=0}Initialize(d,n,u,C){const I=Nd.Initialize_s_pointA,L=Nd.Initialize_s_pointB,U=Nd.Initialize_s_planePoint,Z=Nd.Initialize_s_clipPoint;switch(d.type){case a.ManifoldType.e_circles:rb.MulXV(n,d.localPoint,I);rb.MulXV(u,d.localPoints[0],L);z.SubVV(L,I,this.normal).SelfNormalize();z.MidVV(I,L,this.point);this.separation=z.DotVV(z.SubVV(L,I,z.s_t0),this.normal)-d.radiusA-d.radiusB;break;case a.ManifoldType.e_faceA:ib.MulRV(n.q,
d.localNormal,this.normal);rb.MulXV(n,d.localPoint,U);rb.MulXV(u,d.localPoints[C],Z);this.separation=z.DotVV(z.SubVV(Z,U,z.s_t0),this.normal)-d.radiusA-d.radiusB;this.point.Copy(Z);break;case a.ManifoldType.e_faceB:ib.MulRV(u.q,d.localNormal,this.normal),rb.MulXV(u,d.localPoint,U),rb.MulXV(n,d.localPoints[C],Z),this.separation=z.DotVV(z.SubVV(Z,U,z.s_t0),this.normal)-d.radiusA-d.radiusB,this.point.Copy(Z),this.normal.SelfNeg()}}}Nd.Initialize_s_pointA=new z;Nd.Initialize_s_pointB=new z;Nd.Initialize_s_planePoint=
new z;Nd.Initialize_s_clipPoint=new z;class bc{constructor(){this.m_step=new He;this.m_positionConstraints=gg.MakeArray(1024);this.m_velocityConstraints=fg.MakeArray(1024);this.m_count=0}Initialize(d){this.m_step.Copy(d.step);this.m_count=d.count;if(this.m_positionConstraints.length<this.m_count)for(var n=h(2*this.m_positionConstraints.length,this.m_count);this.m_positionConstraints.length<n;)this.m_positionConstraints[this.m_positionConstraints.length]=new gg;if(this.m_velocityConstraints.length<
this.m_count)for(n=h(2*this.m_velocityConstraints.length,this.m_count);this.m_velocityConstraints.length<n;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new fg;this.m_positions=d.positions;this.m_velocities=d.velocities;this.m_contacts=d.contacts;for(d=0;d<this.m_count;++d){n=this.m_contacts[d];var u=n.m_fixtureA,C=n.m_fixtureB,I=u.GetShape(),L=C.GetShape();I=I.m_radius;var U=L.m_radius,Z=u.GetBody();const ka=C.GetBody();C=n.GetManifold();u=C.pointCount;L=this.m_velocityConstraints[d];
L.friction=n.m_friction;L.restitution=n.m_restitution;L.threshold=n.m_restitutionThreshold;L.tangentSpeed=n.m_tangentSpeed;L.indexA=Z.m_islandIndex;L.indexB=ka.m_islandIndex;L.invMassA=Z.m_invMass;L.invMassB=ka.m_invMass;L.invIA=Z.m_invI;L.invIB=ka.m_invI;L.contactIndex=d;L.pointCount=u;L.K.SetZero();L.normalMass.SetZero();n=this.m_positionConstraints[d];n.indexA=Z.m_islandIndex;n.indexB=ka.m_islandIndex;n.invMassA=Z.m_invMass;n.invMassB=ka.m_invMass;n.localCenterA.Copy(Z.m_sweep.localCenter);n.localCenterB.Copy(ka.m_sweep.localCenter);
n.invIA=Z.m_invI;n.invIB=ka.m_invI;n.localNormal.Copy(C.localNormal);n.localPoint.Copy(C.localPoint);n.pointCount=u;n.radiusA=I;n.radiusB=U;n.type=C.type;for(I=0;I<u;++I)U=C.points[I],Z=L.points[I],this.m_step.warmStarting?(Z.normalImpulse=this.m_step.dtRatio*U.normalImpulse,Z.tangentImpulse=this.m_step.dtRatio*U.tangentImpulse):(Z.normalImpulse=0,Z.tangentImpulse=0),Z.rA.SetZero(),Z.rB.SetZero(),Z.normalMass=0,Z.tangentMass=0,Z.velocityBias=0,n.localPoints[I].Copy(U.localPoint)}return this}InitializeVelocityConstraints(){const d=
bc.InitializeVelocityConstraints_s_xfA,n=bc.InitializeVelocityConstraints_s_xfB,u=bc.InitializeVelocityConstraints_s_worldManifold;for(let Hb=0;Hb<this.m_count;++Hb){const Jb=this.m_velocityConstraints[Hb];var C=this.m_positionConstraints[Hb],I=C.radiusA,L=C.radiusB,U=this.m_contacts[Jb.contactIndex].GetManifold(),Z=Jb.indexA,ka=Jb.indexB,ia=Jb.invMassA;const Tb=Jb.invMassB,Vb=Jb.invIA,Qb=Jb.invIB;var ta=C.localCenterA;const fc=C.localCenterB;C=this.m_positions[Z].c;var Ja=this.m_velocities[Z].v,
Oa=this.m_velocities[Z].w,Xa=this.m_positions[ka].c;const cc=this.m_positions[ka].a;var zb=this.m_velocities[ka].v;ka=this.m_velocities[ka].w;d.q.SetAngle(this.m_positions[Z].a);n.q.SetAngle(cc);z.SubVV(C,ib.MulRV(d.q,ta,z.s_t0),d.p);z.SubVV(Xa,ib.MulRV(n.q,fc,z.s_t0),n.p);u.Initialize(U,d,I,n,L);Jb.normal.Copy(u.normal);z.CrossVOne(Jb.normal,Jb.tangent);I=Jb.pointCount;for(L=0;L<I;++L)U=Jb.points[L],z.SubVV(u.points[L],C,U.rA),z.SubVV(u.points[L],Xa,U.rB),Z=z.CrossVV(U.rA,Jb.normal),ta=z.CrossVV(U.rB,
Jb.normal),Z=ia+Tb+Vb*Z*Z+Qb*ta*ta,U.normalMass=0<Z?1/Z:0,ta=Jb.tangent,Z=z.CrossVV(U.rA,ta),ta=z.CrossVV(U.rB,ta),Z=ia+Tb+Vb*Z*Z+Qb*ta*ta,U.tangentMass=0<Z?1/Z:0,U.velocityBias=0,Z=z.DotVV(Jb.normal,z.SubVV(z.AddVCrossSV(zb,ka,U.rB,z.s_t0),z.AddVCrossSV(Ja,Oa,U.rA,z.s_t1),z.s_t0)),Z<-Jb.threshold&&(U.velocityBias+=-Jb.restitution*Z);2===Jb.pointCount&&a.blockSolve&&(Ja=Jb.points[0],Xa=Jb.points[1],C=z.CrossVV(Ja.rA,Jb.normal),Ja=z.CrossVV(Ja.rB,Jb.normal),Oa=z.CrossVV(Xa.rA,Jb.normal),ka=z.CrossVV(Xa.rB,
Jb.normal),Xa=ia+Tb+Vb*C*C+Qb*Ja*Ja,zb=ia+Tb+Vb*Oa*Oa+Qb*ka*ka,ia=ia+Tb+Vb*C*Oa+Qb*Ja*ka,Xa*Xa<1E3*(Xa*zb-ia*ia)?(Jb.K.ex.Set(Xa,ia),Jb.K.ey.Set(ia,zb),Jb.K.GetInverse(Jb.normalMass)):Jb.pointCount=1)}}WarmStart(){const d=bc.WarmStart_s_P;for(let n=0;n<this.m_count;++n){const u=this.m_velocityConstraints[n],C=u.indexA,I=u.indexB,L=u.invMassA,U=u.invIA,Z=u.invMassB,ka=u.invIB,ia=u.pointCount,ta=this.m_velocities[C].v;let Ja=this.m_velocities[C].w;const Oa=this.m_velocities[I].v;let Xa=this.m_velocities[I].w;
const zb=u.normal,Hb=u.tangent;for(let Jb=0;Jb<ia;++Jb){const Tb=u.points[Jb];z.AddVV(z.MulSV(Tb.normalImpulse,zb,z.s_t0),z.MulSV(Tb.tangentImpulse,Hb,z.s_t1),d);Ja-=U*z.CrossVV(Tb.rA,d);ta.SelfMulSub(L,d);Xa+=ka*z.CrossVV(Tb.rB,d);Oa.SelfMulAdd(Z,d)}this.m_velocities[C].w=Ja;this.m_velocities[I].w=Xa}}SolveVelocityConstraints(){const d=bc.SolveVelocityConstraints_s_dv,n=bc.SolveVelocityConstraints_s_dv1,u=bc.SolveVelocityConstraints_s_dv2,C=bc.SolveVelocityConstraints_s_P,I=bc.SolveVelocityConstraints_s_a,
L=bc.SolveVelocityConstraints_s_b,U=bc.SolveVelocityConstraints_s_x,Z=bc.SolveVelocityConstraints_s_d,ka=bc.SolveVelocityConstraints_s_P1,ia=bc.SolveVelocityConstraints_s_P2,ta=bc.SolveVelocityConstraints_s_P1P2;for(let Vb=0;Vb<this.m_count;++Vb){const Qb=this.m_velocityConstraints[Vb],fc=Qb.indexA,cc=Qb.indexB,jc=Qb.invMassA,mc=Qb.invIA,qc=Qb.invMassB,yc=Qb.invIB;var Ja=Qb.pointCount;const lc=this.m_velocities[fc].v;let nc=this.m_velocities[fc].w;const jd=this.m_velocities[cc].v;let vd=this.m_velocities[cc].w;
const qd=Qb.normal;var Oa=Qb.tangent,Xa=Qb.friction;for(var zb=0;zb<Ja;++zb){var Hb=Qb.points[zb];z.SubVV(z.AddVCrossSV(jd,vd,Hb.rB,z.s_t0),z.AddVCrossSV(lc,nc,Hb.rA,z.s_t1),d);var Jb=z.DotVV(d,Oa)-Qb.tangentSpeed;Jb=Hb.tangentMass*-Jb;var Tb=Xa*Hb.normalImpulse;Tb=g(Hb.tangentImpulse+Jb,-Tb,Tb);Jb=Tb-Hb.tangentImpulse;Hb.tangentImpulse=Tb;z.MulSV(Jb,Oa,C);lc.SelfMulSub(jc,C);nc-=mc*z.CrossVV(Hb.rA,C);jd.SelfMulAdd(qc,C);vd+=yc*z.CrossVV(Hb.rB,C)}if(1===Qb.pointCount||!1===a.blockSolve)for(Oa=0;Oa<
Ja;++Oa)Xa=Qb.points[Oa],z.SubVV(z.AddVCrossSV(jd,vd,Xa.rB,z.s_t0),z.AddVCrossSV(lc,nc,Xa.rA,z.s_t1),d),zb=z.DotVV(d,qd),zb=-Xa.normalMass*(zb-Xa.velocityBias),Hb=h(Xa.normalImpulse+zb,0),zb=Hb-Xa.normalImpulse,Xa.normalImpulse=Hb,z.MulSV(zb,qd,C),lc.SelfMulSub(jc,C),nc-=mc*z.CrossVV(Xa.rA,C),jd.SelfMulAdd(qc,C),vd+=yc*z.CrossVV(Xa.rB,C);else for(Ja=Qb.points[0],Oa=Qb.points[1],I.Set(Ja.normalImpulse,Oa.normalImpulse),z.SubVV(z.AddVCrossSV(jd,vd,Ja.rB,z.s_t0),z.AddVCrossSV(lc,nc,Ja.rA,z.s_t1),n),
z.SubVV(z.AddVCrossSV(jd,vd,Oa.rB,z.s_t0),z.AddVCrossSV(lc,nc,Oa.rA,z.s_t1),u),Xa=z.DotVV(n,qd),zb=z.DotVV(u,qd),L.x=Xa-Ja.velocityBias,L.y=zb-Oa.velocityBias,L.SelfSub(Fb.MulMV(Qb.K,I,z.s_t0));;){Fb.MulMV(Qb.normalMass,L,U).SelfNeg();if(0<=U.x&&0<=U.y){z.SubVV(U,I,Z);z.MulSV(Z.x,qd,ka);z.MulSV(Z.y,qd,ia);z.AddVV(ka,ia,ta);lc.SelfMulSub(jc,ta);nc-=mc*(z.CrossVV(Ja.rA,ka)+z.CrossVV(Oa.rA,ia));jd.SelfMulAdd(qc,ta);vd+=yc*(z.CrossVV(Ja.rB,ka)+z.CrossVV(Oa.rB,ia));Ja.normalImpulse=U.x;Oa.normalImpulse=
U.y;break}U.x=-Ja.normalMass*L.x;U.y=0;zb=Qb.K.ex.y*U.x+L.y;if(0<=U.x&&0<=zb){z.SubVV(U,I,Z);z.MulSV(Z.x,qd,ka);z.MulSV(Z.y,qd,ia);z.AddVV(ka,ia,ta);lc.SelfMulSub(jc,ta);nc-=mc*(z.CrossVV(Ja.rA,ka)+z.CrossVV(Oa.rA,ia));jd.SelfMulAdd(qc,ta);vd+=yc*(z.CrossVV(Ja.rB,ka)+z.CrossVV(Oa.rB,ia));Ja.normalImpulse=U.x;Oa.normalImpulse=U.y;break}U.x=0;U.y=-Oa.normalMass*L.y;Xa=Qb.K.ey.x*U.y+L.x;if(0<=U.y&&0<=Xa){z.SubVV(U,I,Z);z.MulSV(Z.x,qd,ka);z.MulSV(Z.y,qd,ia);z.AddVV(ka,ia,ta);lc.SelfMulSub(jc,ta);nc-=
mc*(z.CrossVV(Ja.rA,ka)+z.CrossVV(Oa.rA,ia));jd.SelfMulAdd(qc,ta);vd+=yc*(z.CrossVV(Ja.rB,ka)+z.CrossVV(Oa.rB,ia));Ja.normalImpulse=U.x;Oa.normalImpulse=U.y;break}U.x=0;U.y=0;Xa=L.x;zb=L.y;if(0<=Xa&&0<=zb){z.SubVV(U,I,Z);z.MulSV(Z.x,qd,ka);z.MulSV(Z.y,qd,ia);z.AddVV(ka,ia,ta);lc.SelfMulSub(jc,ta);nc-=mc*(z.CrossVV(Ja.rA,ka)+z.CrossVV(Oa.rA,ia));jd.SelfMulAdd(qc,ta);vd+=yc*(z.CrossVV(Ja.rB,ka)+z.CrossVV(Oa.rB,ia));Ja.normalImpulse=U.x;Oa.normalImpulse=U.y;break}break}this.m_velocities[fc].w=nc;this.m_velocities[cc].w=
vd}}StoreImpulses(){for(let d=0;d<this.m_count;++d){const n=this.m_velocityConstraints[d],u=this.m_contacts[n.contactIndex].GetManifold();for(let C=0;C<n.pointCount;++C)u.points[C].normalImpulse=n.points[C].normalImpulse,u.points[C].tangentImpulse=n.points[C].tangentImpulse}}SolvePositionConstraints(){const d=bc.SolvePositionConstraints_s_xfA,n=bc.SolvePositionConstraints_s_xfB,u=bc.SolvePositionConstraints_s_psm,C=bc.SolvePositionConstraints_s_rA,I=bc.SolvePositionConstraints_s_rB,L=bc.SolvePositionConstraints_s_P;
let U=0;for(let ia=0;ia<this.m_count;++ia){const ta=this.m_positionConstraints[ia],Ja=ta.indexA,Oa=ta.indexB,Xa=ta.localCenterA,zb=ta.invMassA,Hb=ta.invIA,Jb=ta.localCenterB,Tb=ta.invMassB,Vb=ta.invIB,Qb=ta.pointCount,fc=this.m_positions[Ja].c;let cc=this.m_positions[Ja].a;const jc=this.m_positions[Oa].c;let mc=this.m_positions[Oa].a;for(let qc=0;qc<Qb;++qc){d.q.SetAngle(cc);n.q.SetAngle(mc);z.SubVV(fc,ib.MulRV(d.q,Xa,z.s_t0),d.p);z.SubVV(jc,ib.MulRV(n.q,Jb,z.s_t0),n.p);u.Initialize(ta,d,n,qc);const yc=
u.normal;var Z=u.point,ka=u.separation;z.SubVV(Z,fc,C);z.SubVV(Z,jc,I);U=f(U,ka);Z=g(.2*(ka+.005),-.2,0);ka=z.CrossVV(C,yc);const lc=z.CrossVV(I,yc);ka=zb+Tb+Hb*ka*ka+Vb*lc*lc;z.MulSV(0<ka?-Z/ka:0,yc,L);fc.SelfMulSub(zb,L);cc-=Hb*z.CrossVV(C,L);jc.SelfMulAdd(Tb,L);mc+=Vb*z.CrossVV(I,L)}this.m_positions[Ja].a=cc;this.m_positions[Oa].a=mc}return-.015<U}SolveTOIPositionConstraints(d,n){const u=bc.SolveTOIPositionConstraints_s_xfA,C=bc.SolveTOIPositionConstraints_s_xfB,I=bc.SolveTOIPositionConstraints_s_psm,
L=bc.SolveTOIPositionConstraints_s_rA,U=bc.SolveTOIPositionConstraints_s_rB,Z=bc.SolveTOIPositionConstraints_s_P;let ka=0;for(let Ja=0;Ja<this.m_count;++Ja){const Oa=this.m_positionConstraints[Ja],Xa=Oa.indexA,zb=Oa.indexB,Hb=Oa.localCenterA,Jb=Oa.localCenterB,Tb=Oa.pointCount;let Vb=0,Qb=0;if(Xa===d||Xa===n)Vb=Oa.invMassA,Qb=Oa.invIA;let fc=0,cc=0;if(zb===d||zb===n)fc=Oa.invMassB,cc=Oa.invIB;const jc=this.m_positions[Xa].c;let mc=this.m_positions[Xa].a;const qc=this.m_positions[zb].c;let yc=this.m_positions[zb].a;
for(let lc=0;lc<Tb;++lc){u.q.SetAngle(mc);C.q.SetAngle(yc);z.SubVV(jc,ib.MulRV(u.q,Hb,z.s_t0),u.p);z.SubVV(qc,ib.MulRV(C.q,Jb,z.s_t0),C.p);I.Initialize(Oa,u,C,lc);const nc=I.normal;var ia=I.point,ta=I.separation;z.SubVV(ia,jc,L);z.SubVV(ia,qc,U);ka=f(ka,ta);ia=g(.75*(ta+.005),-.2,0);ta=z.CrossVV(L,nc);const jd=z.CrossVV(U,nc);ta=Vb+fc+Qb*ta*ta+cc*jd*jd;z.MulSV(0<ta?-ia/ta:0,nc,Z);jc.SelfMulSub(Vb,Z);mc-=Qb*z.CrossVV(L,Z);qc.SelfMulAdd(fc,Z);yc+=cc*z.CrossVV(U,Z)}this.m_positions[Xa].a=mc;this.m_positions[zb].a=
yc}return-.0075<=ka}}bc.InitializeVelocityConstraints_s_xfA=new rb;bc.InitializeVelocityConstraints_s_xfB=new rb;bc.InitializeVelocityConstraints_s_worldManifold=new Ha;bc.WarmStart_s_P=new z;bc.SolveVelocityConstraints_s_dv=new z;bc.SolveVelocityConstraints_s_dv1=new z;bc.SolveVelocityConstraints_s_dv2=new z;bc.SolveVelocityConstraints_s_P=new z;bc.SolveVelocityConstraints_s_a=new z;bc.SolveVelocityConstraints_s_b=new z;bc.SolveVelocityConstraints_s_x=new z;bc.SolveVelocityConstraints_s_d=new z;
bc.SolveVelocityConstraints_s_P1=new z;bc.SolveVelocityConstraints_s_P2=new z;bc.SolveVelocityConstraints_s_P1P2=new z;bc.SolvePositionConstraints_s_xfA=new rb;bc.SolvePositionConstraints_s_xfB=new rb;bc.SolvePositionConstraints_s_psm=new Nd;bc.SolvePositionConstraints_s_rA=new z;bc.SolvePositionConstraints_s_rB=new z;bc.SolvePositionConstraints_s_P=new z;bc.SolveTOIPositionConstraints_s_xfA=new rb;bc.SolveTOIPositionConstraints_s_xfB=new rb;bc.SolveTOIPositionConstraints_s_psm=new Nd;bc.SolveTOIPositionConstraints_s_rA=
new z;bc.SolveTOIPositionConstraints_s_rB=new z;bc.SolveTOIPositionConstraints_s_P=new z;class Kl extends Dd{constructor(){super(a.JointType.e_frictionJoint);this.localAnchorA=new z;this.localAnchorB=new z;this.maxTorque=this.maxForce=0}Initialize(d,n,u){this.bodyA=d;this.bodyB=n;this.bodyA.GetLocalPoint(u,this.localAnchorA);this.bodyB.GetLocalPoint(u,this.localAnchorB)}}class ne extends $c{constructor(d){super(d);this.m_localAnchorA=new z;this.m_localAnchorB=new z;this.m_linearImpulse=new z;this.m_indexB=
this.m_indexA=this.m_maxTorque=this.m_maxForce=this.m_angularImpulse=0;this.m_rA=new z;this.m_rB=new z;this.m_localCenterA=new z;this.m_localCenterB=new z;this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0;this.m_linearMass=new Fb;this.m_angularMass=0;this.m_qA=new ib;this.m_qB=new ib;this.m_lalcA=new z;this.m_lalcB=new z;this.m_K=new Fb;this.m_localAnchorA.Copy(b(d.localAnchorA,z.ZERO));this.m_localAnchorB.Copy(b(d.localAnchorB,z.ZERO));this.m_linearImpulse.SetZero();this.m_maxForce=b(d.maxForce,
0);this.m_maxTorque=b(d.maxTorque,0);this.m_linearMass.SetZero()}InitVelocityConstraints(d){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;const n=d.velocities[this.m_indexA].v;let u=d.velocities[this.m_indexA].w;
var C=d.positions[this.m_indexB].a;const I=d.velocities[this.m_indexB].v;let L=d.velocities[this.m_indexB].w;var U=this.m_qA.SetAngle(d.positions[this.m_indexA].a);C=this.m_qB.SetAngle(C);z.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);U=ib.MulRV(U,this.m_lalcA,this.m_rA);z.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const Z=ib.MulRV(C,this.m_lalcB,this.m_rB);C=this.m_invMassA;const ka=this.m_invMassB,ia=this.m_invIA,ta=this.m_invIB,Ja=this.m_K;Ja.ex.x=C+ka+ia*U.y*U.y+
ta*Z.y*Z.y;Ja.ex.y=-ia*U.x*U.y-ta*Z.x*Z.y;Ja.ey.x=Ja.ex.y;Ja.ey.y=C+ka+ia*U.x*U.x+ta*Z.x*Z.x;Ja.GetInverse(this.m_linearMass);this.m_angularMass=ia+ta;0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass);d.step.warmStarting?(this.m_linearImpulse.SelfMul(d.step.dtRatio),this.m_angularImpulse*=d.step.dtRatio,U=this.m_linearImpulse,n.SelfMulSub(C,U),u-=ia*(z.CrossVV(this.m_rA,U)+this.m_angularImpulse),I.SelfMulAdd(ka,U),L+=ta*(z.CrossVV(this.m_rB,U)+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),
this.m_angularImpulse=0);d.velocities[this.m_indexA].w=u;d.velocities[this.m_indexB].w=L}SolveVelocityConstraints(d){const n=d.velocities[this.m_indexA].v;let u=d.velocities[this.m_indexA].w;const C=d.velocities[this.m_indexB].v;let I=d.velocities[this.m_indexB].w;const L=this.m_invMassA,U=this.m_invMassB,Z=this.m_invIA,ka=this.m_invIB;var ia=d.step.dt,ta=-this.m_angularMass*(I-u),Ja=this.m_angularImpulse;const Oa=ia*this.m_maxTorque;this.m_angularImpulse=g(this.m_angularImpulse+ta,-Oa,Oa);ta=this.m_angularImpulse-
Ja;u-=Z*ta;I+=ka*ta;ta=z.SubVV(z.AddVCrossSV(C,I,this.m_rB,z.s_t0),z.AddVCrossSV(n,u,this.m_rA,z.s_t1),ne.SolveVelocityConstraints_s_Cdot_v2);ta=Fb.MulMV(this.m_linearMass,ta,ne.SolveVelocityConstraints_s_impulseV).SelfNeg();Ja=ne.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(ta);ia*=this.m_maxForce;this.m_linearImpulse.LengthSquared()>ia*ia&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(ia));z.SubVV(this.m_linearImpulse,Ja,ta);n.SelfMulSub(L,
ta);u-=Z*z.CrossVV(this.m_rA,ta);C.SelfMulAdd(U,ta);I+=ka*z.CrossVV(this.m_rB,ta);d.velocities[this.m_indexA].w=u;d.velocities[this.m_indexB].w=I}SolvePositionConstraints(){return!0}GetAnchorA(d){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,d)}GetAnchorB(d){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,d)}GetReactionForce(d,n){n.x=d*this.m_linearImpulse.x;n.y=d*this.m_linearImpulse.y;return n}GetReactionTorque(d){return d*this.m_angularImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetMaxForce(d){this.m_maxForce=
d}GetMaxForce(){return this.m_maxForce}SetMaxTorque(d){this.m_maxTorque=d}GetMaxTorque(){return this.m_maxTorque}Dump(d){const n=this.m_bodyA.m_islandIndex,u=this.m_bodyB.m_islandIndex;d("  const jd: b2FrictionJointDef = new b2FrictionJointDef();\n");d("  jd.bodyA = bodies[%d];\n",n);d("  jd.bodyB = bodies[%d];\n",u);d("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false");d("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);d("  jd.localAnchorB.Set(%.15f, %.15f);\n",
this.m_localAnchorB.x,this.m_localAnchorB.y);d("  jd.maxForce = %.15f;\n",this.m_maxForce);d("  jd.maxTorque = %.15f;\n",this.m_maxTorque);d("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}ne.SolveVelocityConstraints_s_Cdot_v2=new z;ne.SolveVelocityConstraints_s_impulseV=new z;ne.SolveVelocityConstraints_s_oldImpulseV=new z;class Ll extends Dd{constructor(){super(a.JointType.e_gearJoint);this.ratio=1}}class Qc extends $c{constructor(d){super(d);this.m_typeB=this.m_typeA=a.JointType.e_unknownJoint;
this.m_localAnchorA=new z;this.m_localAnchorB=new z;this.m_localAnchorC=new z;this.m_localAnchorD=new z;this.m_localAxisC=new z;this.m_localAxisD=new z;this.m_indexD=this.m_indexC=this.m_indexB=this.m_indexA=this.m_impulse=this.m_ratio=this.m_constant=this.m_referenceAngleB=this.m_referenceAngleA=0;this.m_lcA=new z;this.m_lcB=new z;this.m_lcC=new z;this.m_lcD=new z;this.m_iD=this.m_iC=this.m_iB=this.m_iA=this.m_mD=this.m_mC=this.m_mB=this.m_mA=0;this.m_JvAC=new z;this.m_JvBD=new z;this.m_mass=this.m_JwD=
this.m_JwC=this.m_JwB=this.m_JwA=0;this.m_qA=new ib;this.m_qB=new ib;this.m_qC=new ib;this.m_qD=new ib;this.m_lalcA=new z;this.m_lalcB=new z;this.m_lalcC=new z;this.m_lalcD=new z;this.m_joint1=d.joint1;this.m_joint2=d.joint2;this.m_typeA=this.m_joint1.GetType();this.m_typeB=this.m_joint2.GetType();this.m_bodyC=this.m_joint1.GetBodyA();this.m_bodyA=this.m_joint1.GetBodyB();var n=this.m_bodyA.m_xf;var u=this.m_bodyA.m_sweep.a;var C=this.m_bodyC.m_xf;var I=this.m_bodyC.m_sweep.a;this.m_typeA===a.JointType.e_revoluteJoint?
(n=d.joint1,this.m_localAnchorC.Copy(n.m_localAnchorA),this.m_localAnchorA.Copy(n.m_localAnchorB),this.m_referenceAngleA=n.m_referenceAngle,this.m_localAxisC.SetZero(),n=u-I-this.m_referenceAngleA):(u=d.joint1,this.m_localAnchorC.Copy(u.m_localAnchorA),this.m_localAnchorA.Copy(u.m_localAnchorB),this.m_referenceAngleA=u.m_referenceAngle,this.m_localAxisC.Copy(u.m_localXAxisA),u=this.m_localAnchorC,n=ib.MulTRV(C.q,z.AddVV(ib.MulRV(n.q,this.m_localAnchorA,z.s_t0),z.SubVV(n.p,C.p,z.s_t1),z.s_t0),z.s_t0),
n=z.DotVV(z.SubVV(n,u,z.s_t0),this.m_localAxisC));this.m_bodyD=this.m_joint2.GetBodyA();this.m_bodyB=this.m_joint2.GetBodyB();C=this.m_bodyB.m_xf;I=this.m_bodyB.m_sweep.a;u=this.m_bodyD.m_xf;const L=this.m_bodyD.m_sweep.a;this.m_typeB===a.JointType.e_revoluteJoint?(C=d.joint2,this.m_localAnchorD.Copy(C.m_localAnchorA),this.m_localAnchorB.Copy(C.m_localAnchorB),this.m_referenceAngleB=C.m_referenceAngle,this.m_localAxisD.SetZero(),C=I-L-this.m_referenceAngleB):(I=d.joint2,this.m_localAnchorD.Copy(I.m_localAnchorA),
this.m_localAnchorB.Copy(I.m_localAnchorB),this.m_referenceAngleB=I.m_referenceAngle,this.m_localAxisD.Copy(I.m_localXAxisA),I=this.m_localAnchorD,C=ib.MulTRV(u.q,z.AddVV(ib.MulRV(C.q,this.m_localAnchorB,z.s_t0),z.SubVV(C.p,u.p,z.s_t1),z.s_t0),z.s_t0),C=z.DotVV(z.SubVV(C,I,z.s_t0),this.m_localAxisD));this.m_ratio=b(d.ratio,1);this.m_constant=n+this.m_ratio*C;this.m_impulse=0}InitVelocityConstraints(d){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_indexC=
this.m_bodyC.m_islandIndex;this.m_indexD=this.m_bodyD.m_islandIndex;this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter);this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter);this.m_mA=this.m_bodyA.m_invMass;this.m_mB=this.m_bodyB.m_invMass;this.m_mC=this.m_bodyC.m_invMass;this.m_mD=this.m_bodyD.m_invMass;this.m_iA=this.m_bodyA.m_invI;this.m_iB=this.m_bodyB.m_invI;this.m_iC=this.m_bodyC.m_invI;this.m_iD=this.m_bodyD.m_invI;
const n=d.velocities[this.m_indexA].v;let u=d.velocities[this.m_indexA].w;var C=d.positions[this.m_indexB].a;const I=d.velocities[this.m_indexB].v;let L=d.velocities[this.m_indexB].w;var U=d.positions[this.m_indexC].a;const Z=d.velocities[this.m_indexC].v;let ka=d.velocities[this.m_indexC].w;var ia=d.positions[this.m_indexD].a;const ta=d.velocities[this.m_indexD].v;let Ja=d.velocities[this.m_indexD].w;var Oa=this.m_qA.SetAngle(d.positions[this.m_indexA].a);C=this.m_qB.SetAngle(C);var Xa=this.m_qC.SetAngle(U);
ia=this.m_qD.SetAngle(ia);this.m_mass=0;this.m_typeA===a.JointType.e_revoluteJoint?(this.m_JvAC.SetZero(),this.m_JwC=this.m_JwA=1,this.m_mass+=this.m_iA+this.m_iC):(U=ib.MulRV(Xa,this.m_localAxisC,Qc.InitVelocityConstraints_s_u),z.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC),Xa=ib.MulRV(Xa,this.m_lalcC,Qc.InitVelocityConstraints_s_rC),z.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA),Oa=ib.MulRV(Oa,this.m_lalcA,Qc.InitVelocityConstraints_s_rA),this.m_JvAC.Copy(U),this.m_JwC=z.CrossVV(Xa,
U),this.m_JwA=z.CrossVV(Oa,U),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA);this.m_typeB===a.JointType.e_revoluteJoint?(this.m_JvBD.SetZero(),this.m_JwD=this.m_JwB=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD)):(Oa=ib.MulRV(ia,this.m_localAxisD,Qc.InitVelocityConstraints_s_u),z.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD),ia=ib.MulRV(ia,this.m_lalcD,Qc.InitVelocityConstraints_s_rD),z.SubVV(this.m_localAnchorB,this.m_lcB,
this.m_lalcB),C=ib.MulRV(C,this.m_lalcB,Qc.InitVelocityConstraints_s_rB),z.MulSV(this.m_ratio,Oa,this.m_JvBD),this.m_JwD=this.m_ratio*z.CrossVV(ia,Oa),this.m_JwB=this.m_ratio*z.CrossVV(C,Oa),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB);this.m_mass=0<this.m_mass?1/this.m_mass:0;d.step.warmStarting?(n.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),u+=this.m_iA*this.m_impulse*this.m_JwA,I.SelfMulAdd(this.m_mB*this.m_impulse,
this.m_JvBD),L+=this.m_iB*this.m_impulse*this.m_JwB,Z.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),ka-=this.m_iC*this.m_impulse*this.m_JwC,ta.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),Ja-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0;d.velocities[this.m_indexA].w=u;d.velocities[this.m_indexB].w=L;d.velocities[this.m_indexC].w=ka;d.velocities[this.m_indexD].w=Ja}SolveVelocityConstraints(d){const n=d.velocities[this.m_indexA].v;let u=d.velocities[this.m_indexA].w;const C=d.velocities[this.m_indexB].v;
let I=d.velocities[this.m_indexB].w;const L=d.velocities[this.m_indexC].v;let U=d.velocities[this.m_indexC].w;const Z=d.velocities[this.m_indexD].v;let ka=d.velocities[this.m_indexD].w;var ia=z.DotVV(this.m_JvAC,z.SubVV(n,L,z.s_t0))+z.DotVV(this.m_JvBD,z.SubVV(C,Z,z.s_t0));ia+=this.m_JwA*u-this.m_JwC*U+(this.m_JwB*I-this.m_JwD*ka);ia*=-this.m_mass;this.m_impulse+=ia;n.SelfMulAdd(this.m_mA*ia,this.m_JvAC);u+=this.m_iA*ia*this.m_JwA;C.SelfMulAdd(this.m_mB*ia,this.m_JvBD);I+=this.m_iB*ia*this.m_JwB;
L.SelfMulSub(this.m_mC*ia,this.m_JvAC);U-=this.m_iC*ia*this.m_JwC;Z.SelfMulSub(this.m_mD*ia,this.m_JvBD);ka-=this.m_iD*ia*this.m_JwD;d.velocities[this.m_indexA].w=u;d.velocities[this.m_indexB].w=I;d.velocities[this.m_indexC].w=U;d.velocities[this.m_indexD].w=ka}SolvePositionConstraints(d){const n=d.positions[this.m_indexA].c;let u=d.positions[this.m_indexA].a;const C=d.positions[this.m_indexB].c;let I=d.positions[this.m_indexB].a;const L=d.positions[this.m_indexC].c;let U=d.positions[this.m_indexC].a;
const Z=d.positions[this.m_indexD].c;let ka=d.positions[this.m_indexD].a;var ia=this.m_qA.SetAngle(u),ta=this.m_qB.SetAngle(I),Ja=this.m_qC.SetAngle(U),Oa=this.m_qD.SetAngle(ka);const Xa=this.m_JvAC,zb=this.m_JvBD;var Hb;let Jb=0;if(this.m_typeA===a.JointType.e_revoluteJoint){Xa.SetZero();var Tb=Hb=1;Jb+=this.m_iA+this.m_iC;Ja=u-U-this.m_referenceAngleA}else{Hb=ib.MulRV(Ja,this.m_localAxisC,Qc.SolvePositionConstraints_s_u);Tb=ib.MulRV(Ja,this.m_lalcC,Qc.SolvePositionConstraints_s_rC);ia=ib.MulRV(ia,
this.m_lalcA,Qc.SolvePositionConstraints_s_rA);Xa.Copy(Hb);Tb=z.CrossVV(Tb,Hb);Hb=z.CrossVV(ia,Hb);Jb+=this.m_mC+this.m_mA+this.m_iC*Tb*Tb+this.m_iA*Hb*Hb;var Vb=this.m_lalcC;Ja=ib.MulTRV(Ja,z.AddVV(ia,z.SubVV(n,L,z.s_t0),z.s_t0),z.s_t0);Ja=z.DotVV(z.SubVV(Ja,Vb,z.s_t0),this.m_localAxisC)}if(this.m_typeB===a.JointType.e_revoluteJoint)zb.SetZero(),ta=ia=this.m_ratio,Jb+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),Oa=I-ka-this.m_referenceAngleB;else{ia=ib.MulRV(Oa,this.m_localAxisD,Qc.SolvePositionConstraints_s_u);
var Qb=ib.MulRV(Oa,this.m_lalcD,Qc.SolvePositionConstraints_s_rD);Vb=ib.MulRV(ta,this.m_lalcB,Qc.SolvePositionConstraints_s_rB);z.MulSV(this.m_ratio,ia,zb);ta=this.m_ratio*z.CrossVV(Qb,ia);ia=this.m_ratio*z.CrossVV(Vb,ia);Jb+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*ta*ta+this.m_iB*ia*ia;Qb=this.m_lalcD;Oa=ib.MulTRV(Oa,z.AddVV(Vb,z.SubVV(C,Z,z.s_t0),z.s_t0),z.s_t0);Oa=z.DotVV(z.SubVV(Oa,Qb,z.s_t0),this.m_localAxisD)}Oa=Ja+this.m_ratio*Oa-this.m_constant;Ja=0;0<Jb&&(Ja=-Oa/Jb);n.SelfMulAdd(this.m_mA*
Ja,Xa);u+=this.m_iA*Ja*Hb;C.SelfMulAdd(this.m_mB*Ja,zb);I+=this.m_iB*Ja*ia;L.SelfMulSub(this.m_mC*Ja,Xa);U-=this.m_iC*Ja*Tb;Z.SelfMulSub(this.m_mD*Ja,zb);ka-=this.m_iD*Ja*ta;d.positions[this.m_indexA].a=u;d.positions[this.m_indexB].a=I;d.positions[this.m_indexC].a=U;d.positions[this.m_indexD].a=ka;return!0}GetAnchorA(d){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,d)}GetAnchorB(d){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,d)}GetReactionForce(d,n){return z.MulSV(d*this.m_impulse,
this.m_JvAC,n)}GetReactionTorque(d){return d*this.m_impulse*this.m_JwA}GetJoint1(){return this.m_joint1}GetJoint2(){return this.m_joint2}GetRatio(){return this.m_ratio}SetRatio(d){this.m_ratio=d}Dump(d){const n=this.m_bodyA.m_islandIndex,u=this.m_bodyB.m_islandIndex,C=this.m_joint1.m_index,I=this.m_joint2.m_index;d("  const jd: b2GearJointDef = new b2GearJointDef();\n");d("  jd.bodyA = bodies[%d];\n",n);d("  jd.bodyB = bodies[%d];\n",u);d("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":
"false");d("  jd.joint1 = joints[%d];\n",C);d("  jd.joint2 = joints[%d];\n",I);d("  jd.ratio = %.15f;\n",this.m_ratio);d("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}Qc.InitVelocityConstraints_s_u=new z;Qc.InitVelocityConstraints_s_rA=new z;Qc.InitVelocityConstraints_s_rB=new z;Qc.InitVelocityConstraints_s_rC=new z;Qc.InitVelocityConstraints_s_rD=new z;Qc.SolvePositionConstraints_s_u=new z;Qc.SolvePositionConstraints_s_rA=new z;Qc.SolvePositionConstraints_s_rB=new z;Qc.SolvePositionConstraints_s_rC=
new z;Qc.SolvePositionConstraints_s_rD=new z;class kd{constructor(){this.m_bodies=[];this.m_contacts=[];this.m_joints=[];this.m_positions=dg.MakeArray(1024);this.m_velocities=eg.MakeArray(1024);this.m_jointCapacity=this.m_contactCapacity=this.m_bodyCapacity=this.m_contactCount=this.m_jointCount=this.m_bodyCount=0}Initialize(d,n,u,C){this.m_bodyCapacity=d;this.m_contactCapacity=n;this.m_jointCapacity=u;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_listener=C;if(this.m_positions.length<
d)for(n=h(2*this.m_positions.length,d);this.m_positions.length<n;)this.m_positions[this.m_positions.length]=new dg;if(this.m_velocities.length<d)for(d=h(2*this.m_velocities.length,d);this.m_velocities.length<d;)this.m_velocities[this.m_velocities.length]=new eg}Clear(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0}AddBody(d){d.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=d}AddContact(d){this.m_contacts[this.m_contactCount++]=d}AddJoint(d){this.m_joints[this.m_jointCount++]=
d}Solve(d,n,u,C){var I=kd.s_timer.Reset(),L=n.dt;for(var U=0;U<this.m_bodyCount;++U){var Z=this.m_bodies[U];this.m_positions[U].c.Copy(Z.m_sweep.c);var ka=Z.m_sweep.a,ia=this.m_velocities[U].v.Copy(Z.m_linearVelocity),ta=Z.m_angularVelocity;Z.m_sweep.c0.Copy(Z.m_sweep.c);Z.m_sweep.a0=Z.m_sweep.a;Z.m_type===a.BodyType.b2_dynamicBody&&(ia.x+=L*Z.m_invMass*(Z.m_gravityScale*Z.m_mass*u.x+Z.m_force.x),ia.y+=L*Z.m_invMass*(Z.m_gravityScale*Z.m_mass*u.y+Z.m_force.y),ta+=L*Z.m_invI*Z.m_torque,ia.SelfMul(1/
(1+L*Z.m_linearDamping)),ta*=1/(1+L*Z.m_angularDamping));this.m_positions[U].a=ka;this.m_velocities[U].w=ta}I.Reset();U=kd.s_solverData;U.step.Copy(n);U.positions=this.m_positions;U.velocities=this.m_velocities;u=kd.s_contactSolverDef;u.step.Copy(n);u.contacts=this.m_contacts;u.count=this.m_contactCount;u.positions=this.m_positions;u.velocities=this.m_velocities;u=kd.s_contactSolver.Initialize(u);u.InitializeVelocityConstraints();n.warmStarting&&u.WarmStart();for(Z=0;Z<this.m_jointCount;++Z)this.m_joints[Z].InitVelocityConstraints(U);
d.solveInit=I.GetMilliseconds();I.Reset();for(Z=0;Z<n.velocityIterations;++Z){for(ka=0;ka<this.m_jointCount;++ka)this.m_joints[ka].SolveVelocityConstraints(U);u.SolveVelocityConstraints()}u.StoreImpulses();d.solveVelocity=I.GetMilliseconds();for(Z=0;Z<this.m_bodyCount;++Z){ka=this.m_positions[Z].c;ia=this.m_positions[Z].a;ta=this.m_velocities[Z].v;var Ja=this.m_velocities[Z].w,Oa=z.MulSV(L,ta,kd.s_translation);4<z.DotVV(Oa,Oa)&&(Oa=2/Oa.Length(),ta.SelfMul(Oa));Oa=L*Ja;2.4674011002726646<Oa*Oa&&(Oa=
1.570796326795/eb(Oa),Ja*=Oa);ka.x+=L*ta.x;ka.y+=L*ta.y;ia+=L*Ja;this.m_positions[Z].a=ia;this.m_velocities[Z].w=Ja}I.Reset();Z=!1;for(ka=0;ka<n.positionIterations;++ka){ia=u.SolvePositionConstraints();ta=!0;for(Ja=0;Ja<this.m_jointCount;++Ja)Oa=this.m_joints[Ja].SolvePositionConstraints(U),ta=ta&&Oa;if(ia&&ta){Z=!0;break}}for(n=0;n<this.m_bodyCount;++n)U=this.m_bodies[n],U.m_sweep.c.Copy(this.m_positions[n].c),U.m_sweep.a=this.m_positions[n].a,U.m_linearVelocity.Copy(this.m_velocities[n].v),U.m_angularVelocity=
this.m_velocities[n].w,U.SynchronizeTransform();d.solvePosition=I.GetMilliseconds();this.Report(u.m_velocityConstraints);if(C){d=1E37;C=ca*ca;for(I=0;I<this.m_bodyCount;++I)n=this.m_bodies[I],n.GetType()!==a.BodyType.b2_staticBody&&(!n.m_autoSleepFlag||n.m_angularVelocity*n.m_angularVelocity>C||1E-4<z.DotVV(n.m_linearVelocity,n.m_linearVelocity)?d=n.m_sleepTime=0:(n.m_sleepTime+=L,d=f(d,n.m_sleepTime)));if(.5<=d&&Z)for(L=0;L<this.m_bodyCount;++L)this.m_bodies[L].SetAwake(!1)}}SolveTOI(d,n,u){for(var C=
0;C<this.m_bodyCount;++C){var I=this.m_bodies[C];this.m_positions[C].c.Copy(I.m_sweep.c);this.m_positions[C].a=I.m_sweep.a;this.m_velocities[C].v.Copy(I.m_linearVelocity);this.m_velocities[C].w=I.m_angularVelocity}C=kd.s_contactSolverDef;C.contacts=this.m_contacts;C.count=this.m_contactCount;C.step.Copy(d);C.positions=this.m_positions;C.velocities=this.m_velocities;C=kd.s_contactSolver.Initialize(C);for(I=0;I<d.positionIterations&&!C.SolveTOIPositionConstraints(n,u);++I);this.m_bodies[n].m_sweep.c0.Copy(this.m_positions[n].c);
this.m_bodies[n].m_sweep.a0=this.m_positions[n].a;this.m_bodies[u].m_sweep.c0.Copy(this.m_positions[u].c);this.m_bodies[u].m_sweep.a0=this.m_positions[u].a;C.InitializeVelocityConstraints();for(n=0;n<d.velocityIterations;++n)C.SolveVelocityConstraints();d=d.dt;for(n=0;n<this.m_bodyCount;++n){u=this.m_positions[n].c;I=this.m_positions[n].a;const U=this.m_velocities[n].v;let Z=this.m_velocities[n].w;var L=z.MulSV(d,U,kd.s_translation);4<z.DotVV(L,L)&&(L=2/L.Length(),U.SelfMul(L));L=d*Z;2.4674011002726646<
L*L&&(L=1.570796326795/eb(L),Z*=L);u.SelfMulAdd(d,U);I+=d*Z;this.m_positions[n].a=I;this.m_velocities[n].w=Z;L=this.m_bodies[n];L.m_sweep.c.Copy(u);L.m_sweep.a=I;L.m_linearVelocity.Copy(U);L.m_angularVelocity=Z;L.SynchronizeTransform()}this.Report(C.m_velocityConstraints)}Report(d){if(null!==this.m_listener)for(let n=0;n<this.m_contactCount;++n){const u=this.m_contacts[n];if(!u)continue;const C=d[n],I=kd.s_impulse;I.count=C.pointCount;for(let L=0;L<C.pointCount;++L)I.normalImpulses[L]=C.points[L].normalImpulse,
I.tangentImpulses[L]=C.points[L].tangentImpulse;this.m_listener.PostSolve(u,I)}}}kd.s_timer=new J;kd.s_solverData=new ti;kd.s_contactSolverDef=new ui;kd.s_contactSolver=new bc;kd.s_translation=new z;kd.s_impulse=new qi;class Ml extends Dd{constructor(){super(a.JointType.e_motorJoint);this.linearOffset=new z(0,0);this.angularOffset=0;this.maxTorque=this.maxForce=1;this.correctionFactor=.3}Initialize(d,n){this.bodyA=d;this.bodyB=n;this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);
d=this.bodyA.GetAngle();this.angularOffset=this.bodyB.GetAngle()-d}}class oe extends $c{constructor(d){super(d);this.m_linearOffset=new z;this.m_angularOffset=0;this.m_linearImpulse=new z;this.m_maxTorque=this.m_maxForce=this.m_angularImpulse=0;this.m_correctionFactor=.3;this.m_indexB=this.m_indexA=0;this.m_rA=new z;this.m_rB=new z;this.m_localCenterA=new z;this.m_localCenterB=new z;this.m_linearError=new z;this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=this.m_angularError=0;this.m_linearMass=
new Fb;this.m_angularMass=0;this.m_qA=new ib;this.m_qB=new ib;this.m_K=new Fb;this.m_linearOffset.Copy(b(d.linearOffset,z.ZERO));this.m_linearImpulse.SetZero();this.m_maxForce=b(d.maxForce,0);this.m_maxTorque=b(d.maxTorque,0);this.m_correctionFactor=b(d.correctionFactor,.3)}GetAnchorA(d){const n=this.m_bodyA.GetPosition();d.x=n.x;d.y=n.y;return d}GetAnchorB(d){const n=this.m_bodyB.GetPosition();d.x=n.x;d.y=n.y;return d}GetReactionForce(d,n){return z.MulSV(d,this.m_linearImpulse,n)}GetReactionTorque(d){return d*
this.m_angularImpulse}SetLinearOffset(d){z.IsEqualToV(d,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(d))}GetLinearOffset(){return this.m_linearOffset}SetAngularOffset(d){d!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=d)}GetAngularOffset(){return this.m_angularOffset}SetMaxForce(d){this.m_maxForce=d}GetMaxForce(){return this.m_maxForce}SetMaxTorque(d){this.m_maxTorque=d}GetMaxTorque(){return this.m_maxTorque}InitVelocityConstraints(d){this.m_indexA=
this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var n=d.positions[this.m_indexA].c;const u=d.positions[this.m_indexA].a,C=d.velocities[this.m_indexA].v;let I=d.velocities[this.m_indexA].w;const L=d.positions[this.m_indexB].c,
U=d.positions[this.m_indexB].a,Z=d.velocities[this.m_indexB].v;let ka=d.velocities[this.m_indexB].w;var ia=this.m_qA.SetAngle(u),ta=this.m_qB.SetAngle(U);ia=ib.MulRV(ia,z.SubVV(this.m_linearOffset,this.m_localCenterA,z.s_t0),this.m_rA);ta=ib.MulRV(ta,z.NegV(this.m_localCenterB,z.s_t0),this.m_rB);const Ja=this.m_invMassA,Oa=this.m_invMassB,Xa=this.m_invIA,zb=this.m_invIB,Hb=this.m_K;Hb.ex.x=Ja+Oa+Xa*ia.y*ia.y+zb*ta.y*ta.y;Hb.ex.y=-Xa*ia.x*ia.y-zb*ta.x*ta.y;Hb.ey.x=Hb.ex.y;Hb.ey.y=Ja+Oa+Xa*ia.x*ia.x+
zb*ta.x*ta.x;Hb.GetInverse(this.m_linearMass);this.m_angularMass=Xa+zb;0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass);z.SubVV(z.AddVV(L,ta,z.s_t0),z.AddVV(n,ia,z.s_t1),this.m_linearError);this.m_angularError=U-u-this.m_angularOffset;d.step.warmStarting?(this.m_linearImpulse.SelfMul(d.step.dtRatio),this.m_angularImpulse*=d.step.dtRatio,n=this.m_linearImpulse,C.SelfMulSub(Ja,n),I-=Xa*(z.CrossVV(ia,n)+this.m_angularImpulse),Z.SelfMulAdd(Oa,n),ka+=zb*(z.CrossVV(ta,n)+this.m_angularImpulse)):
(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0);d.velocities[this.m_indexA].w=I;d.velocities[this.m_indexB].w=ka}SolveVelocityConstraints(d){const n=d.velocities[this.m_indexA].v;let u=d.velocities[this.m_indexA].w;const C=d.velocities[this.m_indexB].v;let I=d.velocities[this.m_indexB].w;const L=this.m_invMassA,U=this.m_invMassB,Z=this.m_invIA,ka=this.m_invIB;var ia=d.step.dt,ta=d.step.inv_dt,Ja=-this.m_angularMass*(I-u+ta*this.m_correctionFactor*this.m_angularError),Oa=this.m_angularImpulse,
Xa=ia*this.m_maxTorque;this.m_angularImpulse=g(this.m_angularImpulse+Ja,-Xa,Xa);Ja=this.m_angularImpulse-Oa;u-=Z*Ja;I+=ka*Ja;Ja=this.m_rA;Oa=this.m_rB;ta=z.AddVV(z.SubVV(z.AddVV(C,z.CrossSV(I,Oa,z.s_t0),z.s_t0),z.AddVV(n,z.CrossSV(u,Ja,z.s_t1),z.s_t1),z.s_t2),z.MulSV(ta*this.m_correctionFactor,this.m_linearError,z.s_t3),oe.SolveVelocityConstraints_s_Cdot_v2);ta=Fb.MulMV(this.m_linearMass,ta,oe.SolveVelocityConstraints_s_impulse_v2).SelfNeg();Xa=oe.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);
this.m_linearImpulse.SelfAdd(ta);ia*=this.m_maxForce;this.m_linearImpulse.LengthSquared()>ia*ia&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(ia));z.SubVV(this.m_linearImpulse,Xa,ta);n.SelfMulSub(L,ta);u-=Z*z.CrossVV(Ja,ta);C.SelfMulAdd(U,ta);I+=ka*z.CrossVV(Oa,ta);d.velocities[this.m_indexA].w=u;d.velocities[this.m_indexB].w=I}SolvePositionConstraints(){return!0}Dump(d){const n=this.m_bodyA.m_islandIndex,u=this.m_bodyB.m_islandIndex;d("  const jd: b2MotorJointDef = new b2MotorJointDef();\n");
d("  jd.bodyA = bodies[%d];\n",n);d("  jd.bodyB = bodies[%d];\n",u);d("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false");d("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y);d("  jd.angularOffset = %.15f;\n",this.m_angularOffset);d("  jd.maxForce = %.15f;\n",this.m_maxForce);d("  jd.maxTorque = %.15f;\n",this.m_maxTorque);d("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor);d("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}
oe.SolveVelocityConstraints_s_Cdot_v2=new z;oe.SolveVelocityConstraints_s_impulse_v2=new z;oe.SolveVelocityConstraints_s_oldImpulse_v2=new z;class Nl extends Dd{constructor(){super(a.JointType.e_mouseJoint);this.target=new z;this.maxForce=0;this.stiffness=5;this.damping=.7}}class pe extends $c{constructor(d){super(d);this.m_localAnchorB=new z;this.m_targetA=new z;this.m_beta=this.m_damping=this.m_stiffness=0;this.m_impulse=new z;this.m_indexB=this.m_indexA=this.m_gamma=this.m_maxForce=0;this.m_rB=
new z;this.m_localCenterB=new z;this.m_invIB=this.m_invMassB=0;this.m_mass=new Fb;this.m_C=new z;this.m_qB=new ib;this.m_lalcB=new z;this.m_K=new Fb;this.m_targetA.Copy(b(d.target,z.ZERO));rb.MulTXV(this.m_bodyB.GetTransform(),this.m_targetA,this.m_localAnchorB);this.m_maxForce=b(d.maxForce,0);this.m_impulse.SetZero();this.m_stiffness=b(d.stiffness,0);this.m_damping=b(d.damping,0);this.m_gamma=this.m_beta=0}SetTarget(d){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0);this.m_targetA.Copy(d)}GetTarget(){return this.m_targetA}SetMaxForce(d){this.m_maxForce=
d}GetMaxForce(){return this.m_maxForce}SetStiffness(d){this.m_stiffness=d}GetStiffness(){return this.m_stiffness}SetDamping(d){this.m_damping=d}GetDamping(){return this.m_damping}InitVelocityConstraints(d){this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIB=this.m_bodyB.m_invI;const n=d.positions[this.m_indexB].c,u=d.velocities[this.m_indexB].v;let C=d.velocities[this.m_indexB].w;var I=this.m_qB.SetAngle(d.positions[this.m_indexB].a);
const L=this.m_bodyB.GetMass(),U=6.28318530718*this.m_stiffness,Z=L*U*U,ka=d.step.dt;this.m_gamma=ka*(2*L*this.m_damping*U+ka*Z);0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma);this.m_beta=ka*Z*this.m_gamma;z.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);ib.MulRV(I,this.m_lalcB,this.m_rB);I=this.m_K;I.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma;I.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y;I.ey.x=I.ex.y;I.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+
this.m_gamma;I.GetInverse(this.m_mass);this.m_C.x=n.x+this.m_rB.x-this.m_targetA.x;this.m_C.y=n.y+this.m_rB.y-this.m_targetA.y;this.m_C.SelfMul(this.m_beta);C*=.98;d.step.warmStarting?(this.m_impulse.SelfMul(d.step.dtRatio),u.x+=this.m_invMassB*this.m_impulse.x,u.y+=this.m_invMassB*this.m_impulse.y,C+=this.m_invIB*z.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero();d.velocities[this.m_indexB].w=C}SolveVelocityConstraints(d){const n=d.velocities[this.m_indexB].v;let u=d.velocities[this.m_indexB].w;
var C=z.AddVCrossSV(n,u,this.m_rB,pe.SolveVelocityConstraints_s_Cdot);C=Fb.MulMV(this.m_mass,z.AddVV(C,z.AddVV(this.m_C,z.MulSV(this.m_gamma,this.m_impulse,z.s_t0),z.s_t0),z.s_t0).SelfNeg(),pe.SolveVelocityConstraints_s_impulse);const I=pe.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(C);const L=d.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>L*L&&this.m_impulse.SelfMul(L/this.m_impulse.Length());z.SubVV(this.m_impulse,I,C);n.SelfMulAdd(this.m_invMassB,
C);u+=this.m_invIB*z.CrossVV(this.m_rB,C);d.velocities[this.m_indexB].w=u}SolvePositionConstraints(){return!0}GetAnchorA(d){d.x=this.m_targetA.x;d.y=this.m_targetA.y;return d}GetAnchorB(d){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,d)}GetReactionForce(d,n){return z.MulSV(d,this.m_impulse,n)}GetReactionTorque(){return 0}Dump(d){d("Mouse joint dumping is not supported.\n")}ShiftOrigin(d){this.m_targetA.SelfSub(d)}}pe.SolveVelocityConstraints_s_Cdot=new z;pe.SolveVelocityConstraints_s_impulse=
new z;pe.SolveVelocityConstraints_s_oldImpulse=new z;class Ol extends Dd{constructor(){super(a.JointType.e_prismaticJoint);this.localAnchorA=new z;this.localAnchorB=new z;this.localAxisA=new z(1,0);this.referenceAngle=0;this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0}Initialize(d,n,u,C){this.bodyA=d;this.bodyB=n;this.bodyA.GetLocalPoint(u,this.localAnchorA);this.bodyB.GetLocalPoint(u,this.localAnchorB);this.bodyA.GetLocalVector(C,
this.localAxisA);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}class gc extends $c{constructor(d){super(d);this.m_localAnchorA=new z;this.m_localAnchorB=new z;this.m_localXAxisA=new z;this.m_localYAxisA=new z;this.m_referenceAngle=0;this.m_impulse=new z(0,0);this.m_motorSpeed=this.m_maxMotorForce=this.m_upperTranslation=this.m_lowerTranslation=this.m_upperImpulse=this.m_lowerImpulse=this.m_motorImpulse=0;this.m_enableMotor=this.m_enableLimit=!1;this.m_indexB=this.m_indexA=0;this.m_localCenterA=
new z;this.m_localCenterB=new z;this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0;this.m_axis=new z(0,0);this.m_perp=new z(0,0);this.m_a2=this.m_a1=this.m_s2=this.m_s1=0;this.m_K=new Fb;this.m_K3=new Wb;this.m_K2=new Fb;this.m_axialMass=this.m_translation=0;this.m_qA=new ib;this.m_qB=new ib;this.m_lalcA=new z;this.m_lalcB=new z;this.m_rA=new z;this.m_rB=new z;this.m_localAnchorA.Copy(b(d.localAnchorA,z.ZERO));this.m_localAnchorB.Copy(b(d.localAnchorB,z.ZERO));this.m_localXAxisA.Copy(b(d.localAxisA,
new z(1,0))).SelfNormalize();z.CrossOneV(this.m_localXAxisA,this.m_localYAxisA);this.m_referenceAngle=b(d.referenceAngle,0);this.m_lowerTranslation=b(d.lowerTranslation,0);this.m_upperTranslation=b(d.upperTranslation,0);this.m_maxMotorForce=b(d.maxMotorForce,0);this.m_motorSpeed=b(d.motorSpeed,0);this.m_enableLimit=b(d.enableLimit,!1);this.m_enableMotor=b(d.enableMotor,!1)}InitVelocityConstraints(d){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);
this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var n=d.positions[this.m_indexA].c;const u=d.velocities[this.m_indexA].v;let C=d.velocities[this.m_indexA].w;var I=d.positions[this.m_indexB].c,L=d.positions[this.m_indexB].a;const U=d.velocities[this.m_indexB].v;let Z=d.velocities[this.m_indexB].w;var ka=this.m_qA.SetAngle(d.positions[this.m_indexA].a);
L=this.m_qB.SetAngle(L);z.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var ia=ib.MulRV(ka,this.m_lalcA,this.m_rA);z.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var ta=ib.MulRV(L,this.m_lalcB,this.m_rB);const Ja=z.AddVV(z.SubVV(I,n,z.s_t0),z.SubVV(ta,ia,z.s_t1),gc.InitVelocityConstraints_s_d);n=this.m_invMassA;I=this.m_invMassB;L=this.m_invIA;const Oa=this.m_invIB;ib.MulRV(ka,this.m_localXAxisA,this.m_axis);this.m_a1=z.CrossVV(z.AddVV(Ja,ia,z.s_t0),this.m_axis);this.m_a2=
z.CrossVV(ta,this.m_axis);this.m_axialMass=n+I+L*this.m_a1*this.m_a1+Oa*this.m_a2*this.m_a2;0<this.m_axialMass&&(this.m_axialMass=1/this.m_axialMass);ib.MulRV(ka,this.m_localYAxisA,this.m_perp);this.m_s1=z.CrossVV(z.AddVV(Ja,ia,z.s_t0),this.m_perp);this.m_s2=z.CrossVV(ta,this.m_perp);this.m_K.ex.x=n+I+L*this.m_s1*this.m_s1+Oa*this.m_s2*this.m_s2;this.m_K.ex.y=L*this.m_s1+Oa*this.m_s2;this.m_K.ey.x=this.m_K.ex.y;this.m_K.ey.y=L+Oa;0===this.m_K.ey.y&&(this.m_K.ey.y=1);this.m_enableLimit?this.m_translation=
z.DotVV(this.m_axis,Ja):this.m_upperImpulse=this.m_lowerImpulse=0;this.m_enableMotor||(this.m_motorImpulse=0);d.step.warmStarting?(this.m_impulse.SelfMul(d.step.dtRatio),this.m_motorImpulse*=d.step.dtRatio,this.m_lowerImpulse*=d.step.dtRatio,this.m_upperImpulse*=d.step.dtRatio,ta=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse,ka=z.AddVV(z.MulSV(this.m_impulse.x,this.m_perp,z.s_t0),z.MulSV(ta,this.m_axis,z.s_t1),gc.InitVelocityConstraints_s_P),ia=this.m_impulse.x*this.m_s1+this.m_impulse.y+
ta*this.m_a1,ta=this.m_impulse.x*this.m_s2+this.m_impulse.y+ta*this.m_a2,u.SelfMulSub(n,ka),C-=L*ia,U.SelfMulAdd(I,ka),Z+=Oa*ta):(this.m_impulse.SetZero(),this.m_upperImpulse=this.m_lowerImpulse=this.m_motorImpulse=0);d.velocities[this.m_indexA].w=C;d.velocities[this.m_indexB].w=Z}SolveVelocityConstraints(d){const n=d.velocities[this.m_indexA].v;let u=d.velocities[this.m_indexA].w;const C=d.velocities[this.m_indexB].v;let I=d.velocities[this.m_indexB].w;const L=this.m_invMassA,U=this.m_invMassB,Z=
this.m_invIA,ka=this.m_invIB;if(this.m_enableMotor){var ia=z.DotVV(this.m_axis,z.SubVV(C,n,z.s_t0))+this.m_a2*I-this.m_a1*u;ia=this.m_axialMass*(this.m_motorSpeed-ia);var ta=this.m_motorImpulse,Ja=d.step.dt*this.m_maxMotorForce;this.m_motorImpulse=g(this.m_motorImpulse+ia,-Ja,Ja);ia=this.m_motorImpulse-ta;ta=z.MulSV(ia,this.m_axis,gc.SolveVelocityConstraints_s_P);Ja=ia*this.m_a1;ia*=this.m_a2;n.SelfMulSub(L,ta);u-=Z*Ja;C.SelfMulAdd(U,ta);I+=ka*ia}this.m_enableLimit&&(ia=this.m_translation-this.m_lowerTranslation,
ta=z.DotVV(this.m_axis,z.SubVV(C,n,z.s_t0))+this.m_a2*I-this.m_a1*u,ia=-this.m_axialMass*(ta+h(ia,0)*d.step.inv_dt),ta=this.m_lowerImpulse,this.m_lowerImpulse=h(this.m_lowerImpulse+ia,0),ia=this.m_lowerImpulse-ta,ta=z.MulSV(ia,this.m_axis,gc.SolveVelocityConstraints_s_P),Ja=ia*this.m_a1,ia*=this.m_a2,n.SelfMulSub(L,ta),u-=Z*Ja,C.SelfMulAdd(U,ta),I+=ka*ia,ia=this.m_upperTranslation-this.m_translation,ta=z.DotVV(this.m_axis,z.SubVV(n,C,z.s_t0))+this.m_a1*u-this.m_a2*I,ia=-this.m_axialMass*(ta+h(ia,
0)*d.step.inv_dt),ta=this.m_upperImpulse,this.m_upperImpulse=h(this.m_upperImpulse+ia,0),ia=this.m_upperImpulse-ta,ta=z.MulSV(ia,this.m_axis,gc.SolveVelocityConstraints_s_P),Ja=ia*this.m_a1,ia*=this.m_a2,n.SelfMulAdd(L,ta),u+=Z*Ja,C.SelfMulSub(U,ta),I-=ka*ia);ia=z.DotVV(this.m_perp,z.SubVV(C,n,z.s_t0))+this.m_s2*I-this.m_s1*u;Ja=this.m_K.Solve(-ia,-(I-u),gc.SolveVelocityConstraints_s_df);this.m_impulse.SelfAdd(Ja);ia=z.MulSV(Ja.x,this.m_perp,gc.SolveVelocityConstraints_s_P);ta=Ja.x*this.m_s1+Ja.y;
Ja=Ja.x*this.m_s2+Ja.y;n.SelfMulSub(L,ia);u-=Z*ta;C.SelfMulAdd(U,ia);d.velocities[this.m_indexA].w=u;d.velocities[this.m_indexB].w=I+ka*Ja}SolvePositionConstraints(d){const n=d.positions[this.m_indexA].c;let u=d.positions[this.m_indexA].a;const C=d.positions[this.m_indexB].c;let I=d.positions[this.m_indexB].a;var L=this.m_qA.SetAngle(u),U=this.m_qB.SetAngle(I);const Z=this.m_invMassA,ka=this.m_invMassB,ia=this.m_invIA,ta=this.m_invIB;var Ja=ib.MulRV(L,this.m_lalcA,this.m_rA),Oa=ib.MulRV(U,this.m_lalcB,
this.m_rB),Xa=z.SubVV(z.AddVV(C,Oa,z.s_t0),z.AddVV(n,Ja,z.s_t1),gc.SolvePositionConstraints_s_d),zb=ib.MulRV(L,this.m_localXAxisA,this.m_axis),Hb=z.CrossVV(z.AddVV(Xa,Ja,z.s_t0),zb);U=z.CrossVV(Oa,zb);L=ib.MulRV(L,this.m_localYAxisA,this.m_perp);const Jb=z.CrossVV(z.AddVV(Xa,Ja,z.s_t0),L),Tb=z.CrossVV(Oa,L);let Vb=gc.SolvePositionConstraints_s_impulse;var Qb=z.DotVV(L,Xa);const fc=I-u-this.m_referenceAngle;Ja=eb(Qb);Oa=eb(fc);var cc=!1,jc=0;this.m_enableLimit&&(Xa=z.DotVV(zb,Xa),.01>eb(this.m_upperTranslation-
this.m_lowerTranslation)?(jc=Xa,Ja=h(Ja,eb(Xa)),cc=!0):Xa<=this.m_lowerTranslation?(jc=f(Xa-this.m_lowerTranslation,0),Ja=h(Ja,this.m_lowerTranslation-Xa),cc=!0):Xa>=this.m_upperTranslation&&(jc=h(Xa-this.m_upperTranslation,0),Ja=h(Ja,Xa-this.m_upperTranslation),cc=!0));if(cc){Xa=ia*Jb+ta*Tb;cc=ia*Jb*Hb+ta*Tb*U;let mc=ia+ta;0===mc&&(mc=1);const qc=ia*Hb+ta*U,yc=Z+ka+ia*Hb*Hb+ta*U*U,lc=this.m_K3;lc.ex.SetXYZ(Z+ka+ia*Jb*Jb+ta*Tb*Tb,Xa,cc);lc.ey.SetXYZ(Xa,mc,qc);lc.ez.SetXYZ(cc,qc,yc);Vb=lc.Solve33(-Qb,
-fc,-jc,Vb)}else jc=ia*Jb+ta*Tb,Xa=ia+ta,0===Xa&&(Xa=1),cc=this.m_K2,cc.ex.Set(Z+ka+ia*Jb*Jb+ta*Tb*Tb,jc),cc.ey.Set(jc,Xa),Qb=cc.Solve(-Qb,-fc,gc.SolvePositionConstraints_s_impulse1),Vb.x=Qb.x,Vb.y=Qb.y,Vb.z=0;zb=z.AddVV(z.MulSV(Vb.x,L,z.s_t0),z.MulSV(Vb.z,zb,z.s_t1),gc.SolvePositionConstraints_s_P);Hb=Vb.x*Jb+Vb.y+Vb.z*Hb;U=Vb.x*Tb+Vb.y+Vb.z*U;n.SelfMulSub(Z,zb);u-=ia*Hb;C.SelfMulAdd(ka,zb);d.positions[this.m_indexA].a=u;d.positions[this.m_indexB].a=I+ta*U;return.005>=Ja&&Oa<=xb}GetAnchorA(d){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,
d)}GetAnchorB(d){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,d)}GetReactionForce(d,n){n.x=d*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_axis.x);n.y=d*(this.m_impulse.y*this.m_perp.y+(this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_axis.y);return n}GetReactionTorque(d){return d*this.m_impulse.y}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetReferenceAngle(){return this.m_referenceAngle}GetJointTranslation(){var d=
this.m_bodyA.GetWorldPoint(this.m_localAnchorA,gc.GetJointTranslation_s_pA),n=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,gc.GetJointTranslation_s_pB);d=z.SubVV(n,d,gc.GetJointTranslation_s_d);n=this.m_bodyA.GetWorldVector(this.m_localXAxisA,gc.GetJointTranslation_s_axis);return z.DotVV(d,n)}GetJointSpeed(){var d=this.m_bodyA,n=this.m_bodyB;z.SubVV(this.m_localAnchorA,d.m_sweep.localCenter,this.m_lalcA);const u=ib.MulRV(d.m_xf.q,this.m_lalcA,this.m_rA);z.SubVV(this.m_localAnchorB,n.m_sweep.localCenter,
this.m_lalcB);const C=ib.MulRV(n.m_xf.q,this.m_lalcB,this.m_rB);var I=z.AddVV(d.m_sweep.c,u,z.s_t0),L=z.AddVV(n.m_sweep.c,C,z.s_t1);I=z.SubVV(L,I,z.s_t2);L=d.GetWorldVector(this.m_localXAxisA,this.m_axis);const U=d.m_linearVelocity,Z=n.m_linearVelocity;d=d.m_angularVelocity;n=n.m_angularVelocity;return z.DotVV(I,z.CrossSV(d,L,z.s_t0))+z.DotVV(L,z.SubVV(z.AddVCrossSV(Z,n,C,z.s_t0),z.AddVCrossSV(U,d,u,z.s_t1),z.s_t0))}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(d){d!==this.m_enableLimit&&
(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=d,this.m_upperImpulse=this.m_lowerImpulse=0)}GetLowerLimit(){return this.m_lowerTranslation}GetUpperLimit(){return this.m_upperTranslation}SetLimits(d,n){if(d!==this.m_lowerTranslation||n!==this.m_upperTranslation)this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=d,this.m_upperTranslation=n,this.m_upperImpulse=this.m_lowerImpulse=0}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(d){d!==this.m_enableMotor&&
(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=d)}SetMotorSpeed(d){d!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=d)}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorForce(d){d!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=d)}GetMaxMotorForce(){return this.m_maxMotorForce}GetMotorForce(d){return d*this.m_motorImpulse}Dump(d){const n=this.m_bodyA.m_islandIndex,u=this.m_bodyB.m_islandIndex;
d("  const jd: b2PrismaticJointDef = new b2PrismaticJointDef();\n");d("  jd.bodyA = bodies[%d];\n",n);d("  jd.bodyB = bodies[%d];\n",u);d("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false");d("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);d("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);d("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y);d("  jd.referenceAngle = %.15f;\n",
this.m_referenceAngle);d("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false");d("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation);d("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation);d("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false");d("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed);d("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce);d("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}Draw(d){var n=this.m_bodyA.GetTransform(),u=this.m_bodyB.GetTransform();
const C=rb.MulXV(n,this.m_localAnchorA,gc.Draw_s_pA);u=rb.MulXV(u,this.m_localAnchorB,gc.Draw_s_pB);var I=ib.MulRV(n.q,this.m_localXAxisA,gc.Draw_s_axis);const L=gc.Draw_s_c1,U=gc.Draw_s_c2,Z=gc.Draw_s_c3,ka=gc.Draw_s_c4;d.DrawSegment(C,u,gc.Draw_s_c5);if(this.m_enableLimit){const ia=z.AddVMulSV(C,this.m_lowerTranslation,I,gc.Draw_s_lower);I=z.AddVMulSV(C,this.m_upperTranslation,I,gc.Draw_s_upper);n=ib.MulRV(n.q,this.m_localYAxisA,gc.Draw_s_perp);d.DrawSegment(ia,I,L);d.DrawSegment(z.AddVMulSV(ia,
-.5,n,z.s_t0),z.AddVMulSV(ia,.5,n,z.s_t1),U);d.DrawSegment(z.AddVMulSV(I,-.5,n,z.s_t0),z.AddVMulSV(I,.5,n,z.s_t1),Z)}else d.DrawSegment(z.AddVMulSV(C,-1,I,z.s_t0),z.AddVMulSV(C,1,I,z.s_t1),L);d.DrawPoint(C,5,L);d.DrawPoint(u,5,ka)}}gc.InitVelocityConstraints_s_d=new z;gc.InitVelocityConstraints_s_P=new z;gc.SolveVelocityConstraints_s_P=new z;gc.SolveVelocityConstraints_s_df=new z;gc.SolvePositionConstraints_s_d=new z;gc.SolvePositionConstraints_s_impulse=new Rb;gc.SolvePositionConstraints_s_impulse1=
new z;gc.SolvePositionConstraints_s_P=new z;gc.GetJointTranslation_s_pA=new z;gc.GetJointTranslation_s_pB=new z;gc.GetJointTranslation_s_d=new z;gc.GetJointTranslation_s_axis=new z;gc.Draw_s_pA=new z;gc.Draw_s_pB=new z;gc.Draw_s_axis=new z;gc.Draw_s_c1=new ya(.7,.7,.7);gc.Draw_s_c2=new ya(.3,.9,.3);gc.Draw_s_c3=new ya(.9,.3,.3);gc.Draw_s_c4=new ya(.3,.3,.9);gc.Draw_s_c5=new ya(.4,.4,.4);gc.Draw_s_lower=new z;gc.Draw_s_upper=new z;gc.Draw_s_perp=new z;class Pl extends Dd{constructor(){super(a.JointType.e_pulleyJoint);
this.groundAnchorA=new z(-1,1);this.groundAnchorB=new z(1,1);this.localAnchorA=new z(-1,0);this.localAnchorB=new z(1,0);this.lengthB=this.lengthA=0;this.ratio=1;this.collideConnected=!0}Initialize(d,n,u,C,I,L,U){this.bodyA=d;this.bodyB=n;this.groundAnchorA.Copy(u);this.groundAnchorB.Copy(C);this.bodyA.GetLocalPoint(I,this.localAnchorA);this.bodyB.GetLocalPoint(L,this.localAnchorB);this.lengthA=z.DistanceVV(I,u);this.lengthB=z.DistanceVV(L,C);this.ratio=U}}class Uc extends $c{constructor(d){super(d);
this.m_groundAnchorA=new z;this.m_groundAnchorB=new z;this.m_lengthB=this.m_lengthA=0;this.m_localAnchorA=new z;this.m_localAnchorB=new z;this.m_indexB=this.m_indexA=this.m_impulse=this.m_ratio=this.m_constant=0;this.m_uA=new z;this.m_uB=new z;this.m_rA=new z;this.m_rB=new z;this.m_localCenterA=new z;this.m_localCenterB=new z;this.m_mass=this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0;this.m_qA=new ib;this.m_qB=new ib;this.m_lalcA=new z;this.m_lalcB=new z;this.m_groundAnchorA.Copy(b(d.groundAnchorA,
new z(-1,1)));this.m_groundAnchorB.Copy(b(d.groundAnchorB,new z(1,0)));this.m_localAnchorA.Copy(b(d.localAnchorA,new z(-1,0)));this.m_localAnchorB.Copy(b(d.localAnchorB,new z(1,0)));this.m_lengthA=b(d.lengthA,0);this.m_lengthB=b(d.lengthB,0);this.m_ratio=b(d.ratio,1);this.m_constant=b(d.lengthA,0)+this.m_ratio*b(d.lengthB,0);this.m_impulse=0}InitVelocityConstraints(d){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);
this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var n=d.positions[this.m_indexA].c;const u=d.velocities[this.m_indexA].v;let C=d.velocities[this.m_indexA].w;var I=d.positions[this.m_indexB].c,L=d.positions[this.m_indexB].a;const U=d.velocities[this.m_indexB].v;let Z=d.velocities[this.m_indexB].w;const ka=this.m_qA.SetAngle(d.positions[this.m_indexA].a);
L=this.m_qB.SetAngle(L);z.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);ib.MulRV(ka,this.m_lalcA,this.m_rA);z.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);ib.MulRV(L,this.m_lalcB,this.m_rB);this.m_uA.Copy(n).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA);this.m_uB.Copy(I).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);n=this.m_uA.Length();I=this.m_uB.Length();.05<n?this.m_uA.SelfMul(1/n):this.m_uA.SetZero();.05<I?this.m_uB.SelfMul(1/I):this.m_uB.SetZero();n=z.CrossVV(this.m_rA,
this.m_uA);I=z.CrossVV(this.m_rB,this.m_uB);this.m_mass=this.m_invMassA+this.m_invIA*n*n+this.m_ratio*this.m_ratio*(this.m_invMassB+this.m_invIB*I*I);0<this.m_mass&&(this.m_mass=1/this.m_mass);d.step.warmStarting?(this.m_impulse*=d.step.dtRatio,n=z.MulSV(-this.m_impulse,this.m_uA,Uc.InitVelocityConstraints_s_PA),I=z.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,Uc.InitVelocityConstraints_s_PB),u.SelfMulAdd(this.m_invMassA,n),C+=this.m_invIA*z.CrossVV(this.m_rA,n),U.SelfMulAdd(this.m_invMassB,I),Z+=
this.m_invIB*z.CrossVV(this.m_rB,I)):this.m_impulse=0;d.velocities[this.m_indexA].w=C;d.velocities[this.m_indexB].w=Z}SolveVelocityConstraints(d){const n=d.velocities[this.m_indexA].v;let u=d.velocities[this.m_indexA].w;const C=d.velocities[this.m_indexB].v;let I=d.velocities[this.m_indexB].w;var L=z.AddVCrossSV(n,u,this.m_rA,Uc.SolveVelocityConstraints_s_vpA),U=z.AddVCrossSV(C,I,this.m_rB,Uc.SolveVelocityConstraints_s_vpB);L=-z.DotVV(this.m_uA,L)-this.m_ratio*z.DotVV(this.m_uB,U);U=-this.m_mass*
L;this.m_impulse+=U;L=z.MulSV(-U,this.m_uA,Uc.SolveVelocityConstraints_s_PA);U=z.MulSV(-this.m_ratio*U,this.m_uB,Uc.SolveVelocityConstraints_s_PB);n.SelfMulAdd(this.m_invMassA,L);u+=this.m_invIA*z.CrossVV(this.m_rA,L);C.SelfMulAdd(this.m_invMassB,U);I+=this.m_invIB*z.CrossVV(this.m_rB,U);d.velocities[this.m_indexA].w=u;d.velocities[this.m_indexB].w=I}SolvePositionConstraints(d){const n=d.positions[this.m_indexA].c;let u=d.positions[this.m_indexA].a;const C=d.positions[this.m_indexB].c;let I=d.positions[this.m_indexB].a;
var L=this.m_qA.SetAngle(u),U=this.m_qB.SetAngle(I);z.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);L=ib.MulRV(L,this.m_lalcA,this.m_rA);z.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);U=ib.MulRV(U,this.m_lalcB,this.m_rB);var Z=this.m_uA.Copy(n).SelfAdd(L).SelfSub(this.m_groundAnchorA),ka=this.m_uB.Copy(C).SelfAdd(U).SelfSub(this.m_groundAnchorB),ia=Z.Length(),ta=ka.Length();.05<ia?Z.SelfMul(1/ia):Z.SetZero();.05<ta?ka.SelfMul(1/ta):ka.SetZero();var Ja=z.CrossVV(L,Z);const Oa=
z.CrossVV(U,ka);Ja=this.m_invMassA+this.m_invIA*Ja*Ja+this.m_ratio*this.m_ratio*(this.m_invMassB+this.m_invIB*Oa*Oa);0<Ja&&(Ja=1/Ja);ta=this.m_constant-ia-this.m_ratio*ta;ia=eb(ta);ta*=-Ja;Z=z.MulSV(-ta,Z,Uc.SolvePositionConstraints_s_PA);ka=z.MulSV(-this.m_ratio*ta,ka,Uc.SolvePositionConstraints_s_PB);n.SelfMulAdd(this.m_invMassA,Z);u+=this.m_invIA*z.CrossVV(L,Z);C.SelfMulAdd(this.m_invMassB,ka);I+=this.m_invIB*z.CrossVV(U,ka);d.positions[this.m_indexA].a=u;d.positions[this.m_indexB].a=I;return.005>
ia}GetAnchorA(d){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,d)}GetAnchorB(d){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,d)}GetReactionForce(d,n){n.x=d*this.m_impulse*this.m_uB.x;n.y=d*this.m_impulse*this.m_uB.y;return n}GetReactionTorque(){return 0}GetGroundAnchorA(){return this.m_groundAnchorA}GetGroundAnchorB(){return this.m_groundAnchorB}GetLengthA(){return this.m_lengthA}GetLengthB(){return this.m_lengthB}GetRatio(){return this.m_ratio}GetCurrentLengthA(){const d=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,
Uc.GetCurrentLengthA_s_p);return z.DistanceVV(d,this.m_groundAnchorA)}GetCurrentLengthB(){const d=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,Uc.GetCurrentLengthB_s_p);return z.DistanceVV(d,this.m_groundAnchorB)}Dump(d){const n=this.m_bodyA.m_islandIndex,u=this.m_bodyB.m_islandIndex;d("  const jd: b2PulleyJointDef = new b2PulleyJointDef();\n");d("  jd.bodyA = bodies[%d];\n",n);d("  jd.bodyB = bodies[%d];\n",u);d("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false");d("  jd.groundAnchorA.Set(%.15f, %.15f);\n",
this.m_groundAnchorA.x,this.m_groundAnchorA.y);d("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y);d("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);d("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);d("  jd.lengthA = %.15f;\n",this.m_lengthA);d("  jd.lengthB = %.15f;\n",this.m_lengthB);d("  jd.ratio = %.15f;\n",this.m_ratio);d("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}ShiftOrigin(d){this.m_groundAnchorA.SelfSub(d);
this.m_groundAnchorB.SelfSub(d)}}Uc.InitVelocityConstraints_s_PA=new z;Uc.InitVelocityConstraints_s_PB=new z;Uc.SolveVelocityConstraints_s_vpA=new z;Uc.SolveVelocityConstraints_s_vpB=new z;Uc.SolveVelocityConstraints_s_PA=new z;Uc.SolveVelocityConstraints_s_PB=new z;Uc.SolvePositionConstraints_s_PA=new z;Uc.SolvePositionConstraints_s_PB=new z;Uc.GetCurrentLengthA_s_p=new z;Uc.GetCurrentLengthB_s_p=new z;class Ql extends Dd{constructor(){super(a.JointType.e_revoluteJoint);this.localAnchorA=new z(0,
0);this.localAnchorB=new z(0,0);this.referenceAngle=0;this.enableLimit=!1;this.upperAngle=this.lowerAngle=0;this.enableMotor=!1;this.maxMotorTorque=this.motorSpeed=0}Initialize(d,n,u){this.bodyA=d;this.bodyB=n;this.bodyA.GetLocalPoint(u,this.localAnchorA);this.bodyB.GetLocalPoint(u,this.localAnchorB);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}class Bc extends $c{constructor(d){super(d);this.m_localAnchorA=new z;this.m_localAnchorB=new z;this.m_impulse=new z;this.m_upperImpulse=
this.m_lowerImpulse=this.m_motorImpulse=0;this.m_enableMotor=!1;this.m_motorSpeed=this.m_maxMotorTorque=0;this.m_enableLimit=!1;this.m_indexB=this.m_indexA=this.m_upperAngle=this.m_lowerAngle=this.m_referenceAngle=0;this.m_rA=new z;this.m_rB=new z;this.m_localCenterA=new z;this.m_localCenterB=new z;this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0;this.m_K=new Fb;this.m_axialMass=this.m_angle=0;this.m_qA=new ib;this.m_qB=new ib;this.m_lalcA=new z;this.m_lalcB=new z;this.m_localAnchorA.Copy(b(d.localAnchorA,
z.ZERO));this.m_localAnchorB.Copy(b(d.localAnchorB,z.ZERO));this.m_referenceAngle=b(d.referenceAngle,0);this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=b(d.lowerAngle,0);this.m_upperAngle=b(d.upperAngle,0);this.m_maxMotorTorque=b(d.maxMotorTorque,0);this.m_motorSpeed=b(d.motorSpeed,0);this.m_enableLimit=b(d.enableLimit,!1);this.m_enableMotor=b(d.enableMotor,!1)}InitVelocityConstraints(d){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);
this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var n=d.positions[this.m_indexA].a;const u=d.velocities[this.m_indexA].v;let C=d.velocities[this.m_indexA].w;var I=d.positions[this.m_indexB].a;const L=d.velocities[this.m_indexB].v;let U=d.velocities[this.m_indexB].w;var Z=this.m_qA.SetAngle(n),ka=this.m_qB.SetAngle(I);z.SubVV(this.m_localAnchorA,
this.m_localCenterA,this.m_lalcA);ib.MulRV(Z,this.m_lalcA,this.m_rA);z.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);ib.MulRV(ka,this.m_lalcB,this.m_rB);Z=this.m_invMassA;ka=this.m_invMassB;const ia=this.m_invIA,ta=this.m_invIB;this.m_K.ex.x=Z+ka+this.m_rA.y*this.m_rA.y*ia+this.m_rB.y*this.m_rB.y*ta;this.m_K.ey.x=-this.m_rA.y*this.m_rA.x*ia-this.m_rB.y*this.m_rB.x*ta;this.m_K.ex.y=this.m_K.ey.x;this.m_K.ey.y=Z+ka+this.m_rA.x*this.m_rA.x*ia+this.m_rB.x*this.m_rB.x*ta;this.m_axialMass=
ia+ta;let Ja;0<this.m_axialMass?(this.m_axialMass=1/this.m_axialMass,Ja=!1):Ja=!0;this.m_angle=I-n-this.m_referenceAngle;if(!1===this.m_enableLimit||Ja)this.m_upperImpulse=this.m_lowerImpulse=0;if(!1===this.m_enableMotor||Ja)this.m_motorImpulse=0;d.step.warmStarting?(this.m_impulse.SelfMul(d.step.dtRatio),this.m_motorImpulse*=d.step.dtRatio,this.m_lowerImpulse*=d.step.dtRatio,this.m_upperImpulse*=d.step.dtRatio,n=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse,I=Bc.InitVelocityConstraints_s_P.Set(this.m_impulse.x,
this.m_impulse.y),u.SelfMulSub(Z,I),C-=ia*(z.CrossVV(this.m_rA,I)+n),L.SelfMulAdd(ka,I),U+=ta*(z.CrossVV(this.m_rB,I)+n)):(this.m_impulse.SetZero(),this.m_upperImpulse=this.m_lowerImpulse=this.m_motorImpulse=0);d.velocities[this.m_indexA].w=C;d.velocities[this.m_indexB].w=U}SolveVelocityConstraints(d){const n=d.velocities[this.m_indexA].v;let u=d.velocities[this.m_indexA].w;const C=d.velocities[this.m_indexB].v;let I=d.velocities[this.m_indexB].w;const L=this.m_invMassA,U=this.m_invMassB,Z=this.m_invIA,
ka=this.m_invIB;var ia=0===Z+ka;if(this.m_enableMotor&&!ia){var ta=-this.m_axialMass*(I-u-this.m_motorSpeed);const Ja=this.m_motorImpulse,Oa=d.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=g(this.m_motorImpulse+ta,-Oa,Oa);ta=this.m_motorImpulse-Ja;u-=Z*ta;I+=ka*ta}this.m_enableLimit&&!ia&&(ia=-this.m_axialMass*(I-u+h(this.m_angle-this.m_lowerAngle,0)*d.step.inv_dt),ta=this.m_lowerImpulse,this.m_lowerImpulse=h(this.m_lowerImpulse+ia,0),ia=this.m_lowerImpulse-ta,u-=Z*ia,I+=ka*ia,ia=-this.m_axialMass*
(u-I+h(this.m_upperAngle-this.m_angle,0)*d.step.inv_dt),ta=this.m_upperImpulse,this.m_upperImpulse=h(this.m_upperImpulse+ia,0),ia=this.m_upperImpulse-ta,u+=Z*ia,I-=ka*ia);ia=z.SubVV(z.AddVCrossSV(C,I,this.m_rB,z.s_t0),z.AddVCrossSV(n,u,this.m_rA,z.s_t1),Bc.SolveVelocityConstraints_s_Cdot_v2);ia=this.m_K.Solve(-ia.x,-ia.y,Bc.SolveVelocityConstraints_s_impulse_v2);this.m_impulse.x+=ia.x;this.m_impulse.y+=ia.y;n.SelfMulSub(L,ia);u-=Z*z.CrossVV(this.m_rA,ia);C.SelfMulAdd(U,ia);I+=ka*z.CrossVV(this.m_rB,
ia);d.velocities[this.m_indexA].w=u;d.velocities[this.m_indexB].w=I}SolvePositionConstraints(d){const n=d.positions[this.m_indexA].c;let u=d.positions[this.m_indexA].a;const C=d.positions[this.m_indexB].c;let I=d.positions[this.m_indexB].a;var L=this.m_qA.SetAngle(u),U=this.m_qB.SetAngle(I),Z=0,ka=0===this.m_invIA+this.m_invIB;this.m_enableLimit&&!ka&&(ka=I-u-this.m_referenceAngle,Z=0,eb(this.m_upperAngle-this.m_lowerAngle)<2*xb?Z=g(ka-this.m_lowerAngle,-Cb,Cb):ka<=this.m_lowerAngle?Z=g(ka-this.m_lowerAngle+
xb,-Cb,0):ka>=this.m_upperAngle&&(Z=g(ka-this.m_upperAngle-xb,0,Cb)),ka=-this.m_axialMass*Z,u-=this.m_invIA*ka,I+=this.m_invIB*ka,Z=eb(Z));L.SetAngle(u);U.SetAngle(I);z.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);L=ib.MulRV(L,this.m_lalcA,this.m_rA);z.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);ka=ib.MulRV(U,this.m_lalcB,this.m_rB);var ia=z.SubVV(z.AddVV(C,ka,z.s_t0),z.AddVV(n,L,z.s_t1),Bc.SolvePositionConstraints_s_C_v2);U=ia.Length();const ta=this.m_invMassA,Ja=this.m_invMassB,
Oa=this.m_invIA,Xa=this.m_invIB,zb=this.m_K;zb.ex.x=ta+Ja+Oa*L.y*L.y+Xa*ka.y*ka.y;zb.ex.y=-Oa*L.x*L.y-Xa*ka.x*ka.y;zb.ey.x=zb.ex.y;zb.ey.y=ta+Ja+Oa*L.x*L.x+Xa*ka.x*ka.x;ia=zb.Solve(ia.x,ia.y,Bc.SolvePositionConstraints_s_impulse).SelfNeg();n.SelfMulSub(ta,ia);u-=Oa*z.CrossVV(L,ia);C.SelfMulAdd(Ja,ia);I+=Xa*z.CrossVV(ka,ia);d.positions[this.m_indexA].a=u;d.positions[this.m_indexB].a=I;return.005>=U&&Z<=xb}GetAnchorA(d){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,d)}GetAnchorB(d){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,
d)}GetReactionForce(d,n){n.x=d*this.m_impulse.x;n.y=d*this.m_impulse.y;return n}GetReactionTorque(d){return d*(this.m_lowerImpulse-this.m_upperImpulse)}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}GetJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle}GetJointSpeed(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(d){d!==
this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=d)}GetMotorTorque(d){return d*this.m_motorImpulse}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorTorque(d){d!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=d)}GetMaxMotorTorque(){return this.m_maxMotorTorque}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(d){d!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=
d,this.m_upperImpulse=this.m_lowerImpulse=0)}GetLowerLimit(){return this.m_lowerAngle}GetUpperLimit(){return this.m_upperAngle}SetLimits(d,n){if(d!==this.m_lowerAngle||n!==this.m_upperAngle)this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_upperImpulse=this.m_lowerImpulse=0,this.m_lowerAngle=d,this.m_upperAngle=n}SetMotorSpeed(d){d!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=d)}Dump(d){const n=this.m_bodyA.m_islandIndex,u=this.m_bodyB.m_islandIndex;
d("  const jd: b2RevoluteJointDef = new b2RevoluteJointDef();\n");d("  jd.bodyA = bodies[%d];\n",n);d("  jd.bodyB = bodies[%d];\n",u);d("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false");d("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);d("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);d("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle);d("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false");
d("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle);d("  jd.upperAngle = %.15f;\n",this.m_upperAngle);d("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false");d("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed);d("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque);d("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}Draw(d){const n=this.m_bodyA.GetTransform(),u=this.m_bodyB.GetTransform(),C=rb.MulXV(n,this.m_localAnchorA,Bc.Draw_s_pA),I=rb.MulXV(u,this.m_localAnchorB,Bc.Draw_s_pB);
var L=Bc.Draw_s_c1,U=Bc.Draw_s_c2;const Z=Bc.Draw_s_c3;var ka=Bc.Draw_s_c5;d.DrawPoint(C,5,Bc.Draw_s_c4);d.DrawPoint(I,5,ka);ka=this.m_bodyA.GetAngle();ka=this.m_bodyB.GetAngle()-ka-this.m_referenceAngle;ka=Bc.Draw_s_r.Set(.1*Math.cos(ka),.1*Math.sin(ka));d.DrawSegment(I,z.AddVV(I,ka,z.s_t0),L);d.DrawCircle(I,.1,L);this.m_enableLimit&&(L=Bc.Draw_s_rlo.Set(.1*Math.cos(this.m_lowerAngle),.1*Math.sin(this.m_lowerAngle)),ka=Bc.Draw_s_rhi.Set(.1*Math.cos(this.m_upperAngle),.1*Math.sin(this.m_upperAngle)),
d.DrawSegment(I,z.AddVV(I,L,z.s_t0),U),d.DrawSegment(I,z.AddVV(I,ka,z.s_t0),Z));U=Bc.Draw_s_color_;d.DrawSegment(n.p,C,U);d.DrawSegment(C,I,U);d.DrawSegment(u.p,I,U)}}Bc.InitVelocityConstraints_s_P=new z;Bc.SolveVelocityConstraints_s_Cdot_v2=new z;Bc.SolveVelocityConstraints_s_impulse_v2=new z;Bc.SolvePositionConstraints_s_C_v2=new z;Bc.SolvePositionConstraints_s_impulse=new z;Bc.Draw_s_pA=new z;Bc.Draw_s_pB=new z;Bc.Draw_s_c1=new ya(.7,.7,.7);Bc.Draw_s_c2=new ya(.3,.9,.3);Bc.Draw_s_c3=new ya(.9,
.3,.3);Bc.Draw_s_c4=new ya(.3,.3,.9);Bc.Draw_s_c5=new ya(.4,.4,.4);Bc.Draw_s_color_=new ya(.5,.8,.8);Bc.Draw_s_r=new z;Bc.Draw_s_rlo=new z;Bc.Draw_s_rhi=new z;class Rl extends Dd{constructor(){super(a.JointType.e_weldJoint);this.localAnchorA=new z;this.localAnchorB=new z;this.damping=this.stiffness=this.referenceAngle=0}Initialize(d,n,u){this.bodyA=d;this.bodyB=n;this.bodyA.GetLocalPoint(u,this.localAnchorA);this.bodyB.GetLocalPoint(u,this.localAnchorB);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}
class Yc extends $c{constructor(d){super(d);this.m_bias=this.m_damping=this.m_stiffness=0;this.m_localAnchorA=new z;this.m_localAnchorB=new z;this.m_gamma=this.m_referenceAngle=0;this.m_impulse=new Rb(0,0,0);this.m_indexB=this.m_indexA=0;this.m_rA=new z;this.m_rB=new z;this.m_localCenterA=new z;this.m_localCenterB=new z;this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0;this.m_mass=new Wb;this.m_qA=new ib;this.m_qB=new ib;this.m_lalcA=new z;this.m_lalcB=new z;this.m_K=new Wb;this.m_stiffness=
b(d.stiffness,0);this.m_damping=b(d.damping,0);this.m_localAnchorA.Copy(b(d.localAnchorA,z.ZERO));this.m_localAnchorB.Copy(b(d.localAnchorB,z.ZERO));this.m_referenceAngle=b(d.referenceAngle,0);this.m_impulse.SetZero()}InitVelocityConstraints(d){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;
this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var n=d.positions[this.m_indexA].a;const u=d.velocities[this.m_indexA].v;let C=d.velocities[this.m_indexA].w;var I=d.positions[this.m_indexB].a;const L=d.velocities[this.m_indexB].v;let U=d.velocities[this.m_indexB].w;var Z=this.m_qA.SetAngle(n),ka=this.m_qB.SetAngle(I);z.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);ib.MulRV(Z,this.m_lalcA,this.m_rA);z.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);ib.MulRV(ka,
this.m_lalcB,this.m_rB);Z=this.m_invMassA;ka=this.m_invMassB;const ia=this.m_invIA,ta=this.m_invIB;var Ja=this.m_K;Ja.ex.x=Z+ka+this.m_rA.y*this.m_rA.y*ia+this.m_rB.y*this.m_rB.y*ta;Ja.ey.x=-this.m_rA.y*this.m_rA.x*ia-this.m_rB.y*this.m_rB.x*ta;Ja.ez.x=-this.m_rA.y*ia-this.m_rB.y*ta;Ja.ex.y=Ja.ey.x;Ja.ey.y=Z+ka+this.m_rA.x*this.m_rA.x*ia+this.m_rB.x*this.m_rB.x*ta;Ja.ez.y=this.m_rA.x*ia+this.m_rB.x*ta;Ja.ex.z=Ja.ez.x;Ja.ey.z=Ja.ez.y;Ja.ez.z=ia+ta;0<this.m_stiffness?(Ja.GetInverse22(this.m_mass),n=
I-n-this.m_referenceAngle,I=this.m_stiffness,Ja=d.step.dt,this.m_gamma=Ja*(this.m_damping+Ja*I),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=n*Ja*I*this.m_gamma,n=ia+ta+this.m_gamma,this.m_mass.ez.z=0!==n?1/n:0):(Ja.GetSymInverse33(this.m_mass),this.m_bias=this.m_gamma=0);d.step.warmStarting?(this.m_impulse.SelfMul(d.step.dtRatio),n=Yc.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y),u.SelfMulSub(Z,n),C-=ia*(z.CrossVV(this.m_rA,n)+this.m_impulse.z),L.SelfMulAdd(ka,
n),U+=ta*(z.CrossVV(this.m_rB,n)+this.m_impulse.z)):this.m_impulse.SetZero();d.velocities[this.m_indexA].w=C;d.velocities[this.m_indexB].w=U}SolveVelocityConstraints(d){const n=d.velocities[this.m_indexA].v;let u=d.velocities[this.m_indexA].w;const C=d.velocities[this.m_indexB].v;let I=d.velocities[this.m_indexB].w;const L=this.m_invMassA,U=this.m_invMassB,Z=this.m_invIA,ka=this.m_invIB;if(0<this.m_stiffness){var ia=-this.m_mass.ez.z*(I-u+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=
ia;u-=Z*ia;I+=ka*ia;ia=z.SubVV(z.AddVCrossSV(C,I,this.m_rB,z.s_t0),z.AddVCrossSV(n,u,this.m_rA,z.s_t1),Yc.SolveVelocityConstraints_s_Cdot1);ia=Wb.MulM33XY(this.m_mass,ia.x,ia.y,Yc.SolveVelocityConstraints_s_impulse1).SelfNeg();this.m_impulse.x+=ia.x;this.m_impulse.y+=ia.y;n.SelfMulSub(L,ia);u-=Z*z.CrossVV(this.m_rA,ia);C.SelfMulAdd(U,ia);I+=ka*z.CrossVV(this.m_rB,ia)}else{ia=z.SubVV(z.AddVCrossSV(C,I,this.m_rB,z.s_t0),z.AddVCrossSV(n,u,this.m_rA,z.s_t1),Yc.SolveVelocityConstraints_s_Cdot1);ia=Wb.MulM33XYZ(this.m_mass,
ia.x,ia.y,I-u,Yc.SolveVelocityConstraints_s_impulse).SelfNeg();this.m_impulse.SelfAdd(ia);const ta=Yc.SolveVelocityConstraints_s_P.Set(ia.x,ia.y);n.SelfMulSub(L,ta);u-=Z*(z.CrossVV(this.m_rA,ta)+ia.z);C.SelfMulAdd(U,ta);I+=ka*(z.CrossVV(this.m_rB,ta)+ia.z)}d.velocities[this.m_indexA].w=u;d.velocities[this.m_indexB].w=I}SolvePositionConstraints(d){const n=d.positions[this.m_indexA].c;let u=d.positions[this.m_indexA].a;const C=d.positions[this.m_indexB].c;let I=d.positions[this.m_indexB].a;var L=this.m_qA.SetAngle(u),
U=this.m_qB.SetAngle(I);const Z=this.m_invMassA,ka=this.m_invMassB,ia=this.m_invIA,ta=this.m_invIB;z.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var Ja=ib.MulRV(L,this.m_lalcA,this.m_rA);z.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var Oa=ib.MulRV(U,this.m_lalcB,this.m_rB),Xa=this.m_K;Xa.ex.x=Z+ka+Ja.y*Ja.y*ia+Oa.y*Oa.y*ta;Xa.ey.x=-Ja.y*Ja.x*ia-Oa.y*Oa.x*ta;Xa.ez.x=-Ja.y*ia-Oa.y*ta;Xa.ex.y=Xa.ey.x;Xa.ey.y=Z+ka+Ja.x*Ja.x*ia+Oa.x*Oa.x*ta;Xa.ez.y=Ja.x*ia+Oa.x*ta;Xa.ex.z=
Xa.ez.x;Xa.ey.z=Xa.ez.y;Xa.ez.z=ia+ta;if(0<this.m_stiffness){const zb=z.SubVV(z.AddVV(C,Oa,z.s_t0),z.AddVV(n,Ja,z.s_t1),Yc.SolvePositionConstraints_s_C1);U=zb.Length();L=0;Xa=Xa.Solve22(zb.x,zb.y,Yc.SolvePositionConstraints_s_P).SelfNeg();n.SelfMulSub(Z,Xa);u-=ia*z.CrossVV(Ja,Xa);C.SelfMulAdd(ka,Xa);I+=ta*z.CrossVV(Oa,Xa)}else Ja=z.SubVV(z.AddVV(C,Oa,z.s_t0),z.AddVV(n,Ja,z.s_t1),Yc.SolvePositionConstraints_s_C1),Oa=I-u-this.m_referenceAngle,U=Ja.Length(),L=eb(Oa),Ja=Xa.Solve33(Ja.x,Ja.y,Oa,Yc.SolvePositionConstraints_s_impulse).SelfNeg(),
Xa=Yc.SolvePositionConstraints_s_P.Set(Ja.x,Ja.y),n.SelfMulSub(Z,Xa),u-=ia*(z.CrossVV(this.m_rA,Xa)+Ja.z),C.SelfMulAdd(ka,Xa),I+=ta*(z.CrossVV(this.m_rB,Xa)+Ja.z);d.positions[this.m_indexA].a=u;d.positions[this.m_indexB].a=I;return.005>=U&&L<=xb}GetAnchorA(d){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,d)}GetAnchorB(d){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,d)}GetReactionForce(d,n){n.x=d*this.m_impulse.x;n.y=d*this.m_impulse.y;return n}GetReactionTorque(d){return d*this.m_impulse.z}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}SetStiffness(d){this.m_stiffness=
d}GetStiffness(){return this.m_stiffness}SetDamping(d){this.m_damping=d}GetDamping(){return this.m_damping}Dump(d){const n=this.m_bodyA.m_islandIndex,u=this.m_bodyB.m_islandIndex;d("  const jd: b2WeldJointDef = new b2WeldJointDef();\n");d("  jd.bodyA = bodies[%d];\n",n);d("  jd.bodyB = bodies[%d];\n",u);d("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false");d("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);d("  jd.localAnchorB.Set(%.15f, %.15f);\n",
this.m_localAnchorB.x,this.m_localAnchorB.y);d("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle);d("  jd.stiffness = %.15f;\n",this.m_stiffness);d("  jd.damping = %.15f;\n",this.m_damping);d("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}Yc.InitVelocityConstraints_s_P=new z;Yc.SolveVelocityConstraints_s_Cdot1=new z;Yc.SolveVelocityConstraints_s_impulse1=new z;Yc.SolveVelocityConstraints_s_impulse=new Rb;Yc.SolveVelocityConstraints_s_P=new z;Yc.SolvePositionConstraints_s_C1=
new z;Yc.SolvePositionConstraints_s_P=new z;Yc.SolvePositionConstraints_s_impulse=new Rb;class Sl extends Dd{constructor(){super(a.JointType.e_wheelJoint);this.localAnchorA=new z(0,0);this.localAnchorB=new z(0,0);this.localAxisA=new z(1,0);this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.damping=this.stiffness=this.motorSpeed=this.maxMotorTorque=0}Initialize(d,n,u,C){this.bodyA=d;this.bodyB=n;this.bodyA.GetLocalPoint(u,this.localAnchorA);this.bodyB.GetLocalPoint(u,
this.localAnchorB);this.bodyA.GetLocalVector(C,this.localAxisA)}}class uc extends $c{constructor(d){super(d);this.m_localAnchorA=new z;this.m_localAnchorB=new z;this.m_localXAxisA=new z;this.m_localYAxisA=new z;this.m_motorSpeed=this.m_maxMotorTorque=this.m_upperTranslation=this.m_lowerTranslation=this.m_translation=this.m_upperImpulse=this.m_lowerImpulse=this.m_springImpulse=this.m_motorImpulse=this.m_impulse=0;this.m_enableMotor=this.m_enableLimit=!1;this.m_indexB=this.m_indexA=this.m_damping=this.m_stiffness=
0;this.m_localCenterA=new z;this.m_localCenterB=new z;this.m_invIB=this.m_invIA=this.m_invMassB=this.m_invMassA=0;this.m_ax=new z;this.m_ay=new z;this.m_gamma=this.m_bias=this.m_springMass=this.m_axialMass=this.m_motorMass=this.m_mass=this.m_sBy=this.m_sAy=this.m_sBx=this.m_sAx=0;this.m_qA=new ib;this.m_qB=new ib;this.m_lalcA=new z;this.m_lalcB=new z;this.m_rA=new z;this.m_rB=new z;this.m_localAnchorA.Copy(b(d.localAnchorA,z.ZERO));this.m_localAnchorB.Copy(b(d.localAnchorB,z.ZERO));this.m_localXAxisA.Copy(b(d.localAxisA,
z.UNITX));z.CrossOneV(this.m_localXAxisA,this.m_localYAxisA);this.m_lowerTranslation=b(d.lowerTranslation,0);this.m_upperTranslation=b(d.upperTranslation,0);this.m_enableLimit=b(d.enableLimit,!1);this.m_maxMotorTorque=b(d.maxMotorTorque,0);this.m_motorSpeed=b(d.motorSpeed,0);this.m_enableMotor=b(d.enableMotor,!1);this.m_ax.SetZero();this.m_ay.SetZero();this.m_stiffness=b(d.stiffness,0);this.m_damping=b(d.damping,0)}GetMotorSpeed(){return this.m_motorSpeed}GetMaxMotorTorque(){return this.m_maxMotorTorque}SetSpringFrequencyHz(d){this.m_stiffness=
d}GetSpringFrequencyHz(){return this.m_stiffness}SetSpringDampingRatio(d){this.m_damping=d}GetSpringDampingRatio(){return this.m_damping}InitVelocityConstraints(d){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;
var n=this.m_invMassA,u=this.m_invMassB,C=this.m_invIA,I=this.m_invIB,L=d.positions[this.m_indexA].c;const U=d.velocities[this.m_indexA].v;let Z=d.velocities[this.m_indexA].w;const ka=d.positions[this.m_indexB].c;var ia=d.positions[this.m_indexB].a;const ta=d.velocities[this.m_indexB].v;let Ja=d.velocities[this.m_indexB].w;var Oa=this.m_qA.SetAngle(d.positions[this.m_indexA].a),Xa=this.m_qB.SetAngle(ia);z.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);ia=ib.MulRV(Oa,this.m_lalcA,this.m_rA);
z.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);Xa=ib.MulRV(Xa,this.m_lalcB,this.m_rB);L=z.SubVV(z.AddVV(ka,Xa,z.s_t0),z.AddVV(L,ia,z.s_t1),uc.InitVelocityConstraints_s_d);ib.MulRV(Oa,this.m_localYAxisA,this.m_ay);this.m_sAy=z.CrossVV(z.AddVV(L,ia,z.s_t0),this.m_ay);this.m_sBy=z.CrossVV(Xa,this.m_ay);this.m_mass=n+u+C*this.m_sAy*this.m_sAy+I*this.m_sBy*this.m_sBy;0<this.m_mass&&(this.m_mass=1/this.m_mass);ib.MulRV(Oa,this.m_localXAxisA,this.m_ax);this.m_sAx=z.CrossVV(z.AddVV(L,ia,z.s_t0),
this.m_ax);this.m_sBx=z.CrossVV(Xa,this.m_ax);n=n+u+C*this.m_sAx*this.m_sAx+I*this.m_sBx*this.m_sBx;this.m_axialMass=0<n?1/n:0;this.m_gamma=this.m_bias=this.m_springMass=0;0<this.m_stiffness&&0<n?(this.m_springMass=1/n,u=z.DotVV(L,this.m_ax),Oa=d.step.dt,this.m_gamma=Oa*(this.m_damping+Oa*this.m_stiffness),0<this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_bias=u*Oa*this.m_stiffness*this.m_gamma,this.m_springMass=n+this.m_gamma,0<this.m_springMass&&(this.m_springMass=1/this.m_springMass)):this.m_springImpulse=
0;this.m_enableLimit?this.m_translation=z.DotVV(this.m_ax,L):this.m_upperImpulse=this.m_lowerImpulse=0;this.m_enableMotor?(this.m_motorMass=C+I,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass)):this.m_motorImpulse=this.m_motorMass=0;d.step.warmStarting?(this.m_impulse*=d.step.dtRatio,this.m_springImpulse*=d.step.dtRatio,this.m_motorImpulse*=d.step.dtRatio,n=this.m_springImpulse+this.m_lowerImpulse-this.m_upperImpulse,C=z.AddVV(z.MulSV(this.m_impulse,this.m_ay,z.s_t0),z.MulSV(n,this.m_ax,
z.s_t1),uc.InitVelocityConstraints_s_P),I=this.m_impulse*this.m_sAy+n*this.m_sAx+this.m_motorImpulse,n=this.m_impulse*this.m_sBy+n*this.m_sBx+this.m_motorImpulse,U.SelfMulSub(this.m_invMassA,C),Z-=this.m_invIA*I,ta.SelfMulAdd(this.m_invMassB,C),Ja+=this.m_invIB*n):this.m_upperImpulse=this.m_lowerImpulse=this.m_motorImpulse=this.m_springImpulse=this.m_impulse=0;d.velocities[this.m_indexA].w=Z;d.velocities[this.m_indexB].w=Ja}SolveVelocityConstraints(d){const n=this.m_invMassA,u=this.m_invMassB,C=this.m_invIA,
I=this.m_invIB,L=d.velocities[this.m_indexA].v;let U=d.velocities[this.m_indexA].w;const Z=d.velocities[this.m_indexB].v;let ka=d.velocities[this.m_indexB].w;var ia=z.DotVV(this.m_ax,z.SubVV(Z,L,z.s_t0))+this.m_sBx*ka-this.m_sAx*U,ta=-this.m_springMass*(ia+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=ta;ia=z.MulSV(ta,this.m_ax,uc.SolveVelocityConstraints_s_P);var Ja=ta*this.m_sAx;ta*=this.m_sBx;L.SelfMulSub(n,ia);U-=C*Ja;Z.SelfMulAdd(u,ia);ka+=I*ta;ia=-this.m_motorMass*(ka-
U-this.m_motorSpeed);Ja=this.m_motorImpulse;ta=d.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=g(this.m_motorImpulse+ia,-ta,ta);ia=this.m_motorImpulse-Ja;U-=C*ia;ka+=I*ia;this.m_enableLimit&&(ia=this.m_translation-this.m_lowerTranslation,Ja=z.DotVV(this.m_ax,z.SubVV(Z,L,z.s_t0))+this.m_sBx*ka-this.m_sAx*U,ia=-this.m_axialMass*(Ja+h(ia,0)*d.step.inv_dt),Ja=this.m_lowerImpulse,this.m_lowerImpulse=h(this.m_lowerImpulse+ia,0),ia=this.m_lowerImpulse-Ja,Ja=z.MulSV(ia,this.m_ax,uc.SolveVelocityConstraints_s_P),
ta=ia*this.m_sAx,ia*=this.m_sBx,L.SelfMulSub(n,Ja),U-=C*ta,Z.SelfMulAdd(u,Ja),ka+=I*ia,ia=this.m_upperTranslation-this.m_translation,Ja=z.DotVV(this.m_ax,z.SubVV(L,Z,z.s_t0))+this.m_sAx*U-this.m_sBx*ka,ia=-this.m_axialMass*(Ja+h(ia,0)*d.step.inv_dt),Ja=this.m_upperImpulse,this.m_upperImpulse=h(this.m_upperImpulse+ia,0),ia=this.m_upperImpulse-Ja,Ja=z.MulSV(ia,this.m_ax,uc.SolveVelocityConstraints_s_P),ta=ia*this.m_sAx,ia*=this.m_sBx,L.SelfMulAdd(n,Ja),U+=C*ta,Z.SelfMulSub(u,Ja),ka-=I*ia);ia=z.DotVV(this.m_ay,
z.SubVV(Z,L,z.s_t0))+this.m_sBy*ka-this.m_sAy*U;ta=-this.m_mass*ia;this.m_impulse+=ta;ia=z.MulSV(ta,this.m_ay,uc.SolveVelocityConstraints_s_P);Ja=ta*this.m_sAy;ta*=this.m_sBy;L.SelfMulSub(n,ia);U-=C*Ja;Z.SelfMulAdd(u,ia);d.velocities[this.m_indexA].w=U;d.velocities[this.m_indexB].w=ka+I*ta}SolvePositionConstraints(d){const n=d.positions[this.m_indexA].c;let u=d.positions[this.m_indexA].a;const C=d.positions[this.m_indexB].c;let I=d.positions[this.m_indexB].a;var L=0;if(this.m_enableLimit){var U=this.m_qA.SetAngle(u),
Z=this.m_qB.SetAngle(I);z.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var ka=ib.MulRV(U,this.m_lalcA,this.m_rA);z.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var ia=ib.MulRV(Z,this.m_lalcB,this.m_rB),ta=z.AddVV(z.SubVV(C,n,z.s_t0),z.SubVV(ia,ka,z.s_t1),uc.SolvePositionConstraints_s_d);U=ib.MulRV(U,this.m_localXAxisA,this.m_ax);Z=z.CrossVV(z.AddVV(ta,ka,z.s_t0),this.m_ax);ia=z.CrossVV(ia,this.m_ax);ka=0;ta=z.DotVV(U,ta);.01>eb(this.m_upperTranslation-this.m_lowerTranslation)?
ka=ta:ta<=this.m_lowerTranslation?ka=f(ta-this.m_lowerTranslation,0):ta>=this.m_upperTranslation&&(ka=h(ta-this.m_upperTranslation,0));0!==ka&&(ta=this.m_invMassA+this.m_invMassB+this.m_invIA*Z*Z+this.m_invIB*ia*ia,L=0,0!==ta&&(L=-ka/ta),U=z.MulSV(L,U,uc.SolvePositionConstraints_s_P),Z*=L,L*=ia,n.SelfMulSub(this.m_invMassA,U),u-=this.m_invIA*Z,C.SelfMulAdd(this.m_invMassB,U),I+=this.m_invIB*L,L=eb(ka))}ka=this.m_qA.SetAngle(u);Z=this.m_qB.SetAngle(I);z.SubVV(this.m_localAnchorA,this.m_localCenterA,
this.m_lalcA);U=ib.MulRV(ka,this.m_lalcA,this.m_rA);z.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);Z=ib.MulRV(Z,this.m_lalcB,this.m_rB);ia=z.AddVV(z.SubVV(C,n,z.s_t0),z.SubVV(Z,U,z.s_t1),uc.SolvePositionConstraints_s_d);ka=ib.MulRV(ka,this.m_localYAxisA,this.m_ay);U=z.CrossVV(z.AddVV(ia,U,z.s_t0),ka);Z=z.CrossVV(Z,ka);ia=z.DotVV(ia,ka);const Ja=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;ta=0;0!==Ja&&(ta=-ia/Ja);ka=z.MulSV(ta,
ka,uc.SolvePositionConstraints_s_P);U*=ta;Z*=ta;n.SelfMulSub(this.m_invMassA,ka);u-=this.m_invIA*U;C.SelfMulAdd(this.m_invMassB,ka);I+=this.m_invIB*Z;L=h(L,eb(ia));d.positions[this.m_indexA].a=u;d.positions[this.m_indexB].a=I;return.005>=L}GetDefinition(d){return d}GetAnchorA(d){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,d)}GetAnchorB(d){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,d)}GetReactionForce(d,n){n.x=d*(this.m_impulse*this.m_ay.x+(this.m_springImpulse+this.m_lowerImpulse-
this.m_upperImpulse)*this.m_ax.x);n.y=d*(this.m_impulse*this.m_ay.y+(this.m_springImpulse+this.m_lowerImpulse-this.m_upperImpulse)*this.m_ax.y);return n}GetReactionTorque(d){return d*this.m_motorImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetJointTranslation(){return this.GetPrismaticJointTranslation()}GetJointLinearSpeed(){return this.GetPrismaticJointSpeed()}GetJointAngle(){return this.GetRevoluteJointAngle()}GetJointAngularSpeed(){return this.GetRevoluteJointSpeed()}GetPrismaticJointTranslation(){var d=
this.m_bodyA,n=this.m_bodyB,u=d.GetWorldPoint(this.m_localAnchorA,new z);n=n.GetWorldPoint(this.m_localAnchorB,new z);u=z.SubVV(n,u,new z);d=d.GetWorldVector(this.m_localXAxisA,new z);return z.DotVV(u,d)}GetPrismaticJointSpeed(){var d=this.m_bodyA,n=this.m_bodyB;z.SubVV(this.m_localAnchorA,d.m_sweep.localCenter,this.m_lalcA);const u=ib.MulRV(d.m_xf.q,this.m_lalcA,this.m_rA);z.SubVV(this.m_localAnchorB,n.m_sweep.localCenter,this.m_lalcB);const C=ib.MulRV(n.m_xf.q,this.m_lalcB,this.m_rB);var I=z.AddVV(d.m_sweep.c,
u,z.s_t0),L=z.AddVV(n.m_sweep.c,C,z.s_t1);I=z.SubVV(L,I,z.s_t2);L=d.GetWorldVector(this.m_localXAxisA,new z);const U=d.m_linearVelocity,Z=n.m_linearVelocity;d=d.m_angularVelocity;n=n.m_angularVelocity;return z.DotVV(I,z.CrossSV(d,L,z.s_t0))+z.DotVV(L,z.SubVV(z.AddVCrossSV(Z,n,C,z.s_t0),z.AddVCrossSV(U,d,u,z.s_t1),z.s_t0))}GetRevoluteJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a}GetRevoluteJointSpeed(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(d){d!==
this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=d)}SetMotorSpeed(d){d!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=d)}SetMaxMotorTorque(d){d!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=d)}GetMotorTorque(d){return d*this.m_motorImpulse}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(d){d!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),
this.m_enableLimit=d,this.m_upperImpulse=this.m_lowerImpulse=0)}GetLowerLimit(){return this.m_lowerTranslation}GetUpperLimit(){return this.m_upperTranslation}SetLimits(d,n){if(d!==this.m_lowerTranslation||n!==this.m_upperTranslation)this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=d,this.m_upperTranslation=n,this.m_upperImpulse=this.m_lowerImpulse=0}Dump(d){const n=this.m_bodyA.m_islandIndex,u=this.m_bodyB.m_islandIndex;d("  const jd: b2WheelJointDef = new b2WheelJointDef();\n");
d("  jd.bodyA = bodies[%d];\n",n);d("  jd.bodyB = bodies[%d];\n",u);d("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false");d("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);d("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);d("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y);d("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false");d("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed);
d("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque);d("  jd.stiffness = %.15f;\n",this.m_stiffness);d("  jd.damping = %.15f;\n",this.m_damping);d("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}Draw(d){var n=this.m_bodyA.GetTransform(),u=this.m_bodyB.GetTransform();const C=rb.MulXV(n,this.m_localAnchorA,uc.Draw_s_pA);u=rb.MulXV(u,this.m_localAnchorB,uc.Draw_s_pB);var I=ib.MulRV(n.q,this.m_localXAxisA,uc.Draw_s_axis);const L=uc.Draw_s_c1,U=uc.Draw_s_c2,Z=uc.Draw_s_c3,ka=uc.Draw_s_c4;
d.DrawSegment(C,u,uc.Draw_s_c5);if(this.m_enableLimit){const ia=z.AddVMulSV(C,this.m_lowerTranslation,I,uc.Draw_s_lower);I=z.AddVMulSV(C,this.m_upperTranslation,I,uc.Draw_s_upper);n=ib.MulRV(n.q,this.m_localYAxisA,uc.Draw_s_perp);d.DrawSegment(ia,I,L);d.DrawSegment(z.AddVMulSV(ia,-.5,n,z.s_t0),z.AddVMulSV(ia,.5,n,z.s_t1),U);d.DrawSegment(z.AddVMulSV(I,-.5,n,z.s_t0),z.AddVMulSV(I,.5,n,z.s_t1),Z)}else d.DrawSegment(z.AddVMulSV(C,-1,I,z.s_t0),z.AddVMulSV(C,1,I,z.s_t1),L);d.DrawPoint(C,5,L);d.DrawPoint(u,
5,ka)}}uc.InitVelocityConstraints_s_d=new z;uc.InitVelocityConstraints_s_P=new z;uc.SolveVelocityConstraints_s_P=new z;uc.SolvePositionConstraints_s_d=new z;uc.SolvePositionConstraints_s_P=new z;uc.Draw_s_pA=new z;uc.Draw_s_pB=new z;uc.Draw_s_axis=new z;uc.Draw_s_c1=new ya(.7,.7,.7);uc.Draw_s_c2=new ya(.3,.9,.3);uc.Draw_s_c3=new ya(.9,.3,.3);uc.Draw_s_c4=new ya(.3,.3,.9);uc.Draw_s_c5=new ya(.4,.4,.4);uc.Draw_s_lower=new z;uc.Draw_s_upper=new z;uc.Draw_s_perp=new z;(function(d){d[d.b2_waterParticle=
0]="b2_waterParticle";d[d.b2_zombieParticle=2]="b2_zombieParticle";d[d.b2_wallParticle=4]="b2_wallParticle";d[d.b2_springParticle=8]="b2_springParticle";d[d.b2_elasticParticle=16]="b2_elasticParticle";d[d.b2_viscousParticle=32]="b2_viscousParticle";d[d.b2_powderParticle=64]="b2_powderParticle";d[d.b2_tensileParticle=128]="b2_tensileParticle";d[d.b2_colorMixingParticle=256]="b2_colorMixingParticle";d[d.b2_destructionListenerParticle=512]="b2_destructionListenerParticle";d[d.b2_barrierParticle=1024]=
"b2_barrierParticle";d[d.b2_staticPressureParticle=2048]="b2_staticPressureParticle";d[d.b2_reactiveParticle=4096]="b2_reactiveParticle";d[d.b2_repulsiveParticle=8192]="b2_repulsiveParticle";d[d.b2_fixtureContactListenerParticle=16384]="b2_fixtureContactListenerParticle";d[d.b2_particleContactListenerParticle=32768]="b2_particleContactListenerParticle";d[d.b2_fixtureContactFilterParticle=65536]="b2_fixtureContactFilterParticle";d[d.b2_particleContactFilterParticle=131072]="b2_particleContactFilterParticle"})(a.ParticleFlag||
(a.ParticleFlag={}));class Zg{constructor(){this.flags=0;this.position=new z;this.velocity=new z;this.color=new ya(0,0,0,0);this.lifetime=0;this.group=this.userData=null}}class vi{constructor(){this.m_index=-1}GetIndex(){return this.m_index}SetIndex(d){this.m_index=d}}(function(d){d[d.b2_solidParticleGroup=1]="b2_solidParticleGroup";d[d.b2_rigidParticleGroup=2]="b2_rigidParticleGroup";d[d.b2_particleGroupCanBeEmpty=4]="b2_particleGroupCanBeEmpty";d[d.b2_particleGroupWillBeDestroyed=8]="b2_particleGroupWillBeDestroyed";
d[d.b2_particleGroupNeedsUpdateDepth=16]="b2_particleGroupNeedsUpdateDepth";d[d.b2_particleGroupInternalMask=24]="b2_particleGroupInternalMask"})(a.ParticleGroupFlag||(a.ParticleGroupFlag={}));class wi{constructor(){this.groupFlags=this.flags=0;this.position=new z;this.angle=0;this.linearVelocity=new z;this.angularVelocity=0;this.color=new ya;this.strength=1;this.lifetime=this.particleCount=this.stride=this.shapeCount=0;this.group=this.userData=null}}class hg{constructor(d){this.m_groupFlags=this.m_lastIndex=
this.m_firstIndex=0;this.m_strength=1;this.m_next=this.m_prev=null;this.m_timestamp=-1;this.m_inertia=this.m_mass=0;this.m_center=new z;this.m_linearVelocity=new z;this.m_angularVelocity=0;this.m_transform=new rb;this.m_userData=null;this.m_system=d}GetNext(){return this.m_next}GetParticleSystem(){return this.m_system}GetParticleCount(){return this.m_lastIndex-this.m_firstIndex}GetBufferIndex(){return this.m_firstIndex}ContainsParticle(d){return this.m_firstIndex<=d&&d<this.m_lastIndex}GetAllParticleFlags(){if(!this.m_system.m_flagsBuffer.data)throw Error();
let d=0;for(let n=this.m_firstIndex;n<this.m_lastIndex;n++)d|=this.m_system.m_flagsBuffer.data[n];return d}GetGroupFlags(){return this.m_groupFlags}SetGroupFlags(d){d|=this.m_groupFlags&a.ParticleGroupFlag.b2_particleGroupInternalMask;this.m_system.SetGroupFlags(this,d)}GetMass(){this.UpdateStatistics();return this.m_mass}GetInertia(){this.UpdateStatistics();return this.m_inertia}GetCenter(){this.UpdateStatistics();return this.m_center}GetLinearVelocity(){this.UpdateStatistics();return this.m_linearVelocity}GetAngularVelocity(){this.UpdateStatistics();
return this.m_angularVelocity}GetTransform(){return this.m_transform}GetPosition(){return this.m_transform.p}GetAngle(){return this.m_transform.q.GetAngle()}GetLinearVelocityFromWorldPoint(d,n){const u=hg.GetLinearVelocityFromWorldPoint_s_t0;this.UpdateStatistics();return z.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,z.SubVV(d,this.m_center,u),n)}GetUserData(){return this.m_userData}SetUserData(d){this.m_userData=d}ApplyForce(d){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,
d)}ApplyLinearImpulse(d){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,d)}DestroyParticles(d){if(this.m_system.m_world.IsLocked())throw Error();for(let n=this.m_firstIndex;n<this.m_lastIndex;n++)this.m_system.DestroyParticle(n,d)}UpdateStatistics(){if(!this.m_system.m_positionBuffer.data)throw Error();if(!this.m_system.m_velocityBuffer.data)throw Error();const d=new z,n=new z;if(this.m_timestamp!==this.m_system.m_timestamp){const C=this.m_system.GetParticleMass();this.m_mass=
C*(this.m_lastIndex-this.m_firstIndex);this.m_center.SetZero();this.m_linearVelocity.SetZero();for(var u=this.m_firstIndex;u<this.m_lastIndex;u++)this.m_center.SelfMulAdd(C,this.m_system.m_positionBuffer.data[u]),this.m_linearVelocity.SelfMulAdd(C,this.m_system.m_velocityBuffer.data[u]);0<this.m_mass&&(u=1/this.m_mass,this.m_center.SelfMul(u),this.m_linearVelocity.SelfMul(u));this.m_angularVelocity=this.m_inertia=0;for(u=this.m_firstIndex;u<this.m_lastIndex;u++)z.SubVV(this.m_system.m_positionBuffer.data[u],
this.m_center,d),z.SubVV(this.m_system.m_velocityBuffer.data[u],this.m_linearVelocity,n),this.m_inertia+=C*z.DotVV(d,d),this.m_angularVelocity+=C*z.CrossVV(d,n);0<this.m_inertia&&(this.m_angularVelocity*=1/this.m_inertia);this.m_timestamp=this.m_system.m_timestamp}}}hg.GetLinearVelocityFromWorldPoint_s_t0=new z;class xi{constructor(d){this.m_buffer=[];this.m_back=this.m_front=0;this.m_buffer.fill(null,0,d)}get m_capacity(){return this.m_buffer.length}Push(d){if(this.m_back>=this.m_capacity){for(let n=
this.m_front;n<this.m_back;n++)this.m_buffer[n-this.m_front]=this.m_buffer[n];this.m_back-=this.m_front;this.m_front=0}this.m_buffer[this.m_back]=d;this.m_back++}Pop(){this.m_buffer[this.m_front]=null;this.m_front++}Empty(){return this.m_front===this.m_back}Front(){const d=this.m_buffer[this.m_front];if(!d)throw Error();return d}}class yi{constructor(d){this.m_countY=this.m_countX=this.m_generatorCount=this.m_generatorCapacity=0;this.m_diagram=[];this.m_generatorBuffer=l(d,()=>new zi);this.m_generatorCapacity=
d}AddGenerator(d,n,u){const C=this.m_generatorBuffer[this.m_generatorCount++];C.center.Copy(d);C.tag=n;C.necessary=u}Generate(d,n){d=1/d;var u=new z(1E37,1E37),C=new z(-1E37,-1E37),I=0;for(var L=0;L<this.m_generatorCount;L++){var U=this.m_generatorBuffer[L];U.necessary&&(z.MinV(u,U.center,u),z.MaxV(C,U.center,C),++I)}if(0===I)this.m_countY=this.m_countX=0;else{u.x-=n;u.y-=n;C.x+=n;C.y+=n;this.m_countX=1+Math.floor(d*(C.x-u.x));this.m_countY=1+Math.floor(d*(C.y-u.y));this.m_diagram=[];n=new xi(4*this.m_countX*
this.m_countY);for(C=0;C<this.m_generatorCount;C++)I=this.m_generatorBuffer[C],I.center.SelfSub(u).SelfMul(d),L=Math.floor(I.center.x),U=Math.floor(I.center.y),0<=L&&0<=U&&L<this.m_countX&&U<this.m_countY&&n.Push(new wd(L,U,L+U*this.m_countX,I));for(;!n.Empty();)I=n.Front(),d=I.m_x,u=I.m_y,C=I.m_i,I=I.m_generator,n.Pop(),this.m_diagram[C]||(this.m_diagram[C]=I,0<d&&n.Push(new wd(d-1,u,C-1,I)),0<u&&n.Push(new wd(d,u-1,C-this.m_countX,I)),d<this.m_countX-1&&n.Push(new wd(d+1,u,C+1,I)),u<this.m_countY-
1&&n.Push(new wd(d,u+1,C+this.m_countX,I)));for(d=0;d<this.m_countY;d++)for(u=0;u<this.m_countX-1;u++)C=u+d*this.m_countX,I=this.m_diagram[C],L=this.m_diagram[C+1],I!==L&&(n.Push(new wd(u,d,C,L)),n.Push(new wd(u+1,d,C+1,I)));for(d=0;d<this.m_countY-1;d++)for(u=0;u<this.m_countX;u++)C=u+d*this.m_countX,I=this.m_diagram[C],L=this.m_diagram[C+this.m_countX],I!==L&&(n.Push(new wd(u,d,C,L)),n.Push(new wd(u,d+1,C+this.m_countX,I)));for(;!n.Empty();)if(I=n.Front(),d=I.m_x,u=I.m_y,C=I.m_i,I=I.m_generator,
n.Pop(),U=this.m_diagram[C],U!==I){L=U.center.x-d;U=U.center.y-u;const Z=I.center.x-d,ka=I.center.y-u;L*L+U*U>Z*Z+ka*ka&&(this.m_diagram[C]=I,0<d&&n.Push(new wd(d-1,u,C-1,I)),0<u&&n.Push(new wd(d,u-1,C-this.m_countX,I)),d<this.m_countX-1&&n.Push(new wd(d+1,u,C+1,I)),u<this.m_countY-1&&n.Push(new wd(d,u+1,C+this.m_countX,I)))}}}GetNodes(d){for(let u=0;u<this.m_countY-1;u++)for(let C=0;C<this.m_countX-1;C++){var n=C+u*this.m_countX;const I=this.m_diagram[n],L=this.m_diagram[n+1],U=this.m_diagram[n+
this.m_countX];n=this.m_diagram[n+1+this.m_countX];L!==U&&(I!==L&&I!==U&&(I.necessary||L.necessary||U.necessary)&&d(I.tag,L.tag,U.tag),n!==L&&n!==U&&(I.necessary||L.necessary||U.necessary)&&d(L.tag,n.tag,U.tag))}}}class zi{constructor(){this.center=new z;this.tag=0;this.necessary=!1}}class wd{constructor(d,n,u,C){this.m_x=d;this.m_y=n;this.m_i=u;this.m_generator=C}}class Ie{constructor(d){this.data=[];this.capacity=this.count=0;this.allocator=d}Append(){this.count>=this.capacity&&this.Grow();return this.count++}Reserve(d){if(!(this.capacity>=
d)){for(let n=this.capacity;n<d;++n)this.data[n]=this.allocator();this.capacity=d}}Grow(){this.Reserve(this.capacity?2*this.capacity:256)}Free(){0!==this.data.length&&(this.data=[],this.count=this.capacity=0)}Shorten(){}Data(){return this.data}GetCount(){return this.count}SetCount(d){this.count=d}GetCapacity(){return this.capacity}RemoveIf(d){this.count=Ga(this.data,d,this.count)}Unique(d){var n=this.data,u=0,C=this.count;if(u===C)d=C;else{for(var I=u;++u!==C;)d(n[I],n[u])||Fa(n,++I,u);d=++I}this.count=
d}}class $g extends Wd{constructor(d){super();this.m_system=d}ShouldQueryParticleSystem(){return!1}ReportFixture(d){if(d.IsSensor())return!0;const n=d.GetShape().GetChildCount();for(let C=0;C<n;C++){var u=d.GetAABB(C);u=this.m_system.GetInsideBoundsEnumerator(u);let I;for(;0<=(I=u.GetNext());)this.ReportFixtureAndParticle(d,C,I)}return!0}ReportParticle(){return!1}ReportFixtureAndParticle(){}}class Ai{constructor(){this.weight=this.indexB=this.indexA=0;this.normal=new z;this.flags=0}SetIndices(d,n){this.indexA=
d;this.indexB=n}SetWeight(d){this.weight=d}SetNormal(d){this.normal.Copy(d)}SetFlags(d){this.flags=d}GetIndexA(){return this.indexA}GetIndexB(){return this.indexB}GetWeight(){return this.weight}GetNormal(){return this.normal}GetFlags(){return this.flags}IsEqual(d){return this.indexA===d.indexA&&this.indexB===d.indexB&&this.flags===d.flags&&this.weight===d.weight&&this.normal.x===d.normal.x&&this.normal.y===d.normal.y}IsNotEqual(d){return!this.IsEqual(d)}ApproximatelyEqual(d){return this.indexA===
d.indexA&&this.indexB===d.indexB&&this.flags===d.flags&&.01>eb(this.weight-d.weight)&&1E-4>z.DistanceSquaredVV(this.normal,d.normal)}}class Bi{constructor(){this.weight=this.index=0;this.normal=new z;this.mass=0}}class Ci{constructor(){this.distance=this.strength=this.flags=this.indexB=this.indexA=0}}class Di{constructor(){this.strength=this.flags=this.indexC=this.indexB=this.indexA=0;this.pa=new z(0,0);this.pb=new z(0,0);this.pc=new z(0,0);this.s=this.kc=this.kb=this.ka=0}}class ah{constructor(){this.strictContactCheck=
!1;this.radius=this.gravityScale=this.density=1;this.maxCount=0;this.pressureStrength=.005;this.dampingStrength=1;this.viscousStrength=this.springStrength=this.elasticStrength=.25;this.surfaceTensionNormalStrength=this.surfaceTensionPressureStrength=.2;this.repulsiveStrength=1;this.ejectionStrength=this.powderStrength=.5;this.staticPressureRelaxation=this.staticPressureStrength=.2;this.staticPressureIterations=8;this.colorMixingStrength=.5;this.destroyByAge=!0;this.lifetimeGranularity=1/60}Copy(d){this.strictContactCheck=
d.strictContactCheck;this.density=d.density;this.gravityScale=d.gravityScale;this.radius=d.radius;this.maxCount=d.maxCount;this.pressureStrength=d.pressureStrength;this.dampingStrength=d.dampingStrength;this.elasticStrength=d.elasticStrength;this.springStrength=d.springStrength;this.viscousStrength=d.viscousStrength;this.surfaceTensionPressureStrength=d.surfaceTensionPressureStrength;this.surfaceTensionNormalStrength=d.surfaceTensionNormalStrength;this.repulsiveStrength=d.repulsiveStrength;this.powderStrength=
d.powderStrength;this.ejectionStrength=d.ejectionStrength;this.staticPressureStrength=d.staticPressureStrength;this.staticPressureRelaxation=d.staticPressureRelaxation;this.staticPressureIterations=d.staticPressureIterations;this.colorMixingStrength=d.colorMixingStrength;this.destroyByAge=d.destroyByAge;this.lifetimeGranularity=d.lifetimeGranularity;return this}Clone(){return(new ah).Copy(this)}}class nb{constructor(d,n){this.m_paused=!1;this.m_allParticleFlags=this.m_timestamp=0;this.m_needsUpdateAllParticleFlags=
!1;this.m_allGroupFlags=0;this.m_hasForce=this.m_needsUpdateAllGroupFlags=!1;this.m_internalAllocatedCapacity=this.m_count=this.m_squaredDiameter=this.m_inverseDiameter=this.m_particleDiameter=this.m_inverseDensity=this.m_iterationIndex=0;this.m_handleIndexBuffer=new Fd;this.m_flagsBuffer=new Fd;this.m_positionBuffer=new Fd;this.m_velocityBuffer=new Fd;this.m_forceBuffer=[];this.m_weightBuffer=[];this.m_staticPressureBuffer=[];this.m_accumulationBuffer=[];this.m_accumulation2Buffer=[];this.m_depthBuffer=
[];this.m_colorBuffer=new Fd;this.m_groupBuffer=[];this.m_userDataBuffer=new Fd;this.m_stuckThreshold=0;this.m_lastBodyContactStepBuffer=new Fd;this.m_bodyContactCountBuffer=new Fd;this.m_consecutiveContactStepsBuffer=new Fd;this.m_stuckParticleBuffer=new Ie(()=>0);this.m_proxyBuffer=new Ie(()=>new Je);this.m_contactBuffer=new Ie(()=>new Ai);this.m_bodyContactBuffer=new Ie(()=>new Bi);this.m_pairBuffer=new Ie(()=>new Ci);this.m_triadBuffer=new Ie(()=>new Di);this.m_expirationTimeBuffer=new Fd;this.m_indexByExpirationTimeBuffer=
new Fd;this.m_timeElapsed=0;this.m_expirationTimeBufferRequiresSorting=!1;this.m_groupCount=0;this.m_groupList=null;this.m_def=new ah;this.SolveCollision_callback=this.UpdateBodyContacts_callback=this.m_next=this.m_prev=null;this.SetStrictContactCheck(d.strictContactCheck);this.SetDensity(d.density);this.SetGravityScale(d.gravityScale);this.SetRadius(d.radius);this.SetMaxParticleCount(d.maxCount);this.m_def=d.Clone();this.m_world=n;this.SetDestructionByAge(this.m_def.destroyByAge)}static computeTag(d,
n){return(n+nb.yOffset>>>0<<nb.yShift)+(nb.xScale*d+nb.xOffset>>>0)>>>0}static computeRelativeTag(d,n,u){return d+(u<<nb.yShift)+(n<<nb.xShift)>>>0}Drop(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer);this.FreeUserOverridableBuffer(this.m_flagsBuffer);this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer);this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer);this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer);
this.FreeUserOverridableBuffer(this.m_positionBuffer);this.FreeUserOverridableBuffer(this.m_velocityBuffer);this.FreeUserOverridableBuffer(this.m_colorBuffer);this.FreeUserOverridableBuffer(this.m_userDataBuffer);this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer);this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer);this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity);this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity);this.FreeBuffer(this.m_staticPressureBuffer,
this.m_internalAllocatedCapacity);this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity);this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity);this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity);this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)}CreateParticle(d){if(this.m_world.IsLocked())throw Error();this.m_count>=this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(this.m_count?2*this.m_count:256);
if(this.m_count>=this.m_internalAllocatedCapacity)if(this.m_def.destroyByAge)this.DestroyOldestParticle(0,!1),this.SolveZombie();else return-1;const n=this.m_count++;this.m_flagsBuffer.data[n]=0;this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[n]=0);this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[n]=0);this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[n]=0);this.m_positionBuffer.data[n]=(this.m_positionBuffer.data[n]||
new z).Copy(b(d.position,z.ZERO));this.m_velocityBuffer.data[n]=(this.m_velocityBuffer.data[n]||new z).Copy(b(d.velocity,z.ZERO));this.m_weightBuffer[n]=0;this.m_forceBuffer[n]=(this.m_forceBuffer[n]||new z).SetZero();this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[n]=0);this.m_depthBuffer&&(this.m_depthBuffer[n]=0);var u=(new ya).Copy(b(d.color,ya.ZERO));if(this.m_colorBuffer.data||!u.IsZero())this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[n]=
(this.m_colorBuffer.data[n]||new ya).Copy(u);if(this.m_userDataBuffer.data||d.userData)this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[n]=d.userData;this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[n]=null);u=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()];const C=b(d.lifetime,0),I=0<C;if(this.m_expirationTimeBuffer.data||I)this.SetParticleLifetime(n,I?C:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),this.m_indexByExpirationTimeBuffer.data[n]=
n;u.index=n;u=b(d.group,null);if(this.m_groupBuffer[n]=u)u.m_firstIndex<u.m_lastIndex?this.RotateBuffer(u.m_firstIndex,u.m_lastIndex,n):u.m_firstIndex=n,u.m_lastIndex=n+1;this.SetParticleFlags(n,b(d.flags,0));return n}GetParticleHandleFromIndex(d){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);let n=this.m_handleIndexBuffer.data[d];if(n)return n;n=new vi;n.SetIndex(d);return this.m_handleIndexBuffer.data[d]=n}DestroyParticle(d,n=!1){let u=a.ParticleFlag.b2_zombieParticle;
n&&(u|=a.ParticleFlag.b2_destructionListenerParticle);this.SetParticleFlags(d,this.m_flagsBuffer.data[d]|u)}DestroyOldestParticle(d,n=!1){var u=this.GetParticleCount();u=this.m_indexByExpirationTimeBuffer.data[u-(d+1)];d=this.m_indexByExpirationTimeBuffer.data[d];this.DestroyParticle(0<this.m_expirationTimeBuffer.data[u]?u:d,n)}DestroyParticlesInShape(d,n,u=!1){const C=nb.DestroyParticlesInShape_s_aabb;if(this.m_world.IsLocked())throw Error();u=new Ei(this,d,n,u);d.ComputeAABB(C,n,0);this.m_world.QueryAABB(u,
C);return u.Destroyed()}CreateParticleGroup(d){var n=nb.CreateParticleGroup_s_transform;if(this.m_world.IsLocked())throw Error();n.SetPositionAngle(b(d.position,z.ZERO),b(d.angle,0));const u=this.m_count;d.shape&&this.CreateParticlesWithShapeForGroup(d.shape,d,n);d.shapes&&this.CreateParticlesWithShapesForGroup(d.shapes,b(d.shapeCount,d.shapes.length),d,n);if(d.positionData){var C=b(d.particleCount,d.positionData.length);for(var I=0;I<C;I++)this.CreateParticleForGroup(d,n,d.positionData[I])}C=this.m_count;
I=new hg(this);I.m_firstIndex=u;I.m_lastIndex=C;I.m_strength=b(d.strength,1);I.m_userData=d.userData;I.m_transform.Copy(n);I.m_prev=null;if(I.m_next=this.m_groupList)this.m_groupList.m_prev=I;this.m_groupList=I;++this.m_groupCount;for(n=u;n<C;n++)this.m_groupBuffer[n]=I;this.SetGroupFlags(I,b(d.groupFlags,0));n=new ig;this.UpdateContacts(!0);this.UpdatePairsAndTriads(u,C,n);d.group&&(this.JoinParticleGroups(d.group,I),I=d.group);return I}JoinParticleGroups(d,n){if(this.m_world.IsLocked())throw Error();
this.RotateBuffer(n.m_firstIndex,n.m_lastIndex,this.m_count);this.RotateBuffer(d.m_firstIndex,d.m_lastIndex,n.m_firstIndex);var u=new Fi(n.m_firstIndex);this.UpdateContacts(!0);this.UpdatePairsAndTriads(d.m_firstIndex,n.m_lastIndex,u);for(u=n.m_firstIndex;u<n.m_lastIndex;u++)this.m_groupBuffer[u]=d;this.SetGroupFlags(d,d.m_groupFlags|n.m_groupFlags);d.m_lastIndex=n.m_lastIndex;n.m_firstIndex=n.m_lastIndex;this.DestroyParticleGroup(n)}SplitParticleGroup(d){this.UpdateContacts(!0);var n=d.GetParticleCount();
n=l(n,()=>new Gi);nb.InitializeParticleLists(d,n);this.MergeParticleListsInContact(d,n);const u=nb.FindLongestParticleList(d,n);this.MergeZombieParticleListNodes(d,n,u);this.CreateParticleGroupsFromParticleList(d,n,u);this.UpdatePairsAndTriadsWithParticleList(d,n)}GetParticleGroupList(){return this.m_groupList}GetParticleGroupCount(){return this.m_groupCount}GetParticleCount(){return this.m_count}GetMaxParticleCount(){return this.m_def.maxCount}SetMaxParticleCount(d){this.m_def.maxCount=d}GetAllParticleFlags(){return this.m_allParticleFlags}GetAllGroupFlags(){return this.m_allGroupFlags}SetPaused(d){this.m_paused=
d}GetPaused(){return this.m_paused}SetDensity(d){this.m_def.density=d;this.m_inverseDensity=1/this.m_def.density}GetDensity(){return this.m_def.density}SetGravityScale(d){this.m_def.gravityScale=d}GetGravityScale(){return this.m_def.gravityScale}SetDamping(d){this.m_def.dampingStrength=d}GetDamping(){return this.m_def.dampingStrength}SetStaticPressureIterations(d){this.m_def.staticPressureIterations=d}GetStaticPressureIterations(){return this.m_def.staticPressureIterations}SetRadius(d){this.m_particleDiameter=
2*d;this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter;this.m_inverseDiameter=1/this.m_particleDiameter}GetRadius(){return this.m_particleDiameter/2}GetPositionBuffer(){return this.m_positionBuffer.data}GetVelocityBuffer(){return this.m_velocityBuffer.data}GetColorBuffer(){this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data);return this.m_colorBuffer.data}GetGroupBuffer(){return this.m_groupBuffer}GetWeightBuffer(){return this.m_weightBuffer}GetUserDataBuffer(){this.m_userDataBuffer.data=
this.RequestBuffer(this.m_userDataBuffer.data);return this.m_userDataBuffer.data}GetFlagsBuffer(){return this.m_flagsBuffer.data}SetParticleFlags(d,n){this.m_flagsBuffer.data[d]&~n&&(this.m_needsUpdateAllParticleFlags=!0);~this.m_allParticleFlags&n&&(n&a.ParticleFlag.b2_tensileParticle&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),n&a.ParticleFlag.b2_colorMixingParticle&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=n);
this.m_flagsBuffer.data[d]=n}GetParticleFlags(d){return this.m_flagsBuffer.data[d]}SetFlagsBuffer(d){this.SetUserOverridableBuffer(this.m_flagsBuffer,d)}SetPositionBuffer(d){if(d instanceof Float32Array){if(0!==d.length%2)throw Error();const n=d.length/2,u=Array(n);for(let C=0;C<n;++C)u[C]=new Nb(d.subarray(2*C,2*C+2));d=u}this.SetUserOverridableBuffer(this.m_positionBuffer,d)}SetVelocityBuffer(d){if(d instanceof Float32Array){if(0!==d.length%2)throw Error();const n=d.length/2,u=Array(n);for(let C=
0;C<n;++C)u[C]=new Nb(d.subarray(2*C,2*C+2));d=u}this.SetUserOverridableBuffer(this.m_velocityBuffer,d)}SetColorBuffer(d){if(d instanceof Float32Array){if(0!==d.length%4)throw Error();const n=d.length/4,u=Array(n);for(let C=0;C<n;++C)u[C]=new Ia(d.subarray(4*C,4*C+4));d=u}this.SetUserOverridableBuffer(this.m_colorBuffer,d)}SetUserDataBuffer(d){this.SetUserOverridableBuffer(this.m_userDataBuffer,d)}GetContacts(){return this.m_contactBuffer.data}GetContactCount(){return this.m_contactBuffer.count}GetBodyContacts(){return this.m_bodyContactBuffer.data}GetBodyContactCount(){return this.m_bodyContactBuffer.count}GetPairs(){return this.m_pairBuffer.data}GetPairCount(){return this.m_pairBuffer.count}GetTriads(){return this.m_triadBuffer.data}GetTriadCount(){return this.m_triadBuffer.count}SetStuckThreshold(d){this.m_stuckThreshold=
d;0<d&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))}GetStuckCandidates(){return this.m_stuckParticleBuffer.Data()}GetStuckCandidateCount(){return this.m_stuckParticleBuffer.GetCount()}ComputeCollisionEnergy(){const d=nb.ComputeCollisionEnergy_s_v,n=this.m_velocityBuffer.data;
let u=0;for(let L=0;L<this.m_contactBuffer.count;L++){var C=this.m_contactBuffer.data[L],I=C.normal;C=z.SubVV(n[C.indexB],n[C.indexA],d);I=z.DotVV(C,I);0>I&&(u+=I*I)}return.5*this.GetParticleMass()*u}SetStrictContactCheck(d){this.m_def.strictContactCheck=d}GetStrictContactCheck(){return this.m_def.strictContactCheck}SetParticleLifetime(d,n){var u=null===this.m_indexByExpirationTimeBuffer.data;this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data);this.m_indexByExpirationTimeBuffer.data=
this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data);if(u){u=this.GetParticleCount();for(let C=0;C<u;++C)this.m_indexByExpirationTimeBuffer.data[C]=C}n/=this.m_def.lifetimeGranularity;n=0<n?this.GetQuantizedTimeElapsed()+n:n;n!==this.m_expirationTimeBuffer.data[d]&&(this.m_expirationTimeBuffer.data[d]=n,this.m_expirationTimeBufferRequiresSorting=!0)}GetParticleLifetime(d){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[d])}SetDestructionByAge(d){d&&this.GetExpirationTimeBuffer();
this.m_def.destroyByAge=d}GetDestructionByAge(){return this.m_def.destroyByAge}GetExpirationTimeBuffer(){this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data);return this.m_expirationTimeBuffer.data}ExpirationTimeToLifetime(d){return(0<d?d-this.GetQuantizedTimeElapsed():d)*this.m_def.lifetimeGranularity}GetIndexByExpirationTimeBuffer(){this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data);
return this.m_indexByExpirationTimeBuffer.data}ParticleApplyLinearImpulse(d,n){this.ApplyLinearImpulse(d,d+1,n)}ApplyLinearImpulse(d,n,u){const C=this.m_velocityBuffer.data,I=(n-d)*this.GetParticleMass();for(u=(new z).Copy(u).SelfMul(1/I);d<n;d++)C[d].SelfAdd(u)}static IsSignificantForce(d){return 0!==d.x||0!==d.y}ParticleApplyForce(d,n){nb.IsSignificantForce(n)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[d])&&(this.PrepareForceBuffer(),this.m_forceBuffer[d].SelfAdd(n))}ApplyForce(d,n,u){u=(new z).Copy(u).SelfMul(1/
(n-d));if(nb.IsSignificantForce(u))for(this.PrepareForceBuffer();d<n;d++)this.m_forceBuffer[d].SelfAdd(u)}GetNext(){return this.m_next}QueryAABB(d,n){if(0!==this.m_proxyBuffer.count){var u=this.m_proxyBuffer.count,C=Aa(this.m_proxyBuffer.data,0,u,nb.computeTag(this.m_inverseDiameter*n.lowerBound.x,this.m_inverseDiameter*n.lowerBound.y),Je.CompareProxyTag);u=xa(this.m_proxyBuffer.data,C,u,nb.computeTag(this.m_inverseDiameter*n.upperBound.x,this.m_inverseDiameter*n.upperBound.y),Je.CompareTagProxy);
for(var I=this.m_positionBuffer.data;C<u;++C){const L=this.m_proxyBuffer.data[C].index,U=I[L];if(n.lowerBound.x<U.x&&U.x<n.upperBound.x&&n.lowerBound.y<U.y&&U.y<n.upperBound.y&&!d.ReportParticle(this,L))break}}}QueryShapeAABB(d,n,u,C=0){const I=nb.QueryShapeAABB_s_aabb;n.ComputeAABB(I,u,C);this.QueryAABB(d,I)}QueryPointAABB(d,n,u=.005){const C=nb.QueryPointAABB_s_aabb;C.lowerBound.Set(n.x-u,n.y-u);C.upperBound.Set(n.x+u,n.y+u);this.QueryAABB(d,C)}RayCast(d,n,u){const C=nb.RayCast_s_p;var I=nb.RayCast_s_v;
const L=nb.RayCast_s_n,U=nb.RayCast_s_point;if(0!==this.m_proxyBuffer.count){var Z=this.m_positionBuffer.data,ka=nb.RayCast_s_aabb;z.MinV(n,u,ka.lowerBound);z.MaxV(n,u,ka.upperBound);var ia=1;u=z.SubVV(u,n,I);I=z.DotVV(u,u);ka=this.GetInsideBoundsEnumerator(ka);for(var ta;0<=(ta=ka.GetNext());){var Ja=z.SubVV(n,Z[ta],C);const Xa=z.DotVV(Ja,u);var Oa=z.DotVV(Ja,Ja);Oa=Xa*Xa-I*(Oa-this.m_squaredDiameter);if(0<=Oa){const zb=ub(Oa);Oa=(-Xa-zb)/I;if(!(Oa>ia)){if(0>Oa&&(Oa=(-Xa+zb)/I,0>Oa||Oa>ia))continue;
Ja=z.AddVMulSV(Ja,Oa,u,L);Ja.Normalize();ta=d.ReportParticle(this,ta,z.AddVMulSV(n,Oa,u,U),Ja,Oa);ia=f(ia,ta);if(0>=ia)break}}}}}ComputeAABB(d){const n=this.GetParticleCount();d.lowerBound.x=1E37;d.lowerBound.y=1E37;d.upperBound.x=-1E37;d.upperBound.y=-1E37;const u=this.m_positionBuffer.data;for(let C=0;C<n;C++){const I=u[C];z.MinV(d.lowerBound,I,d.lowerBound);z.MaxV(d.upperBound,I,d.upperBound)}d.lowerBound.x-=this.m_particleDiameter;d.lowerBound.y-=this.m_particleDiameter;d.upperBound.x+=this.m_particleDiameter;
d.upperBound.y+=this.m_particleDiameter}FreeBuffer(d){null!==d&&(d.length=0)}FreeUserOverridableBuffer(d){0===d.userSuppliedCapacity&&this.FreeBuffer(d.data,this.m_internalAllocatedCapacity)}ReallocateBuffer3(d,n,u){if(u<=n)throw Error();d=d?d.slice():[];d.length=u;return d}ReallocateBuffer5(d,n,u,C,I){if(C<=u)throw Error();if(n&&!(C<=n))throw Error();I&&!d||n||(d=this.ReallocateBuffer3(d,u,C));return d}ReallocateBuffer4(d,n,u,C){return this.ReallocateBuffer5(d.data,d.userSuppliedCapacity,n,u,C)}RequestBuffer(d){d||
(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(256),d=[],d.length=this.m_internalAllocatedCapacity);return d}ReallocateHandleBuffers(d){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,d,!0)}ReallocateInternalAllocatedBuffers(d){function n(u,C){return C&&u>C?C:u}d=n(d,this.m_def.maxCount);d=n(d,this.m_flagsBuffer.userSuppliedCapacity);d=n(d,this.m_positionBuffer.userSuppliedCapacity);d=n(d,this.m_velocityBuffer.userSuppliedCapacity);
d=n(d,this.m_colorBuffer.userSuppliedCapacity);d=n(d,this.m_userDataBuffer.userSuppliedCapacity);if(this.m_internalAllocatedCapacity<d){this.ReallocateHandleBuffers(d);this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,d,!1);const u=0<this.m_stuckThreshold;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,d,u);this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,
this.m_internalAllocatedCapacity,d,u);this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,d,u);this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,d,!1);this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,d,!1);this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,d,!1);
this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,d,!1);this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,d,!0);this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,d,!1);this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,d,!0);this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,
0,this.m_internalAllocatedCapacity,d,!0);this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,d,!0);this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,d,!1);this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,d,!0);this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,d,!0);this.m_indexByExpirationTimeBuffer.data=
this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,d,!1);this.m_internalAllocatedCapacity=d}}CreateParticleForGroup(d,n,u){const C=new Zg;C.flags=b(d.flags,0);rb.MulXV(n,u,C.position);z.AddVV(b(d.linearVelocity,z.ZERO),z.CrossSV(b(d.angularVelocity,0),z.SubVV(C.position,b(d.position,z.ZERO),z.s_t0),z.s_t0),C.velocity);C.color.Copy(b(d.color,ya.ZERO));C.lifetime=b(d.lifetime,0);C.userData=d.userData;this.CreateParticle(C)}CreateParticlesStrokeShapeForGroup(d,
n,u){const C=nb.CreateParticlesStrokeShapeForGroup_s_edge,I=nb.CreateParticlesStrokeShapeForGroup_s_d,L=nb.CreateParticlesStrokeShapeForGroup_s_p;let U=b(n.stride,0);0===U&&(U=this.GetParticleStride());let Z=0;const ka=d.GetChildCount();for(let ia=0;ia<ka;ia++){let ta;d.GetType()===a.ShapeType.e_edgeShape?ta=d:(ta=C,d.GetChildEdge(ta,ia));const Ja=z.SubVV(ta.m_vertex2,ta.m_vertex1,I),Oa=Ja.Length();for(;Z<Oa;){const Xa=z.AddVMulSV(ta.m_vertex1,Z/Oa,Ja,L);this.CreateParticleForGroup(n,u,Xa);Z+=U}Z-=
Oa}}CreateParticlesFillShapeForGroup(d,n,u){const C=nb.CreateParticlesFillShapeForGroup_s_aabb,I=nb.CreateParticlesFillShapeForGroup_s_p;let L=b(n.stride,0);0===L&&(L=this.GetParticleStride());const U=rb.IDENTITY;d.ComputeAABB(C,U,0);for(let Z=Math.floor(C.lowerBound.y/L)*L;Z<C.upperBound.y;Z+=L)for(let ka=Math.floor(C.lowerBound.x/L)*L;ka<C.upperBound.x;ka+=L){const ia=I.Set(ka,Z);d.TestPoint(U,ia)&&this.CreateParticleForGroup(n,u,ia)}}CreateParticlesWithShapeForGroup(d,n,u){switch(d.GetType()){case a.ShapeType.e_edgeShape:case a.ShapeType.e_chainShape:this.CreateParticlesStrokeShapeForGroup(d,
n,u);break;case a.ShapeType.e_polygonShape:case a.ShapeType.e_circleShape:this.CreateParticlesFillShapeForGroup(d,n,u)}}CreateParticlesWithShapesForGroup(d,n,u,C){d=new Hi(d,n);this.CreateParticlesFillShapeForGroup(d,u,C)}CloneParticle(d,n){var u=new Zg;u.flags=this.m_flagsBuffer.data[d];u.position.Copy(this.m_positionBuffer.data[d]);u.velocity.Copy(this.m_velocityBuffer.data[d]);this.m_colorBuffer.data&&u.color.Copy(this.m_colorBuffer.data[d]);this.m_userDataBuffer.data&&(u.userData=this.m_userDataBuffer.data[d]);
u.group=n;n=this.CreateParticle(u);this.m_handleIndexBuffer.data&&((u=this.m_handleIndexBuffer.data[d])&&u.SetIndex(n),this.m_handleIndexBuffer.data[n]=u,this.m_handleIndexBuffer.data[d]=null);this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[n]=this.m_lastBodyContactStepBuffer.data[d]);this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[n]=this.m_bodyContactCountBuffer.data[d]);this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[n]=
this.m_consecutiveContactStepsBuffer.data[d]);this.m_hasForce&&this.m_forceBuffer[n].Copy(this.m_forceBuffer[d]);this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[n]=this.m_staticPressureBuffer[d]);this.m_depthBuffer&&(this.m_depthBuffer[n]=this.m_depthBuffer[d]);this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[n]=this.m_expirationTimeBuffer.data[d]);return n}DestroyParticlesInGroup(d,n=!1){for(let u=d.m_firstIndex;u<d.m_lastIndex;u++)this.DestroyParticle(u,n)}DestroyParticleGroup(d){this.m_world.m_destructionListener&&
this.m_world.m_destructionListener.SayGoodbyeParticleGroup(d);this.SetGroupFlags(d,0);for(let n=d.m_firstIndex;n<d.m_lastIndex;n++)this.m_groupBuffer[n]=null;d.m_prev&&(d.m_prev.m_next=d.m_next);d.m_next&&(d.m_next.m_prev=d.m_prev);d===this.m_groupList&&(this.m_groupList=d.m_next);--this.m_groupCount}static ParticleCanBeConnected(d,n){return 0!==(d&(a.ParticleFlag.b2_wallParticle|a.ParticleFlag.b2_springParticle|a.ParticleFlag.b2_elasticParticle))||null!==n&&0!==(n.GetGroupFlags()&a.ParticleGroupFlag.b2_rigidParticleGroup)}UpdatePairsAndTriads(d,
n,u){const C=nb.UpdatePairsAndTriads_s_dab,I=nb.UpdatePairsAndTriads_s_dbc,L=nb.UpdatePairsAndTriads_s_dca,U=this.m_positionBuffer.data;var Z=0;for(var ka=d;ka<n;ka++)Z|=this.m_flagsBuffer.data[ka];if(Z&nb.k_pairFlags)for(ka=0;ka<this.m_contactBuffer.count;ka++){var ia=this.m_contactBuffer.data[ka];const Ja=ia.indexA,Oa=ia.indexB;var ta=this.m_flagsBuffer.data[Ja];const Xa=this.m_flagsBuffer.data[Oa],zb=this.m_groupBuffer[Ja],Hb=this.m_groupBuffer[Oa];Ja>=d&&Ja<n&&Oa>=d&&Oa<n&&!((ta|Xa)&a.ParticleFlag.b2_zombieParticle)&&
(ta|Xa)&nb.k_pairFlags&&(u.IsNecessary(Ja)||u.IsNecessary(Oa))&&nb.ParticleCanBeConnected(ta,zb)&&nb.ParticleCanBeConnected(Xa,Hb)&&u.ShouldCreatePair(Ja,Oa)&&(ta=this.m_pairBuffer.data[this.m_pairBuffer.Append()],ta.indexA=Ja,ta.indexB=Oa,ta.flags=ia.flags,ta.strength=f(zb?zb.m_strength:1,Hb?Hb.m_strength:1),ta.distance=z.DistanceVV(U[Ja],U[Oa]));Ca(this.m_pairBuffer.data,0,this.m_pairBuffer.count,nb.ComparePairIndices);this.m_pairBuffer.Unique(nb.MatchPairIndices)}if(Z&nb.k_triadFlags){for(Z=new yi(n-
d);d<n;d++)ka=this.m_flagsBuffer.data[d],ia=this.m_groupBuffer[d],ka&a.ParticleFlag.b2_zombieParticle||!nb.ParticleCanBeConnected(ka,ia)||Z.AddGenerator(U[d],d,u.IsNecessary(d));n=this.GetParticleStride();Z.Generate(n/2,2*n);const Ja=this;Z.GetNodes((Oa,Xa,zb)=>{const Hb=Ja.m_flagsBuffer.data[Oa],Jb=Ja.m_flagsBuffer.data[Xa],Tb=Ja.m_flagsBuffer.data[zb];if((Hb|Jb|Tb)&nb.k_triadFlags&&u.ShouldCreateTriad(Oa,Xa,zb)){const jc=U[Oa],mc=U[Xa],qc=U[zb],yc=z.SubVV(jc,mc,C),lc=z.SubVV(mc,qc,I),nc=z.SubVV(qc,
jc,L);var Vb=4*Ja.m_squaredDiameter;if(!(z.DotVV(yc,yc)>Vb||z.DotVV(lc,lc)>Vb||z.DotVV(nc,nc)>Vb)){var Qb=Ja.m_groupBuffer[Oa],fc=Ja.m_groupBuffer[Xa],cc=Ja.m_groupBuffer[zb];Vb=Ja.m_triadBuffer.data[Ja.m_triadBuffer.Append()];Vb.indexA=Oa;Vb.indexB=Xa;Vb.indexC=zb;Vb.flags=Hb|Jb|Tb;Vb.strength=f(f(Qb?Qb.m_strength:1,fc?fc.m_strength:1),cc?cc.m_strength:1);Oa=(jc.x+mc.x+qc.x)/3;Xa=(jc.y+mc.y+qc.y)/3;Vb.pa.x=jc.x-Oa;Vb.pa.y=jc.y-Xa;Vb.pb.x=mc.x-Oa;Vb.pb.y=mc.y-Xa;Vb.pc.x=qc.x-Oa;Vb.pc.y=qc.y-Xa;Vb.ka=
-z.DotVV(nc,yc);Vb.kb=-z.DotVV(yc,lc);Vb.kc=-z.DotVV(lc,nc);Vb.s=z.CrossVV(jc,mc)+z.CrossVV(mc,qc)+z.CrossVV(qc,jc)}}});Ca(this.m_triadBuffer.data,0,this.m_triadBuffer.count,nb.CompareTriadIndices);this.m_triadBuffer.Unique(nb.MatchTriadIndices)}}UpdatePairsAndTriadsWithReactiveParticles(){var d=new Ii(this.m_flagsBuffer);this.UpdatePairsAndTriads(0,this.m_count,d);for(d=0;d<this.m_count;d++)this.m_flagsBuffer.data[d]&=~a.ParticleFlag.b2_reactiveParticle;this.m_allParticleFlags&=~a.ParticleFlag.b2_reactiveParticle}static ComparePairIndices(d,
n){const u=d.indexA-n.indexA;return 0!==u?0>u:d.indexB<n.indexB}static MatchPairIndices(d,n){return d.indexA===n.indexA&&d.indexB===n.indexB}static CompareTriadIndices(d,n){var u=d.indexA-n.indexA;if(0!==u)return 0>u;u=d.indexB-n.indexB;return 0!==u?0>u:d.indexC<n.indexC}static MatchTriadIndices(d,n){return d.indexA===n.indexA&&d.indexB===n.indexB&&d.indexC===n.indexC}static InitializeParticleLists(d,n){const u=d.GetBufferIndex();d=d.GetParticleCount();for(let C=0;C<d;C++){const I=n[C];I.list=I;I.next=
null;I.count=1;I.index=C+u}}MergeParticleListsInContact(d,n){const u=d.GetBufferIndex();for(let L=0;L<this.m_contactBuffer.count;L++){var C=this.m_contactBuffer.data[L],I=C.indexA;C=C.indexB;if(d.ContainsParticle(I)&&d.ContainsParticle(C)&&(I=n[I-u].list,C=n[C-u].list,I!==C)){if(I.count<C.count){const U=I;I=C;C=U}nb.MergeParticleLists(I,C)}}}static MergeParticleLists(d,n){for(let u=n;;){u.list=d;const C=u.next;if(C)u=C;else{u.next=d.next;break}}d.next=n;d.count+=n.count;n.count=0}static FindLongestParticleList(d,
n){d=d.GetParticleCount();let u=n[0];for(let C=0;C<d;C++){const I=n[C];u.count<I.count&&(u=I)}return u}MergeZombieParticleListNodes(d,n,u){d=d.GetParticleCount();for(let C=0;C<d;C++){const I=n[C];I!==u&&this.m_flagsBuffer.data[I.index]&a.ParticleFlag.b2_zombieParticle&&nb.MergeParticleListAndNode(u,I)}}static MergeParticleListAndNode(d,n){n.list=d;n.next=d.next;d.next=n;d.count++;n.count=0}CreateParticleGroupsFromParticleList(d,n,u){const C=d.GetParticleCount(),I=new wi;I.groupFlags=d.GetGroupFlags();
I.userData=d.GetUserData();for(d=0;d<C;d++){var L=n[d];if(!L.count||L===u)continue;const U=this.CreateParticleGroup(I);for(;L;L=L.next){const Z=L.index,ka=this.CloneParticle(Z,U);this.m_flagsBuffer.data[Z]|=a.ParticleFlag.b2_zombieParticle;L.index=ka}}}UpdatePairsAndTriadsWithParticleList(d,n){const u=d.GetBufferIndex();for(var C=0;C<this.m_pairBuffer.count;C++){var I=this.m_pairBuffer.data[C],L=I.indexA,U=I.indexB;d.ContainsParticle(L)&&(I.indexA=n[L-u].index);d.ContainsParticle(U)&&(I.indexB=n[U-
u].index)}for(C=0;C<this.m_triadBuffer.count;C++){I=this.m_triadBuffer.data[C];L=I.indexA;U=I.indexB;const Z=I.indexC;d.ContainsParticle(L)&&(I.indexA=n[L-u].index);d.ContainsParticle(U)&&(I.indexB=n[U-u].index);d.ContainsParticle(Z)&&(I.indexC=n[Z-u].index)}}ComputeDepth(){var d=[],n=0;for(var u=0;u<this.m_contactBuffer.count;u++){var C=this.m_contactBuffer.data[u],I=this.m_groupBuffer[C.indexA],L=this.m_groupBuffer[C.indexB];I&&I===L&&I.m_groupFlags&a.ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&
(d[n++]=C)}u=[];C=0;for(I=this.m_groupList;I;I=I.GetNext())if(I.m_groupFlags&a.ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth)for(u[C++]=I,this.SetGroupFlags(I,I.m_groupFlags&~a.ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth),L=I.m_firstIndex;L<I.m_lastIndex;L++)this.m_accumulationBuffer[L]=0;for(I=0;I<n;I++){L=d[I];var U=L.indexB,Z=L.weight;this.m_accumulationBuffer[L.indexA]+=Z;this.m_accumulationBuffer[U]+=Z}for(I=0;I<C;I++)for(L=u[I],U=L.m_firstIndex;U<L.m_lastIndex;U++)this.m_depthBuffer[U]=
.8>this.m_accumulationBuffer[U]?0:1E37;I=ub(this.m_count)>>0;for(L=0;L<I;L++){U=!1;for(Z=0;Z<n;Z++){var ka=d[Z];const ta=ka.indexA,Ja=ka.indexB;var ia=1-ka.weight;ka=this.m_depthBuffer[ta];const Oa=this.m_depthBuffer[Ja],Xa=Oa+ia;ia=ka+ia;ka>Xa&&(this.m_depthBuffer[ta]=Xa,U=!0);Oa>ia&&(this.m_depthBuffer[Ja]=ia,U=!0)}if(!U)break}for(d=0;d<C;d++)for(n=u[d],I=n.m_firstIndex;I<n.m_lastIndex;I++)this.m_depthBuffer[I]=1E37>this.m_depthBuffer[I]?this.m_depthBuffer[I]*this.m_particleDiameter:0}GetInsideBoundsEnumerator(d){const n=
nb.computeTag(this.m_inverseDiameter*d.lowerBound.x-1,this.m_inverseDiameter*d.lowerBound.y-1);d=nb.computeTag(this.m_inverseDiameter*d.upperBound.x+1,this.m_inverseDiameter*d.upperBound.y+1);var u=this.m_proxyBuffer.count;const C=Aa(this.m_proxyBuffer.data,0,u,n,Je.CompareProxyTag);u=xa(this.m_proxyBuffer.data,0,u,d,Je.CompareTagProxy);return new Ji(this,n,d,C,u)}UpdateAllParticleFlags(){this.m_allParticleFlags=0;for(let d=0;d<this.m_count;d++)this.m_allParticleFlags|=this.m_flagsBuffer.data[d];
this.m_needsUpdateAllParticleFlags=!1}UpdateAllGroupFlags(){this.m_allGroupFlags=0;for(let d=this.m_groupList;d;d=d.GetNext())this.m_allGroupFlags|=d.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1}AddContact(d,n){const u=this.m_flagsBuffer.data;var C=this.m_positionBuffer.data;C=z.SubVV(C[n],C[d],nb.AddContact_s_d);const I=z.DotVV(C,C);if(0<I&&I<this.m_squaredDiameter){const L=q(I),U=this.m_contactBuffer.data[this.m_contactBuffer.Append()];U.indexA=d;U.indexB=n;U.flags=u[d]|u[n];U.weight=1-I*L*this.m_inverseDiameter;
U.normal.x=L*C.x;U.normal.y=L*C.y}}FindContacts_Reference(){const d=this.m_proxyBuffer.count;this.m_contactBuffer.count=0;for(let C=0,I=0;C<d;C++){var n=nb.computeRelativeTag(this.m_proxyBuffer.data[C].tag,1,0);for(var u=C+1;u<d&&!(n<this.m_proxyBuffer.data[u].tag);u++)this.AddContact(this.m_proxyBuffer.data[C].index,this.m_proxyBuffer.data[u].index,this.m_contactBuffer);for(n=nb.computeRelativeTag(this.m_proxyBuffer.data[C].tag,-1,1);I<d&&!(n<=this.m_proxyBuffer.data[I].tag);I++);n=nb.computeRelativeTag(this.m_proxyBuffer.data[C].tag,
1,1);for(u=I;u<d&&!(n<this.m_proxyBuffer.data[u].tag);u++)this.AddContact(this.m_proxyBuffer.data[C].index,this.m_proxyBuffer.data[u].index,this.m_contactBuffer)}}FindContacts(d){this.FindContacts_Reference(d)}UpdateProxies_Reference(){const d=this.m_positionBuffer.data,n=this.m_inverseDiameter;for(let u=0;u<this.m_proxyBuffer.count;++u){const C=this.m_proxyBuffer.data[u],I=d[C.index];C.tag=nb.computeTag(n*I.x,n*I.y)}}UpdateProxies(d){this.UpdateProxies_Reference(d)}SortProxies(){ra(this.m_proxyBuffer.data,
0,this.m_proxyBuffer.count,Je.CompareProxyProxy)}FilterContacts(){const d=this.GetParticleContactFilter();if(null!==d){var n=this;this.m_contactBuffer.RemoveIf(u=>0!==(u.flags&a.ParticleFlag.b2_particleContactFilterParticle)&&!d.ShouldCollideParticleParticle(n,u.indexA,u.indexB))}}NotifyContactListenerPreContact(d){if(null!==this.GetParticleContactListener())throw d.Initialize(this.m_contactBuffer,this.m_flagsBuffer),Error();}NotifyContactListenerPostContact(){const d=this.GetParticleContactListener();
if(null!==d){for(let n=0;n<this.m_contactBuffer.count;++n)d.BeginContactParticleParticle(this,this.m_contactBuffer.data[n]);throw Error();}}static b2ParticleContactIsZombie(d){return(d.flags&a.ParticleFlag.b2_zombieParticle)===a.ParticleFlag.b2_zombieParticle}UpdateContacts(d){this.UpdateProxies(this.m_proxyBuffer);this.SortProxies(this.m_proxyBuffer);const n=new Ki;this.NotifyContactListenerPreContact(n);this.FindContacts(this.m_contactBuffer);this.FilterContacts(this.m_contactBuffer);this.NotifyContactListenerPostContact(n);
d&&this.m_contactBuffer.RemoveIf(nb.b2ParticleContactIsZombie)}NotifyBodyContactListenerPreContact(d){if(null!==this.GetFixtureContactListener())throw d.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),Error();}NotifyBodyContactListenerPostContact(){const d=this.GetFixtureContactListener();if(null!==d){for(let n=0;n<this.m_bodyContactBuffer.count;n++)d.BeginContactFixtureParticle(this,this.m_bodyContactBuffer.data[n]);throw Error();}}UpdateBodyContacts(){const d=nb.UpdateBodyContacts_s_aabb,
n=new Li;this.NotifyBodyContactListenerPreContact(n);if(0<this.m_stuckThreshold){var u=this.GetParticleCount();for(let C=0;C<u;C++)this.m_bodyContactCountBuffer.data[C]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[C]+1&&(this.m_consecutiveContactStepsBuffer.data[C]=0)}this.m_bodyContactBuffer.SetCount(0);this.m_stuckParticleBuffer.SetCount(0);this.ComputeAABB(d);null===this.UpdateBodyContacts_callback&&(this.UpdateBodyContacts_callback=new cf(this));u=this.UpdateBodyContacts_callback;
u.m_contactFilter=this.GetFixtureContactFilter();this.m_world.QueryAABB(u,d);this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts();this.NotifyBodyContactListenerPostContact(n)}Solve(d){const n=nb.Solve_s_subStep;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(d),this.m_allParticleFlags&a.ParticleFlag.b2_zombieParticle&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),
!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<d.particleIterations;this.m_iterationIndex++){++this.m_timestamp;const u=n.Copy(d);u.dt/=d.particleIterations;u.inv_dt*=d.particleIterations;this.UpdateContacts(!1);this.UpdateBodyContacts();this.ComputeWeight();this.m_allGroupFlags&a.ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&this.ComputeDepth();this.m_allParticleFlags&a.ParticleFlag.b2_reactiveParticle&&this.UpdatePairsAndTriadsWithReactiveParticles();this.m_hasForce&&this.SolveForce(u);
this.m_allParticleFlags&a.ParticleFlag.b2_viscousParticle&&this.SolveViscous();this.m_allParticleFlags&a.ParticleFlag.b2_repulsiveParticle&&this.SolveRepulsive(u);this.m_allParticleFlags&a.ParticleFlag.b2_powderParticle&&this.SolvePowder(u);this.m_allParticleFlags&a.ParticleFlag.b2_tensileParticle&&this.SolveTensile(u);this.m_allGroupFlags&a.ParticleGroupFlag.b2_solidParticleGroup&&this.SolveSolid(u);this.m_allParticleFlags&a.ParticleFlag.b2_colorMixingParticle&&this.SolveColorMixing();this.SolveGravity(u);
this.m_allParticleFlags&a.ParticleFlag.b2_staticPressureParticle&&this.SolveStaticPressure(u);this.SolvePressure(u);this.SolveDamping(u);this.m_allParticleFlags&nb.k_extraDampingFlags&&this.SolveExtraDamping();this.m_allParticleFlags&a.ParticleFlag.b2_elasticParticle&&this.SolveElastic(u);this.m_allParticleFlags&a.ParticleFlag.b2_springParticle&&this.SolveSpring(u);this.LimitVelocity(u);this.m_allGroupFlags&a.ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigidDamping();this.m_allParticleFlags&
a.ParticleFlag.b2_barrierParticle&&this.SolveBarrier(u);this.SolveCollision(u);this.m_allGroupFlags&a.ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigid(u);this.m_allParticleFlags&a.ParticleFlag.b2_wallParticle&&this.SolveWall();for(let C=0;C<this.m_count;C++)this.m_positionBuffer.data[C].SelfMulAdd(u.dt,this.m_velocityBuffer.data[C])}}SolveCollision(d){var n=this.m_positionBuffer.data;const u=this.m_velocityBuffer.data,C=nb.SolveCollision_s_aabb;C.lowerBound.x=1E37;C.lowerBound.y=1E37;C.upperBound.x=
-1E37;C.upperBound.y=-1E37;for(let L=0;L<this.m_count;L++){var I=u[L];const U=n[L],Z=U.x+d.dt*I.x;I=U.y+d.dt*I.y;C.lowerBound.x=f(C.lowerBound.x,f(U.x,Z));C.lowerBound.y=f(C.lowerBound.y,f(U.y,I));C.upperBound.x=h(C.upperBound.x,h(U.x,Z));C.upperBound.y=h(C.upperBound.y,h(U.y,I))}null===this.SolveCollision_callback&&(this.SolveCollision_callback=new xd(this,d));n=this.SolveCollision_callback;n.m_step=d;this.m_world.QueryAABB(n,C)}LimitVelocity(d){const n=this.m_velocityBuffer.data;d=this.GetCriticalVelocitySquared(d);
for(let u=0;u<this.m_count;u++){const C=n[u],I=z.DotVV(C,C);I>d&&C.SelfMul(ub(d/I))}}SolveGravity(d){var n=nb.SolveGravity_s_gravity;const u=this.m_velocityBuffer.data;d=z.MulSV(d.dt*this.m_def.gravityScale,this.m_world.GetGravity(),n);for(n=0;n<this.m_count;n++)u[n].SelfAdd(d)}SolveBarrier(d){const n=nb.SolveBarrier_s_aabb,u=nb.SolveBarrier_s_va,C=nb.SolveBarrier_s_vb,I=nb.SolveBarrier_s_pba,L=nb.SolveBarrier_s_vba,U=nb.SolveBarrier_s_vc,Z=nb.SolveBarrier_s_pca,ka=nb.SolveBarrier_s_vca,ia=nb.SolveBarrier_s_qba,
ta=nb.SolveBarrier_s_qca,Ja=nb.SolveBarrier_s_dv,Oa=nb.SolveBarrier_s_f,Xa=this.m_positionBuffer.data,zb=this.m_velocityBuffer.data;for(var Hb=0;Hb<this.m_count;Hb++)0!==(this.m_flagsBuffer.data[Hb]&nb.k_barrierWallFlags)&&zb[Hb].SetZero();Hb=2.5*d.dt;const Jb=this.GetParticleMass();for(let jd=0;jd<this.m_pairBuffer.count;jd++){var Tb=this.m_pairBuffer.data[jd];if(Tb.flags&a.ParticleFlag.b2_barrierParticle){var Vb=Tb.indexA,Qb=Tb.indexB;Tb=Xa[Vb];var fc=Xa[Qb],cc=n;z.MinV(Tb,fc,cc.lowerBound);z.MaxV(Tb,
fc,cc.upperBound);const vd=this.m_groupBuffer[Vb],qd=this.m_groupBuffer[Qb];Vb=this.GetLinearVelocity(vd,Vb,Tb,u);Qb=this.GetLinearVelocity(qd,Qb,fc,C);fc=z.SubVV(fc,Tb,I);Qb=z.SubVV(Qb,Vb,L);cc=this.GetInsideBoundsEnumerator(cc);let df;for(;0<=(df=cc.GetNext());){const bh=Xa[df],Od=this.m_groupBuffer[df];if(vd!==Od&&qd!==Od){var jc=this.GetLinearVelocity(Od,df,bh,U),mc=z.SubVV(bh,Tb,Z),qc=z.SubVV(jc,Vb,ka),yc=z.CrossVV(Qb,qc),lc=z.CrossVV(fc,qc)-z.CrossVV(mc,Qb),nc=z.CrossVV(fc,mc);const Gd=ia,ef=
ta;if(0===yc){if(0===lc)continue;nc=-nc/lc;if(!(0<=nc&&nc<Hb))continue;z.AddVMulSV(fc,nc,Qb,Gd);z.AddVMulSV(mc,nc,qc,ef);lc=z.DotVV(Gd,ef)/z.DotVV(Gd,Gd);if(!(0<=lc&&1>=lc))continue}else{nc=lc*lc-4*nc*yc;if(0>nc)continue;const Mi=ub(nc);nc=(-lc-Mi)/(2*yc);yc=(-lc+Mi)/(2*yc);nc>yc&&(lc=nc,nc=yc,yc=lc);z.AddVMulSV(fc,nc,Qb,Gd);z.AddVMulSV(mc,nc,qc,ef);lc=z.DotVV(Gd,ef)/z.DotVV(Gd,Gd);if(!(0<=nc&&nc<Hb&&0<=lc&&1>=lc)){nc=yc;if(!(0<=nc&&nc<Hb))continue;z.AddVMulSV(fc,nc,Qb,Gd);z.AddVMulSV(mc,nc,qc,ef);
lc=z.DotVV(Gd,ef)/z.DotVV(Gd,Gd);if(!(0<=lc&&1>=lc))continue}}mc=Ja;mc.x=Vb.x+lc*Qb.x-jc.x;mc.y=Vb.y+lc*Qb.y-jc.y;jc=z.MulSV(Jb,mc,Oa);Od&&this.IsRigidGroup(Od)?(mc=Od.GetMass(),qc=Od.GetInertia(),0<mc&&Od.m_linearVelocity.SelfMulAdd(1/mc,jc),0<qc&&(Od.m_angularVelocity+=z.CrossVV(z.SubVV(bh,Od.GetCenter(),z.s_t0),jc)/qc)):zb[df].SelfAdd(mc);this.ParticleApplyForce(df,jc.SelfMul(-d.inv_dt))}}}}}SolveStaticPressure(d){this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);var n=
this.GetCriticalPressure(d);d=this.m_def.staticPressureStrength*n;n*=.25;const u=this.m_def.staticPressureRelaxation;for(let U=0;U<this.m_def.staticPressureIterations;U++){for(var C=0;C<this.m_count;C++)this.m_accumulationBuffer[C]=0;for(C=0;C<this.m_contactBuffer.count;C++){var I=this.m_contactBuffer.data[C];if(I.flags&a.ParticleFlag.b2_staticPressureParticle){var L=I.indexA;const Z=I.indexB;I=I.weight;this.m_accumulationBuffer[L]+=I*this.m_staticPressureBuffer[Z];this.m_accumulationBuffer[Z]+=I*
this.m_staticPressureBuffer[L]}}for(C=0;C<this.m_count;C++)L=this.m_weightBuffer[C],this.m_staticPressureBuffer[C]=this.m_flagsBuffer.data[C]&a.ParticleFlag.b2_staticPressureParticle?g((this.m_accumulationBuffer[C]+d*(L-1))/(L+u),0,n):0}}ComputeWeight(){for(var d=0;d<this.m_count;d++)this.m_weightBuffer[d]=0;for(d=0;d<this.m_bodyContactBuffer.count;d++){var n=this.m_bodyContactBuffer.data[d];this.m_weightBuffer[n.index]+=n.weight}for(d=0;d<this.m_contactBuffer.count;d++){n=this.m_contactBuffer.data[d];
const u=n.indexB,C=n.weight;this.m_weightBuffer[n.indexA]+=C;this.m_weightBuffer[u]+=C}}SolvePressure(d){const n=nb.SolvePressure_s_f;var u=this.m_positionBuffer.data;const C=this.m_velocityBuffer.data;var I=this.GetCriticalPressure(d),L=this.m_def.pressureStrength*I;I*=.25;for(var U=0;U<this.m_count;U++){var Z=L*h(0,this.m_weightBuffer[U]-1);this.m_accumulationBuffer[U]=f(Z,I)}if(this.m_allParticleFlags&nb.k_noPressureFlags)for(I=0;I<this.m_count;I++)this.m_flagsBuffer.data[I]&nb.k_noPressureFlags&&
(this.m_accumulationBuffer[I]=0);if(this.m_allParticleFlags&a.ParticleFlag.b2_staticPressureParticle)for(I=0;I<this.m_count;I++)this.m_flagsBuffer.data[I]&a.ParticleFlag.b2_staticPressureParticle&&(this.m_accumulationBuffer[I]+=this.m_staticPressureBuffer[I]);d=d.dt/(this.m_def.density*this.m_particleDiameter);I=this.GetParticleInvMass();for(U=0;U<this.m_bodyContactBuffer.count;U++){var ka=this.m_bodyContactBuffer.data[U];Z=ka.index;const ia=ka.body,ta=ka.weight,Ja=u[Z];ka=z.MulSV(d*ta*ka.mass*(this.m_accumulationBuffer[Z]+
L*ta),ka.normal,n);C[Z].SelfMulSub(I,ka);ia.ApplyLinearImpulse(ka,Ja,!0)}for(u=0;u<this.m_contactBuffer.count;u++)U=this.m_contactBuffer.data[u],L=U.indexA,I=U.indexB,U=z.MulSV(d*U.weight*(this.m_accumulationBuffer[L]+this.m_accumulationBuffer[I]),U.normal,n),C[L].SelfSub(U),C[I].SelfAdd(U)}SolveDamping(d){const n=nb.SolveDamping_s_v,u=nb.SolveDamping_s_f;var C=this.m_positionBuffer.data;const I=this.m_velocityBuffer.data,L=this.m_def.dampingStrength;d=1/this.GetCriticalVelocity(d);var U=this.GetParticleInvMass();
for(var Z=0;Z<this.m_bodyContactBuffer.count;Z++){var ka=this.m_bodyContactBuffer.data[Z],ia=ka.index,ta=ka.body,Ja=ka.weight,Oa=ka.mass;const zb=ka.normal;ka=C[ia];var Xa=z.SubVV(ta.GetLinearVelocityFromWorldPoint(ka,z.s_t0),I[ia],n);Xa=z.DotVV(Xa,zb);0>Xa&&(Ja=h(L*Ja,f(-d*Xa,.5)),Oa=z.MulSV(Ja*Oa*Xa,zb,u),I[ia].SelfMulAdd(U,Oa),ta.ApplyLinearImpulse(Oa.SelfNeg(),ka,!0))}for(C=0;C<this.m_contactBuffer.count;C++)ta=this.m_contactBuffer.data[C],U=ta.indexA,Z=ta.indexB,ia=ta.weight,ta=ta.normal,Oa=
z.SubVV(I[Z],I[U],n),Oa=z.DotVV(Oa,ta),0>Oa&&(ia=h(L*ia,f(-d*Oa,.5)),ia=z.MulSV(ia*Oa,ta,u),I[U].SelfAdd(ia),I[Z].SelfSub(ia))}SolveRigidDamping(){const d=nb.SolveRigidDamping_s_t0,n=nb.SolveRigidDamping_s_t1,u=nb.SolveRigidDamping_s_p,C=nb.SolveRigidDamping_s_v,I=[0],L=[0],U=[0],Z=[0],ka=[0],ia=[0],ta=this.m_positionBuffer.data,Ja=this.m_def.dampingStrength;for(var Oa=0;Oa<this.m_bodyContactBuffer.count;Oa++){var Xa=this.m_bodyContactBuffer.data[Oa],zb=Xa.index,Hb=this.m_groupBuffer[zb];if(Hb&&this.IsRigidGroup(Hb)){var Jb=
Xa.body,Tb=Xa.normal,Vb=Xa.weight;Xa=ta[zb];var Qb=z.SubVV(Jb.GetLinearVelocityFromWorldPoint(Xa,d),Hb.GetLinearVelocityFromWorldPoint(Xa,n),C);Qb=z.DotVV(Qb,Tb);0>Qb&&(this.InitDampingParameterWithRigidGroupOrParticle(I,L,U,!0,Hb,zb,Xa,Tb),this.InitDampingParameter(Z,ka,ia,Jb.GetMass(),Jb.GetInertia()-Jb.GetMass()*Jb.GetLocalCenter().LengthSquared(),Jb.GetWorldCenter(),Xa,Tb),Vb=Ja*f(Vb,1)*this.ComputeDampingImpulse(I[0],L[0],U[0],Z[0],ka[0],ia[0],Qb),this.ApplyDamping(I[0],L[0],U[0],!0,Hb,zb,Vb,
Tb),Jb.ApplyLinearImpulse(z.MulSV(-Vb,Tb,z.s_t0),Xa,!0))}}for(Oa=0;Oa<this.m_contactBuffer.count;Oa++){Tb=this.m_contactBuffer.data[Oa];zb=Tb.indexA;Hb=Tb.indexB;Jb=Tb.normal;var fc=Tb.weight;Tb=this.m_groupBuffer[zb];Xa=this.m_groupBuffer[Hb];Vb=this.IsRigidGroup(Tb);Qb=this.IsRigidGroup(Xa);if(Tb!==Xa&&(Vb||Qb)){const jc=z.MidVV(ta[zb],ta[Hb],u);var cc=z.SubVV(this.GetLinearVelocity(Xa,Hb,jc,d),this.GetLinearVelocity(Tb,zb,jc,n),C);cc=z.DotVV(cc,Jb);0>cc&&(this.InitDampingParameterWithRigidGroupOrParticle(I,
L,U,Vb,Tb,zb,jc,Jb),this.InitDampingParameterWithRigidGroupOrParticle(Z,ka,ia,Qb,Xa,Hb,jc,Jb),fc=Ja*fc*this.ComputeDampingImpulse(I[0],L[0],U[0],Z[0],ka[0],ia[0],cc),this.ApplyDamping(I[0],L[0],U[0],Vb,Tb,zb,fc,Jb),this.ApplyDamping(Z[0],ka[0],ia[0],Qb,Xa,Hb,-fc,Jb))}}}SolveExtraDamping(){const d=nb.SolveExtraDamping_s_v,n=nb.SolveExtraDamping_s_f,u=this.m_velocityBuffer.data,C=this.m_positionBuffer.data,I=this.GetParticleInvMass();for(let ka=0;ka<this.m_bodyContactBuffer.count;ka++){var L=this.m_bodyContactBuffer.data[ka];
const ia=L.index;if(this.m_flagsBuffer.data[ia]&nb.k_extraDampingFlags){const ta=L.body;var U=L.mass;const Ja=L.normal;L=C[ia];var Z=z.SubVV(ta.GetLinearVelocityFromWorldPoint(L,z.s_t0),u[ia],d);Z=z.DotVV(Z,Ja);0>Z&&(U=z.MulSV(.5*U*Z,Ja,n),u[ia].SelfMulAdd(I,U),ta.ApplyLinearImpulse(U.SelfNeg(),L,!0))}}}SolveWall(){const d=this.m_velocityBuffer.data;for(let n=0;n<this.m_count;n++)this.m_flagsBuffer.data[n]&a.ParticleFlag.b2_wallParticle&&d[n].SetZero()}SolveRigid(d){const n=nb.SolveRigid_s_position,
u=nb.SolveRigid_s_rotation,C=nb.SolveRigid_s_transform,I=nb.SolveRigid_s_velocityTransform,L=this.m_positionBuffer.data,U=this.m_velocityBuffer.data;for(let ia=this.m_groupList;ia;ia=ia.GetNext())if(ia.m_groupFlags&a.ParticleGroupFlag.b2_rigidParticleGroup){ia.UpdateStatistics();var Z=u;Z.SetAngle(d.dt*ia.m_angularVelocity);const ta=z.AddVV(ia.m_center,z.SubVV(z.MulSV(d.dt,ia.m_linearVelocity,z.s_t0),ib.MulRV(Z,ia.m_center,z.s_t1),z.s_t0),n);var ka=C;ka.SetPositionRotation(ta,Z);rb.MulXX(ka,ia.m_transform,
ia.m_transform);Z=I;Z.p.x=d.inv_dt*ka.p.x;Z.p.y=d.inv_dt*ka.p.y;Z.q.s=d.inv_dt*ka.q.s;Z.q.c=d.inv_dt*(ka.q.c-1);for(ka=ia.m_firstIndex;ka<ia.m_lastIndex;ka++)rb.MulXV(Z,L[ka],U[ka])}}SolveElastic(d){const n=nb.SolveElastic_s_pa,u=nb.SolveElastic_s_pb,C=nb.SolveElastic_s_pc,I=nb.SolveElastic_s_r,L=nb.SolveElastic_s_t0,U=this.m_positionBuffer.data,Z=this.m_velocityBuffer.data,ka=d.inv_dt*this.m_def.elasticStrength;for(let Hb=0;Hb<this.m_triadBuffer.count;Hb++){var ia=this.m_triadBuffer.data[Hb];if(ia.flags&
a.ParticleFlag.b2_elasticParticle){var ta=ia.indexA,Ja=ia.indexB,Oa=ia.indexC;const Jb=ia.pa,Tb=ia.pb,Vb=ia.pc,Qb=n.Copy(U[ta]),fc=u.Copy(U[Ja]),cc=C.Copy(U[Oa]);ta=Z[ta];Ja=Z[Ja];Oa=Z[Oa];Qb.SelfMulAdd(d.dt,ta);fc.SelfMulAdd(d.dt,Ja);cc.SelfMulAdd(d.dt,Oa);var Xa=(Qb.x+fc.x+cc.x)/3,zb=(Qb.y+fc.y+cc.y)/3;Qb.x-=Xa;Qb.y-=zb;fc.x-=Xa;fc.y-=zb;cc.x-=Xa;cc.y-=zb;Xa=I;Xa.s=z.CrossVV(Jb,Qb)+z.CrossVV(Tb,fc)+z.CrossVV(Vb,cc);Xa.c=z.DotVV(Jb,Qb)+z.DotVV(Tb,fc)+z.DotVV(Vb,cc);zb=q(Xa.s*Xa.s+Xa.c*Xa.c);isFinite(zb)||
(zb=1.98177537E19);Xa.s*=zb;Xa.c*=zb;ia=ka*ia.strength;ib.MulRV(Xa,Jb,L);z.SubVV(L,Qb,L);z.MulSV(ia,L,L);ta.SelfAdd(L);ib.MulRV(Xa,Tb,L);z.SubVV(L,fc,L);z.MulSV(ia,L,L);Ja.SelfAdd(L);ib.MulRV(Xa,Vb,L);z.SubVV(L,cc,L);z.MulSV(ia,L,L);Oa.SelfAdd(L)}}}SolveSpring(d){const n=nb.SolveSpring_s_pa,u=nb.SolveSpring_s_pb,C=nb.SolveSpring_s_d,I=nb.SolveSpring_s_f,L=this.m_positionBuffer.data,U=this.m_velocityBuffer.data,Z=d.inv_dt*this.m_def.springStrength;for(let Xa=0;Xa<this.m_pairBuffer.count;Xa++){var ka=
this.m_pairBuffer.data[Xa];if(ka.flags&a.ParticleFlag.b2_springParticle){var ia=ka.indexA,ta=ka.indexB,Ja=n.Copy(L[ia]),Oa=u.Copy(L[ta]);ia=U[ia];ta=U[ta];Ja.SelfMulAdd(d.dt,ia);Oa.SelfMulAdd(d.dt,ta);Ja=z.SubVV(Oa,Ja,C);Oa=ka.distance;const zb=Ja.Length();ka=z.MulSV(Z*ka.strength*(Oa-zb)/zb,Ja,I);ia.SelfSub(ka);ta.SelfAdd(ka)}}}SolveTensile(d){var n=nb.SolveTensile_s_weightedNormal;const u=nb.SolveTensile_s_s,C=nb.SolveTensile_s_f,I=this.m_velocityBuffer.data;for(var L=0;L<this.m_count;L++)this.m_accumulation2Buffer[L]=
new z,this.m_accumulation2Buffer[L].SetZero();for(L=0;L<this.m_contactBuffer.count;L++){var U=this.m_contactBuffer.data[L];if(U.flags&a.ParticleFlag.b2_tensileParticle){var Z=U.indexA,ka=U.indexB,ia=U.weight;U=z.MulSV((1-ia)*ia,U.normal,n);this.m_accumulation2Buffer[Z].SelfSub(U);this.m_accumulation2Buffer[ka].SelfAdd(U)}}L=this.GetCriticalVelocity(d);d=this.m_def.surfaceTensionPressureStrength*L;n=this.m_def.surfaceTensionNormalStrength*L;L*=.5;for(Z=0;Z<this.m_contactBuffer.count;Z++){var ta=this.m_contactBuffer.data[Z];
if(ta.flags&a.ParticleFlag.b2_tensileParticle){ka=ta.indexA;U=ta.indexB;ia=ta.weight;ta=ta.normal;const Ja=this.m_weightBuffer[ka]+this.m_weightBuffer[U],Oa=z.SubVV(this.m_accumulation2Buffer[U],this.m_accumulation2Buffer[ka],u);ia*=f(d*(Ja-2)+n*z.DotVV(Oa,ta),L);ia=z.MulSV(ia,ta,C);I[ka].SelfSub(ia);I[U].SelfAdd(ia)}}}SolveViscous(){const d=nb.SolveViscous_s_v,n=nb.SolveViscous_s_f;var u=this.m_positionBuffer.data;const C=this.m_velocityBuffer.data,I=this.m_def.viscousStrength;var L=this.GetParticleInvMass();
for(var U=0;U<this.m_bodyContactBuffer.count;U++){var Z=this.m_bodyContactBuffer.data[U],ka=Z.index;if(this.m_flagsBuffer.data[ka]&a.ParticleFlag.b2_viscousParticle){var ia=Z.body,ta=Z.weight;const Ja=Z.mass;Z=u[ka];const Oa=z.SubVV(ia.GetLinearVelocityFromWorldPoint(Z,z.s_t0),C[ka],d);ta=z.MulSV(I*Ja*ta,Oa,n);C[ka].SelfMulAdd(L,ta);ia.ApplyLinearImpulse(ta.SelfNeg(),Z,!0)}}for(u=0;u<this.m_contactBuffer.count;u++)ka=this.m_contactBuffer.data[u],ka.flags&a.ParticleFlag.b2_viscousParticle&&(L=ka.indexA,
U=ka.indexB,ka=ka.weight,ia=z.SubVV(C[U],C[L],d),ka=z.MulSV(I*ka,ia,n),C[L].SelfAdd(ka),C[U].SelfSub(ka))}SolveRepulsive(d){const n=nb.SolveRepulsive_s_f,u=this.m_velocityBuffer.data;d=this.m_def.repulsiveStrength*this.GetCriticalVelocity(d);for(let I=0;I<this.m_contactBuffer.count;I++){var C=this.m_contactBuffer.data[I];if(C.flags&a.ParticleFlag.b2_repulsiveParticle){const L=C.indexA,U=C.indexB;this.m_groupBuffer[L]!==this.m_groupBuffer[U]&&(C=z.MulSV(d*C.weight,C.normal,n),u[L].SelfSub(C),u[U].SelfAdd(C))}}}SolvePowder(d){const n=
nb.SolvePowder_s_f;var u=this.m_positionBuffer.data;const C=this.m_velocityBuffer.data;d=this.m_def.powderStrength*this.GetCriticalVelocity(d);var I=this.GetParticleInvMass();for(var L=0;L<this.m_bodyContactBuffer.count;L++){var U=this.m_bodyContactBuffer.data[L],Z=U.index;if(this.m_flagsBuffer.data[Z]&a.ParticleFlag.b2_powderParticle){const ia=U.weight;if(.25<ia){var ka=U.body;const ta=u[Z];U=z.MulSV(d*U.mass*(ia-.25),U.normal,n);C[Z].SelfMulSub(I,U);ka.ApplyLinearImpulse(U,ta,!0)}}}for(u=0;u<this.m_contactBuffer.count;u++)Z=
this.m_contactBuffer.data[u],Z.flags&a.ParticleFlag.b2_powderParticle&&(ka=Z.weight,.25<ka&&(I=Z.indexA,L=Z.indexB,Z=z.MulSV(d*(ka-.25),Z.normal,n),C[I].SelfSub(Z),C[L].SelfAdd(Z)))}SolveSolid(d){const n=nb.SolveSolid_s_f,u=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);d=d.inv_dt*this.m_def.ejectionStrength;for(let I=0;I<this.m_contactBuffer.count;I++){var C=this.m_contactBuffer.data[I];const L=C.indexA,U=C.indexB;this.m_groupBuffer[L]!==this.m_groupBuffer[U]&&
(C=z.MulSV(d*(this.m_depthBuffer[L]+this.m_depthBuffer[U])*C.weight,C.normal,n),u[L].SelfSub(C),u[U].SelfAdd(C))}}SolveForce(d){const n=this.m_velocityBuffer.data;d=d.dt*this.GetParticleInvMass();for(let u=0;u<this.m_count;u++)n[u].SelfMulAdd(d,this.m_forceBuffer[u]);this.m_hasForce=!1}SolveColorMixing(){const d=.5*this.m_def.colorMixingStrength;if(d)for(let u=0;u<this.m_contactBuffer.count;u++){var n=this.m_contactBuffer.data[u];const C=n.indexA;n=n.indexB;this.m_flagsBuffer.data[C]&this.m_flagsBuffer.data[n]&
a.ParticleFlag.b2_colorMixingParticle&&ya.MixColors(this.m_colorBuffer.data[C],this.m_colorBuffer.data[n],d)}}SolveZombie(){var d=0,n=[];for(var u=0;u<this.m_count;u++)n[u]=-1;u=0;for(var C=0;C<this.m_count;C++){var I=this.m_flagsBuffer.data[C];if(I&a.ParticleFlag.b2_zombieParticle){var L=this.m_world.m_destructionListener;I&a.ParticleFlag.b2_destructionListenerParticle&&L&&L.SayGoodbyeParticle(this,C);this.m_handleIndexBuffer.data&&(I=this.m_handleIndexBuffer.data[C])&&(I.SetIndex(-1),this.m_handleIndexBuffer.data[C]=
null);n[C]=-1}else n[C]=d,C!==d&&(this.m_handleIndexBuffer.data&&((L=this.m_handleIndexBuffer.data[C])&&L.SetIndex(d),this.m_handleIndexBuffer.data[d]=L),this.m_flagsBuffer.data[d]=this.m_flagsBuffer.data[C],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[d]=this.m_lastBodyContactStepBuffer.data[C]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[d]=this.m_bodyContactCountBuffer.data[C]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[d]=
this.m_consecutiveContactStepsBuffer.data[C]),this.m_positionBuffer.data[d].Copy(this.m_positionBuffer.data[C]),this.m_velocityBuffer.data[d].Copy(this.m_velocityBuffer.data[C]),this.m_groupBuffer[d]=this.m_groupBuffer[C],this.m_hasForce&&this.m_forceBuffer[d].Copy(this.m_forceBuffer[C]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[d]=this.m_staticPressureBuffer[C]),this.m_depthBuffer&&(this.m_depthBuffer[d]=this.m_depthBuffer[C]),this.m_colorBuffer.data&&this.m_colorBuffer.data[d].Copy(this.m_colorBuffer.data[C]),
this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[d]=this.m_userDataBuffer.data[C]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[d]=this.m_expirationTimeBuffer.data[C])),d++,u|=I}for(C=0;C<this.m_proxyBuffer.count;C++)I=this.m_proxyBuffer.data[C],I.index=n[I.index];this.m_proxyBuffer.RemoveIf(U=>0>U.index);for(C=0;C<this.m_contactBuffer.count;C++)I=this.m_contactBuffer.data[C],I.indexA=n[I.indexA],I.indexB=n[I.indexB];this.m_contactBuffer.RemoveIf(U=>0>U.indexA||0>U.indexB);
for(C=0;C<this.m_bodyContactBuffer.count;C++)I=this.m_bodyContactBuffer.data[C],I.index=n[I.index];this.m_bodyContactBuffer.RemoveIf(U=>0>U.index);for(C=0;C<this.m_pairBuffer.count;C++)I=this.m_pairBuffer.data[C],I.indexA=n[I.indexA],I.indexB=n[I.indexB];this.m_pairBuffer.RemoveIf(U=>0>U.indexA||0>U.indexB);for(C=0;C<this.m_triadBuffer.count;C++)I=this.m_triadBuffer.data[C],I.indexA=n[I.indexA],I.indexB=n[I.indexB],I.indexC=n[I.indexC];this.m_triadBuffer.RemoveIf(U=>0>U.indexA||0>U.indexB||0>U.indexC);
if(this.m_indexByExpirationTimeBuffer.data)for(C=0,I=0;I<this.m_count;I++)L=n[this.m_indexByExpirationTimeBuffer.data[I]],-1!==L&&(this.m_indexByExpirationTimeBuffer.data[C++]=L);for(C=this.m_groupList;C;C=C.GetNext()){I=d;L=0;let U=!1;for(let Z=C.m_firstIndex;Z<C.m_lastIndex;Z++){const ka=n[Z];0<=ka?(I=f(I,ka),L=h(L,ka+1)):U=!0}I<L?(C.m_firstIndex=I,C.m_lastIndex=L,U&&C.m_groupFlags&a.ParticleGroupFlag.b2_solidParticleGroup&&this.SetGroupFlags(C,C.m_groupFlags|a.ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth)):
(C.m_firstIndex=0,C.m_lastIndex=0,C.m_groupFlags&a.ParticleGroupFlag.b2_particleGroupCanBeEmpty||this.SetGroupFlags(C,C.m_groupFlags|a.ParticleGroupFlag.b2_particleGroupWillBeDestroyed))}this.m_count=d;this.m_allParticleFlags=u;this.m_needsUpdateAllParticleFlags=!1;for(d=this.m_groupList;d;)n=d.GetNext(),d.m_groupFlags&a.ParticleGroupFlag.b2_particleGroupWillBeDestroyed&&this.DestroyParticleGroup(d),d=n}SolveLifetimes(d){this.m_timeElapsed=this.LifetimeToExpirationTime(d.dt);d=this.GetQuantizedTimeElapsed();
const n=this.m_expirationTimeBuffer.data,u=this.m_indexByExpirationTimeBuffer.data;var C=this.GetParticleCount();this.m_expirationTimeBufferRequiresSorting&&(ra(u,0,C,(I,L)=>{I=n[I];L=n[L];const U=0>=I;return U===0>=L?I>L:U}),this.m_expirationTimeBufferRequiresSorting=!1);for(--C;0<=C;--C){const I=u[C],L=n[I];if(d<L||0>=L)break;this.DestroyParticle(I)}}RotateBuffer(d,n,u){function C(U){return U<d?U:U<n?U+u-n:U<u?U+d-n:U}if(d!==n&&n!==u){za(this.m_flagsBuffer.data,d,n,u);this.m_lastBodyContactStepBuffer.data&&
za(this.m_lastBodyContactStepBuffer.data,d,n,u);this.m_bodyContactCountBuffer.data&&za(this.m_bodyContactCountBuffer.data,d,n,u);this.m_consecutiveContactStepsBuffer.data&&za(this.m_consecutiveContactStepsBuffer.data,d,n,u);za(this.m_positionBuffer.data,d,n,u);za(this.m_velocityBuffer.data,d,n,u);za(this.m_groupBuffer,d,n,u);this.m_hasForce&&za(this.m_forceBuffer,d,n,u);this.m_staticPressureBuffer&&za(this.m_staticPressureBuffer,d,n,u);this.m_depthBuffer&&za(this.m_depthBuffer,d,n,u);this.m_colorBuffer.data&&
za(this.m_colorBuffer.data,d,n,u);this.m_userDataBuffer.data&&za(this.m_userDataBuffer.data,d,n,u);if(this.m_handleIndexBuffer.data){za(this.m_handleIndexBuffer.data,d,n,u);for(var I=d;I<u;++I){var L=this.m_handleIndexBuffer.data[I];L&&L.SetIndex(C(L.GetIndex()))}}if(this.m_expirationTimeBuffer.data){za(this.m_expirationTimeBuffer.data,d,n,u);I=this.GetParticleCount();L=this.m_indexByExpirationTimeBuffer.data;for(let U=0;U<I;++U)L[U]=C(L[U])}for(I=0;I<this.m_proxyBuffer.count;I++)L=this.m_proxyBuffer.data[I],
L.index=C(L.index);for(I=0;I<this.m_contactBuffer.count;I++)L=this.m_contactBuffer.data[I],L.indexA=C(L.indexA),L.indexB=C(L.indexB);for(I=0;I<this.m_bodyContactBuffer.count;I++)L=this.m_bodyContactBuffer.data[I],L.index=C(L.index);for(I=0;I<this.m_pairBuffer.count;I++)L=this.m_pairBuffer.data[I],L.indexA=C(L.indexA),L.indexB=C(L.indexB);for(I=0;I<this.m_triadBuffer.count;I++)L=this.m_triadBuffer.data[I],L.indexA=C(L.indexA),L.indexB=C(L.indexB),L.indexC=C(L.indexC);for(I=this.m_groupList;I;I=I.GetNext())I.m_firstIndex=
C(I.m_firstIndex),I.m_lastIndex=C(I.m_lastIndex-1)+1}}GetCriticalVelocity(d){return this.m_particleDiameter*d.inv_dt}GetCriticalVelocitySquared(d){d=this.GetCriticalVelocity(d);return d*d}GetCriticalPressure(d){return this.m_def.density*this.GetCriticalVelocitySquared(d)}GetParticleStride(){return.75*this.m_particleDiameter}GetParticleMass(){const d=this.GetParticleStride();return this.m_def.density*d*d}GetParticleInvMass(){const d=1/.75*this.m_inverseDiameter;return this.m_inverseDensity*d*d}GetFixtureContactFilter(){return this.m_allParticleFlags&
a.ParticleFlag.b2_fixtureContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}GetParticleContactFilter(){return this.m_allParticleFlags&a.ParticleFlag.b2_particleContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}GetFixtureContactListener(){return this.m_allParticleFlags&a.ParticleFlag.b2_fixtureContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null}GetParticleContactListener(){return this.m_allParticleFlags&a.ParticleFlag.b2_particleContactListenerParticle?
this.m_world.m_contactManager.m_contactListener:null}SetUserOverridableBuffer(d,n){d.data=n;d.userSuppliedCapacity=n.length}SetGroupFlags(d,n){const u=d.m_groupFlags;(u^n)&a.ParticleGroupFlag.b2_solidParticleGroup&&(n|=a.ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth);u&~n&&(this.m_needsUpdateAllGroupFlags=!0);~this.m_allGroupFlags&n&&(n&a.ParticleGroupFlag.b2_solidParticleGroup&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=n);d.m_groupFlags=n}static BodyContactCompare(d,
n){return d.index===n.index?d.weight>n.weight:d.index<n.index}RemoveSpuriousBodyContacts(){ra(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,nb.BodyContactCompare);const d=nb.RemoveSpuriousBodyContacts_s_n,n=nb.RemoveSpuriousBodyContacts_s_pos,u=nb.RemoveSpuriousBodyContacts_s_normal,C=this;let I=-1,L=0;this.m_bodyContactBuffer.count=Ga(this.m_bodyContactBuffer.data,U=>{U.index!==I&&(L=0,I=U.index);if(3<L++)return!0;var Z=d.Copy(U.normal);Z.SelfMul(C.m_particleDiameter*(1-U.weight));
Z=z.AddVV(C.m_positionBuffer.data[U.index],Z,n);if(!U.fixture.TestPoint(Z)){const ka=U.fixture.GetShape().GetChildCount();for(let ia=0;ia<ka;ia++)if(.005>U.fixture.ComputeDistance(Z,u,ia))return!1;return!0}return!1},this.m_bodyContactBuffer.count)}DetectStuckParticle(d){0>=this.m_stuckThreshold||(++this.m_bodyContactCountBuffer.data[d],2===this.m_bodyContactCountBuffer.data[d]&&(++this.m_consecutiveContactStepsBuffer.data[d],this.m_consecutiveContactStepsBuffer.data[d]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=
d)),this.m_lastBodyContactStepBuffer.data[d]=this.m_timestamp)}ValidateParticleIndex(d){return 0<=d&&d<this.GetParticleCount()&&-1!==d}GetQuantizedTimeElapsed(){return Math.floor(this.m_timeElapsed/4294967296)}LifetimeToExpirationTime(d){return this.m_timeElapsed+Math.floor(d/this.m_def.lifetimeGranularity*4294967296)}ForceCanBeApplied(d){return!(d&a.ParticleFlag.b2_wallParticle)}PrepareForceBuffer(){if(!this.m_hasForce){for(let d=0;d<this.m_count;d++)this.m_forceBuffer[d].SetZero();this.m_hasForce=
!0}}IsRigidGroup(d){return null!==d&&0!==(d.m_groupFlags&a.ParticleGroupFlag.b2_rigidParticleGroup)}GetLinearVelocity(d,n,u,C){return d&&this.IsRigidGroup(d)?d.GetLinearVelocityFromWorldPoint(u,C):C.Copy(this.m_velocityBuffer.data[n])}InitDampingParameter(d,n,u,C,I,L,U,Z){d[0]=0<C?1/C:0;n[0]=0<I?1/I:0;u[0]=z.CrossVV(z.SubVV(U,L,z.s_t0),Z)}InitDampingParameterWithRigidGroupOrParticle(d,n,u,C,I,L,U,Z){I&&C?this.InitDampingParameter(d,n,u,I.GetMass(),I.GetInertia(),I.GetCenter(),U,Z):this.InitDampingParameter(d,
n,u,this.m_flagsBuffer.data[L]&a.ParticleFlag.b2_wallParticle?0:this.GetParticleMass(),0,U,U,Z)}ComputeDampingImpulse(d,n,u,C,I,L,U){d=d+n*u*u+C+I*L*L;return 0<d?U/d:0}ApplyDamping(d,n,u,C,I,L,U,Z){I&&C?(I.m_linearVelocity.SelfMulAdd(U*d,Z),I.m_angularVelocity+=U*u*n):this.m_velocityBuffer.data[L].SelfMulAdd(U*d,Z)}}nb.xTruncBits=12;nb.yTruncBits=12;nb.tagBits=32;nb.yOffset=1<<nb.yTruncBits-1;nb.yShift=nb.tagBits-nb.yTruncBits;nb.xShift=nb.tagBits-nb.yTruncBits-nb.xTruncBits;nb.xScale=1<<nb.xShift;
nb.xOffset=nb.xScale*(1<<nb.xTruncBits-1);nb.yMask=(1<<nb.yTruncBits)-1<<nb.yShift;nb.xMask=~nb.yMask;nb.DestroyParticlesInShape_s_aabb=new Wa;nb.CreateParticleGroup_s_transform=new rb;nb.ComputeCollisionEnergy_s_v=new z;nb.QueryShapeAABB_s_aabb=new Wa;nb.QueryPointAABB_s_aabb=new Wa;nb.RayCast_s_aabb=new Wa;nb.RayCast_s_p=new z;nb.RayCast_s_v=new z;nb.RayCast_s_n=new z;nb.RayCast_s_point=new z;nb.k_pairFlags=a.ParticleFlag.b2_springParticle;nb.k_triadFlags=a.ParticleFlag.b2_elasticParticle;nb.k_noPressureFlags=
a.ParticleFlag.b2_powderParticle|a.ParticleFlag.b2_tensileParticle;nb.k_extraDampingFlags=a.ParticleFlag.b2_staticPressureParticle;nb.k_barrierWallFlags=a.ParticleFlag.b2_barrierParticle|a.ParticleFlag.b2_wallParticle;nb.CreateParticlesStrokeShapeForGroup_s_edge=new kb;nb.CreateParticlesStrokeShapeForGroup_s_d=new z;nb.CreateParticlesStrokeShapeForGroup_s_p=new z;nb.CreateParticlesFillShapeForGroup_s_aabb=new Wa;nb.CreateParticlesFillShapeForGroup_s_p=new z;nb.UpdatePairsAndTriads_s_dab=new z;nb.UpdatePairsAndTriads_s_dbc=
new z;nb.UpdatePairsAndTriads_s_dca=new z;nb.AddContact_s_d=new z;nb.UpdateBodyContacts_s_aabb=new Wa;nb.Solve_s_subStep=new He;nb.SolveCollision_s_aabb=new Wa;nb.SolveGravity_s_gravity=new z;nb.SolveBarrier_s_aabb=new Wa;nb.SolveBarrier_s_va=new z;nb.SolveBarrier_s_vb=new z;nb.SolveBarrier_s_pba=new z;nb.SolveBarrier_s_vba=new z;nb.SolveBarrier_s_vc=new z;nb.SolveBarrier_s_pca=new z;nb.SolveBarrier_s_vca=new z;nb.SolveBarrier_s_qba=new z;nb.SolveBarrier_s_qca=new z;nb.SolveBarrier_s_dv=new z;nb.SolveBarrier_s_f=
new z;nb.SolvePressure_s_f=new z;nb.SolveDamping_s_v=new z;nb.SolveDamping_s_f=new z;nb.SolveRigidDamping_s_t0=new z;nb.SolveRigidDamping_s_t1=new z;nb.SolveRigidDamping_s_p=new z;nb.SolveRigidDamping_s_v=new z;nb.SolveExtraDamping_s_v=new z;nb.SolveExtraDamping_s_f=new z;nb.SolveRigid_s_position=new z;nb.SolveRigid_s_rotation=new ib;nb.SolveRigid_s_transform=new rb;nb.SolveRigid_s_velocityTransform=new rb;nb.SolveElastic_s_pa=new z;nb.SolveElastic_s_pb=new z;nb.SolveElastic_s_pc=new z;nb.SolveElastic_s_r=
new ib;nb.SolveElastic_s_t0=new z;nb.SolveSpring_s_pa=new z;nb.SolveSpring_s_pb=new z;nb.SolveSpring_s_d=new z;nb.SolveSpring_s_f=new z;nb.SolveTensile_s_weightedNormal=new z;nb.SolveTensile_s_s=new z;nb.SolveTensile_s_f=new z;nb.SolveViscous_s_v=new z;nb.SolveViscous_s_f=new z;nb.SolveRepulsive_s_f=new z;nb.SolvePowder_s_f=new z;nb.SolveSolid_s_f=new z;nb.RemoveSpuriousBodyContacts_s_n=new z;nb.RemoveSpuriousBodyContacts_s_pos=new z;nb.RemoveSpuriousBodyContacts_s_normal=new z;class Fd{constructor(){this._data=
null;this.userSuppliedCapacity=0}get data(){return this._data}set data(d){this._data=d}}class Je{constructor(){this.index=-1;this.tag=0}static CompareProxyProxy(d,n){return d.tag<n.tag}static CompareTagProxy(d,n){return d<n.tag}static CompareProxyTag(d,n){return d.tag<n}}class Ji{constructor(d,n,u,C,I){this.m_system=d;this.m_xLower=(n&nb.xMask)>>>0;this.m_xUpper=(u&nb.xMask)>>>0;this.m_yLower=(n&nb.yMask)>>>0;this.m_yUpper=(u&nb.yMask)>>>0;this.m_first=C;this.m_last=I}GetNext(){for(;this.m_first<
this.m_last;){const d=(this.m_system.m_proxyBuffer.data[this.m_first].tag&nb.xMask)>>>0;if(d>=this.m_xLower&&d<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return-1}}class Gi{constructor(){this.next=null;this.index=this.count=0}}class ch{Allocate(d,n){return n}Clear(){}GetCount(){return 0}Invalidate(){}GetValidBuffer(){return[]}GetBuffer(){return[]}SetCount(){}}class Tl{constructor(d,n){this.second=-1;this.first=d;this.second=n}}class Li extends ch{Initialize(){}Find(){return-1}}
class Ul{constructor(d,n){this.second=this.first=-1;this.first=d;this.second=n}}class Ki extends ch{Initialize(){}Find(){return-1}}class ig{IsNecessary(){return!0}ShouldCreatePair(){return!0}ShouldCreateTriad(){return!0}}class Ei extends Wd{constructor(d,n,u,C){super();this.m_system=d;this.m_shape=n;this.m_xf=u;this.m_callDestructionListener=C;this.m_destroyed=0}ReportFixture(){return!1}ReportParticle(d,n){if(d!==this.m_system)return!1;this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[n])&&
(this.m_system.DestroyParticle(n,this.m_callDestructionListener),this.m_destroyed++);return!0}Destroyed(){return this.m_destroyed}}class Fi extends ig{constructor(d){super();this.m_threshold=d}ShouldCreatePair(d,n){return d<this.m_threshold&&this.m_threshold<=n||n<this.m_threshold&&this.m_threshold<=d}ShouldCreateTriad(d,n,u){return(d<this.m_threshold||n<this.m_threshold||u<this.m_threshold)&&(this.m_threshold<=d||this.m_threshold<=n||this.m_threshold<=u)}}class Hi extends gb{constructor(d,n=d.length){super(a.ShapeType.e_unknown,
0);this.m_shapes=d;this.m_shapeCount=n}Clone(){throw Error();}GetChildCount(){return 1}TestPoint(d,n){for(let u=0;u<this.m_shapeCount;u++)if(this.m_shapes[u].TestPoint(d,n))return!0;return!1}ComputeDistance(){return 0}RayCast(){return!1}ComputeAABB(d,n){const u=new Wa;d.lowerBound.x=1E37;d.lowerBound.y=1E37;d.upperBound.x=-1E37;d.upperBound.y=-1E37;for(let C=0;C<this.m_shapeCount;C++){const I=this.m_shapes[C].GetChildCount();for(let L=0;L<I;L++){const U=u;this.m_shapes[C].ComputeAABB(U,n,L);d.Combine1(U)}}}ComputeMass(){}SetupDistanceProxy(){}ComputeSubmergedArea(){return 0}Dump(){}}
class Ii extends ig{constructor(d){super();this.m_flagsBuffer=d}IsNecessary(d){return 0!==(this.m_flagsBuffer.data[d]&a.ParticleFlag.b2_reactiveParticle)}}class cf extends $g{constructor(d,n=null){super(d);this.m_contactFilter=n}ShouldCollideFixtureParticle(d,n,u){return this.m_contactFilter&&this.m_system.GetFlagsBuffer()[u]&a.ParticleFlag.b2_fixtureContactFilterParticle?this.m_contactFilter.ShouldCollideFixtureParticle(d,this.m_system,u):!0}ReportFixtureAndParticle(d,n,u){var C=cf.ReportFixtureAndParticle_s_rp,
I=this.m_system.m_positionBuffer.data[u];const L=cf.ReportFixtureAndParticle_s_n;n=d.ComputeDistance(I,L,n);if(n<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(d,this.m_system,u)){const ka=d.GetBody(),ia=ka.GetWorldCenter();var U=ka.GetMass(),Z=ka.GetInertia()-U*ka.GetLocalCenter().LengthSquared();U=0<U?1/U:0;Z=0<Z?1/Z:0;const ta=this.m_system.m_flagsBuffer.data[u]&a.ParticleFlag.b2_wallParticle?0:this.m_system.GetParticleInvMass();C=z.SubVV(I,ia,C);C=z.CrossVV(C,L);C=ta+U+Z*
C*C;I=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];I.index=u;I.body=ka;I.fixture=d;I.weight=1-n*this.m_system.m_inverseDiameter;I.normal.Copy(L.SelfNeg());I.mass=0<C?1/C:0;this.m_system.DetectStuckParticle(u)}}}cf.ReportFixtureAndParticle_s_n=new z;cf.ReportFixtureAndParticle_s_rp=new z;class xd extends $g{constructor(d,n){super(d);this.m_step=n}ReportFixtureAndParticle(d,n,u){var C=xd.ReportFixtureAndParticle_s_p1;const I=xd.ReportFixtureAndParticle_s_output,
L=xd.ReportFixtureAndParticle_s_input,U=xd.ReportFixtureAndParticle_s_p,Z=xd.ReportFixtureAndParticle_s_v,ka=xd.ReportFixtureAndParticle_s_f,ia=d.GetBody(),ta=this.m_system.m_positionBuffer.data[u],Ja=this.m_system.m_velocityBuffer.data[u];0===this.m_system.m_iterationIndex?(C=rb.MulTXV(ia.m_xf0,ta,C),d.GetShape().GetType()===a.ShapeType.e_circleShape&&(C.SelfSub(ia.GetLocalCenter()),ib.MulRV(ia.m_xf0.q,C,C),ib.MulTRV(ia.m_xf.q,C,C),C.SelfAdd(ia.GetLocalCenter())),rb.MulXV(ia.m_xf,C,L.p1)):L.p1.Copy(ta);
z.AddVMulSV(ta,this.m_step.dt,Ja,L.p2);L.maxFraction=1;d.RayCast(I,L,n)&&(d=I.normal,U.x=(1-I.fraction)*L.p1.x+I.fraction*L.p2.x+.005*d.x,U.y=(1-I.fraction)*L.p1.y+I.fraction*L.p2.y+.005*d.y,Z.x=this.m_step.inv_dt*(U.x-ta.x),Z.y=this.m_step.inv_dt*(U.y-ta.y),this.m_system.m_velocityBuffer.data[u].Copy(Z),ka.x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(Ja.x-Z.x),ka.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(Ja.y-Z.y),this.m_system.ParticleApplyForce(u,ka))}ReportParticle(){return!1}}
xd.ReportFixtureAndParticle_s_p1=new z;xd.ReportFixtureAndParticle_s_output=new Ka;xd.ReportFixtureAndParticle_s_input=new Ta;xd.ReportFixtureAndParticle_s_p=new z;xd.ReportFixtureAndParticle_s_v=new z;xd.ReportFixtureAndParticle_s_f=new z;class wc{constructor(d){this.m_contactManager=new si;this.m_particleSystemList=this.m_jointList=this.m_bodyList=null;this.m_jointCount=this.m_bodyCount=0;this.m_gravity=new z;this.m_allowSleep=!0;this.m_debugDraw=this.m_destructionListener=null;this.m_inv_dt0=0;
this.m_locked=this.m_newContacts=!1;this.m_continuousPhysics=this.m_warmStarting=this.m_clearForces=!0;this.m_subStepping=!1;this.m_stepComplete=!0;this.m_profile=new Xg;this.m_island=new kd;this.s_stack=[];this.m_controllerList=null;this.m_controllerCount=0;this.m_gravity.Copy(d)}SetDestructionListener(d){this.m_destructionListener=d}SetContactFilter(d){this.m_contactManager.m_contactFilter=d}SetContactListener(d){this.m_contactManager.m_contactListener=d}SetDebugDraw(d){this.m_debugDraw=d}CreateBody(d=
{}){if(this.IsLocked())throw Error();d=new ud(d,this);d.m_prev=null;if(d.m_next=this.m_bodyList)this.m_bodyList.m_prev=d;this.m_bodyList=d;++this.m_bodyCount;return d}DestroyBody(d){if(this.IsLocked())throw Error();for(var n=d.m_jointList;n;){var u=n;n=n.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(u.joint);this.DestroyJoint(u.joint);d.m_jointList=n}d.m_jointList=null;for(n=d.m_controllerList;n;)u=n,n=n.nextController,u.controller.RemoveBody(d);for(n=d.m_contactList;n;)u=
n,n=n.next,this.m_contactManager.Destroy(u.contact);d.m_contactList=null;for(n=d.m_fixtureList;n;)u=n,n=n.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(u),u.DestroyProxies(),u.Reset(),d.m_fixtureList=n,--d.m_fixtureCount;d.m_fixtureList=null;d.m_fixtureCount=0;d.m_prev&&(d.m_prev.m_next=d.m_next);d.m_next&&(d.m_next.m_prev=d.m_prev);d===this.m_bodyList&&(this.m_bodyList=d.m_next);--this.m_bodyCount}static _Joint_Create(d){switch(d.type){case a.JointType.e_distanceJoint:return new rc(d);
case a.JointType.e_mouseJoint:return new pe(d);case a.JointType.e_prismaticJoint:return new gc(d);case a.JointType.e_revoluteJoint:return new Bc(d);case a.JointType.e_pulleyJoint:return new Uc(d);case a.JointType.e_gearJoint:return new Qc(d);case a.JointType.e_wheelJoint:return new uc(d);case a.JointType.e_weldJoint:return new Yc(d);case a.JointType.e_frictionJoint:return new ne(d);case a.JointType.e_motorJoint:return new oe(d);case a.JointType.e_areaJoint:return new li(d)}throw Error();}static _Joint_Destroy(){}CreateJoint(d){if(this.IsLocked())throw Error();
d=wc._Joint_Create(d);d.m_prev=null;if(d.m_next=this.m_jointList)this.m_jointList.m_prev=d;this.m_jointList=d;++this.m_jointCount;d.m_edgeA.prev=null;if(d.m_edgeA.next=d.m_bodyA.m_jointList)d.m_bodyA.m_jointList.prev=d.m_edgeA;d.m_bodyA.m_jointList=d.m_edgeA;d.m_edgeB.prev=null;if(d.m_edgeB.next=d.m_bodyB.m_jointList)d.m_bodyB.m_jointList.prev=d.m_edgeB;d.m_bodyB.m_jointList=d.m_edgeB;const n=d.m_bodyA;var u=d.m_bodyB;if(!d.m_collideConnected)for(u=u.GetContactList();u;)u.other===n&&u.contact.FlagForFiltering(),
u=u.next;return d}DestroyJoint(d){if(this.IsLocked())throw Error();d.m_prev&&(d.m_prev.m_next=d.m_next);d.m_next&&(d.m_next.m_prev=d.m_prev);d===this.m_jointList&&(this.m_jointList=d.m_next);const n=d.m_bodyA,u=d.m_bodyB,C=d.m_collideConnected;n.SetAwake(!0);u.SetAwake(!0);d.m_edgeA.prev&&(d.m_edgeA.prev.next=d.m_edgeA.next);d.m_edgeA.next&&(d.m_edgeA.next.prev=d.m_edgeA.prev);d.m_edgeA===n.m_jointList&&(n.m_jointList=d.m_edgeA.next);d.m_edgeA.Reset();d.m_edgeB.prev&&(d.m_edgeB.prev.next=d.m_edgeB.next);
d.m_edgeB.next&&(d.m_edgeB.next.prev=d.m_edgeB.prev);d.m_edgeB===u.m_jointList&&(u.m_jointList=d.m_edgeB.next);d.m_edgeB.Reset();wc._Joint_Destroy(d);--this.m_jointCount;if(!C)for(d=u.GetContactList();d;)d.other===n&&d.contact.FlagForFiltering(),d=d.next}CreateParticleSystem(d){if(this.IsLocked())throw Error();d=new nb(d,this);d.m_prev=null;if(d.m_next=this.m_particleSystemList)this.m_particleSystemList.m_prev=d;return this.m_particleSystemList=d}DestroyParticleSystem(d){if(this.IsLocked())throw Error();
d.m_prev&&(d.m_prev.m_next=d.m_next);d.m_next&&(d.m_next.m_prev=d.m_prev);d===this.m_particleSystemList&&(this.m_particleSystemList=d.m_next)}CalculateReasonableParticleIterations(d){if(null===this.m_particleSystemList)return 1;var n=this.m_gravity.Length();let u=1E37;for(let C=this.GetParticleSystemList();null!==C;C=C.m_next)u=f(u,C.GetRadius());return ua(n,u,d)}Step(d,n,u,C=this.CalculateReasonableParticleIterations(d)){const I=wc.Step_s_stepTimer.Reset();this.m_newContacts&&(this.m_contactManager.FindNewContacts(),
this.m_newContacts=!1);this.m_locked=!0;const L=wc.Step_s_step;L.dt=d;L.velocityIterations=n;L.positionIterations=u;L.particleIterations=C;L.inv_dt=0<d?1/d:0;L.dtRatio=this.m_inv_dt0*d;L.warmStarting=this.m_warmStarting;d=wc.Step_s_timer.Reset();this.m_contactManager.Collide();this.m_profile.collide=d.GetMilliseconds();if(this.m_stepComplete&&0<L.dt){d=wc.Step_s_timer.Reset();for(n=this.m_particleSystemList;n;n=n.m_next)n.Solve(L);this.Solve(L);this.m_profile.solve=d.GetMilliseconds()}this.m_continuousPhysics&&
0<L.dt&&(d=wc.Step_s_timer.Reset(),this.SolveTOI(L),this.m_profile.solveTOI=d.GetMilliseconds());0<L.dt&&(this.m_inv_dt0=L.inv_dt);this.m_clearForces&&this.ClearForces();this.m_locked=!1;this.m_profile.step=I.GetMilliseconds()}ClearForces(){for(let d=this.m_bodyList;d;d=d.m_next)d.m_force.SetZero(),d.m_torque=0}DrawParticleSystem(d){if(null!==this.m_debugDraw){var n=d.GetParticleCount();if(n){const u=d.GetRadius(),C=d.GetPositionBuffer();d.m_colorBuffer.data?(d=d.GetColorBuffer(),this.m_debugDraw.DrawParticles(C,
u,d,n)):this.m_debugDraw.DrawParticles(C,u,null,n)}}}DebugDraw(){if(null!==this.m_debugDraw){var d=this.m_debugDraw.GetFlags(),n=wc.DebugDraw_s_color.SetRGB(0,0,0);if(d&a.DrawFlags.e_shapeBit)for(var u=this.m_bodyList;u;u=u.m_next){var C=u.m_xf;this.m_debugDraw.PushTransform(C);for(var I=u.GetFixtureList();I;I=I.m_next)u.GetType()===a.BodyType.b2_dynamicBody&&0===u.m_mass?this.DrawShape(I,new ya(1,0,0)):(u.IsEnabled()?u.GetType()===a.BodyType.b2_staticBody?n.SetRGB(.5,.9,.5):u.GetType()===a.BodyType.b2_kinematicBody?
n.SetRGB(.5,.5,.9):u.IsAwake()?n.SetRGB(.9,.7,.7):n.SetRGB(.6,.6,.6):n.SetRGB(.5,.5,.3),this.DrawShape(I,n));this.m_debugDraw.PopTransform(C)}if(d&a.DrawFlags.e_particleBit)for(u=this.m_particleSystemList;u;u=u.m_next)this.DrawParticleSystem(u);if(d&a.DrawFlags.e_jointBit)for(u=this.m_jointList;u;u=u.m_next)u.Draw(this.m_debugDraw);if(d&a.DrawFlags.e_pairBit)for(n.SetRGB(.3,.9,.9),u=this.m_contactManager.m_contactList;u;u=u.m_next){var L=u.GetFixtureA();C=u.GetFixtureB();var U=u.GetChildIndexA();
I=u.GetChildIndexB();L=L.GetAABB(U).GetCenter();C=C.GetAABB(I).GetCenter();this.m_debugDraw.DrawSegment(L,C,n)}if(d&a.DrawFlags.e_aabbBit)for(n.SetRGB(.9,.3,.9),u=wc.DebugDraw_s_vs,C=this.m_bodyList;C;C=C.m_next)if(C.IsEnabled())for(I=C.GetFixtureList();I;I=I.m_next)for(L=0;L<I.m_proxyCount;++L)U=I.m_proxies[L].treeNode.aabb,u[0].Set(U.lowerBound.x,U.lowerBound.y),u[1].Set(U.upperBound.x,U.lowerBound.y),u[2].Set(U.upperBound.x,U.upperBound.y),u[3].Set(U.lowerBound.x,U.upperBound.y),this.m_debugDraw.DrawPolygon(u,
4,n);if(d&a.DrawFlags.e_centerOfMassBit)for(n=this.m_bodyList;n;n=n.m_next)u=wc.DebugDraw_s_xf,u.q.Copy(n.m_xf.q),u.p.Copy(n.GetWorldCenter()),this.m_debugDraw.DrawTransform(u);if(d&a.DrawFlags.e_controllerBit)for(d=this.m_controllerList;d;d=d.m_next)d.Draw(this.m_debugDraw)}}QueryAABB(...d){d[0]instanceof Wd?this._QueryAABB(d[0],d[1]):this._QueryAABB(null,d[0],d[1])}_QueryAABB(d,n,u){this.m_contactManager.m_broadPhase.Query(n,C=>{C=C.userData.fixture;return d?d.ReportFixture(C):u?u(C):!0});if(d instanceof
Wd)for(let C=this.m_particleSystemList;C;C=C.m_next)d.ShouldQueryParticleSystem(C)&&C.QueryAABB(d,n)}QueryAllAABB(d,n=[]){this.QueryAABB(d,u=>{n.push(u);return!0});return n}QueryPointAABB(...d){d[0]instanceof Wd?this._QueryPointAABB(d[0],d[1]):this._QueryPointAABB(null,d[0],d[1])}_QueryPointAABB(d,n,u){this.m_contactManager.m_broadPhase.QueryPoint(n,C=>{C=C.userData.fixture;return d?d.ReportFixture(C):u?u(C):!0});if(d instanceof Wd)for(let C=this.m_particleSystemList;C;C=C.m_next)d.ShouldQueryParticleSystem(C)&&
C.QueryPointAABB(d,n)}QueryAllPointAABB(d,n=[]){this.QueryPointAABB(d,u=>{n.push(u);return!0});return n}QueryFixtureShape(...d){d[0]instanceof Wd?this._QueryFixtureShape(d[0],d[1],d[2],d[3]):this._QueryFixtureShape(null,d[0],d[1],d[2],d[3])}_QueryFixtureShape(d,n,u,C,I){const L=wc.QueryFixtureShape_s_aabb;n.ComputeAABB(L,C,u);this.m_contactManager.m_broadPhase.Query(L,U=>{U=U.userData;const Z=U.fixture;if(F(n,u,Z.GetShape(),U.childIndex,C,Z.GetBody().GetTransform())){if(d)return d.ReportFixture(Z);
if(I)return I(Z)}return!0});if(d instanceof Wd)for(let U=this.m_particleSystemList;U;U=U.m_next)d.ShouldQueryParticleSystem(U)&&U.QueryAABB(d,L)}QueryAllFixtureShape(d,n,u,C=[]){this.QueryFixtureShape(d,n,u,I=>{C.push(I);return!0});return C}QueryFixturePoint(...d){d[0]instanceof Wd?this._QueryFixturePoint(d[0],d[1]):this._QueryFixturePoint(null,d[0],d[1])}_QueryFixturePoint(d,n,u){this.m_contactManager.m_broadPhase.QueryPoint(n,C=>{C=C.userData.fixture;if(C.TestPoint(n)){if(d)return d.ReportFixture(C);
if(u)return u(C)}return!0});if(d)for(let C=this.m_particleSystemList;C;C=C.m_next)d.ShouldQueryParticleSystem(C)&&C.QueryPointAABB(d,n)}QueryAllFixturePoint(d,n=[]){this.QueryFixturePoint(d,u=>{n.push(u);return!0});return n}RayCast(...d){d[0]instanceof ri?this._RayCast(d[0],d[1],d[2]):this._RayCast(null,d[0],d[1],d[2])}_RayCast(d,n,u,C){var I=wc.RayCast_s_input;I.maxFraction=1;I.p1.Copy(n);I.p2.Copy(u);this.m_contactManager.m_broadPhase.RayCast(I,(L,U)=>{var Z=U.userData;U=Z.fixture;const ka=wc.RayCast_s_output;
if(U.RayCast(ka,L,Z.childIndex)){Z=ka.fraction;const ia=wc.RayCast_s_point;ia.Set((1-Z)*n.x+Z*u.x,(1-Z)*n.y+Z*u.y);if(d)return d.ReportFixture(U,ia,ka.normal,Z);if(C)return C(U,ia,ka.normal,Z)}return L.maxFraction});if(d)for(I=this.m_particleSystemList;I;I=I.m_next)d.ShouldQueryParticleSystem(I)&&I.RayCast(d,n,u)}RayCastOne(d,n){let u=null,C=1;this.RayCast(d,n,(I,L,U,Z)=>{Z<C&&(C=Z,u=I);return C});return u}RayCastAll(d,n,u=[]){this.RayCast(d,n,C=>{u.push(C);return 1});return u}GetBodyList(){return this.m_bodyList}GetJointList(){return this.m_jointList}GetParticleSystemList(){return this.m_particleSystemList}GetContactList(){return this.m_contactManager.m_contactList}SetAllowSleeping(d){if(d!==
this.m_allowSleep&&(this.m_allowSleep=d,!this.m_allowSleep))for(d=this.m_bodyList;d;d=d.m_next)d.SetAwake(!0)}GetAllowSleeping(){return this.m_allowSleep}SetWarmStarting(d){this.m_warmStarting=d}GetWarmStarting(){return this.m_warmStarting}SetContinuousPhysics(d){this.m_continuousPhysics=d}GetContinuousPhysics(){return this.m_continuousPhysics}SetSubStepping(d){this.m_subStepping=d}GetSubStepping(){return this.m_subStepping}GetProxyCount(){return this.m_contactManager.m_broadPhase.GetProxyCount()}GetBodyCount(){return this.m_bodyCount}GetJointCount(){return this.m_jointCount}GetContactCount(){return this.m_contactManager.m_contactCount}GetTreeHeight(){return this.m_contactManager.m_broadPhase.GetTreeHeight()}GetTreeBalance(){return this.m_contactManager.m_broadPhase.GetTreeBalance()}GetTreeQuality(){return this.m_contactManager.m_broadPhase.GetTreeQuality()}SetGravity(d,
n=!0){if(!z.IsEqualToV(this.m_gravity,d)&&(this.m_gravity.Copy(d),n))for(d=this.m_bodyList;d;d=d.m_next)d.SetAwake(!0)}GetGravity(){return this.m_gravity}IsLocked(){return this.m_locked}SetAutoClearForces(d){this.m_clearForces=d}GetAutoClearForces(){return this.m_clearForces}ShiftOrigin(d){if(this.IsLocked())throw Error();for(var n=this.m_bodyList;n;n=n.m_next)n.m_xf.p.SelfSub(d),n.m_sweep.c0.SelfSub(d),n.m_sweep.c.SelfSub(d);for(n=this.m_jointList;n;n=n.m_next)n.ShiftOrigin(d);this.m_contactManager.m_broadPhase.ShiftOrigin(d)}GetContactManager(){return this.m_contactManager}GetProfile(){return this.m_profile}Dump(d){if(!this.m_locked){d("const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n",
this.m_gravity.x,this.m_gravity.y);d("this.m_world.SetGravity(g);\n");d("const bodies: b2Body[] = [];\n");d("const joints: b2Joint[] = [];\n");var n=0;for(var u=this.m_bodyList;u;u=u.m_next)u.m_islandIndex=n,u.Dump(d),++n;n=0;for(u=this.m_jointList;u;u=u.m_next)u.m_index=n,++n;for(n=this.m_jointList;n;n=n.m_next)n.m_type!==a.JointType.e_gearJoint&&(d("{\n"),n.Dump(d),d("}\n"));for(n=this.m_jointList;n;n=n.m_next)n.m_type===a.JointType.e_gearJoint&&(d("{\n"),n.Dump(d),d("}\n"))}}DrawShape(d,n){if(null!==
this.m_debugDraw){var u=d.GetShape();this.m_debugDraw.NextShape(d.GetUserData());switch(u.m_type){case a.ShapeType.e_circleShape:this.m_debugDraw.DrawSolidCircle(u.m_p,u.m_radius,z.UNITX,n);break;case a.ShapeType.e_edgeShape:d=u.m_vertex1;var C=u.m_vertex2;this.m_debugDraw.DrawSegment(d,C,n);!1===u.m_oneSided&&(this.m_debugDraw.DrawPoint(d,4,n),this.m_debugDraw.DrawPoint(C,4,n));break;case a.ShapeType.e_chainShape:d=u.m_count;u=u.m_vertices;C=u[0];for(let I=1;I<d;++I){const L=u[I];this.m_debugDraw.DrawSegment(C,
L,n);C=L}break;case a.ShapeType.e_polygonShape:this.m_debugDraw.DrawSolidPolygon(u.m_vertices,u.m_count,n)}}}Solve(d){for(var n=this.m_bodyList;n;n=n.m_next)n.m_xf0.Copy(n.m_xf);for(n=this.m_controllerList;n;n=n.m_next)n.Step(d);this.m_profile.solveInit=0;this.m_profile.solveVelocity=0;this.m_profile.solvePosition=0;n=this.m_island;n.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,this.m_contactManager.m_contactListener);for(var u=this.m_bodyList;u;u=u.m_next)u.m_islandFlag=
!1;for(u=this.m_contactManager.m_contactList;u;u=u.m_next)u.m_islandFlag=!1;for(u=this.m_jointList;u;u=u.m_next)u.m_islandFlag=!1;u=this.s_stack;for(let Z=this.m_bodyList;Z;Z=Z.m_next)if(!Z.m_islandFlag&&Z.IsAwake()&&Z.IsEnabled()&&Z.GetType()!==a.BodyType.b2_staticBody){n.Clear();var C=0;u[C++]=Z;for(Z.m_islandFlag=!0;0<C;){var I=u[--C];if(!I)throw Error();n.AddBody(I);if(I.GetType()!==a.BodyType.b2_staticBody){I.m_awakeFlag=!0;for(var L=I.m_contactList;L;L=L.next){var U=L.contact;if(U.m_islandFlag)continue;
if(!U.IsEnabled()||!U.IsTouching())continue;const ka=U.m_fixtureB.m_isSensor;U.m_fixtureA.m_isSensor||ka||(n.AddContact(U),U.m_islandFlag=!0,U=L.other,U.m_islandFlag||(u[C++]=U,U.m_islandFlag=!0))}for(I=I.m_jointList;I;I=I.next)I.joint.m_islandFlag||(L=I.other,L.IsEnabled()&&(n.AddJoint(I.joint),I.joint.m_islandFlag=!0,L.m_islandFlag||(u[C++]=L,L.m_islandFlag=!0)))}}C=new Xg;n.Solve(C,d,this.m_gravity,this.m_allowSleep);this.m_profile.solveInit+=C.solveInit;this.m_profile.solveVelocity+=C.solveVelocity;
this.m_profile.solvePosition+=C.solvePosition;for(C=0;C<n.m_bodyCount;++C)I=n.m_bodies[C],I.GetType()===a.BodyType.b2_staticBody&&(I.m_islandFlag=!1)}for(d=0;d<u.length&&u[d];++d)u[d]=null;d=new J;for(n=this.m_bodyList;n;n=n.m_next)n.m_islandFlag&&n.GetType()!==a.BodyType.b2_staticBody&&n.SynchronizeFixtures();this.m_contactManager.FindNewContacts();this.m_profile.broadphase=d.GetMilliseconds()}SolveTOI(d){const n=this.m_island;n.Initialize(64,32,0,this.m_contactManager.m_contactListener);if(this.m_stepComplete){for(var u=
this.m_bodyList;u;u=u.m_next)u.m_islandFlag=!1,u.m_sweep.alpha0=0;for(u=this.m_contactManager.m_contactList;u;u=u.m_next)u.m_toiFlag=!1,u.m_islandFlag=!1,u.m_toiCount=0,u.m_toi=1}for(;;){var C=null;u=1;for(var I=this.m_contactManager.m_contactList;I;I=I.m_next)if(I.IsEnabled()&&!(8<I.m_toiCount)){var L=void 0;if(I.m_toiFlag)L=I.m_toi;else{L=I.GetFixtureA();var U=I.GetFixtureB();if(L.IsSensor()||U.IsSensor())continue;var Z=L.GetBody(),ka=U.GetBody(),ia=Z.m_type,ta=ka.m_type,Ja=Z.IsAwake()&&ia!==a.BodyType.b2_staticBody,
Oa=ka.IsAwake()&&ta!==a.BodyType.b2_staticBody;if(!Ja&&!Oa)continue;ia=Z.IsBullet()||ia!==a.BodyType.b2_dynamicBody;ta=ka.IsBullet()||ta!==a.BodyType.b2_dynamicBody;if(!ia&&!ta)continue;ta=Z.m_sweep.alpha0;Z.m_sweep.alpha0<ka.m_sweep.alpha0?(ta=ka.m_sweep.alpha0,Z.m_sweep.Advance(ta)):ka.m_sweep.alpha0<Z.m_sweep.alpha0&&(ta=Z.m_sweep.alpha0,ka.m_sweep.Advance(ta));Ja=I.GetChildIndexA();Oa=I.GetChildIndexB();ia=wc.SolveTOI_s_toi_input;ia.proxyA.SetShape(L.GetShape(),Ja);ia.proxyB.SetShape(U.GetShape(),
Oa);ia.sweepA.Copy(Z.m_sweep);ia.sweepB.Copy(ka.m_sweep);ia.tMax=1;L=wc.SolveTOI_s_toi_output;qa(L,ia);U=L.t;L=L.state===a.TOIOutputState.e_touching?f(ta+(1-ta)*U,1):1;I.m_toi=L;I.m_toiFlag=!0}L<u&&(C=I,u=L)}if(null===C||.9999<u){this.m_stepComplete=!0;break}I=C.GetFixtureA();L=C.GetFixtureB();I=I.GetBody();L=L.GetBody();U=wc.SolveTOI_s_backup1.Copy(I.m_sweep);Z=wc.SolveTOI_s_backup2.Copy(L.m_sweep);I.Advance(u);L.Advance(u);C.Update(this.m_contactManager.m_contactListener);C.m_toiFlag=!1;++C.m_toiCount;
if(C.IsEnabled()&&C.IsTouching()){I.SetAwake(!0);L.SetAwake(!0);n.Clear();n.AddBody(I);n.AddBody(L);n.AddContact(C);I.m_islandFlag=!0;L.m_islandFlag=!0;C.m_islandFlag=!0;for(C=0;2>C;++C)if(U=0===C?I:L,U.m_type===a.BodyType.b2_dynamicBody)for(Z=U.m_contactList;Z&&n.m_bodyCount!==n.m_bodyCapacity&&n.m_contactCount!==n.m_contactCapacity;Z=Z.next)ka=Z.contact,!ka.m_islandFlag&&(ta=Z.other,ta.m_type!==a.BodyType.b2_dynamicBody||U.IsBullet()||ta.IsBullet())&&(ia=ka.m_fixtureB.m_isSensor,ka.m_fixtureA.m_isSensor||
ia||(ia=wc.SolveTOI_s_backup.Copy(ta.m_sweep),ta.m_islandFlag||ta.Advance(u),ka.Update(this.m_contactManager.m_contactListener),ka.IsEnabled()?ka.IsTouching()?(ka.m_islandFlag=!0,n.AddContact(ka),ta.m_islandFlag||(ta.m_islandFlag=!0,ta.m_type!==a.BodyType.b2_staticBody&&ta.SetAwake(!0),n.AddBody(ta))):(ta.m_sweep.Copy(ia),ta.SynchronizeTransform()):(ta.m_sweep.Copy(ia),ta.SynchronizeTransform())));C=wc.SolveTOI_s_subStep;C.dt=(1-u)*d.dt;C.inv_dt=1/C.dt;C.dtRatio=1;C.positionIterations=20;C.velocityIterations=
d.velocityIterations;C.particleIterations=d.particleIterations;C.warmStarting=!1;n.SolveTOI(C,I.m_islandIndex,L.m_islandIndex);for(u=0;u<n.m_bodyCount;++u)if(C=n.m_bodies[u],C.m_islandFlag=!1,C.m_type===a.BodyType.b2_dynamicBody)for(C.SynchronizeFixtures(),C=C.m_contactList;C;C=C.next)C.contact.m_toiFlag=!1,C.contact.m_islandFlag=!1;this.m_contactManager.FindNewContacts();if(this.m_subStepping){this.m_stepComplete=!1;break}}else C.SetEnabled(!1),I.m_sweep.Copy(U),L.m_sweep.Copy(Z),I.SynchronizeTransform(),
L.SynchronizeTransform()}}AddController(d){d.m_next=this.m_controllerList;d.m_prev=null;this.m_controllerList&&(this.m_controllerList.m_prev=d);this.m_controllerList=d;++this.m_controllerCount;return d}RemoveController(d){d.m_prev&&(d.m_prev.m_next=d.m_next);d.m_next&&(d.m_next.m_prev=d.m_prev);this.m_controllerList===d&&(this.m_controllerList=d.m_next);--this.m_controllerCount;d.m_prev=null;d.m_next=null;return d}}wc.Step_s_step=new He;wc.Step_s_stepTimer=new J;wc.Step_s_timer=new J;wc.DebugDraw_s_color=
new ya(0,0,0);wc.DebugDraw_s_vs=z.MakeArray(4);wc.DebugDraw_s_xf=new rb;wc.QueryFixtureShape_s_aabb=new Wa;wc.RayCast_s_input=new Ta;wc.RayCast_s_output=new Ka;wc.RayCast_s_point=new z;wc.SolveTOI_s_subStep=new He;wc.SolveTOI_s_backup=new ab;wc.SolveTOI_s_backup1=new ab;wc.SolveTOI_s_backup2=new ab;wc.SolveTOI_s_toi_input=new Tg;wc.SolveTOI_s_toi_output=new Ug;(function(d){d[d.b2_pbdStretchingModel=0]="b2_pbdStretchingModel";d[d.b2_xpbdStretchingModel=1]="b2_xpbdStretchingModel"})(a.StretchingModel||
(a.StretchingModel={}));(function(d){d[d.b2_springAngleBendingModel=0]="b2_springAngleBendingModel";d[d.b2_pbdAngleBendingModel=1]="b2_pbdAngleBendingModel";d[d.b2_xpbdAngleBendingModel=2]="b2_xpbdAngleBendingModel";d[d.b2_pbdDistanceBendingModel=3]="b2_pbdDistanceBendingModel";d[d.b2_pbdHeightBendingModel=4]="b2_pbdHeightBendingModel";d[d.b2_pbdTriangleBendingModel=5]="b2_pbdTriangleBendingModel"})(a.BendingModel||(a.BendingModel={}));class dh{constructor(){this.stretchingModel=a.StretchingModel.b2_pbdStretchingModel;
this.bendingModel=a.BendingModel.b2_pbdAngleBendingModel;this.damping=0;this.stretchStiffness=1;this.stretchDamping=this.stretchHertz=0;this.bendStiffness=.5;this.bendHertz=1;this.bendDamping=0;this.warmStart=this.fixedEffectiveMass=this.isometric=!1}Copy(d){this.stretchingModel=d.stretchingModel;this.bendingModel=d.bendingModel;this.damping=d.damping;this.stretchStiffness=d.stretchStiffness;this.stretchHertz=d.stretchHertz;this.stretchDamping=d.stretchDamping;this.bendStiffness=d.bendStiffness;this.bendHertz=
d.bendHertz;this.bendDamping=d.bendDamping;this.isometric=d.isometric;this.fixedEffectiveMass=d.fixedEffectiveMass;this.warmStart=d.warmStart;return this}}class Vl{constructor(){this.position=new z;this.vertices=[];this.count=0;this.masses=[];this.gravity=new z;this.tuning=new dh}}class Wl{constructor(){this.damper=this.spring=this.lambda=this.L=this.invMass2=this.invMass1=this.i2=this.i1=0}}class Xl{constructor(){this.damper=this.spring=this.alpha2=this.alpha1=this.L2=this.L1=this.lambda=this.invEffectiveMass=
this.invMass3=this.invMass2=this.invMass1=this.i3=this.i2=this.i1=0}}class Yl{constructor(){this.m_position=new z;this.m_bendCount=this.m_stretchCount=this.m_count=0;this.m_stretchConstraints=[];this.m_bendConstraints=[];this.m_bindPositions=[];this.m_ps=[];this.m_p0s=[];this.m_vs=[];this.m_invMasses=[];this.m_gravity=new z;this.m_tuning=new dh}Create(d){function n(Ja,Oa,Xa){for(let zb=0;zb<Oa;++zb)Ja[zb]=Xa(zb)}this.m_position.Copy(d.position);this.m_count=d.count;n(this.m_bindPositions,this.m_count,
()=>new z);n(this.m_ps,this.m_count,()=>new z);n(this.m_p0s,this.m_count,()=>new z);n(this.m_vs,this.m_count,()=>new z);n(this.m_invMasses,this.m_count,()=>0);for(var u=0;u<this.m_count;++u){this.m_bindPositions[u].Copy(d.vertices[u]);this.m_ps[u].Copy(d.vertices[u]).SelfAdd(this.m_position);this.m_p0s[u].Copy(d.vertices[u]).SelfAdd(this.m_position);this.m_vs[u].SetZero();var C=d.masses[u];this.m_invMasses[u]=0<C?1/C:0}this.m_stretchCount=this.m_count-1;this.m_bendCount=this.m_count-2;n(this.m_stretchConstraints,
this.m_stretchCount,()=>new Wl);n(this.m_bendConstraints,this.m_bendCount,()=>new Xl);for(u=0;u<this.m_stretchCount;++u){C=this.m_stretchConstraints[u];var I=this.m_ps[u],L=this.m_ps[u+1];C.i1=u;C.i2=u+1;C.L=z.DistanceVV(I,L);C.invMass1=this.m_invMasses[u];C.invMass2=this.m_invMasses[u+1];C.lambda=0;C.damper=0;C.spring=0}for(u=0;u<this.m_bendCount;++u){C=this.m_bendConstraints[u];var U=this.m_ps[u];L=this.m_ps[u+1];var Z=this.m_ps[u+2];C.i1=u;C.i2=u+1;C.i3=u+2;C.invMass1=this.m_invMasses[u];C.invMass2=
this.m_invMasses[u+1];C.invMass3=this.m_invMasses[u+2];C.invEffectiveMass=0;C.L1=z.DistanceVV(U,L);C.L2=z.DistanceVV(L,Z);C.lambda=0;I=z.SubVV(L,U,new z);L=z.SubVV(Z,L,new z);var ka=I.LengthSquared(),ia=L.LengthSquared();if(0!==ka*ia){ka=(new z).Copy(I).SelfSkew().SelfMul(-1/ka);var ta=(new z).Copy(L).SelfSkew().SelfMul(1/ia);ia=ka.Clone().SelfNeg();ka=ka.Clone().SelfSub(ta);ta=ta.Clone();C.invEffectiveMass=C.invMass1*z.DotVV(ia,ia)+C.invMass2*z.DotVV(ka,ka)+C.invMass3*z.DotVV(ta,ta);U=z.SubVV(Z,
U,new z);Z=U.LengthSquared();0!==Z&&(C.alpha1=z.DotVV(L,U)/Z,C.alpha2=z.DotVV(I,U)/Z)}}this.m_gravity.Copy(d.gravity);this.SetTuning(d.tuning)}SetTuning(d){this.m_tuning.Copy(d);d=6.28318530718*this.m_tuning.bendHertz;for(var n=0;n<this.m_bendCount;++n){var u=this.m_bendConstraints[n],C=u.L1*u.L1;const I=u.L2*u.L2;if(0===C*I){u.spring=0;u.damper=0;continue}const L=1/u.L1+1/u.L2;C=u.invMass1/C+u.invMass2*L*L+u.invMass3/I;0===C?(u.spring=0,u.damper=0):(C=1/C,u.spring=C*d*d,u.damper=2*C*this.m_tuning.bendDamping*
d)}d=6.28318530718*this.m_tuning.stretchHertz;for(n=0;n<this.m_stretchCount;++n)u=this.m_stretchConstraints[n],C=u.invMass1+u.invMass2,0!==C&&(C=1/C,u.spring=C*d*d,u.damper=2*C*this.m_tuning.stretchDamping*d)}Step(d,n,u){if(0!==d){var C=1/d,I=Math.exp(-d*this.m_tuning.damping);for(let L=0;L<this.m_count;++L)0<this.m_invMasses[L]?(this.m_vs[L].x*=I,this.m_vs[L].y*=I,this.m_vs[L].x+=d*this.m_gravity.x,this.m_vs[L].y+=d*this.m_gravity.y):(this.m_vs[L].x=C*(this.m_bindPositions[L].x+u.x-this.m_p0s[L].x),
this.m_vs[L].y=C*(this.m_bindPositions[L].y+u.y-this.m_p0s[L].y));this.m_tuning.bendingModel===a.BendingModel.b2_springAngleBendingModel&&this.ApplyBendForces(d);for(u=0;u<this.m_bendCount;++u)this.m_bendConstraints[u].lambda=0;for(u=0;u<this.m_stretchCount;++u)this.m_stretchConstraints[u].lambda=0;for(u=0;u<this.m_count;++u)this.m_ps[u].x+=d*this.m_vs[u].x,this.m_ps[u].y+=d*this.m_vs[u].y;for(u=0;u<n;++u)this.m_tuning.bendingModel===a.BendingModel.b2_pbdAngleBendingModel?this.SolveBend_PBD_Angle():
this.m_tuning.bendingModel===a.BendingModel.b2_xpbdAngleBendingModel?this.SolveBend_XPBD_Angle(d):this.m_tuning.bendingModel===a.BendingModel.b2_pbdDistanceBendingModel?this.SolveBend_PBD_Distance():this.m_tuning.bendingModel===a.BendingModel.b2_pbdHeightBendingModel?this.SolveBend_PBD_Height():this.m_tuning.bendingModel===a.BendingModel.b2_pbdTriangleBendingModel&&this.SolveBend_PBD_Triangle(),this.m_tuning.stretchingModel===a.StretchingModel.b2_pbdStretchingModel?this.SolveStretch_PBD():this.m_tuning.stretchingModel===
a.StretchingModel.b2_xpbdStretchingModel&&this.SolveStretch_XPBD(d);for(d=0;d<this.m_count;++d)this.m_vs[d].x=C*(this.m_ps[d].x-this.m_p0s[d].x),this.m_vs[d].y=C*(this.m_ps[d].y-this.m_p0s[d].y),this.m_p0s[d].Copy(this.m_ps[d])}}Reset(d){this.m_position.Copy(d);for(d=0;d<this.m_count;++d)this.m_ps[d].x=this.m_bindPositions[d].x+this.m_position.x,this.m_ps[d].y=this.m_bindPositions[d].y+this.m_position.y,this.m_p0s[d].x=this.m_bindPositions[d].x+this.m_position.x,this.m_p0s[d].y=this.m_bindPositions[d].y+
this.m_position.y,this.m_vs[d].SetZero();for(d=0;d<this.m_bendCount;++d)this.m_bendConstraints[d].lambda=0;for(d=0;d<this.m_stretchCount;++d)this.m_stretchConstraints[d].lambda=0}Draw(d){const n=new ya(.4,.5,.7),u=new ya(.1,.8,.1),C=new ya(.7,.2,.4);for(let I=0;I<this.m_count-1;++I)d.DrawSegment(this.m_ps[I],this.m_ps[I+1],n),d.DrawPoint(this.m_ps[I],5,0<this.m_invMasses[I]?C:u);d.DrawPoint(this.m_ps[this.m_count-1],5,0<this.m_invMasses[this.m_count-1]?C:u)}SolveStretch_PBD(){const d=this.m_tuning.stretchStiffness;
for(let u=0;u<this.m_stretchCount;++u){const C=this.m_stretchConstraints[u],I=this.m_ps[C.i1].Clone(),L=this.m_ps[C.i2].Clone(),U=L.Clone().SelfSub(I),Z=U.Normalize();var n=C.invMass1+C.invMass2;if(0===n)continue;const ka=C.invMass1/n;n=C.invMass2/n;I.x-=d*ka*(C.L-Z)*U.x;I.y-=d*ka*(C.L-Z)*U.y;L.x+=d*n*(C.L-Z)*U.x;L.y+=d*n*(C.L-Z)*U.y;this.m_ps[C.i1].Copy(I);this.m_ps[C.i2].Copy(L)}}SolveStretch_XPBD(d){for(let I=0;I<this.m_stretchCount;++I){const L=this.m_stretchConstraints[I],U=this.m_ps[L.i1].Clone(),
Z=this.m_ps[L.i2].Clone();var n=U.Clone().SelfSub(this.m_p0s[L.i1]);const ka=Z.Clone().SelfSub(this.m_p0s[L.i2]);var u=Z.Clone().SelfSub(U),C=u.Normalize();const ia=u.Clone().SelfNeg(),ta=L.invMass1+L.invMass2;if(0===ta)continue;const Ja=1/(L.spring*d*d),Oa=Ja*d*d*L.damper/d;C-=L.L;n=z.DotVV(ia,n)+z.DotVV(u,ka);n=-(C+Ja*L.lambda+Oa*n)/((1+Oa)*ta+Ja);U.x+=L.invMass1*n*ia.x;U.y+=L.invMass1*n*ia.y;Z.x+=L.invMass2*n*u.x;Z.y+=L.invMass2*n*u.y;this.m_ps[L.i1].Copy(U);this.m_ps[L.i2].Copy(Z);L.lambda+=n}}SolveBend_PBD_Angle(){const d=
this.m_tuning.bendStiffness;for(let U=0;U<this.m_bendCount;++U){const Z=this.m_bendConstraints[U],ka=this.m_ps[Z.i1],ia=this.m_ps[Z.i2],ta=this.m_ps[Z.i3];var n=ia.Clone().SelfSub(ka),u=ta.Clone().SelfSub(ia),C=z.CrossVV(n,u),I=z.DotVV(n,u);C=Eb(C,I);var L=void 0;this.m_tuning.isometric?(L=Z.L1*Z.L1,I=Z.L2*Z.L2):(L=n.LengthSquared(),I=u.LengthSquared());0!==L*I&&(n=(new z).Copy(n).SelfSkew().SelfMul(-1/L),I=(new z).Copy(u).SelfSkew().SelfMul(1/I),u=n.Clone().SelfNeg(),n=n.Clone().SelfSub(I),L=this.m_tuning.fixedEffectiveMass?
Z.invEffectiveMass:Z.invMass1*z.DotVV(u,u)+Z.invMass2*z.DotVV(n,n)+Z.invMass3*z.DotVV(I,I),0===L&&(L=Z.invEffectiveMass),C=-d*C/L,ka.x+=Z.invMass1*C*u.x,ka.y+=Z.invMass1*C*u.y,ia.x+=Z.invMass2*C*n.x,ia.y+=Z.invMass2*C*n.y,ta.x+=Z.invMass3*C*I.x,ta.y+=Z.invMass3*C*I.y,this.m_ps[Z.i1].Copy(ka),this.m_ps[Z.i2].Copy(ia),this.m_ps[Z.i3].Copy(ta))}}SolveBend_XPBD_Angle(d){for(let ka=0;ka<this.m_bendCount;++ka){const ia=this.m_bendConstraints[ka],ta=this.m_ps[ia.i1],Ja=this.m_ps[ia.i2],Oa=this.m_ps[ia.i3];
var n=ta.Clone().SelfSub(this.m_p0s[ia.i1]);const Xa=Ja.Clone().SelfSub(this.m_p0s[ia.i2]),zb=Oa.Clone().SelfSub(this.m_p0s[ia.i3]);var u=Ja.Clone().SelfSub(ta),C=Oa.Clone().SelfSub(Ja),I=void 0,L=void 0;this.m_tuning.isometric?(I=ia.L1*ia.L1,L=ia.L2*ia.L2):(I=u.LengthSquared(),L=C.LengthSquared());if(0===I*L)continue;var U=z.CrossVV(u,C),Z=z.DotVV(u,C);U=Eb(U,Z);u=(new z).Copy(u).SelfSkew().SelfMul(-1/I);I=(new z).Copy(C).SelfSkew().SelfMul(1/L);C=u.Clone().SelfNeg();L=u.Clone().SelfSub(I);u=I;I=
this.m_tuning.fixedEffectiveMass?ia.invEffectiveMass:ia.invMass1*z.DotVV(C,C)+ia.invMass2*z.DotVV(L,L)+ia.invMass3*z.DotVV(u,u);if(0===I)continue;Z=1/(ia.spring*d*d);const Hb=Z*d*d*ia.damper/d;n=z.DotVV(C,n)+z.DotVV(L,Xa)+z.DotVV(u,zb);n=-(U+Z*ia.lambda+Hb*n)/((1+Hb)*I+Z);ta.x+=ia.invMass1*n*C.x;ta.y+=ia.invMass1*n*C.y;Ja.x+=ia.invMass2*n*L.x;Ja.y+=ia.invMass2*n*L.y;Oa.x+=ia.invMass3*n*u.x;Oa.y+=ia.invMass3*n*u.y;this.m_ps[ia.i1].Copy(ta);this.m_ps[ia.i2].Copy(Ja);this.m_ps[ia.i3].Copy(Oa);ia.lambda+=
n}}SolveBend_PBD_Distance(){const d=this.m_tuning.bendStiffness;for(let u=0;u<this.m_bendCount;++u){const C=this.m_bendConstraints[u],I=C.i1,L=C.i3,U=this.m_ps[I].Clone(),Z=this.m_ps[L].Clone(),ka=Z.Clone().SelfSub(U),ia=ka.Normalize();var n=C.invMass1+C.invMass3;if(0===n)continue;const ta=C.invMass1/n;n=C.invMass3/n;U.x-=d*ta*(C.L1+C.L2-ia)*ka.x;U.y-=d*ta*(C.L1+C.L2-ia)*ka.y;Z.x+=d*n*(C.L1+C.L2-ia)*ka.x;Z.y+=d*n*(C.L1+C.L2-ia)*ka.y;this.m_ps[I].Copy(U);this.m_ps[L].Copy(Z)}}SolveBend_PBD_Height(){const d=
this.m_tuning.bendStiffness;for(let I=0;I<this.m_bendCount;++I){const L=this.m_bendConstraints[I],U=this.m_ps[L.i1].Clone(),Z=this.m_ps[L.i2].Clone(),ka=this.m_ps[L.i3].Clone();var n=new z;n.x=L.alpha1*U.x+L.alpha2*ka.x-Z.x;n.y=L.alpha1*U.y+L.alpha2*ka.y-Z.y;var u=n.Length();if(0===u)continue;var C=n.Clone().SelfMul(1/u);n=C.Clone().SelfMul(L.alpha1);const ia=C.Clone().SelfNeg();C=C.Clone().SelfMul(L.alpha2);const ta=L.invMass1*L.alpha1*L.alpha1+L.invMass2+L.invMass3*L.alpha2*L.alpha2;0!==ta&&(u*=
1/ta*-d,U.x+=L.invMass1*u*n.x,U.y+=L.invMass1*u*n.y,Z.x+=L.invMass2*u*ia.x,Z.y+=L.invMass2*u*ia.y,ka.x+=L.invMass3*u*C.x,ka.y+=L.invMass3*u*C.y,this.m_ps[L.i1].Copy(U),this.m_ps[L.i2].Copy(Z),this.m_ps[L.i3].Copy(ka))}}SolveBend_PBD_Triangle(){const d=this.m_tuning.bendStiffness;for(let C=0;C<this.m_bendCount;++C){const I=this.m_bendConstraints[C],L=this.m_ps[I.i1].Clone(),U=this.m_ps[I.i2].Clone(),Z=this.m_ps[I.i3].Clone();var n=I.invMass1,u=I.invMass2;const ka=I.invMass3,ia=d/(n+ka+2*u),ta=new z;
ta.x=U.x-1/3*(L.x+U.x+Z.x);ta.y=U.y-1/3*(L.y+U.y+Z.y);const Ja=new z;Ja.x=2*n*ia*ta.x;Ja.y=2*n*ia*ta.y;n=new z;n.x=-4*u*ia*ta.x;n.y=-4*u*ia*ta.y;u=new z;u.x=2*ka*ia*ta.x;u.y=2*ka*ia*ta.y;L.SelfAdd(Ja);U.SelfAdd(n);Z.SelfAdd(u);this.m_ps[I.i1].Copy(L);this.m_ps[I.i2].Copy(U);this.m_ps[I.i3].Copy(Z)}}ApplyBendForces(d){const n=6.28318530718*this.m_tuning.bendHertz;for(let ia=0;ia<this.m_bendCount;++ia){const ta=this.m_bendConstraints[ia];var u=this.m_ps[ta.i1].Clone(),C=this.m_ps[ta.i2].Clone(),I=this.m_ps[ta.i3].Clone(),
L=this.m_vs[ta.i1];const Ja=this.m_vs[ta.i2],Oa=this.m_vs[ta.i3];u=u.Clone().SelfSub(u);I=I.Clone().SelfSub(C);var U=void 0,Z=void 0;this.m_tuning.isometric?(U=ta.L1*ta.L1,Z=ta.L2*ta.L2):(U=u.LengthSquared(),Z=I.LengthSquared());if(0!==U*Z){C=z.CrossVV(u,I);var ka=z.DotVV(u,I);C=Eb(C,ka);U=(new z).Copy(u).SelfSkew().SelfMul(-1/U);Z=(new z).Copy(I).SelfSkew().SelfMul(1/Z);u=U.Clone().SelfNeg();I=U.Clone().SelfSub(Z);U=this.m_tuning.fixedEffectiveMass?ta.invEffectiveMass:ta.invMass1*z.DotVV(u,u)+ta.invMass2*
z.DotVV(I,I)+ta.invMass3*z.DotVV(Z,Z);0!==U&&(ka=1/U,U=ka*n*n,ka=2*ka*this.m_tuning.bendDamping*n,L=z.DotVV(u,L)+z.DotVV(I,Ja)+z.DotVV(Z,Oa),L=-d*(U*C+ka*L),this.m_vs[ta.i1].x+=ta.invMass1*L*u.x,this.m_vs[ta.i1].y+=ta.invMass1*L*u.y,this.m_vs[ta.i2].x+=ta.invMass2*L*I.x,this.m_vs[ta.i2].y+=ta.invMass2*L*I.y,this.m_vs[ta.i3].x+=ta.invMass3*L*Z.x,this.m_vs[ta.i3].y+=ta.invMass3*L*Z.y)}}}}class Ni{constructor(d,n){this.nextController=this.prevController=this.nextBody=this.prevBody=null;this.controller=
d;this.body=n}}class ff{constructor(){this.m_bodyList=null;this.m_bodyCount=0;this.m_next=this.m_prev=null}GetNext(){return this.m_next}GetPrev(){return this.m_prev}GetBodyList(){return this.m_bodyList}AddBody(d){const n=new Ni(this,d);n.nextBody=this.m_bodyList;n.prevBody=null;this.m_bodyList&&(this.m_bodyList.prevBody=n);this.m_bodyList=n;++this.m_bodyCount;n.nextController=d.m_controllerList;n.prevController=null;d.m_controllerList&&(d.m_controllerList.prevController=n);d.m_controllerList=n;++d.m_controllerCount}RemoveBody(d){if(0>=
this.m_bodyCount)throw Error();let n=this.m_bodyList;for(;n&&n.body!==d;)n=n.nextBody;if(null===n)throw Error();n.prevBody&&(n.prevBody.nextBody=n.nextBody);n.nextBody&&(n.nextBody.prevBody=n.prevBody);this.m_bodyList===n&&(this.m_bodyList=n.nextBody);--this.m_bodyCount;n.nextController&&(n.nextController.prevController=n.prevController);n.prevController&&(n.prevController.nextController=n.nextController);d.m_controllerList===n&&(d.m_controllerList=n.nextController);--d.m_controllerCount}Clear(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);
this.m_bodyCount=0}}class Zl extends ff{constructor(){super(...arguments);this.normal=new z(0,1);this.density=this.offset=0;this.velocity=new z(0,0);this.angularDrag=this.linearDrag=0;this.useDensity=!1;this.useWorldGravity=!0;this.gravity=new z(0,0)}Step(){if(this.m_bodyList){this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity());for(let u=this.m_bodyList;u;u=u.nextBody){const C=u.body;if(!C.IsAwake())continue;const I=new z;var d=new z;let L=0;var n=0;for(let U=C.GetFixtureList();U;U=
U.m_next){const Z=new z,ka=U.GetShape().ComputeSubmergedArea(this.normal,this.offset,C.GetTransform(),Z);L+=ka;I.x+=ka*Z.x;I.y+=ka*Z.y;let ia;ia=this.useDensity?U.GetDensity():1;n+=ka*ia;d.x+=ka*Z.x*ia;d.y+=ka*Z.y*ia}I.x/=L;I.y/=L;d.x/=n;d.y/=n;1E-5>L||(n=this.gravity.Clone().SelfNeg(),n.SelfMul(this.density*L),C.ApplyForce(n,d),d=C.GetLinearVelocityFromWorldPoint(I,new z),d.SelfSub(this.velocity),d.SelfMul(-this.linearDrag*L),C.ApplyForce(d,I),C.ApplyTorque(-C.GetInertia()/C.GetMass()*L*C.GetAngularVelocity()*
this.angularDrag))}}}Draw(d){const n=new z,u=new z;n.x=this.normal.x*this.offset+100*this.normal.y;n.y=this.normal.y*this.offset-100*this.normal.x;u.x=this.normal.x*this.offset-100*this.normal.y;u.y=this.normal.y*this.offset+100*this.normal.x;const C=new ya(0,0,.8);d.DrawSegment(n,u,C)}}class eh extends ff{constructor(){super(...arguments);this.A=new z(0,0)}Step(d){d=z.MulSV(d.dt,this.A,eh.Step_s_dtA);for(let n=this.m_bodyList;n;n=n.nextBody){const u=n.body;u.IsAwake()&&u.SetLinearVelocity(z.AddVV(u.GetLinearVelocity(),
d,z.s_t0))}}Draw(){}}eh.Step_s_dtA=new z;class $l extends ff{constructor(){super(...arguments);this.F=new z(0,0)}Step(){for(let d=this.m_bodyList;d;d=d.nextBody){const n=d.body;n.IsAwake()&&n.ApplyForce(this.F,n.GetWorldCenter())}}Draw(){}}class jg extends ff{constructor(){super(...arguments);this.G=1;this.invSqr=!0}Step(){if(this.invSqr)for(var d=this.m_bodyList;d;d=d.nextBody){var n=d.body,u=n.GetWorldCenter(),C=n.GetMass();for(var I=this.m_bodyList;I&&I!==d;I=I.nextBody){var L=I.body,U=L.GetWorldCenter(),
Z=L.GetMass(),ka=U.x-u.x,ia=U.y-u.y,ta=ka*ka+ia*ia;1E-5>ta||(ka=jg.Step_s_f.Set(ka,ia),ka.SelfMul(this.G/ta/ub(ta)*C*Z),n.IsAwake()&&n.ApplyForce(ka,u),L.IsAwake()&&L.ApplyForce(ka.SelfMul(-1),U))}}else for(d=this.m_bodyList;d;d=d.nextBody)for(n=d.body,u=n.GetWorldCenter(),C=n.GetMass(),I=this.m_bodyList;I&&I!==d;I=I.nextBody)L=I.body,U=L.GetWorldCenter(),Z=L.GetMass(),ka=U.x-u.x,ia=U.y-u.y,ta=ka*ka+ia*ia,1E-5>ta||(ka=jg.Step_s_f.Set(ka,ia),ka.SelfMul(this.G/ta*C*Z),n.IsAwake()&&n.ApplyForce(ka,u),
L.IsAwake()&&L.ApplyForce(ka.SelfMul(-1),U))}Draw(){}}jg.Step_s_f=new z;class fh extends ff{constructor(){super(...arguments);this.T=new Fb;this.maxTimestep=0}Step(d){d=d.dt;if(!(1E-5>=d)){d>this.maxTimestep&&0<this.maxTimestep&&(d=this.maxTimestep);for(let n=this.m_bodyList;n;n=n.nextBody){const u=n.body;if(!u.IsAwake())continue;const C=u.GetWorldVector(Fb.MulMV(this.T,u.GetLocalVector(u.GetLinearVelocity(),z.s_t0),z.s_t1),fh.Step_s_damping);u.SetLinearVelocity(z.AddVV(u.GetLinearVelocity(),z.MulSV(d,
C,z.s_t0),z.s_t1))}}}Draw(){}SetAxisAligned(d,n){this.T.ex.x=-d;this.T.ex.y=0;this.T.ey.x=0;this.T.ey.y=-n;this.maxTimestep=0<d||0<n?1/h(d,n):0}}fh.Step_s_damping=new z;const am=a.BodyType.b2_staticBody,bm=a.BodyType.b2_kinematicBody,cm=a.BodyType.b2_dynamicBody,dm=a.BendingModel.b2_springAngleBendingModel,em=a.BendingModel.b2_pbdAngleBendingModel,fm=a.BendingModel.b2_xpbdAngleBendingModel,gm=a.BendingModel.b2_pbdDistanceBendingModel,hm=a.BendingModel.b2_pbdHeightBendingModel,im=a.BendingModel.b2_pbdTriangleBendingModel,
jm=a.StretchingModel.b2_pbdStretchingModel,km=a.StretchingModel.b2_xpbdStretchingModel;a.AABB=Wa;a.Abs=eb;a.Acos=Ib;a.Alloc=function(){return null};a.AngularStiffness=function(d,n,u,C,I){C=C.GetInertia();I=I.GetInertia();I=0<C&&0<I?C*I/(C+I):0<C?C:I;n*=6.28318530718;d.stiffness=I*n*n;d.damping=2*I*u*n};a.AreaJoint=li;a.AreaJointDef=Hl;a.Asin=Pb;a.Assert=function(d,...n){if(!d)throw Error(...n);};a.Atan2=Eb;a.BlockAllocator=Na;a.Body=ud;a.BodyDef=Il;a.BroadPhase=Za;a.BuoyancyController=Zl;a.CalculateParticleIterations=
ua;a.ChainAndCircleContact=af;a.ChainAndPolygonContact=bf;a.ChainShape=jb;a.CircleContact=Xf;a.CircleShape=Db;a.Clamp=g;a.ClipSegmentToLine=D;a.ClipVertex=Ma;a.CollideCircles=N;a.CollideEdgeAndCircle=V;a.CollideEdgeAndPolygon=E;a.CollidePolygonAndCircle=T;a.CollidePolygons=aa;a.Color=ya;a.ConstantAccelController=eh;a.ConstantForceController=$l;a.Contact=Ed;a.ContactEdge=Wg;a.ContactFactory=pi;a.ContactFeature=wa;a.ContactFilter=bg;a.ContactID=Da;a.ContactImpulse=qi;a.ContactListener=cg;a.ContactManager=
si;a.ContactPositionConstraint=gg;a.ContactRegister=oi;a.ContactSolver=bc;a.ContactSolverDef=ui;a.ContactVelocityConstraint=fg;a.Controller=ff;a.ControllerEdge=Ni;a.Cos=qb;a.Counter=S;a.DegToRad=function(d){return d*Qa};a.DestructionListener=Jl;a.Distance=r;a.DistanceInput=na;a.DistanceJoint=rc;a.DistanceJointDef=ki;a.DistanceOutput=ja;a.DistanceProxy=fa;a.Draw=$a;a.DynamicTree=La;a.EdgeAndCircleContact=$f;a.EdgeAndPolygonContact=ag;a.EdgeShape=kb;a.Filter=Ge;a.Fixture=ni;a.FixtureDef=mi;a.FixtureParticleQueryCallback=
$g;a.FixtureProxy=me;a.Free=function(){};a.FrictionJoint=ne;a.FrictionJointDef=Kl;a.GearJoint=Qc;a.GearJointDef=Ll;a.GetPointStates=function(d,n,u,C){let I;for(I=0;I<u.pointCount;++I){const L=u.points[I].id.key;d[I]=a.PointState.b2_removeState;for(let U=0,Z=C.pointCount;U<Z;++U)if(C.points[U].id.key===L){d[I]=a.PointState.b2_persistState;break}}for(;2>I;++I)d[I]=a.PointState.b2_nullState;for(I=0;I<C.pointCount;++I){d=C.points[I].id.key;n[I]=a.PointState.b2_addState;for(let L=0,U=u.pointCount;L<U;++L)if(u.points[L].id.key===
d){n[I]=a.PointState.b2_persistState;break}}for(;2>I;++I)n[I]=a.PointState.b2_nullState};a.GravityController=jg;a.GrowableBuffer=Ie;a.GrowableStack=fb;a.InvSqrt=q;a.IsPowerOfTwo=function(d){return 0<d&&0===(d&d-1)};a.IsValid=mb;a.Island=kd;a.Jacobian=Gl;a.Joint=$c;a.JointDef=Dd;a.JointEdge=Vg;a.LinearStiffness=function(d,n,u,C,I){C=C.GetMass();I=I.GetMass();I=0<C&&0<I?C*I/(C+I):0<C?C:I;n*=6.28318530718;d.stiffness=I*n*n;d.damping=2*I*u*n};a.Log=function(){};a.MakeArray=l;a.MakeNullArray=function(d){const n=
Array(d);for(let u=0;u<d;++u)n[u]=null;return n};a.MakeNumberArray=e;a.Manifold=Pa;a.ManifoldPoint=Ea;a.MassData=cb;a.Mat22=Fb;a.Mat33=Wb;a.Max=h;a.Maybe=b;a.Min=f;a.MixFriction=function(d,n){return ub(d*n)};a.MixRestitution=P;a.MixRestitutionThreshold=ea;a.MotorJoint=oe;a.MotorJointDef=Ml;a.MouseJoint=pe;a.MouseJointDef=Nl;a.NextPowerOfTwo=function(d){d|=d>>1&2147483647;d|=d>>2&1073741823;d|=d>>4&268435455;d|=d>>8&16777215;return(d|d>>16&65535)+1};a.Pair=Ra;a.ParseInt=function(d){return parseInt(d,
10)};a.ParseUInt=function(d){return Math.abs(parseInt(d,10))};a.ParticleBodyContact=Bi;a.ParticleContact=Ai;a.ParticleDef=Zg;a.ParticleGroup=hg;a.ParticleGroupDef=wi;a.ParticleHandle=vi;a.ParticlePair=Ci;a.ParticlePairSet=Ki;a.ParticleSystem=nb;a.ParticleSystemDef=ah;a.ParticleSystem_CompositeShape=Hi;a.ParticleSystem_ConnectionFilter=ig;a.ParticleSystem_DestroyParticlesInShapeCallback=Ei;a.ParticleSystem_FixedSetAllocator=ch;a.ParticleSystem_FixtureParticle=Tl;a.ParticleSystem_FixtureParticleSet=
Li;a.ParticleSystem_InsideBoundsEnumerator=Ji;a.ParticleSystem_JoinParticleGroupsFilter=Fi;a.ParticleSystem_ParticleListNode=Gi;a.ParticleSystem_ParticlePair=Ul;a.ParticleSystem_Proxy=Je;a.ParticleSystem_ReactiveFilter=Ii;a.ParticleSystem_SolveCollisionCallback=xd;a.ParticleSystem_UpdateBodyContactsCallback=cf;a.ParticleSystem_UserOverridableBuffer=Fd;a.ParticleTriad=Di;a.PolygonAndCircleContact=Zf;a.PolygonContact=Yf;a.PolygonShape=ac;a.Position=dg;a.PositionSolverManifold=Nd;a.Pow=Bb;a.PrismaticJoint=
gc;a.PrismaticJointDef=Ol;a.Profile=Xg;a.PulleyJoint=Uc;a.PulleyJointDef=Pl;a.QueryCallback=Wd;a.RadToDeg=function(d){return 57.29577951307855*d};a.Random=function(){return 2*Math.random()-1};a.RandomRange=function(d,n){return(n-d)*Math.random()+d};a.RayCastCallback=ri;a.RayCastInput=Ta;a.RayCastOutput=Ka;a.RevoluteJoint=Bc;a.RevoluteJointDef=Ql;a.Rope=Yl;a.RopeDef=Vl;a.RopeTuning=dh;a.Rot=ib;a.SeparationFunction=ji;a.Shape=gb;a.ShapeCast=function(d,n){d.iterations=0;d.lambda=1;d.normal.SetZero();
d.point.SetZero();const u=n.proxyA,C=n.proxyB;var I=h(u.m_radius,.01),L=h(C.m_radius,.01),U=I+L;I=n.transformA;L=n.transformB;n=n.translationB;const Z=p.Set(0,0);let ka=0;A.m_count=0;const ia=A.m_vertices;let ta=u.GetSupport(ib.MulTRV(I.q,z.NegV(n,z.s_t1),z.s_t0)),Ja=rb.MulXV(I,u.GetVertex(ta),H),Oa=C.GetSupport(ib.MulTRV(L.q,n,z.s_t0)),Xa=rb.MulXV(L,C.GetVertex(Oa),O);const zb=z.SubVV(Ja,Xa,M);U=h(.01,U-.01);let Hb=0;for(;20>Hb&&.0025<zb.Length()-U;){d.iterations+=1;ta=u.GetSupport(ib.MulTRV(I.q,
z.NegV(zb,z.s_t1),z.s_t0));Ja=rb.MulXV(I,u.GetVertex(ta),H);Oa=C.GetSupport(ib.MulTRV(L.q,zb,z.s_t0));Xa=rb.MulXV(L,C.GetVertex(Oa),O);var Jb=z.SubVV(Ja,Xa,R);zb.Normalize();Jb=z.DotVV(zb,Jb);const Tb=z.DotVV(zb,n);if(Jb-U>ka*Tb){if(0>=Tb)return!1;ka=(Jb-U)/Tb;if(1<ka)return!1;Z.Copy(zb).SelfNeg();A.m_count=0}Jb=ia[A.m_count];Jb.indexA=Oa;Jb.wA.Copy(Xa).SelfMulAdd(ka,n);Jb.indexB=ta;Jb.wB.Copy(Ja);Jb.w.Copy(Jb.wB).SelfSub(Jb.wA);Jb.a=1;A.m_count+=1;switch(A.m_count){case 2:A.Solve2();break;case 3:A.Solve3()}if(3===
A.m_count)return!1;A.GetClosestPoint(zb);++Hb}if(0===Hb)return!1;A.GetWitnessPoints(W,ma);0<zb.LengthSquared()&&(Z.Copy(zb).SelfNeg(),Z.Normalize());d.normal.Copy(Z);d.lambda=ka;d.iterations=Hb;return!0};a.ShapeCastInput=Ba;a.ShapeCastOutput=Ua;a.Simplex=K;a.SimplexCache=oa;a.SimplexVertex=Ya;a.Sin=yb;a.SolverData=ti;a.Sq=m;a.Sqrt=ub;a.StackAllocator=ob;a.StackQueue=xi;a.Swap=function(d,n){const u=d[0];d[0]=n[0];n[0]=u};a.Sweep=ab;a.TOIInput=Tg;a.TOIOutput=Ug;a.TensorDampingController=fh;a.TestOverlapAABB=
B;a.TestOverlapShape=F;a.TimeOfImpact=qa;a.TimeStep=He;a.Timer=J;a.Transform=rb;a.TreeNode=Ab;a.Vec2=z;a.Vec2_zero=Xb;a.Vec3=Rb;a.Velocity=eg;a.VelocityConstraintPoint=Yg;a.Version=Sa;a.VoronoiDiagram=yi;a.VoronoiDiagram_Generator=zi;a.VoronoiDiagram_Task=wd;a.WeldJoint=Yc;a.WeldJointDef=Rl;a.WheelJoint=uc;a.WheelJointDef=Sl;a.World=wc;a.WorldManifold=Ha;a._180_over_pi=57.29577951307855;a._pi_over_180=Qa;a.aabbExtension=.1;a.aabbMultiplier=4;a.angularSleepTolerance=ca;a.angularSlop=xb;a.barrierCollisionTime=
2.5;a.baumgarte=.2;a.branch="master";a.commit="9ebbbcd960ad424e03e5de6e66a40764c16f51bc";a.dynamicBody=cm;a.epsilon=1E-5;a.epsilon_sq=lb;a.get_g_blockSolve=function(){return a.blockSolve};a.gjk_reset=function(){a.gjkCalls=0;a.gjkIters=0;a.gjkMaxIters=0};a.invalidParticleIndex=-1;a.kinematicBody=bm;a.lengthUnitsPerMeter=1;a.linearSleepTolerance=.01;a.linearSlop=.005;a.maxAngularCorrection=Cb;a.maxFloat=1E37;a.maxLinearCorrection=.2;a.maxManifoldPoints=2;a.maxParticleForce=.5;a.maxParticleIndex=2147483647;
a.maxParticlePressure=.25;a.maxPolygonVertices=8;a.maxRotation=1.570796326795;a.maxRotationSquared=2.4674011002726646;a.maxSubSteps=8;a.maxTOIContacts=32;a.maxTranslation=2;a.maxTranslationSquared=4;a.maxTriadDistance=2;a.maxTriadDistanceSquared=4;a.minParticleSystemBufferCapacity=256;a.minParticleWeight=1;a.minPulleyLength=2;a.particleStride=.75;a.pbdAngleBendingModel=em;a.pbdDistanceBendingModel=gm;a.pbdHeightBendingModel=hm;a.pbdStretchingModel=jm;a.pbdTriangleBendingModel=im;a.pi=3.14159265359;
a.polygonRadius=.01;a.set_g_blockSolve=function(d){a.blockSolve=d};a.springAngleBendingModel=dm;a.staticBody=am;a.timeToSleep=.5;a.toiBaumgarte=.75;a.toi_reset=function(){a.toiTime=0;a.toiMaxTime=0;a.toiCalls=0;a.toiIters=0;a.toiMaxIters=0;a.toiRootIters=0;a.toiMaxRootIters=0};a.two_pi=6.28318530718;a.version=Va;a.xpbdAngleBendingModel=fm;a.xpbdStretchingModel=km;Object.defineProperty(a,"__esModule",{value:!0})}
"object"===typeof exports&&"undefined"!==typeof module?Cc(exports):"function"===typeof define&&define.amd?define(["exports"],Cc):(zc="undefined"!==typeof globalThis?globalThis:zc||self,Cc(zc.b2={}));
(function(){function a(r){this.__document=r;this.__currentDefaultPath="";this.__currentPosition={};this.__currentElement={nodeName:"path"}}function b(r){var B=Math.sqrt(r[0]*r[0]+r[1]*r[1]);return[r[0]/B,r[1]/B]}function l(r,B){var D=Object.keys(B),F;for(F=0;F<D.length;F++)r=r.replace(new RegExp("\\{"+D[F]+"\\}","gi"),B[D[F]]);return r}function e(r){var B;if(!r)throw Error("cannot create a random attribute name for an undefined object");do{var D="";for(B=0;12>B;B++)D+="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz"[Math.floor(51*
Math.random())]}while(r[D]);return D}var f=function(r,B){var D,F={};r=r.split(",");B=B||10;for(D=0;D<r.length;D+=2){var G="&"+r[D+1]+";";var N=parseInt(r[D],B);F[G]="&#"+N+";"}F["\\xa0"]="&#160;";return F}("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",
32);var h={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},
font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}};var g=function(r,B){this.__root=r;this.__ctx=B};g.prototype.addColorStop=function(r,B){var D=this.__ctx.__createElement("stop");D.setAttribute("offset",r);-1!==B.indexOf("rgba")?(r=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi,
B=r.exec(B),D.setAttribute("stop-color",l("rgb({r},{g},{b})",{r:B[1],g:B[2],b:B[3]})),D.setAttribute("stop-opacity",B[4])):D.setAttribute("stop-color",B);this.__root.appendChild(D)};var m=function(r,B){this.__root=r;this.__ctx=B};var q=function(r){var B={width:500,height:500,enableMirroring:!1};if(1<arguments.length){var D=B;D.width=arguments[0];D.height=arguments[1]}else D=r?r:B;if(!(this instanceof q))return new q(D);this.width=D.width||B.width;this.height=D.height||B.height;this.enableMirroring=
void 0!==D.enableMirroring?D.enableMirroring:B.enableMirroring;this.canvas=this;this.__document=D.document||document;D.ctx?this.__ctx=D.ctx:(this.__canvas=this.__document.createElement("canvas"),this.__ctx=this.__canvas.getContext("2d"));this.__setDefaultStyles();this.__stack=[this.__getStyleState()];this.__groupStack=[];this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg");this.__root.setAttribute("version",1.1);this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg");
this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");this.__root.setAttribute("width",this.width);this.__root.setAttribute("height",this.height);this.__ids={};this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs");this.__root.appendChild(this.__defs);this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g");this.__root.appendChild(this.__currentElement)};q.prototype.__createElement=function(r,
B,D){"undefined"===typeof B&&(B={});r=this.__document.createElementNS("http://www.w3.org/2000/svg",r);var F=Object.keys(B);D&&(r.setAttribute("fill","none"),r.setAttribute("stroke","none"));for(D=0;D<F.length;D++){var G=F[D];r.setAttribute(G,B[G])}return r};q.prototype.__setDefaultStyles=function(){var r=Object.keys(h),B;for(B=0;B<r.length;B++){var D=r[B];this[D]=h[D].canvas}};q.prototype.__applyStyleState=function(r){var B=Object.keys(r),D;for(D=0;D<B.length;D++){var F=B[D];this[F]=r[F]}};q.prototype.__getStyleState=
function(){var r,B={},D=Object.keys(h);for(r=0;r<D.length;r++){var F=D[r];B[F]=this[F]}return B};q.prototype.__applyStyleToCurrentElement=function(r){var B=this.__currentElement,D=this.__currentElementsToStyle;D&&(B.setAttribute(r,""),B=D.element,D.children.forEach(function(V){V.setAttribute(r,"")}));D=Object.keys(h);var F;for(F=0;F<D.length;F++){var G=h[D[F]];var N=this[D[F]];if(G.apply)if(N instanceof m){if(N.__ctx)for(;N.__ctx.__defs.childNodes.length;){var T=N.__ctx.__defs.childNodes[0].getAttribute("id");
this.__ids[T]=T;this.__defs.appendChild(N.__ctx.__defs.childNodes[0])}B.setAttribute(G.apply,l("url(#{id})",{id:N.__root.getAttribute("id")}))}else if(N instanceof g)B.setAttribute(G.apply,l("url(#{id})",{id:N.__root.getAttribute("id")}));else if(-1!==G.apply.indexOf(r)&&G.svg!==N)if("stroke"!==G.svgAttr&&"fill"!==G.svgAttr||-1===N.indexOf("rgba")){T=G.svgAttr;if("globalAlpha"===D[F]&&(T=r+"-"+G.svgAttr,B.getAttribute(T)))continue;B.setAttribute(T,N)}else T=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi,
N=T.exec(N),B.setAttribute(G.svgAttr,l("rgb({r},{g},{b})",{r:N[1],g:N[2],b:N[3]})),N=N[4],T=this.globalAlpha,null!=T&&(N*=T),B.setAttribute(G.svgAttr+"-opacity",N)}};q.prototype.__closestGroupOrSvg=function(r){r=r||this.__currentElement;return"g"===r.nodeName||"svg"===r.nodeName?r:this.__closestGroupOrSvg(r.parentNode)};q.prototype.getSerializedSvg=function(r){var B=(new XMLSerializer).serializeToString(this.__root),D;/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi.test(B)&&
(B=B.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink'));if(r)for(r=Object.keys(f),D=0;D<r.length;D++){var F=r[D];var G=f[F];F=new RegExp(F,"gi");F.test(B)&&(B=B.replace(F,G))}return B};q.prototype.getSvg=function(){return this.__root};q.prototype.save=function(){var r=this.__createElement("g"),B=this.__closestGroupOrSvg();this.__groupStack.push(B);B.appendChild(r);this.__currentElement=r;this.__stack.push(this.__getStyleState())};q.prototype.restore=function(){this.__currentElement=
this.__groupStack.pop();this.__currentElementsToStyle=null;this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var r=this.__stack.pop();this.__applyStyleState(r)};q.prototype.__addTransform=function(r){var B=this.__closestGroupOrSvg();if(0<B.childNodes.length){"path"===this.__currentElement.nodeName&&(this.__currentElementsToStyle||(this.__currentElementsToStyle={element:B,children:[]}),this.__currentElementsToStyle.children.push(this.__currentElement),this.__applyCurrentDefaultPath());
var D=this.__createElement("g");B.appendChild(D);this.__currentElement=D}B=this.__currentElement.getAttribute("transform");this.__currentElement.setAttribute("transform",(B?B+" ":"")+r)};q.prototype.scale=function(r,B){void 0===B&&(B=r);this.__addTransform(l("scale({x},{y})",{x:r,y:B}))};q.prototype.rotate=function(r){this.__addTransform(l("rotate({angle},{cx},{cy})",{angle:180*r/Math.PI,cx:0,cy:0}))};q.prototype.translate=function(r,B){this.__addTransform(l("translate({x},{y})",{x:r,y:B}))};q.prototype.transform=
function(r,B,D,F,G,N){this.__addTransform(l("matrix({a},{b},{c},{d},{e},{f})",{a:r,b:B,c:D,d:F,e:G,f:N}))};q.prototype.beginPath=function(){this.__currentDefaultPath="";this.__currentPosition={};var r=this.__createElement("path",{},!0);this.__closestGroupOrSvg().appendChild(r);this.__currentElement=r};q.prototype.__applyCurrentDefaultPath=function(){var r=this.__currentElement;"path"===r.nodeName?r.setAttribute("d",this.__currentDefaultPath):console.error("Attempted to apply path command to node",
r.nodeName)};q.prototype.__addPathCommand=function(r){this.__currentDefaultPath+=" ";this.__currentDefaultPath+=r};q.prototype.moveTo=function(r,B){"path"!==this.__currentElement.nodeName&&this.beginPath();this.__currentPosition={x:r,y:B};this.__addPathCommand(l("M {x} {y}",{x:r,y:B}))};q.prototype.closePath=function(){this.__currentDefaultPath&&this.__addPathCommand("Z")};q.prototype.lineTo=function(r,B){this.__currentPosition={x:r,y:B};-1<this.__currentDefaultPath.indexOf("M")?this.__addPathCommand(l("L {x} {y}",
{x:r,y:B})):this.__addPathCommand(l("M {x} {y}",{x:r,y:B}))};q.prototype.bezierCurveTo=function(r,B,D,F,G,N){this.__currentPosition={x:G,y:N};this.__addPathCommand(l("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:r,cp1y:B,cp2x:D,cp2y:F,x:G,y:N}))};q.prototype.quadraticCurveTo=function(r,B,D,F){this.__currentPosition={x:D,y:F};this.__addPathCommand(l("Q {cpx} {cpy} {x} {y}",{cpx:r,cpy:B,x:D,y:F}))};q.prototype.arcTo=function(r,B,D,F,G){var N=this.__currentPosition&&this.__currentPosition.x,T=this.__currentPosition&&
this.__currentPosition.y;if("undefined"!=typeof N&&"undefined"!=typeof T){if(0>G)throw Error("IndexSizeError: The radius provided ("+G+") is negative.");N===r&&T===B||r===D&&B===F||0===G?this.lineTo(r,B):(N=b([N-r,T-B]),D=b([D-r,F-B]),N[0]*D[1]===N[1]*D[0]?this.lineTo(r,B):(T=Math.acos(Math.abs(N[0]*D[0]+N[1]*D[1])),F=b([N[0]+D[0],N[1]+D[1]]),T=G/Math.sin(T/2),r+=T*F[0],B+=T*F[1],N=[-N[1],N[0]],F=[D[1],-D[0]],T=function(V){var E=V[0];return 0<=V[1]?Math.acos(E):-Math.acos(E)},D=T(N),F=T(F),this.lineTo(r+
N[0]*G,B+N[1]*G),this.arc(r,B,G,D,F)))}};q.prototype.stroke=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","fill stroke markers");this.__applyCurrentDefaultPath();this.__applyStyleToCurrentElement("stroke")};q.prototype.fill=function(r=null){const B=this.__currentDefaultPath;null!==r&&(this.beginPath(),this.__currentDefaultPath=r.__currentDefaultPath);"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","stroke fill markers");
this.__applyCurrentDefaultPath();this.__applyStyleToCurrentElement("fill");this.__currentDefaultPath=B};q.prototype.rect=function(r,B,D,F){"path"!==this.__currentElement.nodeName&&this.beginPath();this.moveTo(r,B);this.lineTo(r+D,B);this.lineTo(r+D,B+F);this.lineTo(r,B+F);this.lineTo(r,B);this.closePath()};q.prototype.fillRect=function(r,B,D,F){r=this.__createElement("rect",{x:r,y:B,width:D,height:F},!0);this.__closestGroupOrSvg().appendChild(r);this.__currentElement=r;this.__applyStyleToCurrentElement("fill")};
q.prototype.strokeRect=function(r,B,D,F){r=this.__createElement("rect",{x:r,y:B,width:D,height:F},!0);this.__closestGroupOrSvg().appendChild(r);this.__currentElement=r;this.__applyStyleToCurrentElement("stroke")};q.prototype.__clearCanvas=function(){for(var r=this.__closestGroupOrSvg().getAttribute("transform"),B=this.__root.childNodes[1],D=B.childNodes,F=D.length-1;0<=F;F--)D[F]&&B.removeChild(D[F]);this.__currentElement=B;this.__groupStack=[];r&&this.__addTransform(r)};q.prototype.clearRect=function(r,
B,D,F){if(0===r&&0===B&&D===this.width&&F===this.height)this.__clearCanvas();else{var G=this.__closestGroupOrSvg();r=this.__createElement("rect",{x:r,y:B,width:D,height:F,fill:"#FFFFFF"},!0);G.appendChild(r)}};q.prototype.createLinearGradient=function(r,B,D,F){r=this.__createElement("linearGradient",{id:e(this.__ids),x1:r+"px",x2:D+"px",y1:B+"px",y2:F+"px",gradientUnits:"userSpaceOnUse"},!1);this.__defs.appendChild(r);return new g(r,this)};q.prototype.createRadialGradient=function(r,B,D,F,G,N){r=
this.__createElement("radialGradient",{id:e(this.__ids),cx:F+"px",cy:G+"px",r:N+"px",fx:r+"px",fy:B+"px",gradientUnits:"userSpaceOnUse"},!1);this.__defs.appendChild(r);return new g(r,this)};q.prototype.__parseFont=function(){var r=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:%|in|[cem]m|ex|p[ctx])))?\s*([-,'"\sa-z0-9]+?)\s*$/i.exec(this.font);
r={style:r[1]||"normal",size:r[4]||"10px",family:r[6]||"sans-serif",weight:r[3]||"normal",decoration:r[2]||"normal",href:null};"underline"===this.__fontUnderline&&(r.decoration="underline");this.__fontHref&&(r.href=this.__fontHref);return r};q.prototype.__wrapTextLink=function(r,B){if(r.href){var D=this.__createElement("a");D.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r.href);D.appendChild(B);return D}return B};q.prototype.__applyText=function(r,B,D,F){var G=this.__parseFont(),N=this.__closestGroupOrSvg(),
T={left:"start",right:"end",center:"middle",start:"start",end:"end"},V={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"};B=this.__createElement.call(this,"text",{"font-family":G.family,"font-size":G.size,"font-style":G.style,"font-weight":G.weight,"text-decoration":G.decoration,x:B,y:D,"text-anchor":T[this.textAlign]||T.start,"dominant-baseline":V[this.textBaseline]||V.alphabetic},!0);B.appendChild(this.__document.createTextNode(r));this.__currentElement=
B;this.__applyStyleToCurrentElement(F);N.appendChild(this.__wrapTextLink(G,B))};q.prototype.fillText=function(r,B,D){this.__applyText(r,B,D,"fill")};q.prototype.strokeText=function(r,B,D){this.__applyText(r,B,D,"stroke")};q.prototype.measureText=function(r){this.__ctx.font=this.font;return this.__ctx.measureText(r)};q.prototype.arc=function(r,B,D,F,G,N){if(F!==G){F%=2*Math.PI;G%=2*Math.PI;F===G&&(G=(G+2*Math.PI-.001*(N?-1:1))%(2*Math.PI));var T=r+D*Math.cos(G),V=B+D*Math.sin(G);r+=D*Math.cos(F);B+=
D*Math.sin(F);var E=N?0:1;F=G-F;0>F&&(F+=2*Math.PI);N=N?F>Math.PI?0:1:F>Math.PI?1:0;this.lineTo(r,B);this.__addPathCommand(l("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:D,ry:D,xAxisRotation:0,largeArcFlag:N,sweepFlag:E,endX:T,endY:V}));this.__currentPosition={x:T,y:V}}};q.prototype.clip=function(){var r=this.__closestGroupOrSvg(),B=this.__createElement("clipPath"),D=e(this.__ids),F=this.__createElement("g");this.__applyCurrentDefaultPath();r.removeChild(this.__currentElement);
B.setAttribute("id",D);B.appendChild(this.__currentElement);this.__defs.appendChild(B);r.setAttribute("clip-path",l("url(#{id})",{id:D}));r.appendChild(F);this.__currentElement=F};q.prototype.drawImage=function(){var r=Array.prototype.slice.call(arguments),B=r[0],D=0,F=0;if(3===r.length){var G=r[1];var N=r[2];var T=B.width;var V=B.height;var E=T;var Q=V}else if(5===r.length)G=r[1],N=r[2],E=r[3],Q=r[4],T=B.width,V=B.height;else if(9===r.length)D=r[1],F=r[2],T=r[3],V=r[4],G=r[5],N=r[6],E=r[7],Q=r[8];
else throw Error("Invalid number of arguments passed to drawImage: "+arguments.length);r=this.__closestGroupOrSvg();G="translate("+G+", "+N+")";if(B instanceof q){if(B=B.getSvg().cloneNode(!0),B.childNodes&&1<B.childNodes.length){for(E=B.childNodes[0];E.childNodes.length;)D=E.childNodes[0].getAttribute("id"),this.__ids[D]=D,this.__defs.appendChild(E.childNodes[0]);if(B=B.childNodes[1])E=B.getAttribute("transform"),B.setAttribute("transform",E?E+" "+G:G),r.appendChild(B)}}else if("CANVAS"===B.nodeName||
"IMG"===B.nodeName){N=this.__createElement("image");N.setAttribute("width",E);N.setAttribute("height",Q);N.setAttribute("preserveAspectRatio","none");if(D||F||T!==B.width||V!==B.height){var aa=this.__document.createElement("canvas");aa.width=E;aa.height=Q;var qa=aa.getContext("2d");qa.drawImage(B,D,F,T,V,0,0,E,Q);B=aa}N.setAttribute("transform",G);N.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===B.nodeName?B.toDataURL():B.getAttribute("src"));r.appendChild(N)}};q.prototype.createPattern=
function(r){var B=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),D=e(this.__ids);B.setAttribute("id",D);B.setAttribute("width",r.width);B.setAttribute("height",r.height);"CANVAS"===r.nodeName||"IMG"===r.nodeName?(D=this.__document.createElementNS("http://www.w3.org/2000/svg","image"),D.setAttribute("width",r.width),D.setAttribute("height",r.height),D.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===r.nodeName?r.toDataURL():r.getAttribute("src")),B.appendChild(D),
this.__defs.appendChild(B)):r instanceof q&&(B.appendChild(r.__root.childNodes[1]),this.__defs.appendChild(B));return new m(B,this)};q.prototype.setLineDash=function(r){this.lineDash=r&&0<r.length?r.join(","):null};q.prototype.drawFocusRing=function(){};q.prototype.createImageData=function(){};q.prototype.getImageData=function(){};q.prototype.putImageData=function(){};q.prototype.globalCompositeOperation=function(){};q.prototype.setTransform=function(){};a.prototype.__addPathCommand=q.prototype.__addPathCommand;
a.prototype.closePath=q.prototype.closePath;a.prototype.moveTo=q.prototype.moveTo;a.prototype.lineTo=q.prototype.lineTo;a.prototype.bezierCurveTo=q.prototype.bezierCurveTo;a.prototype.quadraticCurveTo=q.prototype.quadraticCurveTo;a.prototype.arc=q.prototype.arc;a.prototype.arcTo=q.prototype.arcTo;a.prototype.ellipse=q.prototype.ellipse;a.prototype.rect=q.prototype.rect;a.prototype.addPath=function(){throw Error("unimplemented");};q.prototype.makePath2D=function(){return new a(this.__document)};"object"===
typeof window&&(window.C2S=q);"object"===typeof module&&"object"===typeof module.exports&&(module.exports=q)})();
var Dc=function(){function a(F,G){let N=document.createElement("DIV");N.innerHTML=G;G=N.firstChild;F.appendChild(G);return G}function b(F,G){let N=document.createElement("DIV");N.innerHTML=G;G=N.firstChild;F.parentNode.insertBefore(G,F.nextSibling);return G}function l(F,G,N,T){F*=360;let V=(E,Q=(E+F/60)%6)=>N-N*G*Math.max(Math.min(Q,4-Q,1),0);T||={};T.r=Math.round(255*V(5));T.g=Math.round(255*V(3));T.b=Math.round(255*V(1));return T}function e(F,G,N,T){F/=255;G/=255;N/=255;let V=Math.max(F,G,N),E=
V-Math.min(F,G,N),Q=E&&(V==F?(G-N)/E:V==G?2+(N-F)/E:4+(F-G)/E);T||={};T.h=60*(0>Q?Q+6:Q)/360;T.s=V&&E/V;T.v=V;T.is_gray=F==G&&G==N;return T}function f(F,G,N,T){F/=360;G/=100;var V=N/100;if(0===G)F=G=N=V;else{const E=(aa,qa,P)=>{0>P&&(P+=1);1<P&&--P;return P<1/6?aa+6*(qa-aa)*P:.5>P?qa:P<2/3?aa+(qa-aa)*(2/3-P)*6:aa},Q=.5>V?V*(1+G):V+G-V*G;V=2*V-Q;N=E(V,Q,F+1/3);G=E(V,Q,F);F=E(V,Q,F-1/3)}T.r=Math.round(255*N);T.g=Math.round(255*G);T.b=Math.round(255*F);T.is_gray=!0}function h(F){return 0>F?0:1<F?1:F}
function g(F){var G=F.r/255;let N=F.g/255;F=F.b/255;G=.04045<G?Math.pow((G+.055)/1.055,2.4):G/12.92;N=.04045<N?Math.pow((N+.055)/1.055,2.4):N/12.92;F=.04045<F?Math.pow((F+.055)/1.055,2.4):F/12.92;G=.2126*G+.7152*N+.0722*F;G=.008856<G?Math.pow(G,1/3):7.787*G+16/116;return 50>116*G-16}function m(F,G){console.assert(!isNaN(F.r)&&!isNaN(F.g)&&!isNaN(F.b)&&!isNaN(F.alpha),"NaN color");return 1==F.alpha||G?"#"+(Number(F.r).toString(16).padStart(2,"0")+Number(F.g).toString(16).padStart(2,"0")+Number(F.b).toString(16).padStart(2,
"0")).toUpperCase():"rgba("+F.r+","+F.g+","+F.b+","+(null==F.alpha?null:F.alpha.toFixed(2))+")"}function q(F){let G=null;if(null===F)return null;F=F.trim();if("r"==F[0]){var N="rgba("==F.substr(0,5);if("rgb("==F.substr(0,4)||N)F=F.substr(4+(N?1:0)).split(","),G={r:parseInt(F[0]),g:parseInt(F[1]),b:parseInt(F[2]),alpha:1,alphai:255},N&&(F=parseFloat(F[3]),G.alpha=F,G.alphai=Math.round(255*F))}else if("h"==F[0]){if(G={},N="hsla("==F.substr(0,5),"hsl("==F.substr(0,4)||N)F=F.substr(4+(N?1:0)).split(","),
f(parseInt(F[0]),parseInt(F[1]),parseInt(F[2]),G),N?(F=parseFloat(F[3]),G.alpha=F,G.alphai=Math.round(255*F)):(G.alpha=1,G.alphai=255)}else"#"==F[0]&&(F=F.substr(1)),6==F.length?G={r:parseInt(F.substr(0,2),16),g:parseInt(F.substr(2,2),16),b:parseInt(F.substr(4,2),16),alpha:1,alphai:255}:3==F.length&&(G={r:parseInt(F[0]+F[0],16),g:parseInt(F[1]+F[1],16),b:parseInt(F[2]+F[2],16),alpha:1,alphai:255});return null!=G&&(isNaN(G.r)||isNaN(G.g)||isNaN(G.b)||isNaN(G.alpha))?null:G}function r(F,G,N,T,V,E,Q){function aa(Va){qa(Va)}
function qa(Va,fb){if(!(1==Va.buttons&&Va.target===Fa||Cb||ca))return!1;var Qa=Fa.getBoundingClientRect();let eb=Va.clientX-Qa.left;Va=Va.clientY-Qa.top;Qa=!1;ca||Sa||!(Cb||10<eb&&10<Va&&eb<ra+10&&Va<ra+10)?ca||eb>Ca&&10<Va&&eb<Ca+18&&Va<ra+10?(fb&&(ca=!0),Ia=h((Va-10)/ra),Qa=!0):Sa||E.with_alpha&&eb>Aa&&10<Va&&eb<Aa+18&&Va<ra+10?(fb&&(Sa=!0),$a=h((Va-10)/ra),Qa=!0):E.with_alpha&&E.dropper&&eb>Aa&&eb<Aa+18&&Va>Ga&&Va<Ga+18&&E.dropper(P):(fb&&(Cb=!0),Na=h((eb-10)/ra),ya=h((Va-10)/ra),Qa=!0);Qa&&(za.h=
Ia,za.s=Na,za.v=1-ya,za.alphai=Math.round(255*(1-$a)),za.alpha=za.alphai/255,l(za.h,za.s,za.v,za),za.is_dark=g(za),za.hex=m(za),za.hex_no_alpha=m(za,!0),V&&V(za),ea());return Qa}function P(Va,fb=!0,Qa=!0){Va!==za&&("string"==typeof Va&&(Va=q(Va)),void 0!==Va&&null!=Va&&(console.assert(void 0!==Va.r&&!isNaN(Va.r)&&void 0!==Va.g&&!isNaN(Va.g)&&void 0!==Va.b&&!isNaN(Va.b)),xb||Va.r!=za.r||Va.g!=za.g||Va.b!=za.b||Va.alpha!=za.alpha&&Va.alphai!=za.alphai))&&(e(Va.r,Va.g,Va.b,za),za.r=Va.r,za.g=Va.g,za.b=
Va.b,void 0!==Va.alpha?(console.assert(!isNaN(Va.alpha)),za.alpha=Va.alpha,za.alphai=null==Va.alpha?null:Math.round(255*Va.alpha)):(console.assert(void 0!==Va.alphai&&!isNaN(Va.alphai)),za.alpha=null==Va.alphai?null:Va.alphai/255,za.alphai=Va.alphai),za.is_dark=g(za),za.hex=m(za),za.hex_no_alpha=m(za,!0),Na=za.s,ya=1-za.v,za.is_gray?za.h=Ia:Ia=za.h,$a=1-za.alpha,T&&ea(),fb&&V&&V(za,Qa))}function ea(){var Va=E;pa.fillStyle="#bbb";var fb=N;Va.with_alpha&&(fb+=21);pa.fillRect(0,0,fb,N);var Qa=pa.getImageData(0,
0,fb,N);let eb=Qa.data;var mb=N-10-10-18-3;ra=mb;for(var ub=0;ub<mb;++ub)for(var Bb=0;Bb<mb;++Bb){var qb=l(za.h,ub/mb,(mb-Bb)/mb),yb=4*(ub+10+(Bb+10)*fb);eb[yb]=qb.r;eb[yb+1]=qb.g;eb[yb+2]=qb.b}Ca=10+mb+3;Ga=10+mb+3;for(ub=0;ub<mb;++ub)for(Bb=l(ub/mb,1,1),qb=0;18>qb;++qb)yb=4*(qb+Ca+(ub+10)*fb),eb[yb]=Bb.r,eb[yb+1]=Bb.g,eb[yb+2]=Bb.b;for(ub=0;18>ub;++ub)for(Bb=0;18>Bb;++Bb)qb=4*(ub+Ca+(Bb+Ga)*fb),eb[qb]=za.r,eb[qb+1]=za.g,eb[qb+2]=za.b;if(Va.with_alpha)for(Aa=10+mb+3+18+3,ub=0;ub<mb;++ub)for(Bb=1-
ub/(mb-1),qb=Math.trunc(ub/B.width)%2,yb=0;18>yb;++yb){let Ib=qb==Math.trunc(yb/B.width)%2?B.light:B.dark,Pb=4*(yb+Aa+(ub+10)*fb);eb[Pb]=za.r*Bb+Ib*(1-Bb);eb[Pb+1]=za.g*Bb+Ib*(1-Bb);eb[Pb+2]=za.b*Bb+Ib*(1-Bb)}pa.putImageData(Qa,0,0);pa.lineWidth=1;pa.strokeStyle=za.is_dark?"#ffffff":"#000000";pa.beginPath();pa.arc(Na*mb+10,ya*mb+10,5,0,2*Math.PI);pa.stroke();fb=l(za.h,1,1);pa.fillStyle=g(fb)?"#ffffff":"#000000";pa.beginPath();fb=Ia*mb+10;pa.moveTo(Ca+5,fb);pa.lineTo(Ca,fb-5);pa.lineTo(Ca,fb+5);pa.fill();
Va.with_alpha&&(fb=$a*mb+10,pa.beginPath(),pa.moveTo(Aa+5,fb),pa.lineTo(Aa,fb-5),pa.lineTo(Aa,fb+5),pa.fill());pa.lineWidth=1;pa.strokeStyle="#000";xa=Math.trunc(mb/18);for(mb=0;mb<xa;++mb)fb=18*mb+11,Qa=Ga,void 0!==lb[mb]&&(pa.fillStyle=lb[mb].hex,pa.fillRect(fb,Qa,18,17)),pa.strokeRect(fb+.5,Qa+.5,18,17);pa.strokeRect(Ca+.5,Ga+.5,17,17);Va.with_alpha&&(Va=Aa+9,mb=Ga+9,pa.beginPath(),pa.arc(Va+.5,mb+.5,6.3,0,2*Math.PI),pa.moveTo(Va+.5,mb-9),pa.lineTo(Va+.5,mb+9+1),pa.moveTo(Va-9,mb+.5),pa.lineTo(Va+
9+1,mb+.5),pa.stroke())}void 0===E&&(E={});var ua=N;E.with_alpha&&(ua+=21);!1!==E.global_presets&&(E.global_presets=!0);E.myAddEventListener||(E.myAddEventListener=function(Va,fb,Qa){Va.addEventListener(fb,Qa)});ua='<canvas width="WIDTH" height="HEIGHT" STYLE></canvas>'.replace(/WIDTH/g,ua).replace(/HEIGHT/g,N).replace(/STYLE/g,T?"":'style="display:none;"');let Fa=G(F,ua);Fa.style.borderRadius="7px";Fa.tabIndex=0;Fa.style.outline="none";Fa.style.zIndex=100;let pa=Fa.getContext("2d");var ra,Ca,Ga,
Aa,xa;let za={h:0,s:0,v:0,r:null,g:null,b:null,alpha:1,alphai:255,hex:"",copy:function(){return{r:this.r,g:this.g,b:this.b,hex:this.hex,alpha:this.alpha,alphai:this.alphai}}};var Na=0,ya=0,Ia=0,$a=0;let lb=E.global_presets?D:{},xb=!0;P(Q||"#cccccc",!0,!1);let Cb=xb=!1,ca=!1,Sa=!1;E.myAddEventListener(document,"mouseup",function(){Sa=ca=Cb=!1;document.removeEventListener("mousemove",aa);return!0});E.myAddEventListener(Fa,"mousedown",function(Va){qa(Va,!0)&&E.myAddEventListener(document,"mousemove",
aa)});E.myAddEventListener(Fa,"mouseup",function(Va){if(1==Va.which){var fb=Va.target.getBoundingClientRect(),Qa=Va.clientX-fb.left;Va=Va.clientY-fb.top;Qa>Ca&&Va>Ga&&Qa<Ca+18&&Va<Ga+18&&(void 0===lb.next_to_set&&(lb.next_to_set=0),lb[lb.next_to_set]={hex:za.hex,r:za.r,g:za.g,b:za.b,alpha:za.alpha},lb.next_to_set=(lb.next_to_set+1)%xa,ea());10<Qa&&Va>Ga&&Qa<ra&&Va<Ga+18&&P(lb[Math.trunc((Qa-10)/18)],!0)}});return{set_color:P,get_color:function(){return za},set_visible:function(Va){Fa.style.display=
Va?"initial":"none";Va&&!T&&ea();T=Va},elem:Fa}}const B={width:9,light:255,dark:150};var D={};return{create_as_child:function(F,G,N,T,V,E){return r(F,a,G,N,T,V,E)},create_after:function(F,G,N,T,V,E){return r(F,b,G,N,T,V,E)},parse_hex:function(F){F=q(F);if(null===F)return null;F.hex=m(F);return F},make_hex:m,get_checkers_image:function(){return null},CHECKERS:B,get_presets:()=>D,set_presets:F=>{D=F},HSVtoRGB:l,RGBtoHSV:e,HSLtoRGB:f}}(),Ec={create_at:function(a,b,l,e,f){let h=Dc.create_after(a,b,!1,
function(q,r=!0){document.activeElement!=a&&(a.value=q.hex);a.style.backgroundColor=q.hex_no_alpha;a.style.color=q.is_dark?"#fff":"#000";l&&r&&l(q)},e,f);h.elem.style.position="fixed";a.spellcheck=!1;let g;g=1===e.open_pos?()=>{let q=a.getBoundingClientRect();h.elem.style.top=q.bottom-b+"px";h.elem.style.left=q.right+window.scrollX+2+"px"}:()=>{let q=a.getBoundingClientRect();h.elem.style.top=q.bottom+window.scrollY+2+"px";h.elem.style.left=q.left+window.scrollX+"px"};let m=h.set_color;h.set_color=
function(q,r=!0){m(q,!0,r)};e.myAddEventListener(a,"input",function(){h.set_color(a.value,!0)});e.myAddEventListener(a,"focus",function(){g();h.set_visible(!0);e.focus_func&&e.focus_func(!0)});e.myAddEventListener(a,"blur",function(q){q.relatedTarget!==h.elem&&(h.set_visible(!1),e.focus_func&&e.focus_func(!1))});e.myAddEventListener(h.elem,"focus",function(){});e.myAddEventListener(h.elem,"blur",function(q){q.relatedTarget!==a&&(h.set_visible(!1),e.focus_func&&e.focus_func(!1))});return h}},Fc=[];
const Gc=[222,119,241];function Hc(a,b){a.moveTo(b[0],b[1]);for(let l=2;l<b.length;l+=2)a.lineTo(b[l],b[l+1])}const Ic={out:7,back:14};
function Jc(a,b,l,e,f,h,g,m,q){var r=f-b,B=e-a;a=f-16-5>b||70>Math.sqrt(B*B+r*r)||g||1==q?vb([a,b,a+.16*B,b+.3*r,e-.16*B,f-.3*r,e,f]):e>a?vb([a,b,a+120-l,b+8,e-h,f-8-5,e,f],.5):vb([a,b,a-l,b+8,e+120-h,f-8-5,e,f]);Kc();Lc.beginPath();Hc(Lc,a);f=2*Math.round(.3*a.length);b=a[f+2];l=a[f+3];e=b-a[f];f=l-a[f+1];h=Math.sqrt(e*e+f*f);e/=h;f/=h;h=-f;g=e;r=b+h*Ic.out-e*Ic.back;B=l+g*Ic.out-f*Ic.back;Lc.moveTo(b-h*Ic.out-e*Ic.back,l-g*Ic.out-f*Ic.back);Lc.lineTo(b,l);Lc.lineTo(r,B);Lc.strokeStyle=1===q?"#a9ef50":
2===q?"#ACFFEC":"#aaa";Lc.lineWidth=1.5;Lc.stroke();null!==m&&(Mc.beginPath(),Hc(Mc,a),Mc.lineWidth=11,Mc.strokeStyle=Rc(m),Mc.stroke());Sc()}function Tc(a){return 15>=a?"0"+a.toString(16):a.toString(16)}function Rc(a){"number"!=typeof a&&(console.assert("e"==a[0]),a=parseInt(a.substr(1))|524288);console.assert(1048575>a);return"#"+Tc(a&255)+Tc(a>>8&255)+"f"+(a>>16&15)}function Vc(a){if(15728640!==(a&15728640))return null;const b=a&1048575;return 0!==(a&524288)?"e"+(b&524287):b}
function ad(a,b,l,e,f,h,g,m,q){a.moveTo(b+h,l);a.lineTo(b+e-m,l);a.quadraticCurveTo(b+e,l,b+e,l+m);a.lineTo(b+e,l+f-q);a.quadraticCurveTo(b+e,l+f,b+e-q,l+f);a.lineTo(b+g,l+f);a.quadraticCurveTo(b,l+f,b,l+f-g);a.lineTo(b,l+h);a.quadraticCurveTo(b,l,b+h,l);a.closePath()}
class cd{constructor(a,b){console.assert(void 0!==b.is_input,"unexpected undefined");this.uid=null;b.is_input?(this.from_term=a,this.to_term=b):(this.from_term=b,this.to_term=a)}draw(){Jc(this.from_term.center_x(),this.from_term.center_y(),this.from_term.center_offset(),this.to_term.center_x(),this.to_term.center_y(),this.to_term.center_offset(),!1,this.uid,this.from_term.kind)}ctx_menu_opts(){return[{text:"Delete Line",func:()=>{dd.delete_line(this,!0)}}]}}
class ed{constructor(a,b,l,e=null){this.name=a;console.assert(void 0!==l,"don't instantiate TerminalBase");this.owner=b;this.line_pending=null;this.lines=[];this.is_input=l;this.tuid=null;this.kind=0;this.color="#aaa";this.tvisible=!0;this.xoffset=null;this.connection_event=e;l?(b.inputs.push(this),this.yoffset=-10):(b.outputs.push(this),this.yoffset=this.owner.height+8+2)}tpost_init(){this.connection_event&&this.connection_event(!1)}px(){return this.owner.x+this.xoffset}py(){return this.owner.y+
this.yoffset}center_x(){return this.owner.x+this.xoffset}center_y(){return this.owner.y+this.yoffset}center_offset(){return this.xoffset}is_out_term(){return!1}is_connected_to(a){for(let b of this.lines)if(b.from_term===a||b.to_term===a)return!0;return!1}gender_match(a){return(this.is_input&&!a.is_input||!this.is_input&&a.is_input)&&this.kind==a.kind}get_attachment(){return this}get_attachee(){return this}connect_events_dest(){return owner.cls}tdid_connect(a){this.connection_event&&this.connection_event(!0);
this.owner.cls.did_connect(this,a)}tdoing_disconnect(a){this.owner.cls.doing_disconnect(this,a)}tdid_disconnect(a){this.connection_event&&this.connection_event(!1);this.owner.cls.did_disconnect(this,a)}has_connection(){return 0<this.lines.length}draw(a=!1){this.tvisible&&(Kc(),Lc.beginPath(),this.draw_path(Lc,a),Lc.fillStyle=this.color,Lc.fill(),Lc.strokeStyle="#000",Lc.lineWidth=1,Lc.stroke(),Sc())}draw_nshadow(){Mc.beginPath();this.draw_path(Mc);Mc.fillStyle=Rc(this.tuid);Mc.fill()}mousemove(a){let b=
fd(a);this.line_pending=null;gd();b!==this&&(null!==b&&void 0===b.owner&&1==this.kind&&void 0!==b.cls&&(b=b.cls.vars_in),null===b||void 0===b.owner||b.owner===this.owner||!this.gender_match(b)||this.is_connected_to(b)?Jc(this.center_x(),this.center_y(),0,a.vx,a.vy,0,!0,null,this.kind):(this.line_pending=new cd(this.get_attachment(),b.get_attachment()),1==this.kind&&b.draw(!0),this.line_pending.draw()))}pre_add_line_hook(){}mouseup(){null!==this.line_pending&&(this.pre_add_line_hook(),dd.add_line(this.line_pending,
null,!0),this.line_pending=null);gd()}mousedown(){}hover(){ld.innerHTML=this.name;ld.style.display="initial";ld.style.left=nd.rect.left+(nd.pan_x+this.center_x())*nd.zoom+"px";let a=0;this.is_input&&(a=-30);ld.style.top=nd.rect.top+(nd.pan_y+this.center_y())*nd.zoom+a+"px"}collect_terminal(){for(let a of this.lines)od(a)}}function rd(a,b){a.transform(b[0],b[1],b[3],b[4],b[6],b[7])}function sd(a,b){a.setTransform(b[0],b[1],b[3],b[4],b[6],b[7])}
class yd{constructor(){this.refcount=0}get_disp_params(){return null}async pre_draw(){}transform(){throw Error("not implemented transform");}draw(a,b){zd.save();try{sd(zd,a),this.draw_m(a,b)}finally{zd.restore()}}draw_selection(a,b){zd.save();try{sd(zd,a),this.draw_selection_m(a,b)}finally{zd.restore()}}draw_template(a){zd.save();try{sd(zd,a),this.draw_template_m(a)}finally{zd.restore()}}draw_border(){}can_draw_shadow(){return!1}draw_shadow(a){Bd.save();try{sd(Bd,a),this.draw_shadow_m(a)}finally{Bd.restore()}}describe(a,
b){b.clear_desc();b=Cd("obj_inf_none");a.appendChild(b);b.innerText="No description available"}}class Hd{constructor(a,b){Id(a.constructor!==Hd,"bug nested CtrlBlock");this.caching_ref=b;this.po=a}}
class Jd{constructor(a,b){this.p=null===a?null:a.constructor===Hd?a:new Hd(a,b);null!==this.p&&(this.p.po.refcount+=1)}get_const(){return null===this.p?null:this.p.po}get_mutable(){if(null===this.p)return null;if(null===this.p.po||1==this.p.po.refcount)return this.p.po;if(1==this.p.caching_ref){var a=Kd(this.p.po);a.refcount=1;--this.p.po.refcount;this.p=new Hd(a,null)}else Id(!1===this.p.caching_ref,"caching_ref shouldn't be null here"),a=this.p.po,this.p.po=null,this.p=new Hd(a,null),a.refcount=
1;return this.p.po}clear(){null!==this.p&&(null!==this.p.po&&(--this.p.po.refcount,0==this.p.po.refcount&&this.p.po.destructor&&this.p.po.destructor()),this.p=null)}}
function Kd(a){if(null===a||"object"!==typeof a)return a;if(void 0!==a.BYTES_PER_ELEMENT||a.constructor==Path2D)return new a.constructor(a);if(a.constructor===WebGLBuffer||a.constructor===CanvasGradient||a.constructor==ImageBitmap)return null;if(a.constructor===HTMLImageElement||a.constructor===WebGLTexture||a.constructor===Ld)return a;if(void 0!==a._class)return null;if(void 0!==a.oclone)return a.oclone();let b=new a.constructor;for(let l in a)l.startsWith("p_")?b[l]=null:b[l]=Kd(a[l]);return b}
class Md{constructor(a){this.p=a}get_const(){return this.p.po}clear(){this.p=null}}class Pd extends ed{draw_path(a){a.arc(this.px(),this.py(),8,0,2*Math.PI)}hit_test(a,b){return a>=this.center_x()-8&&a<=this.center_x()+8&&b>=this.center_y()-8&&b<=this.center_y()+8}}function Qd(a){return a.constructor===Hd?new Md(a):a.constructor===Jd?new Md(a.p):a.constructor===Md?new Md(a.p):new Md(new Hd(a,null))}
class Rd extends Pd{constructor(a,b,l=null){super(b,a,!0,l);this.h=null;this.dirty=!0;this.last_uver_seen=null}intr_set(a,b){Sd(1>=this.lines.length,this.owner.cls,"too many lines connected to input "+this.name);const l=null===this.last_uver_seen||null===b||b!==this.last_uver_seen;this.last_uver_seen=b;this.h=Qd(a);this.tset_dirty(l)}get_const(){return null===this.h?null:this.h.get_const()}get_mutable(){if(null===this.h)return null;this.h.constructor===Md&&(this.h=new Jd(this.h.p,null));return this.h.get_mutable()}clear(){null!==
this.h&&this.h.clear()}force_set(a){this.clear();this.intr_set(a,null)}tset_dirty(a){this.dirty=a}is_dirty(){if(this.dirty)return!0;Sd(1>=this.lines.length,this.owner.cls,"too many lines connected to input "+this.name);if(0<this.lines.length){const a=this.lines[0].from_term.get_cur_uver(),b=this.last_uver_seen;if(null===a||null===b||a!==b)return!0}return!1}get_last_seen_uver(){return this.last_uver_seen}}
class Td extends Pd{constructor(a,b,l=null){super(b,a,!1,l);this.h=null;this.cur_ver=1;this.update_subscriber=null;this.caching=!0}is_out_term(){return!0}is_caching(){return this.caching}set_caching(a){this.caching=a}draw_path(a){if(this.caching)super.draw_path(a);else{var b=this.px(),l=this.py();a.beginPath();a.moveTo(b+8,l);for(let e=1;4>=e;++e)a.lineTo(b+8*Math.cos(2*e*Math.PI/4),l+8*Math.sin(2*e*Math.PI/4))}}set(a){this.h=a.constructor===Jd||a.constructor===Md?new Jd(a.p,this.caching):new Jd(a,
this.caching);++this.cur_ver;null!==this.update_subscriber&&this.update_subscriber.obj_updated(this.get_const())}get_const(){return null===this.h?null:this.h.get_const()}get_ctrl_block(){return null===this.h||null===this.h.p?null:this.h.p}get_mutable(){Id("shouldn't even be called")}clear(){null!==this.h&&this.h.clear()}get_cur_uver(){return this.tuid+"_"+this.cur_ver}subscribe_inf_update(a,b){console.assert(this.update_subscriber===a,"unexpected non-null subscriber");this.update_subscriber=b}}
class Ud{constructor(a){this.owner_term=a;this.lines=a.lines;this.is_input=a.is_input;this.last_uver_seen=this.h=null}get_attachee(){return this.owner_term}center_x(){return this.owner_term.center_x()}center_y(){return this.owner_term.center_y()}center_offset(){return this.owner_term.xoffset}intr_set(a,b){const l=null===this.last_uver_seen||b!==this.last_uver_seen;this.last_uver_seen=b;this.h=Qd(a);this.tset_dirty(l)}force_set(a){this.clear();this.intr_set(a,null)}get_const(){return null===this.h?
null:this.h.get_const()}get_mutable(){if(null===this.h)return null;this.h.constructor===Md&&(this.h=new Jd(this.h.p,null));return this.h.get_mutable()}clear(){null!==this.h&&this.h.clear()}tset_dirty(a){this.owner_term.tset_dirty(a)}is_dirty(){return this.owner_term.is_dirty()}}
class Xd extends ed{constructor(a,b,l=null){super(b,a,!0,l);this.dirty=!0;this.width=30}draw_path(a){var b=this.px()-this.width,l=this.py()-8;ad(a,b,l,2*this.width,16,8,8,8,8)}hit_test(a,b){return a>=this.center_x()-this.width&&a<=this.center_x()+this.width&&b>=this.center_y()-8&&b<=this.center_y()+8}get_attachment(){return new Ud(this)}clear(){for(let a of this.lines)a.to_term.clear()}tset_dirty(a){this.dirty=a}is_dirty(){if(this.dirty)return!0;for(let a of this.lines){const b=a.from_term.get_cur_uver(),
l=a.to_term.last_uver_seen;if(null===b||null===l||b!==l)return!0}return!1}get_input_consts(){let a=[];for(let b of this.lines)a.push(b.to_term.get_const());return a}}const Yd={font:"14px Verdana",margin_top:3,margin_left:5,height:15},ce={offset:105,color:"#00A1F7"},de={offset:90,color:"#de77f1"},ee={width:15,color:"#8AE600"},fe={offset:60,color:"#339933"},ge={offset:90,color:"#339933"};
class he{constructor(a){this.state_evaluators=a;this.known_objrefs={};for(let b in a)this.known_objrefs[b]=new ie(b);this.reset_check()}reset_check(){this.score=0;this.need_inputs={};this.need_variables={}}get_evaluator(a,b){const l=a.split(".");var e=l[0];let f=this.need_inputs[e];if(void 0===f){if(void 0===this.known_objrefs[e])return null;f=this.need_inputs[e]=this.known_objrefs[e]}e=this.state_evaluators[e];if(void 0!==e)return a=e(f,l.slice(1)),this.score|=1,void 0!==a.additional_score_flags&&
(this.score|=a.additional_score_flags()),a.line_num=b,a;throw new je("Don't know what to do with identifier "+a+" at "+b+" (bug?)");}}
class ke{constructor(a,b,l,e,f,h){this.of_program=h;this.rename_observers=[];this.subnodes=this.is_selected_inf=null;this.x=a;this.y=b;this.width=120;this.height=30;this.set_name(l);this.color="#ccc";this.id=f;this.can_display=!0;this.can_enable=this.can_input=!1;this.can_run_on_select=!0;this.enable_active=!1;this.snap_suggest=this.follow_target=null;this.can_follow=!1;this.following_node=this.followed_by_node=null;this.nkind=this.name_xmargin=0;this.parameters=[];this.param_aliases={};this.online_params=
[];this.terminal_aliases={};this.inputs=[];this.outputs=[];this.state_evaluators={};this.state_access=null;this.cls=new e(this);this.call_params_change();this.make_term_offset(this.inputs);this.make_term_offset(this.outputs);this.terminals=this.inputs.concat(this.outputs);for(let g of this.terminals)g.tpost_init();this._node_dirty=!0;this._last_visited_fv=0;this.self_dirty=!1;this.display_values={};this.receives_input=this.disp_template=!1;null===this.state_access&&this.set_state_evaluators([])}set_self_dirty(){this.self_dirty=
!0;le(!0)}set_enable_active_dirty(a){this.enable_active=a;this.set_self_dirty()}set_state_evaluators(a){this.state_evaluators=a;return this.state_access=new he(this.state_evaluators)}follow(a){a.followed_by_node=this;this.following_node=a}unfollow(){null!==this.following_node&&(this.following_node=this.following_node.followed_by_node=null)}is_following(){return null!==this.following_node}make_term_offset(a){if(0!=a.length){var b=0;for(var l of a)1!=l.kind&&l.tvisible&&++b;l=(this.width-40)/(b-1);
var e=0;for(let f=0;f<a.length;++f){let h=a[f];1!==h.kind&&h.tvisible&&(null===h.xoffset&&(h.xoffset=1==b?this.width/2:20+e*l),++e)}}}px(){return this.x}py(){return this.y}namex(){return this.px()+this.width+this.name_xmargin+Yd.margin_left}namey(){return this.py()+Yd.margin_top}draw(){let a=this.px(),b=this.py();null!==this.snap_suggest&&(Lc.beginPath(),ad(Lc,this.snap_suggest.x,this.snap_suggest.y,this.width,this.height,5,5,5,5),Lc.fillStyle="rgba(200,200,200,0.4)",Lc.fill());if(null!==this.cls.get_error()){Lc.beginPath();
Lc.arc(a,b+.5*this.height,40,0,2*Math.PI);Lc.fillStyle="#B10005";Lc.fill();Lc.strokeStyle="#900000";Lc.lineWidth=5;Lc.stroke();Lc.lineWidth=1;Lc.font="16px Verdana";Lc.fillStyle="#ffA0A0";Lc.textAlign="end";var l=Lc,e=this.cls.get_error().message,f=b+.5*this.height;let h=e.split(" "),g="";e=[];let m=0;for(let q=0;q<h.length;q++){let r=g+h[q]+" ";150<l.measureText(r).width&&0<q?(e.push({y:m,l:g}),g=h[q]+" ",m+=18):g=r}e.push({y:m,l:g});f-=9*e.length;for(let q of e)l.fillText(q.l,a,f+q.y);Lc.textAlign=
"start"}Lc.beginPath();Lc.strokeStyle="#000";ad(Lc,a,b,this.width,this.height,5,5,5,5);Lc.fillStyle=this.color;Lc.fill();Lc.stroke();null!==this.is_selected_inf&&(Lc.beginPath(),Lc.lineWidth=1.5,Lc.strokeStyle="#FFEE00",ad(Lc,a-2,b-2,this.width+4,this.height+4,7,7,7,7),Lc.stroke(),Lc.strokeStyle="#000",Lc.lineWidth=1);this.can_display&&(this.of_program.display_node===this&&(Lc.beginPath(),ad(Lc,a+ce.offset,b,this.width-ce.offset,this.height,0,0,5,5),Lc.fillStyle=ce.color,Lc.fill(),Lc.stroke()),this.disp_template&&
(Lc.fillStyle=de.color,Lc.fillRect(a+de.offset,b,ce.offset-de.offset,this.height),Lc.strokeRect(a+de.offset,b,ce.offset-de.offset,this.height)),Lc.beginPath(),Lc.moveTo(a+ce.offset,b),Lc.lineTo(a+ce.offset,b+this.height),Lc.moveTo(a+de.offset,b),Lc.lineTo(a+de.offset,b+this.height),Lc.stroke());this.can_input&&(this.receives_input&&(Lc.fillStyle=ee.color,Lc.beginPath(),ad(Lc,a,b,ee.width,this.height,5,5,0,0),Lc.fill(),Lc.stroke()),Lc.beginPath(),Lc.moveTo(a+ee.width,b),Lc.lineTo(a+ee.width,b+this.height),
Lc.stroke());this.can_enable&&(l=this.cls instanceof qe?fe:ge,this.enable_active&&(Lc.beginPath(),ad(Lc,a+l.offset,b,this.width-l.offset,this.height,0,0,5,5),Lc.fillStyle=l.color,Lc.fill(),Lc.stroke()),Lc.beginPath(),Lc.moveTo(a+l.offset,b),Lc.lineTo(a+l.offset,b+this.height),Lc.stroke());for(let h of this.terminals)h.draw();Lc.fillStyle="#fff";Lc.font=Yd.font;Lc.fillText(this.name,this.namex(),this.namey())}draw_nshadow(){for(let a of this.terminals)a.draw_nshadow();null!==this.follow_target&&this.follow_target.draw_nshadow()}set_selected_inf(a){this.is_selected_inf=
a;if(null!==this.subnodes)for(let b of this.subnodes)b.set_selected_inf(a)}select(){null===this.is_selected_inf&&(Fc.push(this),this.set_selected_inf({}),gd(),re(this),le(!1))}unselect(a=!0){null!==this.is_selected_inf&&(se(Fc,this),te(this),this.set_selected_inf(null),a&&(gd(),le(!1)))}set_name(a){this.name=a;Lc.font=Yd.font;this.name_measure=Lc.measureText(this.name);for(let b of this.rename_observers)b(this.name);this.recalc_bounding_box()}register_rename_observer(a){this.rename_observers.push(a)}remove_rename_observer(a){let b=
this.rename_observers.findIndex(l=>l===a);-1!==b&&this.rename_observers.splice(b,1)}recalc_bounding_box(){this.tx=this.x-8;this.ty=this.y-16-2;this.twidth=this.width+this.name_measure.width+this.name_xmargin+8+Yd.margin_left;this.theight=this.height+32+4}mousemove(a,b=!1){this.x+=a.dx/nd.zoom;this.y+=a.dy/nd.zoom;this.recalc_bounding_box();void 0!==this.cls.node_move_hook&&this.cls.node_move_hook(a,b);null!==this.followed_by_node&&this.followed_by_node.mousemove(a,!0);b||gd(!1)}mouseup(a){void 0!==
this.cls.node_mouse_up_hook&&this.cls.node_mouse_up_hook(a);ue()}mousedown(a){a.ctrlKey||ve(!1,!1);null===this.is_selected_inf?this.select():this.unselect()}has_cached_output(){return null!==this.outputs[0].get_const()}has_anything_dirty(a){if(this.cls.is_dirty_override){const b=this.cls.is_dirty_override(a);if(null!==b)return b}if(a||this.self_dirty||this.cls.is_internal_dirty())return!0;for(let b of this.parameters)if(b.pis_dirty())return!0;for(let b of this.inputs)if(b.is_dirty())return!0;return!1}clear_dirty(){this.self_dirty=
this._node_dirty=!1;for(let a of this.parameters)a.pclear_dirty();for(let a of this.inputs)a.tset_dirty(!1);this.cls.cclear_dirty()}call_params_change(){for(let a of this.parameters)a.call_change&&a.call_change()}reeval_all_exprs(){for(let a of this.parameters)a.pis_active()&&a.reeval_all_exprs()}check_params_errors(){for(let a of this.parameters)if(a.pis_active()&&null!==a.get_last_error())return we(this.cls,"Parameter expression error"),!1;return!0}remove_param(a){se(this.parameters,a)}param_alias(a,
b){this.param_aliases[a]=b}terminal_alias(a,b){this.terminal_aliases[a]=b}rename_param(a,b){let l=null;for(let e in parameters)if(this.parameters[e]===a){l=e;break}null!==l&&(delete this.parameters[l],this.parameters[b]=a)}}function se(a,b){const l=a.findIndex(function(e){return Object.is(b,e)});console.assert(-1!==l,"did not find object in array");a.splice(l,1)}function xe(a,b){const l=a.findIndex(function(e){return e===b});console.assert(-1!==l);a.splice(l,1)}
class ye{constructor(a){this.error=null;this.node=a;a.cls=this;this.vars_in=new ze(a,"vars_in")}image_find_obj(){return null}draw_selection(){}img_hit_find_obj(){return null}image_click(){}clear_selection(){}selected_obj_name(){return null}dirty_viewport(){}get_error(){return this.error}clear_error(){this.error=null}nset_error(a){this.error=a}did_connect(){}doing_disconnect(){}did_disconnect(){}cclear_dirty(){}is_internal_dirty(){return!1}is_picking_lines(){return!1}pick_lines(){Sd(!1,this,"not selecting lines")}should_clear_out_before_run(){return!0}toggle_enable_flag(){Id(!1,
"unexpected enable")}nresolve_variables(a){try{for(let b of this.node.parameters)b.resolve_variables(this.vars_in.my_vsb,a,!a)}catch(b){Sd(!1,this,"Parameter variables error")}}run(){Sd(!1,this,"run() not implemented")}}function ve(a=!0,b=!0){if(0!==Fc.length){var l=[...Fc];for(let e of l)e.unselect(!1);a&&gd();b&&le(!1)}}let Ae={11:5,12:6,13:6,14:6,16:6,18:7,20:7,24:8,30:9,36:11,48:13,60:16,72:18};
class Be{static name(){return"Text"}constructor(a=null,b=null,l=""){this.x=a;this.y=b;this.set_text(l);this.uid=null;this.color="#ffffff";this.font_size=16;this.edit_elem=this.lineWidth=this.height=this.width=null}save(){return{x:this.x,y:this.y,text:this.text,font_size:this.font_size,color:this.color}}load(a){this.x=a.x;this.y=a.y;this.set_text(a.text);this.font_size=a.font_size;this.color=a.color;this.measure()}set_text(a){this.text=a;this.lines=this.text.split("\n")}px(){return this.x}py(){return this.y}draw(){const a=
this.px(),b=this.py();Lc.font=this.font_size+"px Verdana";Lc.fillStyle=this.color;Lc.textAlign="start";Lc.textBaseline="top";null===this.width&&this.measure();for(let l=0;l<this.lines.length;++l)Lc.fillText(this.lines[l],a,b+l*this.lineHeight)}measure(){const a=Ce(De,"measure_hidden");a.style.font=this.font_size+"px Verdana";a.innerText=this.text;this.height=a.clientHeight;this.width=a.clientWidth;a.innerText=this.lines[0];this.lineHeight=a.clientHeight;a.parentElement.removeChild(a);this.resize_edit()}resize_edit(){null!==
this.edit_elem&&(this.edit_elem.style.width=Math.max(this.width+10,200)+"px",this.edit_elem.style.height=this.height+this.lineHeight+5+"px",this.elem_input.setAttribute("rows",this.lines.length))}draw_nshadow(){const a=this.px(),b=this.py();Mc.beginPath();Mc.fillStyle=Rc(this.uid);Mc.fillRect(a,b,this.width,this.height)}ctx_menu_opts(){return[{text:"Delete Text",func:()=>{dd.delete_decor(this,!0)}}]}mousedown(a){a.e.stopPropagation();const b=Ee(this.px(),this.py(),this.text,m=>{this.set_text(m);this.measure()},
{multiline:!0,yoffset:Ae[this.font_size]});b.input.style.fontSize=this.font_size+"px";this.edit_elem=b.elem;this.elem_input=b.input;this.resize_edit();a=Ce(b.elem,"nodes_text_buttons_cont");var l=Ce(a,["nodes_text_button","nodes_text_move_grip"]);Fe(l,(m,q)=>{this.x+=m/nd.zoom;this.y+=q/nd.zoom;gd();b.move_to(this.px(),this.py())},(m,q,r)=>{r.stopPropagation()});var e=Ce(a,["nodes_text_color_pick","nodes_text_button"]);e.setAttribute("tabindex",1);const f=Ec.create_at(e,200,m=>{this.color=m.hex;gd()},
{...Ke(),open_pos:1,focus_func:m=>{b.input.style.display=m?"none":""}},this.color);l=m=>{m.stopPropagation()};Le(e,"mousedown",l);Le(f.elem,"mousedown",l);const h=[11,12,13,14,16,18,20,24,30,36,48,60,72],g=m=>{let q=0;for(;h[q]<this.font_size;)++q;q=Math.min(h.length-1,Math.max(0,q+m));this.font_size=h[q];b.input.style.fontSize=this.font_size+"px";console.log("font-size=",this.font_size);this.measure();gd()};e=Ce(a,["nodes_text_font_up","nodes_text_button"]);a=Ce(a,["nodes_text_font_down","nodes_text_button"]);
Le(e,"mousedown",l);Le(a,"mousedown",l);Le(e,"click",()=>{g(1)});Le(a,"click",()=>{g(-1)})}mouseup(){}mousemove(){}}class Me{constructor(a,b,l=!0){this.node=a;this.func=b;this.notifyNode=l}mousedown(a){this.func(this.node);gd();this.notifyNode&&this.node.mousedown(a)}mouseup(){this.notifyNode&&this.node.mouseup()}mousemove(a){this.notifyNode&&this.node.mousemove(a)}}
function Ne(a){if(0>a.cvs_x||0>a.cvs_y||a.cvs_x>Oe.width||a.cvs_y>Oe.height)return null;a=Mc.getImageData(a.cvs_x,a.cvs_y,1,1).data;a=(new Uint32Array(a.buffer))[0];a=Vc(a);return 0!=a&&null!==a?(a=dd.obj_map[a],void 0===a?null:a):null}
function fd(a){const b=a.vx,l=a.vy;for(let e=dd.nodes.length-1;0<=e;--e){const f=dd.nodes[e];if(b<f.tx||b>f.tx+f.twidth||l<f.ty||l>f.ty+f.theight)continue;for(let g of f.terminals)if(g.hit_test(b,l))return g;if(l>=f.y&&l<=f.y+f.height&&b<=f.x+f.width){if(f.can_display){if(b>=f.x+ce.offset)return new Me(f,g=>{dd.set_display_node(g)});if(b>=f.x+de.offset)return new Me(f,g=>{dd.set_template_node(g)})}if(f.can_input&&b<=f.x+ee.width)return new Me(f,g=>{dd.set_input_node(g)},!1);if(f.can_enable&&b>=f.x+
(f.cls instanceof qe?fe:ge).offset)return new Me(f,g=>{g.cls.toggle_enable_flag(!0,null)});if(b>=f.x)return f}const h=f.x+f.width+f.name_xmargin;if(b>h&&b<h+f.name_measure.width+Yd.margin_left&&l>=f.y&&l<=f.y+Yd.height)return new Pe(f,Qe)}return Ne(a)}var Re=null;function Se(){null!==Re&&Re.dset_visible(!1);Re=Te("Clear","Are you sure you want\nto clear everything?",[{text:"Cancel"},{text:"Clear",func:()=>{Ue();gd();Re=null}}])}
class Ve{constructor(){this.rect={visible:!0};this.dlg=We(De,"",!0,this.rect,a=>{a||this.unsubscribe_current()});this.dlg.elem.classList.add("obj_inf_dlg");this.name_elem=Ce(this.dlg.client,"obj_inf_class");this.desc_elem=Ce(this.dlg.client,"obj_inf_desc");this.subscribed_on_out_term=null;this.do_make_title=()=>{this.make_title()};this.eobj=null}recreate_if_needed(a){const b=null===this.eobj||this.eobj.name!==a.constructor.name();b&&(this.clear_desc(),this.eobj={name:a.constructor.name()});return b}clear_desc(){Xe.desc_elem.innerText=
"";this.max_line_width=0;this.added_labels=[];this.eobj=null}add_line(a,b=!1){const l=Ce(Xe.desc_elem,"obj_inf_line"),e=Ye(l,"span","obj_inf_label");e.innerText=a;this.max_line_width=Math.max(this.max_line_width,e.offsetWidth);this.added_labels.push(e);return{value_elem:Ce(l,b?"obj_inf_value_multi":"obj_inf_value"),line:l}}adjust_labels(){const a=this.max_line_width+10+"px";for(let b of this.added_labels)b.style.width=a}obj_updated(a){null===a?(this.name_elem.innerText="null",this.clear_desc()):(Xe.name_elem.innerText=
a.constructor.name(),a.describe(this.desc_elem,this))}make_title(){this.dlg.set_title("Output Info: "+this.subscribed_on_out_term.owner.name+" : "+this.subscribed_on_out_term.name)}unsubscribe_current(){null!==this.subscribed_on_out_term&&(this.subscribed_on_out_term.subscribe_inf_update(this,null),this.subscribed_on_out_term.owner.remove_rename_observer(this.do_make_title),this.subscribed_on_out_term=null)}subscribe_on(a){this.unsubscribe_current();a.subscribe_inf_update(null,this);a.owner.register_rename_observer(this.do_make_title);
this.subscribed_on_out_term=a;a=a.get_const();this.obj_updated(a);this.make_title()}node_deleted(a){null!==this.subscribed_on_out_term&&this.subscribed_on_out_term.owner===a&&(this.dlg.dset_visible(!1),this.unsubscribe_current())}}var Xe=null;
function gf(a){var b=fd(a);let l=null,e=null,f=null;if(null!=b)if(b.constructor===ke)e=b;else if(b.constructor===Me)e=b.node;else if(b.constructor===Pe)b=null;else if(b instanceof ed)e=b.owner,b.is_out_term()&&(f=b);else if(void 0!==b.ctx_menu_opts)l=b.ctx_menu_opts();else return null;if(null!==e)l=[{text:"Delete Node",func:function(){dd.delete_node(e,!0)}}],null!==f&&(l.push({text:"Output Info",func:function(){var h=f;null===Xe&&(Xe=new Ve);Xe.dlg.dset_visible(!0);Xe.subscribe_on(h)}}),void 0!==
f.set_caching&&l.push({cmake_elems:h=>{h=Ce(h,"prm_ctx_bexpr_line");hf(h,"Caching Terminal",f.is_caching(),g=>{f.set_caching(g);nd.dismiss_ctx_menu();gd()})}}));else if(null===l){l=[{text:"Clear",func:Se},{text:"-"}];b=function(h,g){var m=h.push,q=g.name();var r=g.prototype instanceof qe?"ctx_menu_opt_var":g.prototype instanceof jf?"ctx_menu_opt_anim":void 0;m.call(h,{text:q,func:function(){dd.add_node(a.vx,a.vy,null,g);gd()},cls:r})};for(let h of kf)if(void 0===h.group_name)b(l,h);else{const g=[];
for(let m of h.nodes)b(g,m);l.push({text:h.group_name,sub_opts:g})}l.push({text:"-"},{text:"Text Note",func:()=>{dd.nodes_add_decor(new Be(a.vx,a.vy,"text"));gd()}});l.push({text:"Reset view",func:function(){nd.reset_view()}})}nd.last_ctx_menu=lf(l,a.ex,a.ey,De,()=>{nd.dismiss_ctx_menu()});return nd.last_ctx_menu}let mf=null;function nf(a){if(0===a.buttons){var b=Ne(a);null!==b&&void 0!==b.hover?b!==mf&&b.hover(a.ex,a.ey):(ld.style.display="none",b=null);mf=b}}let of=0;
function Kc(){++of;if(1==of){Lc.save();var a=nd.zoom;Lc.transform(a,0,0,a,nd.pan_x*a,nd.pan_y*a);Mc.save();Mc.transform(a,0,0,a,nd.pan_x*a,nd.pan_y*a)}}function Sc(){--of;0==of&&(Lc.restore(),Mc.restore())}
function gd(a=!0){a&&ue();Lc.lineWidth=1;Lc.fillStyle="#312F31";Lc.fillRect(0,0,pf.width,pf.height);Lc.textBaseline="top";Mc.fillStyle="#000";Mc.fillRect(0,0,Oe.width,Oe.height);Kc();a=-nd.pan_x;var b=-nd.pan_y;const l=pf.width/nd.zoom-nd.pan_x,e=pf.height/nd.zoom-nd.pan_y;Lc.beginPath();for(let f=50*Math.round(a/50);f<l;f+=50)Lc.moveTo(f,b),Lc.lineTo(f,e);for(b=50*Math.round(b/50);b<e;b+=50)Lc.moveTo(a,b),Lc.lineTo(l,b);Lc.strokeStyle="#444";Lc.stroke();for(let f of dd.nodes_decor)f.draw();for(let f of dd.nodes)f.draw();
for(let f of dd.lines)f.draw();for(let f of dd.nodes_decor)f.draw_nshadow();for(let f of dd.nodes)f.draw_nshadow();Sc()}function qf(){nd.rect=pf.getBoundingClientRect();rf.rect=sf.getBoundingClientRect()}var uf={split_1_h:.6,split_2_v:.35,save:function(){return{split_1_h:this.split_1_h,split_2_v:this.split_2_v}},load:function(a){this.split_1_h=parseFloat(a.split_1_h)||.6;this.split_2_v=parseFloat(a.split_2_v)||.35}};
function vf(a,b,l,e){function f(){l(null,h);e(null,a.offsetHeight-h-5);qf()}let h=Math.trunc(a.offsetHeight*uf.split_2_v)-5;f();Le(window,"resize",f);Fe(b,(g,m,q,r)=>{10<r&&r<a.offsetHeight-10&&(h+=m,l(null,h),e(null,a.offsetHeight-h-5),uf.split_2_v=(h+5)/a.offsetHeight,qf())})}
function wf(a,b,l,e){function f(){l(h,a.offsetHeight,0,0);e(a.offsetWidth-h-5,null,0,h+5);qf()}let h=Math.trunc(a.offsetWidth*uf.split_1_h)-5;f();Le(window,"resize",f);Fe(b,(g,m,q)=>{10<q&&q<a.offsetWidth-10&&(h+=g,l(h,null,0,0),e(a.offsetWidth-h-5,null,0,h+5),uf.split_1_h=(h+5)/a.offsetWidth,qf())})}
class xf{constructor(){this.pan_y=this.pan_x=null;this.zoom=1;this.rect=null;this.viewport_zoom=1;this.last_ctx_menu=null}view_x(a){return(a-this.rect.left)/this.zoom-this.pan_x}view_y(a){return(a-this.rect.top)/this.zoom-this.pan_y}save(){return{pan_x:this.pan_x,pan_y:this.pan_y,zoom:this.zoom}}load(a){this.pan_x=void 0===a.pan_x||null===a.pan_x?0:parseInt(a.pan_x);this.pan_y=void 0===a.pan_y||null===a.pan_y?0:parseInt(a.pan_y);this.zoom=void 0===a.zoom||null===a.zoom?1:parseFloat(a.zoom)}dismiss_ctx_menu(){null!=
this.last_ctx_menu&&De.removeChild(this.last_ctx_menu);this.last_ctx_menu=null}nodes_inputevent(){return!1}check_rect_select(){return!1}reset_view(){this.pan_y=this.pan_x=0;this.zoom=1;this.pan_redraw()}}class yf extends xf{constructor(a){super();this.pan_x=Math.round(a.width/2);this.pan_y=Math.round(a.height/2);this.find_obj=fd;this.unselect_all=ve;this.context_menu=gf;this.pan_redraw=gd;this.hover=nf}dismiss_popups(){zf();Af();Bf()}}let nd=null;
class Cf extends xf{constructor(){super();this.pan_y=this.pan_x=0;this.dismiss_popups=function(){};this.viewport_zoom=this.t_inv_viewport=this.t_viewport=null;this.margin_y=this.margin_x=0}pan_redraw(){Df();le(!1)}resize_redraw(){this.pan_redraw()}click(a,b){for(let l of Fc)l.cls.image_click(a,b)}find_obj(a){for(let b of Fc){const l=b.cls.image_find_obj(a);if(null!==l)return l}return Ef(a)}check_rect_select(){for(let a of Fc)if(void 0!==a.cls.rect_select)return!0;return!1}rect_select(a,b,l,e){for(let f of Fc)void 0!==
f.cls.rect_select&&f.cls.rect_select(a,b,l,e)}epnt_to_model(a,b){let l=Ff.create();Ff.transformMat3(l,Ff.fromValues(a,b),this.t_inv_viewport);return l}unselect_all(){for(let a of Fc)void 0!==a.cls.clear_selection&&a.cls.clear_selection()}context_menu(a){let b=[],l=[];for(let e of Fc)if(void 0!==e.cls.selected_obj_name){const f=e.cls.selected_obj_name();f&&l.push(f)}0<l.length&&b.push({text:"Delete "+l.join(", "),func:function(){for(let e of Fc)e.cls.delete_selection()}});b.push({text:"Reset view",
func:function(){rf.reset_view()}});return this.last_ctx_menu=lf(b,a.ex,a.ey,De,()=>{this.dismiss_ctx_menu()})}nodes_inputevent(a,b){let l=!1;for(let e of dd.input_nodes)console.assert(void 0!==e.cls.inputevent,"Node does not declare inputevent func"),e.cls.inputevent(a,b)&&(l=!0);return l}}
function Ef(a){if(0>a.cvs_x||0>a.cvs_y||a.cvs_x>sf.width||a.cvs_y>sf.height)return null;var b=null===dd.display_node?null:dd.display_node.outputs[0].get_const();if(null===b||!b.can_draw_shadow())return null;Gf.width!==sf.width&&(Gf.width=sf.width);Gf.height!=sf.height&&(Gf.height=sf.height);b.draw_shadow(rf.t_viewport);a=Bd.getImageData(a.cvs_x,a.cvs_y,1,1).data;a=(new Uint32Array(a.buffer))[0];a=Vc(a);if(null===a)return null;a=dd.obj_map[a];return void 0===a||a.constructor!==ke?null:a.cls.img_hit_find_obj()}
let rf=null;
function Hf(a,b){let l=!1,e,f,h,g,m=null,q=!1,r=null,B=!1;Le(b,"mousedown",function(D){if(D.target===sf&&a.nodes_inputevent("mousedown",{e:D,ex:D.pageX,ey:D.pageY,buttons:D.buttons}))B=!0;else if(1==D.buttons)if(D.ctrlKey&&a.check_rect_select())r={x1:D.pageX,y1:D.pageY};else{e=D.pageX;f=D.pageY;h=D.pageX;g=D.pageY;var F=a.view_x(D.pageX),G=a.view_y(D.pageY);D={vx:F,vy:G,ex:D.pageX,ey:D.pageY,cvs_x:D.pageX-a.rect.left,cvs_y:D.pageY-a.rect.top,e:D,ctrlKey:D.ctrlKey};m=a.find_obj(D);if(null!=m&&void 0!==
m.mousedown&&(m.mousedown(D),If(m)))return;q=!1;l=!0}});Le(b,"mouseup",function(D){l&&5>Math.abs(D.pageX-h)+Math.abs(D.pageY-g)&&a.click&&a.click(D.pageX,D.pageY)});Le(document,"mouseup",function(D){l=!1;null!==m&&void 0!==m.mouseup?m.mouseup():q||a.unselect_all(!0);m=null;r&&(a.rect_select(void 0),r=null);B&&(B=!1,a.nodes_inputevent("mouseup",D))});Le(document,"mousemove",function(D){var F=D.pageX-e,G=D.pageY-f;e=D.pageX;f=D.pageY;if(0!=F||0!=G)if(null!==r){var N=D.pageX;D=D.pageY;a.rect_select(Math.min(r.x1,
N),Math.min(r.y1,D),Math.max(r.x1,N),Math.max(r.y1,D))}else{q=!0;N=F/a.viewport_zoom;var T=G/a.viewport_zoom;F/=a.zoom;G/=a.zoom;l?(a.pan_x+=F,a.pan_y+=G,a.pan_redraw()):null!==m&&If(m)&&(F=D.pageX-a.rect.left,G=D.pageY-a.rect.top,F={vx:a.view_x(D.pageX),vy:a.view_y(D.pageY),ex:D.pageX,ey:D.pageY,cvs_x:F,cvs_y:G,shiftKey:D.shiftKey,ctrlKey:D.ctrlKey,dx:N,dy:T},m.mousemove(F));void 0!==a.hover&&(F=D.pageX-a.rect.left,G=D.pageY-a.rect.top,0<=F&&0<=G&&F<a.rect.width&&G<a.rect.height&&a.hover({vx:0,vy:0,
ex:D.pageX,ey:D.pageY,cvs_x:F,cvs_y:G,buttons:D.buttons}));if(!(F=B)){F=D.pageX;G=D.pageY;var V=a.rect;F=F>V.left&&F<V.right&&G>V.top&&G<V.bottom&&D.target===sf}F&&a.nodes_inputevent("mousemove",{ex:D.pageX,ey:D.pageY,dx:N,dy:T,img_canvas_capture:B,buttons:D.buttons})}});Le(b,"contextmenu",function(D){a.dismiss_ctx_menu();var F=D.pageX-a.rect.left;const G=D.pageY-a.rect.top;F={vx:a.view_x(D.pageX),vy:a.view_y(D.pageY),ex:D.pageX,ey:D.pageY,cvs_x:F,cvs_y:G};null!==a.context_menu(F)&&D.preventDefault();
return!1});Le(document,"mousedown",function(){a.dismiss_ctx_menu();a.dismiss_popups()});Le(document,"mousewheel",function(){a.dismiss_ctx_menu();a.dismiss_popups()})}function If(a){return void 0!==a.mousemovable?a.mousemovable():void 0!==a.mousemove}
function Jf(a,b){Le(b,"wheel",function(l){var e=a.pan_x*a.zoom,f=a.pan_y*a.zoom;l.preventDefault();let h=0;l.deltaY?h=l.deltaY:l.wheelDelta&&(h=-l.wheelDelta);let g=b.getBoundingClientRect(),m=l.pageX-g.left-window.pageXOffset;l=l.pageY-g.top-window.pageYOffset;e=(m-e)/a.zoom;f=(l-f)/a.zoom;a.zoom=0>h?1.1*a.zoom:a.zoom/1.1;e=m-a.zoom*e;f=l-a.zoom*f;a.pan_x=e/a.zoom;a.pan_y=f/a.zoom;a.pan_redraw()})}
function lf(a,b,l,e,f,h=null){let g=Ce(e,"ctx_menu");var m=null,q=null;for(let N of a){let T=null;N.cmake_elems?T=N.cmake_elems(g):"-"==N.text?T=Ye(g,"HR","ctx_menu_sep"):"file-in"===N.type?([a]=Kf(g,"ctx_menu_opt",N.text,N.func),T=a):(T=Ce(g,"ctx_menu_opt"),T.innerText=N.text,void 0!==N.cls&&T.classList.add(N.cls));void 0!==T&&null!==T&&(void 0!==N.sub_opts?(T.classList.toggle("ctx_menu_sub"),Le(T,"mousemove",function(){if(m!==N){null!==q&&q.parentElement.removeChild(q);m=N;var V=T.getBoundingClientRect();
q=lf(N.sub_opts,Math.trunc(V.right)-b-4,Math.trunc(V.top)-l-3,g,f,g)}})):Le(T,"mousemove",function(){null!==q&&q.parentElement.removeChild(q);m=q=null}),Lf("mousedown",T),void 0!==N.func&&Le(T,"click",function(){"file-in"!==N.type&&N.func();f()}))}Lf("mousedown",g);a=De.offsetWidth;let r=De.offsetHeight,B=g.offsetWidth,D=g.offsetHeight;e=e.getBoundingClientRect();let F=Math.trunc(e.left)+b,G=Math.trunc(e.top)+l;F+B>a&&(F=null===h?a-B:h.getBoundingClientRect().left-B+3);G+D>r&&(G=r-D);b=F-e.left;l=
G-e.top;g.style.left=b+"px";g.style.top=l+"px";return g}var Mf=null;function zf(){null!=Mf&&(De.removeChild(Mf),Mf=null)}
function Ee(a,b,l,e,f){zf();const h=f&&f.multiline,g=Ce(De,"node_name_edit");let m,q=0;h?(m=Ye(g,"textarea",["node_name_input","node_text_area"]),q=void 0!==f.yoffset?f.yoffset:6):(m=Ye(g,"input","node_name_input"),m.setAttribute("type","text"),q=5);1!==nd.zoom&&(m.style.transform="translate(-50%,-50%) scale("+nd.zoom+") translate(50%,50%)");q*=nd.zoom;m.setAttribute("spellcheck",!1);f=(r,B)=>{g.style.left=(r+nd.pan_x)*nd.zoom+nd.rect.left+"px";g.style.top=(B+nd.pan_y)*nd.zoom+nd.rect.top-q+"px"};
f(a,b);m.value=l;Lf("mousedown",m);Le(m,"input",()=>{e(m.value);gd()});h||Le(m,"keypress",function(r){13==r.keyCode&&zf()});Mf=g;return{elem:g,input:m,move_to:f}}class Pe{constructor(a){this.node=a;this.elem=null}mousedown(a){a.e.stopPropagation();Ee(this.node.namex(),this.node.namey(),this.node.name,b=>{this.node.set_name(b)})}mouseup(){}mousemove(){}}function Nf(){Le(document,"keypress",function(a){" "==a.key&&le(!0,a.ctrlKey||a.shiftKey)})}
function We(a,b,l,e,f,h=null){const g=Ce(a,"dlg");e||={left:null,top:null,width:null,height:null,visible:!1};g.style.display="none";a=Ce(g,"dlg_title");const m=Ye(a,"span","dlg_title_text");m.innerText=b;b=Ce(a,"dlg_close_btn");const q=F=>{F!=e.visible&&(e.visible=F,f&&f(e.visible),r())};Le(b,"click",()=>{q(!1)});b=Ce(g,"dlg_client");const r=()=>{e.left&&(g.style.left=e.left+"px",g.style.top=e.top+"px");e.width&&(e.width=Math.max(e.width,150),e.height=Math.max(e.height,150),g.style.width=e.width+
"px",g.style.height=e.height+"px");g.style.display=e.visible?"":"none"};r();const B=(F,G,N,T,V,E)=>{if(null===F[N]||void 0===F[N]||isNaN(F[N]))F[N]=parseInt(G[N]);G="track_"+N;if(null===F[G]||void 0===F[G]||isNaN(F[G]))F[G]=F[N];F[G]+=T;F[N]=Math.min(Math.max(F[G],E),V)},D=(F,G)=>{const N=window.getComputedStyle(g);B(e,N,"left",F,window.innerWidth-40,0);B(e,N,"top",G,window.innerHeight-40,0);r()};Fe(a,D,()=>{e.track_top=null;e.track_left=null;e.track_width=null;e.track_height=null});if(l){l=Ce(g,
"dlg_resize_r");a=Ce(g,"dlg_resize_l");let F=Ce(g,"dlg_resize_b"),G=Ce(g,"dlg_resize_rb"),N=Ce(g,"dlg_resize_lb"),T=(V,E)=>{let Q=window.getComputedStyle(g);B(e,Q,"width",V,window.innerWidth-40,150);B(e,Q,"height",E,window.innerWidth-40,150);r();null!==h&&h()};Fe(G,T);Fe(N,(V,E)=>{T(-V,E);D(V,0)});Fe(l,V=>{T(V,0)});Fe(a,V=>{T(-V,0);D(V,0)});Fe(F,(V,E)=>{T(0,E)});null!==h&&h()}return{elem:g,client:b,rect:e,dset_visible:q,set_title:F=>{m.innerText=F}}}
function Fe(a,b,l=null){function e(){h=!1;document.removeEventListener("mousemove",q);document.removeEventListener("mouseup",r);r=q=null}function f(B){if(h){B.preventDefault();var D=B.pageX-g,F=B.pageY-m;if(0!=D||0!=F)b(D,F,B.pageX,B.pageY),g=B.pageX,m=B.pageY}}let h=!1,g,m;var q=null,r=null;Le(a,"mousedown",function(B){1==B.buttons&&(h=!0,l&&l(B.pageX,B.pageY,B),g=B.pageX,m=B.pageY,q=Le(document,"mousemove",f),r=Le(document,"mouseup",e))})}
function Of(a,b,l,e){let f=()=>{a.removeChild(h.elem)},h=We(a,b,!1,{visible:!0},f);h.elem.classList.add("dlg_size_save_as");Ce(h.client,"dlg_label").innerText=l;b=Ce(h.client);l=Ce(h.client,"dlg_buttons_group");Pf(l,"Save",()=>{e();a.removeChild(h.elem)}).classList.add("dlg_button");Pf(l,"Cancel",f).classList.add("dlg_button");return{dlg:h,center_elem:b}}
function Te(a,b,l){const e=We(De,a,!1,{visible:!0},()=>{De.removeChild(e.elem)});Ce(e.client,"dlg_label").innerText=b;a=Ce(e.client,"dlg_buttons_group");for(let f of l)Pf(a,f.text,()=>{f.func&&f.func();De.removeChild(e.elem)}).classList.add("dlg_button");return e}var Qf=null;
function Rf(a,b,l){null===Qf&&(Qf=document.createElement("a"),Qf.style.display="none",De.appendChild(Qf));b=window.URL.createObjectURL(new Blob([l],{type:b}));Qf.setAttribute("href",b);Qf.setAttribute("download",a);Qf.click();window.URL.revokeObjectURL(b)}function Sf(){var a=Tf();a=jsyaml.safeDump(a,{noCompatMode:!0,lineWidth:-1,_flowArrLevel:3});Rf("program.yaml","application/x-yaml",a)}
function Uf(a){console.log("import!",a);let b=new FileReader;Le(b,"load",function(l){try{const e=jsyaml.safeLoad(l.target.result);try{kg=!0,lg(e)}finally{kg=!1}gd();le(!0)}catch(e){console.error(e)}});Le(b,"error",function(l){console.error(l)});b.readAsText(a)}
function mg(){let a=null;const b=sf.width/sf.height,l=Of(De,"Export PNG","Image size:",()=>{const g=()=>{a.download="image.png";a.href=sf.toDataURL("image/png");a.click()};if(f.value!=sf.width||h.value!=sf.height){const m=rf.pan_x/rf.viewport_zoom,q=rf.pan_y/rf.viewport_zoom;sf.width=f.value;sf.height=h.value;Df();rf.pan_x=m*rf.viewport_zoom;rf.pan_y=q*rf.viewport_zoom;ng(!1,!1,()=>{g()})}else g()});var e=Ce(l.center_elem,"dlg_input_line");Ye(e,"span","dlg_input_label").innerText="Width:";const f=
Ye(e,"input","dlg_text_input");f.type="number";f.addEventListener("input",()=>{h.value=Math.round(f.value/b)});e=Ce(l.center_elem,"dlg_input_line");Ye(e,"span","dlg_input_label").innerText="Height:";const h=Ye(e,"input","dlg_text_input");h.type="number";h.addEventListener("input",()=>{f.value=Math.round(h.value*b)});a=Ye(l.center_elem,"a","dl_lnk_hidden");f.value=sf.width;h.value=sf.height}
function og(){if(null===dd.display_node)Te("Error","No display node selected",{text:"OK"});else{var a=dd.display_node.outputs[0].get_const();if(null===a)Te("Error","No output object generated",{text:"OK"});else{var b=zd,l=new C2S(sf.width,sf.height);l.need_antialias_gap_fill=!1;zd=l;try{void 0!==a.invalidate_pos&&a.invalidate_pos(),rd(l,rf.t_viewport),a.draw_m(rf.t_viewport,dd.display_node.display_values)}catch(e){Te("Error",e.message,[{text:"OK"}]);return}finally{void 0!==a.invalidate_pos&&a.invalidate_pos(),
zd=b}a=l.getSerializedSvg(!0);Ye(De,"a","dl_lnk_hidden");Rf("image.svg","image/svg+xml",a)}}}var pg=[];function qg(a){let b=Ce(a,["top_menu","top_menu_file"]);b.innerText="File";let l=window.getComputedStyle(b);Le(b,"click",()=>{let e=lf([{text:"Export Program...",func:Sf},{text:"Import Program...",func:Uf,type:"file-in"},{text:"Export PNG...",func:mg},{text:"Export SVG...",func:og}],parseInt(l.left),b.offsetHeight,a,()=>{Bf()});pg.push(e)})}
function Bf(){for(let a of pg)a.parentElement.removeChild(a);pg.length=0}var rg=null;
function sg(){De.style.bottom="35px";const a=Ce(body,"anim_bar");var b=Ce(a,["anim_btn","anim_back_btn"]);Le(b,"click",function(){tg.rewind()});const l=Ye(a,"input","param_checkbox_input");l.type="checkbox";l.id="play_btn_check";Ye(a,"label",["anim_btn","anim_play_btn"]).setAttribute("for",l.id);Le(l,"change",function(){l.checked?tg.start():tg.pause()});b=Ce(a,["anim_btn","anim_one_next_btn"]);Le(b,"click",function(){tg.one_next()});b=Ce(a,"anim_frame_disp_wrap");const e=Ye(b,"input","anim_frame_disp");
e.type="text";e.spellcheck=!1;e.value="0";Le(e,"input",function(){const f=parseInt(e.value);tg.set_frame_num(f-1)});Ce(b,["hover_box","anim_fn_hover_box"]).innerText="frame_num";rg=Ce(a,"anim_fps_disp");rg.innerText="0";tg.reg_pre_draw((f,h,g)=>{e.value=f;g||(l.checked=!1)})}let ug=0,vg=0;
class wg{constructor(a,b){"string"===typeof b?this.label_display=this.label=b:(this.label=b[1]+b[0],this.label_display=b[0]);this.line_elem=this.label_elem=null;this.visible=this.enable=!0;if(null!==a){for(let l of a.parameters)if(l.label===b)throw Error("Can't have two parameters with the same label "+b);a.parameters.push(this)}this.owner=a;this.dirty=!0;this.group_param=this.shares_line_from=this.change_func=null;this.my_expr_items=[];this.shader_generated=!1}set_label(a){this.label=a;null!==this.label_elem&&
(this.label_elem.innerText=a);this.owner.rename_param(this,a)}set_enable(a){this.enable!=a&&(this.enable=a,null!==this.line_elem&&this.line_elem.classList.toggle("param_disabled",!this.enable))}pis_enable(){return this.enable}set_visible(a){this.visible!=a&&(this.visible=a,null!==this.line_elem&&xg(this.line_elem,this.visible))}pis_visible(){return this.visible}pis_active(){return this.visible&&this.enable}init_enable_visible(){null!==this.line_elem&&(this.enable||this.line_elem.classList.toggle("param_disabled",
!0),this.visible||xg(this.line_elem,!1))}pset_dirty(a=!0){this.dirty=!0;a&&le(!0)}pclear_dirty(){this.dirty=!1}pis_dirty(){return this.dirty}call_change(){this.change_func&&this.change_func(this.v)}get_value(){Id(null!==this.v,"value of expr not set");return this.v}share_line_elem_from(a){this.shares_line_from=a}is_sharing_line_elem(){return null===this.shares_line_from?!1:this.visible==this.shares_line_from.visible?null!==this.shares_line_from:this.shares_line_from.visible}set_group(a){this.group_param=
a}reg_expr_item(a){this.my_expr_items.push(a)}resolve_variables(a,b,l){let e=!1;for(let f of this.my_expr_items)e|=f.eresolve_variables(a,b,l);e&&this.call_change()}reeval_all_exprs(){for(let a of this.my_expr_items)a.eis_active()&&a.peval_self()}set_shader_generated(a){this.shader_generated=a}is_shader_generated(){return this.shader_generated}get_last_error(){return null}}
function yg(a){let b=0;for(let l of a)l.label_elem&&(l.label_elem.scrollWidth>l.label_elem.offsetWidth?b=Math.max(b,l.label_elem.scrollWidth+5):""!==l.label_elem.style.width&&(b=Math.max(b,l.label_elem.scrollWidth)));if(0!=b)for(let l of a)null!==l.label_elem&&(l.label_elem.style.width=b+"px")}function xg(a,b){a.classList.toggle("param_invisible",!b)}
function re(a,b=null){Af();b=null!==b?b:Ce(zg,"params_node");var l=Ce(b,"param_title");Ye(l,"span","param_title_cls").innerText=a.cls.constructor.name();const e=Ye(l,"span","param_title_name");e.innerText+=" : "+a.name;l=h=>{e.innerText=" : "+h};a.register_rename_observer(l);const f=new Ag;a.is_selected_inf.popups_dismiss=f;a.is_selected_inf.param_elem=b;a.is_selected_inf.rename_func=l;Bg.push(f);for(let h of a.parameters)null===h.group_param&&(h.add_elems(b),h.init_enable_visible());yg(a.parameters)}
function te(a){a.is_selected_inf.param_elem.parentElement.removeChild(a.is_selected_inf.param_elem);Af();se(Bg,a.is_selected_inf.popups_dismiss);a.remove_rename_observer(a.is_selected_inf.rename_func)}class Ag{constructor(){this.lst=[]}dismiss_list(){for(let a of this.lst)a()}}let Bg=[];function Af(){for(let a of Bg)a.dismiss_list()}
function Cg(a,b){Id(null!==a&&null!==a.is_selected_inf&&null!==a.is_selected_inf.popups_dismiss,"Unexpected null registering popup dismiss");a.is_selected_inf.popups_dismiss.lst.push(b)}function Dg(a){let b="";if(a.constructor===Eg)for(let e in a.v){b+=e+"::";var l=a.v[e];for(let f of l)null!==f&&(b+=f.label+"_")}else for(l of a)null!==l&&(b+=l.label+"_");return b}var Fg=null,Gg=null;
function Hg(a,b){let l=null;b&&a&&(l=a.get_disp_params(b.display_values));if(null===a||null===l||null===b||null===b.is_selected_inf)Ig.innerHTML="",Fg=null;else if(a=Dg(l),b!==Fg||a!==Gg){Ig.innerHTML="";var e=f=>{const h=Ce(Ig,"div_display_params");for(let g of f)null!==g&&void 0!==g.add_elems&&g.add_elems(h)};if(l.constructor===Eg)for(let f in l.v)e(l.v[f]);else e(l);Fg=b;Gg=a}}
function Jg(a,b){a=document.createElement(a);void 0!==b&&null!==b&&(Array.isArray(b)||(b=[b]),a.classList=b.join(" "));return a}function Ye(a,b,l){b=Jg(b,l);a.appendChild(b);return b}function Kg(a,b,l,e){b=Jg(b,l);a.appendChild(b);b.setAttribute("id",e);return b}function Cd(a){return Jg("div",a)}function Ce(a,b){b=Cd(b);a.appendChild(b);return b}function Lg(a,b,l){b=Cd(b);a.appendChild(b);b.setAttribute("id",l);return b}
function Mg(a,b=null,l="param_line"){if(null!==b){if(b.is_sharing_line_elem())return a=void 0!==b.shares_line_from.shared_line_elem?b.shares_line_from.shared_line_elem:b.shares_line_from.line_elem,a.classList.contains("param_multi_line")&&"param_multi_line"!==l&&(a.classList.add("param_multi_line_shared"),a=Ce(a,"param_line")),a;null!==b.group_param&&null!==b.group_param.line_elem&&(a=b.group_param.line_elem)}return Ce(a,l)}function Ng(a,b=null){return Mg(a,b,"param_multi_line")}
function Og(a,b,l){let e=document.createElement("span");null!=b?(e.innerText=b,e.className="param_label_pre"):e.className="param_label_pre_empty";void 0!==l&&e.classList.add(l);a.appendChild(e);null!=b&&(b=document.createElement("span"),b.className="param_label_colon",b.innerText=":",a.append(b));return e}
function Kf(a,b,l,e){let f=Ye(a,"input","param_file_input");f.type="file";f.id="p_fl_"+Pg++;a=Ye(a,"label",b);a.innerText=l;a.setAttribute("for",f.id);Le(f,"change",()=>{e(f.files[0]);f.value=""});return[f,a]}function Qg(a,b){return 1==a||0==a?a:0==b||3==b?Rg(a):1==b?Math.round(a):a}
function Sg(a,b,l,e,f=null,h=null){let g=document.createElement("input");null===f&&(f="param_editbox");g.classList=["param_input",f].join(" ");g.type="text";g.spellcheck=!1;g.value=Qg(b,l);Le(g,"input",function(){e(0==l?parseFloat(g.value):g.value)});null!==h&&Le(g,"keyup",function(m){13===m.keyCode&&h()});a.appendChild(g);return g}
function gh(a,b,l,e,f,h){const g=Ce(a,"slider_line"),m=Ce(g,"slider_fill"),q=Ce(g,"slider_thumb");var r=b,B=l,D=null;const F=(G,N=!1)=>{null===G||N?q.classList.toggle("slider_thumb_disabled",!0):(q.classList.toggle("slider_thumb_disabled",!1),D=G,1===f&&(G=Math.round(G)),B===r&&(G=0),G=(G-r)/(B-r),G=hh(0,G,1),q.style.left=100*G+"%",m.style.width=100*G+"%")};F(e);Fe(q,(G,N,T)=>{G=g.getBoundingClientRect();T=(T-G.left)/G.width;T=hh(0,T,1);T=T*(B-r)+r;T!=D&&(D=T,h(D))});return{update:F,elem:g,update_range:(G,
N)=>{r=G;B=N;F(D)}}}function Ke(){return{with_alpha:!0,myAddEventListener:Le,dropper:ih}}function jh(a,b,l,e){let f=document.createElement("input");f.className=l;a.appendChild(f);a=Ec.create_at(f,200,function(h){e(h)},Ke(),b);return[a.get_color().copy(),f,a]}let Pg=1;
function hf(a,b,l,e){let f=Ye(a,"input","param_checkbox_input");f.type="checkbox";f.id="p_chb_"+Pg++;f.checked=l;Le(f,"change",function(){e(f.checked)});l=Ye(a,"label","param_checkbox_disp");l.setAttribute("for",f.id);a=Ye(a,"label","param_checkbox_text");a.setAttribute("for",f.id);a.innerText=b;return[f,a,l]}function Pf(a,b,l,e=null){e=null===e?"param_btn":e.concat(["param_btn"]);a=Ce(a,e);a.innerText=b;Le(a,"click",l);return a}
function kh(a,b,l,e){let f=Ye(a,"input","param_checkbox_input");f.type="checkbox";f.id="p_chb_"+Pg++;f.checked=l;Le(f,"change",function(){e(f.checked)});a=Ye(a,"label","param_btn");a.setAttribute("for",f.id);a.innerText=b;return[f,a,null]}function lh(a,b,l,e){let f=Ye(a,"select",["param_select","param_input"]);for(let h of b)Ye(f,"option").innerText=h;f.selectedIndex=l;Le(f,"change",function(){e(f.selectedIndex)});return f}
function ih(a){const b=zd.getImageData(0,0,sf.width,sf.height),l=Ce(De,"color_dropper_back");Le(l,"mousemove",e=>{const f=rf.rect;e.pageX>f.left&&e.pageX<f.right&&e.pageY>f.top&&e.pageY<f.bottom&&(e=4*(e.pageX-f.left+(e.pageY-f.top)*b.width),a({r:b.data[e],g:b.data[e+1],b:b.data[e+2],alpha:b.data[e+3]/255}))});Le(l,"mouseup",()=>{De.removeChild(l)})}
class mh extends wg{constructor(a,b=null,l="param_separator"){super(a,b);this.cls=l}save(){return null}load(){}add_elems(a){this.line_elem=Mg(a,this,"param_line_sep");Ye(this.line_elem,"hr",this.cls)}}class nh extends wg{constructor(a,b,l,e=null){super(a,b);this.v=l;this.change_func=e}save(){return{v:this.v}}load(a){this.v=a.v}add_elems(){}st_set(a,b){this.v[a]=b;this.pset_dirty()}st_get(a){Id(void 0!==this.v[a],"Unknown store index "+a);return this.v[a]}st_get_all(){return this.v}}
class oh extends wg{constructor(a,b,l,e){super(a,b);this.v=l;this.change_func=e;this.elem=null}save(){return{v:this.v}}load(a){this.v=a.v}add_elems(a){this.line_elem=Mg(a,this);this.label_elem=Og(this.line_elem,this.label_display);this.elem=Sg(this.line_elem,this.v,2,b=>{this.v=b;this.call_change();this.pset_dirty()})}modify(a){this.v!==a&&(this.v=a,null!==this.elem&&(this.elem.value=a),this.pset_dirty())}}
function ph(a){if(null===a)return{allow_expr:!0,expr_visible:!1,as_btn:!1,pulse_btn:!1};void 0===a.allow_expr&&(a.allow_expr=!0);void 0===a.expr_visible&&(a.expr_visible=!1);void 0===a.as_btn&&(a.as_btn=!1);void 0===a.pulse_btn&&(a.pulse_btn=!1);Id(!(a.as_btn&&a.pulse_btn),"can't have both as_btn and pulse_btn");return a}
class qh extends wg{constructor(a,b,l,e=null,f=null){super(a,b);this.v=l;this.change_func=e;this.elem_input=null;this.opt=ph(f);this.opt.allow_expr?(this.make_checkbox_ctx_menu(),this.item=new rh(this,"v",6,h=>{this.opt.expr_visible&&(this.v=null==h?null:0<h,this.opt.pulse_btn&&(this.pulse_need_reset=!0))},()=>this.v?1:0,{allowed:!1}),this.item.set_eactive(this.opt.expr_visible),this.opt.expr_visible&&this.item.peval(""+l)):this.item=this.ctx_menu=null;this.expr_line=this.checkbox_line=null;this.pulse_need_reset=
!1}set_show_expr(a){a!==this.opt.expr_visible&&(this.opt.expr_visible=a,null!==this.single_line&&(xg(this.checkbox_line,!a),xg(this.expr_line,a)),this.item.set_eactive(a),a?this.item.peval_self():this.non_code_peval_self(),this.pset_dirty())}non_code_peval_self(){null!==this.elem_input&&(this.v=this.elem_input.checked)}make_checkbox_ctx_menu(){this.ctx_menu=new sh(this.owner);this.ctx_menu.add_to_context_menu((a,b)=>{a=Ce(a,"prm_ctx_bexpr_line");hf(a,"Expression",this.opt.expr_visible,l=>{this.set_show_expr(l);
b()})})}save(){const a={v:this.v};this.opt.expr_visible&&(a.expr_visible=!0);null!==this.item&&this.item.save_to(a);return a}load(a){this.opt.pulse_btn||(this.v=a.v);this.opt.expr_visible=a.expr_visible||!1;this.opt=ph(this.opt);this.opt.allow_expr&&null!==this.item&&(this.item.load(a),this.item.set_eactive(this.opt.expr_visible));this.call_change()}add_elems(a){this.opt.allow_expr?(this.line_elem=Ng(a,this),this.checkbox_line=Mg(this.line_elem)):this.line_elem=this.checkbox_line=Mg(a,this);xg(this.checkbox_line,
!this.opt.expr_visible);a=null;this.is_sharing_line_elem()?this.opt.as_btn||(a="param_checkbox_inline"):Og(this.checkbox_line,null);if(this.opt.pulse_btn)Pf(this.checkbox_line,this.label_display,()=>{this.pulse_need_reset=this.v=!0;this.pset_dirty()});else{const [b,,l]=(this.opt.as_btn?kh:hf)(this.checkbox_line,this.label_display,this.v,e=>{this.v=e;this.call_change();this.pset_dirty()});a&&null!==l&&l.classList.toggle(a,!0);this.elem_input=b}this.label_elem=null;this.opt.allow_expr&&(this.expr_line=
Mg(this.line_elem),xg(this.expr_line,this.opt.expr_visible),this.label_elem=Og(this.expr_line,this.label_display),this.item.add_editbox(this.expr_line,!0),this.ctx_menu.add_context_menu(this.line_elem))}modify(a){a!==this.v&&(this.v=a,null!==this.elem_input&&(this.elem_input.checked=a),this.call_change(),this.pset_dirty())}get_value(){Id(void 0!==this.v,"value of bool not set");return this.v}gl_set_value(a){th.uniform1i(a,this.get_value())}pclear_dirty(){super.pclear_dirty();this.pulse_need_reset&&
(this.pulse_need_reset=this.v=!1,this.pset_dirty(!1))}}function uh(a,b,l){void 0===a[b]&&(a[b]=l);return a[b]}class vh extends qh{constructor(a,b,l,e){super(null,b,uh(a,l,e),f=>{a[l]=f;le()},{allow_expr:!1,expr_visible:!1})}pset_dirty(){}}
function wh(a,b){if(null==a!=(null==b))return!1;if(null==a)return!0;if(void 0==a!=(void 0==b))return!1;if(void 0==a)return!0;if(void 0===a.length||void 0===b.length)return a==b;if(a.length!==b.length)return!1;for(let l=0;l<a.length;++l)if(a[l]!==b[l])return!1;return!0}
function xh(a){if(null===a||void 0===a)return{min:0,max:1,visible:!1,allowed:!0};if(void 0===a.min&&void 0===a.allowed&&Array.isArray(a))return{min:a[0],max:a[1],visible:!0,allowed:!0};void 0===a.allowed&&(a.allowed=!0);void 0===a.visible&&(a.visible=a.allowed);void 0===a.min&&(a.min=0);void 0===a.max&&(a.max=1);return a}
class sh{constructor(a){this.ctx_menu_elem=null;this.ctx_menu_adders=[];this.owner_node=a}add_to_context_menu(a){this.ctx_menu_adders.push(a)}add_context_menu(a){if(0!==this.ctx_menu_adders.length){var b=()=>{this.ctx_menu_elem&&(this.ctx_menu_elem.parentNode.removeChild(this.ctx_menu_elem),this.ctx_menu_elem=null)},l=e=>{for(let f of this.ctx_menu_adders)f(e,b)};Le(a,"contextmenu",e=>{this.ctx_menu_elem=lf([{cmake_elems:l}],e.pageX,e.pageY,De,()=>{b()});Cg(this.owner_node,()=>{b()});e.preventDefault()})}}}
function yh(a,b,l){var e=null;Le(b,"contextmenu",f=>{e=lf(l,f.pageX,f.pageY,De,()=>{e&&(e.parentNode.removeChild(e),e=null)});Cg(a,()=>{e&&(e.parentNode.removeChild(e),e=null)});f.preventDefault()})}
class rh{constructor(a,b,l,e=null,f=null,h=null){this.in_param=a;this.prop_name_ser=b;this.set_prop=null!==e?e:g=>{this.in_param[b]=g};this.get_prop=null!==f?f:()=>this.in_param[b];this.prop_type=l;this.e=this.editor=null;this.se=""+this.get_prop();this.override_create_elem=this.err_elem=this.need_inputs=this.elast_error=null;this.parse_opt=1;this.slider_conf=xh(h);this.initial_slider_conf=Kd(this.slider_conf);this.slider=null;this.ctx_menu=new sh(a.owner);this.slider_conf.allowed&&this.add_slider_ctx_menu();
this.etype=this.param_line=null;this.etype_depend_var=this.etype_undecided=!1;this.in_param.reg_expr_item(this);this.expr_score=null;this.variable_evaluators={};this.eactive=!0;this.last_resolve_varbox=null}set_eactive(a){this.eactive=a}eis_active(){return this.in_param.pis_active()&&this.eactive}save_to(a){if(null!==this.e&&null!==this.e.get_const_value())a["e_"+this.prop_name_ser]=this.e.get_const_value();else{var b=this.se.replace(/\r\n/g,"\n");a["se_"+this.prop_name_ser]=b}b=this.slider_conf;
var l=this.initial_slider_conf;if(b.min!==l.min||b.max!==l.max||b.visible!==l.visible||b.allowed!==l.allowed)a["sldcfg_"+this.prop_name_ser]=this.slider_conf}load(a){var b=a["e_"+this.prop_name_ser];if(void 0!==b)this.set_to_const(b);else if(b=a["se_"+this.prop_name_ser],void 0!==b&&null!==b)this.peval(b);else{b=a[this.prop_name_ser];if(void 0===b)return;this.do_set_prop(b)}a=a["sldcfg_"+this.prop_name_ser];void 0!==a&&(this.slider_conf=xh(a))}do_set_prop(a,b=!0){1==this.prop_type&&(a=null===a?null:
Math.round(a));b&&null!==this.slider&&this.slider.update(a,0!==this.expr_score);b=this.get_prop();if(4==this.prop_type){if(wh(a,b))return!1}else if(a===b)return!1;try{this.set_prop(a)}catch(l){throw this.eset_error(l),l;}return!0}eset_error(a){null===this.elast_error&&(this.elast_error={line:a.line,msg:a.message},this.editor&&this.editor.show_err(this.elast_error),void 0!==this.in_param.owner.cls&&we(this.in_param.owner.cls,"Parameter expression error"))}eclear_error(){null!==this.elast_error&&(this.elast_error=
null,this.editor&&this.editor.clear_err())}do_check_type(a=!1){a=zh.check_type(this.e,a);if(100===a)return this.etype=null,this.etype_undecided=!0,a;if(101==a)return this.etype=null,this.etype_depend_var=!0,a;this.etype=a;this.etype_undecided=this.etype_depend_var=!1;4===this.prop_type?Ah(10===this.etype||11===this.etype,"Wrong type, expected a vec3/4, got "+Bh(this.etype)):5===this.prop_type?Ah(12===this.etype,"Wrong type, expected vec2, got "+Bh(this.etype)):6===this.prop_type?Ah(2===this.etype||
1===this.etype,"Wrong type, expected bool or number, got "+Bh(this.etype)):7===this.prop_type?Ah(13===this.etype,"Wrong type, expected mat3, got "+Bh(this.etype)):Ah(1===this.etype,"Wrong type, expected a number, got "+Bh(this.etype));return a}peval_self(){this.peval(this.se)}peval(a){Ah(null!==a&&void 0!==a,"unexpected null string-expr");this.se=a;this.eclear_error();let b;null!==this.in_param.owner?(b=this.in_param.owner.state_access,null===b&&(b=this.in_param.owner.set_state_evaluators([]))):b=
new he([]);let l=null;try{b.reset_check(),this.e=zh.parse(a,b,this.parse_opt),this.variable_evaluators=b.need_variables,l=b.need_inputs,this.expr_score=b.score,this.etype_depend_var=this.etype_undecided=!1,this.eresolve_evaluators(this.last_resolve_varbox,!0,!0,!0),this.do_check_type()}catch(e){this.eset_error(e);return}finally{b.need_variables=null,b.need_inputs=null,b.score=0}0===this.expr_score?(this.do_set_prop(this.call_eval())&&this.in_param.pset_dirty(),this.need_inputs=null):(this.etype_undecided||
this.etype_depend_var?this.do_set_prop(null):0==(this.expr_score&4)&&this.do_set_prop(this.call_eval()),this.in_param.pset_dirty(),0!=(this.expr_score&1)&&(this.need_inputs=l));this.in_param.call_change()}display_slider(a){this.slider_conf.visible&&(null==this.slider||a)?(this.slider=gh(this.param_line,this.slider_conf.min,this.slider_conf.max,null,this.prop_type,b=>{this.set_to_const(b)&&(this.in_param.call_change(),this.in_param.pset_dirty())}),this.slider.update(this.get_prop(),0!==this.expr_score)):
this.slider_conf.visible||null==this.slider||(this.slider.elem.parentNode.removeChild(this.slider.elem),this.slider=null)}add_slider_ctx_menu(){let a=()=>{null!==this.slider&&(this.slider.update_range(this.slider_conf.min,this.slider_conf.max),ue())};this.ctx_menu.add_to_context_menu(b=>{let l=Ce(b,"prm_slider_ctx_line");hf(l,"Slider",this.slider_conf.visible,g=>{this.slider_conf.visible=g;this.display_slider(!1);h(g);ue()});let e=Ce(b,"prm_slider_ctx_line");Ye(e,"SPAN","prm_slider_ctx_label").innerText=
"Min:";Sg(e,this.slider_conf.min,0,g=>{this.slider_conf.min=g;a()});let f=Ce(b,"prm_slider_ctx_line");Ye(f,"SPAN","prm_slider_ctx_label").innerText="Max:";Sg(f,this.slider_conf.max,0,g=>{this.slider_conf.max=g;a()});let h=g=>{e.classList.toggle("param_disabled",!g);f.classList.toggle("param_disabled",!g)};h(this.slider_conf.visible)})}add_editbox(a){this.param_line=a;const b=l=>{try{this.peval(l)}catch(e){}};null===this.override_create_elem?(this.editor=new Ch(Sg(a,this.se,2,b)),this.slider_conf.allowed&&
this.display_slider(!0)):this.editor=this.override_create_elem(a,this.se,b,this.in_param.label.replace("\n"," "));null!==this.elast_error&&this.editor.show_err(this.elast_error);this.ctx_menu.add_context_menu(a);return this.editor}set_to_const(a){this.eclear_error();this.e=zh.make_num_node(a);this.se=Qg(a,this.prop_type);this.expr_score=0;this.need_inputs=null;this.variable_evaluators={};null!==this.editor&&this.editor.set_value(this.se);return this.do_set_prop(a)}dyn_eval(){this.eclear_error();if(null===
this.etype)try{this.do_check_type()}catch(a){throw this.eset_error(a),a;}return null===this.e?this.get_prop():this.call_eval()}call_eval(){try{return zh.do_eval(this.e)}catch(a){throw this.eset_error(a),void 0===a.node_cls&&(a.node_cls=this.in_param.owner.cls),a;}}eto_glsl(a){this.eclear_error();try{return zh.do_to_glsl(this.e,a,this.parse_opt)}catch(b){throw this.eset_error(b),void 0===b.node_cls&&(b.node_cls=this.in_param.owner.cls),b;}}need_input_evaler(a){if(void 0===this.need_inputs||null===
this.need_inputs)return null;a=this.need_inputs[a];return void 0===a?null:a}get_last_error(){return null===this.elast_error?null:this.elast_error.msg}eresolve_evaluators(a,b,l,e){let f=!1;for(let h in this.variable_evaluators){const g=this.variable_evaluators[h];if(!g.is_valid())continue;l&&(g.var_box=null);let m=void 0;e&&null!==a&&(m=a.lookup(g.varname));l&&void 0===m&&(m=tg.globals_vars_box.lookup(g.varname));if(null===m){if(null!==g.var_box)continue;if(b)continue;if(l){this.in_param.pset_dirty();
continue}throw new je("Unknown variable "+g.varname,g.line_num);}g.var_box=m;f=f||m.vis_dirty()}return f}eresolve_variables(a,b,l){this.last_resolve_varbox=a;if(0!=(this.expr_score&2)&&this.eis_active())try{const e=this.eresolve_evaluators(a,!1,b,l),f=this.get_prop();if(e||null===f)if(this.eclear_error(),zh.clear_types_cache(this.e),101!==this.do_check_type(l))return a=!1,0!=(this.expr_score&1)?(this.do_set_prop(null),this.in_param.pset_dirty(),a=!0):this.do_set_prop(this.call_eval(),!1)&&(this.in_param.pset_dirty(),
a=!0),a}catch(e){throw this.eset_error(e),e;}}}
class Ch{constructor(a){this.elem=a;this.err_elem=null}show_err(a){this.err_elem=Cd("param_edit_err_box");this.err_elem.innerText=a.msg;this.err_elem.style.left=Math.round(this.elem.offsetLeft)+"px";this.err_elem.style.top=Math.round(this.elem.offsetHeight)+"px";this.elem.parentElement.insertBefore(this.err_elem,this.elem.nextSibling);this.elem.classList.toggle("param_input_error",!0)}clear_err(){this.elem.classList.toggle("param_input_error",!1);this.err_elem&&(this.err_elem.parentElement.removeChild(this.err_elem),
this.err_elem=null)}set_value(a){this.elem.value=a}get_elem(){return this.elem}}
let Eh=a=>class extends a{constructor(b,l,e){super(b,l);this.allowed_code=!0;this.show_code=null!==e&&!1===e.allowed_code?this.allowed_code=!1:null!==e&&!0===e.show_code?!0:!1;this.dlg_rect_wrap={dlg_rect:null,panel_rect:null}}make_code_item(b,l){this.code_item=b;this.code_item.prop_name_ser="cv";this.code_item.override_create_elem=(e,f,h,g)=>new Dh(e,f,h,{lang:"glsl",dlg_title:g,dlg_rect_wrap:this.dlg_rect_wrap,with_popout:!0});this.code_item.parse_opt=2;this.populate_code_ctx_menu(this.code_item.ctx_menu);
this.code_item.peval("return "+l);this.do_set_eactives();this.show_code_callback=this.single_line=this.code_line=null}add_code_elem(){this.allowed_code&&null!==this.line_elem&&(null!==this.code_line?this.line_elem.appendChild(this.code_line):this.show_code&&(this.code_line=Mg(this.line_elem),xg(this.code_line,this.show_code),Og(this.code_line,this.label_display),this.code_item.add_editbox(this.code_line,!0)))}save_code(b){delete b.show_code;this.show_code&&(b.show_code=!0);null!==this.dlg_rect_wrap.dlg_rect&&
(b.dlg_rect=this.dlg_rect_wrap.dlg_rect);null!==this.dlg_rect_wrap.panel_rect&&(b.panel_rect=this.dlg_rect_wrap.panel_rect);this.code_item.save_to(b)}load_code(b){this.show_code=b.show_code||!1;this.dlg_rect_wrap.dlg_rect=b.dlg_rect||null;this.dlg_rect_wrap.panel_rect=b.panel_rect||null;this.code_item.load(b);this.do_set_eactives()}do_set_eactives(){this.code_item.set_eactive(this.show_code);this.non_code_eactive(!this.show_code)}set_show_code(b){b!==this.show_code&&((this.show_code=b)&&null===this.code_line&&
this.add_code_elem(),null!==this.single_line&&(xg(this.single_line,!b),null!==this.code_line&&xg(this.code_line,b)),this.do_set_eactives(),b?this.code_item.peval_self():this.non_code_peval_self(),this.show_code_callback&&this.show_code_callback(b),this.pset_dirty())}populate_code_ctx_menu(b){this.allowed_code&&b.add_to_context_menu((l,e)=>{l=Ce(l,"prm_slider_ctx_line");hf(l,"Code",this.show_code,f=>{this.set_show_code(f);e()})})}};
class Fh extends Eh(wg){constructor(a,b,l,e,f=null,h=null){super(a,b,f);Id(void 0!==l,"start value should not be undefined");null===f||void 0===f.validate?(a=g=>{this.show_code||(this.v=g)},b=g=>{this.show_code&&(this.v=g)}):(a=g=>{this.show_code||(f.validate(g),this.v=g)},b=g=>{this.show_code&&(f.validate(g),this.v=g)});this.v=null;this.item=new rh(this,"v",e,a,null,f);this.populate_code_ctx_menu(this.item.ctx_menu);this.single_line=null;this.item.peval(l);e=new rh(this,"v",e,b,null,{allowed:!1});
this.make_code_item(e,l);this.change_func=h}non_code_peval_self(){this.item.peval_self()}non_code_eactive(a){this.item.set_eactive(a)}save(){let a={};this.item.save_to(a);this.save_code(a);return a}load(a){this.item.load(a);this.load_code(a)}add_elems(a){this.line_elem=Ng(a,this);this.single_line=Mg(this.line_elem);xg(this.single_line,!this.show_code);this.label_elem=Og(this.single_line,this.label_display);if(this.is_sharing_line_elem()&&this.allowed_code)throw Error("param that shares line doesn't work with allowed_code");
this.item.add_editbox(this.single_line,!0);this.add_code_elem()}get_active_item(){return this.show_code?this.code_item:this.item}dyn_eval(){return this.get_active_item().dyn_eval()}need_input_evaler(a){return this.get_active_item().need_input_evaler(a)}get_last_error(){return this.get_active_item().get_last_error()}modify(a,b=!0){this.show_code||this.item.set_to_const(a)&&b&&this.pset_dirty()}increment(a){this.show_code||(this.item.set_to_const(this.v+a),this.pset_dirty())}}
class Gh extends Fh{constructor(a,b,l,e=null,f=null){super(a,b,l,0,e,f)}gl_set_value(a){th.uniform1f(a,this.get_value())}}class Hh extends Fh{constructor(a,b,l,e=null,f=null){super(a,b,l,1,e,f);this.item.set_prop=h=>{this.v=null===h?null:Math.round(h)}}gl_set_value(a){th.uniform1i(a,this.get_value())}}
class Ih extends Gh{constructor(a,b,l,e){const f=a[l+"_slider"];let h={allowed_code:!1};void 0!==f&&(h={...h,...f});e=Rg(uh(a,l,e));super(null,b,e,h,g=>{a[l]=g;a[l+"_slider"]=this.item.slider_conf;le()})}pset_dirty(){}}
class Jh extends Eh(wg){constructor(a,b,l,e,f=null,h){super(a,b,f);Id(void 0!==l&&void 0!==e,"start value should not be undefined");this.x=l;this.item_x=new rh(this,"x",0,g=>{this.show_code||(this.x=g)},null,{allowed:!1});this.y=e;this.item_y=new rh(this,"y",0,g=>{this.show_code||(this.y=g)},null,{allowed:!1});this.single_line=this.dial=null;this.item_x.peval_self();this.item_y.peval_self();this.dial=null;this.populate_code_ctx_menu(this.item_x.ctx_menu);a=new rh(this,"-unused-",5,g=>{this.show_code&&
(null===g?this.y=this.x=null:(this.x=g[0],this.y=g[1]))},()=>null===this.x?null:[this.x,this.y],{allowed:!1});this.make_code_item(a,"vec2("+l+", "+e+")");this.size_dial=null;this.change_func=h}call_change(){this.change_func&&this.change_func([this.x,this.y])}non_code_peval_self(){this.item_x.peval_self();this.item_y.peval_self()}non_code_eactive(a){this.item_x.set_eactive(a);this.item_y.set_eactive(a)}save(){let a={};this.item_x.save_to(a);this.item_y.save_to(a);this.save_code(a);return a}load(a){this.item_x.load(a);
this.item_y.load(a);this.load_code(a)}add_elems(a){this.line_elem=Ng(a,this);this.single_line=Mg(this.line_elem);xg(this.single_line,!this.show_code);this.label_elem=Og(this.single_line,this.label_display);this.item_x.add_editbox(this.single_line);this.item_y.add_editbox(this.single_line);this.shared_line_elem=this.single_line;this.add_code_elem()}get_value(){Id(null!==this.x&&void 0!==this.x,"value of vec2 expr not set");return[this.x,this.y]}increment(a){this.show_code||(this.item_x.set_to_const(this.x+
a[0]),this.item_y.set_to_const(this.y+a[1]),this.pset_dirty())}modify(a,b=!0,l=!1){this.modify_e(a[0],a[1],b,l)}modify_e(a,b,l=!0,e=!1){this.show_code||(a=e|this.item_x.set_to_const(a),(a|=this.item_y.set_to_const(b))&&l&&this.pset_dirty())}dyn_eval(){if(this.show_code)return this.code_item.dyn_eval();const a=this.item_x.dyn_eval(),b=this.item_y.dyn_eval();return Ff.fromValues(a,b)}need_input_evaler(a){return this.show_code?this.code_item.need_input_evaler(a):this.item_x.need_input_evaler(a)||this.item_y.need_input_evaler(a)}get_last_error(){return this.show_code?
this.code_item.get_last_error():this.item_x.get_last_error()||this.item_y.get_last_error()}gl_set_value(a){Id(void 0!==this.x,"value of vec2 expr not set (gl_set)");th.uniform2f(a,this.x,this.y)}size_dial_draw(a,b){null===this.size_dial&&(this.size_dial=new Kh(this));this.size_dial.draw(a,b)}size_dial_find_obj(a){if(null!==this.size_dial)return this.size_dial.find_obj(a)}}
class Lh extends wg{constructor(a,b,l,e){super(a,b);this.x=l;this.y=e;this.elem_y=this.elem_x=null}save(){return{x:this.x,y:this.y}}load(a){this.x=a.x;this.y=a.y}add_elems(a){this.line_elem=Mg(a,this);this.label_elem=Og(this.line_elem,this.label_display);this.elem_x=Sg(this.line_elem,this.x,1,b=>{this.x=parseInt(b);this.pset_dirty()});this.elem_y=Sg(this.line_elem,this.y,1,b=>{this.y=parseInt(b);this.pset_dirty()})}set(a,b){this.x=Math.round(a);this.y=Math.round(b);this.pset_dirty();null!==this.elem_x&&
(this.elem_x.value=this.x,this.elem_y.value=this.y)}get_value(){return[this.x,this.y]}}function Mh(a){const b="("+a.r+", "+a.g+", "+a.b;return 1===a.alpha?"rgb"+b+")":"rgba"+b+", "+a.alpha+")"}
class Nh extends Eh(wg){constructor(a,b,l,e=null){super(a,b,e);Array.isArray(l)?this.v=Dc.parse_hex(l[0]):(this.v=Dc.parse_hex(l),l=[l,Mh(this.v)]);this.picker_elem=this.picker=null;this.picker_v=Kd(this.v);this.picker_ctx_menu=new sh(this.owner);this.populate_code_ctx_menu(this.picker_ctx_menu);a=new rh(this,"-unused-",4,f=>{if(this.show_code)return this._set_value_from_arr(f)},()=>null===this.v.r?null:Oh.fromValues(this.v.r,this.v.g,this.v.b,this.v.alphai),{allowed:!1});this.make_code_item(a,l[1])}_set_value_from_arr(a){if(null===
a){if(null===this.v.r)return!1;this.v.r=null;this.v.g=null;this.v.b=null;this.v.alpha=null;this.v.alphai=null;return!0}const b=hh(0,a[0],255),l=hh(0,a[1],255),e=hh(0,a[2],255);let f;3===a.length?(f=255,a=1):(f=hh(0,a[3],255),a=this.v.alphai/255);if(this.v.r==b&&this.v.g==l&&this.v.b==e&&this.v.alphai==f)return!1;this.v.r=b;this.v.g=l;this.v.b=e;this.v.alpha=a;this.v.alphai=f;return!0}non_code_peval_self(){this.v=Kd(this.picker_v);this.pset_dirty()}non_code_eactive(){}get_value(){Id(null!==this.v.r,
"value of color expr not set");return this.v}save(){let a={};null!==this.picker_v&&(a.hex=this.picker_v.hex);this.save_code(a);return a}load(a){this.load_code(a);this.picker_v=Dc.parse_hex(a.hex);this.show_code||(this.v=Kd(this.picker_v))}add_elems(a){this.line_elem=Ng(a,this);this.single_line=Mg(this.line_elem);xg(this.single_line,!this.show_code);this.label_elem=Og(this.single_line,this.label_display);let [b,l,e]=jh(this.single_line,this.picker_v,"param_input",f=>{if(null===this.v||this.v.hex!=
f.hex)this.v=null===f?null:f.copy(),this.picker_v=Kd(this.v),this.pset_dirty()});this.v=b;this.picker_elem=l;this.picker=e;this.picker_ctx_menu.add_context_menu(this.picker_elem);this.add_code_elem()}dyn_eval(){if(this.show_code){let a=this.code_item.dyn_eval();a[0]=hh(0,a[0],255);a[1]=hh(0,a[1],255);a[2]=hh(0,a[2],255);3==a.length?a=Oh.fromValues(a[0],a[1],a[2],255):a[3]=hh(0,a[3],255);return a}return Oh.fromValues(this.v.r,this.v.g,this.v.b,this.v.alphai)}need_input_evaler(a){return this.show_code?
this.code_item.need_input_evaler(a):null}get_last_error(){return this.show_code?this.code_item.get_last_error():null}modify(a,b=!0){this.show_code||this._set_value_from_arr(a)&&b&&this.pset_dirty(!0)}gl_set_value(a){Id(null!==this.v.r,"value of color expr not set (gl)");th.uniform4f(a,this.v.r/255,this.v.g/255,this.v.b/255,this.v.alpha)}}function Rg(a){return 1E-13>Math.abs(a)?"0":a.toFixed(-Math.min(Math.round(Math.log10(Math.abs(a)))-2,-3))}
class Ph extends Eh(wg){constructor(a,b,l={},e=null,f=null){super(a,b,e);this.translate=[0,0];this.rotate=0;this.scale=[1,1];this.v=Qh.create();this.rotate_pivot=[0,0];this.b2_style=null!==e&&!0===e.b2_style?!0:!1;this.elems={tx:null,ty:null,r:null,sx:null,sy:null,pvx:null,pvy:null};this.dial=new Rh(this);this.single_line=null;a={allowed:!1};this.item_tx=new rh(this,"tx",0,h=>{this.show_code||(this.translate[0]=h,this.calc_mat())},()=>this.translate[0],a);this.item_ty=new rh(this,"ty",0,h=>{this.show_code||
(this.translate[1]=h,this.calc_mat())},()=>this.translate[1],a);this.item_r=new rh(this,"r",0,h=>{this.show_code||(this.rotate=h,this.calc_mat())},()=>this.rotate,{min:0,max:360});this.item_pvx=new rh(this,"pvx",0,h=>{this.show_code||this.calc_pivot_counter(h,0)},()=>this.rotate_pivot[0],a);this.item_pvy=new rh(this,"pvy",0,h=>{this.show_code||this.calc_pivot_counter(h,1)},()=>this.rotate_pivot[1],a);this.item_sx=new rh(this,"sx",0,h=>{this.show_code||(this.scale[0]=h,this.calc_mat())},()=>this.scale[0],
a);this.item_sy=new rh(this,"sy",0,h=>{this.show_code||(this.scale[1]=h,this.calc_mat())},()=>this.scale[1],a);this.items=[this.item_tx,this.item_ty,this.item_r,this.item_pvx,this.item_pvy,this.item_sx,this.item_sy];this.item_dict={tx:this.item_tx,ty:this.item_ty,r:this.item_r,pvx:this.item_pvx,pvy:this.item_pvy,sx:this.item_sx,sy:this.item_sy};this.populate_code_ctx_menu(this.item_tx.ctx_menu);this.populate_code_ctx_menu(this.item_r.ctx_menu);this.populate_code_ctx_menu(this.item_pvx.ctx_menu);this.populate_code_ctx_menu(this.item_sx.ctx_menu);
for(let h in l)a=this.item_dict[h],Id(void 0!==a,"unknown name: "+h),a.peval(l[h]);for(let h in this.item_dict)void 0===l[h]&&this.item_dict[h].peval_self();l=new rh(this,"v",7,h=>{this.show_code&&(null===h?this.v[0]=NaN:Qh.copy(this.v,h))},()=>{if(this.show_code)return this.v},null,{allowed:!1});this.make_code_item(l,"mat3()");this.change_func=f}non_code_peval_self(){this.calc_mat()}non_code_eactive(a){for(let b of this.items)b.set_eactive(a)}save(){let a={};this.item_tx.save_to(a);this.item_ty.save_to(a);
this.item_r.save_to(a);this.item_pvx.save_to(a);this.item_pvy.save_to(a);this.item_sx.save_to(a);this.item_sy.save_to(a);this.save_code(a);return a}load(a){this.item_tx.load(a);this.item_ty.load(a);this.item_r.load(a);this.item_pvx.load(a);this.item_pvy.load(a);this.item_sx.load(a);this.item_sy.load(a);this.calc_mat();this.load_code(a)}calc_mat(){Qh.identity(this.v);Qh.translate(this.v,this.v,this.translate);this.b2_style||Qh.translate(this.v,this.v,this.rotate_pivot);Qh.rotate(this.v,this.v,Sh.toRadian(this.rotate));
Qh.translate(this.v,this.v,Ff.fromValues(-this.rotate_pivot[0],-this.rotate_pivot[1]));Qh.scale(this.v,this.v,this.scale);this.call_change();this.pset_dirty()}is_valid(){return!isNaN(this.v[0])&&!isNaN(this.v[1])&&!isNaN(this.v[2])&&!isNaN(this.v[3])&&!isNaN(this.v[4])&&!isNaN(this.v[5])&&!isNaN(this.v[6])&&!isNaN(this.v[7])&&!isNaN(this.v[8])}calc_pivot_counter(a,b){if(null===a)this.rotate_pivot[b]=null;else if(a=parseFloat(a),!isNaN(a)){var l=a-this.rotate_pivot[b];this.rotate_pivot[b]=a;this.b2_style||
(a=Ff.create(),a[b]=-l,l=Qh.create(),Qh.translate(l,l,a),Qh.rotate(l,l,Sh.toRadian(this.rotate)),a[b]=-a[b],Qh.translate(l,l,a),b=Ff.create(),Ff.transformMat3(b,b,l),this.item_tx.set_to_const(this.translate[0]+b[0]),this.item_ty.set_to_const(this.translate[1]+b[1]));this.calc_mat()}}add_elems(a){this.line_elem=Ng(a,this);this.single_line=Ng(this.line_elem);xg(this.single_line,!this.show_code);Ye(this.single_line,"hr","param_separator");a=Mg(this.single_line);Og(a,"Translate");this.item_tx.add_editbox(a);
this.item_ty.add_editbox(a);a=Mg(this.single_line);Og(a,"Rotate");this.item_r.add_editbox(a);a=Mg(this.single_line);Og(a,"Pivot");this.item_pvx.add_editbox(a);this.item_pvy.add_editbox(a);this.b2_style||(a=Mg(this.single_line),Og(a,"Scale"),this.item_sx.add_editbox(a),this.item_sy.add_editbox(a));this.add_code_elem()}move(a,b){this.item_tx.set_to_const(this.translate[0]+a);this.item_ty.set_to_const(this.translate[1]+b)}move_pivot(a,b){a=this.b2_style?Ff.fromValues(-a,-b):Ff.fromValues(a,b);b=Qh.create();
Qh.rotate(b,b,Sh.toRadian(-this.rotate));Ff.transformMat3(a,a,b);this.item_pvx.set_to_const(this.rotate_pivot[0]+a[0]);this.item_pvy.set_to_const(this.rotate_pivot[1]+a[1])}set_translate(a,b){this.item_tx.set_to_const(a);this.item_ty.set_to_const(b)}do_rotate(a){a=this.rotate+a;360<a&&(a-=360);0>a&&(a+=360);this.item_r.set_to_const(a)}set_scale(a,b){this.item_sx.set_to_const(a);this.item_sy.set_to_const(b)}draw_dial_at_obj(a,b){this.show_code||(a=Ff.clone(this.translate),this.b2_style||(a[0]+=this.rotate_pivot[0],
a[1]+=this.rotate_pivot[1]),Ff.transformMat3(a,a,b),this.dial.set_center(a[0],a[1]),this.dial.draw())}dyn_eval(){let a=Qh.create(),b=Ff.create();Qh.identity(a);b[0]=this.item_tx.dyn_eval();b[1]=this.item_ty.dyn_eval();Qh.translate(a,a,b);b[0]=this.item_pvx.dyn_eval();b[1]=this.item_pvy.dyn_eval();Qh.translate(a,a,b);Qh.rotate(a,a,Sh.toRadian(this.item_r.dyn_eval()));b[0]=-b[0];b[1]=-b[1];Qh.translate(a,a,b);b[0]=this.item_sx.dyn_eval();b[1]=this.item_sy.dyn_eval();Qh.scale(a,a,b);return a}need_input_evaler(a){for(let b of this.items){const l=
b.need_input_evaler(a);if(l)return l}return null}get_last_error(){for(let a of this.items){const b=a.get_last_error();if(b)return b}return null}get_value(){Id(null!==this.v,"value of transform expr not set");return this.v}modify(a,b=!0){Qh.exactEquals(a,this.v)||(Qh.copy(this.v,a),b&&this.pset_dirty())}gl_set_value(a){th.uniformMatrix3fv(a,!1,this.get_value())}}
class Th{constructor(a,b=null,l=null){this.on_move=a;this.on_start_drag=b||(()=>null);this.zc=null;this.get_translate=l}draw(a,b,l,e){null===l&&(l=Qh.create());this.obj_t_mat=l;if(null!==this.get_translate){const f=this.get_translate();a+=f[0];b+=f[1]}a=Ff.fromValues(a,b);Ff.transformMat3(a,a,l);Ff.transformMat3(a,a,e);this.zc={x:a[0]-10,y:a[1]-10,w:20,h:20};zd.beginPath();Uh(zd,Vh(this.zc));Wh(zd)}find_obj(a){if(null===this.zc||!Xh(a.ex,a.ey,this.zc))return null;const b=this.on_start_drag();return new Yh(null,
!0,!0,l=>{let e=Qh.clone(this.obj_t_mat);e[6]=0;e[7]=0;Qh.invert(e,e);let f=Ff.fromValues(l.dx,l.dy);Ff.transformMat3(f,f,e);this.on_move(f[0],f[1],b,l)})}}
class Kh extends Th{constructor(a){super((b,l,e,f)=>{f.shiftKey?(e.shadow_x+=2*b,e.shadow_y+=2*l,e.shadow_x<e.shadow_y?(b=e.shadow_x,l=b*e.start_yx_ratio):(l=e.shadow_y,b=l/e.start_yx_ratio),a.modify(Ff.fromValues(b,l))):a.increment(Ff.fromValues(2*b,2*l))},()=>({shadow_x:a.x,shadow_y:a.y,start_yx_ratio:a.y/a.x}));this.size_param=a}draw(a,b){super.draw(this.size_param.x/2,this.size_param.y/2,a,b)}}
class Yh{constructor(a,b,l,e=null){this.param=a;this.callback=e;this.do_x=b;this.do_y=l}mousedown(){}mouseup(){}mousemove(a){let b=a.dx,l=a.dy;this.do_x||(b=0);this.do_y||(l=0);null!==this.param?a.ctrlKey?this.param.move_pivot(b,l):this.param.move(b,l):this.callback(a);le(!0)}}
class Zh{constructor(a,b,l){this.param=a;this.cx=b;this.cy=l}mousedown(a){this.prev_angle=180*Math.atan2(a.ey-this.cy,a.ex-this.cx)/Math.PI}mouseup(){}mousemove(a){a=180*Math.atan2(a.ey-this.cy,a.ex-this.cx)/Math.PI;let b=a-this.prev_angle;180<b&&(b-=360);-180>b&&(b+=360);this.param.do_rotate(b);this.prev_angle=a;le(!0)}}function Uh(a,b){a.moveTo(b[0],b[1]);for(let l=2;l<b.length;l+=2)a.lineTo(b[l],b[l+1]);a.lineTo(b[0],b[1])}
function Wh(a){a.strokeStyle="#ffff00";a.lineWidth=3;a.stroke();a.lineWidth=1;a.strokeStyle="#ff0000";a.stroke()}function Vh(a){return[a.x,a.y,a.x+a.w,a.y,a.x+a.w,a.y+a.h,a.x,a.y+a.h]}function Xh(a,b,l){return a>=l.x&&b>=l.y&&a<=l.x+l.w&&b<=l.y+l.h}
class Rh{constructor(a){this.param=a;this.cy=this.cx=null;this.with_resize=!1;this.mv=null}set_center(a,b){this.cx=a;this.cy=b;this.mv={x:a-20,y:b-20,w:40,h:40};this.uab={x:this.cx-8,y:this.cy-25,bw:16,bh:20,tw:10,th:40};this.rab={x:this.cx+25,y:this.cy-8,bw:16,bh:20,tw:10,th:40};this.rot={r0:60,r1:75,a0:-.4*Math.PI,a1:-.1*Math.PI}}find_obj(a){if(this.param.show_code||null===this.mv)return null;var b=this.uab,l=this.rab;const e=this.rot;var f=a.ex;a=a.ey;if(Xh(f,a,this.mv))return new Yh(this.param,
!0,!0);if(f>=b.x&&f<=b.x+b.bw&&a>=b.y-b.th&&a<=b.y)return new Yh(this.param,!1,!0);if(f>=l.x&&f<l.x+l.th&&a>=l.y&&a<=l.y+l.bw)return new Yh(this.param,!0,!1);b=f-this.cx;l=a-this.cy;b=Math.sqrt(b*b+l*l);f=Math.atan2(a-this.cy,f-this.cx);return b>=e.r0&&b<=e.r1&&f>=e.a0&&f<=e.a1?new Zh(this.param,this.cx,this.cy):null}draw(){zd.beginPath();const a=this.uab,b=this.rab,l=this.rot;Uh(zd,Vh(this.mv));Uh(zd,[a.x,a.y,a.x,a.y-a.bh,a.x-a.tw,a.y-a.bh,this.cx,a.y-a.th,a.x+a.tw+a.bw,a.y-a.bh,a.x+a.bw,a.y-a.bh,
a.x+a.bw,a.y]);Uh(zd,[b.x,b.y,b.x+b.bh,b.y,b.x+b.bh,b.y-b.tw,b.x+b.th,this.cy,b.x+b.bh,b.y+b.tw+b.bw,b.x+b.bh,b.y+b.bw,b.x,b.y+b.bw]);zd.moveTo(this.cx+l.r1*Math.cos(l.a0),this.cy+l.r1*Math.sin(l.a0));zd.arc(this.cx,this.cy,l.r0,l.a0,l.a1);zd.arc(this.cx,this.cy,l.r1,l.a1,l.a0,!0);Wh(zd)}}function $h(a){let b=new a.constructor;for(let l of a)void 0!==l&&b.push(l);return b}
class ai extends wg{constructor(a,b,l,e,f,h=null){super(a,b);this.values_per_entry=l;this.lst_type=f;this.lst=new f;this.elem_lst=null;this.table=e;this.column_key=e.register(this);this.def_val=null!==h?h:bi(b,l);this.allow_title_edit=!1}add_elems(){}save(){return{lst:this.lst}}load(a){Array.isArray(this.lst)?this.lst=a.lst:this.lst=new this.lst_type(a.lst)}get_def_val(){return this.def_val}add(a){var b=a;if(Array.isArray(a)||ArrayBuffer.isView(a)||"number"==typeof a){void 0===a.length&&(b=[a]);console.assert(b.length==
this.values_per_entry,"Unexpected number of values");var l=new this.lst_type(this.lst.length+b.length);l.set(this.lst);l.set(b,this.lst.length);this.lst=l}else this.lst.push(a);this.pset_dirty(null===this.table);b=this.lst.length-this.values_per_entry;l=this.table.get_column_elem(this.column_key);null!==l&&this.create_entry_elems(a,l,b)}count(){return this.lst.length/this.values_per_entry}get_value(a){Id(void 0!==a,"unexpected vindex undefined");let b=[];if(1<this.values_per_entry)for(let l=0;l<this.values_per_entry;++l)b[l]=
this.lst[a+l];else b=this.lst[a];return b}for_values(a){for(let b=0;b<this.lst.length;b+=this.values_per_entry)a(this.get_value(b),b)}add_column_elems(a){this.elem_lst=[];this.for_values((b,l)=>{this.create_entry_elems(b,a,l)})}get_column_title(){return this.label}set_column_title(a){this.label=a}create_entry_elems(a,b,l){void 0!==this.create_elem?l=this.create_elem(b,a,l/this.values_per_entry,(e,f,h)=>{f*=this.values_per_entry;if(void 0===h)for(console.assert(e.length==this.values_per_entry,"unexpected length of value"),
h=0;h<this.values_per_entry;++h)this.lst[f+h]=e[h];else console.assert(void 0===e.length,"unexpected length existing"),this.lst[f+h]=e;this.pset_dirty();le(!0)},e=>this.get_value(e*this.values_per_entry)):(l=this.get_clss?this.get_clss(l/this.values_per_entry):[this.elem_prm.cls],l=Cd(l),l.innerText=this.to_string(a),b.appendChild(l));this.elem_lst.push(l);return l}remove(a){let b=Array.from(this.lst);var l=b.length;for(let e of a){a=e*this.values_per_entry;console.assert(a<this.lst.length,"remove out of range");
for(let f=0;f<this.values_per_entry;++f)delete b[a+f];l-=this.values_per_entry;null!==this.elem_lst&&(this.elem_lst[e].remove(),delete this.elem_lst[e])}this.lst=new this.lst.constructor(l);l=0;for(let e of b)void 0!==e&&(this.lst[l++]=e);this.pset_dirty();null!==this.elem_lst&&(this.elem_lst=$h(this.elem_lst),this.reprint_all_lines(),console.assert(this.lst.length==this.elem_lst.length*this.values_per_entry,"unexpected number of elements"))}clear(){this.lst=new this.lst.constructor;null!==this.elem_lst&&
(this.elem_lst=[])}reprint_line(a,b){if(null!==this.elem_lst&&0!=this.elem_lst.length){a/=this.values_per_entry;var l=this.elem_lst[a];this.external_update?this.external_update(l,b,a):(this.get_clss&&(l.classList=this.get_clss(a).join(" ")),l.innerText=this.to_string(b))}}reprint_all_lines(){this.for_values((a,b)=>{this.reprint_line(b,a)})}modify(a,b){if(1<this.values_per_entry){console.assert(b.length==this.values_per_entry,"Unexpected number of values");a*=this.values_per_entry;console.assert(a<
this.lst.length,"modify out of range");for(let l=0;l<b.length;++l)this.lst[a+l]=b[l];this.reprint_line(a,b)}else console.assert(void 0===b.length,"Unexpected list"),this.lst[a]=b,this.reprint_line(a,this.lst[a]);this.pset_dirty()}increment(a,b){if(1<this.values_per_entry){console.assert(b.length==this.values_per_entry,"Unexpected number of values");a*=this.values_per_entry;console.assert(a<this.lst.length,"modify out of range");for(let l=0;l<b.length;++l)this.lst[a+l]+=b[l];this.reprint_line(a,this.lst.slice(a,
a+this.values_per_entry))}else console.assert(void 0===v.length,"Unexpected list"),this.lst[a]+=b,this.reprint_line(a,this.lst[a]);this.pset_dirty()}}
class ci extends ai{constructor(a,b,l,e,f,h,g=null){super(a,b,h,l,e);this.edit_wrap=null;this.selected_indices=f;this.changed_func_to_node=g}external_update(a,b,l){let e="param_monospace param_lst_clickable",f=!1;null!==this.selected_indices&&(f=void 0!==this.selected_indices.includes_shifted?this.selected_indices.includes_shifted(l):this.selected_indices.includes(l));f&&(e+=" param_list_selected_line");a.classList=e;a.innerText=this.to_string(b);a.p_lst_index=l}create_elem(a,b,l,e,f){let h=Ce(a,
"");this.external_update(h,b,l);Le(h,"click",()=>{let g=f(h.p_lst_index);null!==this.edit_wrap&&this.edit_wrap.parentNode.removeChild(this.edit_wrap);this.edit_wrap=Cd("param_lst_coord_edit_wrap");for(let m=0;m<this.values_per_entry;++m)Sg(this.edit_wrap,1==this.values_per_entry?g:g[m],0,q=>{e(q,h.p_lst_index,m);this.external_update(h,f(h.p_lst_index),h.p_lst_index);this.changed_func_to_node&&this.changed_func_to_node()},"param_lst_edit_popup_input",()=>{this.dismiss_edit_wrap()});Lf("mousedown",
this.edit_wrap);h.parentNode.insertBefore(this.edit_wrap,h.nextSibling);Cg(this.owner,()=>{this.dismiss_edit_wrap()})});return h}dismiss_edit_wrap(){null!==this.edit_wrap&&(this.edit_wrap.parentNode.removeChild(this.edit_wrap),this.edit_wrap=null)}add_elems(a){super.add_elems(a)}}window.ParamCoordList=class extends ci{constructor(a,b,l,e=null){super(a,b,l,di,e,2);this.pneed_normalize=!1}to_string(a){return"("+a[0].toFixed(3)+","+a[1].toFixed(3)+")"}};
window.ParamFloatList=class extends ci{constructor(a,b,l,e=null,f=null){super(a,b,l,Float32Array,e,1,f);this.pneed_normalize=!1}to_string(a){return a.toFixed(3)}};function ei(a){return[a.r,a.g,a.b,a.alphai]}
window.ParamColorList=class extends ai{constructor(a,b,l){super(a,b,4,l,fi,gi.arr);this.pneed_normalize=!0}external_update(a,b,l){a.p_lst_index=l}create_elem(a,b,l,e){a=Ce(a,"col_elem_wrap");let [,f]=jh(a,{r:b[0],g:b[1],b:b[2],alpha:b[3]/255,alphai:b[3]},"param_table_input_color",function(h){e(ei(h),f.p_lst_index)});f.p_lst_index=l;return f}};
class Oi extends wg{constructor(a,b,l=null){super(a,b);this.list_params={};this.elem_cols=null;this.elem_visible=!0;this.with_index_column=!1;this.with_column_sep=!0;this.with_column_title=!1;this.on_remove_column=null;this.sorted_order=l;this.title_edit_wrap=null;this.next_key=0}register(a){const b=this.next_key++;this.list_params[b]=a;return b}get_column_elem(a){if(null===this.elem_cols||!this.visible)return null;console.assert(void 0!==this.list_params[a],"column index too high");return this.elem_cols[a]}del_column(a,
b){delete this.list_params[a];null!==this.elem_cols&&delete this.elem_cols[a];b&&this.remake_table()}save(){return null}load(){}add_elems(a){this.line_elem=Ce(a,"param_block");this.with_index_column?Og(this.line_elem,this.label_display):(this.label_elem=Ce(this.line_elem,"param_list_title"),this.label_elem.innerText=this.label_display+":");this.table_elem=Ce(this.line_elem,"param_list_body");this.visible&&this.make_table()}remake_table(){if(null!==this.line_elem&&this.visible){var a=this.table_elem;
let b=a.cloneNode(!1);a.parentNode.replaceChild(b,a);this.table_elem=b;this.make_table()}}make_table(){this.elem_cols={};const a=this.with_column_sep?["param_table_column","param_table_col_line"]:"param_table_column";if(this.with_index_column&&0<Object.keys(this.list_params).length){var b=Cd(a),l=Object.values(this.list_params)[0].count();for(var e=0;e<l;++e)Ce(b,"param_lst_order_idx").innerText=e+".";this.table_elem.appendChild(b)}for(let f in this.list_params){l=this.list_params[f];b=Cd(a);this.elem_cols[f]=
b;l.add_column_elems(b);if(null!==this.sorted_order){e=b;b=Cd(a);let h=[];for(let g of e.childNodes)h.push(g);for(let g of this.sorted_order)b.appendChild(h[g])}this.with_column_title&&this.add_column_title(b,l);this.table_elem.appendChild(b);l=Ce(b,"param_table_grip");Pi(l,b)}}add_column_title(a,b){const l=Cd("param_table_col_title");l.innerText=b.get_column_title();a.insertBefore(l,a.firstChild);null!==this.on_remove_column&&yh(this.owner,l,[{text:"Remove Column",func:()=>{this.on_remove_column(b)}}]);
b.allow_title_edit&&Le(l,"click",()=>{null!==this.title_edit_wrap&&this.title_edit_wrap.parentNode.removeChild(this.title_edit_wrap);this.title_edit_wrap=Cd("param_table_title_edit_wrap");Sg(this.title_edit_wrap,b.get_column_title(),2,e=>{b.set_column_title(e);l.innerText=e;this.pset_dirty()},"param_table_title_edit_input",()=>{this.dismiss_title_edit()});this.title_edit_wrap.style.width=l.getBoundingClientRect().width+"px";Lf("mousedown",this.title_edit_wrap);a.insertBefore(this.title_edit_wrap,
l.nextSibling);Cg(this.owner,()=>{this.dismiss_title_edit()})})}dismiss_title_edit(){null!==this.title_edit_wrap&&(this.title_edit_wrap.parentNode.removeChild(this.title_edit_wrap),this.title_edit_wrap=null)}}function Pi(a,b){let l=null,e=null;Fe(a,(f,h,g)=>{e=l+g;b.style.width=e+"px"},f=>{l=parseFloat(window.getComputedStyle(b).width)-f})}const Qi=ace.require("ace/range").Range;
class Dh{constructor(a,b,l,e){this.elem_wrapper=Ce(a,"panel_param_editor_wrap");this.elem=a=Ce(this.elem_wrapper,"panel_param_text_area");this.opt=e;this.parentElem=a.parentElement;this.editor=ace.edit(a);this.editor.setShowPrintMargin(!1);if("glsl"==e.lang){const f=ace.require("ace/mode/glsl").Mode;this.editor.session.setMode(new f)}this.editor.setTheme("ace/theme/tomorrow_night_bright");this.editor.setBehavioursEnabled(!1);this.editor.commands.removeCommand("find");this.editor.setValue(b,1);this.editor.on("change",
Ri(f=>{"remove_in_insert"!==f.add_inf&&l(this.editor.getValue())}),"editor-change");this.editor.on("paste",f=>{f.text=f.text.replace(/\t/g,"    ")});this.err_elem=Ce(a,"prm_text_err");this.err_elem.style.display="none";this.err_elem_visible=!1;this.errors=null;this.editor.getSelection().on("changeCursor",()=>{this.update_err_elem()});this.marker_ids=[];this.show_errors();this.popout_elems=this.dlg=null;this.ppgrip=Ce(this.elem_wrapper,"panel_param_editor_resize_grip");Fe(this.ppgrip,(f,h)=>{f=window.getComputedStyle(this.elem_wrapper);
h=Math.max(parseInt(f.height)+h,35);this.elem_wrapper.style.height=h+"px";void 0!==this.opt.dlg_rect_wrap&&(null===this.opt.dlg_rect_wrap.panel_rect&&(this.opt.dlg_rect_wrap.panel_rect={height:null}),this.opt.dlg_rect_wrap.panel_rect.height=h);this.editor.resize()});void 0!==this.opt.dlg_rect_wrap&&null!==this.opt.dlg_rect_wrap.panel_rect&&(this.elem_wrapper.style.height=this.opt.dlg_rect_wrap.panel_rect.height+"px");if(e.with_popout){const [f,h]=kh(this.elem_wrapper,"[]",!1,g=>{this.pop_out(g)});
h.classList.add("prm_code_popout_btn");this.popout_elems={ein:f,btn:h};void 0!==this.opt.dlg_rect_wrap&&null!==this.opt.dlg_rect_wrap.dlg_rect&&1==this.opt.dlg_rect_wrap.dlg_rect.visible&&this.pop_out(!0)}}pop_out(a){null===this.dlg&&(this.dlg=We(this.parentElem,this.opt.dlg_title,!0,this.opt.dlg_rect_wrap.dlg_rect,b=>{this.pop_out(b)},()=>{this.resize()}),this.dlg.elem.classList.add("dlg_size_shader_edit"),this.opt.dlg_rect_wrap.dlg_rect=this.dlg.rect);a?(this.dlg.dset_visible(!0),this.dlg.client.appendChild(this.elem)):
(this.dlg.dset_visible(!1),this.parentElem.appendChild(this.elem));this.elem.classList.toggle("dlg_param_text_area",a);this.elem.classList.toggle("panel_param_text_area",!a);this.elem_wrapper.classList.toggle("panel_param_ed_minimized",a);this.ppgrip.classList.toggle("panel_param_editor_resize_grip_hidden",a);this.popout_elems.btn.classList.toggle("prm_code_popout_btn",!a);this.popout_elems.btn.classList.toggle("prm_code_popin_btn",a);this.popout_elems.ein.checked=a;this.editor.resize(!0)}set_title(a){null!==
this.dlg&&this.dlg.set_title(a);this.opt.dlg_title=a}update_err_elem(){var a=this.editor.getSelection().getCursor().row+1;if(null!==this.errors&&(a=this.errors[a],void 0!==a)){this.err_elem.innerText=a.text;this.err_elem.style.display="";this.err_elem_visible=!0;return}this.err_elem_visible&&(this.err_elem.innerText="",this.err_elem.style.display="none",this.err_elem_visible=!1)}show_errors(){for(var a of this.marker_ids)this.editor.session.removeMarker(a);if(null!==this.errors&&0!=this.errors.length)for(let b in this.errors)a=
this.errors[b],a.row=b-1,a.type="error",this.marker_ids.push(this.editor.session.addMarker(new Qi(a.row,0,a.row,1),"editor_error_marker","fullLine"));this.update_err_elem()}set_errors(a){this.errors=a;this.show_errors()}set_value(a){this.editor.setValue(a,1)}show_err(a){this.set_errors({[a.line]:{text:a.msg}})}clear_err(){this.set_errors({})}get_elem(){return this.elem}resize(){this.editor.resize()}}
class Si extends wg{constructor(a,b,l,e){super(a,b);this.text_input=this.dlg=null;this.dlg_rect_wrap={dlg_rect:null,panel_rect:null};this.v=l;this.change_func=e;a.register_rename_observer(()=>{this.editor.set_title(this.title())});this.last_errors=this.editor=null}save(){const a={text:this.v};null!==this.dlg_rect_wrap.dlg_rect&&(a.dlg_rect=this.dlg_rect_wrap.dlg_rect);null!==this.dlg_rect_wrap.panel_rect&&(a.panel_rect=this.dlg_rect_wrap.panel_rect);return a}load(a){this.v=a.text;this.dlg_rect_wrap.dlg_rect=
a.dlg_rect||null;this.dlg_rect_wrap.panel_rect=a.panel_rect||null}title(){return this.owner.name+" - "+this.label.replace("\n"," ")}set_text(a,b=!0){this.v!==a&&(this.v=a,this.pset_dirty(b),this.call_change(),null!==this.editor&&this.editor.set_value(this.v))}add_elems(a){this.line_elem=Mg(a,this);this.label_elem=Og(this.line_elem,this.label_display);this.editor=new Dh(this.line_elem,this.v,b=>{this.v=b;this.pset_dirty();this.call_change()},{lang:"glsl",dlg_title:this.title(),dlg_rect_wrap:this.dlg_rect_wrap,
with_popout:!0});this.editor.set_errors(this.last_errors)}set_errors(a){this.last_errors=a;null!==this.editor&&this.editor.set_errors(a)}get_errors(){return this.last_errors}}
class Ti extends wg{constructor(a,b,l,e,f=null){super(a,b);if(Array.isArray(e[0])){this.opts=[];this.opt_vals=[];for(let h of e)this.opts.push(h[0]),this.opt_vals.push(h[1])}else this.opts=e,this.opt_vals=null;this.sel_idx=this.init_sel=l;this.change_func=f}save(){return{sel_str:this.opts[this.sel_idx]}}load(a){this.sel_idx=this.opts.indexOf(a.sel_str);-1===this.sel_idx&&(this.sel_idx=this.init_sel)}add_elems(a){this.line_elem=Mg(a,this);this.label_elem=Og(this.line_elem,this.label_display);lh(this.line_elem,
this.opts,this.sel_idx,b=>{this.sel_idx=b;this.call_change();this.pset_dirty()})}call_change(){this.change_func&&this.change_func(this.sel_idx)}get_sel_name(){return this.opts[this.sel_idx].toLowerCase()}get_sel_val(){return null===this.opt_vals?null:this.opt_vals[this.sel_idx]}}
class Ui extends wg{constructor(a,b){super(a,b);this.upload_progress_elem=this.remote_url_elem=this.remote_url=this.file=null}save(){return{rurl:this.remote_url}}load(a){this.remote_url=a.rurl;null!==this.remote_url&&""!=this.remote_url.trim()&&this.load_url(this.remote_url)}add_elems(a){this.line_elem=Mg(a);this.label_elem=Og(this.line_elem,this.label_display);Kf(this.line_elem,["param_btn","param_file_choose_btn"],"Choose File...",f=>{this.file=f;e.textContent=this.file.name;this.read_file(this.file,
!0,(h,g)=>{this.load_url(g)});b.style.display=""});let b=Pf(this.line_elem,"Upload",()=>{this.read_file(this.file,!1,(f,h)=>{this.upload_to_imgur(f.type,h)})}),l=Ce(this.line_elem,"param_file_show_parent"),e=Ce(l,"param_file_show");null!==this.file?e.textContent=this.file.name:b.style.display="none";this.upload_progress_elem=Ye(l,"progress","param_file_progress");this.upload_progress_elem.max=100;this.upload_progress_elem.value=0;a=Mg(a);Og(a,"Url");this.remote_url_elem=Sg(a,this.remote_url,2,f=>
{this.remote_url=f;this.file=null;this.filename_show="";this.load_url(f)});this.remote_url_elem.classList.add("param_input_long")}read_file(a,b,l){let e=new FileReader;e.onload=f=>{l(a,f.target.result)};e.onerror=f=>{console.error(f)};b?e.readAsDataURL(a):e.readAsArrayBuffer(a)}upload_to_imgur(a,b,l=!1){const e=new XMLHttpRequest;e.onload=()=>{console.log(e.responseText);this.upload_progress_elem.style.display="none";let f=JSON.parse(e.responseText);if(1!=f.success||200!=f.status){if(400===f.status&&
!l){var h=b.byteLength+8+40;if(30<a.length)h=null;else{var g=Math.round(h/128/3)+2;Gf.width=128;Gf.height=g;g=Bd.getImageData(0,0,128,g);var m=g.data,q=new DataView(m.buffer);q.setUint32(0,1633838079);q.setUint32(4,b.byteLength<<8|255);q=8;for(var r=0;30>r;)m[q++]=a.charCodeAt(r++),3==q%4&&(m[q++]=255);var B=b.byteLength,D=new Uint8Array(b);for(r=0;r<B;)m[q++]=D[r++],m[q++]=D[r++],m[q++]=D[r++],m[q++]=255;Bd.putImageData(g,0,0);g=Gf.toDataURL("image/png");m=g.indexOf(",");g=g.substr(m+1);g=atob(g);
m=g.length;q=new Uint8Array(m);for(r=0;r<m;r++)q[r]=g.charCodeAt(r);console.log("data-len=",h," encodede-len=",m);h=q}this.upload_to_imgur("image/png",h,!0)}console.error("Failed upload, "+f.status)}else this.remote_url=f.data.link,this.remote_url_elem.value=this.remote_url,ue()};e.onprogress=f=>{0!=f.total&&(this.upload_progress_elem.value=f.loaded/f.total*100)};e.upload&&(e.upload.onprogress=e.onprogress);e.onerror=f=>{console.error("Failed req ",f);this.upload_progress_elem.style.display="none"};
this.upload_progress_elem.value=0;this.upload_progress_elem.style.display="initial";e.open("POST","https://api.imgur.com/3/image",!0);e.setRequestHeader("Authorization","Client-ID 559401233d3e1e6");e.setRequestHeader("Accept","application/json");e.setRequestHeader("Content-Type",a);console.log("Uploading ",a," len:",b.byteLength);e.send(b)}}
class Vi extends Ui{constructor(a,b){super(a,b);this.ilast_error=this.image=null}load_url(a){this.image=this.ilast_error=null;let b=new Image;Le(b,"load",()=>{this.ilast_error=null;Gf.width=b.width;Gf.height=b.height;Bd.drawImage(b,0,0);var l=Bd.getImageData(0,0,b.width,b.height);var e=new DataView(l.data.buffer);if(1633838079!==e.getUint32(0))e=null;else{e=(e.getUint32(4)>>8)+30;var f="";l=l.data;for(var h=8,g=0;g<e;)f+=String.fromCharCode(l[h++]),f+=String.fromCharCode(l[h++]),f+=String.fromCharCode(l[h++]),
++h,g+=3;for(l=f.substr(0,30);0==l.charCodeAt(l.length-1);)l=l.substr(0,l.length-1);f=f.substr(30,e-30);e="data:"+l+";base64,"+btoa(f)}null!==e?b.src=e:(this.image=b,this.pset_dirty())},1);Le(b,"error",l=>{this.ilast_error="Failed download image from URL";console.error("Failed to download image",l);this.image=null;this.pset_dirty()},1);b.crossOrigin="";b.src=a;this.image=b}get_image(){Sd(null!==this.image,this.owner.cls,null!==this.ilast_error?this.ilast_error:"Image not loaded yet");return this.image}try_get_image(){return this.image}}
class Wi extends wg{constructor(a,b,l,e=null){super(a,b);this.onclick=l;this.cls=e}save(){return null}load(){}add_elems(a){this.line_elem=Mg(a,this);this.is_sharing_line_elem()||Og(this.line_elem,null);Pf(this.line_elem,this.label_display,this.onclick,this.cls)}}
class Xi extends wg{constructor(a,b){super(a,b)}save(){return null}load(){}add_elems(a){this.line_elem=Mg(a,this);this.line_elem.classList.toggle("param_line_group",!0);this.add_sub_params()}add_sub_params(){var a=[];for(var b of this.owner.parameters)null!==b.group_param&&Object.is(b.group_param,this)&&a.push(b);if(void 0!==this.owner.cls.get_sorted_labels){const l=this.owner.cls.get_sorted_labels(this);if(null!==l){Id(l.length===a.length,"wrong size of sorted_order");b={};for(let e of a)b[e.label]=
e;for(let e of l)a=b[e],Id(void 0!==a,"can't find param label "+e),a.add_elems(null),a.init_enable_visible();a=null}}if(null!==a)for(let l of a)l.add_elems(null),l.init_enable_visible()}update_elems(){if(null!==this.line_elem){for(;this.line_elem.firstChild;)this.line_elem.removeChild(this.line_elem.firstChild);this.add_sub_params();yg(this.owner.parameters)}}}
class Yi extends wg{constructor(a,b,l,e,f,h,g){super(a,b);this.opts=l;this.make_elem_func=e;this.set_selected_func=f;this.cls_menu=h;this.cls_item=g;this.menu_elem=null}save(){return null}load(){}add_elems(a){this.line_elem=Mg(a,this);this.is_sharing_line_elem()||Og(this.line_elem,null);const b=()=>{null!==this.menu_elem&&(this.menu_elem.parentElement.removeChild(this.menu_elem),this.menu_elem=null);l.checked=!1},[l,e]=kh(this.line_elem,this.label,!1,f=>{if(f){this.menu_elem=Ce(this.line_elem,this.cls_menu);
this.menu_elem.style.top=e.offsetTop+e.offsetHeight+2+"px";this.menu_elem.style.left=e.offsetLeft+"px";f=0;for(let h of this.opts){const g=Ce(this.menu_elem,this.cls_item);this.make_elem_func(h,g);const m=f;Le(g,"mousedown",()=>{this.set_selected_func(h,m);b()});++f}Cg(this.owner,()=>{b()})}else b()});e.addEventListener("mousedown",f=>{f.stopPropagation()})}}class Zi extends Yi{constructor(a,b,l,e,f){super(a,b,l,e,f,"param_img_menu","param_img_item")}}
class $i extends Yi{constructor(a,b,l,e){super(a,b,l,(f,h)=>{h.innerText=f},e,"param_text_menu","param_text_item")}}const aj={vtx_radius:5,vtx_sel_radius:7,sel_color:"#FFBB55",line_width:.5},gi={hex:"#cccccc",rgb:"rgb(204,204,204)",rgba:"rgba(204,204,204,1.0)",arr:[204,204,204,255]};let di=Float32Array,bj=Uint32Array,fi=Uint8Array;function cj(a){a=a.toLowerCase().replace(/\s/g,"_");return"point_color"==a?"vtx_color":"coord"==a?"vtx_pos":a}
function dj(a){switch(a){case 0:return"Not-Set";case 1:return"Quads";case 2:return"Triangles";case 3:return"Points";default:return"<unknown:"+a+">"}}class ej{constructor(a,b,l,e){this.min_x=a;this.min_y=b;this.max_x=l;this.max_y=e}width(){return this.max_x-this.min_x}height(){return this.max_y-this.min_y}center(){return[(this.min_x+this.max_x)/2,(this.min_y+this.max_y)/2]}}class fj{constructor(a){this.obj_proxy=a;this.clip_path=null}}
function gj(a){const b=[];for(let l of a)null===l?b.push(null):b.push(new fj(l.obj_proxy));return b}class hj{constructor(a,b,l){this.mesh=a;this.name=b;this.type=l}computed_value(a){return this.mesh[this.name](a)}computed_type(){return this.type}}
class ij extends yd{static name(){return"Mesh"}constructor(){super();this.type=0;this.paths=null;this.arrs={vtx_pos:null,idx:null};this.meta={vtx_pos:null,idx:null};this.consts={};this.tcache={vtx_pos:null,m:null};this.glbufs={vtx_pos:null,idx:null};this.fill_objs=[null];this.points_idx_cache=this.effective_vtx_pos=this.clipper_obj=this.paper_obj=null}destructor(){for(let a in this.glbufs){let b=this.glbufs[a];b&&th.deleteBuffer(b)}}oclone(){const a=new ij;a.type=this.type;a.paths=null;a.arrs=Kd(this.arrs);
a.meta=Kd(this.meta);a.consts=Kd(this.consts);a.tcache={vtx_pos:null,m:null};a.glbufs={vtx_pos:null,idx:null};a.fill_objs=Kd(this.fill_objs);a.paper_obj=null;a.clipper_obj=null;a.effective_vtx_pos=this.effective_vtx_pos===this.arrs.vtx_pos?a.arrs.vtx_pos:Kd(this.effective_vtx_pos);a.points_idx_cache=null;return a}forVec2Arrs(a){for(let b in this.arrs)b.startsWith("vtx_")&&"vtx_pos"!==b&&2===this.meta[b].num_elems&&a(b,this.arrs[b])}get_disp_params(a){const b=[new vh(a,"Show Vertices","show_vtx",!0)];
void 0!==this.arrs.idx&&null!==this.arrs.idx&&0<this.arrs.idx.length&&b.push(new vh(a,"Show Lines","show_lines",!0));void 0===this.arrs.face_color&&void 0===this.consts.face_color&&void 0===this.arrs.face_fill||b.push(new vh(a,"Show Faces","show_faces",!0));this.forVec2Arrs(l=>{const e=new vh(a,"Show "+l,"show_"+l,!0);l=new Ih(a,"Scale","scale_"+l,1);l.share_line_elem_from(e);b.push(e,l)});return b}invalidate_pos(){this.tcache.vtx_pos=null;null!==this.meta.vtx_pos&&(this.meta.vtx_pos.made_glbuf=!1);
this.points_idx_cache=this.clipper_obj=this.paper_obj=this.paths=null;this.make_effective_vtx_pos();this.invalidate_fill()}invalidate_fill(){for(let a of this.fill_objs)null!==a&&(a.clip_path=null)}make_effective_vtx_pos(){this.effective_vtx_pos=this.arrs.vtx_pos;void 0!==this.arrs.vtx_transform&&this.transform_per_vtx();void 0!==this.arrs.face_transform&&this.transform_per_face()}set(a,b,l,e){a=cj(a);this.arrs[a]=b;this.meta[a]={made_glbuf:!1,num_elems:l||1,need_normalize:e||!1};"vtx_pos"==a?this.invalidate_pos():
"face_transform"==a?this.unshare_vertices_between_faces():"vtx_transform"==a?this.make_effective_vtx_pos():"face_fill"==a&&this.invalidate_fill()}set_const(a,b){this.consts[a]=b}set_type(a){this.type=a;this.invalidate_pos()}vtx_count(){return this.arrs.vtx_pos.length/2}face_count(){if(null===this.arrs.idx||void 0===this.arrs.idx){if(3==this.type)return this.vtx_count();Id(!1,"expected idx")}return this.arrs.idx.length/this.face_size()}face_size(){switch(this.type){case 2:return 3;case 1:return 4;
case 3:return 1;default:Id(!1,"face_size: type not set")}}has_idx(){return null!==this.arrs.idx&&void 0!==this.arrs.idx}static transform_arr(a,b,l){for(let e=0;e<b.length;e+=2){let f=b[e],h=b[e+1];l[e]=a[0]*f+a[3]*h+a[6];l[e+1]=a[1]*f+a[4]*h+a[7]}}transform(a){ij.transform_arr(a,this.arrs.vtx_pos,this.arrs.vtx_pos);this.invalidate_pos()}transform_per_vtx(){const a=this.arrs.vtx_pos,b=this.arrs.vtx_transform;Id(b.length/6===a.length/2,"unexpect length of vtx_transform");if(null===this.effective_vtx_pos||
this.effective_vtx_pos===this.arrs.vtx_pos||this.effective_vtx_pos.length!=a.length)this.effective_vtx_pos=new di(a.length);const l=this.effective_vtx_pos;for(let e=0,f=0;e<l.length;e+=2,f+=6){let h=a[e],g=a[e+1];l[e]=b[f]*h+b[f+2]*g+b[f+4];l[e+1]=b[f+1]*h+b[f+3]*g+b[f+5]}}transform_per_face(){const a=this.effective_vtx_pos,b=this.arrs.face_transform;Id(b.length/6===this.face_count(),"unexpect length of face_transform");if(null===this.effective_vtx_pos||this.effective_vtx_pos===this.arrs.vtx_pos||
this.effective_vtx_pos.length!=a.length)this.effective_vtx_pos=new di(a.length);const l=this.effective_vtx_pos,e=this.face_size(),f=this.arrs.idx;for(let h=0,g=0;h<f.length;h+=e,g+=6)for(let m=0;m<e;++m){const q=2*f[h+m];let r=a[q],B=a[q+1];l[q]=b[g]*r+b[g+2]*B+b[g+4];l[q+1]=b[g+1]*r+b[g+3]*B+b[g+5]}}unshare_vertices_between_faces(){const a=this.arrs.idx;for(var b in this.arrs){if(!b.startsWith("vtx_"))continue;var l=this.arrs[b];const e=this.meta[b].num_elems,f=new l.constructor(a.length*e);let h=
0;for(let g=0;g<a.length;++g){const m=a[g];for(let q=0;q<e;++q)f[h*e+q]=l[m*e+q];++h}this.arrs[b]=f}b=0;for(l=0;l<a.length;++l)a[l]=b++;this.invalidate_pos()}computed_prop(a){return"face_center"===a?new hj(this,a,12):null}face_center(a){const b=this.face_size(),l=this.arrs.idx;let e=this.effective_vtx_pos,f=0,h=0;for(let g=0;g<b;++g){const m=2*l[a*b+g];f+=e[m];h+=e[m+1]}return Ff.fromValues(f/b,h/b)}get_bbox(){let a=this.effective_vtx_pos;if(0==a.length)return null;let b=Number.MAX_VALUE,l=-Number.MAX_VALUE,
e=Number.MAX_VALUE,f=-Number.MAX_VALUE;for(let h=0;h<a.length;h+=2){let g=a[h],m=a[h+1];g<b&&(b=g);g>l&&(l=g);m<e&&(e=m);m>f&&(f=m)}return new ej(b,e,l,f)}is_point_inside(a,b){this.ensure_paths_created();for(let l of this.paths)if(zd.isPointInPath(l,a,b))return!0;return!1}draw_border(a){let b=this.get_bbox();zd.save();sd(zd,a);zd.strokeStyle="#000";zd.lineWidth=aj.line_width/rf.viewport_zoom;zd.strokeRect(b.min_x,b.min_y,b.max_x-b.min_x,b.max_y-b.min_y);zd.restore()}draw_vertices(a="#000",b=!0,l=
null){let e=this.effective_vtx_pos;if(null!==e){var f=null;void 0!==this.arrs.vtx_radius&&(f=this.arrs.vtx_radius,Id(f.length==this.arrs.vtx_pos.length/2,"unexpected size of vtx_radius"));var h=void 0!==this.consts.vtx_radius?this.consts.vtx_radius:aj.vtx_radius,g=void 0!==this.arrs.vtx_color,m=void 0!==this.consts.vtx_color;if(b&&(g||m)){g?(b=this.arrs.vtx_color,Id(b.length/4==this.arrs.vtx_pos.length/2,"unexpected size of vtx_color")):b=this.consts.vtx_color;for(let q=0,r=0,B=0;r<e.length;++q,r+=
2)m=Math.max(0,null!==f?f[q]:h),m/=rf.viewport_zoom,zd.beginPath(),zd.arc(e[r],e[r+1],m,0,2*Math.PI),zd.fillStyle="rgba("+b[B]+","+b[B+1]+","+b[B+2]+","+b[B+3]/255+")",zd.fill(),g&&(B+=4);zd.lineWidth=aj.line_width/rf.viewport_zoom}else zd.lineWidth=1/rf.viewport_zoom;zd.beginPath();for(let q=0,r=0;r<e.length;++q,r+=2)g=Math.max(0,null!==f?f[q]:h),g/=rf.viewport_zoom,b=e[r],m=e[r+1],zd.moveTo(b+g,m),zd.arc(b,m,g,0,2*Math.PI);zd.strokeStyle=a;zd.stroke();null!==l&&this.forVec2Arrs((q,r)=>{if(l["show_"+
q]){var B=l["scale_"+q];Id(r.length==this.arrs.vtx_pos.length,"unexpected size of attribute "+q);zd.beginPath();for(q=0;q<e.length;q+=2)zd.moveTo(e[q],e[q+1]),zd.lineTo(e[q]+r[q]*B,e[q+1]+r[q+1]*B);zd.lineWidth=aj.line_width/rf.viewport_zoom;zd.strokeStyle="#ff0000";zd.stroke()}})}}ensure_paths_created(){if(null===this.arrs.idx)this.paths=[];else if(null===this.paths||this.paths.length*this.face_size()!=this.arrs.idx.length){var a=this.effective_vtx_pos,b=this.arrs.idx;this.paths=[];var l=0;if(1==
this.type)for(;l<b.length;){var e=zd.makePath2D(),f=b[l++]<<1;e.moveTo(a[f],a[f+1]);f=b[l++]<<1;e.lineTo(a[f],a[f+1]);f=b[l++]<<1;e.lineTo(a[f],a[f+1]);f=b[l++]<<1;e.lineTo(a[f],a[f+1]);e.closePath();this.paths.push(e)}else if(2==this.type)for(;l<b.length;)e=zd.makePath2D(),f=b[l++]<<1,e.moveTo(a[f],a[f+1]),f=b[l++]<<1,e.lineTo(a[f],a[f+1]),f=b[l++]<<1,e.lineTo(a[f],a[f+1]),e.closePath(),this.paths.push(e)}}draw_poly_stroke(a="#000"){this.ensure_paths_created();zd.lineWidth=aj.line_width/rf.viewport_zoom;
zd.strokeStyle=a;for(let b of this.paths)zd.stroke(b)}draw_poly_fill_color(){this.ensure_paths_created();let a;const b=void 0!==this.arrs.face_color;b?(a=this.arrs.face_color,Id(a.length===4*this.paths.length,"Wrong size of face_color: "+a.length+" expected: "+4*this.paths.length)):a=this.consts.face_color;zd.lineWidth=1/rf.viewport_zoom;let l=0,e;for(let f of this.paths)e="rgba("+a[l]+","+a[l+1]+","+a[l+2]+","+a[l+3]/255+")",zd.fillStyle=e,zd.fill(f),zd.strokeStyle=e,zd.stroke(f),b&&(l+=4)}make_clip_path(a,
b){let l=this.effective_vtx_pos,e=this.arrs.idx,f=zd.makePath2D(),h;if(1==this.type)for(let g=0,m=0;g<e.length;g+=4,++m)a[m]==b&&(h=e[g]<<1,f.moveTo(l[h],l[h+1]),h=e[g+1]<<1,f.lineTo(l[h],l[h+1]),h=e[g+2]<<1,f.lineTo(l[h],l[h+1]),h=e[g+3]<<1,f.lineTo(l[h],l[h+1]),f.closePath());else if(2==this.type)for(let g=0,m=0;g<e.length;g+=3,++m)a[m]==b&&(h=e[g]<<1,f.moveTo(l[h],l[h+1]),h=e[g+1]<<1,f.lineTo(l[h],l[h+1]),h=e[g+2]<<1,f.lineTo(l[h],l[h+1]),f.closePath());return f}draw_poly_fill_clip(a){for(let b in this.fill_objs){const l=
this.fill_objs[b];if(null!==l){if(void 0===l.clip_path||null===l.clip_path)l.clip_path=this.make_clip_path(this.arrs.face_fill,b);zd.save();zd.clip(l.clip_path,"nonzero");try{l.obj_proxy.draw(a)}finally{zd.restore()}}}}async pre_draw_poly_fill_clip(a){for(let b in this.fill_objs){const l=this.fill_objs[b];null!==l&&await l.obj_proxy.pre_draw(a)}}ensure_tcache(a){let b=!1;null===this.tcache.vtx_pos?(this.tcache.vtx_pos=new Float32Array(this.arrs.vtx_pos.length),b=!0):null!==this.tcache.m&&Qh.equals(a,
this.tcache.m)||(b=!0);b&&(ij.transform_arr(a,this.effective_vtx_pos,this.tcache.vtx_pos),this.meta.vtx_pos.made_glbuf=!1)}vidxs_of_face(a){let b=this.face_size();a*=b;console.assert(a<this.arrs.idx.length,"Out of bound index");let l=[];for(let e=0;e<b;++e){let f=2*this.arrs.idx[a++];l.push(f)}return l}async pre_draw(a,b){b.show_faces&&!this.arrs.face_color&&this.arrs.face_fill&&await this.pre_draw_poly_fill_clip(a)}draw_m(a,b){b||={show_faces:!0,show_lines:!0,show_vtx:!0};b.show_faces&&(this.arrs.face_color||
this.consts.face_color?this.draw_poly_fill_color():this.arrs.face_fill&&this.draw_poly_fill_clip(a));b.show_lines&&this.draw_poly_stroke();b.show_vtx&&this.draw_vertices("#000",!0,b)}draw_selection_m(a,b){a=this.effective_vtx_pos;zd.beginPath();let l=aj.vtx_sel_radius/rf.viewport_zoom;for(let f of b){var e=2*f;b=a[e];e=a[e+1];zd.moveTo(b+l,e);zd.arc(b,e,l,0,2*Math.PI)}zd.lineWidth=2/rf.viewport_zoom;zd.strokeStyle=aj.sel_color;zd.stroke()}draw_template_m(){this.draw_poly_stroke("#de77f1");this.draw_vertices("#de77f1",
!1)}make_buffers(){for(let a in this.arrs)if(null!==this.arrs[a]&&(this.glbufs[a]||(this.glbufs[a]=th.createBuffer(),this.meta[a].made_glbuf=!1),Id(null!==this.meta[a]&&void 0!==this.meta[a],"Missing meta for array "+a),!this.meta[a].made_glbuf)){let b="vtx_pos"==a?this.tcache:this.arrs,l="idx"==a?th.ELEMENT_ARRAY_BUFFER:th.ARRAY_BUFFER;th.bindBuffer(l,this.glbufs[a]);th.bufferData(l,b[a],th.STATIC_DRAW);this.meta[a].made_glbuf=!0}}make_point_suffle(a,b){if(null!==this.points_idx_cache&&this.points_idx_cache.seed===
a&&this.points_idx_cache.len===b)return this.points_idx_cache.idx_buf;const l=new bj(b);for(var e=0;e<b;++e)l[e]=e;e=new jj(a);for(let f=b-1;0<f;f--){const h=Math.floor(e.next()*(f+1));[l[f],l[h]]=[l[h],l[f]]}e=null!==this.points_idx_cache?this.points_idx_cache.idx_buf:th.createBuffer();th.bindBuffer(th.ELEMENT_ARRAY_BUFFER,e);th.bufferData(th.ELEMENT_ARRAY_BUFFER,l,th.STATIC_DRAW);this.points_idx_cache={idx_buf:e,seed:a,len:b};return e}gl_draw(a,b,l={}){Id(2===this.type||3===this.type||l.override_just_points,
"can't gl_draw non triangle mesh");this.ensure_tcache(a);this.make_buffers();for(var e in b){console.assert(!e.startsWith("face_"),"Face attributes can't be drawen with webgl");a=this.glbufs[e];a||"a_"!=e.substr(0,2)||(e=e.substr(2),a=this.glbufs[e]);let f=b[e];Id(-1!==f,"Can't find program attribute `"+e+"`");let h=this.arrs[e],g=this.meta[e];a?(th.bindBuffer(th.ARRAY_BUFFER,this.glbufs[e]),th.enableVertexAttribArray(f),th.vertexAttribPointer(f,g.num_elems,kj(h),g.need_normalize,0,0)):th.disableVertexAttribArray(f)}2!==
this.type||l.override_just_points?(e=this.arrs.vtx_pos.length/this.meta.vtx_pos.num_elems,null!==l.shuffle_points_seed?(l=this.make_point_suffle(l.shuffle_points_seed,e),th.bindBuffer(th.ELEMENT_ARRAY_BUFFER,l),th.drawElements(th.POINTS,e,kj(this.arrs.idx),0)):th.drawArrays(th.POINTS,0,e)):(Id(null!==this.glbufs.idx,"Tri mesh without indices"),th.bindBuffer(th.ELEMENT_ARRAY_BUFFER,this.glbufs.idx),th.drawElements(th.TRIANGLES,this.arrs.idx.length,kj(this.arrs.idx),0));for(let f in b)th.disableVertexAttribArray(b[f]);
th.bindBuffer(th.ARRAY_BUFFER,null);th.bindBuffer(th.ELEMENT_ARRAY_BUFFER,null)}add_fillobj(a){const b=this.fill_objs.length;this.fill_objs.push(new fj(a));return b}make_single_object_calls(a){let b=this.effective_vtx_pos,l=this.arrs.idx,e,f;if(1==this.type)for(let h=0,g=0;h<l.length;h+=4,++g)f=l[h],e=f<<1,a.moveTo(b[e],b[e+1],f),f=l[h+1],e=f<<1,a.lineTo(b[e],b[e+1],f),f=l[h+2],e=f<<1,a.lineTo(b[e],b[e+1],f),f=l[h+3],e=f<<1,a.lineTo(b[e],b[e+1],f),a.closePath();else if(2==this.type)for(let h=0,g=
0;h<l.length;h+=3,++g)f=l[h],e=f<<1,a.moveTo(b[e],b[e+1],e),f=l[h+1],e=f<<1,a.lineTo(b[e],b[e+1],e),f=l[h+2],e=f<<1,a.lineTo(b[e],b[e+1],e),a.closePath();return a}ensure_paper(){if(null!==this.paper_obj&&this.paper_obj.children.length*this.face_size()==this.arrs.idx.length)return this.paper_obj;const a=new pc.CompoundPath;a.remove();this.make_single_object_calls(a);return this.paper_obj=a}ensure_clipper(){if(null!==this.clipper_obj)return this.clipper_obj;const a=new lj;this.make_single_object_calls(a);
return this.clipper_obj=a.d}add_vertex_props(a,b){for(var l in b){if(void 0!==this.arrs[l])continue;const f=b[l].length||1;this.set(l,[],f,!1);const h=this.vtx_count();if(0<h){const g=void 0!==this.consts[l]?this.consts[l]:bi(l,f),m=[];if(1===f)for(var e=0;e<h;++e)m.push(g);else for(e=0;e<h;++e)m.push(...g);this.set(l,m,f,!1)}}for(let f in this.arrs)"idx"!==f&&(l=f,l=l.startsWith("vtx_")||l.startsWith("line_"),Id(l,"mesh with face attributes not supported "+f),void 0!==this.arrs[f].BYTES_PER_ELEMENT&&
(this.arrs[f]=[...this.arrs[f]]),"vtx_pos"==f?(this.arrs.vtx_pos.push(a[0],a[1]),this.effective_vtx_pos=this.arrs.vtx_pos):(l=b[f],void 0===l&&(l=bi(f,this.meta[f].num_elems)),1==this.meta[f].num_elems?this.arrs[f].push(l):this.arrs[f].push(...l)))}add_vertex(a,b){Id(this.effective_vtx_pos===this.arrs.vtx_pos,"Working with effective_vtx_pos not supported");Id(3===this.type,"Only points mesh supported");this.add_vertex_props(a,b)}get_last_vertex(){const a=this.arrs.vtx_pos;return null===a||2>a.length?
null:[a[a.length-2],a[a.length-1]]}describe(a,b){b.recreate_if_needed(this)&&(b.eobj.vtxnum=b.add_line("Vertex Count: ").value_elem,b.eobj.type=b.add_line("Type: ").value_elem,b.eobj.facenum=b.add_line("Face Count: ").value_elem,b.eobj.props=b.add_line("Properties:",!0).value_elem,b.eobj.props.classList.add("obj_inf_prop_list"),b.adjust_labels());b.eobj.vtxnum.innerText=this.arrs.vtx_pos.length/2;b.eobj.type.innerText=dj(this.type);b.eobj.facenum.innerText=this.face_count();a=[];for(let l in this.arrs)a.push(l+
": "+this.arrs[l].constructor.name+"("+this.arrs[l].length+")");b.eobj.props.innerText=a.join("\n")}}class lj{constructor(){this.d=[];this.cur_path=null}moveTo(a,b,l){this.cur_path=[{X:a,Y:b,Z:l}];this.cur_path.closed=!1;this.d.push(this.cur_path)}lineTo(a,b,l){Id(null!==this.cur_path,"Path needs to start with moveTo");this.cur_path.push({X:a,Y:b,Z:l})}closePath(){Id(null!==this.cur_path,"Path needs to start with moveTo");this.cur_path.closed=!0}bezierCurveTo(){Id(!1,"not implemented")}}
function kj(a){a=a.constructor;if(a===Float32Array)return th.FLOAT;if(a===Uint8Array||a===Uint8ClampedArray)return th.UNSIGNED_BYTE;if(a===Uint32Array)return th.UNSIGNED_INT;if(a===Uint16Array)return th.UNSIGNED_SHORT;throw Error("unexpected array type");}
function Tf(){let a={nodes:{},lines:[],next_node_id:dd.next_obj_id,names_idx_s:dd.names_indices,display_node_id:null===dd.display_node?null:dd.display_node.id,tdisp_node_ids:[],input_node_ids:[],nodes_view:nd.save(),decor:[]};for(var b of dd.nodes){var l={params:{},name:b.name,cls_name:b.cls.constructor.name(),x:b.x,y:b.y,disp_param:b.display_values,enable_active:b.enable_active};for(let h of b.parameters){var e=h.save();null!==e&&(l.params[h.label]=e)}null!==b.following_node&&(l.following=b.following_node.id);
for(e=0;e<b.outputs.length;++e)b.outputs[e].caching||(void 0==l.non_caching_out&&(l.non_caching_out=[]),l.non_caching_out.push(e));a.nodes[b.id]=l}for(var f of dd.lines)b=f.from_term.get_attachee(),l=f.to_term.get_attachee(),a.lines.push({from_name:b.name,from_id:b.owner.id,to_name:l.name,to_id:l.owner.id,uid:f.uid});for(let h of dd.tdisp_nodes)a.tdisp_node_ids.push(h.id);for(let h of dd.input_nodes)a.input_node_ids.push(h.id);for(let h of dd.nodes_decor)f=h.save(),f.type=h.constructor.name(),f.uid=
h.uid,a.decor.push(f);return a}function mj(a){return JSON.stringify(a,function(b,l){return ArrayBuffer.isView(l)?Array.from(l):l})}function ue(){if(!nj&&!kg){var a={program:Tf(),main_view_s:uf.save()};let b=Dc.get_presets();0<Object.keys(b).length&&(a.color_presets=b);a=mj(a);localStorage.setItem("state",a)}}function oj(a,b){for(let l of b)if(l.label===a)return l;return null}
function lg(a){function b(G,N){for(let T of G)if(T.name==N)return T;return null}ve(!1);Ue();const l=new pj;l.next_obj_id=parseInt(a.next_node_id);for(var e in a.names_idx_s)l.names_indices[e]=parseInt(a.names_idx_s[e]);for(var f in a.nodes){var h=parseInt(f);e=a.nodes[h];var g=qj[e.cls_name];console.assert(void 0!==g&&null!==g,"Unknown node class "+e.cls_name);h=l.add_node(e.x,e.y,e.name,g,h);for(var m in e.params){g=e.params[m];let G=oj(m,h.parameters);null===G&&(G=h.param_aliases[m]);if(void 0===
G)console.error("Missing parameter "+m+" of node "+e.name);else try{G.load(g),G.call_change(),G.pset_dirty()}catch(N){console.warn("Failed load of parameter",G.label,"in node",e.name,":",N)}}if(void 0!==e.non_caching_out)for(var q of e.non_caching_out)h.outputs[q].set_caching(!1);e.enable_active&&h.cls.toggle_enable_flag(!1,!0);e.disp_param&&(h.display_values=e.disp_param)}for(var r of a.lines)f=l.obj_map[r.from_id],console.assert(f.constructor===ke),m=b(f.terminals,r.from_name),q=l.obj_map[r.to_id],
console.assert(q.constructor===ke),e=b(q.terminals,r.to_name),null===e&&(e=q.terminal_aliases[r.to_name]),void 0===e?console.log("Can't find terminal ",r.to_name," for node ",q.name):null===m||null===e?console.warn("did not find terminal of node ",f.name):l.add_line(new cd(m.get_attachment(),e.get_attachment()),r.uid,!1);for(var B in a.nodes)r=a.nodes[B],void 0!==r.following&&l.obj_map[B].follow(l.obj_map[r.following]);for(let G of l.nodes){G.cls.post_load_hook&&G.cls.post_load_hook();for(let N of G.parameters)N.post_load_hook&&
N.post_load_hook()}null===a.display_node_id||void 0===l.obj_map[a.display_node_id]?l.set_display_node(null):l.set_display_node(l.obj_map[a.display_node_id]);l.tdisp_nodes=[];if(void 0!==a.tdisp_node_ids)for(var D of a.tdisp_node_ids)B=l.obj_map[D],void 0!==B&&l.set_template_node(B,!1);if(void 0!==a.input_node_ids)for(var F of a.input_node_ids)D=l.obj_map[F],console.assert(void 0!==D,"input node not found"),l.set_input_node(D,!1);void 0!==a.nodes_view&&nd.load(a.nodes_view);if(void 0!==a.decor)for(let G of a.decor)F=
rj[G.type],void 0===F?console.warn("unknown decor class "+G.type):(F=new F,F.load(G),l.nodes_add_decor(F,G.uid));console.assert(l.next_obj_id===parseInt(a.next_node_id),"Unexpected ids created");dd=l}var kg=!1,nj=!1;
function sj(){var a=localStorage.getItem("state");if(null!==a){a=JSON.parse(a);uf.load(a.main_view_s);a.color_presets&&Dc.set_presets(a.color_presets);var b=localStorage.getItem("user_saved_progs");null!==b&&JSON.parse(b);try{var l=a.program;try{kg=!0,lg(l)}finally{kg=!1}}catch(e){console.error("Failed loading current program"+e)}}}var tj=0;class je extends Error{constructor(a,b=null){super(a);this.line=null!==b&&void 0!==b?b:tj}}class uj extends je{constructor(a,b=null){super(a,b)}}
class vj extends Error{constructor(){super("undecided-type")}}class wj extends Error{constructor(a){super(a)}}function Ah(a,b,l=null){if(!a)throw new je(b,l);}class xj{constructor(){this.type=null;this.line=tj}clear_types_cache(){this.type=null}consumes_subscript(){return!1}func_ret_type(){Ah(!1,"func_ret_type not implemented")}get_const_value(){return null}eval(){Ah(!1,"eval not implemented")}check_type(){Ah(!1,"check_type not implemented")}to_glsl(){Ah(!1,"to_glsl not implemented")}}
class yj extends xj{constructor(){super();this.line_num=null}}function Bh(a){switch(a){case 1:return"number";case 2:return"bool";case 12:return"vec2";case 10:return"vec3";case 11:return"vec4";case 13:return"mat3";case 22:return"void";case 21:return"function";default:return"<"+a+">"}}function zj(a){switch(a){case 1:return 1;case 2:return 1;case 12:return 2;case 10:return 3;case 11:return 4;default:throw je("numbersInType for unexpected type "+a);}}
function Aj(a){if(4<a.length)throw new uj("too many arguments to function");let b=0,l=0;for(let e of a)b|=e<<8*l++;return b}function Bj(){return Aj(arguments)}function Cj(a){let b=[];for(;0!==a;)b.push(Bh(a&255)),a>>=8;return b.join(",")}function hh(a,b,l){return b<a?a:b>l?l:b}const Dj={x:0,y:1,z:2,w:3,r:0,g:1,b:2,a:3,alpha:3},Ej=["r","g","b","w"];
class Fj{constructor(){this.set={}}add(a,b){void 0===this.set[a]&&(this.set[a]=b)}extend(a){null!==a&&(this.set={...this.set,...a.set})}to_text(){const a=[];for(let b in this.set)a.push(this.set[b]);return a.join("\n")}get_kv(){return this.set}get(a){return this.set[a]}append_text(a,b){this.set[a]=void 0===this.set[a]?b:this.set[a]+b}}
var zh=function(){function a(J){if(0==J)throw new je("Division by zero");return J}function b(J,S,fa){switch(fa){case 1:J|=S;break;case 2:J^=S;break;case 3:J&=S;break;case 4:J<<=S;break;case 5:J>>=S;break;case 6:J+=S;break;case 7:J-=S;break;case 8:J*=S;break;case 9:J/=a(S);break;case 10:J%=a(S);break;case 11:J=Math.pow(J,S);break;case 21:throw new je("subscript in binary (bug)");case 13:J=J<S;break;case 14:J=J<=S;break;case 15:J=J>S;break;case 16:J=J>=S;break;case 17:J=J==S;break;case 18:J=J!=S;break;
case 19:J=J&&S;break;case 20:J=J||S;break;default:throw new je("unexpected operator");}return J}function l(J){switch(J){case 1:return"|";case 2:return"^";case 3:return"&";case 4:return"<<";case 5:return">>";case 6:return"+";case 7:return"-";case 8:return"*";case 9:return"/";case 10:return"%";case 11:return"**";case 21:throw new je("subscript in binary (bug)");case 13:return"<";case 14:return"<=";case 15:return">";case 16:return">=";case 17:return"==";case 18:return"!=";case 19:return"&&";case 20:return"||";
default:throw new je("unexpected operator");}}function e(J,S){switch(S){case 102:return-J;case 101:return~J;case 100:return!J;default:throw new je("unexpected unary operator");}}function f(){return ab>=rb.length?null:rb[ab]}function h(){for(;;){const J=f();"\n"===J&&tj++;if(" "!==J&&"\n"!==J&&"\r"!==J&&"\t"!==J)break;ab++}}function g(){h();switch(f()){case "|":ab++;var J=f();return"|"==J?(ab++,ya[20]):ya[1];case "^":return ab++,ya[2];case "&":return ab++,J=f(),"&"==J?(ab++,ya[19]):ya[3];case "<":return ab++,
J=f(),"<"==J?(ab++,ya[4]):"="==J?(ab++,ya[14]):ya[13];case ">":return ab++,J=f(),">"==J?(ab++,ya[5]):"="==J?(ab++,ya[16]):ya[15];case "=":J=ab+1<rb.length?rb[ab+1]:null;if("="!=J)return ya[0];ab+=2;return ya[17];case "!":if("!="!==rb.substr(ab,2))throw new je("Syntax error: unexpected token, expected !=");ab+=2;return ya[18];case "+":return ab++,ya[6];case "-":return ab++,ya[7];case "/":return ab++,ya[9];case "%":return ab++,ya[10];case "*":ab++;if("*"!=f())return ya[8];ab++;return ya[11];case ".":return ab++,
ya[21];case "?":return ab++,ya[22];default:return ya[0]}}function m(J,S,fa,oa,na,ja){J=F(F(S,J),F(oa,ja));return F(J<<na|J>>>32-na,fa)}function q(J,S,fa,oa,na,ja,Ba){return m(S&fa|~S&oa,J,S,na,ja,Ba)}function r(J,S,fa,oa,na,ja,Ba){return m(S&oa|fa&~oa,J,S,na,ja,Ba)}function B(J,S,fa,oa,na,ja,Ba){return m(S^fa^oa,J,S,na,ja,Ba)}function D(J,S,fa,oa,na,ja,Ba){return m(fa^(S|~oa),J,S,na,ja,Ba)}function F(J,S){var fa=(65535&J)+(65535&S);return(J>>16)+(S>>16)+(fa>>16)<<16|65535&fa}function G(J){for(var S=
"x"+J,fa=Array(S.length>>2),oa=0;oa<fa.length;oa++)fa[oa]=0;for(oa=0;oa<8*S.length;oa+=8)fa[oa>>5]|=(255&S.charCodeAt(oa/8))<<oa%32;S=8*S.length;fa[S>>5]|=128<<S%32;fa[14+(S+64>>>9<<4)]=S;S=1732584193;oa=-271733879;for(var na=-1732584194,ja=271733878,Ba=0;Ba<fa.length;Ba+=16){var Ua=S,Ya=oa,K=na,X=ja;oa=D(oa=D(oa=D(oa=D(oa=B(oa=B(oa=B(oa=B(oa=r(oa=r(oa=r(oa=r(oa=q(oa=q(oa=q(oa=q(oa,na=q(na,ja=q(ja,S=q(S,oa,na,ja,fa[Ba+0],7,-680876936),oa,na,fa[Ba+1],12,-389564586),S,oa,fa[Ba+2],17,606105819),ja,S,
fa[Ba+3],22,-1044525330),na=q(na,ja=q(ja,S=q(S,oa,na,ja,fa[Ba+4],7,-176418897),oa,na,fa[Ba+5],12,1200080426),S,oa,fa[Ba+6],17,-1473231341),ja,S,fa[Ba+7],22,-45705983),na=q(na,ja=q(ja,S=q(S,oa,na,ja,fa[Ba+8],7,1770035416),oa,na,fa[Ba+9],12,-1958414417),S,oa,fa[Ba+10],17,-42063),ja,S,fa[Ba+11],22,-1990404162),na=q(na,ja=q(ja,S=q(S,oa,na,ja,fa[Ba+12],7,1804603682),oa,na,fa[Ba+13],12,-40341101),S,oa,fa[Ba+14],17,-1502002290),ja,S,fa[Ba+15],22,1236535329),na=r(na,ja=r(ja,S=r(S,oa,na,ja,fa[Ba+1],5,-165796510),
oa,na,fa[Ba+6],9,-1069501632),S,oa,fa[Ba+11],14,643717713),ja,S,fa[Ba+0],20,-373897302),na=r(na,ja=r(ja,S=r(S,oa,na,ja,fa[Ba+5],5,-701558691),oa,na,fa[Ba+10],9,38016083),S,oa,fa[Ba+15],14,-660478335),ja,S,fa[Ba+4],20,-405537848),na=r(na,ja=r(ja,S=r(S,oa,na,ja,fa[Ba+9],5,568446438),oa,na,fa[Ba+14],9,-1019803690),S,oa,fa[Ba+3],14,-187363961),ja,S,fa[Ba+8],20,1163531501),na=r(na,ja=r(ja,S=r(S,oa,na,ja,fa[Ba+13],5,-1444681467),oa,na,fa[Ba+2],9,-51403784),S,oa,fa[Ba+7],14,1735328473),ja,S,fa[Ba+12],20,
-1926607734),na=B(na,ja=B(ja,S=B(S,oa,na,ja,fa[Ba+5],4,-378558),oa,na,fa[Ba+8],11,-2022574463),S,oa,fa[Ba+11],16,1839030562),ja,S,fa[Ba+14],23,-35309556),na=B(na,ja=B(ja,S=B(S,oa,na,ja,fa[Ba+1],4,-1530992060),oa,na,fa[Ba+4],11,1272893353),S,oa,fa[Ba+7],16,-155497632),ja,S,fa[Ba+10],23,-1094730640),na=B(na,ja=B(ja,S=B(S,oa,na,ja,fa[Ba+13],4,681279174),oa,na,fa[Ba+0],11,-358537222),S,oa,fa[Ba+3],16,-722521979),ja,S,fa[Ba+6],23,76029189),na=B(na,ja=B(ja,S=B(S,oa,na,ja,fa[Ba+9],4,-640364487),oa,na,fa[Ba+
12],11,-421815835),S,oa,fa[Ba+15],16,530742520),ja,S,fa[Ba+2],23,-995338651),na=D(na,ja=D(ja,S=D(S,oa,na,ja,fa[Ba+0],6,-198630844),oa,na,fa[Ba+7],10,1126891415),S,oa,fa[Ba+14],15,-1416354905),ja,S,fa[Ba+5],21,-57434055),na=D(na,ja=D(ja,S=D(S,oa,na,ja,fa[Ba+12],6,1700485571),oa,na,fa[Ba+3],10,-1894986606),S,oa,fa[Ba+10],15,-1051523),ja,S,fa[Ba+1],21,-2054922799),na=D(na,ja=D(ja,S=D(S,oa,na,ja,fa[Ba+8],6,1873313359),oa,na,fa[Ba+15],10,-30611744),S,oa,fa[Ba+6],15,-1560198380),ja,S,fa[Ba+13],21,1309151649),
na=D(na,ja=D(ja,S=D(S,oa,na,ja,fa[Ba+4],6,-145523070),oa,na,fa[Ba+11],10,-1120210379),S,oa,fa[Ba+2],15,718787259),ja,S,fa[Ba+9],21,-343485551);S=F(S,Ua);oa=F(oa,Ya);na=F(na,K);ja=F(ja,X)}return([S,oa,na,ja][J%4]&2147483647)/2147483647}function N(J,S,fa,oa,na){Ah(S<fa==oa<na,"mismatch order of arguments in fit()");J>fa&&(J=fa);J<S&&(J=S);return(J-S)/(fa-S)*(na-oa)+oa}function T(J,S,fa){return J<S?S:J>fa?fa:J}function V(J,S){let fa=J[0].length,oa=new J[0].constructor(fa),na=Array(fa);for(let Ba=0;Ba<
fa;++Ba){for(var ja=0;ja<J.length;++ja)na[ja]=J[ja][Ba];ja=S.apply(null,na);oa[Ba]=ja}return oa}function E(J,S){if(1===J.length)return S;if(2===J.length){const fa=Cb[J[1]];if(void 0!==fa)return new ca(fa,S)}return new yb(S,J.slice(1))}function Q(J){if(void 0!==mb[J])return mb[J];if(void 0!==Cb[J])return new ca(Cb[J]);const S=J.split("."),fa=S[0];if(null!==Fb){const oa=Fb[fa];if(void 0!==oa)return E(S,oa)}J=ob.get_evaluator(J,tj);if(null!==J)return J.consumes_subscript()?J:E(S,J);ob.score|=2;J=ob.need_variables[fa];
void 0===J&&(J=new Gj(fa,tj),ob.need_variables[fa]=J);return E(S,J)}function aa(J){return null===J?16:"0"<=J&&"9">=J?J.charCodeAt(0)-48:"a"<=J&&"f">=J?J.charCodeAt(0)-97+10:"A"<=J&&"F">=J?J.charCodeAt(0)-65+10:16}function qa(){let J=0;for(var S;9>=(S=aa(f()));ab++)J=10*J+S;if("."==f()){ab++;S=.1;for(var fa;9>=(fa=aa(f()));ab++)J+=fa*S,S*=.1}fa=f();if("e"==fa||"E"==fa)if(S="-"==rb[ab+1]?1:0,fa=rb[ab+S+1],"0"<=fa&&"9">=fa){ab+=1+S;fa=0;for(let oa;9>=(oa=aa(f()));ab++)fa=10*fa+oa;S&&(fa=-fa);J*=Math.pow(10,
fa);console.log(J)}return new Ca(J,!0)}function P(){if(ab+2<rb.length){let J=rb[ab+1].toLowerCase(),S=rb[ab+2];if("x"==J&&15>=aa(S))return 16;if("b"==J&&1>=aa(S))return 2;if("o"==J&&8>=aa(S))return 8}return 10}function ea(){h();var J=f();switch(J){case "0":J=P();if(16==J){ab+=2;J=0;for(var S;15>=(S=aa(f()));ab++)J=16*J+S;J=new Ca(J,!1)}else if(2==J){ab+=2;for(J=0;1>=(S=aa(f()));ab++)J=2*J+S;J=new Ca(J,!1)}else if(8==J){ab+=2;for(J=0;7>=(S=aa(f()));ab++)J=8*J+S;J=new Ca(J,!1)}else J=qa();break;case "1":case "2":case "3":case "4":case "5":case "6":case "7":case "8":case "9":case ".":J=
qa();break;case "(":ab++;J=ua();h();if(")"!=f())throw new je("Syntax error: `)' expected at end of expression");ab++;break;case "+":ab++;J=ea();break;case "-":ab++;J=new za(ea(),102);break;case "~":ab++;J=new za(ea(),101);break;case "!":ab++;J=new za(ea(),100);break;default:if("a"<=J&&"z">=J||"A"<=J&&"Z">=J||"_"==J){for(J="";;){S=f();if(null===S)break;if("a"<=S&&"z">=S||"A"<=S&&"Z">=S||"_"==S||"."==S||"0"<=S&&"9">=S)J+=S;else break;ab++}if("."==J[0]||"."==J[J.length-1])throw new je("Unexpected dot in an identifier at "+
ab);J=[J,Q(J)];const [oa,na]=J;J=na;h();if(J.constructor!==eb&&"("==f()){S=[];null!==J.that&&void 0!==J.that&&S.push(J.that);ab++;h();var fa=!0;if(")"!==f()){do fa||ab++,fa=ua(),S.push(fa),h(),fa=!1;while(","==f())}if(")"!=f())throw new je("Expected closing paren for argument list at "+ab);++ab;if(J.constructor===ca){fa=J.num_args();if(Array.isArray(fa)&&(S.length<fa[0]||S.length>fa[1]))throw new je("Wrong number of arguments to function "+oa+" expected in range ["+fa[0]+", "+fa[1]+"] got "+S.length);
if(0===fa)throw new je("internal func can't have 0 arguments");if(0<fa){if(S.length!=fa)throw new je("Wrong number of argument to function "+oa+" expected "+fa+" got "+S.length);}else if(S.length<-fa)throw new je("Not enough arguments to function "+oa+" expected at least "+fa+" got "+S.length);J=new fb(J.def,oa,S)}else J=new Qa(J,oa,S)}}else throw new je("Syntax error: value expected at end of expression");}return J}function ua(){Bb.push({op:ya[0]});var J=ea();let S=null;for(;0!=Bb.length;){for(var fa=
g();fa.precedence<Bb[Bb.length-1].op.precedence||fa.precedence==Bb[Bb.length-1].op.precedence&&"L"==fa.associativity;){let oa=Bb[Bb.length-1];if(0==oa.op.op)return Bb.pop(),J;21===oa.op.op?J=new yb(oa.value,null,J):22==oa.op.op?(Ah(null!==S,"Missing mid value in trinary operator"),J=new Eb(oa.value,S,J),S=null):J=new xa(oa.value,J,oa.op.op);Bb.pop()}Bb.push({op:fa,value:J});if(21===fa.op){J="";fa=f();if("#"==fa)J=null;else{if(!("a"<=fa&&"z">=fa||"A"<=fa&&"Z">=fa))throw new je("unexpected char at start of statement "+
fa);for(;;){fa=f();if(null===fa)break;if("a"<=fa&&"z">=fa||"A"<=fa&&"Z">=fa||"_"==fa||"."==fa||"0"<=fa&&"9">=fa)J+=fa;else break;ab++}}J=new ub(J)}else 22==fa.op&&(S=ua(),J=f(),Ah(":"===J,"Trinary operator expects ':'"),ab++),J=ea()}return null}function Fa(){h();var J;if(J=0<ab)J=rb[ab-1],J=!(" "===J||"\n"===J||"\r"===J||"\t"===J);if(J)throw new je("Statments must be separated by whitespace");J=f();if("}"===J)return 2;if("#"==J)return 1;J=ua();h();if(J.constructor==eb){if("if"===J.v){h();var S=f();
if("("!==S)throw new je("if expects open trace '('");ab++;J=ua();h();S=f();if(")"!==S)throw new je("if condition expects close trace ')'");ab++;h();S=pa();0==S.count()&&(S=null);h();var fa=null;"else"==rb.substr(ab,4)&&(ab+=4,fa=pa(),0==fa.count()&&(fa=null));return new Pb(J,S,fa)}if("return"===J.v)return J=ua(),new Xb(J);throw new je("unknown identifier "+J.v);}S=null;J.constructor===Gj?(S=J.varname,ob.need_variables[S].name_reused_error=!0):J.constructor===qb?S=J.name:J.constructor===yb&&(Ah(J.wrapNode.constructor===
qb,"Can't assign to subscript of something that's not a symbol"),S=J.wrapNode.name+"."+J.subname);if(null!==S){J=S;Ah(0<J.length,"empty var in assignment");S=0;fa=f();switch(fa){case "+":S=6;break;case "-":S=7;break;case "*":S=8;break;case "/":S=9}0!==S&&(ab++,fa=f());if("="!==fa)throw new je("expected assignment");ab++;h();fa=ua();J=0===S?new Rb(J,fa):new Rb(J,new xa(Q(J),fa,S));return J}return new z(J)}function pa(){let J=f(),S;if("{"==J){ab++;S=ra();h();J=f();if("}"!==J)throw new je("code block expects closing curly braces");
ab++}else S=ra(!0),h();return S}function ra(J){let S=[];for(;!(ab>=rb.length);){var fa=Fa();if(1===fa)for(;;){fa=f();if(null===fa)break;++ab;if("\n"==fa){tj++;break}}else{if(2===fa)break;S.push(fa);if(J)break}}return new ib(S,Fb)}class Ca extends xj{constructor(J,S){super();Ah(null!==J&&void 0!==J,"unexpected non-number value");this.v=J;this.decimal=S}eval(){return this.v}check_type(){return this.type=1}to_glsl(){return Number.isInteger(this.v)?this.v+".0":this.v}get_const_value(){return this.decimal?
this.v:null}}class Ga extends xj{constructor(J){super();Ah(null!==J&&void 0!==J,"unexpected non-number value");this.v=J}eval(){return this.v}check_type(){return this.type=2}to_glsl(){return this.v?"true":"false"}get_const_value(){return this.v}}class Aa extends xj{constructor(J,S){super();this.v=J;this.type=S}eval(){return this.v}check_type(){return this.type}}class xa extends xj{constructor(J,S,fa){super();this.left=J;this.right=S;this.op=fa;this.t2=this.t1=this.type=null}clear_types_cache(){this.type=
null;this.left.clear_types_cache();this.right.clear_types_cache()}check_type(){if(null===this.type){let S=this.left.check_type(),fa=this.right.check_type();this.t1=S;this.t2=fa;var J=this.op;if(13==J||14==J||15==J||16==J){if(1!==S||1!==fa)throw new uj("boolean operator "+l(this.op)+" expects numbers",this.line);this.type=2}else if(17==this.op||18==this.op){if(S!==fa)throw new uj("Equality op of different types "+Bh(S)+", "+Bh(fa),this.line);this.type=2}else if(J=this.op,19==J||20==J){if(2!==S||2!==
fa)throw new uj("logic operator "+l(this.op)+" expected booleans",this.line);this.type=2}else if(S>fa&&(J=S,S=fa,fa=J),1===S)this.type=fa;else{if(S!=fa)throw new uj("can't handle different vec types");this.type=S}}return this.type}eval(){console.assert(null!==this.type);var J=this.left.eval(),S=this.right.eval();if(1===this.type||2===this.type)return b(J,S,this.op);if(this.t1==this.t2)return V([J,S],(na,ja)=>b(na,ja,this.op));let fa;1==this.t1||2==this.t1?fa=S:(fa=J,J=S);S=fa.length;const oa=new fa.constructor(S);
for(let na=0;na<S;++na)oa[na]=b(fa[na],J,this.op);return oa}to_glsl(J){return"("+this.left.to_glsl(J)+ya[this.op].str+this.right.to_glsl(J)+")"}}class za extends xj{constructor(J,S){super();this.child=J;this.type=null;this.op=S}eval(){const J=this.child.eval();if(1==this.type||2==this.type)return e(J,this.op);const S=J.length,fa=new J.constructor(S);for(let oa=0;oa<S;++oa)fa[oa]=e(J[oa],this.op);return fa}clear_types_cache(){this.type=null;this.child.clear_types_cache()}check_type(){null===this.type&&
(this.type=this.child.check_type());return this.type}to_glsl(J){J=this.child.to_glsl(J)+")";switch(this.op){case 102:return"(-"+J;case 101:return"(~"+J;case 100:return"(!"+J;default:throw new je("unexpected unary operator");}}}class Na{constructor(J,S,fa,oa){this.op=J;this.precedence=S;this.associativity=fa;this.str=oa}}const ya=[new Na(0,0,"L","<null>"),new Na(1,40,"L","|"),new Na(2,50,"L","^"),new Na(3,60,"L","&"),new Na(4,70,"L","<<"),new Na(5,70,"L",">>"),new Na(6,100,"L","+"),new Na(7,100,"L",
"-"),new Na(8,200,"L","*"),new Na(9,200,"L","/"),new Na(10,200,"L","%"),new Na(11,300,"R","TBD"),null,new Na(13,30,"L","<"),new Na(14,30,"L","<="),new Na(15,30,"L",">"),new Na(16,30,"L",">="),new Na(17,30,"L","=="),new Na(18,30,"L","=="),new Na(19,20,"L","&&"),new Na(20,10,"L","||"),new Na(21,500,"L","."),new Na(22,10,null,"?:")];class Ia{constructor(J,S,fa=0,oa=null){this.f=J;this.num_args=S;this.dtype=fa;this.ret_type=oa}}const $a={[Bj(1,1,1)]:function(J,S,fa){return Hj.fromValues(J,S,fa)},[Bj(12,
1)]:function(J,S){return Hj.fromValues(J[0],J[1],S)},[10]:function(J){return J},[11]:function(J){return Hj.fromValues(J[0],J[1],J[2])}},lb={[Bj(1,1,1,1)]:function(J,S,fa,oa){return Oh.fromValues(J,S,fa,oa)},[Bj(12,1,1)]:function(J,S,fa){return Oh.fromValues(J[0],J[1],S,fa)},[Bj(10,1)]:function(J){return Oh.fromValues(J[0],J[1],J[2],w)},[11]:function(J){return J}},xb={[Bj(1,1)]:function(J,S){return Math.abs(J-S)},[Bj(12,12)]:function(J,S){return Ff.distance(J,S)},[Bj(10,10)]:function(J,S){return Hj.distance(J,
S)},[Bj(11,11)]:function(J,S){return Oh.distance(J,S)}},Cb={cos:new Ia(Math.cos,1),sin:new Ia(Math.sin,1),tan:new Ia(Math.tan,1),acos:new Ia(Math.acos,1),asin:new Ia(Math.acos,1),atan:new Ia(Math.atan,1),atan2:new Ia(Math.atan2,2),sqrt:new Ia(Math.sqrt,1),sqr:new Ia(function(J){return J*J},1),pow:new Ia(Math.pow,2),distance:new Ia(xb,2,-1,1),length:new Ia({[1]:function(J){return Math.abs(J)},[12]:function(J){return Ff.length(J)},[10]:function(J){return Hj.length(J)},[11]:function(J){return Oh.length(J)}},
1,-1,1),log:new Ia(Math.log,1),log10:new Ia(Math.log10,1),log2:new Ia(Math.log2,1),round:new Ia(Math.round,1),ceil:new Ia(Math.ceil,1),floor:new Ia(Math.floor,1),trunc:new Ia(Math.trunc,1),abs:new Ia(Math.abs,1),sign:new Ia(Math.sign,1),min:new Ia(Math.min,-2),max:new Ia(Math.max,-2),clamp:new Ia(T,3),smoothstep:new Ia(function(J,S,fa){J=T((fa-J)/(S-J),0,1);return J*J*(3-2*J)},3),rand:new Ia(G,1),randvec2:new Ia(function(J){J=2*G(J)*Math.PI;return Ff.fromValues(Math.cos(J),Math.sin(J))},1,[1],12),
fit:new Ia(N,5),fit01:new Ia(function(J,S,fa){return N(J,0,1,S,fa)},3),fit11:new Ia(function(J,S,fa){return N(J,-1,1,S,fa)},3),degrees:new Ia(function(J){return 180*J/Math.PI},1),radians:new Ia(function(J){return J*Math.PI/180},1),"float":new Ia(function(J){return+J},1,[2],1),vec2:new Ia(function(J,S){return Ff.fromValues(J,S)},2,[1,1],12),vec3:new Ia($a,[1,3],-1,10),vec4:new Ia(lb,[1,4],-1,11),mat3:new Ia(function(){const J=arguments;if(0==J.length)return Qh.create();Ah(9===J.length,"Missing arguments, expected 9 values");
return Qh.fromValues(J[0],J[1],J[2],J[3],J[4],J[5],J[6],J[7],J[8])},[0,9],Array(9).fill(1),13),normalize:new Ia({[1]:function(){return 1},[12]:function(J){let S=Ff.create();Ff.normalize(S,J);return S},[10]:function(J){let S=Hj.create();Hj.normalize(S,J);return S},[11]:function(J){let S=Hj.create();Hj.normalize(S,J);return S}},1,-1,null),hsl:new Ia(function(J,S,fa){const oa={};Dc.HSLtoRGB(J,S,fa,oa);return[oa.r,oa.g,oa.b]},3,[1,1,1],10),hsla:new Ia(function(J,S,fa,oa){const na={};Dc.HSLtoRGB(J,S,fa,
na);return[na.r,na.g,na.b,oa]},4,[1,1,1,1],11),rgb2hsv:new Ia(function(J){var S=J[0];let fa=J[1],oa=J[2];J=Math.max(S,fa,oa);let na=J-Math.min(S,fa,oa);S=na&&(J==S?(fa-oa)/na:J==fa?2+(oa-S)/na:4+(S-fa)/na);return[60*(0>S?S+6:S)/360,J&&na/J,J]},1,[10],10),hsv2rgb:new Ia(function(J){let S=360*J[0],fa=J[1],oa=J[2];J=(na,ja=(na+S/60)%6)=>oa-oa*fa*Math.max(Math.min(ja,4-ja,1),0);return[J(5),J(3),J(1)]},1,[10],10),plasma:new Ia(function(J,S=null,fa=null){x=10*J[0];y=10*J[1];null===S&&(t=2E4);null===fa&&
(fa=Ff.create(0,0));da=Ff.distance(Ff.fromValues(x+4*Math.cos(S/1110),y),Ff.fromValues(1,2.1));db=Ff.distance(Ff.fromValues(x,y),Ff.fromValues(8+16*fa[0],6.1+8*(1-fa[1])));dc=Ff.distance(Ff.fromValues(x,y+2*Math.cos(S/998)),Ff.fromValues(10,3.1));c1=Math.sin(da)+Math.sin(x)*Math.sin(S/1E3);c2=1*Math.sin(db-S/500);c3=Math.cos(dc/2)+Math.sin(S/1E3);c=(c1+c2+c3)/3;return.5*c+.5},[1,3],[12,1,12],1),smoothmin:new Ia(function(){Ah(!1,"not-implemented")},-3,[1,1,1],1),translate:new Ia(function(J,S,fa){Qh.translate(J,
J,Ff.fromValues(S,fa))},3,[13,1,1],22),rotate:new Ia(function(J,S){Qh.rotate(J,J,Sh.toRadian(S))},2,[13,1],22),scale:new Ia(function(J,S,fa){Qh.scale(J,J,Ff.fromValues(S,fa))},3,[13,1,1],22),get_pos:new Ia(function(J){return Ff.fromValues(J[6],J[7])},1,[13],12)};Cb.rgb=Cb.vec3;Cb.rgba=Cb.vec4;class ca extends xj{constructor(J,S=null){super();this.def=J;this.that=S}eval(){Ah(!1,"function can't be used as a value",this.line)}num_args(){return this.def.num_args}check_type(){return 21}}class Sa{constructor(J){this.func_str=
J}}const Va={rgb:"vec3",rgba:"vec4",atan2:"atan",sqr:new Sa("$T sqr($T v) { return v*v; }"),log10:new Sa("$T log10($T v) { return log(v)/log(10) }"),rand:null,fit:null,fit01:null,fit11:null,plasma:new Sa("\nfloat plasma(vec2 coord, float time, vec2 move) {    \n    float x = coord.x * 10.0;\n    float y = coord.y * 10.0;\n    float da = distance(vec2(x+cos(time / 1110.0) * 4.0, y), vec2(1.0,2.1));\n    float db = distance(vec2(x,y), vec2(8.0 + 16.0 * move.x, 6.1 + 8.0*(1.0 - move.y) ));\n    float dc = distance(vec2(x,y + cos(time / 998.0)*2.0), vec2(10.0, 3.1));\n    float c1 = sin(da) + sin(x) * sin(time / 1000.0);\n    float c2 = sin(db - time / 500.0)*1.0;\n    float c3 = cos(dc / 2.0) + sin(time / 1000.0);\n    float c = (c1 + c2 + c3) / 3.0;\n    return c * 0.5 + 0.5;\n}\nfloat plasma(vec2 coord, float time) { return plasma(coord, time, vec2(0.0, 0.0)); }\nfloat plasma(vec2 coord) { return plasma(coord, 20000.0, vec2(0.0, 0.0)); }\n    "),
smoothmin:new Sa("\nfloat smoothmin(float k, float d1, float d2) {\n    float h = clamp( 0.5 + 0.5*(d2-d1)/k, 0.0, 1.0 );\n    return mix( d2, d1, h ) - k*h*(1.0-h); \n}\n    "),rgb2hsv:new Sa("\nvec3 rgb2hsv(vec3 c) {\n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n    float d = q.x - min(q.w, q.y);\n    float e = 1.0e-10;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n    "),
hsv2rgb:new Sa("\nvec3 hsv2rgb(vec3 c)\n{\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}  \n    ")};class fb extends xj{constructor(J,S,fa){super();this.def=J;this.f=J.f;this.args=fa;this.type=null;this.funcname=S;this.lookedup_f=null}eval(){let J=[];for(let S of this.args)J.push(S.eval());return-1==this.def.dtype?this.lookedup_f.apply(null,J):0!=this.def.dtype||1==this.type||
2==this.type?this.f.apply(null,J):V(J,this.f)}clear_types_cache(){this.type=null;for(let J of this.args)J.clear_types_cache()}check_type(){if(null!==this.type)return this.type;var J=this.def.dtype;if(0==J){J=this.args[0].check_type();for(var S of this.args){var fa=S.check_type();if(fa!==J)throw new uj("function needs all arguments of the same type, got "+Bh(fa));}}else if(-1==J){J=this.args;S=[];for(fa of J)S.push(fa.check_type());J=Aj(S);this.lookedup_f=this.f[J];Ah(void 0!==this.lookedup_f,"Can't find function overload for argument types");
if(null===this.def.ret_type)if(1===atypes.length)J=atypes[0];else throw new uj("Can't deduce return type of func "+this.funcname);else J=this.def.ret_type}else{Ah(Array.isArray(J));S=this.args;fa=[];for(let oa of S)fa.push(oa.check_type());S=fa;if(Number.isInteger(this.def.num_args))if(0<this.def.num_args)Ah(S.length===J.length,"Unexpected number of arguments "+S.length+" != "+J.length);else for(Ah(S.length>=J.length,"Unexpected number of arguments "+S.length+" != "+J.length),fa=J.length;fa<S.length;++fa)if(S[fa]!==
J[J.length-1])throw new uj("Unexpected argument types expected arg: "+(fa+1)+": "+Cj(J[J.length-1])+" got "+Cj(S[fa]));for(fa=0;fa<S.length;++fa)if(S[fa]!==J[fa])throw new uj("Unexpected argument types expected arg: "+(fa+1)+": "+Cj(J[fa])+" got "+Cj(S[fa]));J=this.def.ret_type}return this.type=J}to_glsl(J){let S=[];var fa=Va[this.funcname];let oa=this.funcname;if(void 0!==fa){if(null===fa)throw new je("Function not supported in GLSL: "+this.funcname);if("string"===typeof fa)oa=fa;else if(fa.constructor===
Sa){var na=Nb[this.type];fa=fa.func_str.replace(/\$T/g,na);Wb.add(oa+"|"+na,{name:oa,text:fa})}}for(var ja of this.args)S.push(ja.to_glsl(J));if(-2>=this.def.num_args&&2<S.length){J="";na=-(2+this.def.num_args);for(ja=0;ja<na;++ja)J+=S[ja]+", ";ja="";fa=S.length;for(let Ba=na;Ba<fa-2;++Ba)ja+=oa+"("+J+S[Ba]+", ";ja+=oa+"("+J+S[fa-2]+", "+S[fa-1];return ja+=")".repeat(fa-1-na)}return oa+"("+S.join(",")+")"}}class Qa extends xj{constructor(J,S,fa){super();this.func_node=J;this.arg_nodes=fa;this.func_name=
S}eval(){let J=[];for(let S of this.arg_nodes)J.push(S.eval());Ah(void 0!==this.func_node.eval_func,"func node without eval_func");return this.func_node.eval_func(J)}check_type(){if(null!==this.type)return this.type;if(21!==this.func_node.check_type())throw new uj("Identifier "+this.func_name+" is not a function");let J=[];for(let S of this.arg_nodes)J.push(S.check_type());return this.type=this.func_node.func_ret_type(Aj(J))}clear_types_cache(){for(let J of this.arg_nodes)J.clear_types_cache();this.func_node.clear_types_cache()}to_glsl(J){let S=
[];for(let fa of this.arg_nodes)S.push(fa.to_glsl(J));return(void 0!==this.func_node.to_glsl_mutate_args?this.func_node.to_glsl_mutate_args(J,S):this.func_node.to_glsl(J))+"("+S.join(",")+")"}}class eb extends xj{constructor(J){super();this.v=J}}const mb={PI:new Ca(Math.PI,!0),"true":new Ga(!0),"false":new Ga(!1),"if":new eb("if"),"return":new eb("return")};class ub extends xj{constructor(J){super();this.token=J}}var Bb=[];class qb extends xj{constructor(J){super();this.name=J;this.type=this.valueNode=
null}eval(){if(null===this.valueNode)throw new je("Symbol "+this.name+" not assigned to yet");return this.valueNode.eval()}check_type(){if(null===this.type)throw new je("Symbol "+this.name+" not assigned to yet (type)");return this.type}to_glsl(){return this.name}}class yb extends xj{constructor(J,S,fa=null){super();this.wrapNode=J;if(null!==S){if(1!==S.length)throw new je("Only one subscript is supported");this.subname=S[0]}else null!==fa&&fa.constructor===ub?this.subname=fa.token:Ah(!1,"unexpected SubscriptNode without source");
this.subidx=Dj[this.subname];if(void 0===this.subidx)throw new je("unknown subscript: "+this.subname);}eval(){let J=this.wrapNode.eval()[this.subidx];if(void 0===J)throw new je("object doesn't have this subscript "+this.subname);return J}check_type(){const J=this.wrapNode.check_type();if(12!==J&&10!==J&&11!==J)throw new uj("Can't take subscript of something that's not a vector: "+Bh(J));return this.type=1}to_glsl(J){return this.wrapNode.to_glsl(J)+"."+Ej[this.subidx]}}class Ib{constructor(){this.type=
null;this.line=tj}sclear_types_cache(){this.type=null}invoke(){return null}}class Pb extends Ib{constructor(J,S,fa){super();this.cond_expr=J;this.true_code=S;this.else_code=fa}invoke(){const J=this.cond_expr.eval();let S=null;if(!0===J)null!==this.true_code&&(S=this.true_code.eval());else if(!1===J)null!==this.else_code&&(S=this.else_code.eval());else throw new je("Unexpected value from if condition "+S);return S}sclear_types_cache(){super.sclear_types_cache();this.cond_expr.clear_types_cache();null!==
this.true_code&&this.true_code.clear_types_cache();null!==this.else_code&&this.else_code.clear_types_cache()}scheck_type(){var J=this.cond_expr.check_type();Ah(2===J,"If statement with non-bool condition");let S=J=null;null!==this.true_code&&(J=this.true_code.check_type());null!==this.else_code&&(S=this.else_code.check_type());return null!==J&&null!=S?(Ah(J===S,"return different types: "+Bh(J)+" != "+Bh(S)),this.type=J):this.type=null}sto_glsl(J){let S="if ("+this.cond_expr.to_glsl(J)+") {\n";null!==
this.true_code&&(S+=this.true_code.to_glsl(J));null!==this.else_code&&(S=S+"} else {\n"+this.else_code.to_glsl(J));return S+"}\n"}}class Eb extends xj{constructor(J,S,fa){super();this.cond=J;this.true_node=S;this.false_node=fa}clear_types_cache(){this.type=null;this.cond.clear_types_cache();this.true_node.clear_types_cache();this.false_node.clear_types_cache()}check_type(){if(null===this.type){var J=this.cond.check_type();Ah(2===J,"Trinary expression with non-bool condition");J=this.true_node.check_type();
let S=this.false_node.check_type();Ah(J===S,"Trinary expression mismatch types "+Bh(J)+", "+Bh(S));this.type=J}return this.type}eval(){console.assert(null!==this.type);const J=this.cond.eval();if(!0===J)return this.true_node.eval();if(!1===J)return this.false_node.eval();throw new je("Unexpected value from trinary condition "+J);}to_glsl(J){return"(("+this.cond.to_glsl(J)+")?("+this.true_node.to_glsl(J)+"):("+this.false_node.to_glsl(J)+"))"}}class z extends Ib{constructor(J){super();this.e=J}invoke(){this.e.eval();
return null}sclear_types_cache(){super.sclear_types_cache();this.e.clear_types_cache()}scheck_type(){this.e.check_type();return null}sto_glsl(J){return this.e.to_glsl(J)}}class Xb extends Ib{constructor(J){super();this.expr=J;this.type=null}invoke(){return this.expr.eval()}sclear_types_cache(){super.sclear_types_cache();this.expr.clear_types_cache()}scheck_type(){return null!==this.type?this.type:this.type=this.expr.check_type()}sto_glsl(J){return"return "+this.expr.to_glsl(J)+";"}}const Nb={[1]:"float",
[12]:"vec2",[10]:"vec3",[11]:"vec4"};class Rb extends Ib{constructor(J,S){super();this.in_name=J;const fa=J.split(".");Ah(1==fa.length||2==fa.length,"Assigning to multi-level subscript not supported");this.name=fa[0];this.subscriptName=1<fa.length?fa[1]:null;this.subscriptIdx=1<fa.length?Dj[fa[1]]:null;Ah(void 0!==this.subscriptIdx,"Unknown subscript in: "+J);this.expr=S;this.expr_type=null;this.symbol=Fb[this.name];this.vNode=null;this.first_definition=!1;void 0===this.symbol&&(Ah(null===this.subscriptIdx,
"Can't set subscript of non existing symbol"),this.symbol=new qb(this.name),Fb[this.name]=this.symbol,this.first_definition=!0)}invoke(){var J=this.expr.eval();if(null!==this.subscriptIdx)Ah(null!==this.symbol.valueNode,"Assign to undefiend symbol"),this.symbol.valueNode.v[this.subscriptIdx]=J;else{switch(this.expr_type){case 1:J=new Ca(J,!1);break;case 2:J=new Ga(J);break;default:J=new Aa(J,this.expr_type)}this.symbol.valueNode=J}return null}sclear_types_cache(){super.sclear_types_cache();this.expr.clear_types_cache()}scheck_type(){this.expr_type=
this.expr.check_type();Ah(22!==this.expr_type,"Can't assing void return value",this.line);null!==this.subscriptIdx?(Ah(1===this.expr_type||2===this.expr_type,"Subscript assign to `"+this.in_name+"` expects a number",this.line),Ah(null!==this.symbol.type,"Trying to assign subscipt of an undefined symbol: "+this.name,this.line),Ah(1!==this.symbol.type&&2!==this.symbol.type,"Number type symbol `"+this.name+"` can't have subscript",this.line),Ah(this.subscriptIdx<zj(this.symbol.type),"Assigning to non-existing subscript "+
this.subscriptName+" of symbol "+this.name,this.line)):(null!==this.symbol.type&&Ah(this.symbol.type===this.expr_type,"Symbol `"+this.in_name+"` can't change type (from "+Bh(this.symbol.type)+" to "+Bh(this.expr_type)+")",this.line),this.symbol.type=this.expr_type);return this.type=null}sto_glsl(J){let S=this.name;null!==this.subscriptIdx&&(S+="."+Ej[this.subscriptIdx]);S+="="+this.expr.to_glsl(J)+";";this.first_definition&&(J.locals_defs[this.name]=this.expr_type);return S}}var Fb=null,Wb=null;class ib extends xj{constructor(J,
S){super();this.stmts=J;this.symbol_table=S}count(){return this.stmts.length}eval(){let J=null;for(let S of this.stmts)if(J=S.invoke(),null!==J)break;return J}clear_types_cache(){this.type=null;for(let J of this.stmts)J.sclear_types_cache()}check_type(){if(null!==this.type)return this.type;for(let J of this.stmts){const S=J.scheck_type();if(null!==S){this.type=S;break}}return this.type}to_glsl(J){let S="";for(let fa of this.stmts){let oa=fa.sto_glsl(J);S+=oa+"\n"}return S}}var rb=null,ab=0,ob=null;
return{parse:function(J,S,fa){if("string"!=typeof J)return new Ca(J,!0);if(""==J)throw new je("empty expression");ab=0;rb=J;tj=1;S&&(ob=S);J=null;try{if(1===fa)J=ua();else if(2==fa){Fb={};const oa=ra();Fb=null;J=oa}else throw new je("unknown opt "+fa);if(!(ab>=rb.length))throw new je("Syntax error: unexpected token, expected expression end");}catch(oa){for(;0!=Bb.length;)Bb.pop();throw oa;}finally{ob=null,tj=1}return J},make_num_node:function(J){return new Ca(J,!0)},check_type:function(J,S=!1){try{const fa=
J.check_type();if(null===fa)throw new je("Not all control paths return a value");return fa}catch(fa){if(fa.constructor===vj)return 100;if(fa.constructor===wj&&!S)return 101;throw fa;}},clear_types_cache:function(J){J.clear_types_cache()},do_eval:function(J){if(void 0!==J.symbol_table){Fb=J.symbol_table;for(let [,S]of Object.entries(J.symbol_table))S.valueNode=null}J=J.eval();Fb=null;return J},do_to_glsl:function(J,S,fa=null){Wb=new Fj;J=J.to_glsl(S);if(null===J)throw new je("No return statement");
1===fa&&(J="return "+J+";");fa=new Fj;for(let oa in Wb.get_kv()){const na=Wb.get(oa);fa.append_text(na.name,na.text)}S.add_funcs=fa;return J}}}();class Ij extends Td{constructor(a,b){super(a,b);this.kind=1;this.yoffset=a.height/2;this.xoffset=a.width+2;this.color="#b9ff50"}draw_path(a){const b=this.px(),l=this.py();Hc(a,[b+-6,l-8,b+4,l-8,b+9,l,b+4,l+8,b+-6,l+8,b+-6,l-8])}}
class ze extends Rd{constructor(a,b){super(a,b);this.kind=1;this.yoffset=a.height/2;this.xoffset=-4;this.color="#b9ff50";this.my_vsb=new Jj;this.h=null}draw_path(a,b){if(0!=this.lines.length||b){b=this.px();var l=this.py();Hc(a,[b-4,l-9,b+4,l-9,b+4,l+9,b-4,l+9,b-4,l-9])}}collect_terminal(){for(var a in this.my_vsb.vb)this.my_vsb.vb[a].valive=!1;for(var b of this.lines)a=b.from_term.get_ctrl_block(),Sd(null!==a,b.from_term.owner.cls,"No output from node "+b.from_term.owner.name),a.po.weak_var&&this.intr_set(a,
0,!0);for(let l of this.lines)b=l.from_term.get_ctrl_block(),b.po.weak_var||this.intr_set(b,0,!1);for(let l in this.my_vsb.vb)this.my_vsb.vb[l].valive||delete this.my_vsb.vb[l]}intr_set(a,b,l){a=a.po;Sd(a.constructor===Jj,this.owner.cls,"Unexpected object type");b=!1;for(let e in a.vb){const f=this.my_vsb.vb[e],h=void 0!==f;h&&(f.valive=!0);l&&h||h&&Kj(a.vb[e],f)||(b=Kd(a.vb[e]),b.mark_dirty_now(),this.my_vsb.vb[e]=b,b=b.valive=!0)}this.tset_dirty(b)}is_dirty(){return this.dirty}}
function Kj(a,b){if(a.type!==b.type)return!1;switch(a.type){case 2:case 1:return a.v===b.v;case 12:return Ff.equals(a.v,b.v);case 10:return Hj.equals(a.v,b.v);case 11:return Oh.equals(a.v,b.v);case 13:return Qh.equals(a.v,b.v)}throw Error("VarBox unknown type in vb_equals");}class Lj{constructor(a,b){this.name=b;this.vso=a;++this.vso.vb[b].vref_count}destroy(){if(null!==this.vso){var a=this.vso.vb[this.name];0===--a.vref_count&&(a.vbset_invalid(),this.vso.remove(this.name));this.vso=null}}}
class Mj{constructor(){this.vdirtied_at_ver=this.type=this.v=null;this.pulse_need_reset=!1;this.vref_count=0;this.valive=!1}vbset(a,b){this.v=a;this.type=b;this.vdirtied_at_ver=Nj}vbget(){return this.v}vbset_invalid(){this.type=this.v=null;this.vdirtied_at_ver=Nj}mark_dirty_now(){this.vdirtied_at_ver=Nj}trigger(){this.pulse_need_reset=!0;this.vbset(!0,2)}vis_dirty(){let a=this.vdirtied_at_ver==Nj;!a&&this.pulse_need_reset&&(this.vbset(!1,2),this.pulse_need_reset=!1,a=this.vdirtied_at_ver==Nj);return a}}
class Jj extends yd{static name(){return"Variables"}constructor(a){super();this.vb={};this.weak_var=a}lookup(a){a=this.vb[a];return void 0!==a?a:null}exists(a){return void 0!==this.vb[a]}set_value(a,b,l){if(void 0===this.vb[a]){const e=new Mj;this.vb[a]=e;e.vbset(b,l)}else this.vb[a].vbset(b,l)}make_ref(a){return new Lj(this,a)}add(a,b){this.vb[a]=b}remove(a){delete this.vb[a]}clear(){this.vb={}}draw(){}draw_selection(){}draw_template(){}describe(a,b){b.clear_desc();a=Ce(a,"obj_inf_grid");for(let e in this.vb){b=
this.vb[e];var l=b.v;Ce(a,"obj_inf_var_label").innerText=e;const f=Ce(a,"obj_inf_var_value");let h=[];switch(b.type){case 1:l=Rg(l);break;case 12:case 10:case 11:for(let g=0;g<l.length;++g)h.push(Rg(l[g]));l=h.join(", ");break;case 2:l=l?"true":"false";break;case 13:l=Oj(l);f.classList.add("obj_inf_var_matrix");break;default:l=b.v}f.innerText=l;Ce(a,"obj_inf_var_type").innerText=Bh(b.type)}}}
function Oj(a){const b=[];for(var l=0;9>l;++l)b[l]=Rg(a[l]);a=[Math.max(b[0].length,b[1].length,b[2].length),Math.max(b[3].length,b[4].length,b[5].length),Math.max(b[6].length,b[7].length,b[8].length)];l="";for(let e=0;3>e;++e){for(let f=0;3>f;++f){const h=e+3*f;l+=b[h]+" ".repeat(a[f]-b[h].length+2)}l+="\n"}return l}
class Gj extends yj{constructor(a,b){super();this.varname=a;this.var_box=null;this.line_num=b;this.name_reused_error=!1}is_valid(){return!this.name_reused_error}consumes_subscript(){return!1}eval(){if(null===this.var_box)throw new je("Unknown identifier "+this.varname);return this.var_box.vbget()}check_type(){Ah(!this.name_reused_error,"Identifier "+this.varname+" should not be used as both variable and local symbol",this.line_num);if(null===this.var_box)throw new wj("Unknown identifier "+this.varname);
return this.var_box.type}to_glsl(a){if(null===this.var_box)throw new wj("Unknown identifier "+this.varname);a.add_uniform(this.var_box.type,this.varname,this);return this.varname}}class qe extends ye{constructor(a){super(a);a.can_display=!1;a.can_input=!1;a.can_enable=!1;a.name_xmargin=8;a.width=80;a.nkind=1;this.var_out=new Ij(a,"variable_out")}out_single_var(a,b,l){const e=new Jj,f=new Mj;e.add(a,f);f.vbset(l,b);this.var_out.set(e)}}
class Pj extends qe{static name(){return"Variable"}constructor(a){super(a);this.namer=new nh(a,"<obj-store>",{gen_id:2,prms_lst:[1]},()=>{for(var b of this.vars_prm)for(let l of b.params)a.remove_param(l);this.vars_prm.length=0;b=[...this.namer.v.prms_lst];this.namer.v.prms_lst.length=0;for(let l of b)this.add_variable(a,l);this.v_group.update_elems()});this.global_checkbox_override=null;this.global=new qh(a,"Global Namespace",!1,b=>{null!==this.global_checkbox_override?this.global_checkbox_override(b):
(a.can_enable=b,gd())},{allow_expr:!1});this.brief=new qh(a,"Brief View",!1,b=>{this.set_brief(b)},{allow_expr:!1});this.brief.share_line_elem_from(this.global);this.v_group=new Xi(a,"vars_params");this.vars_prm=[];this.add_prm_btn=new Wi(a,"[+]",()=>{this.add_variable(a);this.v_group.update_elems()},["param_btn","param_var_add_btn"]);a.register_rename_observer(b=>{1==this.vars_prm.length&&this.vars_prm[0].name.modify(b)});this.cur_glob_refs=[];this.set_only_if_missing=!1}toggle_enable_flag(a,b=null){this.node.of_program.set_glob_var_node(this.node,
a,null!==b?b:!this.node.enable_active);this.node.enable_active||this.del_cur_refs()}set_brief(a){this.add_prm_btn.set_visible(!a);for(var b of this.vars_prm){b.type.set_visible(!a);b.remove_btn.set_visible(!a);b.name.set_visible(!a);b.mouseState.set_visible(!a&&3==b.type.sel_idx);b.sep.set_visible(!a);b.up_btn.set_visible(!a);b.down_btn.set_visible(!a);for(var l of"expr_float expr_int expr_vec2 expr_vec2_mouse expr_color expr_bool".split(" "))a?(void 0===b[l].label_display_bak&&(b[l].label_display_bak=
b[l].label_display),b[l].label_display=b.name.get_value()):void 0!==b[l].label_display_bak&&(b[l].label_display=b[l].label_display_bak)}null!==this.node.is_selected_inf&&(a=this.node,b=a.is_selected_inf.param_elem,l=Cd("params_node"),b.parentNode.insertBefore(l,b.nextSibling),te(a),re(a,l))}post_load_hook(){this.brief.v&&this.set_brief(!0)}any_prm_need_input(){for(let a of this.vars_prm)if(3===a.type.sel_idx||4==a.type.sel_idx)return!0;return!1}add_variable(a,b=null){null===b&&(b=this.namer.v.gen_id++);
const l="p"+b+"_",e={};e.id=b;this.namer.v.prms_lst.push(b);this.vars_prm.push(e);e.p_group=new Xi(a,l+"group");e.p_group.set_group(this.v_group);e.type=new Ti(a,["Type",l],0,"Float Integer Float2 Float2-Mouse Float2-Mouse-Delta Color Bool Bool-Pulse Transform".split(" "),f=>{e.expr_float.set_visible(0===f);e.expr_int.set_visible(1===f);e.expr_vec2.set_visible(2===f);e.expr_vec2_mouse.set_visible(3===f||4===f);e.mouseState.set_visible(3===f||4===f);e.expr_color.set_visible(5===f);e.expr_bool.set_visible(6===
f);e.btn_bool_pulse.set_visible(7===f);e.expr_trans.set_visible(8===f);f=a.can_input;a.can_input=this.any_prm_need_input();f!=a.can_input&&(gd(),!a.can_input&&a.receives_input&&this.node.of_program.set_input_node(a))});e.remove_btn=new Wi(a,["[-]",l],()=>{se(this.vars_prm,e);xe(this.namer.v.prms_lst,e.id);for(let f of e.params)a.remove_param(f);this.v_group.update_elems();this.v_group.pset_dirty()},["param_btn","param_var_rm_btn"]);e.remove_btn.share_line_elem_from(e.type);e.up_btn=new Wi(a,["[/\\]",
l],()=>{this.move_variable(b,-1)},["param_btn","param_var_arrow","param_var_up_btn"]);e.up_btn.share_line_elem_from(e.type);e.down_btn=new Wi(a,["[\\/]",l],()=>{this.move_variable(b,1)},["param_btn","param_var_arrow","param_var_down_btn"]);e.down_btn.share_line_elem_from(e.type);e.name=new oh(a,["Name",l],"var",f=>{1==this.vars_prm.length&&(a.set_name(f),gd())});e.expr_float=new Gh(a,["Float",l],1,{min:0,max:2});e.expr_int=new Hh(a,["Integer",l],1,{min:0,max:10});e.expr_vec2=new Jh(a,["Float2",l],
0,0);e.expr_color=new Nh(a,["Color",l],"#cccccc");e.expr_vec2_mouse=new Jh(a,["Mouse Coord",l],0,0);e.expr_vec2_mouse.set_enable(!1);e.expr_bool=new qh(a,["Bool",l],!1);e.btn_bool_pulse=new Wi(a,["Trigger",l],()=>{e.vb.trigger();e.btn_bool_pulse.pset_dirty()});e.expr_trans=new Ph(a,["Transform",l]);e.mouseState=new Ti(a,["Sample At",l],0,["Mouse left down","Mouse move"]);e.sep=new mh(a,l+"sep","param_sep_line");e.params=[e.p_group,e.type,e.remove_btn,e.up_btn,e.down_btn,e.name,e.expr_float,e.expr_int,
e.expr_vec2,e.expr_color,e.expr_vec2_mouse,e.expr_bool,e.btn_bool_pulse,e.expr_trans,e.mouseState,e.sep];for(let f of e.params)f!==e.p_group&&(f.set_group(e.p_group),f.call_change());return e}get_sorted_labels(a){if(a!==this.v_group)return null;a=[];for(let b of this.namer.st_get("prms_lst"))a.push("p"+b+"_group");return a}move_variable(a,b){let l=this.namer.st_get("prms_lst");const e=l.indexOf(a);-1===e&&console.error("didn't find index of ",a);0>e+b||e+b>=l.length||(l.splice(e,1),l.splice(e+b,0,
a),this.v_group.update_elems())}run(){var a=new Set;for(var b of this.vars_prm){const l=b.name.v;Sd(0<l.length,this,"Name can't be empty");Sd(!a.has(l),this,"Name defined multiple times: "+l);a.add(l)}a=new Jj(this.set_only_if_missing);if(b=this.global.get_value()){if(!this.node.enable_active){this.del_cur_refs();this.var_out.set(a);return}this.set_all_values(tg.globals_vars_box)}this.set_all_values(a);this.manage_global_refs(b);this.var_out.set(a)}set_all_values(a){for(let b of this.vars_prm){const l=
b.name.v;if(!this.set_only_if_missing||!a.exists(l))switch(b.type.sel_idx){case 0:a.set_value(l,b.expr_float.get_value(),1);break;case 1:a.set_value(l,b.expr_int.get_value(),1);break;case 2:a.set_value(l,b.expr_vec2.get_value(),12);break;case 3:case 4:a.set_value(l,b.expr_vec2_mouse.get_value(),12);break;case 5:a.set_value(l,ei(b.expr_color.v),11);break;case 6:a.set_value(l,b.expr_bool.get_value(),2);break;case 8:a.set_value(l,b.expr_trans.get_value(),13)}}}manage_global_refs(a){const b=[];if(a)for(let l of this.vars_prm)b.push(tg.globals_vars_box.make_ref(l.name.v));
this.del_cur_refs();this.cur_glob_refs=b}del_cur_refs(){if(0!==this.cur_glob_refs.length){for(let a of this.cur_glob_refs)a.destroy();this.cur_glob_refs=[]}}destructor(){this.del_cur_refs()}inputevent(a,b){let l=!1;if("mouseup"==a)for(let e of this.vars_prm)4===e.type.sel_idx&&e.expr_vec2_mouse.modify_e(0,0,!0,!0);else{if("mousedown"==a&&0==b.e.button)for(let e of this.vars_prm)0==e.mouseState.sel_idx&&(l=!0);a=(e,f)=>{3===f.type.sel_idx?(e=rf.epnt_to_model(e.ex,e.ey),f.expr_vec2_mouse.modify(e)):
4===f.type.sel_idx?f.expr_vec2_mouse.modify_e(e.dx,e.dy,!0,!0):Sd(!1,this,"unexpected type")};for(let e of this.vars_prm)if(3===e.type.sel_idx||4===e.type.sel_idx)0!=e.mouseState.sel_idx||0==(b.buttons&1)||!l&&!0!==b.img_canvas_capture?1==e.mouseState.sel_idx&&a(b,e):a(b,e);return l}}}
class Qj extends qe{static name(){return"Variable Step"}constructor(a){super(a);a.set_state_evaluators({prev_value:(b,l)=>new Rj(b,l)});this.type=new Ti(a,"Type",0,[["Float",1],["Float2",12]],b=>{this.start_float.set_visible(0===b);this.update_float.set_visible(0===b);this.start_vec2.set_visible(1===b);this.update_vec2.set_visible(1===b)});this.name=new oh(a,"Name","var");this.reset_cond=new qh(a,"Reset Condition",!1,null,{expr_visible:!0});this.start_float=new Gh(a,"Start Float",0);this.start_vec2=
new Jh(a,"Start Float2",0,0);this.update_float=new Gh(a,"Update Float",0);this.update_vec2=new Jh(a,"Update Float2",0,0);this.v=[{value:null,prm_start:this.start_float,prm_update:this.update_float,make_ret:b=>b[0]},{value:null,prm_start:this.start_vec2,prm_update:this.update_vec2,make_ret:b=>Ff.fromValues(b[0],b[1])}]}run(){var a=this.type.sel_idx,b=this.v[a];null===b.value||this.reset_cond.get_value()?(b.value=b.prm_start.get_value(),0===a&&(b.value=[b.value])):(a=b.prm_update.need_input_evaler("prev_value"),
null!==a&&a.dyn_set_obj(b.value),b.value=b.prm_update.dyn_eval());b=b.make_ret(b.value);this.out_single_var(this.name.get_value(),this.type.get_sel_val(),b)}}function Sj(a,b){const l=new ij;l.set("vtx_pos",new di([-a,-b,-a,b,a,b,a,-b]),2);l.set("idx",new bj([0,1,2,0,2,3]));l.set_type(2);return l}
class Tj extends ye{static name(){return"Geom Primitive"}constructor(a){super(a);this.out=new Td(a,"out_mesh");this.shape=new Ti(a,"Shape",0,["Rectangle","Rectangle from triangles","Ellipse","Regular Poly","Star"],b=>{this.num_points.set_visible(3==b||4==b);this.inner_point.set_visible(4==b);this.center_inner_btn.set_visible(4==b)});this.size=new Jh(a,"Size",.5,.5);this.num_points=new Hh(a,"Num Points",5,[3,12]);this.inner_point=new Jh(a,"Inner Point",.226,-.311);this.center_inner_btn=new Wi(a,"Center",
()=>{const b=.5/this.num_points.v*Math.PI*2;var l=this.inner_point.x;var e=this.inner_point.y;l=Math.sqrt(l*l+e*e);this.inner_point.modify(Ff.fromValues(l*Math.sin(b),-l*Math.cos(b)))});this.center_inner_btn.share_line_elem_from(this.inner_point);this.transform=new Ph(a,"Transform");this.inner_dial=new Th((b,l)=>{this.inner_point.increment(Ff.fromValues(b/this.size.x*2,l/this.size.y*2))})}run(){Sd(this.transform.is_valid(),this,"invalid transform");var a=.5*this.size.x,b=.5*this.size.y;if(0==this.shape.sel_idx){var l=
new ij;l.set("vtx_pos",new di([-a,-b,-a,b,a,b,a,-b]),2);l.set("idx",new bj([0,1,2,3]));l.set_type(1)}else if(1==this.shape.sel_idx)l=Sj(a,b);else if(2==this.shape.sel_idx)l=new Uj,l.set("vtx_pos",new di([a,0,0,-b,-a,0,0,b]),2),b=2*(Math.sqrt(2)-1)/3,a=this.size.x*b,b*=this.size.y,l.set("ctrl_to_prev",new di([0,b,a,0,0,-b,-a,0]),2),l.set("ctrl_from_prev",new di([a,0,0,-b,-a,0,0,b]),2),l.paths_ranges=[0,4,1];else if(3==this.shape.sel_idx||4==this.shape.sel_idx){a=[];b=this.num_points.v;l=.5*this.size.x;
const h=.5*this.size.y,g=4==this.shape.sel_idx;var e=Ff.fromValues(this.inner_point.x,this.inner_point.y);const m=Math.atan2(this.inner_point.y,this.inner_point.x)+Math.PI/2;e=Ff.len(e);for(let q=0;q<b;++q){var f=q/b*Math.PI*2;a.push(l*Math.sin(f),-h*Math.cos(f));g&&(f=m+q/b*Math.PI*2,a.push(l*e*Math.sin(f),-h*e*Math.cos(f)))}g||3!=b&&4!=b?(l=new Uj,l.paths_ranges=[0,b*(g?2:1),1]):(l=new ij,3==b?(l.type=2,l.arrs.idx=[0,1,2]):(l.type=1,l.arrs.idx=[0,1,2,3]));l.set("vtx_pos",new di(a),2)}else Sd("unknown shape");
l.transform(this.transform.v);this.out.set(l)}draw_selection(a){let b=this.out.get_const();null!==b&&(this.transform.draw_dial_at_obj(b,a),this.size.size_dial_draw(this.transform.v,a),4==this.shape.sel_idx&&this.inner_dial.draw(this.inner_point.x*this.size.x/2,this.inner_point.y*this.size.y/2,this.transform.v,a))}image_find_obj(a){let b=this.transform.dial.find_obj(a)||this.size.size_dial_find_obj(a);return b?b:4==this.shape.sel_idx?this.inner_dial.find_obj(a):null}}
class Vj{constructor(a,b,l){this.list_param=a;this.index=b;this.ofnode=l}mousedown(){this.ofnode.point_mousedown?this.ofnode.point_mousedown(this.index):this.ofnode.set_selection(this.index);le(!1)}mouseup(){}mousemove(a){for(let b of Fc)b.cls.move_selection(a)}}
function Wj(a,b,l){a.image_find_obj=function(f){let [h,g]=rf.epnt_to_model(f.ex,f.ey),m=Math.max(7,aj.vtx_radius)/rf.viewport_zoom,q=l.count();for(let r=0;r<q;++r){let [B,D]=l.get_value(2*r);if(null!==B&&Math.max(Math.abs(B-h),Math.abs(D-g))<m)return new Vj(this.points,r,this)}return a.image_find_additional?a.image_find_additional(f):null};a.move_selection=function(f){for(let h of b)l.increment(h,[f.dx,f.dy]);le(!0)};a.clear_selection=function(){b.length=0;le(!1);l.reprint_all_lines()};a.set_selection=
function(f){b.includes(f)||(b.length=0,b.push(f));l.reprint_all_lines()};let e=null;a.rect_select=function(f,h,g,m){if(void 0===f&&null!==e)De.removeChild(e),e=null;else{var [q,r]=rf.epnt_to_model(f,h),[B,D]=rf.epnt_to_model(g,m),F=l.count();b.length=0;for(let G=0;G<F;++G){let [N,T]=l.get_value(2*G);N>q&&N<B&&T>r&&T<D&&b.push(G)}null===e&&(e=Ce(De,"selection_rect"));e.style.left=f+"px";e.style.top=h+"px";e.style.width=g-f+"px";e.style.height=m-h+"px";le(!1);l.reprint_all_lines()}};a.draw_selection=
function(f){let h=this.out.get_const();if(null!==h){var g=b;void 0!==l.translate_idx_to_obj&&(g=l.translate_idx_to_obj(g));h.draw_selection(f,g)}}}
class Xj{constructor(a,b,l,e){this.points_lst=a;this.ctrl_lst=b;this.prev_point=l;this.path_ranges=e;this.selected_indices=[];Wj(this,this.selected_indices,this)}count(){return this.ctrl_lst.count()}get_value(a){const b=this.ctrl_lst.get_value(a);if(0==b[0]&&0==b[1])return[null,null];this.prev_point&&(a=2*this.path_ranges.get_prev_point_in_path(a/2));a=this.points_lst.get_value(a);return[a[0]+b[0],a[1]+b[1]]}increment(a,b){this.ctrl_lst.increment(a,b)}reprint_all_lines(){}}
class Yj extends wg{constructor(a,b,l=null){super(a,b);this.v=[];this.loaded_v=null;this.change_func=l}save(){const a=[];for(let b of this.v)a.push({label:b.label,ctor:b.constructor.name});return{v:a}}load(a){this.loaded_v=a.v}add_elems(){}sl_add(a){this.v.push(a);this.pset_dirty()}sl_remove(a){se(this.v,a);this.pset_dirty()}}
class Zj extends ye{static name(){return"Manual Geometry"}constructor(a){super(a);this.selected_indices=[];this.pnt_attrs=[];this.out=new Td(a,"out_mesh");this.columns_store=new Yj(a,"col_store",()=>{if(null!==this.columns_store.loaded_v){a.remove_param(this.color);this.table.del_column(this.color.column_key,!1);this.color=null;this.columns_store.v.length=0;this.pnt_attrs.length=0;var b=this.columns_store.loaded_v;for(let l of b)this.add_additional_column(a,l.label,window[l.ctor],!1);this.columns_store.loaded_v=
null}});this.geom_type=new Ti(a,"Type",0,["Mesh","Paths"]);this.add_pnts_btn=new qh(a,"Add points",!0,null,{allow_expr:!1,as_btn:!0});this.add_col_btn=new $i(a,"Add Column",["Curve Controls","Float","Vec2","Color"],(b,l)=>{0===l&&null===this.cfp?(this.add_additional_column(a,"ctrl_from_prev",ParamCoordList,!0),this.add_additional_column(a,"ctrl_to_prev",ParamCoordList,!0)):1===l?this.add_additional_column(a,"vtx_radius",ParamFloatList,!0):2===l?this.add_additional_column(a,"vtx_normal",ParamCoordList,
!0):3===l&&this.add_additional_column(a,"line_color",ParamColorList,!0)});this.add_col_btn.share_line_elem_from(this.add_pnts_btn);this.table=new Oi(a,"Point List");this.table.with_column_title=!0;this.table.on_remove_column=b=>{this.remove_column(b)};this.points=new ParamCoordList(a,"vtx_pos",this.table,this.selected_indices);this.color=this.add_additional_column(a,"vtx_color",ParamColorList,!1);this.cfp=this.ctp=null;this.paths_ranges=new ak(a);a.param_alias("Coord",this.points);a.param_alias("Point Color",
this.color);Wj(this,this.selected_indices,this.points);this.cfp_select=this.ctp_select=null}remove_column(a){this.node.remove_param(a);this.table.del_column(a.column_key,!0);this.columns_store.sl_remove(a);se(this.pnt_attrs,a)}image_find_additional(a){return null!==this.cfp_select?this.cfp_select.image_find_obj(a)||this.ctp_select.image_find_obj(a):null}col_name_exists(a){for(let b of this.node.parameters)if(b.label===a)return!0;return!1}add_additional_column(a,b,l,e){if(this.col_name_exists(b)){let f=
2;for(;this.col_name_exists(b+f);)++f;b+=f}a=new l(a,b,this.table);a.allow_title_edit=!0;if(e)for(this.table.remake_table(),e=a.get_def_val(),l=0;l<this.points.count();++l)a.add(e);this.pnt_attrs.push(a);this.columns_store.sl_add(a);"ctrl_from_prev"===b?this.cfp_select=new Xj(this.points,a,!0,this.paths_ranges):"ctrl_to_prev"===b&&(this.ctp_select=new Xj(this.points,a,!1,null));return a}image_click(a,b){if(this.add_pnts_btn.v){a=rf.epnt_to_model(a,b);this.points.add(a);for(let l of this.pnt_attrs)l.add(l.get_def_val());
this.paths_ranges.add_default();le(!0)}}point_mousedown(a){this.add_pnts_btn.v&&1==this.geom_type.sel_idx&&this.paths_ranges.close_current(a)?le(!0):this.set_selection(a)}selected_obj_name(){return 0<this.selected_indices.length?"points":null}delete_selection(){this.points.remove(this.selected_indices);for(let a of this.pnt_attrs)a.remove(this.selected_indices);this.paths_ranges.remove(this.selected_indices);this.clear_selection();le(!0)}run(){let a;0==this.geom_type.sel_idx?(a=new ij,a.type=3):1==
this.geom_type.sel_idx?(a=new Uj,a.paths_ranges=this.paths_ranges.lst.slice()):Sd(!1,this,"unexpected type");a.set("vtx_pos",this.points.lst,2);for(let b of this.pnt_attrs)a.set(b.label,b.lst,b.values_per_entry,b.pneed_normalize);this.out.set(a)}}class ie{constructor(a){this.name=a;this.idx=this.obj=null;this.dirty_obj_ver=1}dyn_set_obj(a){this.obj=a;++this.dirty_obj_ver}dyn_set_prop_index(a){this.idx=a}}
class bk extends yj{constructor(a,b){super();if(0!=b.length)throw Error("Unexpected subscript given to variable");this.objref=a}consumes_subscript(){return!0}eval(){return this.objref.obj[0]}check_type(){if(null===this.objref.obj)throw new vj;return 1}}
class Rj extends yj{constructor(a,b){super();this.objref=a;this.subscript=0<b.length?b[0]:null;this.type=null}consumes_subscript(){return!0}eval(){if(null===this.subscript)return Ah(void 0!==this.objref.obj.length,"object is not an array"),[...this.objref.obj];Ah(null!==this.objref.obj,"object not set");let a=this.objref.obj[this.subscript];Ah(void 0!==a,"subscript not found "+this.subscript);return a}eval_func(a){Ah(this.type=21,"eval_func to not a function");Ah(void 0!==this.objref.obj._call_at,
"Missing _call_at");return this.objref.obj._call_at(...a)}obj_vec_type(){if(null===this.objref.obj)throw new vj;Ah(void 0!==this.objref.obj.length,"Missing length");return ck(this.objref.obj.length)}check_type(){return this.type=null===this.subscript?this.obj_vec_type():"at"===this.subscript?21:1}func_ret_type(){return this.obj_vec_type()}}function ck(a){switch(a){case 1:return 1;case 2:return 12;case 3:return 10;case 4:return 11}}
class dk extends yj{constructor(a,b,l){super();console.assert(void 0!==a&&null!==a);Ah(2==b.length||1==b.length,"Not enough subscript given to variable "+name);this.meshref=a;this.param_bind_to=l;this.attrname=b[0];"index"==this.attrname?(Ah(1==b.length,"unexpected additional subscript to value"),this.valindex=-1):(this.valname=2==b.length?b[1]:null,this.valindex=null!==this.valname?Dj[this.valname]:0,Ah(void 0!==this.valindex,"Unknown subscript `"+this.valname+"`"));this.num_elems=this.attr=null;
this.last_obj_ver=0;this.type=null}consumes_subscript(){return!0}resolve_attr(){if(-1!==this.valindex&&(null===this.type||null===this.attr||this.last_obj_ver!==this.meshref.dirty_obj_ver)){Ah(null!==this.meshref.obj,"unexpected null object");0==this.param_bind_to.sel_idx?Ah(this.attrname.startsWith("vtx_"),"bind to Vertices can only sample vertex attribute: "+this.attrname):1==this.param_bind_to.sel_idx&&Ah(this.attrname.startsWith("face_"),"bind to Faces can only sample face attribute: "+this.attrname);
var a=this.meshref.obj.arrs[this.attrname];void 0===a&&void 0!==this.meshref.obj.computed_prop&&(a=this.meshref.obj.computed_prop(this.attrname));Ah(void 0!==a&&null!==a,"unknown attribute "+this.attrname+" of object");void 0===a.computed_value?(this.num_elems=this.meshref.obj.meta[this.attrname].num_elems,1==this.num_elems&&Ah(null===this.valname,"unexpected additional subscript to value"),null===this.valname&&(this.type=ck(this.num_elems))):null===this.valname&&(this.type=a.computed_type());this.attr=
a;this.last_obj_ver=this.meshref.dirty_obj_ver}}eval(){Ah(null!==this.meshref.idx,"unexpected null object");Ah(null!==this.type,"unexpected null type");this.resolve_attr();if(-1===this.valindex)return this.meshref.idx;if(void 0!==this.attr.computed_value){var a=this.attr.computed_value(this.meshref.idx);return null===this.valname?a:a[this.valindex]}a=this.meshref.idx*this.num_elems;switch(this.type){case 1:return this.attr[a+this.valindex];case 12:return Ff.fromValues(this.attr[a],this.attr[a+1]);
case 10:return Hj.fromValues(this.attr[a],this.attr[a+1],this.attr[a+2]);case 11:return Hj.fromValues(this.attr[a],this.attr[a+1],this.attr[a+2],this.attr[a+3])}Ah(!1,"unexpected num_elems "+this.num_elems)}check_type(){if(0<=this.valindex&&null===this.valname){if(null===this.meshref.obj)throw new vj;this.resolve_attr();Id(null!==this.type,"resolve_attr didn't set type (bug)")}else{if(null===this.meshref.idx)throw new vj;this.type=1}return this.type}}
class ek extends ye{static name(){return"Set Attribute"}constructor(a){super(a);this.in_mesh=new Rd(a,"in_obj");this.in_source=new Rd(a,"in_src");this.out_mesh=new Td(a,"out_mesh");a.set_state_evaluators({in_src:(b,l)=>new Rj(b,l),in_obj:(b,l)=>new dk(b,l,this.bind_to)});this.name_per_type=new nh(a,"npt",{0:"color",1:"radius",2:"normal",3:"fill",4:"transform"});this.bind_to=new Ti(a,"Bind To",0,[["Vertices","vtx_"],["Faces","face_"],["Lines","line_"]]);this.attr_type=new Ti(a,"Type",0,["Color","Float",
"Float2","Image Fill","Transform"],b=>{var l=this.attr_type.sel_idx;this.expr_color.set_visible(0==l);this.expr_float.set_visible(1==l);this.expr_vec2.set_visible(2==l);this.expr_bool.set_visible(3==l);this.expr_transform.set_visible(4==l);l=this.param_of_index[l];void 0!==l.show_code?this.edit_code.modify(l.show_code):this.edit_code.modify(!1);this.attr_name.modify(this.name_per_type.st_get(b))});this.edit_code=new qh(a,"Edit code",!1,b=>{const l=this.param_of_index[this.attr_type.sel_idx];l.set_show_code&&
l.set_show_code(b)},{allow_expr:!1});this.edit_code.share_line_elem_from(this.attr_type);this.attr_name=new oh(a,"Name","color",b=>{this.name_per_type.st_set(this.attr_type.sel_idx,b)});this.expr_color=new Nh(a,"Color",[gi.hex,gi.rgb]);this.expr_float=new Gh(a,"Float",0);this.expr_vec2=new Jh(a,"Float2",0,0,!0);this.expr_bool=new Gh(a,"Select","1.0");this.expr_transform=new Ph(a,"Transform");this.param_of_index=[this.expr_color,this.expr_float,this.expr_vec2,this.expr_bool,this.expr_transform];a=
b=>{this.edit_code.modify(b)};for(let b of this.param_of_index)void 0!==b.show_code_callback&&(b.show_code_callback=a)}prop_from_const(a,b,l,e){if(0==this.attr_type.sel_idx)for(l=l.v,e=0;e<b.length;e+=b.elem_sz)b[e]=l.r,b[e+1]=l.g,b[e+2]=l.b,b[e+3]=l.alphai;else if(1==this.attr_type.sel_idx)b.fill(l.v);else if(2==this.attr_type.sel_idx)for(e=0;e<b.length;e+=b.elem_sz)b[e]=l.x,b[e+1]=l.y;else if(3==this.attr_type.sel_idx)a=[],e(a,0,l.v),0!==l.v&&b.fill(a[0]);else if(4==this.attr_type.sel_idx)for(a=
0;a<b.length;a+=b.elem_sz)e(b,a,l.v);else Sd(!1,this,"unknown attr")}prop_from_mesh_attr(a,b,l,e){for(let f=0,h=0;h<a.length;++f,h+=a.elem_sz){b.dyn_set_prop_index(f);let g=l.dyn_eval();e(a,h,g)}}prop_from_input_framebuffer(a,b,l,e,f,h,g){l.do_get_pixels();let m=l.width(),q=l.height();b.ensure_tcache(l.transform);let r=b.tcache.vtx_pos;const B=0===this.bind_to.sel_idx||2==this.bind_to.sel_idx;let D=0,F=[0,0,0,0];F._call_at=function(){return l.sample_at(...arguments)};e.dyn_set_obj(F);e=l.pixels;for(let T=
0,V=0;V<a.length;++T,V+=a.elem_sz){var G=0,N=0;if(B)G=r[D++],N=r[D++];else{let E=b.vidxs_of_face(T);for(let Q of E)G+=r[Q],N+=r[Q+1];G/=E.length;N/=E.length}G=Math.round(G);N=Math.round(N);null!==f&&f.dyn_set_prop_index(T);0>G||0>N||G>=m||N>=q?F[0]=F[1]=F[2]=F[3]=0:(N=4*(N*m+G),F[0]=e[N],F[1]=e[N+1],F[2]=e[N+2],F[3]=e[N+3]);N=h.dyn_eval();g(a,V,N)}}async run(){Sd(-1!=this.bind_to.sel_idx,this,"'Bind To' not set");var a=this.in_mesh.get_const();Sd(a,this,"missing in_mesh");Sd(a.constructor===ij||a.constructor===
Uj,this,"Expected input geometry");let b=this.bind_to.get_sel_val();if(1==this.bind_to.sel_idx){var l=a.face_count();if(0==l){this.out_mesh.set(a);return}}else l=a.vtx_count();b+=this.attr_name.v;var e=null;let f=null,h=null,g=!1;if(0==this.attr_type.sel_idx)e=new fi(4*l),e.elem_sz=4,f=this.expr_color,h=(B,D,F)=>{for(let G=0;4>G;++G)B[D+G]=F[G]},g=!0;else if(1==this.attr_type.sel_idx)e=new Float32Array(1*l),e.elem_sz=1,f=this.expr_float,h=(B,D,F)=>{B[D]=F};else if(2==this.attr_type.sel_idx)e=new Float32Array(2*
l),e.elem_sz=2,f=this.expr_vec2,h=(B,D,F)=>{B[D]=F[0];B[D+1]=F[1]};else if(3==this.attr_type.sel_idx){e=a.arrs[b];void 0!==e?(Sd(e.length==l,this,"unexpected existing prop size"),e=new Uint16Array(e)):e=new Uint16Array(l);e.elem_sz=1;f=this.expr_bool;let B=this.set_image_fill(b,l);h=(D,F,G)=>{0!==G&&(D[F]=B)}}else 4==this.attr_type.sel_idx?(f=this.expr_transform,e=new Float32Array(6*l),e.elem_sz=6,h=(B,D,F)=>{B[D]=F[0];B[D+1]=F[1];B[D+2]=F[3];B[D+3]=F[4];B[D+4]=F[6];B[D+5]=F[7]}):Sd(!1,this,"unknown type");
Sd(null===f.get_last_error(),this,"Parameter expression error "+f.get_last_error());l=f.need_input_evaler("in_src");let m=f.need_input_evaler("in_obj"),q=l||m,r=null;null!==l&&(r=new fk(this.in_source,this),await r.prepare(a));null!==m&&m.dyn_set_obj(a);a=this.in_mesh.get_mutable();try{q?null!==l?this.prop_from_input_framebuffer(e,a,r,l,m,f,h):null!==m&&this.prop_from_mesh_attr(e,m,f,h):this.prop_from_const(a,e,f,h)}catch(B){if(B instanceof je)Sd(!1,this,"Parameter expression error");else throw B;
}finally{null!==m&&m.dyn_set_obj(null),null!==l&&l.dyn_set_obj(null)}a.set(b,e,e.elem_sz,g);this.out_mesh.set(a)}set_image_fill(){const a=this.in_source.get_const();Sd(null!==a,this,"missing input source image");return this.in_mesh.get_mutable().add_fillobj(new Ld(a,Kd(this.in_source.lines[0].from_term.owner.display_values)))}}
class Ld{constructor(a,b){this.obj=a;this.with_display_values=b;null!==this.with_display_values&&0==Object.keys(this.with_display_values).length&&this.obj.get_disp_params(this.with_display_values)}draw(a){this.obj.draw(a,this.with_display_values)}async pre_draw(a){await this.obj.pre_draw(a,this.with_display_values)}prox_get_const_obj(){return this.obj}}const gk={vtx_radius:{v:aj.vtx_radius,num_elems:1},vtx_color:{v:gi.arr,num_elems:4},line_width:{v:1,num_elems:1},line_color:{v:gi.arr,num_elems:4}};
function bi(a,b){a=gk[a];return void 0===a||a.num_elems!==b?Array(b).fill(0):a.v}function hk(a,b,l,e,f){l=gk[l];if(void 0!==l&&l.num_elems===e)for(let h=0;h<f*e;++h)a[b++]=l.v[h%e];else b+=f*e;return b}
class ik extends ye{static name(){return"Const Attribute"}constructor(a){super(a);this.in_obj=new Rd(a,"in_geom");this.out_obj=new Td(a,"out_geom");this.name_per_type=new nh(a,"npt",{0:"color",1:"radius",2:"normal"});this.bind_to=new Ti(a,"Bind To",0,[["Vertices","vtx_"],["Faces","face_"],["Lines","line_"]]);this.attr_type=new Ti(a,"Type",0,["Color","Float","Float2"],b=>{const l=this.attr_type.sel_idx;this.expr_color.set_visible(0==l);this.expr_float.set_visible(1==l);this.expr_vec2.set_visible(2==
l);this.attr_name.modify(this.name_per_type.st_get(b))});this.attr_name=new oh(a,"Name","color",b=>{this.name_per_type.st_set(this.attr_type.sel_idx,b)});this.expr_color=new Nh(a,"Color",[gi.hex,gi.rgb]);this.expr_float=new Gh(a,"Float",5);this.expr_vec2=new Jh(a,"Float2",1,0,!0)}run(){const a=this.in_obj.get_mutable();Sd(null!==a,this,"Missing input");Sd(a.constructor===ij||a.constructor===Uj,this,"Input should be either mesh or path");let b=this.bind_to.get_sel_val()+this.attr_name.get_value(),
l=null;switch(this.attr_type.sel_idx){case 0:l=ei(this.expr_color.get_value());break;case 1:l=this.expr_float.get_value();break;case 2:l=this.expr_vec2.get_value();break;default:Sd(!1,this,"Unknown type")}a.set_const(b,l);this.out_obj.set(a)}}
class jk extends ye{static name(){return"Geom Merge"}constructor(a){super(a);this.in_m=new Xd(a,"in_multi_mesh");this.out=new Td(a,"out_mesh");this.dedup_vtx=new qh(a,"Deduplicate Points (Output mesh)",!1,b=>{this.dedup_epsilon.set_enable(b)});this.dedup_epsilon=new Gh(a,"Dedup epsilon",1E-5,{visible:!1});this.sorted_order=[];kk(a,this,this.sorted_order,this.in_m)}analyze_inputs(a){let b=null,l=null;const e={};Sd(this.sorted_order.length==a.length,this,"unexpected meshes size");for(var f of this.sorted_order){var h=
a[f];Sd(h.constructor===ij||h.constructor===Uj,this,"input is not a mesh or paths");null===b?b=h.constructor:b!==h.constructor&&(b=Uj);b==ij&&(null===l?(l=h.type,Sd(0!==h.type,this,"input mesh type not set"),3!==h.type&&Sd(null!==h.arrs.idx&&void 0!==h.arrs.idx,this,"input mesh with faces but no idx array?")):l!==h.type&&(b=Uj));for(var g in h.arrs)null!==h.arrs[g]&&(g.startsWith("vtx_")||g.startsWith("ctrl_")?Sd(h.arrs[g].length===h.vtx_count()*h.meta[g].num_elems,this,"unexpected size of array "+
g):g.startsWith("face_")?Sd(h.arrs[g].length===h.face_count()*h.meta[g].num_elems,this,"unexpected size of array "+g):"idx"!=g&&Sd(!1,this,"unexpected array name "+g),void 0===e[g]?e[g]={num_elems:h.meta[g].num_elems,ctor:h.arrs[g].constructor,need_normalize:h.meta[g].need_normalize}:(Sd(h.meta[g].num_elems===e[g].num_elems,this,"incompatible objects, array "+g+" num_elems different"),Sd(h.meta[g].need_normalize===e[g].need_normalize,this,"incompatible objects, array "+g+" normalization different"),
Sd(h.meta[g].constructor===e[g].constructor,this,"incompatible objects, array "+g+" normalization different")))}g=h=f=0;const m=[];if(b===ij)for(let q of a)m.push(f),f+=q.vtx_count(),h+=q.face_count(),void 0!=q.arrs.idx&&null!==q.arrs.idx&&(g+=q.arrs.idx.length);else for(let q of a)f+=q.constructor==ij&&null!==q.arrs.idx?q.arrs.idx.length:q.vtx_count(),h+=q.face_count();return{obj_ctor:b,mesh_type:l,uni_meta:e,vtx_count:f,idx_count:g,start_idxs:m,face_count:h}}merge_to_mesh(a,b){const l=new ij;l.type=
a.mesh_type;for(let f in a.uni_meta){const h=!f.startsWith("face_"),g=a.uni_meta[f],m=new g.ctor(("idx"===f?a.idx_count:a.vtx_count)*g.num_elems);let q=0;for(let r of this.sorted_order){var e=b[r];if("idx"===f)for(let B=0;B<e.arrs.idx.length;++B)m[q++]=e.arrs.idx[B]+a.start_idxs[r];else void 0===e.arrs[f]?(e=h?e.vtx_count():e.face_count(),q=hk(m,q,f,g.num_elems,e)):(m.set(e.arrs[f],q),q+=e.arrs[f].length)}l.set(f,m,g.num_elems,g.need_normalize)}return l}merge_to_paths(a,b){const l=new Uj;var e=[],
f=0;for(var h of this.sorted_order){var g=b[h];if(g.constructor===ij){var m=g.face_size();g=null!==g.arrs.idx?g.arrs.idx.length/m:g.vtx_count();for(var q=0;q<g;++q)e.push(f,f+m,1),f+=m}else for(m=0;m<g.paths_ranges.length;m+=3){q=g.paths_ranges[3*m];const r=g.paths_ranges[3*m+1];e.push(q+f,r+f,g.paths_ranges[3*m+2]);f+=r-q}}Sd(a.face_count===e.length/3,this,"Unexpected face_count from analyze (BUG)");l.paths_ranges=e;for(let r in a.uni_meta)if("idx"!==r){e=!r.startsWith("face_");f=a.uni_meta[r];h=
new f.ctor(a.vtx_count*f.num_elems);g=0;for(let B of this.sorted_order)if(q=b[B],m=q.arrs[r],void 0===m)m=e?q.constructor===ij&&null!==q.arrs.idx?q.arrs.idx.length:q.vtx_count():q.face_count(),g=hk(h,g,r,f.num_elems,m);else if(q.constructor!==ij||null===q.arrs.idx||e)h.set(q.arrs[r],g),g+=q.arrs[r].length;else for(let D of q.arrs.idx)for(q=0;q<f.num_elems;++q)h[g++]=m[D*f.num_elems+q];l.set(r,h,f.num_elems,f.need_normalize)}return l}dedup_vertices(a){var b=new Map;const l=[];var e=[],f=[],h=a.effective_vtx_pos,
g=h.length,m=1/this.dedup_epsilon.v,q=0;for(let D=0,F=0;D<g;D+=2,++F){const G=h[D],N=h[D+1],T=""+Math.round(G*m)+"_"+Math.round(N*m);let V=b.get(T);void 0===V?(b.set(T,F),V=F,e.push(G,N),f.push(F)):++q;l.push(V)}if(0===q&&a.constructor===ij)return a;b=new ij;b.set("vtx_pos",new di(e),2,!1);for(var r in a.arrs)if(r.startsWith("vtx_")&&"vtx_pos"!=r&&"vtx_transform"!=r){e=a.arrs[r];h=a.meta[r];g=new e.constructor(f.length*h.num_elems);m=0;for(var B of f)for(q=0;q<h.num_elems;++q)g[m++]=e[B*h.num_elems+
q];b.set(r,g,h.num_elems,h.need_normalize)}if(a.constructor===ij)if(a.has_idx()){f=a.arrs.idx;r=new bj(f.length);B=0;for(let D of f)r[B++]=l[D];b.set("idx",r);b.type=a.type}else Sd(3===a.type,this,"unexpected input mesh type "+a.type),b.type=3;else b.type=3;return b}run(){var a=this.in_m.get_input_consts();if(0==a.length)a=new ij,new_mesh.type=3,this.out.set(a);else{if(1==a.length)a=a[0];else{const b=this.analyze_inputs(a);a=b.obj_ctor==ij?this.merge_to_mesh(b,a):this.merge_to_paths(b,a)}this.dedup_vtx.v&&
(a=this.dedup_vertices(a));this.out.set(a)}}}
class lk extends ye{static name(){return"Geom Split"}constructor(a){super(a);this.in_obj=new Rd(a,"in_obj");this.out_group=new Td(a,"out_group");this.bind_to={sel_idx:0};a.set_state_evaluators({in_obj:(b,l)=>new dk(b,l,this.bind_to)});this.sel_index=new Hh(a,"Split By\nIndex",0,{show_code:!0})}run(){const a=this.in_obj.get_const();Sd(a,this,"missing input");Sd(a.constructor===ij||a.constructor===Uj,this,"Expected input geometry");const b=new mk,l=(G,N)=>{b.add(G,N);void 0===this.node.display_values[N]&&
(this.node.display_values[N]={})};var e=this.sel_index.need_input_evaler("in_obj"),f=a.vtx_count();if(0===f||null===e)l(a,this.sel_index.v);else{e.dyn_set_obj(a);var h={},g=[];for(var m=0;m<f;++m){e.dyn_set_prop_index(m);var q=this.sel_index.dyn_eval();g.push(q);var r=h[q];void 0===r&&(r={darrs:{vtx_pos:[]},vidx_map:{},vcount:0,paths_ranges:[]},h[q]=r);r.vidx_map[m]=r.vcount++;q=r.darrs;for(var B in a.arrs){void 0===q[B]&&(q[B]=[]);if(B.startsWith("face_")||"idx"==B)continue;r=a.meta[B].num_elems;
const G=m*r;for(let N=0;N<r;++N)q[B].push(a.arrs[B][G+N])}}var D=[];for(var F in a.arrs)F.startsWith("face_")&&D.push(F);e=(G,N,T)=>{for(let V of D){const E=G.meta[V].num_elems;for(let Q=0;Q<E;++Q)N[V].push(G.arrs[V][T*E+Q])}};if(a.constructor===ij){if(f=a.face_size(),1<f){m=a.arrs.idx.length;for(let G=0,N=0;G<m;G+=f,++N){B=g[a.arrs.idx[G]];for(F=1;F<f;++F)if(B!==g[a.arrs.idx[G+F]]){B=null;break}if(null!==B){F=h[B];B=F.vidx_map;F=F.darrs;for(q=0;q<f;++q)F.idx.push(B[a.arrs.idx[G+q]]);e(a,F,N)}}}}else for(let G=
0,N=0;G<a.paths_ranges.length;G+=3,++N){f=a.paths_ranges[G];m=a.paths_ranges[G+1];B=a.paths_ranges[G+2];F=g[f];for(q=f+1;q<m;++q)if(F!==g[q]){F=null;break}null!==F&&(F=h[F],q=F.vidx_map,F.paths_ranges.push(q[f],q[f]+(m-f),B),e(a,F.darrs,N))}for(let G in h){g=new a.constructor;e=h[G];f=e.darrs;for(let N in f)m=a.meta[N],B=a.arrs[N].constructor,F=f[N],B!==Array&&(F=new B(F)),g.set(N,F,m.num_elems,m.need_normalize);a.constructor===ij?g.type=a.type:g.paths_ranges=e.paths_ranges;l(g,G)}}this.out_group.set(b)}}
function nk(a,b){const l=new a.constructor(a.length*b);for(let e=0,f=0;e<b;++e,f+=a.length)l.set(a,f);return l}
let ok=a=>class extends a{add_terminal_and_params(b){this.in_target=new Rd(b,"in_target",l=>{this.create_count.set_enable(!l)});this.bind_to={sel_idx:0};b.set_state_evaluators({in_target:(l,e)=>new dk(l,e,this.bind_to),index:(l,e)=>new bk(l,e)});this.create_count=new Hh(b,"Count",10,{min:2,max:50});this.transform=new Ph(b,"Object\nTransform",{tx:"in_target.vtx_pos.x",ty:"in_target.vtx_pos.y"})}get_meta_target(){const b=this.in_target.get_const();let l;const e=this.transform.need_input_evaler("in_target");
null!==b?(l=b.effective_vtx_pos.length/2,null!==e&&e.dyn_set_obj(b)):(Sd(null===e,this,"in_target object not connected"),l=this.create_count.get_value());return[l,e]}get_index_wrap(){const b=this.transform.need_input_evaler("index"),l=[0];null!==b&&b.dyn_set_obj(l);return l}};
class pk extends ok(ye){static name(){return"Copy"}constructor(a){super(a);this.in_obj=new Rd(a,"in_obj");this.out=new Td(a,"out_obj");this.add_terminal_and_params(a)}mesh_copy(a,b,l){const e=new ij;e.type=a.type;for(var f in a.arrs){var h=a.meta[f],g=a.arrs[f];let m;f.startsWith("vtx_")?m=g:f.startsWith("face_")&&(m=nk(g,b));e.set(f,m,h.num_elems,h.need_normalize)}if(a.has_idx())f=a.arrs.idx;else for(Sd(3==a.type,this,"unexpected mesh type"),h=a.vtx_count(),f=new bj(h),g=0;g<h;++g)f[g]=g;a=a.face_size();
l=this.make_face_transform(f.length/a,b,l);b=nk(f,b);e.set("idx",b);e.set("face_transform",l,6,!1);return e}path_copy(a,b,l){const e=new Uj,f=a.vtx_count(),h=a.face_count();for(var g in a.arrs){var m=a.meta[g],q=a.arrs[g];g.startsWith("vtx_")||g.startsWith("ctrl_")?Sd(q.length===f*m.num_elems,this,"unexpected vtx attrib array size"):g.startsWith("face_")?Sd(q.length===h*m.num_elems,this,"unexpected vtx attrib array size"):Sd(!1,this,"unexpected attr name "+g);q=nk(q,b);e.set(g,q,m.num_elems,m.need_normalize)}g=
[];m=0;for(q=0;q<b;++q){for(let r=0;r<a.paths_ranges.length;r+=3)g.push(a.paths_ranges[r]+m,a.paths_ranges[r+1]+m,a.paths_ranges[r+2]);m+=f}e.paths_ranges=g;a=this.make_face_transform(h,b,l);e.set("face_transform",a,6,!1);return e}make_face_transform(a,b,l){const e=this.get_index_wrap();let f=0;const h=new Float32Array(a*b*6);for(let g=0;g<b;++g){e[0]=g;null!==l&&l.dyn_set_prop_index(g);const m=this.transform.dyn_eval();for(let q=0;q<a;++q)h[f++]=m[0],h[f++]=m[1],h[f++]=m[3],h[f++]=m[4],h[f++]=m[6],
h[f++]=m[7]}return h}run(){const a=this.in_obj.get_const();Sd(null!==a,this,"No input object to copy");const [b,l]=this.get_meta_target();let e=null;a.constructor===ij?e=this.mesh_copy(a,b,l):a.constructor===Uj?e=this.path_copy(a,b,l):Sd(!1,this,"Expected geometry object input");this.out.set(e)}}class Eg{constructor(){this.v={}}}
class mk extends yd{static name(){return"Group"}constructor(){super();this.v=[];this.disp_params=[]}add(a,b){Id(void 0!==b,"missing key for group add");this.v[b]=a}get(a){a=this.v[a];return void 0===a?null:a}transform(a){for(let b of this.v)b.transform(a)}async pre_draw(a,b){for(let l in this.v)Id(void 0!==b[l],"display_values doesn't include key "+l),await this.v[l].pre_draw(a,b[l])}draw(a,b){for(let l in this.v)Id(void 0!==b[l],"display_values doesn't include key "+l),this.v[l].draw(a,b[l])}get_disp_params(a){let b=
new Eg;for(let l in this.v)Id(void 0!==a[l],"missing disp_params in values index "+l),b.v[l]=this.v[l].get_disp_params(a[l]);return b}draw_template(a){for(let b in this.v)this.v[b].draw_template(a)}describe(a,b){b.clear_desc();b.add_line("Group size: ").value_elem.innerText=Object.keys(this.v).length;for(let l in this.v){b=this.v[l];const e=Ce(a,"obj_inf_grp_obj");Ce(e,"obj_inf_grp_name").innerText=l+": "+b.constructor.name();if(b.constructor===ij||b.constructor===Uj)Ce(e,"obj_inf_grp_detail").innerText=
"vertices: "+b.vtx_count(),Ce(e,"obj_inf_grp_detail").innerText="faces: "+b.face_count()}}}
class qk extends ai{constructor(a,b,l,e){super(a,b,1,l,Array);this.sorted_order=e;this.sorted_d=[];this.loaded_order=this.dragged=null}save(){return{sorted_order:this.sorted_order}}load(a){this.loaded_order=a.sorted_order}post_load_hook(){let a=[];if(null!==this.loaded_order){for(let b of this.loaded_order)console.assert(0<=b&&b<this.sorted_d.length),a.push(this.sorted_d[b]);this.sorted_d=a;this.loaded_order=null;this.redo_sort()}}create_elem(a,b,l){a=Ce(a,"param_lst_order_cell");a=Ce(a,"param_lst_order_item");
a.innerText=b.name;a.p_lst_index=l;let e=null,f=null;a.addEventListener("mousedown",m=>{if(1===m.buttons){var q=m.target.getBoundingClientRect(),r=[q.left-m.pageX,q.top-m.pageY-2],B=m.target.cloneNode(!0);B.style.position="fixed";B.style.top=m.pageY+r[1]+"px";B.style.left=m.pageX+r[0]+"px";B.style.width=q.width-11+"px";B.style.pointerEvents="none";rk.appendChild(B);this.dragged={lst_index:m.target.p_lst_index,elem:B,mouse_offset:r};h(!0);document.addEventListener("mousemove",e);document.addEventListener("mouseup",
f)}});let h=m=>{this.elem_lst[this.dragged.lst_index].classList.toggle("param_lst_order_drag_placeholder",m)},g=m=>{if(this.dragged.lst_index!==m){var q=this.sorted_d.findIndex(B=>B.lst_index==this.dragged.lst_index);this.sorted_d.splice(q,1);var r=this.sorted_d.findIndex(B=>B.lst_index==m);this.sorted_d.splice(r+(r>=q?1:0),0,{lst_index:this.dragged.lst_index});this.redo_sort();h(!0)}};Le(a,"mousemove",m=>{null!==this.dragged&&(this.dragged.elem.style.top=m.pageY+this.dragged.mouse_offset[1]+"px",
this.dragged.elem.style.left=m.pageX+this.dragged.mouse_offset[0]+"px",g(m.target.p_lst_index))});e=m=>{null!==this.dragged&&(this.dragged.elem.style.top=m.pageY+this.dragged.mouse_offset[1]+"px",this.dragged.elem.style.left=m.pageX+this.dragged.mouse_offset[0]+"px")};f=()=>{null!==this.dragged&&(rk.removeChild(this.dragged.elem),h(!1),this.dragged=null,document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",f))};return a}external_update(){}idx_from_id(a){return this.lst.findIndex(b=>
b.id===a)}redo_sort(){let a=this.sorted_d.length!==this.sorted_order.length;if(!a)for(let b=0;b<this.sorted_d.length;++b)if(this.sorted_d[b].lst_index!==this.sorted_order[b]){a=!0;break}if(a){this.sorted_order.length=0;for(let b of this.sorted_d)this.sorted_order.push(b.lst_index);this.table.remake_table();this.pset_dirty()}}add(a){a.lst_index=this.lst.length;this.sorted_d.push({lst_index:a.lst_index});super.add(a);this.redo_sort()}remove(a){console.assert(1==a.length,"expected only single item to remove");
let b=this.lst[a[0]];super.remove(a);a=this.sorted_d.findIndex(l=>l.lst_index==b.lst_index);this.sorted_d.splice(a,1);for(let l of this.sorted_d)l.lst_index>b.lst_index&&l.lst_index--;this.redo_sort();return b}}
function kk(a,b,l,e){b.order_table=new Oi(a,"Order",l);b.order=new qk(a,"OrderInputs",b.order_table,l);b.order_table.with_index_column=!0;b.order_table.with_column_sep=!1;b.did_connect=function(f,h){if(f===e&&(f=h.from_term.owner,-1===b.order.idx_from_id(f.id))){var g={name:f.name,id:f.id,rename_func:m=>{g.name=m;b.order_table.remake_table()}};f.register_rename_observer(g.rename_func);b.order.add(g)}};b.doing_disconnect=function(f,h){f===e&&(f=h.from_term.owner,h=b.order.idx_from_id(f.id),console.assert(-1!=
h),h=b.order.remove([h]),f.remove_rename_observer(h.rename_func))}}class sk extends ye{static name(){return"Group Objects"}constructor(a){super(a);this.sorted_order=[];this.in_m=new Xd(a,"in_multi_mesh");this.out=new Td(a,"out_mesh");kk(a,this,this.sorted_order,this.in_m)}run(){this.node.display_values={};let a=new mk;for(let b of this.sorted_order){const l=this.in_m.lines[b],e=l.to_term.get_const();a.add(e,b);this.node.display_values[b]=l.from_term.owner.display_values}this.out.set(a)}}
class tk extends ye{static name(){return"Group Select"}constructor(a){super(a);this.in_g=new Rd(a,"in_group");this.in_default=new Rd(a,"in_default");this.out=new Td(a,"out_obj");this.key_sel=new Hh(a,"Select Index",0)}run(){var a=this.in_g.get_const();Sd(null!==a,this,"missing input");Sd(a.constructor===mk,this,"Expected group input");const b=this.key_sel.get_value();a=a.get(b);null===a&&(a=this.in_default.get_const());Sd(null!==a,this,"Index doesn't exist in group and no default");this.out.set(a)}}
class uk extends ye{static name(){return"Transform"}constructor(a){super(a);this.in=new Rd(a,"input");this.out=new Td(a,"output");this.transform=new Ph(a,"transform");this.cached_obj=null;this.cached_initial_tr=Qh.create()}run(){Sd(this.transform.is_valid(),this,"invalid transform");let a;this.in.is_dirty()||null===this.cached_obj||void 0===this.cached_obj.set_transform?(a=this.in.get_mutable(),Sd(a,this,"missing input"),void 0!==a.set_transform&&(console.assert(void 0!==a.get_transform),this.cached_obj=
a,Qh.copy(this.cached_initial_tr,a.get_transform()))):(a=this.cached_obj,a.set_transform(this.cached_initial_tr));a.transform(this.transform.v);this.out.set(a)}draw_selection(a){let b=this.out.get_const();null!==b&&(this.transform.draw_dial_at_obj(b,a),b.draw_border(a))}image_find_obj(a){return this.transform.dial.find_obj(a)}}class jj{constructor(a){this.state=a}next(){this.state=(1664525*this.state+1013904223)%4294967296;return this.state/4294967296}}
class vk extends ye{static name(){return"Scatter Uniform"}constructor(a){super(a);a.set_state_evaluators({vtx_pos:(b,l)=>new Rj(b,l)});this.in_obj=new Rd(a,"in_obj");this.out_mesh=new Td(a,"out_mesh");this.seed=new Hh(a,"Seed",1);this.min_dist=new Gh(a,"Min Distance",.02,[.02,.5])}run(){function a(P){E.push(P);g.push(P[0],P[1]);const ea=(P[0]-G)/B|0,ua=(P[1]-N)/B|0;0>ea||0>ua||ea>=D||ua>=F||(T[D*ua+ea]=P)}function b(P){let ea=2*V.next()*Math.PI,ua=Math.sqrt(V.next()*r+q);return[P[0]+ua*Math.cos(ea),
P[1]+ua*Math.sin(ea)]}function l(P){const ea=P[0];P=P[1];return h.min_x<=ea&&ea<=h.max_x&&h.min_y<=P&&P<=h.max_y}function e(P){var ea=(P[0]-G)/B|0,ua=(P[1]-N)/B|0;if(0>ea||0>ua||ea>=D||ua>=F)return!0;const Fa=Math.max(ea-1,0);var pa=Math.max(ua-1,0);ea=Math.min(ea+1+1,D);for(ua=Math.min(ua+1+1,F);pa<ua;++pa){let Ga=pa*D;for(let Aa=Fa;Aa<ea;++Aa){var ra=T[Ga+Aa],Ca;if(Ca=ra)Ca=P[0]-ra[0],ra=P[1]-ra[1],Ca=Ca*Ca+ra*ra<q;if(Ca)return!0}}return!1}var f=this.in_obj.get_const();Sd(null!==f,this,"No mesh input");
Sd(void 0!==f.get_bbox,this,"Input does not define a bounding box");let h=f.get_bbox();Sd(null!==h,this,"Object doesn't have content for a bounding box");let g=[];var m=this.min_dist.v;Sd(null!==m,this,"varying distance not supported by this node");const q=m*m,r=4*m*m-q,B=m*Math.SQRT1_2,D=Math.ceil(h.width()/B),F=Math.ceil(h.height()/B),G=h.min_x,N=h.min_y;h.width();h.height();const T=Array(D*F),V=new jj(this.seed.v),E=[];for(a([h.min_x+h.width()*V.next(),h.min_y+h.height()*V.next()]);0<E.length;){m=
V.next()*E.length|0;var Q=E[m],aa=void 0;for(aa=0;20>aa;++aa){var qa=b(Q);if(l(qa)&&!e(qa)){a(qa);break}}20===aa&&(E[m]=E[E.length-1],E.pop())}if(f.is_point_inside){m=[];for(Q=0;Q<g.length;Q+=2)aa=g[Q],qa=g[Q+1],f.is_point_inside(aa,qa)&&m.push(aa,qa);g=m}f=new ij;f.set("vtx_pos",new di(g),2);f.type=3;this.out_mesh.set(f)}}
class wk extends ye{static name(){return"Triangulate"}constructor(a){super(a);this.in_obj=new Rd(a,"in_obj");this.out_mesh=new Td(a,"out_mesh")}run(){var a=this.in_obj.get_const();Sd(null!==a,this,"Missing input mesh");Sd(void 0!==a.arrs&&void 0!==a.arrs.vtx_pos,this,"Input doesn't have vertices. type: "+a.constructor.name());if(a.constructor===ij){a=this.in_obj.get_mutable();var b=new Kb(a.effective_vtx_pos);a.set("idx",b.triangles);a.set_type(2);a.halfedges=b.halfedges;a.hull=b.hull;this.out_mesh.set(a)}else if(a.constructor===
Uj){var l=new poly2tri.SweepContext([]),e=a.effective_vtx_pos,f=0;let D=[];for(var h=0;h<a.paths_ranges.length;h+=3){for(var g=[],m=2*a.paths_ranges[h],q=2*a.paths_ranges[h+1];m<q;m+=2){var r=new poly2tri.Point(e[m],e[m+1]);r.my_index=m/2;r.visited=!1;g.push(r)}3<=g.length&&(l.addHole(g),D.push.apply(D,g),++f)}e=new ij;h=[];g=[];if(0<f)for(;;){try{l.triangulate()}catch(F){Sd(!1,this,"Failed triangulation")}f=l.getTriangles();for(let F of f)q=F.getPoints(),console.assert(3==q.length,"unexpected size of triangle"),
console.assert(void 0!==q[0].my_index&&void 0!==q[1].my_index&&void 0!==q[2].my_index,"External helper point?"),F.start_at_idx=h.length,h.push(q[2].my_index,q[1].my_index,q[0].my_index),q[0].visited=!0,q[1].visited=!0,q[2].visited=!0,g.push(-1,-1,-1);for(let F of f)for(f=F.getPoints(),q=0;3>q;++q)if(m=F.getNeighbor(q),null!==m&&m.interior_){var B=f[(q+1)%3];r=2-F.index(f[(q-1+3)%3]);B=2-m.index(B);g[F.start_at_idx+r]=m.start_at_idx+B}f=[];for(let F of D)F.visited||f.push(F);if(3>f.length)break;l.points_=
f;l.map_=[];l.triangles_=[]}for(b in a.arrs)l=a.arrs[b],null!==l&&(console.assert(void 0!==l.BYTES_PER_ELEMENT,"not a typed-array "+b),e.set(b,new l.constructor(l),a.meta[b].num_elems,a.meta[b].need_normalize));e.set("idx",new bj(h));e.set_type(2);e.halfedges=g;a=new Kb(e.effective_vtx_pos);e.hull=a.hull;this.out_mesh.set(e)}}}
class xk{constructor(){this.vtx_pos=[];this.paths_ranges=[];this.from_arr=[]}moveTo(a,b,l){let e=this.vtx_pos.length/2;this.paths_ranges.push(e,e+1,0);this.vtx_pos.push(a,b);this.from_arr.push(l)}lineTo(a,b){++this.paths_ranges[this.paths_ranges.length-2];this.vtx_pos.push(a,b)}closePath(){this.paths_ranges[this.paths_ranges.length-1]=1}finalize(a){a.set("vtx_pos",this.vtx_pos,2,!1);a.paths_ranges=this.paths_ranges}}
class yk extends ye{static name(){return"Voronoi"}constructor(a){super(a);this.in_obj=new Rd(a,"in_mesh");this.out_mesh=new Td(a,"out_paths");this.margin=new Jh(a,"Margin",.2,.2)}run(){let a=this.in_obj.get_const();Sd(null!==a,this,"Missing input mesh");Sd(void 0!==a.arrs&&void 0!==a.arrs.vtx_pos,this,"Input doesn't have vertices. type: "+a.constructor.name());Sd(void 0!==a.halfedges&&void 0!==a.hull,this,"missing halfedges or hull");var b=a.get_bbox(),l=this.margin.x,e=this.margin.y;l=new ic({triangles:a.arrs.idx,
points:a.effective_vtx_pos,halfedges:a.halfedges,hull:a.hull},[b.min_x-l,b.min_y-e,b.max_x+l,b.max_y+e]);b=new xk;l.renderCells(b);l=new Uj;b.finalize(l);for(let h in a.arrs){if(!h.startsWith("vtx_")||"vtx_pos"===h)continue;e=a.arrs[h];let g=a.meta[h].num_elems;var f=b.from_arr;let m=new e.constructor(f.length*g),q=0;for(let r of f)for(f=0;f<g;++f)m[q++]=e[r*g+f];l.set("face_"+h.substr(4),m,g,a.meta[h].need_normalize)}this.out_mesh.set(l)}}
class zk extends ye{static name(){return"Divide"}constructor(a){super(a);this.in_mesh=new Rd(a,"in_mesh");this.out_mesh=new Td(a,"out_mesh");this.by_dist=new qh(a,"Set distance",!1,b=>{this.divisions.set_enable(!b);this.distance.set_enable(b);this.distance_uv.set_enable(b);this.sep_uv.set_enable(b);this.exact.set_enable(b)});this.divisions=new Hh(a,"Divisions",4,{min:1,max:10});this.sep_uv=new qh(a,"Separate U-V",!1,b=>{this.distance.set_visible(!b);this.distance_uv.set_visible(b)});this.distance=
new Gh(a,"Distance",.1);this.distance_uv=new Jh(a,"Distance U-V",.1,.1);this.exact=new qh(a,"Exact",!1);a.param_alias("Set approximate distance",this.by_dist)}divide_quad(a,b,l,e,f,h,g){h=a.effective_vtx_pos;var m=h[2*e];e=h[2*e+1];var q=h[2*f]-m;f=h[2*f+1]-e;let r=h[2*g]-m,B=h[2*g+1]-e;if(this.by_dist.v){if(this.sep_uv.v){var D=this.distance_uv.y;var F=this.distance_uv.x}else F=D=this.distance.v;Sd(0!==D&&0!==F,this,"Division by zero");var G=Math.sqrt(q*q+f*f);g=Math.round(G/D);var N=Math.sqrt(r*
r+B*B);h=Math.round(N/F);this.exact.v&&(D*=g,F*=h,q*=D/G,f*=D/G,r*=F/N,B*=F/N)}else g=h=this.divisions.v;Sd(0!=g&&0!=h,this,"Division by zero");q/=g;f/=g;r/=h;B/=h;a=b.length/a.meta.vtx_pos.num_elems;for(G=0;G<=h;++G)for(N=0;N<=g;++N)b.push(m+q*N+r*G,e+f*N+B*G);b=g+1;for(m=0;m<g;++m)for(e=0;e<h;++e)q=m+e*b,f=q+1,l.push(a+q,a+f,a+(f+b),a+(q+b))}divide_line(a,b,l,e,f,h){e-=b;f-=l;let g;g=this.by_dist.v?Math.round(Math.sqrt(e*e+f*f)/this.distance.v):this.divisions.v;e/=g;f/=g;h&&(g+=1);for(h=0;h<g;++h)a.push(b+
e*h,l+f*h)}run(){var a=this.in_mesh.get_const();Sd(null!==a,this,"Missing input points");this.by_dist.v&&Sd(0!=this.distance.v,this,"Division by zero");if(a.constructor===ij&&1==a.type){var b=[],l=[],e=a.arrs.idx;for(var f=0;f<e.length;f+=4)this.divide_quad(a,b,l,e[f],e[f+1],e[f+2],e[f+3]);a=new ij;a.set("vtx_pos",new di(b),2,!1);a.set("idx",new bj(l));a.type=1;this.out_mesh.set(a)}else if(a.constructor===Uj){e=a.effective_vtx_pos;b=[];l=[];for(f=0;f<a.paths_ranges.length;f+=3){var h=2*a.paths_ranges[f];
const g=2*a.paths_ranges[f+1],m=a.paths_ranges[f+2],q=m&1;let r=e[g-2],B=e[g-2+1];const D=b.length;let F=!0;for(;h<g;h+=2){const G=e[h],N=e[h+1];(!F||F&&q)&&this.divide_line(b,r,B,G,N,!q&&h==g-2);r=G;B=N;F=!1}l.push(D,b.length,m)}a=new Uj;a.paths_ranges=l;a.set("vtx_pos",new di(b),2,!1);this.out_mesh.set(a)}else Sd(!1,this,"unexpected geometry")}}
function Ak(a,b,l){const e=a[0][0],f=a[0][1];var h=b[0][0];const g=b[0][1],m=a[1][0]-e;a=a[1][1]-f;const q=b[1][0]-h,r=b[1][1]-g;b=(-a*(e-h)+m*(f-g))/(-q*a+m*r);h=(q*(f-g)-r*(e-h))/(-q*a+m*r);return l||0<=b&&1>=b&&0<=h&&1>=h?Ff.fromValues(e+h*m,f+h*a):null}
function Bk(a,b,l,e){Sd(null!==a,e,"missing input mesh");if(a.constructor==ij){var f=a.face_size(),h=a.arrs.idx;var g=a.effective_vtx_pos;e=f;var m=[];for(var q=0;q<h.length;q+=e)for(var r=0;r<e;++r){var B=h[q+r],D=B<<1;D=Ff.fromValues(g[D],g[D+1]);D.from_idx=B;B=h[q+(r+1)%e];var F=B<<1;F=Ff.fromValues(g[F],g[F+1]);F.from_idx=B;m.push([D,F])}g=m;h=null}else if(a.constructor==Uj){f=null;h=a.paths_ranges;g=a.effective_vtx_pos;e=[];m=[];for(q=0;q<h.length;q+=3){r=h[q];D=h[q+1];var G=2*r;B=2*D;F=g[B-
2];var N=g[B-1];let P=D-1;for(;G<B;G+=2){var T=Ff.fromValues(F,N);T.from_idx=P;F=g[G];N=g[G+1];var V=Ff.fromValues(F,N);V.from_idx=G/2;P=V.from_idx;e.push([T,V])}m.push(D-r)}[g,h]=[e,m]}else Sd(!1,e,"input needs to be mesh or paths");e=Ff.create();m=Ff.create();for(var E of g)Ff.subtract(e,E[1],E[0]),Ff.normalize(e,e),Ff.set(m,e[1],-e[0]),Ff.scaleAndAdd(E[0],E[0],m,b),Ff.scaleAndAdd(E[1],E[1],m,b);e=[];m=[];b=[];q=[];E=[];r=0;for(let P=0,ea=0;P<g.length;P+=f,++ea){null!==h&&(f=h[ea]);B=!1;D=[];for(F=
0;F<f;++F){G=Ak(g[P+F],g[P+(F+1)%f],l);if(null===G){B=!0;break}G.from_idx=g[P+F][1].from_idx;D.push(G)}if(a.constructor==Uj){F=D;G=[];for(T=0;T<F.length;++T)G.push([F[T],F[(T+1)%F.length]]);V=G.length;if(3!=V){do{T=!1;var Q=void 0,aa=void 0;for(N=0;N<V;++N)if(Q=(N+1)%V,aa=(N+2)%V,aa=Ak(G[N],G[aa],!1),null!==aa){T=!0;break}T&&(aa.from_idx=F[Q].from_idx,F.splice(Q,1,aa),F.splice((Q+1)%V,1),G.splice(Q,1));V=G.length}while(T&&3<V)}}if(!B){B=r;for(var qa of D)e.push(qa[0],qa[1]),E.push(qa.from_idx),m.push(r),
r+=1;q.push(B,r,1);b.push(ea)}}a.constructor==ij?(l=new ij,l.set("idx",new bj(m)),l.set_type(a.type)):(l=new Uj,l.paths_ranges=q);l.set("vtx_pos",new di(e),2);for(let P in a.arrs)if("idx"!=P&&"vtx_pos"!=P){Q=a.arrs[P];qa=a.meta[P].num_elems;if(P.startsWith("vtx_"))h=E;else if(P.startsWith("face_"))h=b;else continue;aa=new Q.constructor(h.length*qa);f=0;for(let ea of h)for(h=0;h<qa;++h)aa[f++]=Q[ea*qa+h];l.set(P,aa,qa,a.meta[P].need_normalize)}l.fill_objs=gj(a.fill_objs);return l}
class Ck extends ye{static name(){return"Offset Path"}constructor(a){super(a);this.in_obj=new Rd(a,"in_obj");this.out_obj=new Td(a,"out_obj");this.offset=new Gh(a,"Offset",.1,[-.2,.2]);const b=()=>{this.arcTol.set_visible(4==this.point_type.sel_idx||1==this.open_op.sel_idx)};this.point_type=new Ti(a,"Point Type",0,[["Square",ClipperLib.JoinType.jtSquare],["Miter",ClipperLib.JoinType.jtMiterAlways],["Miter Thresh",ClipperLib.JoinType.jtMiter],["Fast Miter",-1],["Round",ClipperLib.JoinType.jtRound]],
l=>{this.miterLimit.set_visible(2===l);this.closed_op.set_visible(3!==l);this.open_op.set_visible(3!==l);this.allow_overshoot.set_visible(3===l);b()});this.closed_op=new Ti(a,"Closed Paths",0,[["Polygon",ClipperLib.EndType.etClosedPolygon],["Line",ClipperLib.EndType.etClosedLine]]);this.open_op=new Ti(a,"Open Paths",0,[["Square",ClipperLib.EndType.etOpenSquare],["Round",ClipperLib.EndType.etOpenRound],["Butt",ClipperLib.EndType.etOpenButt]],b);this.miterLimit=new Gh(a,"Miter Thresh",2,[1,4]);this.arcTol=
new Gh(a,"Arc Step",.002,[1E-4,.01]);this.allow_overshoot=new qh(a,"Allow over-shoot",!1)}run(){var a=this.in_obj.get_const();Sd(null!==a,this,"missing input mesh");if(3==this.point_type.sel_idx)a=Bk(a,-this.offset.get_value(),this.allow_overshoot.get_value(),this),this.out_obj.set(a);else{var b=this.arcTol.get_value();0>=b&&(b=.1);ClipperLib.use_xyz=!0;b=new ClipperLib.ClipperOffset(1*this.miterLimit.get_value(),1*b);b.ZFillFunction=(h,g,m,q,r)=>{r.Z=h.Z==g.Z?h.Z:h.Z==m.Z?h.Z:h.Z==q.Z?h.Z:g.Z==m.Z?
g.Z:g.Z==q.Z?g.Z:m.Z==q.Z?m.Z:-1};var l=a.ensure_clipper(!0);for(var e of l)b.AddPath(e,this.point_type.get_sel_val(),e.closed?this.closed_op.get_sel_val():this.open_op.get_sel_val());e=new ClipperLib.Paths;b.Execute(e,1*this.offset.get_value());e=ClipperLib.JS.Lighten(e,1E-6);ClipperLib.use_xyz=!1;b=new Uj;e=b.from_clipper_paths(e);for(let h in a.arrs){if("idx"==h||"vtx_pos"==h)continue;l=a.arrs[h];let g=a.meta[h].num_elems;if(!h.startsWith("vtx_"))continue;let m=new l.constructor(e.length*g),q=
0;for(let r of e)if(-1!==r)for(var f=0;f<g;++f)m[q++]=l[r*g+f];else for(f=0;f<g;++f)m[q++]=0;b.set(h,m,g,a.meta[h].need_normalize)}this.out_obj.set(b)}}}var th=null;
function Dk(a,b,l,e,f){a=Ff.clone(a);b=Ff.clone(b);let h=Ff.fromValues(b[0],a[1]),g=Ff.fromValues(a[0],b[1]),m=Qh.create();Qh.multiply(m,m,l);Qh.multiply(m,m,e);Ff.transformMat3(a,a,m);Ff.transformMat3(h,h,m);Ff.transformMat3(g,g,m);Ff.transformMat3(b,b,m);zd.beginPath();Uh(zd,[a[0],a[1],h[0],h[1],b[0],b[1],g[0],g[1]]);zd.strokeStyle=f;zd.lineWidth=aj.line_width;zd.stroke()}
class Ek extends yd{static name(){return"Image"}constructor(a,b,l,e){super();this.t_mat=Qh.create();this.smooth=l;this.spread=e;this.sz_x=a;this.sz_y=b;a*=.5;b*=.5;this.top_left=Ff.fromValues(-a,-b);this.bottom_right=Ff.fromValues(a,b)}logical_size(){return[this.sz_x,this.sz_y]}set_smooth(a){this.smooth=a}set_transform(a){Qh.copy(this.t_mat,a)}get_transform(){return this.t_mat}transform(a){Qh.multiply(this.t_mat,a,this.t_mat)}draw_image(a,b){let l=this.top_left,e=this.bottom_right,f=Qh.create();Qh.multiply(f,
f,b);Qh.multiply(f,f,this.t_mat);zd.save();sd(zd,f);zd.imageSmoothingEnabled=this.smooth;zd.drawImage(a,l[0],l[1],e[0]-l[0],e[1]-l[1]);zd.restore()}get_bbox(){const a=Ff.fromValues(Number.MAX_VALUE,Number.MAX_VALUE),b=Ff.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE),l=Ff.create(),e=f=>{Ff.transformMat3(l,f,this.t_mat);Ff.min(a,a,l);Ff.max(b,b,l)};e(this.top_left);e(this.bottom_right);e(Ff.fromValues(this.top_left[0],this.bottom_right[1]));e(Ff.fromValues(this.bottom_right[0],this.top_left[1]));
return new ej(a[0],a[1],b[0],b[1])}get_spread(){return this.spread}draw_border(a,b="#000"){Dk(this.top_left,this.bottom_right,a,this.t_mat,b)}draw_template(a){this.draw_border(a,"#de77f1")}width(){Id(!1,"width not implemented")}height(){Id(!1,"height not implemented")}get_pixels(){Id(!1,"get_pixels not implemented")}}
class Fk extends Ek{static name(){return"FrameBuffer"}constructor(a,b,l,e,f,h){super(b,l,e,h);this.tex_obj=a;this.imgBitmap=this.pixels=null;this.type=f}width(){return this.tex_obj.width}height(){return this.tex_obj.height}get_pixels(){null===this.pixels&&(th.bindFramebuffer(th.FRAMEBUFFER,th.my_fb),th.framebufferTexture2D(th.FRAMEBUFFER,th.COLOR_ATTACHMENT0,th.TEXTURE_2D,this.tex_obj,0),"rgba"===this.type?(this.pixels=new Uint8Array(this.tex_obj.width*this.tex_obj.height*4),th.readPixels(0,0,this.tex_obj.width,
this.tex_obj.height,th.RGBA,th.UNSIGNED_BYTE,this.pixels)):"float"===this.type?(this.pixels=new Float32Array(this.tex_obj.width*this.tex_obj.height),th.readPixels(0,0,this.tex_obj.width,this.tex_obj.height,th.RED,th.FLOAT,this.pixels)):Id(!1,"unexpected type: "+this.type));return this.pixels}async pre_draw(){0!==this.tex_obj.width&&0!==this.tex_obj.height&&null===this.imgBitmap&&(this.imgBitmap=await Gk(this.tex_obj))}draw(a){Id(null!==this.imgBitmap,"Missing imgBitmap");this.draw_image(this.imgBitmap,
a)}invalidate_img(){this.pixels=this.imgBitmap=null}get_transform_to_pixels(){let a=Qh.create();var b=Ff.fromValues(this.width()/2,this.height()/2);let l=Ff.fromValues(this.width()/this.sz_x,this.height()/this.sz_y);Qh.translate(a,a,b);Qh.scale(a,a,l);b=Qh.create();Qh.invert(b,this.t_mat);Qh.mul(a,a,b);return a}make_gl_texture(){Id(null!==this.tex_obj,"No texture in object");this.tex_obj.t_mat=Qh.create();Qh.copy(this.tex_obj.t_mat,this.t_mat);return this.tex_obj}describe(a,b){b.recreate_if_needed(this)&&
(b.eobj.px_sz=b.add_line("Size in Pixels: ").value_elem,b.eobj.log_sz=b.add_line("Size in Units: ").value_elem,b.eobj.type=b.add_line("Type: ").value_elem,b.eobj.smooth=b.add_line("Smoothing: ").value_elem,b.eobj.spread=b.add_line("Spread: ").value_elem,b.eobj.tr=b.add_line("Transform: ",!0).value_elem,b.eobj.tr.classList.add("obj_inf_var_matrix"),b.adjust_labels());b.eobj.px_sz.innerText=this.width()+" x "+this.height();a=this.logical_size();b.eobj.log_sz.innerText=a[0]+" x "+a[1];b.eobj.type.innerText=
this.type;b.eobj.smooth.innerText=this.smooth;b.eobj.spread.innerText=this.spread;b.eobj.tr.innerText=Oj(this.t_mat)}}
class Hk extends Ek{static name(){return"FrameBufferParams"}constructor(a,b,l,e,f,h,g){super(l,e,f,h);this.t_mat=Qh.create();this.resolution_x=a;this.resolution_y=b;this.type=g}set_type(a){this.type=a}draw(a){this.draw_border(a)}width(){return this.resolution_x}height(){return this.resolution_y}create_tex(){var a=th.createTexture();th.bindTexture(th.TEXTURE_2D,a);"rgba"===this.type?th.texImage2D(th.TEXTURE_2D,0,th.RGBA,this.resolution_x,this.resolution_y,0,th.RGBA,th.UNSIGNED_BYTE,null):"float"==
this.type?th.texImage2D(th.TEXTURE_2D,0,th.R32F,this.resolution_x,this.resolution_y,0,th.RED,th.FLOAT,null):Id(!1,"unexpected texture type "+this.type);a.width=this.resolution_x;a.height=this.resolution_y;Ik(this.smooth,this.spread,this.spread);a=new Fk(a,this.sz_x,this.sz_y,this.smooth,this.type,this.spread);a.transform(this.t_mat);th.bindTexture(th.TEXTURE_2D,null);return a}}
class Jk extends ye{static name(){return"Create Pixel-Buffer"}constructor(a){super(a);this.out_tex=new Td(a,"out_tex");this.resolution=new Lh(a,"Resolution",800,800);this.size=new Jh(a,"Size",2,2);const b=()=>{const l=Math.min(sf.width,sf.height);this.resolution.set(l*this.transform.scale[0]*rf.zoom*this.size.x/2,l*this.transform.scale[1]*rf.zoom*this.size.y/2)};this.zoom_fit=new Wi(a,"Fit resolution to viewport",b);this.size_fit=new Wi(a,"Fit size to viewport",()=>{this.size.modify(Ff.fromValues((rf.rect.right-
rf.rect.left)/rf.viewport_zoom,(rf.rect.bottom-rf.rect.top)/rf.viewport_zoom));let l=Ff.fromValues(.5*sf.width,.5*sf.height);Ff.transformMat3(l,l,rf.t_inv_viewport);this.transform.set_translate(l[0],l[1])});this.size_fit.share_line_elem_from(this.zoom_fit);this.smoothImage=new qh(a,"Smooth Scaling",!0);this.tex_edge=new Ti(a,"Texture Edge",0,["Pad","Reflect","Repeat"]);this.transform=new Ph(a,"Transform");b()}run(){Sd(this.transform.is_valid(),this,"invalid transform");var a=this.size.get_value();
const b=this.resolution.get_value();a=new Hk(b[0],b[1],a[0],a[1],this.smoothImage.get_value(),this.tex_edge.get_sel_name(),"rgba");a.transform(this.transform.v);this.out_tex.set(a)}draw_selection(a){let b=this.out_tex.get_const();null!==b&&(this.transform.draw_dial_at_obj(b,a),this.size.size_dial_draw(this.transform.v,a),b.draw_border(a))}image_find_obj(a){return this.transform.dial.find_obj(a)||this.size.size_dial_find_obj(a)}}
function Kk(a,b,l,e,f,h){Id(0<a&&0<b,"canvas size can't be 0");const g=th.createTexture();th.bindTexture(th.TEXTURE_2D,g);th.texImage2D(th.TEXTURE_2D,0,th.RGBA,a,b,0,th.RGBA,th.UNSIGNED_BYTE,l);g.width=a;g.height=b;Ik(e,f,h);th.bindTexture(th.TEXTURE_2D,null);return g}
function Ik(a,b,l){let e=th.LINEAR;a||(e=th.NEAREST);th.texParameteri(th.TEXTURE_2D,th.TEXTURE_MIN_FILTER,e);th.texParameteri(th.TEXTURE_2D,th.TEXTURE_MAG_FILTER,e);a=th.CLAMP_TO_EDGE;"reflect"==b?a=th.MIRRORED_REPEAT:"repeat"==b&&(a=th.REPEAT);th.texParameteri(th.TEXTURE_2D,th.TEXTURE_WRAP_S,a);b=th.CLAMP_TO_EDGE;"reflect"==l?b=th.MIRRORED_REPEAT:"repeat"==l&&(b=th.REPEAT);th.texParameteri(th.TEXTURE_2D,th.TEXTURE_WRAP_T,b)}function Lk(a){return"\x00"==a[a.length-1]?a.substr(0,a.length-1):a}
function Mk(a,b,l){b=a.createShader(b);a.shaderSource(b,l);a.compileShader(b);if(a.getShaderParameter(b,a.COMPILE_STATUS))return[b,null];l=a.getShaderInfoLog(b);console.log(l);a.deleteShader(b);a=Lk(l);l=a.split("\n");a={};for(let e of l){l=e.trim();if(0==l.length)continue;if(!e.startsWith("ERROR:"))throw Error("unknown line");b=l.substr(6);let f=1,h=6;const g=b.indexOf(":");-1!==g&&(h=b.indexOf(":",g+1),-1!==h&&(parseInt(b.substr(0,g)),f=parseInt(b.substr(g+1,h))));b.substr(h+1).trim();void 0===
a[f]?a[f]={text:l}:a[f].text+="\n"+l}return[null,a]}const Qk={in_tex:(a,b)=>new Nk(a,b,"in_tex",[],21,Ok),in_texi:(a,b)=>new Nk(a,b,"in_texi",[],21,Pk)};function Rk(a){return new Promise(b=>setTimeout(b,a))}
async function Sk(a,b){if(null!==a.ext_par_shader){for(var l=0,e=0,f=null;1E4>l&&!a.getProgramParameter(b,a.ext_par_shader.COMPLETION_STATUS_KHR);)null===f&&500<l&&(f=Ce(De,"shader_wait"),f.innerText="Compiling shader..."),await Rk(e),l+=e,e=10;null!==f&&f.parentElement.removeChild(f);1E3<l&&console.log("waited for shader ",l,"msec")}}
async function Tk(a,b,l,e,f,h=0){let g="#version 300 es\nprecision mediump float;\n";for(let D in f)g+="#define "+D+" ("+f[D]+")\n";0!=(h&1)&&(g+="\nuniform sampler2D _u_in_tex_0;\nuniform sampler2D _u_in_tex_1;\nuniform sampler2D _u_in_tex_2;\nuniform sampler2D _u_in_tex_3;\nuniform mat3 _u_tex_tmat_0;\nuniform mat3 _u_tex_tmat_1;\nuniform mat3 _u_tex_tmat_2;\nuniform mat3 _u_tex_tmat_3;\n\nvec4 in_tex(float x, float y) { \n    return texture(_u_in_tex_0, (_u_tex_tmat_0 * vec3(x, y, 1.0)).xy); \n}\nvec4 in_texi(float i, float x, float y) {  // float since expr puts out only floats\n    switch(int(i)) {\n    case 0: return texture(_u_in_tex_0, (_u_tex_tmat_0 * vec3(x, y, 1.0)).xy);\n    case 1: return texture(_u_in_tex_1, (_u_tex_tmat_1 * vec3(x, y, 1.0)).xy);\n    case 2: return texture(_u_in_tex_2, (_u_tex_tmat_2 * vec3(x, y, 1.0)).xy);\n    case 3: return texture(_u_in_tex_3, (_u_tex_tmat_3 * vec3(x, y, 1.0)).xy);\n    }\n}\nvec4 in_tex(vec2 v) { return in_tex(v.x, v.y); }\nvec4 in_texi(float i, vec2 v) { return in_texi(i, v.x, v.y); }\n");g+=
"#line 1\n";f=performance.now();const [m,q]=Mk(a,a.VERTEX_SHADER,g+b),[r,B]=Mk(a,a.FRAGMENT_SHADER,g+l);if(!m||!r||!e)return[null,q,B];b=a.createProgram();a.attachShader(b,m);a.attachShader(b,r);a.linkProgram(b);a.deleteShader(m);a.deleteShader(r);await Sk(a,b);if(!a.getProgramParameter(b,a.LINK_STATUS))return e=a.getProgramInfoLog(b),console.log(e),a.deleteProgram(b),a={1:{text:Lk(e)}},[null,a,a];b.attrs={};for(let D of e)b.attrs[D]=a.getAttribLocation(b,D);a=performance.now()-f;1E3<a&&console.log("shader compile took ",
a);return[b,q,B]}const Uk={sz:50,width:5,dark:180,light:255};
function Vk(){if(null===th)if(th=Wk.getContext("webgl2")){th.ext_col_float=th.getExtension("EXT_color_buffer_float");Id(null!==th.ext_col_float,"EXT_color_buffer_float unavailable");th.ext_par_shader=th.getExtension("KHR_parallel_shader_compile");th.my_fb=th.createFramebuffer();th.bindFramebuffer(th.FRAMEBUFFER,th.my_fb);var a=th;Xk();var b=Uk.sz;lm.width=b;lm.height=b;mm(nm,b,b,Uk);var l=th.createTexture();th.bindTexture(th.TEXTURE_2D,l);th.texImage2D(th.TEXTURE_2D,0,th.RGBA,b,b,0,th.RGBA,th.UNSIGNED_BYTE,
lm);Ik(!1,"repeat","repeat");th.bindTexture(th.TEXTURE_2D,null);a.dummy_texture=l}else console.error("Failed creating webgl2 context")}function om(a){return" "==a||"\t"==a||"\n"==a||"\r"==a}function pm(a){return"a"<=a&&"z">=a||"A"<=a&&"Z">=a||"_"==a||"0"<=a&&"9">=a}const qm="float int vec2 vec4 sampler2D bool mat3".split(" ");
class rm extends ye{static name(){return"Shader"}constructor(a){super(a);this.in_mesh=new Rd(a,"in_mesh");this.in_texs=new Xd(a,"in_texs");this.in_texs.xoffset=60;this.in_fb=new Rd(a,"in_fb");this.out_tex=new Td(a,"out_texture");this.vtx_text=new Si(a,"Vertex Shader","",b=>{this.try_update_uniforms(this.vtx_text,b,this.uniforms_vert,this.vert_group)});this.frag_text=new Si(a,"Fragment Shader","",b=>{this.try_update_uniforms(this.frag_text,b,this.uniforms_frag,this.frag_group)});this.vert_group=new Xi(a,
"Vertex Shader Uniforms");this.frag_group=new Xi(a,"Fragment Shader Uniforms");this.clear_color=[0,0,0,0];this.sorted_order=[];kk(a,this,this.sorted_order,this.in_texs);this.override_texs=null;this.attr_names=["vtx_pos"];this.program=null;this.uniforms_frag=[];this.uniforms_vert=[];this.uniforms={};this.defines={};this.last_uniforms_err=null;this.opt={override_just_points:!1,shuffle_points_seed:null}}destructtor(){this.program&&th.deleteProgram(this.program)}uniform_by_name(a){return this.uniforms[a]}uniform_by_name_in(a,
b){for(let l of a)if(l.name===b)return l;return null}param_of_uniform(a,b=!1){let l=this.uniforms[a];return void 0===l||null===l?(b&&Sd(!1,this,"Uniform not found "+a),null):l.param}param_of_define(a){a=this.defines[a];return void 0===a||null===a?null:a.param}parse_glsl_uniform_and_defines(a){let b=[],l=0,e=a.length;const f=()=>{for(;om(a[l])&&l<e;)++l;if(l==e)return null;for(var g=l;pm(a[l])&&l<e;)++l;g=a.substring(g,l);return 0==g.length?null:g};for(;;){l=a.indexOf("uniform",l);if(-1===l)break;
l+=7;var h=f();let g=f();if(null===h||null===g)break;"t_mat"!=g&&(Sd(qm.includes(h),this,"Unsupported uniform type "+h),b.push({type:h,name:g}))}h=g=>{for(;;){l=a.indexOf(g,l);if(-1===l)break;l+=g.length;const m=f();if(null===m)break;b.push({type:"define",name:m})}};h("#ifdef");h("#ifndef");return b}update_uniforms(a,b,l){this.last_uniforms_err=null;a=this.parse_glsl_uniform_and_defines("\nuniform sampler2D _u_in_tex_0;\nuniform sampler2D _u_in_tex_1;\nuniform sampler2D _u_in_tex_2;\nuniform sampler2D _u_in_tex_3;\nuniform mat3 _u_tex_tmat_0;\nuniform mat3 _u_tex_tmat_1;\nuniform mat3 _u_tex_tmat_2;\nuniform mat3 _u_tex_tmat_3;\n\nvec4 in_tex(float x, float y) { \n    return texture(_u_in_tex_0, (_u_tex_tmat_0 * vec3(x, y, 1.0)).xy); \n}\nvec4 in_texi(float i, float x, float y) {  // float since expr puts out only floats\n    switch(int(i)) {\n    case 0: return texture(_u_in_tex_0, (_u_tex_tmat_0 * vec3(x, y, 1.0)).xy);\n    case 1: return texture(_u_in_tex_1, (_u_tex_tmat_1 * vec3(x, y, 1.0)).xy);\n    case 2: return texture(_u_in_tex_2, (_u_tex_tmat_2 * vec3(x, y, 1.0)).xy);\n    case 3: return texture(_u_in_tex_3, (_u_tex_tmat_3 * vec3(x, y, 1.0)).xy);\n    }\n}\nvec4 in_tex(vec2 v) { return in_tex(v.x, v.y); }\nvec4 in_texi(float i, vec2 v) { return in_texi(i, v.x, v.y); }\n"+
a);let e=b.length!==a.length;if(!e)for(var f of a){const g=this.uniform_by_name_in(b,f.name);if(null===g||g.type!==f.type){e=!0;break}}if(e){b.length=0;for(let g of a)b.push(g);var h={};b=g=>{for(let m of g)void 0===h[m.name]&&(h[m.name]=m)};b(this.uniforms_frag);b(this.uniforms_vert);b=g=>{for(let m in g)if(void 0===h[m]||h[m].type!==g[m].uniform_type)this.node.remove_param(g[m].param),delete g[m]};b(this.uniforms);b(this.defines);for(let g in h)void 0===this.uniforms[g]&&void 0===this.defines[g]&&
(b=h[g],f={},"float"==b.type?f.param=new Gh(this.node,b.name,0,[0,1]):"int"==b.type||"sampler2D"==b.type?f.param=new Hh(this.node,b.name,0):"vec2"==b.type?f.param=new Jh(this.node,b.name,0,0,!1):"vec4"==b.type?f.param=new Nh(this.node,b.name,gi.rgba):"bool"==b.type||"define"==b.type?f.param=new qh(this.node,b.name,!1):"mat3"==b.type?f.param=new Ph(this.node,b.name):Sd(!1,this,"unexpected uniform type"),b.name.startsWith("_u_")||f.param.set_shader_generated(!0),"define"==b.type?this.defines[g]=f:this.uniforms[g]=
f,f.uniform_type=b.type,f.param.set_group(l));this.vert_group.update_elems();this.frag_group.update_elems()}}try_update_uniforms(a,b,l,e){a._last_err=null;try{this.update_uniforms(b,l,e)}catch(f){this.last_uniforms_err=f.message}}make_tex_aligned_mesh(a,b,l){b=Sj(b,l);b.transform(a.t_mat);return b}is_defines_dirty(){for(let a in this.defines)if(this.defines[a].param.pis_dirty())return!0;return!1}async bind_textures(a,b){Sd(a.length==this.sorted_order.length,this,"unexpected sorted_order size");const l=
[];for(let f=0;4>f;++f){var e=void 0;if(null!==this.override_texs&&void 0!==this.override_texs[f]&&null!==this.override_texs[f])e=this.override_texs[f];else if(f<this.sorted_order.length)e=a[this.sorted_order[f]];else{l.push(f);continue}th.activeTexture(th.TEXTURE0+f);let h;try{e.constructor===WebGLTexture?h=e:((h=e.make_gl_texture(b))&&"function"===typeof h.then&&(h=await h),Sd(null!==h,this,"null tex_obj"))}catch(r){Sd(!1,this,r.message)}this.param_of_uniform("_u_in_tex_"+f,!0).modify(f,!1);th.bindTexture(th.TEXTURE_2D,
h);Sd(void 0!==h.t_mat,this,"texture has no transform");const g=this.param_of_uniform("_u_tex_tmat_"+f,!0);let m=Qh.create();Qh.translate(m,m,Ff.fromValues(.5,.5));e=e instanceof sm||e instanceof tm?b:e;Sd(void 0!==e.sz_x&&void 0!==e.sz_y,this,"Image without dimentions");Qh.scale(m,m,Ff.fromValues(1/e.sz_x,1/e.sz_y));let q=Qh.create();Qh.invert(q,e.t_mat);Qh.mul(m,m,q);g.modify(m,!1)}a=Qh.create();for(let f of l)th.activeTexture(th.TEXTURE0+f),th.bindTexture(th.TEXTURE_2D,th.dummy_texture),this.param_of_uniform("_u_in_tex_"+
f,!0).modify(f,!1),this.param_of_uniform("_u_tex_tmat_"+f,!0).modify(a,!1);th.activeTexture(th.TEXTURE0)}unbind_textures(a){for(let b=0;b<a.length;++b)th.activeTexture(th.TEXTURE0+b),th.bindTexture(th.TEXTURE_2D,th.dummy_texture);th.activeTexture(th.TEXTURE0)}async run(){Vk();Sd(null===this.last_uniforms_err,this,this.last_uniforms_err);var a=this.in_fb.get_const();Sd(null!==a,this,"missing input FrameBuffer factory");Sd(0!==a.width()&&0!==a.height(),this,"frame buffer has zero size");Sd(void 0!==
a.create_tex,this,"Expected FrameBuffer factory object");const b=a.create_tex();Sd(null!==b,this,"missing input texture");const l=this.in_texs.get_input_consts();Sd(4>l.length,this,"Too many input textures");for(var e of l)Sd(null!==e,this,"Connected texture input has null object"),Sd(void 0!==e.make_gl_texture,this,"Input should be able to convert to textute"),void 0!==e.premake_gl_texture&&await e.premake_gl_texture(a);e=this.in_mesh.get_const();null===e&&(e=this.make_tex_aligned_mesh(b,b.sz_x,
b.sz_y));Sd(void 0!==e.type,this,"input needs to be a mesh object");Sd(2===e.type||0===e.type||this.opt.override_just_points,this,"No triangle faces in input mesh");if(this.vtx_text.pis_dirty()||this.frag_text.pis_dirty()||this.is_defines_dirty()||null===this.program){this.program&&th.deleteProgram(this.program);const h={};for(var f in this.defines){const r=this.defines[f].param.get_value();if(!0===r||1===r)h[f]=1}const [g,m,q]=await Tk(th,this.vtx_text.v,this.frag_text.v,this.attr_names,h,1);this.program=
g;this.vtx_text.set_errors(m);this.frag_text.set_errors(q);Sd(this.program,this,"failed to compile shaders");this.program.uniforms={};for(let r of Object.keys(this.uniforms).concat(["t_mat"]))this.program.uniforms[r]=th.getUniformLocation(this.program,r)}th.bindFramebuffer(th.FRAMEBUFFER,th.my_fb);Wk.sresize(b.width(),b.height());th.viewport(0,0,b.width(),b.height());th.useProgram(this.program);await this.bind_textures(l,a);a=Qh.create();Qh.invert(a,b.t_mat);f=Qh.create();Qh.fromScaling(f,Ff.fromValues(2/
b.sz_x,2/b.sz_y));Qh.mul(a,f,a);f=Qh.create();Qh.copy(f,b.t_mat);Qh.scale(f,f,Ff.fromValues(b.sz_x/2,b.sz_y/2));null!==this.program.uniforms.t_mat&&th.uniformMatrix3fv(this.program.uniforms.t_mat,!1,f);for(let h in this.uniforms)null!==this.program.uniforms[h]&&this.uniforms[h].param.gl_set_value(this.program.uniforms[h]);th.framebufferTexture2D(th.FRAMEBUFFER,th.COLOR_ATTACHMENT0,th.TEXTURE_2D,b.tex_obj,0);th.clearColor(this.clear_color[0],this.clear_color[1],this.clear_color[2],this.clear_color[3]);
th.clear(th.COLOR_BUFFER_BIT);try{e.gl_draw(a,this.program.attrs,this.opt)}catch(h){console.warn(h.message),Sd(!1,this,"Failed webgl draw")}this.unbind_textures(l);b.invalidate_img();this.out_tex.set(b)}}
function um(a){a.last_canvas_max={w:0,h:0};a.req_size={w:0,h:0};a.reset_to_latest_max=function(){0<a.last_canvas_max.w&&0<a.last_canvas_max.h&&(a.width>a.last_canvas_max.w||a.height>a.last_canvas_max.h)&&(a.width=a.last_canvas_max.w,a.height=a.last_canvas_max.h);a.last_canvas_max.w=0;a.last_canvas_max.h=0};a.sresize=function(b,l){a.width<b&&(a.width=b);a.height<l&&(a.height=l);a.req_size.w=b;a.req_size.h=l;b>a.last_canvas_max.w&&(a.last_canvas_max.w=b);l>a.last_canvas_max.h&&(a.last_canvas_max.h=
l)};a.y_offset=function(){return a.height-a.req_size.h}}const vm={mesh:null,program:null,vtx_src:"\nin vec4 vtx_pos;\nout vec2 v_coord;\nvoid main() {\n    v_coord = vec2(vtx_pos.x*0.5+0.5,  1.0-(vtx_pos.y*0.5+0.5));\n    gl_Position = vtx_pos;\n}\n    ",frag_src:"\nprecision mediump float;\nin vec2 v_coord;\nuniform sampler2D uTex;\nout vec4 outColor;\nvoid main() {\n    outColor = texture(uTex, v_coord);\n}\n    "};
async function Gk(a){Id(void 0!==a.width&&void 0!==a.height,"Missing dimentions of tex");Id(0<a.width&&0<a.height,"dimentions is 0");Wk.sresize(a.width,a.height);th.bindFramebuffer(th.FRAMEBUFFER,null);th.viewport(0,0,a.width,a.height);if(null===vm.mesh){var [b]=await Tk(th,vm.vtx_src,vm.frag_src,["vtx_pos"],[],0);vm.program=b;Id(null!==vm.program,"failed compile teximg");vm.mesh=Sj(1,1)}th.useProgram(vm.program);th.activeTexture(th.TEXTURE0);th.bindTexture(th.TEXTURE_2D,a);th.clearColor(0,0,0,0);
th.clear(th.COLOR_BUFFER_BIT);th.disable(th.DEPTH_TEST);th.disable(th.CULL_FACE);b=Qh.create();vm.mesh.gl_draw(b,vm.program.attrs);a=await createImageBitmap(Wk,0,Wk.y_offset(),a.width,a.height);th.bindTexture(th.TEXTURE_2D,null);return a}function wm(a,b,l,e){for(let f of e)void 0!==a[f]&&(b[f]=function(){return a[f].apply(l,arguments)})}
class xm extends Pd{constructor(a,b,l=null,e=null){super(null!==l?l:b.name,a,b.is_input,e);this.wrap_term=b;this.width=b.width;this.lines=b.lines;this.is_input=b.is_input;this.update_subscriber=b.update_subscriber;this.caching=b.caching;wm(b,this,b,"set get_const get_mutable clear tset_dirty is_dirty get_input_consts intr_set get_cur_uver force_set is_caching is_out_term subscribe_inf_update get_ctrl_block".split(" "));wm(b,this,this,["draw_path"]);b.constructor===Xd&&(this.get_attachment=()=>new Ud(this))}tdid_connect(a){super.tdid_connect(a);
this.wrap_term.owner.cls.did_connect(this.wrap_term,a)}tdoing_disconnect(a){super.tdoing_disconnect(a);this.wrap_term.owner.cls.doing_disconnect(this.wrap_term,a)}}
class ym extends ye{constructor(a){super(a);this.prog=new pj;this.nodes=[]}add_parcel_node(a){a=this.prog.add_node(0,0,null,a,null);this.nodes.push(a);null===this.node.subnodes&&(this.node.subnodes=[]);this.node.subnodes.push(a);return a}destructtor(){for(let a of this.nodes)a.cls.destructtor()}get_error(){if(null!==this.error)return this.error;for(let a of this.nodes){const b=a.cls.get_error();if(null!==b)return b}return null}clear_error(){this.error=null;for(let a of this.nodes)a.cls.clear_error()}cclear_dirty(){for(let a of this.nodes)a.clear_dirty()}is_internal_dirty(){for(let a of this.nodes)if(a.has_anything_dirty())return!0;
return!1}}class zm extends ym{constructor(a){super(a);this.shader_node=this.add_parcel_node(rm)}}
class Am extends zm{static name(){return"Point Gradient Fill"}constructor(a){super(a);this.shader_node.cls.attr_names=["vtx_pos","vtx_color"];this.in_mesh=new xm(a,this.shader_node.cls.in_mesh);this.in_fb=new xm(a,this.shader_node.cls.in_fb);this.out_tex=new xm(a,this.shader_node.cls.out_tex);this.shader_node.cls.vtx_text.set_text("\nin vec4 vtx_pos;\nin vec4 vtx_color;\n\nout vec2 v_coord;\nout vec4 v_color;\n\nvoid main() {\n    v_coord = vtx_pos.xy;\n    v_color = vtx_color;\n    gl_Position = vtx_pos;\n}\n");this.shader_node.cls.frag_text.set_text("\nprecision mediump float;\n\nin vec2 v_coord;\nin vec4 v_color;\nout vec4 outColor;\n\nvoid main() {\n    outColor = v_color;\n    //outColor = vec4(v_coord.xy, 1.0, 1.0);\n}\n")}async run(){await this.shader_node.cls.run()}}
class Bm extends ym{static name(){return"Scatter Func"}constructor(a){super(a);this.shader_node=this.add_parcel_node(rm);this.clip_shader_node=this.add_parcel_node(rm);this.triangulate=this.add_parcel_node(wk);this.shader_node.cls.attr_names=["vtx_pos"];let b=()=>{this.seed.set_enable(this.shuffle_in_points.v||!this.in_points.has_connection())};this.in_points=new xm(a,this.shader_node.cls.in_mesh,"in_points",l=>{this.start_point_count.set_enable(!l);this.shuffle_in_points.set_enable(l);b()});this.in_texs=
new xm(a,this.shader_node.cls.in_texs,"in_texs");this.in_texs.width=16;this.in_clip_shape=new Rd(a,"clip_shape",l=>{this.do_clip.set_enable(l)});this.out_tex=new xm(a,this.shader_node.cls.out_tex);a.set_state_evaluators({coord:(l,e)=>new Nk(l,e,"v_coord",["x","y"],12),...Qk});this.rel_res=new Gh(a,"Pixels Per Unit",200);this.start_point_count=new Hh(a,"Start Count",1E4);this.shuffle_in_points=new qh(a,"Shuffle Input",!0,()=>{b()});this.seed=new Hh(a,"Seed",1);this.do_clip=new Ti(a,"Clip Object",0,
["Clips by bounding-box","Clips by shape"]);this.density=new Gh(a,"Density",.1,{show_code:!0});this.shader_node.cls.frag_text.set_text("\nflat in float v_size;\nout vec4 outColor;\n\nvoid main() {\n    if (v_size < 0.0)\n        discard;\n    // center on vertex\n    vec2 pc = (gl_PointCoord - vec2(0.5));\n\n    float dist = length(pc);\n    if (dist > 0.5)\n        discard;\n\n    if (dist * v_size <= 0.7) // black dot\n        outColor = vec4(1.0, 0.0, 0.0, 1.0);\n    else {\n        outColor = vec4(0.7, 0.7, 0.7, 1.0);\n    }\n}\n");
this.shader_node.cls.opt.override_just_points=!0;this.clip_shader_node.cls.vtx_text.set_text("\nin vec4 vtx_pos;\nvoid main() {\n    gl_Position = vtx_pos;\n}\n");this.clip_shader_node.cls.frag_text.set_text("\nout vec4 outColor;\nvoid main() {\n    outColor = vec4(1.0, 1.0, 1.0, 1.0);\n}\n")}make_vtx_text(a,b,l){const e=new Cm,f=a.get_active_item();if(null!==f.e){null!==f.elast_error&&Sd(!1,this,"Expression error");try{e.inline_str=zh.do_to_glsl(f.e,e)}catch(h){Sd(!1,this,h.message)}}else e.inline_str=
a.get_value(),Number.isInteger(e.inline_str)&&(e.inline_str+=".0");a=e.do_replace(b);l.set_text(a);e.set_uniform_vars(this.shader_node.cls)}create_fb(a){var b=a.width(),l=a.height();b=new Hk(Math.round(this.rel_res.v*b),Math.round(this.rel_res.v*l),b,l,!1,"pad","rgba");l=Qh.create();Qh.fromTranslation(l,a.center());b.transform(l);return b}random_points_mesh(a,b,l){const e=new jj(b);b=new di(2*l);const f=a.min_x,h=a.min_y,g=a.width();a=a.height();for(let m=0,q=0;m<l;++m)b[q++]=f+g*e.next(),b[q++]=
h+a*e.next();l=new ij;l.type=3;l.set("vtx_pos",b,2,!1);return l}async render_clip_mask(a,b){if(this.in_clip_shape.is_dirty()){if(a.constructor!==ij||2!=a.type)this.triangulate.cls.in_obj.force_set(a),this.triangulate.cls.run(),a=this.triangulate.cls.out_mesh.get_const();this.clip_shader_node.cls.in_mesh.force_set(a)}this.clip_shader_node.cls.in_fb.force_set(b);this.clip_shader_node.cls.clear_color=[0,0,0,1];await this.clip_shader_node.cls.run();a=this.clip_shader_node.cls.out_tex.get_const();Sd(null!==
a,this,"failed clip render");return a}async run(){var a=this.in_clip_shape.get_const(),b=this.in_points.get_const();if(null!==a){Sd(void 0!==a.get_bbox,this,"clip_shape input needs to be a shape");var l=a.get_bbox()}else Sd(null!==b,this,"missing geometry to define area by"),Sd(void 0!==b.get_bbox,this,"in_points input needs to geometry"),l=b.get_bbox();null===b?(b=this.random_points_mesh(l,this.seed.v,this.start_point_count.v,a),this.in_points.set(b),this.shader_node.cls.opt.shuffle_points_seed=
null):this.shader_node.cls.opt.shuffle_points_seed=this.shuffle_in_points.v?this.seed.v:null;this.make_vtx_text(this.density,"\nin vec2 vtx_pos;\n\nuniform mat3 t_mat;\nuniform vec2 res;\nuniform float rel_res; // in screen units\n\nflat out float v_size;\n\n$UNIFORM_DEFS$\n\n$FUNCS$\n\nfloat flt_expr(vec2 v_coord) {\n    $EXPR$\n}\n\nvoid main() {\n    vec3 tmp = t_mat * vec3(vtx_pos.xy, 1.0);\n    vec2 v_coord = tmp.xy;\n    \n    if (in_texi(3.0, v_coord).r == 0.0) {\n        v_size = -1.0;\n        gl_PointSize = 1.0; // should not be 0\n    }\n    else {\n        float f = flt_expr(v_coord);\n\n        // discretisize the pixel position to whole pixels\n        gl_Position = vec4( (floor(vtx_pos.xy * res) + vec2(0.5,0.5)) / res, 0.0, 1.0) ;\n\n        f = f * rel_res ;\n        v_size = f;\n        gl_PointSize = f;\n    }\n}   \n    \n",
this.shader_node.cls.vtx_text);l=this.create_fb(l);this.shader_node.cls.in_fb.force_set(l);null!==a&&1==this.do_clip.sel_idx?(a=await this.render_clip_mask(a,l),this.shader_node.cls.override_texs={3:a}):this.shader_node.cls.override_texs=null;this.shader_node.cls.param_of_uniform("res").modify([l.resolution_x,l.resolution_y]);this.shader_node.cls.param_of_uniform("rel_res").modify(this.rel_res.v);await this.shader_node.cls.run()}}
class Dm extends ye{static name(){return"Pixels to Vertices"}constructor(a){super(a);this.in_tex=new Rd(a,"in_tex");this.out_pnt=new Td(a,"out_pnt")}extract_points(a){const b=[];var l=a.get_pixels();const e=a.width(),f=a.height(),[h,g]=a.logical_size(),m=h/e,q=g/f,r=.5*h,B=.5*g;a=a.t_mat;let D=0;const F=Ff.create(),G=Ff.create();for(let N=0;N<f;++N)for(let T=0;T<e;++T){const V=l[D];D+=4;255==V&&(F[0]=T*m-r,F[1]=N*q-B,Ff.transformMat3(G,F,a),b.push(G[0],G[1]))}l=new ij;l.set("vtx_pos",new di(b),2,
!1);l.type=3;return l}run(){var a=this.in_tex.get_const();Sd(null!==a,this,"Missing image input");a=this.extract_points(a);this.out_pnt.set(a)}}
class Em extends Fk{static name(){return"PImage"}constructor(a,b,l,e,f){let h=null;void 0!==a&&null!==a&&(h=th.createTexture(),th.bindTexture(th.TEXTURE_2D,h),th.texImage2D(th.TEXTURE_2D,0,th.RGBA,a.width,a.height,0,th.RGBA,th.UNSIGNED_BYTE,0<a.width&&0<a.height?a:null),h.width=a.width,h.height=a.height,Ik(b,l,l),th.bindTexture(th.TEXTURE_2D,null));super(h,e,f,b,"rgba",l);this.img=a;this.pixels=null}draw(a){this.draw_image(this.img,a)}get_pixels(){null===this.pixels&&0!=this.img.width&&0!=this.img.height&&
(Gf.width=this.img.width,Gf.height=this.img.height,Bd.drawImage(this.img,0,0,this.img.width,this.img.height),this.pixels=Bd.getImageData(0,0,this.img.width,this.img.height).data);return this.pixels}}
class Fm extends ye{static name(){return"Load Image"}constructor(a){super(a);this.file_upload=new Vi(a,"File Upload");this.size=new Jh(a,"size",2,2);this.size_fit=new Wi(a,"Fit size to viewport",()=>{this.size_fit_func()});this.smooth_image=new qh(a,"Smooth Scaling",!0);this.transform=new Ph(a,"Transform");this.out_img=new Td(a,"out_img");this.tex_edge=new Ti(a,"Texture Edge",0,["Pad","Reflect","Repeat"]);this.pimg_cache=null}size_fit_func(){const a=this.file_upload.try_get_image();null!==a&&this.size.modify_e(a.width/
rf.viewport_zoom,a.height/rf.viewport_zoom)}run(){Vk();if(this.file_upload.pis_dirty()||this.size.pis_dirty()||this.smooth_image.pis_dirty()||this.tex_edge.pis_dirty()||null===this.pimg_cache){const a=this.file_upload.get_image(),b=this.size.get_value();this.pimg_cache=new Em(a,this.smooth_image.v,this.tex_edge.get_sel_name(),b[0],b[1])}Sd(this.transform.is_valid(),this,"invalid transform");this.pimg_cache.set_transform(this.transform.v);this.out_img.set(this.pimg_cache)}draw_selection(a){let b=this.out_img.get_const();
null!==b&&(this.transform.draw_dial_at_obj(b,a),b.draw_border(a),this.size.size_dial_draw(this.transform.v,a))}image_find_obj(a){return this.transform.dial.find_obj(a)||this.size.size_dial_find_obj(a)}}class Gm{constructor(a,b){this.x=a;this.y=b;a=1.5/rf.viewport_zoom;this.bbox=new ej(this.x-a,this.y-a,this.x+a,this.y+a)}get_bbox(){return this.bbox}}
class Hm extends qe{static name(){return"Sample Color"}constructor(a){super(a);this.in_source=new Rd(a,"in_src");this.pos=new Jh(a,"Offset",0,0);this.pos.dial=new Th((b,l)=>{this.pos.increment(Ff.fromValues(b,l))});this.name=new oh(a,"Name","samp_color")}async run(){var a=new fk(this.in_source,this);const b=this.pos.get_value();try{await a.prepare(new Gm(b[0],b[1]))}catch(l){Sd(!1,this,l.message)}a.do_get_pixels();a=a.sample_at_v(b);this.out_single_var(this.name.get_value(),11,a)}draw_selection(a){this.pos.show_code||
this.pos.dial.draw(this.pos.x,this.pos.y,null,a)}image_find_obj(a){return this.pos.show_code?null:this.pos.dial.find_obj(a)}}
class fk{constructor(a,b){this.in_source=a;this.height_=this.width_=this.src=null;this.in_node=b}async prepare(a){this.src=this.in_source.get_const();Sd(null!==this.src,this.in_node,"missing input source");void 0!==this.src.get_pixels_adapter&&(this.src=await this.src.get_pixels_adapter(a,!1));Sd(void 0!==this.src.get_pixels,this.in_node,"expected object with pixels")}width(){return this.width_}height(){return this.height_}do_get_pixels(){this.pixels=this.src.get_pixels();this.transform=this.src.get_transform_to_pixels();
Sd(null!==this.pixels,this.in_node,"Input image is empty");this.width_=this.src.width();this.height_=this.src.height()}sample_at(){Ah(1<=arguments.length&&2>=arguments.length,"Wrong number of arguments in call to at()");if(1==arguments.length){var a=arguments[0];void 0!==a.length?Ah(2===a.length,"expected numbers or vec2 argument"):a=[a,0]}else a=arguments;return this.sample_at_v(a)}sample_at_v(a){Ff.transformMat3(a,a,this.transform);var b=Math.round(a[0]);a=Math.round(a[1]);const l=this.src.get_spread();
b=Im(l,b,this.width_);a=Im(l,a,this.height_);b=4*(a*this.width_+b);a=this.pixels;return Oh.fromValues(a[b],a[b+1],a[b+2],a[b+3])}}function Im(a,b,l){if(0>b){if("pad"===a)return 0;if("repeat"===a)return l+b%l-1;if("reflect"===a)return b=-b,b%(2*l)<l?b%l:l-b%l;Id(!1,"unexpected spread value "+a)}else if(b>=l){if("pad"===a)return l-1;if("repeat"===a)return b%l;if("reflect"===a)return b%(2*l)<l?b%l:l-b%l-1;Id(!1,"unexpected spread value "+a)}return b}
class Uj extends yd{static name(){return"MultiPath"}constructor(){super();this.paths_ranges=[];this.paths=null;this.arrs={vtx_pos:null};this.meta={vtx_pos:null};this.consts={};this.tcache={vtx_pos:null,m:null};this.fill_objs=[null];this.eff_ctrl_from_prev=this.eff_ctrl_to_prev=this.effective_vtx_pos=this.clipper_obj=this.paper_obj=null;this.forVec2Arrs=ij.prototype.forVec2Arrs}set(a,b,l,e=!1){a=cj(a);this.arrs[a]=b;this.meta[a]={num_elems:l,need_normalize:e};"vtx_pos"!=a&&"ctrl_to_prev"!=a&&"ctrl_from_prev"!=
a&&"face_color"!=a&&"face_transform"!=a&&"vtx_transform"!=a||this.invalidate_pos()}set_const(a,b){this.consts[a]=b}oclone(){const a=new Uj;a.paths=null;a.arrs=Kd(this.arrs);a.meta=Kd(this.meta);a.consts=Kd(this.consts);a.paths_ranges=Kd(this.paths_ranges);a.tcache={vtx_pos:null,m:null};a.fill_objs=Kd(this.fill_objs);a.paper_obj=null;a.clipper_obj=null;a.effective_vtx_pos=this.effective_vtx_pos===this.arrs.vtx_pos?a.arrs.vtx_pos:Kd(this.effective_vtx_pos);a.eff_ctrl_to_prev=this.eff_ctrl_to_prev===
this.arrs.ctrl_to_prev?a.arrs.ctrl_to_prev:Kd(this.eff_ctrl_to_prev);a.eff_ctrl_from_prev=this.eff_ctrl_from_prev===this.arrs.ctrl_from_prev?a.arrs.ctrl_from_prev:Kd(this.eff_ctrl_from_prev);return a}invalidate_pos(a=!0){a&&(this.paths=null);this.clipper_obj=this.paper_obj=null;this.make_effective_vtx_pos()}make_effective_vtx_pos(){this.eff_ctrl_to_prev=this.arrs.ctrl_to_prev;this.eff_ctrl_from_prev=this.arrs.ctrl_from_prev;return ij.prototype.make_effective_vtx_pos.call(this)}get_disp_params(a){var b=
new vh(a,"Show Vertices","show_vtx",!0),l=new vh(a,"Show Lines","show_lines",!0);const e=[b,l];void 0!==this.arrs.line_color&&(b=new vh(a,"In Color","color_lines",!0),b.share_line_elem_from(l),e.push(b));this.has_curves()&&(l=new vh(a,"Show Curve Controls ","show_ctrls",!0),b=new vh(a,"Points","show_ctrls_pnts",!0),b.share_line_elem_from(l),e.push(l,b));void 0===this.arrs.face_color&&void 0===this.consts.face_color||e.push(new vh(a,"Show Faces","show_faces",!0));this.forVec2Arrs(f=>{const h=new vh(a,
"Show "+f,"show_"+f,!0);f=new Ih(a,"Scale","scale_"+f,1);f.share_line_elem_from(h);e.push(h,f)});return e}transform(a){ij.transform_arr(a,this.arrs.vtx_pos,this.arrs.vtx_pos);a=Qh.clone(a);a[6]=0;a[7]=0;this.is_curve()&&(ij.transform_arr(a,this.arrs.ctrl_to_prev,this.arrs.ctrl_to_prev),ij.transform_arr(a,this.arrs.ctrl_from_prev,this.arrs.ctrl_from_prev));this.invalidate_pos()}transform_per_face(){const a=this.arrs.face_transform;Id(a.length/6===this.face_count(),"unexpect length of face_transform");
let b=this.effective_vtx_pos,l=this.eff_ctrl_to_prev,e=this.eff_ctrl_from_prev;const f=this.is_curve();if(null===this.effective_vtx_pos||this.effective_vtx_pos===this.arrs.vtx_pos||this.effective_vtx_pos.length!=b.length)this.effective_vtx_pos=new di(b.length),f&&(this.eff_ctrl_to_prev=new di(l.length),this.eff_ctrl_from_prev=new di(e.length));const h=this.effective_vtx_pos,g=this.eff_ctrl_to_prev,m=this.eff_ctrl_from_prev;for(let r=0,B=0;r<this.paths_ranges.length;r+=3,B+=6){var q=2*this.paths_ranges[r];
let D=2*this.paths_ranges[r+1];for(;q<D;q+=2){let F=b[q],G=b[q+1];h[q]=a[B]*F+a[B+2]*G+a[B+4];h[q+1]=a[B+1]*F+a[B+3]*G+a[B+5];f&&(F=l[q],G=l[q+1],g[q]=a[B]*F+a[B+2]*G,g[q+1]=a[B+1]*F+a[B+3]*G,F=e[q],G=e[q+1],m[q]=a[B]*F+a[B+2]*G,m[q+1]=a[B+1]*F+a[B+3]*G)}}}vec_transform_per_vtx(a){const b=this.arrs[a],l=this.arrs.vtx_transform;Id(l.length/6===b.length/2,"unexpect length of vtx_transform");let e=this["eff_"+a];if(null===e||e===b||e.length!=b.length)e=new di(b.length);this["eff_"+a]=e;for(let f=0,h=
0;f<e.length;f+=2,h+=6){a=b[f];let g=b[f+1];e[f]=l[h]*a+l[h+2]*g;e[f+1]=l[h+1]*a+l[h+3]*g}}transform_per_vtx(){ij.prototype.transform_per_vtx.call(this);this.is_curve()&&(this.vec_transform_per_vtx("ctrl_to_prev"),this.vec_transform_per_vtx("ctrl_from_prev"))}computed_prop(a){return ij.prototype.computed_prop.call(this,a)}face_center(a){var b=2*this.paths_ranges[3*a];const l=2*this.paths_ranges[3*a+1];let e=this.effective_vtx_pos,f=a=0;for(let h=b;h<l;h+=2)a+=e[h],f+=e[h+1];b=(l-b)/2;return Ff.fromValues(a/
b,f/b)}is_point_inside(a,b){return ij.prototype.is_point_inside.call(this,a,b)}get_bbox(){if(this.has_curves()){let a=this.eff_ctrl_to_prev,b=this.eff_ctrl_from_prev;if(0==this.effective_vtx_pos.length)return null;let l=Number.MAX_VALUE,e=-Number.MAX_VALUE,f=Number.MAX_VALUE,h=-Number.MAX_VALUE;this.foreach_line((g,m,q,r,B)=>{let D=r+a[g],F=B+a[g+1];m+=b[g];g=q+b[g+1];l=Math.min(l,r,D,m);e=Math.max(e,r,D,m);f=Math.min(f,B,F,g);h=Math.max(h,B,F,g)});return new ej(l,f,e,h)}return ij.prototype.get_bbox.call(this)}draw_border(a){ij.prototype.draw_border.call(this,
a)}face_count(){return this.paths_ranges.length/3}vtx_count(){return ij.prototype.vtx_count.call(this)}ensure_tcache(a){return ij.prototype.ensure_tcache.call(this,a)}vidxs_of_face(a){console.assert(3*a<this.paths_ranges.length,"index out of bounds");var b=2*this.paths_ranges[3*a];a=2*this.paths_ranges[3*a+1];let l=[];for(;b<a;b+=2)l.push(b);return l}is_curve(a){let b=this.arrs.ctrl_to_prev,l=this.arrs.ctrl_from_prev;return void 0!==b&&void 0!==l&&(0!=b[a]||0!=b[a+1]||0!=l[a]||0!=l[a+1])}has_curves(){return void 0!==
this.arrs.ctrl_to_prev&&null!==this.arrs.ctrl_to_prev}call_path_commands(a,b){var l=this.effective_vtx_pos;let e=this.eff_ctrl_to_prev,f=this.eff_ctrl_from_prev,h=2*this.paths_ranges[b];var g=2*this.paths_ranges[b+1];let m=l[h],q=l[h+1];a.moveTo(m,q,h/2);for(let r=h+2;r<g;r+=2){let B=l[r],D=l[r+1];this.is_curve(r)?a.bezierCurveTo(m+f[r],q+f[r+1],B+e[r],D+e[r+1],B,D,r/2):a.lineTo(B,D,r/2);m=B;q=D}if(1==(this.paths_ranges[b+2]&1)){if(b=this.is_curve(h))g=l[h],l=l[h+1],a.bezierCurveTo(m+f[h],q+f[h+1],
g+e[h],l+e[h+1],g,l,h/2);a.closePath(!b)}void 0!==a.donePath&&a.donePath()}call_all_paths_commands(a){for(let b=0;b<this.paths_ranges.length;b+=3)a.startPath(this.paths_ranges[b+1]-this.paths_ranges[b]),this.call_path_commands(a,b)}ensure_paths_created(){if(null===this.paths||3*this.paths.length!==this.paths_ranges.length){var a=this.arrs.face_color,b=void 0!==a,l=0;this.paths=[];var e=null;for(let f=0;f<this.paths_ranges.length;f+=3){const h=2==(this.paths_ranges[f+2]&2);let g=null;b&&(g="rgba("+
a[l]+","+a[l+1]+","+a[l+2]+","+a[l+3]/255+")",l+=4);h?Id(null!==e,"continue-prev must have previous path"):(e=zd.makePath2D(),e.face_color=g);this.call_path_commands(e,f);h||this.paths.push(e)}}}make_clip_path(a,b){let l=zd.makePath2D();for(let e=0,f=0;e<this.paths_ranges.length;e+=3,++f)a[f]==b&&this.call_path_commands(l,e);return l}draw_poly(a,b,l,e){this.ensure_paths_created();const f=1/rf.viewport_zoom;let h=null;e=void 0!==this.arrs.line_color&&e;var g=void 0!==this.arrs.line_width;e&&g?h=new Jm(zd,
this.arrs.line_color,this.arrs.line_width,f,this.vtx_count()):e?h=new Km(zd,this.arrs.line_color,this.vtx_count()):g&&(h=new Lm(zd,this.arrs.line_width,f,this.vtx_count()));null===l&&(l=void 0!==this.consts.line_color?Mm(this.consts.line_color):"#000");e=void 0!==this.consts.line_width?this.consts.line_width:aj.line_width;g=void 0!==this.consts.face_color;let m=null;g&&(m=Mm(this.consts.face_color));let q=0;for(let B of this.paths){var r=null!==B.face_color;b&&(r||g)&&(r=r?B.face_color:m,zd.fillStyle=
r,zd.fill(B),zd.lineWidth=f,zd.strokeStyle=r,zd.need_antialias_gap_fill&&zd.stroke(B));a&&(zd.lineWidth=e*f,zd.strokeStyle=l,h?this.call_path_commands(h,q):zd.stroke(B));q+=3}}foreach_line(a){let b=this.effective_vtx_pos;for(let e=0;e<this.paths_ranges.length;e+=3){var l=2*this.paths_ranges[e];const f=2*this.paths_ranges[e+1];let h=b[f-2],g=b[f-2+1];for(;l<f;l+=2){const m=b[l],q=b[l+1];a(l,h,g,m,q);h=m;g=q}}}draw_control_points(a,b="#000"){const l=this.eff_ctrl_to_prev,e=this.eff_ctrl_from_prev,f=
aj.vtx_radius/rf.viewport_zoom;zd.strokeStyle=b;zd.beginPath();this.foreach_line((h,g,m,q,r)=>{if(this.is_curve(h)){const B=e[h],D=e[h+1],F=l[h];h=l[h+1];const G=g+B,N=m+D,T=q+F,V=r+h;zd.moveTo(g,m);zd.lineTo(G,N);zd.moveTo(q,r);zd.lineTo(T,V);if(a){if(0!=B||0!=D)zd.moveTo(G+f,N),zd.arc(G,N,f,0,2*Math.PI);if(0!=F||0!=h)zd.moveTo(T+f,V),zd.arc(T,V,f,0,2*Math.PI)}}});zd.lineWidth=aj.line_width/rf.viewport_zoom;zd.stroke()}async pre_draw(a){null!==this.arrs.vtx_pos&&!this.arrs.face_color&&this.arrs.face_fill&&
await ij.prototype.pre_draw_poly_fill_clip.call(this,a)}draw_m(a,b){null!==this.arrs.vtx_pos&&(!this.arrs.face_color&&this.arrs.face_fill&&ij.prototype.draw_poly_fill_clip.call(this,a),(b.show_lines||b.show_faces)&&this.draw_poly(b.show_lines,b.show_faces,null,b.color_lines),b.show_vtx&&ij.prototype.draw_vertices.call(this,"#000",!0,b),b.show_ctrls&&this.draw_control_points(b.show_ctrls_pnts))}draw_selection_m(a,b){ij.prototype.draw_selection_m.call(this,a,b)}draw_template_m(){this.draw_poly(!0,!1,
"#de77f1",!1);ij.prototype.draw_vertices.call(this,"#de77f1",!1)}add_fillobj(a){return ij.prototype.add_fillobj.call(this,a)}ensure_paper(){if(null!==this.paper_obj&&3*this.paper_obj.children.length===this.paths_ranges.length)return this.paper_obj;const a=new pc.CompoundPath;a.remove();a.bezierCurveTo=a.cubicCurveTo;for(let b=0;b<this.paths_ranges.length;b+=3)this.call_path_commands(a,b);return this.paper_obj=a}from_paper(a){let b=[],l=[],e=[],f=[],h=0,g=!1;for(let r of a.children){const B=h;var m=
r.lastCurve;for(let D of r.curves){var q=D.point1;b.push(q.x,q.y);q=m.handle2;m=m.handle1;l.push(q.x,q.y);e.push(m.x,m.y);if(0!==m.x||0!==m.y||0!==q.x||0!==q.y)g=!0;++h;m=D}f.push(B,h,r.closed?1:0)}this.set("vtx_pos",new di(b),2);g&&(this.set("ctrl_to_prev",new di(l),2),this.set("ctrl_from_prev",new di(e),2));this.paths_ranges=f;this.invalidate_pos();this.paper_obj=a}has_open(){for(let a=0;a<this.paths_ranges.length;a+=3)if(1!=(this.paths_ranges[a+2]&1))return!0;return!1}ensure_clipper(){if(null!==
this.clipper_obj)return this.clipper_obj;const a=new lj;for(let b=0;b<this.paths_ranges.length;b+=3)this.call_path_commands(a,b);return this.clipper_obj=a.d}from_clipper_paths(a){let b=[],l=[],e=0,f=[];if(a.constructor===ClipperLib.PolyTree)for(var h of a.m_AllPolys){var g=e;for(let m of h.m_polygon)b.push(m.X/1,m.Y/1),f.push(m.Z),++e;l.push(g,e,h.IsOpen?0:1);h.closed=!h.IsOpen}else for(g of a){h=e;for(let m of g)b.push(m.X/1,m.Y/1),f.push(m.Z),++e;l.push(h,e,1);g.closed=!0}this.set("vtx_pos",new di(b),
2);this.paths_ranges=l;this.invalidate_pos();this.clipper_obj=a;return f}add_vertex(a,b){Id(this.effective_vtx_pos===this.arrs.vtx_pos,"Working with effective_vtx_pos not supported");ij.prototype.add_vertex_props.call(this,a,b);0==this.paths_ranges.length&&this.paths_ranges.push(0,0,0);this.paths_ranges[this.paths_ranges.length-2]++;null!==this.paths&&this.paths[this.paths.length-1].lineTo(a[0],a[1]);this.invalidate_pos(!1)}get_last_vertex(){return ij.prototype.get_last_vertex.call(this)}describe(a,
b){b.recreate_if_needed(this)&&(b.eobj.vtxnum=b.add_line("Vertex Count: ").value_elem,b.eobj.facenum=b.add_line("Face Count: ").value_elem,b.eobj.has_curve=b.add_line("Has Curves: ").value_elem,b.eobj.props=b.add_line("Properties:",!0).value_elem,b.eobj.props.classList.add("obj_inf_prop_list"),b.adjust_labels());b.eobj.vtxnum.innerText=this.arrs.vtx_pos.length/2;b.eobj.facenum.innerText=this.face_count();b.eobj.has_curve.innerText=this.has_curves()?"true":"false";b.eobj.props.innerText=Object.keys(this.arrs).join("\n")}}
class Nm{constructor(a,b,l,e){this.ctx=a;this.da_num_elems=e;null!==b&&Id(b.length===l*e,"Wrong element width, expected "+e+" got "+b.length/l);this.prop_arr=b;this.start_idx=this.vidx=null;this.began=!1;this.first=null;this.prev={x:null,y:null};this.cur={x:null,y:null};for(a=0;a<e;++a)this.prev[a]=null,this.cur[a]=null}next_col(a,b,l){const e=this.vidx;for(let f=0;f<this.da_num_elems;++f)a[f]=this.prop_arr[e+f];a.x=b;a.y=l;this.vidx+=this.da_num_elems}moveTo(a,b,l){this.vidx=l*this.da_num_elems;
this.start_idx=l;this.next_col(this.prev,a,b);this.first={...this.prev};this.began||this.ctx.beginPath();this.ctx.moveTo(a,b);this.ctx.lineCap="round";this.ctx.lineJoin="round"}v_different(a,b){for(let l=0;l<this.da_num_elems;++l)if(a[l]!==b[l])return!0;return!1}check_changed_value(a,b){this.next_col(this.cur,a,b);b=this.prev;if(a=this.v_different(this.cur,b))this.donePath(),this.ctx.beginPath(),this.ctx.moveTo(b.x,b.y);b=this.prev;this.prev=this.cur;this.cur=b;return a}check_changed_with_first(){const a=
this.prev;this.v_different(this.first,a)&&(this.donePath(),this.ctx.beginPath(),this.ctx.moveTo(a.x,a.y));this.prev=this.first}lineTo(a,b){this.check_changed_value(a,b);this.ctx.lineTo(a,b)}bezierCurveTo(a,b,l,e,f,h,g){this.start_idx===g?this.check_changed_with_first():this.check_changed_value(f,h);this.ctx.bezierCurveTo(a,b,l,e,f,h)}closePath(a){a&&(this.check_changed_with_first(),this.ctx.lineTo(this.first.x,this.first.y),this.donePath())}donePath(){this.set_ctx_prop(this.prev);this.ctx.stroke()}}
class Km extends Nm{constructor(a,b,l){super(a,b,l,4)}set_ctx_prop(a){this.ctx.strokeStyle=Mm(a)}}class Lm extends Nm{constructor(a,b,l,e){super(a,b,e,1);this.base_width=l}set_ctx_prop(a){this.ctx.lineWidth=a[0]*this.base_width}}
class Jm extends Nm{constructor(a,b,l,e,f){super(a,null,f,5);this.base_width=e;this.col_arr=b;this.width_arr=l}next_col(a,b,l){const e=this.vidx/5,f=4*e;for(let h=0;4>h;++h)a[h]=this.col_arr[f+h];a[4]=this.width_arr[e];a.x=b;a.y=l;this.vidx+=this.da_num_elems}set_ctx_prop(a){this.ctx.strokeStyle=Mm(a);this.ctx.lineWidth=a[4]*this.base_width}}
class ak extends wg{constructor(a){super(a,"path_ranges");this.lst=[]}save(){return{ranges:this.lst}}load(a){this.lst=a.ranges}add_default(){if(0==this.lst.length)this.lst.push(0,1,0);else{let a=this.lst[this.lst.length-2];1==(this.lst[this.lst.length-1]&1)?this.lst.push(a,a+1,0):++this.lst[this.lst.length-2]}this.pset_dirty()}close_current(a){if(1==(this.lst[this.lst.length-1]&1)||this.lst[this.lst.length-3]!==a)return!1;this.lst[this.lst.length-1]|=1;this.pset_dirty();return!0}remove(a){var b=[];
let l=[];for(let f=0;f<this.lst.length;f+=3){var e=this.lst[f];let h=this.lst[f+1],g={flags:this.lst[f+2],count:h-e};for(l.push(g);e<h;++e)b.push(g)}for(let f of a)--b[f].count,console.assert(0<=b[f].count),delete b[f];l=$h(l);a=[];b=0;for(let f of l)0<f.count&&(a.push(b,b+f.count,f.flags),b+=f.count);this.lst=a}get_prev_point_in_path(a){for(let b=0;b<this.lst.length;b+=3){const l=this.lst[b],e=this.lst[b+1];if(a>=l&&a<e)return a>l?a-1:e-1}return null}add_elems(){}}
class Om extends ye{static name(){return"Round Corners"}constructor(a){super(a);this.in_obj=new Rd(a,"in_obj");this.out_paths=new Td(a,"out_paths");this.alg=new Ti(a,"Algorithm",0,["Chaikin","Continuous","Catmull-Rom","Geometric","Simplify"],b=>{this.factor.set_visible(2==b||3==b||4==b)});this.factor=new Gh(a,"Factor",.5,[0,1])}run_paper_alg(){var a=this.in_obj.get_const();Sd(null!==a,this,"No input");const b=a.ensure_paper();a.paper_obj=null;switch(this.alg.sel_idx){case 1:b.smooth({type:"continuous"});
break;case 2:b.smooth({type:"catmull-rom",factor:this.factor.v});break;case 3:b.smooth({type:"geometric",factor:this.factor.v});break;case 4:Sd(b.simplify(this.factor.v),this,"Failed simplify")}a=new Uj;a.from_paper(b);this.out_paths.set(a)}run(){let a=this.in_obj.get_const();Sd(null!==a,this,"No input");if(0!==this.alg.sel_idx)this.run_paper_alg();else{var b=a.effective_vtx_pos,l=[],e=[],f=[],h=[],g=(q,r,B)=>{var D=r(q-1);let F=b[D];D=b[D+1];let G=0,N=0,T=l.length;for(let E=0;E<q;++E){var V=r(E);
let Q=b[V];V=b[V+1];let aa=(Q+F)/2,qa=(V+D)/2;l.push(aa,qa);f.push(F-aa,D-qa);h.push(F-G,D-N);F=Q;D=V;G=aa;N=qa}r(0);B?(h[T]=F-G,h[T+1]=D-N):(h[T]=0,h[T+1]=0);e.push(T/2,l.length/2,B?1:0)};if(a.constructor===Uj)for(var m=0;m<a.paths_ranges.length;m+=3){let q=a.paths_ranges[m];g(a.paths_ranges[m+1]-q,r=>2*(q+r),1==(a.paths_ranges[m+2]&1))}else if(a.constructor===ij){m=a.face_size();let q=a.arrs.idx;Sd(null!==q,this,"Mesh is empty");for(let r=0;r<q.length;r+=m)g(m,B=>2*q[r+B],!0)}else Sd(!1,this,"input is not Mesh or Paths");
g=new Uj;g.set("vtx_pos",new di(l),2,!1);g.set("ctrl_to_prev",new di(f),2,!1);g.set("ctrl_from_prev",new di(h),2,!1);g.paths_ranges=e;this.out_paths.set(g);for(let q in a.arrs)q.startsWith("face_")&&"vtx_transform"!=q&&(m=a.arrs[q],m=new m.constructor(m),g.set(q,m,a.meta[q].need_normalize));g.fill_objs=gj(a.fill_objs)}}}
class Pm extends ye{static name(){return"Boolean Operation"}constructor(a){super(a);this.in_obj1=new Xd(a,"in_obj_subject");this.in_obj1.width=17;this.in_obj2=new Xd(a,"in_obj_clip");this.in_obj2.width=17;this.out_paths=new Td(a,"out_paths");this.op=new Ti(a,"Operation",0,[["Union",ClipperLib.ClipType.ctUnion],["Intersection",ClipperLib.ClipType.ctIntersection],["Subtract",ClipperLib.ClipType.ctDifference],["Xor",ClipperLib.ClipType.ctXor]],b=>{this.swap.set_visible(2===b)});this.swap=new qh(a,"Swap",
!1)}run(){var a=this.in_obj1.get_input_consts();let b=this.in_obj2.get_input_consts();if(this.swap.v&&2==this.op.sel_idx){var l=a;a=b;b=l}0!==this.op.sel_idx?(Sd(0<a.length,this,"Missing input subject"),Sd(0<b.length,this,"Missing input clip")):Sd(0<a.length+b.length,this,"Missing input");ClipperLib.use_xyz=!1;const e=new ClipperLib.Clipper;l=null;try{let f=!1;for(let g of a){const m=g.ensure_clipper();for(let q of m)f|=!q.closed,Sd(e.AddPath(q,ClipperLib.PolyType.ptSubject,q.closed),this,"failed AddPath")}for(let g of b){const m=
g.ensure_clipper();for(let q of m)Sd(q.closed,this,"Clip obj should not be open"),Sd(e.AddPath(q,ClipperLib.PolyType.ptClip,!0),this,"failed AddPath")}l=f?new ClipperLib.PolyTree:new ClipperLib.Paths;const h=e.Execute(this.op.get_sel_val(),l,ClipperLib.PolyFillType.pftNonZero,ClipperLib.PolyFillType.pftNonZero);Sd(h,this,"Clipper failed")}catch(f){Sd(!1,this,f.message)}a=new Uj;a.from_clipper_paths(l);this.out_paths.set(a)}}function Mm(a){return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]/255+")"}
function Qm(a,b,l){return[a[0]*(1-l)+b[0]*l,a[1]*(1-l)+b[1]*l]}function Rm(a,b,l){return[a[0]*(1-l)+b[0]*l,a[1]*(1-l)+b[1]*l,a[2]*(1-l)+b[2]*l,a[3]*(1-l)+b[3]*l]}
class sm extends yd{static name(){return"Gradient"}constructor(a,b,l,e,f){super();this.p1=Ff.fromValues(a,b);this.p2=Ff.fromValues(l,e);this.tex_smooth=f;this.stops=[];this.ctx_create_func=this.grd=null;this.t_mat=Qh.create();this.spread="pad";this.via_svg=!1;this.svg_of_rect=this.svg=null;this.sample_tex=!1;this.offset=0}add_stop(a,b){this.stops.push({value:a,color:b});this.obj=null}get_disp_params(a){return[new vh(a,"Show Fill","show_fill",!0)]}set_spread(a,b){this.spread=a;this.via_svg=b}set_offset(a){this.offset=
a}need_svg(){return this.via_svg}add_stops(a){for(let b of this.stops)Id(0<=b.value&&1>=b.value,"stop out of range"),a.addColorStop(b.value,Mm(b.color))}ensure_grd(){if(null===this.grd){let a=this.ctx_create_func.call();this.add_stops(a);this.grd=a}}make_rect_points(a,b,l){var e=Qh.create();Qh.invert(e,this.t_mat);a=[a,b,Ff.fromValues(b[0],a[1]),Ff.fromValues(a[0],b[1])];for(b=0;4>b;++b)l&&Ff.transformMat3(a[b],a[b],rf.t_inv_viewport),this.need_svg()||Ff.transformMat3(a[b],a[b],e);l={x:a[0][0],y:a[0][1],
w:a[1][0]-a[0][0],h:a[1][1]-a[0][1],pnts:a};this.need_svg()&&(e=Math.ceil(l.w),a=Math.ceil(l.h),l={x:l.x-(e-l.w),y:l.y-(a-l.h),w:e,h:a});return l}make_viewport_rect_points(){return this.make_rect_points(Ff.fromValues(0,0),Ff.fromValues(sf.width,sf.height),!0)}async pre_draw_rect(a){this.need_svg()&&this.need_ensure_svg(a)&&await this.ensure_svg(a)}draw_fill_rect(a,b){this.ensure_grd();this.need_svg()?(Id(null!==this.svg,"Missing svg"),a.drawImage(this.svg,b.x,b.y)):(a.save(),rd(a,this.t_mat),b=b.pnts,
a.fillStyle=this.grd,a.beginPath(),a.moveTo(b[0][0],b[0][1]),a.lineTo(b[2][0],b[2][1]),a.lineTo(b[1][0],b[1][1]),a.lineTo(b[3][0],b[3][1]),a.fill(),a.restore())}draw_fill(){const a=this.make_viewport_rect_points();this.draw_fill_rect(zd,a)}transform(a){Qh.multiply(this.t_mat,a,this.t_mat)}set_transform(a){Qh.copy(this.t_mat,a)}get_transform(){return this.t_mat}draw_line_points(a,b,l="#000"){let e=Ff.create(),f=Ff.create();Ff.transformMat3(e,a,this.t_mat);Ff.transformMat3(f,b,this.t_mat);a=aj.vtx_radius/
rf.viewport_zoom;let h=b=!1;zd.beginPath();zd.moveTo(e[0],e[1]);zd.lineTo(f[0],f[1]);zd.lineWidth=aj.line_width/rf.viewport_zoom;zd.strokeStyle=l;zd.stroke();for(let g of this.stops){let [m,q]=Qm(e,f,g.value);1==g.value?b=!0:0==g.value&&(h=!0);zd.beginPath();zd.arc(m,q,a,0,2*Math.PI);zd.fillStyle=Mm(g.color);zd.fill();zd.stroke()}b||(zd.beginPath(),zd.arc(f[0],f[1],a,0,2*Math.PI),zd.stroke());h||(zd.beginPath(),zd.arc(e[0],e[1],a,0,2*Math.PI),zd.stroke())}draw_sel_points(a,b,l){const e=aj.vtx_sel_radius/
rf.viewport_zoom;zd.beginPath();for(let f of a){switch(f){case 0:a=this.p1;break;case 1:a=this.p2;break;case 2:a=b;break;case 3:a=l;break;default:a=Qm(b,l,this.stops[f-4].value)}zd.moveTo(a[0]+e,a[1]);zd.arc(a[0],a[1],e,0,2*Math.PI)}zd.lineWidth=2/rf.viewport_zoom;zd.strokeStyle=aj.sel_color;zd.stroke()}async get_pixels_adapter(a,b){a=new Sm(a,this,b);await a.make_pixels(!b);return a}async pre_draw(a,b){this.need_svg()&&b.show_fill&&(a=this.make_viewport_rect_points(),this.need_ensure_svg(a)&&await this.ensure_svg(a))}draw_m(a,
b){b.show_fill&&this.draw_fill()}make_svg_text(a){let [b,l]=this.svg_text_geom();var e=this.t_mat;let f=['<svg viewBox="',a.x," ",a.y," ",a.w," ",a.h,'" xmlns="http://www.w3.org/2000/svg" width="',a.w,'" height="',a.h,'"><',b,' id="grad" gradientUnits="userSpaceOnUse" spreadMethod="',this.spread,'" gradientTransform="matrix(',e[0]," ",e[1]," ",e[3]," ",e[4]," ",e[6]," ",e[7],')" '];f=f.concat(l);f.push(" >");e=this.stops;if(0!=this.offset)if("repeat"==this.spread){var h=this.offset%1;0>h&&(h+=1);
e=[];for(var g in this.stops){var m=this.stops[g];let q=m.value+h;1<q&&--q;g==this.stops.length-1&&(q-=1E-6);e.push({color:m.color,value:q,orig_value:m.value})}e.sort((q,r)=>q.value-r.value);g=e[e.length-1];m=e[0];h=Rm(g.color,m.color,(1-h-g.orig_value)/(m.orig_value-g.orig_value));e.push({value:1,color:h});e.unshift({value:0,color:h})}else if("reflect"==this.spread){e=[];g=this.offset%2;for(h in this.stops)m=this.stops[h],e.push({color:m.color,value:m.value+g,orig_value:m.value}),e.push({color:m.color,
value:m.value-2+g,orig_value:m.value}),e.push({color:m.color,value:m.value+2+g,orig_value:m.value}),e.push({color:m.color,value:-m.value+g,orig_value:m.value}),e.push({color:m.color,value:-m.value+2+g,orig_value:m.value});e.sort((q,r)=>q.value-r.value)}h=(q,r)=>{f.push('<stop offset="',r,'" stop-color="rgb(',q[0],",",q[1],",",q[2],')" stop-opacity="',q[3]/255,'" />')};for(let q of e)h(q.color,q.value);f.push("</",b,'><rect x="',a.x,'" y="',a.y,'" width="',a.w,'" height="',a.h,'" fill="url(\'#grad\')" /></svg>');
return f.join("")}need_ensure_svg(a){var b;if(b=null!==this.svg&&null!==this.svg_of_rect)b=this.svg_of_rect,b=a.x===b.x&&a.y===b.y&&a.w===b.w&&a.h===b.h;return b?!1:!0}async ensure_svg(a){const b=this.make_svg_text(a);let l=new Image;const e=new Promise((f,h)=>{l.onload=()=>{f(l)};l.onerror=()=>{h({message:"SVG error"})}});l.decoding="sync";l.src="data:image/svg+xml;base64,"+btoa(b);this.svg=l.complete?l:await e;this.svg_of_rect=a;return this.svg}async make_img_gl_texture(a){await this.get_pixels_adapter(a,
!0);a=Kk(a.width(),a.height(),Gf,this.tex_smooth,"pad","pad");a.t_mat=Qh.create();Qh.copy(a.t_mat,this.t_mat);return a}}
class Sm{constructor(a,b,l){this.pixels=null;this.obj=b;b.sample_tex?(this.bbox=new ej(Tm[0].x,Tm[0].y,Tm[1].x,.2),this.w_width=this.bbox.width(),this.w_height=this.bbox.height(),this.px_width=b.tex_res,this.px_height=10,this.dest_tmat=null,this.draw_scale=[this.px_width/this.w_width,this.px_height/this.w_height]):(Id(null!==a&&void 0!==a.get_bbox,"Expected object with bounding box"),this.bbox=a.get_bbox(),this.w_width=this.bbox.width(),this.w_height=this.bbox.height(),l?(this.px_width=a.width(),
this.px_height=a.height(),this.obj_sz_x=a.sz_x,this.obj_sz_y=a.sz_y,this.draw_scale=[this.px_width/this.obj_sz_x,this.px_height/this.obj_sz_y],this.dest_tmat=a.t_mat):(this.px_width=Math.round(this.w_width*rf.viewport_zoom),this.px_height=Math.round(this.w_height*rf.viewport_zoom),this.draw_scale=[rf.viewport_zoom,rf.viewport_zoom],this.obj_sz_y=this.obj_sz_x=this.dest_tmat=null))}width(){return this.px_width}height(){return this.px_height}get_spread(){return this.obj.spread}async make_pixels(a){if(null===
this.pixels){this.obj.ensure_grd();Gf.width=this.px_width;Gf.height=this.px_height;Bd.save();var b=Qh.create();Qh.scale(b,b,this.draw_scale);sd(Bd,b);null===this.dest_tmat?Bd.translate(-this.bbox.min_x,-this.bbox.min_y):(Bd.translate(.5*this.obj_sz_x,.5*this.obj_sz_y),b=Qh.create(),Qh.invert(b,this.dest_tmat),rd(Bd,b));b=this.obj.make_rect_points(Ff.fromValues(this.bbox.min_x,this.bbox.min_y),Ff.fromValues(this.bbox.max_x,this.bbox.max_y),!1);await this.obj.pre_draw_rect(b);this.obj.draw_fill_rect(Bd,
b);Bd.restore();this.pixels=a?Bd.getImageData(0,0,this.px_width,this.px_height).data:null}}get_pixels(){return this.pixels}get_transform_to_pixels(){let a=Qh.create();Qh.scale(a,a,Ff.fromValues(this.width()-1,this.height()-1));Qh.scale(a,a,Ff.fromValues(1/this.bbox.width(),1/this.bbox.height()));Qh.translate(a,a,Ff.fromValues(-this.bbox.min_x,-this.bbox.min_y));return a}}
class Um extends sm{static name(){return"Linear Gradient"}constructor(a,b,l,e,f,h,g){g&&(a=Tm[0].x,b=Tm[0].y,l=Tm[1].x,e=Tm[1].y);super(a,b,l,e,h);this.tex_res=f;this.ctx_create_func=function(){return zd.createLinearGradient(a,b,l,e)};this.tex_obj_cache=null;this.sample_tex=g}destructor(){null!==this.tex_obj_cache&&this.del_texture_cache()}transform(a){this.sample_tex||super.transform(a)}set_transform(a){this.sample_tex||super.set_transform(a)}draw_selection_m(a,b){this.draw_line_points(this.p1,this.p2);
this.draw_sel_points(b,this.p1,this.p2)}draw_template_m(){this.draw_line_points(this.p1,this.p2,"#de77f1")}svg_text_geom(){return["linearGradient",['x1="',this.p1[0],'" y1="',this.p1[1],'" x2="',this.p2[0],'" y2="',this.p2[1],'"']]}del_texture_cache(){th.deleteTexture(this.tex_obj_cache);this.tex_with_params=this.tex_obj_cache=null}make_sample_gl_texture(){if(null!==this.tex_obj_cache)return this.tex_obj_cache;Gf.width=this.tex_res;Gf.height=10;var a=Bd.createLinearGradient(0,0,this.tex_res,0);this.add_stops(a);
Bd.fillStyle=a;Bd.beginPath();Bd.moveTo(0,0);Bd.lineTo(this.tex_res,0);Bd.lineTo(this.tex_res,10);Bd.lineTo(0,10);Bd.fill();a=Kk(this.tex_res,10,Gf,this.tex_smooth,this.spread,"pad");a.t_mat=Qh.create();return this.tex_obj_cache=a}async make_gl_texture(a){return this.sample_tex?this.make_sample_gl_texture():await this.make_img_gl_texture(a)}}
function Vm(a,b,l,e){let f=Ff.fromValues(l[0]-a[0],l[1]-a[1]);0==f[0]&&0==f[1]&&(f=Ff.fromValues(1,0));Ff.normalize(f,f);a=Ff.fromValues(a[0],a[1]);Ff.scaleAndAdd(a,a,f,-b);b=Ff.fromValues(l[0],l[1]);Ff.scaleAndAdd(b,b,f,-e);return[a,b]}function Wm(a,b){zd.moveTo(a[0]+b,a[1]);zd.arc(a[0],a[1],b,0,2*Math.PI)}
class Xm extends sm{static name(){return"Radial Gradient"}constructor(a,b,l,e,f,h,g){super(a,b,e,f,g);Id(0<l&&0<h,"radius radius needs to be positive");this.r1=l;this.r2=h;this.ctx_create_func=()=>zd.createRadialGradient(a,b,l,e,f,h)}draw_circles(a,b,l="#000"){var e=this.p1;const f=this.p2,h=this.r1,g=this.r2;zd.save();rd(zd,this.t_mat);zd.beginPath();Wm(e,h);Wm(f,g);zd.restore();e=aj.vtx_radius/rf.viewport_zoom;Wm(a,e);Wm(b,e);zd.lineWidth=aj.line_width/rf.viewport_zoom;zd.strokeStyle=l;zd.stroke();
zd.beginPath();zd.strokeStyle="#ffffff";Wm(a,.7*e);Wm(b,.7*e);zd.stroke();zd.strokeStyle="#000"}draw_controls(a="#000"){const b=Ff.create(),l=Ff.create();Ff.transformMat3(b,this.p1,this.t_mat);Ff.transformMat3(l,this.p2,this.t_mat);this.draw_circles(b,l,a);const [e,f]=Vm(this.p1,this.r1,this.p2,this.r2);this.draw_line_points(e,f,a)}draw_selection_m(a,b){this.draw_controls();const [l,e]=Vm(this.p1,this.r1,this.p2,this.r2);this.draw_sel_points(b,l,e)}draw_template_m(){this.draw_controls("#de77f1")}svg_text_geom(){return["radialGradient",
['cx="',this.p2[0],'" cy="',this.p2[1],'" r="',this.r2,'" fx="',this.p1[0],'" fy="',this.p1[1],'" fr="',this.r1,'"']]}async make_gl_texture(a){return await this.make_img_gl_texture(a)}}
class Ym extends sm{static name(){return"Conic Gradient"}constructor(a,b,l){super(a,b,a,b,l);this.ctx_create_func=()=>zd.createConicGradient(2*this.offset*Math.PI,a,b)}need_svg(){return!1}draw_controls(a="#000"){const b=Ff.create();Ff.transformMat3(b,this.p1,this.t_mat);const l=aj.vtx_radius/rf.viewport_zoom;zd.beginPath();Wm(b,l);Wm(b,100/rf.viewport_zoom);zd.lineWidth=aj.line_width/rf.viewport_zoom;zd.strokeStyle=a;zd.stroke()}draw_stops_points(){const a=Ff.create();Ff.transformMat3(a,this.p1,this.t_mat);
const b=aj.vtx_radius/rf.viewport_zoom,l=100/rf.viewport_zoom;for(let f=this.stops.length-1;0<=f;--f){const h=this.stops[f];var e=2*(h.value+this.offset)*Math.PI;const g=a[0]+Math.cos(e)*l;e=a[1]+Math.sin(e)*l;zd.beginPath();zd.arc(g,e,b,0,2*Math.PI);zd.fillStyle=Mm(h.color);zd.fill();zd.stroke()}}draw_sel_points(a){const b=aj.vtx_sel_radius/rf.viewport_zoom,l=100/rf.viewport_zoom;zd.beginPath();for(let e of a){if(0==e)a=this.p1;else if(4>e)continue;else a=2*(this.stops[e-4].value+this.offset)*Math.PI,
a=[this.p1[0]+Math.cos(a)*l,this.p1[1]+Math.sin(a)*l];zd.moveTo(a[0]+b,a[1]);zd.arc(a[0],a[1],b,0,2*Math.PI)}zd.lineWidth=2/rf.viewport_zoom;zd.strokeStyle=aj.sel_color;zd.stroke()}draw_selection_m(a,b){this.draw_controls();this.draw_stops_points();this.draw_sel_points(b)}draw_template_m(){this.draw_controls("#de77f1")}}
class Zm{constructor(a,b,l,e){this.p1=a;this.p2=b;this.move_prm=[a,b,null,null];this.range_lstprm=l;this.nodecls=e}count(){return this.move_prm.length+this.range_lstprm.count()}get_value(a){Id(void 0!==a,"unexpected vidx undefined");a/=2;if(a<this.move_prm.length)return null===this.move_prm[a]?[null,null]:this.move_prm[a].get_value();const [b,l]=this.get_pa_pb();a=this.range_lstprm.get_value(a-this.move_prm.length);return[b.x*(1-a)+l.x*a,b.y*(1-a)+l.y*a]}increment(a,b){if(a<this.move_prm.length)this.move_prm[a].increment(b);
else{const [l,e]=this.get_pa_pb(),f=Ff.fromValues(e.x-l.x,e.y-l.y);b=Ff.dot(b,f)/Ff.dot(f,f);a-=this.move_prm.length;b=Math.min(1,Math.max(0,this.range_lstprm.get_value(a)+b));this.increment_color_point(a,b)}}increment_color_point(a,b){this.range_lstprm.modify(a,b);this.nodecls.redo_sort()}project_to_stops_line(a){const [b,l]=this.get_pa_pb();let e=Ff.fromValues(l.x-b.x,l.y-b.y);var f=Ff.fromValues(a[0]-b.x,a[1]-b.y);f=Ff.dot(f,e)/Ff.dot(e,e);f=Math.min(1,Math.max(0,f));let h=Ff.fromValues(b.x,b.y);
h[0]+=f*e[0];h[1]+=f*e[1];Ff.sub(h,h,a);return[Ff.len(h),f]}reprint_all_lines(){this.range_lstprm.reprint_all_lines()}translate_idx_to_obj(a){const b=[];for(var l in this.nodecls.sorted_order)b[this.nodecls.sorted_order[l]]=parseInt(l);l=[];for(let e of a)e<this.move_prm.length?l.push(e):l.push(b[e-this.move_prm.length]+this.move_prm.length);return l}}class $m extends Zm{constructor(a,b,l,e){super(a,b,l,e)}get_pa_pb(){return[this.p1,this.p2]}}
function an(a,b,l){a=Ff.fromValues(a.x-b.x,a.y-b.y);b=Ff.fromValues(l[0]-b.x,l[1]-b.y);return 0>Ff.dot(a,b)}
class bn extends Zm{constructor(a,b,l,e,f,h){super(a,l,f,h);this.r1=b;this.r2=e}get_pa_pb(){var a=this.p1,b=this.r1.v,l=this.p2,e=this.r2.v;a=Vm(Ff.fromValues(a.x,a.y),b,Ff.fromValues(l.x,l.y),e);return[{x:a[0][0],y:a[0][1]},{x:a[1][0],y:a[1][1]}]}get_value(a){Id(void 0!==a,"unexpected vidx undefined");let b=a/2;return 2==b?([a]=this.get_pa_pb(),[a.x,a.y]):3==b?([,a]=this.get_pa_pb(),[a.x,a.y]):super.get_value(a)}increment(a,b){2==a?([a]=this.get_pa_pb(),b=Ff.fromValues(a.x+b[0],a.y+b[1]),a=Ff.distance(b,
Ff.fromValues(this.p1.x,this.p1.y)),this.r1.modify(a),[a]=this.get_pa_pb(),an(a,this.p1,b)&&this.r1.modify(0)):3==a?([,a]=this.get_pa_pb(),b=Ff.fromValues(a.x+b[0],a.y+b[1]),a=Ff.distance(b,Ff.fromValues(this.p2.x,this.p2.y)),this.r2.modify(a),[,a]=this.get_pa_pb(),an(a,this.p2,b)&&this.r2.modify(0)):super.increment(a,b)}}
class cn extends Zm{constructor(a,b,l){super(a,null,b,l)}get_value(a){Id(void 0!==a,"unexpected vidx undefined");var b=a/2;if(b<this.move_prm.length)return super.get_value(a);b=this.range_lstprm.get_value(b-this.move_prm.length);a=100/rf.viewport_zoom;b=2*(b+this.nodecls.stops_offset.v)*Math.PI;return[this.p1.x+Math.cos(b)*a,this.p1.y+Math.sin(b)*a]}increment(a,b){if(a<this.move_prm.length)super.increment(a,b);else{var l=100/rf.viewport_zoom;a-=this.move_prm.length;var e=this.range_lstprm.get_value(a),
f=2*(e+this.nodecls.stops_offset.v)*Math.PI;l=Ff.fromValues(Math.cos(f)*l,Math.sin(f)*l);f=Ff.create();Ff.add(f,l,b);Ff.normalize(f,f);Ff.normalize(l,l);b=Math.atan2(f[1],f[0])-Math.atan2(l[1],l[0]);b>Math.PI&&(b-=2*Math.PI);b<-Math.PI&&(b+=2*Math.PI);b=e+b/(2*Math.PI);1<b&&--b;0>b&&(b+=1);this.increment_color_point(a,b)}}project_to_stops_line(a){a=Ff.clone(a);a[0]-=this.p1.x;a[1]-=this.p1.y;var b=Math.atan2(a[1],a[0]);0>b&&(b+=2*Math.PI);b=b/(2*Math.PI)-this.nodecls.stops_offset.v;const l=100/rf.viewport_zoom;
return[Ff.length(a)-l,b]}}
const dn=[[{v:0,c:"#f00"},{v:.5,c:"#ff0"},{v:1,c:"#0f0"}],[{v:0,c:"#000"},{v:.25,c:"#800000"},{v:.5,c:"#ff8000"},{v:.75,c:"#ffff80"},{v:1,c:"#fff"}],[{v:0,c:"hsl(0,100%,50%)"},{v:.2,c:"hsl(60,100%,50%)"},{v:.4,c:"hsl(120,100%,50%)"},{v:.6,c:"hsl(180,100%,50%)"},{v:.8,c:"hsl(240,100%,50%)"},{v:1,c:"hsl(300,100%,50%)"}],[{v:0,c:"#6727E0"},{v:.35,c:"#D418CC"},{v:.63,c:"#FB63B1"},{v:1,c:"#F8F45F"}],[{v:0,c:"#000"},{v:1,c:"#fff"}],[{v:0,c:"#000"},{v:1,c:"rgba(0,0,0,0)"}],[{v:0,c:"#C2EAF4"},{v:.174,c:"#8C6DE2"},
{v:.32,c:"#E21BD8"},{v:.57,c:"#D2CA4A"},{v:.68,c:"#F3F94D"},{v:1,c:"#14EDE2"}],[{v:0,c:"#0EE0F4"},{v:.31,c:"#4FE2BB"},{v:.59,c:"#A4E57E"},{v:1,c:"#FEE835"}],[{v:0,c:"#72B743"},{v:.3,c:"#9DD224"},{v:.57,c:"#D9F98D"},{v:.662,c:"#E2FFA1"},{v:1,c:"#FED242"}],[{v:0,c:"#E74079"},{v:.33,c:"#FEC0A0"},{v:.66,c:"#FFE45B"},{v:1,c:"#ED9B20"}],[{v:0,c:"#1CFECF"},{v:.39,c:"#536FDE"},{v:1,c:"#FE73E6"}],[{v:0,c:"#E8FF85"},{v:.212,c:"#CAFAD6"},{v:.5,c:"#C6EEF9"},{v:.761,c:"#DBCBFA"},{v:1,c:"#F89ADD"}],[{v:0,c:"#FF21AB"},
{v:.313,c:"#EB1F6F"},{v:.4,c:"#EA2869"},{v:.711,c:"#FF7C73"},{v:1,c:"#FF9C36"}],[{v:0,c:"#582A20"},{v:.056,c:"#E9D7D1"},{v:.308,c:"#B64D49"},{v:.417,c:"#82322F"},{v:.438,c:"#9C6563"},{v:.46,c:"#D2B9B8"},{v:.479,c:"#FEFEFE"},{v:.742,c:"#95B4CB"},{v:.871,c:"#7690B9"},{v:.919,c:"#83A7C3"},{v:1,c:"#D9E8F3"}],[{v:0,c:"#A703AA"},{v:.13,c:"#E91A5F"},{v:.278,c:"#EF4716"},{v:.48,c:"#FFFD00"},{v:.648,c:"#209046"},{v:.791,c:"#081BF9"},{v:1,c:"#A203AD"}],[{v:0,c:"#3366FE"},{v:.23,c:"#05A298"},{v:.363,c:"#74CF4E"},
{v:.498,c:"#FFFE00"},{v:.735,c:"#FF6F30"},{v:1,c:"#FF3497"}],[{v:0,c:"#00f"},{v:.5,c:"#000"},{v:1,c:"#f00"}]];function mm(a,b,l,e){void 0===e&&(e=Dc.CHECKERS);const f=e.light,h=e.dark;e=e.width;a.fillStyle="rgb("+f+","+f+","+f+")";a.fillRect(0,0,b,l);a.fillStyle="rgb("+h+","+h+","+h+")";for(let g=0,m=0;g<b;g+=e,++m)for(let q=0,r=0;q<l;q+=e,++r)m%2!=r%2&&a.fillRect(g,q,e,e)}
function en(a,b){if(void 0===a.img){Xk();lm.width=45;lm.height=45;mm(nm,45,45);var l=nm.createLinearGradient(0,0,45,45);for(var e of a)l.addColorStop(e.v,e.c);nm.fillStyle=l;nm.fillRect(0,0,45,45);l=lm.toDataURL();e=new Image;e.src=l;a.img=e}b.appendChild(a.img)}function fn(a){return[hh(0,Math.round(a[0]),255),hh(0,Math.round(a[1]),255),hh(0,Math.round(a[2]),255),4==a.length?hh(0,Math.round(a[3]),255):255]}class gn{constructor(a,b){this.x=a;this.y=b}get_value(){return[null,null]}increment(){}}
const Tm=[new gn(0,0),new gn(1,0)];
class hn extends ye{static name(){return"Gradient"}constructor(a){super(a);this.sorted_order=[];this.selected_indices=[];this.points_adapter=null;a.set_state_evaluators({t:(e,f)=>new bk(e,f)});this.out=new Td(a,"out_gradient");this.type=new Ti(a,"Type",0,["Linear","Radial","Sample","Conic"],e=>{this.r1.set_visible(1==e);this.r2.set_visible(1==e);this.p1.set_visible(0==e||1==e||3==e);this.p2.set_visible(0==e||1==e);this.spread.set_visible(3!=e);l();this.tex_resolution.set_visible(2==e);0==e?this.points_adapter=
new $m(this.p1,this.p2,this.values,this):2==e?this.points_adapter=new $m(Tm[0],Tm[1],this.values,this):1==e?this.points_adapter=new bn(this.p1,this.r1,this.p2,this.r2,this.values,this):3==e&&(this.points_adapter=new cn(this.p1,this.values,this));this.selected_indices.includes_shifted=function(f){return this.includes(f+4)};Wj(this,this.selected_indices,this.points_adapter)});this.method=new Ti(a,"Method",0,["Stops","Function"],e=>{this.table.set_visible(0==e);0==e&&this.table.remake_table();this.add_stops_btn.set_visible(0==
e);this.func.set_visible(1==e);this.func_samples.set_visible(1==e)});this.method.share_line_elem_from(this.type);this.p1=new Jh(a,"Point 1",-.5,0);this.r1=new Gh(a,"Radius 1",.1);this.p2=new Jh(a,"Point 2",.5,0);this.r2=new Gh(a,"Radius 2",.7);this.spread=new Ti(a,"Spread",0,[["Pad",["pad",!1]],["Pad (svg)",["pad",!0]],["Reflect",["reflect",!0]],["Repeat",["repeat",!0]]],()=>{l()});this.func=new Nh(a,"f(t)=",["#cccccc","rgb(255, 128, 0.0) + rgb(t, t, t)*255"],{show_code:!0});this.func_samples=new Hh(a,
"Sample Num",10,{min:1,max:30,visible:!1});const b=new Zi(a,"Presets",dn,en,e=>{this.load_preset(e)});this.add_stops_btn=new qh(a,"Add stops",!0,()=>{this.print_stops()},{allow_expr:!1,as_btn:!0});this.add_stops_btn.share_line_elem_from(b);this.table=new Oi(a,"Stops",this.sorted_order);this.values=new ParamFloatList(a,"Value",this.table,this.selected_indices,()=>{this.redo_sort()});this.colors=new ParamColorList(a,"Color",this.table);this.tex_resolution=new Hh(a,"Tex Resolution",128,[8,128]);this.tex_smooth=
new qh(a,"Tex Smooth",!1);this.stops_offset=new Gh(a,"Offset(t)","0");const l=()=>{this.stops_offset.set_visible(2==this.spread.sel_idx||3==this.spread.sel_idx||3==this.type.sel_idx)};this.load_preset(dn[0])}print_stops(){let a="";for(let l=0;l<this.sorted_order.length;++l){var b=4*this.sorted_order[l];b=Dc.make_hex({r:this.colors.lst[b],g:this.colors.lst[b+1],b:this.colors.lst[b+2],alpha:this.colors.lst[b+3]/255});a+="{v:"+this.values.lst[this.sorted_order[l]].toFixed(3)+', c:"'+b+'"}, '}console.log(a)}is_radial(){return 1==
this.type.sel_idx}post_load_hook(){this.redo_sort()}redo_sort(a){let b=[];for(var l=0;l<this.values.lst.length;++l)b.push([this.values.lst[l],l]);b.sort(function(e,f){return e[0]-f[0]});a=a||b.length!==this.sorted_order.length;if(!a)for(l=0;l<b.length;++l)if(b[l][1]!==this.sorted_order[l]){a=!0;break}if(a){this.sorted_order.length=0;for(let e of b)this.sorted_order.push(e[1]);this.table.remake_table()}}image_click(a,b){if(this.add_stops_btn.v){a=rf.epnt_to_model(a,b);var [l,e]=this.points_adapter.project_to_stops_line(a);
l>10/rf.viewport_zoom||(this.values.add(e),this.colors.add([204,204,204,255]),this.redo_sort(),le(!0))}}async run(){1==this.method.sel_idx&&this.load_from_func();let a;try{a=this.is_radial()?new Xm(this.p1.x,this.p1.y,this.r1.v,this.p2.x,this.p2.y,this.r2.v,this.tex_smooth.get_value()):3==this.type.sel_idx?new Ym(this.p1.x,this.p1.y,this.tex_smooth.get_value()):new Um(this.p1.x,this.p1.y,this.p2.x,this.p2.y,this.tex_resolution.get_value(),this.tex_smooth.get_value(),2==this.type.sel_idx)}catch(f){Sd(!1,
this,f.message)}for(let f=0;f<this.values.lst.length;++f){var b=this.sorted_order[f];const h=4*b;b=this.values.lst[b];Sd(0<=b&&1>=b,this,"stop "+f+" out of range");a.add_stop(b,this.colors.lst.slice(h,h+4))}const [l,e]=this.spread.get_sel_val();a.set_spread(l,e);a.set_offset(this.stops_offset.dyn_eval());this.out.set(a)}selected_obj_name(){return 0<this.selected_indices.length?"stops":null}delete_selection(){let a=[];for(let b of this.selected_indices)4<=b&&a.push(b-4);this.values.remove(a);this.colors.remove(a);
this.redo_sort();this.clear_selection();le(!0)}load_preset(a){this.values.clear();this.colors.clear();for(let b of a)this.values.add(b.v),a=Dc.parse_hex(b.c),this.colors.add([a.r,a.g,a.b,a.alphai]);this.redo_sort(!0);this.clear_selection();le(!0)}load_from_func(){var a=this.func.need_input_evaler("t");this.values.clear();this.colors.clear();let b=[];if(null===a)a=this.func.dyn_eval(),b.push({v:0,c:fn(a)});else{var l=[0];a.dyn_set_obj(l);var e=this.func_samples.v;for(var f=0;f<=e;++f){l[0]=1/e*f;var h=
this.func.dyn_eval();b.push({v:l[0],c:fn(h)})}for(l=!0;l;)for(l=!1,e=0,f=1,h=2;h<b.length;){var g=b[e].v,m=(b[f].v-g)/(b[h].v-g);g=Oh.create();Oh.lerp(g,b[e].c,b[h].c,m);m=b[f].c;1>Math.abs(g[0]-m[0])&&1>Math.abs(g[1]-m[1])&&1>Math.abs(g[2]-m[2])&&1>Math.abs(g[3]-m[3])&&(b.splice(f,1),l=!0);++e;++f;++h}a.dyn_set_obj(null)}for(let q of b)this.values.add(q.v),this.colors.add(q.c);this.redo_sort(!0)}}const Ok={[Bj(12)]:11,[Bj(1,1)]:11},Pk={[Bj(1,12)]:11,[Bj(1,1,1)]:11};
class jn extends wg{constructor(a,b,l){super(a,void 0===l?b.label:l);this.wrap=b;void 0!==this.wrap.my_expr_items&&(this.my_expr_items=this.wrap.my_expr_items);void 0!==this.wrap.post_load_hook&&(this.post_load_hook=()=>{this.wrap.post_load_hook()})}save(){return this.wrap.save()}load(a){this.wrap.load(a)}add_elems(a){null!==this.group_param&&null!==this.group_param.line_elem&&(a=this.group_param.line_elem);this.wrap.add_elems(a)}pis_dirty(){return this.wrap.pis_dirty()}pclear_dirty(){this.wrap.pclear_dirty()}}
class Nk extends yj{constructor(a,b,l,e,f,h=null){super();this.objref=a;0===b.length?(this.type=f,this.name=l):(Ah(1==b.length,"wrong number of subscripts"),a=b[0],Ah(-1!==e.indexOf(a),"unknown subscript "+a),this.name=l+"."+a,this.type=1);this.func_ret_by_args=h}consumes_subscript(){return!0}eval(){Ah(!1,"text evaluator can't be evaled")}check_type(){return this.type}func_ret_type(a){if(null===this.func_ret_type_)throw new uj("Undefined func_ret_type for "+this.name);const b=this.func_ret_by_args[a];
if(void 0===b)throw new uj("No function overload of func "+this.name+"() takes arguments "+Cj(a));return b}clear_types_cache(){}to_glsl(){return this.name}additional_score_flags(){return 4}}function kn(a){switch(a){case 1:return"float";case 12:return"vec2";case 10:return"vec3";case 11:return"vec4";default:throw uj("unexpected type for glsl "+a);}}
class Cm{constructor(){this.add_funcs=null;this.uniform_decls=[];this.inline_str=null;this.uniform_evaluators={};this.glsl_code="";this.vec_expr_type="vec4";this.locals_defs={}}add_uniform(a,b,l){void 0===this.uniform_evaluators[b]&&(this.uniform_decls.push("uniform "+kn(a)+" "+b+";"),this.uniform_evaluators[b]=l)}do_replace(a){let b="";for(let l in this.locals_defs)b+=kn(this.locals_defs[l])+" "+l+";\n";return a.replace("$FUNCS$",null===this.add_funcs?"":this.add_funcs.to_text()).replace("$UNIFORM_DEFS$",
this.uniform_decls.join("\n")).replace(/\$EXPR\$/g,b+this.inline_str).replace("$EXPR_VEC_RET$",this.vec_expr_type).replace("$GLSL_CODE$",this.glsl_code)}set_uniform_vars(a){for(let b in this.uniform_evaluators){let l=this.uniform_evaluators[b];const e=a.param_of_uniform(b);console.assert(null!==e,"Missing expected uniform param "+b);e.modify(zh.do_eval(l),!1)}}set_uniform_vars_to_obj(a){for(let b in this.uniform_evaluators)a[b]=zh.do_eval(this.uniform_evaluators[b])}}
class ln extends zm{static name(){return"Function Fill"}constructor(a){super(a);this.shader_node.cls.attr_names=["vtx_pos"];this.in_texs=new xm(a,this.shader_node.cls.in_texs);this.in_texs.xoffset=30;this.in_fb=new xm(a,this.shader_node.cls.in_fb);this.out_tex=new xm(a,this.shader_node.cls.out_tex);a.set_state_evaluators({coord:(b,l)=>new Nk(b,l,"v_coord",["x","y"],12),...Qk});this.type=new Ti(a,"Type",0,["Float to Gradient","Direct Color","GLSL Program"],b=>{this.float_expr.set_visible(0===b);this.tex0_is_gradient.set_visible(0===
b);this.color_expr.set_visible(1===b);this.glsl_text.set_visible(2===b);0===b?(this.active_param=this.float_expr,this.active_item=this.float_expr.get_active_item(),this.remove_param_proxies()):1===b?(this.active_param=this.color_expr,this.active_item=this.color_expr.code_item,this.remove_param_proxies()):(this.active_item=this.active_param=null,this.process_glsl_text(this.glsl_text.v))});this.tex0_is_gradient=new qh(a,"Use first texture as gradient",!0);this.float_expr=new Gh(a,"Float\nExpression",
"coord.x",{show_code:!0});this.color_expr=new Nh(a,"Color\nExpression",["#cccccc","rgb(coord.x, coord.y, 1.0)"],{show_code:!0});this.glsl_text=new Si(a,"GLSL\nCode","void main() {\n    outColor = vec4(1.0, v_coord.x, 0.0, 1.0);    \n}\n",b=>{this.process_glsl_text(b)});this.proxies_group=new Xi(a,"Uniforms");this.order_table=new jn(a,this.shader_node.cls.order_table,"Tex Order");this._tex_order=new jn(a,this.shader_node.cls.order,"order");this.shader_node.cls.vtx_text.set_text("\nin vec4 vtx_pos;\nout vec2 v_coord;\nuniform mat3 t_mat;\n\nvoid main(void)\n{\n    vec3 tmp = t_mat * vec3(vtx_pos.xy, 1.0);\n    v_coord = tmp.xy;\n    gl_Position = vec4(vtx_pos.xy, 1.0, 1.0);\n}\n");
a.param_alias("Expression",this.float_expr);this.glsl_emit_ctx=this.active_item=this.active_param=null;this.param_proxies=[]}get_sorted_order(){return this.shader_node.cls.sorted_order}remove_param_proxies(a=!0){for(let b of this.param_proxies)this.node.remove_param(b);this.param_proxies=[];a&&this.proxies_group.update_elems()}process_glsl_text(){this.glsl_emit_ctx=this.make_frag_text();var a=this.glsl_emit_ctx.do_replace("\n\nin vec2 v_coord;\nout vec4 outColor;\n\n\n#ifdef _D_IS_GLSL_CODE\n#line 1\n$GLSL_CODE$\n#else // expr code\n\n$UNIFORM_DEFS$\n\n$FUNCS$\n\n#ifndef _D_EXPR_IS_COLOR\nfloat flt_expr() {\n    $EXPR$\n}\n#else\n$EXPR_VEC_RET$ vec_expr() {\n    $EXPR$\n}\nvec4 vec_cvt(vec4 v) { return v; }\nvec4 vec_cvt(vec3 v) { return vec4(v, 1.0); }\n#endif\n\nvoid main() {\n#ifndef _D_EXPR_IS_COLOR\n    float v = flt_expr();\n #ifdef _D_TEX0_GRAD\n    outColor = texture(_u_in_tex_0, vec2(v,0));\n #else\n    outColor = vec4(vec3(1.0, 0.5, 0.0) + vec3(v*2.0-1.0, v*2.0-1.0, v*2.0-1.0), 1.0);\n #endif\n#else     \n    outColor = vec_cvt(vec_expr());\n#endif     \n}\n\n#endif // expr code\n");
this.shader_node.cls.frag_text.set_text(a,!1);this.remove_param_proxies(!1);for(let b of this.shader_node.parameters)b.label.startsWith("_u_")||b.label.startsWith("_D_")||b.is_shader_generated&&!b.is_shader_generated()||(a=new jn(this.node,b),a.set_group(this.proxies_group),this.param_proxies.push(a));this.proxies_group.update_elems()}make_frag_text(){let a=new Cm;if(2===this.type.sel_idx)return a.glsl_code=this.glsl_text.v,a;if(this.active_param.show_code&&null!==this.active_item.e){null!==this.active_item.elast_error&&
Sd(!1,this,"Expression error "+this.active_item.elast_error.msg);try{a.inline_str=zh.do_to_glsl(this.active_item.e,a),Sd(null!==a.inline_str,this,"unexpected expression null"),a.vec_expr_type=kn(this.active_item.etype)}catch(b){Sd(!1,this,b.message)}}else if(0===this.type.sel_idx)a.inline_str="return "+this.active_param.get_value(),Number.isInteger(a.inline_str)&&(a.inline_str+=".0");else{let b=this.active_param.get_value();a.inline_str="return vec4("+b.r/255+","+b.g/255+","+b.b/255+","+b.alpha+")"}return a}async run(){var a=
this.in_fb.get_const();Sd(null!==a,this,"missing input texture-params");a=this.in_texs.get_input_consts();if(2!==this.type.sel_idx){if(this.active_param.pis_dirty()||this.type.pis_dirty())this.glsl_emit_ctx=this.make_frag_text();let b=this.glsl_emit_ctx.do_replace("\n\nin vec2 v_coord;\nout vec4 outColor;\n\n\n#ifdef _D_IS_GLSL_CODE\n#line 1\n$GLSL_CODE$\n#else // expr code\n\n$UNIFORM_DEFS$\n\n$FUNCS$\n\n#ifndef _D_EXPR_IS_COLOR\nfloat flt_expr() {\n    $EXPR$\n}\n#else\n$EXPR_VEC_RET$ vec_expr() {\n    $EXPR$\n}\nvec4 vec_cvt(vec4 v) { return v; }\nvec4 vec_cvt(vec3 v) { return vec4(v, 1.0); }\n#endif\n\nvoid main() {\n#ifndef _D_EXPR_IS_COLOR\n    float v = flt_expr();\n #ifdef _D_TEX0_GRAD\n    outColor = texture(_u_in_tex_0, vec2(v,0));\n #else\n    outColor = vec4(vec3(1.0, 0.5, 0.0) + vec3(v*2.0-1.0, v*2.0-1.0, v*2.0-1.0), 1.0);\n #endif\n#else     \n    outColor = vec_cvt(vec_expr());\n#endif     \n}\n\n#endif // expr code\n");
this.shader_node.cls.frag_text.set_text(b,!1)}this.glsl_emit_ctx.set_uniform_vars(this.shader_node.cls);this.shader_node.cls.param_of_define("_D_EXPR_IS_COLOR").modify(1===this.type.sel_idx,!1);this.shader_node.cls.param_of_define("_D_TEX0_GRAD").modify(1<=a.length&&this.tex0_is_gradient.get_value(),!1);this.shader_node.cls.param_of_define("_D_IS_GLSL_CODE").modify(2===this.type.sel_idx,!1);try{await this.shader_node.cls.run()}finally{2===this.type.sel_idx&&this.glsl_text.set_errors(this.shader_node.cls.frag_text.get_errors())}}}
class mn extends ln{static name(){return"Image Process"}constructor(a){super(a);this.in_texs.xoffset=a.width/2;this.in_fb.tvisible=!1;this.tex0_is_gradient.modify(!1)}async run(){var a=this.in_texs.get_input_consts();Sd(0!==a.length,this,"no input image");this.tex0_is_gradient.get_value()&&0===this.type.sel_idx?(Sd(2<=a.length,this,"second input required (since first input is gradient)"),a=a[this.get_sorted_order()[1]],Sd(a instanceof Ek,this,"second input needs to be an image")):(a=a[this.get_sorted_order()[0]],
Sd(a instanceof Ek,this,"first input needs to be an image"));const b=new Hk(a.width(),a.height(),a.sz_x,a.sz_y,a.smooth,a.edge,a.type);b.set_transform(a.t_mat);this.in_fb.force_set(b);await super.run()}}class nn{constructor(a){this.lines=[];this.owner={id:a,name:"dummy_node"+a,register_rename_observer:()=>{}}}}
class tm extends yd{static name(){return"Field"}constructor(a){super();this.t_mat=Qh.create();this.dfnode=a;this.last_tex_premade=this.p_img=this.p_args_tex=this.p_shader_node=this.p_prog=null}set_dfnode(a){this.dfnode=a}transform(a){null===this.dfnode.tr&&(this.dfnode.tr=Qh.create(),this.dfnode.inv_tr=Qh.create());Qh.multiply(this.dfnode.tr,a,this.dfnode.tr);Qh.invert(this.dfnode.inv_tr,this.dfnode.tr)}set_transform(a){this.dfnode.tr=null;this.transform(a)}get_transform(){return null===this.dfnode.tr?
Qh.create():this.dfnode.tr}ensure_prog(){null===this.p_prog&&(this.p_prog=new pj,this.p_shader_node=this.p_prog.add_node(0,0,"<dist-shader>",rm,null),this.p_shader_node.set_state_evaluators({coord:(a,b)=>new Nk(a,b,"v_coord",["x","y"],12)}),this.p_shader_node.cls.vtx_text.set_text("\nin vec4 vtx_pos;\nout vec2 v_coord;\nuniform mat3 t_mat;\n\nvoid main() {\n    vec3 tmp = t_mat * vec3(vtx_pos.xy, 1.0);\n    v_coord = tmp.xy;\n    gl_Position = vtx_pos;\n}\n"))}make_frag_text(a){Vk();this.ensure_prog();
const b=new on,[l,e]=this.dfnode.make_text(b);var f=e+"return "+l+";";a=a.replace("$FUNCS$",b.func_set.to_text()).replace("$EXPR$",f);this.p_shader_node.cls.frag_text.set_text(a);null===this.p_args_tex&&(this.p_args_tex=th.createTexture());th.bindTexture(th.TEXTURE_2D,this.p_args_tex);th.texImage2D(th.TEXTURE_2D,0,th.R32F,b.args_arr.length,1,0,th.RED,th.FLOAT,new Float32Array(b.args_arr));Ik(!1,"pad","pad");this.p_args_tex.t_mat=Qh.create();this.p_args_tex.sz_x=1;this.p_args_tex.sz_y=1;this.p_shader_node.cls.override_texs=
{3:this.p_args_tex};th.bindTexture(th.TEXTURE_2D,null);this.p_prog.delete_lines_of(this.p_shader_node.cls.in_texs);a=0;for(let h of b.img_proxies)f=new cd(new nn(a++),this.p_shader_node.cls.in_texs.get_attachment()),this.p_prog.add_line(f),f.to_term.force_set(h.prox_get_const_obj());return b}make_viewport_fb(){var a=Ff.fromValues(0,0);const b=Ff.fromValues(sf.width,sf.height);Ff.transformMat3(a,a,rf.t_inv_viewport);Ff.transformMat3(b,b,rf.t_inv_viewport);const l=Ff.create();Ff.add(l,a,b);Ff.scale(l,
l,.5);const e=Qh.create();Qh.fromTranslation(e,l);a=new Hk(sf.width,sf.height,b[0]-a[0],b[1]-a[1],!1,"pad","rgba");a.transform(e);return a}set_shader_variables_uniforms(a){a=a.uniform_values.get_kv();for(let b in a){const l=this.p_shader_node.cls.uniforms[b];Id(void 0!==l,"Uniform not found "+b);l.param.modify(a[b])}}async pre_draw(){const a=this.make_frag_text("\nout vec4 outColor;\nin vec2 v_coord;\nuniform bool u_raw_value;\n\n\nfloat get_arg(int i) {\n    return texelFetch(_u_in_tex_3, ivec2(i,0), 0).r;\n}\n\n$FUNCS$\n\nfloat value_func(vec2 coord) {\n    $EXPR$\n}\n\nvec3 lines_color_(float d) {\n    d *= 2.0;\n    if (d < 0.0)\n        return vec3(1.0, 0.45, 0.5) + d;\n    else\n        return vec3(0.4, 0.5, 1.0) - d;\n}\n\nvec3 lines_color(float d) {\n    d *= 2.0;\n    vec3 col = vec3(0.7, 0.475, 0.75) - sign(d)*vec3(0.3, -0.025, -0.25);\n    d = trunc(d*15.0)/15.0;\n\n    col -= abs(d);\n    return col;\n}\n\nvec3 smooth_lines_color(float d) {\n    d *= 2.0;\n    vec3 col = vec3(0.7, 0.475, 0.75) - sign(d)*vec3(0.3, -0.025, -0.25);\n    float id = trunc(d*15.0)/15.0;\n    float id2 = (trunc(d*15.0)+sign(d))/15.0;\n    \n    vec3 cola = col - abs(id);\n    vec3 colb = col - abs(id2);\n    col = mix(cola, colb, smoothstep(-0.0,0.05,abs(mod(sign(d)*d,1.0/15.0))) );\n    return col;\n}\n\nvoid main() {\n    float d = value_func(v_coord);\n   // d = d - 1.0;\n\n   if (u_raw_value)\n       outColor = vec4(d, d, d, 1.0);\n   else \n       outColor = vec4(lines_color(d), 1.0);\n}\n"),
b=this.make_viewport_fb();this.p_shader_node.cls.in_fb.force_set(b);this.p_shader_node.cls.uniforms.u_raw_value.param.modify(!1);this.set_shader_variables_uniforms(a);await this.p_shader_node.cls.run();this.p_shader_node.clear_dirty();this.p_img=this.p_shader_node.cls.out_tex.get_const();await this.p_img.pre_draw(null,null)}draw(a){this.p_img.draw(a,null)}async get_pixels_for_fb(a){return(await this.do_texture(a)).get_pixels()}async do_texture(a){const b=this.make_frag_text("\nout vec4 outColor;\nin vec2 v_coord;\nuniform bool u_raw_value;\n\n\nfloat get_arg(int i) {\n    return texelFetch(_u_in_tex_3, ivec2(i,0), 0).r;\n}\n\n$FUNCS$\n\nfloat value_func(vec2 coord) {\n    $EXPR$\n}\n\nvec3 lines_color_(float d) {\n    d *= 2.0;\n    if (d < 0.0)\n        return vec3(1.0, 0.45, 0.5) + d;\n    else\n        return vec3(0.4, 0.5, 1.0) - d;\n}\n\nvec3 lines_color(float d) {\n    d *= 2.0;\n    vec3 col = vec3(0.7, 0.475, 0.75) - sign(d)*vec3(0.3, -0.025, -0.25);\n    d = trunc(d*15.0)/15.0;\n\n    col -= abs(d);\n    return col;\n}\n\nvec3 smooth_lines_color(float d) {\n    d *= 2.0;\n    vec3 col = vec3(0.7, 0.475, 0.75) - sign(d)*vec3(0.3, -0.025, -0.25);\n    float id = trunc(d*15.0)/15.0;\n    float id2 = (trunc(d*15.0)+sign(d))/15.0;\n    \n    vec3 cola = col - abs(id);\n    vec3 colb = col - abs(id2);\n    col = mix(cola, colb, smoothstep(-0.0,0.05,abs(mod(sign(d)*d,1.0/15.0))) );\n    return col;\n}\n\nvoid main() {\n    float d = value_func(v_coord);\n   // d = d - 1.0;\n\n   if (u_raw_value)\n       outColor = vec4(d, d, d, 1.0);\n   else \n       outColor = vec4(lines_color(d), 1.0);\n}\n");
this.p_shader_node.cls.in_fb.force_set(a);this.p_shader_node.cls.uniforms.u_raw_value.param.modify(!0);this.set_shader_variables_uniforms(b);await this.p_shader_node.cls.run();this.p_shader_node.clear_dirty();a=this.p_shader_node.cls.out_tex.get_const();Id(null!==a,"distance shader produced not output");return a}async premake_gl_texture(a){a=Kd(a);a.set_type("float");a.set_smooth(!1);a=(await this.do_texture(a)).tex_obj;a.t_mat=Qh.create();Qh.copy(a.t_mat,this.t_mat);this.last_tex_premade=a}make_gl_texture(){return this.last_tex_premade}draw_selection(){}draw_template(){}}
class on{constructor(){this.var_count=1;this.args_arr=[];this.tr_arr=[];this.func_set=new Fj;this.uniform_values=new Fj;this.img_proxies=[]}alloc_var(){const a=this.var_count;++this.var_count;return a}alloc_tex_slots(a){Id(3>=this.img_proxies.length+a.length,"Too many textures in distance field");const b=this.img_proxies.length;this.img_proxies.push(...a);return b}}class pn{}
class qn extends pn{constructor(a=null,b=null,l=null,e=null,f=null){super();this.func_maker=a;this.tr=b;null!==this.tr?(this.inv_tr=Qh.create(),Qh.invert(this.inv_tr,this.tr)):this.inv_tr=null;this.inline_tr=!1;this.args=l;this.children=e;this.func_set=f;this.pass_first_arg_idx=!1}make_text(a){const b=[];let l="";var e="",f="",h=!1;const g="v"+a.alloc_var();if(null!==this.children)for(var m of this.children){const [B,D]=m.make_text(a);b.push(B);l+=D}m=[];if(null!==this.inv_tr){var q=a.args_arr.length,
r=this.inv_tr;a.args_arr.push(r[0],r[1],r[3],r[4],r[6],r[7]);if(this.inline_tr){f="in_coord"+a.alloc_var();e=e+("float "+g+" = 0.0;\nvec2 ")+(f+" = coord;\n");e+="{\n";h=[];for(r=q;r<q+6;++r)h.push("get_arg("+r+")");q=h.join(", ");e=e+("  mat3x2 tr = mat3x2("+q+");\n  vec2 coord = tr * vec3(")+(f+", 1.0);\n");f="}\n";h=!0}else m.push(q)}if(null!==this.args)for(this.pass_first_arg_idx&&m.push(a.args_arr.length),q=0;q<this.args.length;++q)r=a.args_arr.length,this.pass_first_arg_idx||m.push("get_arg("+
r+")"),a.args_arr.push(this.args[q]);null!==this.func_set&&a.func_set.extend(this.func_set);l+=(h?"":"float ")+g+" = "+this.func_maker.make_func(m,b,a)+";\n";return[g,e+l+f]}}class rn{make_func(){Id(!1,"unimplemented make_func")}get_init_val(){Id(!1,"unimplemented get_init_val")}}class sn extends rn{constructor(a){super();this.func_name=a}make_func(a){return this.func_name+"(coord, "+a.join(", ")+")"}}
class tn extends ye{constructor(a){super(a);this.out_obj=null}set_out_dfnode(a){Sd(null!==a,this,"null dfnode");null===this.out_obj?this.out_obj=new tm(a):this.out_obj.set_dfnode(a);this.out.set(this.out_obj)}}
class un extends tn{static name(){return"Field Primitive"}constructor(a){super(a);this.out=new Td(a,"out_field");this.type=new Ti(a,"Shape",0,["Circle","Inverse-Circle","Box"],b=>{this.radius.set_visible(0===b||1===b);this.size.set_visible(2===b)});this.radius=new Gh(a,"Radius",.25,{enabled:!0});this.size=new Jh(a,"Size",.5,.3);this.transform=new Ph(a,"Transform")}need_size(){return 2===this.type.sel_idx}run(){let a=null,b=new Fj;const l=(e,f,h,g)=>{f="float $NAME$(vec2 coord, int tr_idx, $ARGS$) {\n    mat3x2 tr = mat3x2(get_arg(tr_idx), get_arg(tr_idx+1), get_arg(tr_idx+2), get_arg(tr_idx+3), get_arg(tr_idx+4), get_arg(tr_idx+5));\n    vec2 p = tr * vec3(coord, 1.0);\n    $F$\n}".replace("$F$",
g).replace("$NAME$",e).replace("$ARGS$","float "+f.join(", float "));b.add(e,f);a=new qn(new sn(e),this.transform.get_value(),h,[],b)};switch(this.type.sel_idx){case 0:l("circle",["radius"],[this.radius.get_value()],"return sqrt(p.x*p.x + p.y*p.y) - radius;");break;case 1:l("inv_circle",["radius"],[this.radius.get_value()],"return sqrt((radius*radius) / (p.x*p.x + p.y*p.y));");break;case 2:const e=this.size.get_value();l("box",["width","height"],[e[0],e[1]],"vec2 d = abs(p)-vec2(width/2.0, height/2.0);\nreturn length(max(d,0.0)) + min(max(d.x,d.y),0.0);");
break;default:Sd(!1,this,"expr not set")}this.set_out_dfnode(a)}draw_selection(a){this.transform.draw_dial_at_obj(null,a);this.need_size()&&this.size.size_dial_draw(this.transform.v,a)}image_find_obj(a){let b=this.transform.dial.find_obj(a);return b||this.need_size()&&(b=this.size.size_dial_find_obj(a))?b:null}}
class vn{constructor(a){this.args=a;this.cur_moveTo=null}startPath(a){this.args.push(a)}moveTo(a,b){this.cur_moveTo=[a,b];this.args.push(a,b)}lineTo(a,b){this.args.push(0,a,b)}bezierCurveTo(a,b,l,e,f,h){this.args.push(1,a,b,l,e,f,h)}closePath(a){Id(null!==this.cur_moveTo,"nothing to close");a&&this.args.push(0,this.cur_moveTo[0],this.cur_moveTo[1]);this.cur_moveTo=null}}
class wn extends tn{static name(){return"Field From Geometry"}constructor(a){super(a);this.in_geom=new Rd(a,"in_geom");this.out=new Td(a,"out_field")}args_for_tri_mesh(a){const b=[],l=a.effective_vtx_pos;b.push(a.face_count());for(let e of a.arrs.idx)b.push(l[2*e],l[2*e+1]);return b}args_for_quad_mesh(a){const b=[],l=a.effective_vtx_pos;b.push(a.face_count());let e=0;for(let f of a.arrs.idx)0==e++%4&&b.push(4),b.push(l[2*f],l[2*f+1]);return b}args_for_multipath(a){const b=[],l=a.effective_vtx_pos;
b.push(a.face_count());for(let f=0;f<a.paths_ranges.length;f+=3){var e=2*a.paths_ranges[f];let h=2*a.paths_ranges[f+1];for(b.push((h-e)/2);e<h;e+=2)b.push(l[e],l[e+1])}return b}args_for_multi_curves(a){const b=[];b.push(a.face_count());a.call_all_paths_commands(new vn(b));return b}run(){const a=this.in_geom.get_const();Sd(null!==a,this,"no input");const b=new Fj;let l=null,e=null;a.constructor===ij?2===a.type?(e=this.args_for_tri_mesh(a),b.add("triMesh","\nfloat sdTriangle(in vec2 p, in vec2 p0, in vec2 p1, in vec2 p2)\n{\n    vec2 e0 = p1-p0, e1 = p2-p1, e2 = p0-p2;\n    vec2 v0 = p -p0, v1 = p -p1, v2 = p -p2;\n    vec2 pq0 = v0 - e0*clamp( dot(v0,e0)/dot(e0,e0), 0.0, 1.0 );\n    vec2 pq1 = v1 - e1*clamp( dot(v1,e1)/dot(e1,e1), 0.0, 1.0 );\n    vec2 pq2 = v2 - e2*clamp( dot(v2,e2)/dot(e2,e2), 0.0, 1.0 );\n    float s = sign( e0.x*e2.y - e0.y*e2.x );\n    vec2 d = min(min(vec2(dot(pq0,pq0), s*(v0.x*e0.y-v0.y*e0.x)),\n                     vec2(dot(pq1,pq1), s*(v1.x*e1.y-v1.y*e1.x))),\n                     vec2(dot(pq2,pq2), s*(v2.x*e2.y-v2.y*e2.x)));\n    return -sqrt(d.x)*sign(d.y);\n}\n\nfloat triMesh(vec2 coord, int startIdx) {\n    int countTri = int(get_arg(startIdx));\n    float d = 1e38;\n    int idx = startIdx + 1;\n    for(int i = 0; i < countTri; ++i) {\n        d = min(d, sdTriangle(coord, vec2(get_arg(idx), get_arg(idx+1)), vec2(get_arg(idx+2), get_arg(idx+3)), vec2(get_arg(idx+4), get_arg(idx+5))));\n        idx += 6;\n    }\n    return d;\n}"),
l=new qn(new sn("triMesh"),null,e,null,b),l.pass_first_arg_idx=!0):1===a.type&&(e=this.args_for_quad_mesh(a)):a.constructor==Uj?a.has_curves()?(b.add("sdCubicBezier","/*\nExact distance to cubic bezier curve by computing roots of the derivative(s)\nto isolate roots of a fifth degree polynomial and Halley's Method to compute them.\nInspired by https://www.shadertoy.com/view/4sXyDr and https://www.shadertoy.com/view/ldXXWH\nSee also my approximate version:\nhttps://www.shadertoy.com/view/lsByRG\n*/\nconst float eps = .000005;\nconst float zoom = 1.;\nconst float dot_size=.005;\nconst vec3 point_col=vec3(1,1,0);\nconst int halley_iterations = 8;\n\n//lagrange positive real root upper bound\n//see for example: https://doi.org/10.1016/j.jsc.2014.09.038\nfloat upper_bound_lagrange5(float a0, float a1, float a2, float a3, float a4){\n\n\tvec4 coeffs1 = vec4(a0,a1,a2,a3);\n\n\tvec4 neg1 = max(-coeffs1,vec4(0));\n\tfloat neg2 = max(-a4,0.);\n\n\tconst vec4 indizes1 = vec4(0,1,2,3);\n\tconst float indizes2 = 4.;\n\n\tvec4 bounds1 = pow(neg1,1./(5.-indizes1));\n\tfloat bounds2 = pow(neg2,1./(5.-indizes2));\n\n\tvec2 min1_2 = min(bounds1.xz,bounds1.yw);\n\tvec2 max1_2 = max(bounds1.xz,bounds1.yw);\n\n\tfloat maxmin = max(min1_2.x,min1_2.y);\n\tfloat minmax = min(max1_2.x,max1_2.y);\n\n\tfloat max3 = max(max1_2.x,max1_2.y);\n\n\tfloat max_max = max(max3,bounds2);\n\tfloat max_max2 = max(min(max3,bounds2),max(minmax,maxmin));\n\n\treturn max_max + max_max2;\n}\n\n//lagrange upper bound applied to f(-x) to get lower bound\nfloat lower_bound_lagrange5(float a0, float a1, float a2, float a3, float a4){\n\n\tvec4 coeffs1 = vec4(-a0,a1,-a2,a3);\n\n\tvec4 neg1 = max(-coeffs1,vec4(0));\n\tfloat neg2 = max(-a4,0.);\n\n\tconst vec4 indizes1 = vec4(0,1,2,3);\n\tconst float indizes2 = 4.;\n\n\tvec4 bounds1 = pow(neg1,1./(5.-indizes1));\n\tfloat bounds2 = pow(neg2,1./(5.-indizes2));\n\n\tvec2 min1_2 = min(bounds1.xz,bounds1.yw);\n\tvec2 max1_2 = max(bounds1.xz,bounds1.yw);\n\n\tfloat maxmin = max(min1_2.x,min1_2.y);\n\tfloat minmax = min(max1_2.x,max1_2.y);\n\n\tfloat max3 = max(max1_2.x,max1_2.y);\n\n\tfloat max_max = max(max3,bounds2);\n\tfloat max_max2 = max(min(max3,bounds2),max(minmax,maxmin));\n\n\treturn -max_max - max_max2;\n}\n\nvec2 parametric_cub_bezier(float t, vec2 p0, vec2 p1, vec2 p2, vec2 p3){\n\tvec2 a0 = (-p0 + 3. * p1 - 3. * p2 + p3);\n\tvec2 a1 = (3. * p0  -6. * p1 + 3. * p2);\n\tvec2 a2 = (-3. * p0 + 3. * p1);\n\tvec2 a3 = p0;\n\n\treturn (((a0 * t) + a1) * t + a2) * t + a3;\n}\n\nvoid sort_roots3(inout vec3 roots){\n\tvec3 tmp;\n\n\ttmp[0] = min(roots[0],min(roots[1],roots[2]));\n\ttmp[1] = max(roots[0],min(roots[1],roots[2]));\n\ttmp[2] = max(roots[0],max(roots[1],roots[2]));\n\n\troots=tmp;\n}\n\nvoid sort_roots4(inout vec4 roots){\n\tvec4 tmp;\n\n\tvec2 min1_2 = min(roots.xz,roots.yw);\n\tvec2 max1_2 = max(roots.xz,roots.yw);\n\n\tfloat maxmin = max(min1_2.x,min1_2.y);\n\tfloat minmax = min(max1_2.x,max1_2.y);\n\n\ttmp[0] = min(min1_2.x,min1_2.y);\n\ttmp[1] = min(maxmin,minmax);\n\ttmp[2] = max(minmax,maxmin);\n\ttmp[3] = max(max1_2.x,max1_2.y);\n\n\troots = tmp;\n}\n\nfloat eval_poly5(float a0, float a1, float a2, float a3, float a4, float x){\n\n\tfloat f = ((((x + a4) * x + a3) * x + a2) * x + a1) * x + a0;\n\n\treturn f;\n}\n\n//halley's method\n//basically a variant of newton raphson which converges quicker and has bigger basins of convergence\n//see http://mathworld.wolfram.com/HalleysMethod.html\n//or https://en.wikipedia.org/wiki/Halley%27s_method\nfloat halley_iteration5(float a0, float a1, float a2, float a3, float a4, float x){\n\n\tfloat f = ((((x + a4) * x + a3) * x + a2) * x + a1) * x + a0;\n\tfloat f1 = (((5. * x + 4. * a4) * x + 3. * a3) * x + 2. * a2) * x + a1;\n\tfloat f2 = ((20. * x + 12. * a4) * x + 6. * a3) * x + 2. * a2;\n\n\treturn x - (2. * f * f1) / (2. * f1 * f1 - f * f2);\n}\n\nfloat halley_iteration4(vec4 coeffs, float x){\n\n\tfloat f = (((x + coeffs[3]) * x + coeffs[2]) * x + coeffs[1]) * x + coeffs[0];\n\tfloat f1 = ((4. * x + 3. * coeffs[3]) * x + 2. * coeffs[2]) * x + coeffs[1];\n\tfloat f2 = (12. * x + 6. * coeffs[3]) * x + 2. * coeffs[2];\n\n\treturn x - (2. * f * f1) / (2. * f1 * f1 - f * f2);\n}\n\n// Modified from http://tog.acm.org/resources/GraphicsGems/gems/Roots3And4.c\n// Credits to Doublefresh for hinting there\nint solve_quadric(vec2 coeffs, inout vec2 roots){\n\n    // normal form: x^2 + px + q = 0\n    float p = coeffs[1] / 2.;\n    float q = coeffs[0];\n\n    float D = p * p - q;\n\n    if (D < 0.){\n\t\treturn 0;\n    }\n    else if (D > 0.){\n\t\troots[0] = -sqrt(D) - p;\n\t\troots[1] = sqrt(D) - p;\n\n\t\treturn 2;\n    }\n}\n\n//From Trisomie21\n//But instead of his cancellation fix i'm using a newton iteration\nint solve_cubic(vec3 coeffs, inout vec3 r){\n\n\tfloat a = coeffs[2];\n\tfloat b = coeffs[1];\n\tfloat c = coeffs[0];\n\n\tfloat p = b - a*a / 3.0;\n\tfloat q = a * (2.0*a*a - 9.0*b) / 27.0 + c;\n\tfloat p3 = p*p*p;\n\tfloat d = q*q + 4.0*p3 / 27.0;\n\tfloat offset = -a / 3.0;\n\tif(d >= 0.0) { // Single solution\n\t\tfloat z = sqrt(d);\n\t\tfloat u = (-q + z) / 2.0;\n\t\tfloat v = (-q - z) / 2.0;\n\t\tu = sign(u)*pow(abs(u),1.0/3.0);\n\t\tv = sign(v)*pow(abs(v),1.0/3.0);\n\t\tr[0] = offset + u + v;\t\n\n\t\t//Single newton iteration to account for cancellation\n\t\tfloat f = ((r[0] + a) * r[0] + b) * r[0] + c;\n\t\tfloat f1 = (3. * r[0] + 2. * a) * r[0] + b;\n\n\t\tr[0] -= f / f1;\n\n\t\treturn 1;\n\t}\n\tfloat u = sqrt(-p / 3.0);\n\tfloat v = acos(-sqrt( -27.0 / p3) * q / 2.0) / 3.0;\n\tfloat m = cos(v), n = sin(v)*1.732050808;\n\n\t//Single newton iteration to account for cancellation\n\t//(once for every root)\n\tr[0] = offset + u * (m + m);\n    r[1] = offset - u * (n + m);\n    r[2] = offset + u * (n - m);\n\n\tvec3 f = ((r + a) * r + b) * r + c;\n\tvec3 f1 = (3. * r + 2. * a) * r + b;\n\n\tr -= f / f1;\n\n\treturn 3;\n}\n\n// Modified from http://tog.acm.org/resources/GraphicsGems/gems/Roots3And4.c\n// Credits to Doublefresh for hinting there\nint solve_quartic(vec4 coeffs, inout vec4 s){\n\n\tfloat a = coeffs[3];\n\tfloat b = coeffs[2];\n\tfloat c = coeffs[1];\n\tfloat d = coeffs[0];\n\n    /*  substitute x = y - A/4 to eliminate cubic term:\n\tx^4 + px^2 + qx + r = 0 */\n\n    float sq_a = a * a;\n    float p = - 3./8. * sq_a + b;\n    float q = 1./8. * sq_a * a - 1./2. * a * b + c;\n    float r = - 3./256.*sq_a*sq_a + 1./16.*sq_a*b - 1./4.*a*c + d;\n\n\tint num;\n\n\t/* doesn't seem to happen for me */\n    //if(abs(r)<eps){\n\t//\t/* no absolute term: y(y^3 + py + q) = 0 */\n\n\t//\tvec3 cubic_coeffs;\n\n\t//\tcubic_coeffs[0] = q;\n\t//\tcubic_coeffs[1] = p;\n\t//\tcubic_coeffs[2] = 0.;\n\n\t//\tnum = solve_cubic(cubic_coeffs, s.xyz);\n\n\t//\ts[num] = 0.;\n\t//\tnum++;\n    //}\n    {\n\t\t/* solve the resolvent cubic ... */\n\n\t\tvec3 cubic_coeffs;\n\n\t\tcubic_coeffs[0] = 1.0/2. * r * p - 1.0/8. * q * q;\n\t\tcubic_coeffs[1] = - r;\n\t\tcubic_coeffs[2] = - 1.0/2. * p;\n\n\t\tsolve_cubic(cubic_coeffs, s.xyz);\n\n\t\t/* ... and take the one real solution ... */\n\n\t\tfloat z = s[0];\n\n\t\t/* ... to build two quadric equations */\n\n\t\tfloat u = z * z - r;\n\t\tfloat v = 2. * z - p;\n\n\t\tif(u > -eps){\n\t\t\tu = sqrt(abs(u));\n\t\t}\n\t\telse{\n\t\t\treturn 0;\n\t\t}\n\n\t\tif(v > -eps){\n\t\t\tv = sqrt(abs(v));\n\t\t}\n\t\telse{\n\t\t\treturn 0;\n\t\t}\n\n\t\tvec2 quad_coeffs;\n\n\t\tquad_coeffs[0] = z - u;\n\t\tquad_coeffs[1] = q < 0. ? -v : v;\n\n\t\tnum = solve_quadric(quad_coeffs, s.xy);\n\n\t\tquad_coeffs[0]= z + u;\n\t\tquad_coeffs[1] = q < 0. ? v : -v;\n\n\t\tvec2 tmp=vec2(1e38);\n\t\tint old_num=num;\n\n\t\tnum += solve_quadric(quad_coeffs, tmp);\n        if(old_num!=num){\n            if(old_num == 0){\n                s[0] = tmp[0];\n                s[1] = tmp[1];\n            }\n            else{//old_num == 2\n                s[2] = tmp[0];\n                s[3] = tmp[1];\n            }\n        }\n    }\n\n    /* resubstitute */\n\n    float sub = 1./4. * a;\n\n\t/* single halley iteration to fix cancellation */\n\tfor(int i=0;i<4;i+=2){\n\t\tif(i < num){\n\t\t\ts[i] -= sub;\n\t\t\ts[i] = halley_iteration4(coeffs,s[i]);\n\n\t\t\ts[i+1] -= sub;\n\t\t\ts[i+1] = halley_iteration4(coeffs,s[i+1]);\n\t\t}\n\t}\n\n    return num;\n}\n\n//Sign computation is pretty straightforward:\n//I'm solving a cubic equation to get the intersection count\n//of a ray from the current point to infinity and parallel to the x axis\n//Also i'm computing the intersection count with the tangent in the end points of the curve\nint cubic_bezier_sign(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3){\n\n\tfloat cu = (-p0.y + 3. * p1.y - 3. * p2.y + p3.y);\n\tfloat qu = (3. * p0.y - 6. * p1.y + 3. * p2.y);\n\tfloat li = (-3. * p0.y + 3. * p1.y);\n\tfloat co = p0.y - uv.y;\n\n\tvec3 roots = vec3(1e38);\n\tint n_roots = solve_cubic(vec3(co/cu,li/cu,qu/cu),roots);\n\n\tint n_ints = 0;\n\n\tfor(int i=0;i<3;i++){\n\t\tif(i < n_roots){\n\t\t\tif(roots[i] >= 0. && roots[i] <= 1.){\n\t\t\t\tfloat x_pos = -p0.x + 3. * p1.x - 3. * p2.x + p3.x;\n\t\t\t\tx_pos = x_pos * roots[i] + 3. * p0.x - 6. * p1.x + 3. * p2.x;\n\t\t\t\tx_pos = x_pos * roots[i] + -3. * p0.x + 3. * p1.x;\n\t\t\t\tx_pos = x_pos * roots[i] + p0.x;\n\n\t\t\t\tif(x_pos < uv.x){\n\t\t\t\t\tn_ints++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn n_ints;\n\n\t/*if(n_ints==0 || n_ints==2 || n_ints==4){\n\t\treturn 1.;\n\t}\n\telse{\n\t\treturn -1.;\n\t}*/\n}\n\nfloat cubic_bezier_dis(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3){\n\n\t//switch points when near to end point to minimize numerical error\n\t//only needed when control point(s) very far away\n\t#if 0\n\tvec2 mid_curve = parametric_cub_bezier(.5,p0,p1,p2,p3);\n\tvec2 mid_points = (p0 + p3)/2.;\n\n\tvec2 tang = mid_curve-mid_points;\n\tvec2 nor = vec2(tang.y,-tang.x);\n\n\tif(sign(dot(nor,uv-mid_curve)) != sign(dot(nor,p0-mid_curve))){\n\t\tvec2 tmp = p0;\n\t\tp0 = p3;\n\t\tp3 = tmp;\n\n\t\ttmp = p2;\n\t\tp2 = p1;\n\t\tp1 = tmp;\n\t}\n\t#endif\n\n\tvec2 a3 = (-p0 + 3. * p1 - 3. * p2 + p3);\n\tvec2 a2 = (3. * p0 - 6. * p1 + 3. * p2);\n\tvec2 a1 = (-3. * p0 + 3. * p1);\n\tvec2 a0 = p0 - uv;\n    \n    //compute polynomial describing distance to current pixel dependent on a parameter t\n\tfloat bc6 = dot(a3,a3);\n\tfloat bc5 = 2.*dot(a3,a2);\n\tfloat bc4 = dot(a2,a2) + 2.*dot(a1,a3);\n\tfloat bc3 = 2.*(dot(a1,a2) + dot(a0,a3));\n\tfloat bc2 = dot(a1,a1) + 2.*dot(a0,a2);\n\tfloat bc1 = 2.*dot(a0,a1);\n\tfloat bc0 = dot(a0,a0);\n\n\tbc5 /= bc6;\n\tbc4 /= bc6;\n\tbc3 /= bc6;\n\tbc2 /= bc6;\n\tbc1 /= bc6;\n\tbc0 /= bc6;\n    \n    //compute derivatives of this polynomial\n\n\tfloat b0 = bc1 / 6.;\n\tfloat b1 = 2. * bc2 / 6.;\n\tfloat b2 = 3. * bc3 / 6.;\n\tfloat b3 = 4. * bc4 / 6.;\n\tfloat b4 = 5. * bc5 / 6.;\n\n\tvec4 c1 = vec4(b1,2.*b2,3.*b3,4.*b4)/5.;\n\tvec3 c2 = vec3(c1[1],2.*c1[2],3.*c1[3])/4.;\n\tvec2 c3 = vec2(c2[1],2.*c2[2])/3.;\n\tfloat c4 = c3[1]/2.;\n\n\tvec4 roots_drv = vec4(1e38);\n\n\tint num_roots_drv = solve_quartic(c1,roots_drv);\n\tsort_roots4(roots_drv);\n\n\tfloat ub = upper_bound_lagrange5(b0,b1,b2,b3,b4);\n\tfloat lb = lower_bound_lagrange5(b0,b1,b2,b3,b4);\n\n\tvec3 a = vec3(1e38);\n\tvec3 b = vec3(1e38);\n\n\tvec3 roots = vec3(1e38);\n\n\tint num_roots = 0;\n    \n\t//compute root isolating intervals by roots of derivative and outer root bounds\n    //only roots going form - to + considered, because only those result in a minimum\n\tif(num_roots_drv==4){\n\t\tif(eval_poly5(b0,b1,b2,b3,b4,roots_drv[0]) > 0.){\n\t\t\ta[0]=lb;\n\t\t\tb[0]=roots_drv[0];\n\t\t\tnum_roots=1;\n\t\t}\n\n\t\tif(sign(eval_poly5(b0,b1,b2,b3,b4,roots_drv[1])) != sign(eval_poly5(b0,b1,b2,b3,b4,roots_drv[2]))){\n            if(num_roots == 0){\n\t\t\t\ta[0]=roots_drv[1];\n\t\t\t\tb[0]=roots_drv[2];\n                num_roots=1;\n            }\n            else{\n            \ta[1]=roots_drv[1];\n\t\t\t\tb[1]=roots_drv[2];\n                num_roots=2;\n            }\n\t\t}\n\n\t\tif(eval_poly5(b0,b1,b2,b3,b4,roots_drv[3]) < 0.){\n            if(num_roots == 0){\n                a[0]=roots_drv[3];\n                b[0]=ub;\n                num_roots=1;\n            }\n            else if(num_roots == 1){\n                a[1]=roots_drv[3];\n                b[1]=ub;\n                num_roots=2;\n            }\n            else{\n                a[2]=roots_drv[3];\n                b[2]=ub;\n                num_roots=3;\n            }\n\t\t}\n\t}\n\telse{\n\t\tif(num_roots_drv==2){\n\t\t\tif(eval_poly5(b0,b1,b2,b3,b4,roots_drv[0]) < 0.){\n\t\t\t\tnum_roots=1;\n\t\t\t\ta[0]=roots_drv[1];\n\t\t\t\tb[0]=ub;\n\t\t\t}\n\t\t\telse if(eval_poly5(b0,b1,b2,b3,b4,roots_drv[1]) > 0.){\n\t\t\t\tnum_roots=1;\n\t\t\t\ta[0]=lb;\n\t\t\t\tb[0]=roots_drv[0];\n\t\t\t}\n\t\t\telse{\n\t\t\t\tnum_roots=2;\n\n\t\t\t\ta[0]=lb;\n\t\t\t\tb[0]=roots_drv[0];\n\n\t\t\t\ta[1]=roots_drv[1];\n\t\t\t\tb[1]=ub;\n\t\t\t}\n\n\t\t}\n\t\telse{//num_roots_drv==0\n\t\t\tvec3 roots_snd_drv=vec3(1e38);\n\t\t\tint num_roots_snd_drv=solve_cubic(c2,roots_snd_drv);\n\n\t\t\tvec2 roots_trd_drv=vec2(1e38);\n\t\t\tint num_roots_trd_drv=solve_quadric(c3,roots_trd_drv);\n\t\t\tnum_roots=1;\n\n\t\t\ta[0]=lb;\n\t\t\tb[0]=ub;\n\t\t}\n        \n        //further subdivide intervals to guarantee convergence of halley's method\n\t\t//by using roots of further derivatives\n\t\tvec3 roots_snd_drv=vec3(1e38);\n\t\tint num_roots_snd_drv=solve_cubic(c2,roots_snd_drv);\n\t\tsort_roots3(roots_snd_drv);\n\n\t\tint num_roots_trd_drv=0;\n\t\tvec2 roots_trd_drv=vec2(1e38);\n\n\t\tif(num_roots_snd_drv!=3){\n\t\t\tnum_roots_trd_drv=solve_quadric(c3,roots_trd_drv);\n\t\t}\n\n\t\tfor(int i=0;i<3;i++){\n\t\t\tif(i < num_roots){\n\t\t\t\tfor(int j=0;j<3;j+=2){\n\t\t\t\t\tif(j < num_roots_snd_drv){\n\t\t\t\t\t\tif(a[i] < roots_snd_drv[j] && b[i] > roots_snd_drv[j]){\n\t\t\t\t\t\t\tif(eval_poly5(b0,b1,b2,b3,b4,roots_snd_drv[j]) > 0.){\n\t\t\t\t\t\t\t\tb[i]=roots_snd_drv[j];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse{\n\t\t\t\t\t\t\t\ta[i]=roots_snd_drv[j];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor(int j=0;j<2;j++){\n\t\t\t\t\tif(j < num_roots_trd_drv){\n\t\t\t\t\t\tif(a[i] < roots_trd_drv[j] && b[i] > roots_trd_drv[j]){\n\t\t\t\t\t\t\tif(eval_poly5(b0,b1,b2,b3,b4,roots_trd_drv[j]) > 0.){\n\t\t\t\t\t\t\t\tb[i]=roots_trd_drv[j];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse{\n\t\t\t\t\t\t\t\ta[i]=roots_trd_drv[j];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfloat d0 = 1e38;\n\n    //compute roots with halley's method\n    \n\tfor(int i=0;i<3;i++){\n\t\tif(i < num_roots){\n\t\t\troots[i] = .5 * (a[i] + b[i]);\n\n            for(int j=0;j<halley_iterations;j++){\n\t\t\t\troots[i] = halley_iteration5(b0,b1,b2,b3,b4,roots[i]);\n            }\n\t\t\t\n\n            //compute squared distance to nearest point on curve\n\t\t\troots[i] = clamp(roots[i],0.,1.);\n\t\t\tvec2 to_curve = uv - parametric_cub_bezier(roots[i],p0,p1,p2,p3);\n\t\t\td0 = min(d0,dot(to_curve,to_curve));\n\t\t}\n\t}\n\n\treturn d0; //sqrt(d0);\n}\n\n// p0, p3 real points, p1 point of p0, p2 point of p3\n/*float sdCubicBezier(vec2 uv, vec2 p0, vec2 p1, vec2 p2, vec2 p3)\n{\n\tfloat d0 = 1e38;\n\td0 = min(d0,cubic_bezier_dis(uv,p0,p1,p2,p3));\n    float sgn = cubic_bezier_sign(uv,p0,p1,p2,p3);   \n    return d0 * sgn; \n}*/\n"),
b.add("multiPathWithCurves","\nfloat multiPathWithCurves(vec2 p, int startIdx) \n{\n    int countPaths = int(get_arg(startIdx));\n    float d =  1e38;\n    int idx = startIdx + 1;\n    for(int i = 0; i < countPaths; ++i) {\n        int polyLen = int(get_arg(idx));\n        idx += 1;\n        // ------ inner function, inlined here since it needs to update idx\n\n        float inner_d = 1e38;\n\n        float s = 1.0, md;\n        vec2 vj = vec2(get_arg(idx), get_arg(idx+1));\n        idx += 2;\n        vec2 vi;\n        int inters = 0;\n        //polyLen = 2;\n\n        for(int i = 0; i < polyLen; ++i)\n        {\n            int isCurve = int(get_arg(idx));\n            idx += 1;\n            if (isCurve == 0) {\n                vi = vec2(get_arg(idx), get_arg(idx+1));\n                idx += 2;\n    \n                vec2 e = vj - vi;\n                vec2 w = p - vi;\n                vec2 b = w - e*clamp( dot(w,e)/dot(e,e), 0.0, 1.0 );\n                md = dot(b,b);\n\n                // intersect with a ray from p parallel to x axis\n                float t = w.y/e.y;\n                float u = t*e.x - w.x;\n                if (t >= 0.0 && t <= 1.0 && u < 0.0)\n                    ++inters;\n            }\n            else {\n                vec2 prev_c = vec2(get_arg(idx), get_arg(idx+1));\n                vec2 cur_c = vec2(get_arg(idx+2), get_arg(idx+3));\n                vi = vec2(get_arg(idx+4), get_arg(idx+5));\n                idx += 6;\n\n                md = cubic_bezier_dis(p, vj, prev_c, cur_c, vi);\n                inters += cubic_bezier_sign(p, vj, prev_c, cur_c, vi);                     \n            }\n    \n            inner_d = min(inner_d, md);\n            vj = vi;\n        }\n        float sb = ((inters % 2) == 0)?1.0:-1.0;\n\n        float ret_d = sb*sqrt(inner_d);\n\n        // ------ \n        d = min(d, ret_d); // between polygons\n        \n    }\n    return d;\n}\n"),
e=this.args_for_multi_curves(a),l=new qn(new sn("multiPathWithCurves"),null,e,null,b),l.pass_first_arg_idx=!0):e=this.args_for_multipath(a):Sd(!1,this,"unsupposedted input object");null===l&&(b.add("multiPath","\nfloat sdPolygon(in vec2 p, int count, int idx)\n{\n    float d = 1e38;\n    float s = 1.0;\n    int lastIdx = idx+(count-1)*2;\n    vec2 vj = vec2(get_arg(lastIdx), get_arg(lastIdx+1));\n\n    for(int i = 0; i < count; ++i)\n    {\n        vec2 vi = vec2(get_arg(idx), get_arg(idx+1));\n        idx += 2;\n\n        vec2 e = vj - vi;\n        vec2 w = p - vi;\n        vec2 b = w - e*clamp( dot(w,e)/dot(e,e), 0.0, 1.0 );\n        d = min(d, dot(b,b));\n        bvec3 c = bvec3(p.y >= vi.y, p.y < vj.y, e.x*w.y > e.y*w.x);\n        if (all(c) || all(not(c))) \n            s*=-1.0;  \n        vj = vi;\n    }\n    return s*sqrt(d);\n}\n\nfloat multiPath(vec2 coord, int startIdx) {\n    int countPaths = int(get_arg(startIdx));\n    float d = 3.402823466e+38;\n    int idx = startIdx + 1;\n    for(int i = 0; i < countPaths; ++i) {\n        int polyLen = int(get_arg(idx));\n        idx += 1;\n        d = min(d, sdPolygon(coord, polyLen, idx));\n        idx += polyLen*2;\n    }\n    return d;\n}\n"),
l=new qn(new sn("multiPath"),null,e,null,b),l.pass_first_arg_idx=!0);l.inline_tr=!0;this.set_out_dfnode(l)}}function xn(a){let b="";for(let l of a)b+=l+", ";return b}class yn extends rn{constructor(a,b){super();this.func_name=a;this.init_val=b}make_func(a,b){const l=b.length;if(1===l)return b[0];let e="";for(let f=0;f<l-2;++f)e+=this.func_name+"("+xn(a)+b[f]+", ";e+=this.func_name+"("+xn(a)+b[l-2]+", "+b[l-1];return e+=")".repeat(l-1)}get_init_val(){return this.init_val}}
class zn extends rn{make_func(a,b){return"("+b.join(" + ")+")"}get_init_val(){return 0}}
function An(a,b){let l=null,e=new Fj,f=[];switch(a){case 0:l=new yn("min",1E38);break;case 1:l=new yn("max",0);break;case 2:l=new zn;break;case 3:l=new yn("poly_smin",1E38);e.add("poly_smin","float poly_smin(float k, float d1, float d2) {\n    float h = clamp( 0.5 + 0.5*(d2-d1)/k, 0.0, 1.0 );\n    return mix( d2, d1, h ) - k*h*(1.0-h); \n}\n");f.push(b);break;case 4:l=new yn("exp_smin",1E38);e.add("exp_smin","float exp_smin(float k, float a, float b) {\n    k = 1.0/k;\n    float res = exp2( -k*a ) + exp2( -k*b );\n    return -log2( res )/k;\n}\n");f.push(b);
break;default:Sd(!1,this,"unexpected operator")}return[l,e,f]}
class Bn extends rn{constructor(a,b,l,e,f=null){super();this.sitem=a;this.funcs=b;this.uniform_decls=l;this.uniform_values=e;if(null!==f){this.imgs=[];for(let h of f)this.imgs.push(new Ld(h,null))}else this.imgs=null}make_func(a,b,l){(a=this.sitem.need_input_evaler("in_fields"))&&a.dyn_set_obj(b);if(null!==this.imgs&&(a=this.sitem.need_input_evaler("in_texi"))){var e=l.alloc_tex_slots(this.imgs);a.dyn_set_obj(e)}e=new Cm;e.inline_str=this.sitem.eto_glsl(e);Id(null!==e.inline_str,"unexpected expression null");
l.func_set.extend(this.funcs);a="expr_func_"+l.alloc_var();let f="";for(var h of b)f+=", float "+h;h="float "+a+"(vec2 coord"+f+") {\n"+(e.inline_str+"\n");h+="}\n";for(let g of this.uniform_decls)l.func_set.add("#uniform|"+g,g);l.func_set.add(a,h);for(let g in this.uniform_values)l.uniform_values.add(g,this.uniform_values[g]);l="";for(let g of b)l+=", "+g;return a+"(coord"+l+")"}}
class Cn extends yj{constructor(a,b){super();Ah(1==b.length,"wrong number of subscripts");this.sub=b[0];this.objref=a}consumes_subscript(){return!0}eval(){Ah(!1,"text evaluator can't be evaled",this.line_num)}check_type(){return 1}clear_types_cache(){}to_glsl(){Ah(null!==this.objref.obj,"object not set",this.line_num);let a=this.objref.obj[this.sub];Ah(void 0!==a,"subscript not found "+this.sub,this.line_num);return a}}
class Dn{constructor(a){this.e=a.e;this.parse_opt=a.parse_opt;this.need_inputs=a.need_inputs}need_input_evaler(a){if(void 0===this.need_inputs||null===this.need_inputs)return null;a=this.need_inputs[a];return void 0===a?null:a}eto_glsl(a){return zh.do_to_glsl(this.e,a,this.parse_opt)}oclone(){return this}}
class En extends tn{static name(){return"Field Combine"}constructor(a){super(a);this.in_df_objs=new Xd(a,"in_fields");this.out=new Td(a,"out_field");a.set_state_evaluators({coord:(b,l)=>new Nk(b,l,"coord",["x","y"],12),in_fields:(b,l)=>new Cn(b,l)});this.op=new Ti(a,"Operator",0,"Min (union);Max (intersect);Sum;Smooth-min (poly);Smooth-min (exp);Function".split(";"),b=>{this.radius.set_visible(3===b||4===b);this.dist_func.set_visible(5===b)});this.radius=new Gh(a,"Radius",.25,{enabled:!0});this.dist_func=
new Gh(a,"Distance\nFunction","length(coord) - 1",{show_code:!0});this.sorted_order=[];kk(a,this,this.sorted_order,this.in_df_objs)}make_dist_func(a){var b=this.dist_func.get_active_item();const l=new Dn(b);var e=l.need_input_evaler("in_fields");if(e){const f=[];for(let h=0;h<a.length;++h)f[h]="###dummy_name_"+h;e.dyn_set_obj(f)}e=new Cm;try{e.inline_str=b.eto_glsl(e)}catch(f){Sd(!1,this,f.message)}Sd(null!==e.inline_str,this,"unexpected expression null");b={};e.set_uniform_vars_to_obj(b);return new qn(new Bn(l,
e.add_funcs,e.uniform_decls,b,[]),null,null,a,null)}run(){var a=this.in_df_objs.get_input_consts();5!==this.op.sel_idx&&Sd(0<a.length,this,"No inputs");const b=[];for(let l=0;l<a.length;++l){const e=a[this.sorted_order[l]];Sd(e.constructor===tm,this,"Input object is not a Distance Field");b.push(e.dfnode)}if(5!==this.op.sel_idx){const [l,e,f]=An(this.op.sel_idx,this.radius.get_value());a=new qn(l,null,f,b,e)}else a=this.make_dist_func(b);a.inline_tr=!0;this.set_out_dfnode(a)}}
class Fn extends pn{constructor(a,b,l,e,f){super();this.child=a;this.inv_tr=this.tr=null;this.tr_lst=b;this.combiner_maker=l;this.combiner_args=e;this.combiner_funcs=f}make_text(a){const b="v"+a.alloc_var(),[l,e]=this.child.make_text(a);let f=[];for(var h=0;h<this.combiner_args.length;++h)f.push("get_arg("+a.args_arr.length+")");a.args_arr.push(...this.combiner_args);a.func_set.extend(this.combiner_funcs);var g=Qh.create();h=a.args_arr.length;a.args_arr.push(this.tr_lst.length);for(var m of this.tr_lst)Qh.invert(g,
m),null!==this.inv_tr&&Qh.multiply(g,g,this.inv_tr),a.args_arr.push(g[0],g[1],g[3],g[4],g[6],g[7]);m="in_coord"+a.alloc_var();a="in_count"+a.alloc_var();g=this.combiner_maker.get_init_val();if(Number.isInteger(g)){const q=g+".0";g=q.includes("e")?""+g:q}else g=""+g;g="float "+b+" = "+g+";\nvec2 "+(m+" = coord;\nint ")+(a+" = int(get_arg("+h+"));");h++;g+="for(int i = 0; i < "+a+"; ++i) {\n";g+="  int tr_idx = i*6 + "+h+";\n";g+="  mat3x2 tr = mat3x2(get_arg(tr_idx), get_arg(tr_idx+1), get_arg(tr_idx+2), get_arg(tr_idx+3), get_arg(tr_idx+4), get_arg(tr_idx+5));\n";
g=g+("  coord = tr * vec3("+m+", 1.0);\n")+e;g+="  "+b+" = "+this.combiner_maker.make_func(f,[b,l])+";\n";g+="}\n";return[b,g]}}
class Gn extends ok(tn){static name(){return"Field Copy"}constructor(a){super(a);this.in_df_obj=new Rd(a,"in_field");this.out=new Td(a,"out_field");this.op=new Ti(a,"Operator",0,["Min (union)","Max (intersect)","Sum","Smooth-min"],b=>{this.radius.set_visible(3===b)});this.radius=new Gh(a,"Radius",.25,{enabled:!0});this.add_terminal_and_params(a)}run(){var a=this.in_df_obj.get_const();Sd(null!==a,this,"No input object to copy");Sd(a.constructor===tm,this,"input is not DistanceField");const [b,l]=this.get_meta_target();
var e=this.get_index_wrap();const [f,h,g]=An(this.op.sel_idx,this.radius.get_value());a=a.dfnode;const m=[];for(let q=0;q<b;++q){e[0]=q;null!==l&&l.dyn_set_prop_index(q);const r=this.transform.dyn_eval();m.push(r)}e=new Fn(a,m,f,g,h);this.set_out_dfnode(e)}}class Hn extends Nk{to_glsl_mutate_args(a,b){a=this.objref.obj;Id(null!==a,"texi offset not set");Id(Number.isInteger(a),"texi offset expected to be int");b[0]+=" + "+a+".0";return this.name}}
class In extends tn{static name(){return"Field Image"}constructor(a){super(a);this.in_texs=new Xd(a,"in_texs");this.out=new Td(a,"out_field");a.set_state_evaluators({coord:(b,l)=>new Nk(b,l,"coord",["x","y"],12),in_texi:(b,l)=>new Hn(b,l,"in_texi",[],21,Pk)});this.dist_func=new Gh(a,"Distance\nFunction","in_texi(0,coord).r",{show_code:!0});this.sorted_order=[];kk(a,this,this.sorted_order,this.in_texs)}run(){var a=this.in_texs.get_input_consts(),b=this.dist_func.get_active_item(),l=new Dn(b),e=l.need_input_evaler("in_texi");
e&&e.dyn_set_obj(0);e=new Cm;try{e.inline_str=b.eto_glsl(e)}catch(f){Sd(!1,this,f.message)}Sd(null!==e.inline_str,this,"unexpected expression null");b=[];for(let f of this.sorted_order)b.push(a[f]);a={};e.set_uniform_vars_to_obj(a);l=new qn(new Bn(l,null,e.uniform_decls,a,b),null,null,null,null);l.inline_tr=!0;this.set_out_dfnode(l)}}
class Jn extends ye{static name(){return"Marching Squares"}constructor(a){super(a);this.in_df_obj=new Rd(a,"in_field");this.out=new Td(a,"out_paths");a.set_state_evaluators({index:(b,l)=>new bk(b,l)});this.alg=new Ti(a,"Algorithm",0,["Square Marching","Po-Trace"]);this.thresh=new Gh(a,"First Iso",0,{enabled:!0,min:-1,max:1});this.count=new Hh(a,"Iso Count",1,{enabled:!0,min:1,max:20},b=>{this.step.set_enable(1<b)});this.step=new Gh(a,"Iso Step",.2,{enabled:!0,min:-.4,max:.4});this.res=new Lh(a,"Resolution",
256,256);this.size=new Jh(a,"Size",2,2);this.flip_sign=new qh(a,"Flip sign",!0);this.transform=new Ph(a,"Transform")}async values_from_df(a,b,l,e,f,h,g){b=new Hk(b,l,e,f,!1,"pad","float");b.transform(h);a=await a.get_pixels_for_fb(b);if(0>g)for(g=a.length,h=0;h<g;++h)a[h]=-a[h];return a}values_test_func(a,b,l,e,f,h){const g=Ff.fromValues(-l/2,-e/2);var m=Ff.fromValues(-l/2,e/2);e=Ff.fromValues(l/2,-e/2);Ff.transformMat3(g,g,f);Ff.transformMat3(m,m,f);Ff.transformMat3(e,e,f);f=Ff.create();l=Ff.create();
Ff.subtract(f,e,g);Ff.subtract(l,m,g);f[0]/=a-1;f[1]/=a-1;l[0]/=b-1;l[1]/=b-1;m=new Float32Array(a*b);e=0;for(let q=0;q<b;++q)for(let r=0;r<a;++r){const B=f[0]*r+l[0]*q+g[0],D=f[1]*r+l[1]*q+g[1];m[e]=h*(Math.sqrt(B*B+D*D)-1);e++}return m}run_square_march(a,b,l,e){const f=[];for(let h of b)f.push(h.thresh);b=d3.contours();b.size([l,e]);b.smooth(!0);return b.thresholds(f)(a)}make_face_idxf(a,b){if(1==b)return Array(a.length).fill(0);const l=[];for(let e of a)l.push(e/(b-1));return l}square_march(a,
b,l,e,f,h,g){var m=this.run_square_march(a,b,l,e);const q=Ff.create();a=[];const r=[],B=[];let D=0;for(let F of m){for(let G of F.coordinates){let N=0;for(let T of G){const V=a.length/2;for(let E of T)m=E,q[0]=(m[0]-.5)/(l-1)*f-f/2,q[1]=(m[1]-.5)/(e-1)*h-h/2,Ff.transformMat3(q,q,g),a.push(q[0],q[1]);r.push(V,a.length/2,1|N);B.push(b[D].index);N=2}}++D}b=this.make_face_idxf(B,b.length);l=new Uj;l.set("vtx_pos",new di(a),2);l.paths_ranges=r;l.set("face_index",new Uint32Array(B),1);l.set("face_indexf",
new Float32Array(b),1);return l}potrace_res_to_obj(a,b,l,e,f,h,g){function m(T,V){T[0]=(V.x-.5)/(b-1)*e-e/2;T[1]=(V.y-.5)/(l-1)*f-f/2;Ff.transformMat3(T,T,h)}const q=[],r=[],B=[],D=[],F=[];var G=Ff.create();const N=Ff.create();for(let T of a){a=T.curve;const V=q.length/2;m(G,a.c[3*(a.n-1)+2]);let E=G[0],Q=G[1];for(let aa=0;aa<a.n;++aa)"CURVE"===a.tag[aa]?(m(G,a.c[3*aa+2]),q.push(G[0],G[1]),m(N,a.c[3*aa+1]),B.push(N[0]-G[0],N[1]-G[1]),m(N,a.c[3*aa]),D.push(N[0]-E,N[1]-Q),E=G[0],Q=G[1]):"CORNER"==a.tag[aa]?
(m(G,a.c[3*aa+1]),m(N,a.c[3*aa+2]),q.push(G[0],G[1],N[0],N[1]),B.push(0,0,0,0),D.push(0,0,0,0),E=N[0],Q=N[1]):Sd(!1,this,"unexpected tag");r.push(V,q.length/2,1|T.flag);F.push(T.cont_index)}g=this.make_face_idxf(F,g);G=new Uj;G.set("vtx_pos",new di(q),2);G.set("ctrl_to_prev",new di(B),2);G.set("ctrl_from_prev",new di(D),2);G.set("face_index",new Uint32Array(F),1);G.set("face_indexf",new Float32Array(g),1);G.paths_ranges=r;return G}potrace(a,b,l,e,f,h,g){const m=new Uint8Array(l*e);var q=l*e,r=b.length;
for(let B=0;B<q;++B){const D=a[B];let F=b.length;for(let G=0;G<r;++G)if(D<b[G].thresh){F=G;break}m[B]=F}a=[];for(let B in b){vc.setBm(m,l,e,parseInt(B)+1);q=vc.process();r=0;for(let D of q)D.cont_index=b[parseInt(B)].index,D.flag=r,a.push(D),r=2;vc.clear()}return this.potrace_res_to_obj(a,l,e,f,h,g,b.length)}make_thresholds(a){const b=this.step.need_input_evaler("index");let l=[0];null!==b&&b.dyn_set_obj(l);let e=[],f=this.step.v;for(let h=0;h<this.count.v;++h)null!==b&&(l[0]=h,f=this.step.dyn_eval()),
e.push({thresh:(this.thresh.v+h*f)*a,index:h});return e=e.sort((h,g)=>h.thresh-g.thresh)}async run(){var a=this.in_df_obj.get_const();Sd(null!==a&&a.constructor===tm,this,"Missing input distance field");const b=this.res.x,l=this.res.y,e=this.size.x,f=this.size.y,h=this.transform.v;var g=this.flip_sign.v?-1:1;a=await this.values_from_df(a,b,l,e,f,h,g);let m;g=this.make_thresholds(g);0===this.alg.sel_idx?m=this.square_march(a,g,b,l,e,f,h):1===this.alg.sel_idx&&(m=this.potrace(a,g,b,l,e,f,h));this.out.set(m)}draw_selection(a){this.transform.draw_dial_at_obj(null,
a);this.size.size_dial_draw(this.transform.v,a);var b=this.size.x;const l=this.size.y,e=Ff.fromValues(-b/2,-l/2);b=Ff.fromValues(b/2,l/2);Dk(e,b,a,this.transform.v,"#000")}image_find_obj(a){return this.transform.dial.find_obj(a)||this.size.size_dial_find_obj(a)}}
class Kn extends ye{static name(){return"Pick One"}constructor(a){super(a);this.sorted_order=[];this.in_m=new Xd(a,"in_multi");this.out=new Td(a,"out");this.pick_expr=new Hh(a,"Pick Index","(frame_num == 0) ? 0 : 1",{show_code:!0});kk(a,this,this.sorted_order,this.in_m);this.last_line_picked=null}is_picking_lines(){return!0}pick_lines(a){Sd(a===this.in_m,this,"Unexpected terminal in pick_lines");Sd(0<this.in_m.lines.length,this,"No inputs");this.pick_expr.resolve_variables(this.vars_in.my_vsb,!0,
!1);this.pick_expr.resolve_variables(this.vars_in.my_vsb,!1,!0);a=this.pick_expr.get_value();Sd(-1<=a&&a<this.in_m.lines.length,this,"Index out of range "+a);if(-1===a)return Sd(null!==this.out.get_const(),this,"pick result is -1 but no previous output exists"),this.last_line_picked=null,[];this.last_line_picked=a=this.in_m.lines[this.sorted_order[a]];return[a]}should_clear_out_before_run(){return null!==this.last_line_picked}run(){if(null!==this.last_line_picked){var a=this.last_line_picked;this.last_line_picked=
null;od(a);a=a.to_term.get_const();this.out.set(a)}}}
class Ln extends ye{static name(){return"Change Filter"}constructor(a){super(a);this.in=new Rd(a,"in");this.out=new Td(a,"out");this.enabled=new qh(a,"Filter Enabled",!0,b=>{this.change_expr.enabled=b});this.change_expr=new Hh(a,"Change Expr","frame_num",{show_code:!0})}should_clear_out_before_run(){return!1}is_dirty_override(){return this.enabled.get_value()?null===this.out.get_const()||this.change_expr.pis_dirty()?!0:!1:null}run(){if(!this.enabled.get_value()||null===this.out.get_const()||this.change_expr.pis_dirty()){var a=
this.in.get_const();Sd(null!==a,this,"No input");this.out.set(a)}}}class jf extends ye{constructor(a){super(a);a.can_display=!1;a.can_run_on_select=!1}entered(){}exiting(){}get_anim_traits(){Id(!1,"unimplemented")}want_flow_hijack(){Id(!1,"unimplemented")}run(){}}class Mn extends Rd{constructor(a,b){super(a,b);this.kind=2;this.color="#ACFFEC"}is_dirty(){return!1}}
class Nn extends Td{constructor(a,b){super(a,b);this.kind=2;this.color="#ACFFEC"}pre_add_line_hook(){const a=[...this.lines];for(let b of a)dd.delete_line(b,!1)}}class On{constructor(){this.next=!1;this.frame_rate=-1;this.render=!0;this.blocking_frames=1;this.jump_here=!1}}
class Pn extends jf{static name(){return"Flow Event"}constructor(a){super(a);a.can_enable=!0;this.start=new Nn(a,"start");this.type=new Ti(a,"On Event",2,["Manual Condition","Any Input Variable","Frame-num At"],b=>{this.on_manual.set_visible(0==b);this.on_framenum.set_visible(2==b)});this.on_manual=new qh(a,"Trigger",!1,null,{pulse_btn:!0});this.on_framenum=new Hh(a,"Frame-Num",0,{allowed_code:!1,allowed:!1});this.traits=new On;this.traits.next=!0;this.current_trigger_value=null}toggle_enable_flag(){this.node.of_program.anim_flow.toggle_event_node(this.node)}get_anim_traits(){return this.traits}clear_flow_hijack(){this.current_trigger_value=
!1}want_flow_hijack(){return this.current_trigger_value}run(){switch(this.type.sel_idx){case 0:this.current_trigger_value=this.on_manual.get_value();break;case 1:this.current_trigger_value=this.vars_in.is_dirty();break;case 2:this.current_trigger_value=tg.frame_num_box.vbget()==this.on_framenum.get_value()}}}
class Qn extends jf{static name(){return"Flow Span"}constructor(a){super(a);this.prev=new Mn(a,"previous");this.next=new Nn(a,"next");this.frame_rate=new Ti(a,"Frame Rate",0,[["Normal",-1],["Maximum",-2]],b=>{this.blocking_frames.set_visible(1===b)});this.blocking_frames=new Hh(a,"Block Frames",1);this.render=new qh(a,"Render",!0);this.stop_at=new Ti(a,"Stop",0,["Never","Frame Count","Condition"],b=>{this.stop_at_count.set_visible(1===b)});this.stop_at_count=new Hh(a,"After Count",0);this.traits=
new On;this.first_frame=null}entered(){this.first_frame=null}get_anim_traits(){if(1===this.stop_at.sel_idx){var a=tg.frame_num_box.v;if(null===this.first_frame)this.first_frame=a;else{const b=this.stop_at_count.get_value();if(a-this.first_frame>=b)return this.traits.next=!0,this.traits}}this.traits.frame_rate=this.frame_rate.get_sel_val();-2===this.traits.frame_rate&&(a=this.blocking_frames.get_value(),Sd(1<=a,this,"Block Frames can't be less than 1"),this.traits.blocking_frames=a);this.traits.render=
this.render.get_value();this.traits.next=!1;this.traits.blocking_frames=1;return this.traits}}
class Rn extends Pj{static name(){return"Flow Set Variable"}constructor(a){super(a);a.can_display=!1;a.can_run_on_select=!1;this.prev=new Mn(a,"previous");this.next=new Nn(a,"next");this.can_enable=!1;this.global_checkbox_override=b=>{this.node.enable_active!==b&&this.node.of_program.set_glob_var_node(this.node,!0,b)};this.next_traits=new On;this.next_traits.next=!0;this.cur_traits=null;this.flowing=!1}get_anim_traits(){return this.next_traits}entered(){this.flowing=!0;this.node.set_self_dirty()}exiting(){this.flowing=
!1;this.node.set_self_dirty()}run(){this.set_only_if_missing=!1;this.flowing||(this.set_only_if_missing=!0);super.run()}}class Sn{constructor(a){this.obj=this.def=null;this.cnode_id=a}}class Tn{constructor(a){this.def=this.name=null;this.fixtures=[];this.obj=null;this.cnode_id=a;this.t_mat=this.index=null;this.on_init_params=[]}getPos(){return null!==this.obj?this.obj.GetPosition():this.def.position}getAngle(){return null!==this.obj?this.obj.GetAngle():this.def.angle}}
class Un{constructor(a){this.obj=this.init_call=this.body_refB=this.body_refA=this.def=null;this.cnode_id=a}}
class Vn extends yd{constructor(){super();this.bodies=[];this.joints=[];this.cnode_to_obj=[];this.p_draw_world_cache=null}add_body(){for(let a of arguments)this.cnode_to_obj[a.cnode_id]=a,this.bodies.push(a)}add_joint(){for(let a of arguments)this.cnode_to_obj[a.cnode_id]=a,this.joints.push(a)}ensure_world_cache(){null===this.p_draw_world_cache&&(this.p_draw_world_cache=Wn(this,[0,0],!1))}draw_m(a,b){this.ensure_world_cache();this.p_draw_world_cache.draw_mw(b)}draw_template_m(a){this.ensure_world_cache();
this.p_draw_world_cache.draw_template_m(a)}can_draw_shadow(){return!0}draw_shadow_m(){this.ensure_world_cache();this.p_draw_world_cache.draw_shadow_m()}}
class Xn extends yd{static name(){return"Physics World"}constructor(){super();this.obj=null;this.bodies=[];this.cnode_to_obj=[];this.p_draw_template=this.p_draw_shadow=this.p_draw_debug=null}clone(){Sd(!1,this,"World object can't be cloned")}do_draw(a,b){b.SetFlags(a);b.ctx.lineWidth=1/rf.viewport_zoom;this.obj.SetDebugDraw(b);this.obj.DebugDraw()}draw_mw(){null===this.p_draw_debug&&(this.p_draw_debug=new Yn(zd));let a;a=0|b2.DrawFlags.e_shapeBit;a|=b2.DrawFlags.e_jointBit;this.do_draw(a,this.p_draw_debug)}draw_m(a,
b){Zn.add(this);this.draw_mw(b,this)}draw_template_m(){null===this.p_draw_template&&(this.p_draw_template=new Yn(zd),this.p_draw_template.set_color_template(!0));this.do_draw(b2.DrawFlags.e_shapeBit|b2.DrawFlags.e_jointBit,this.p_draw_template)}can_draw_shadow(){return!0}draw_shadow_m(){null===this.p_draw_shadow&&(this.p_draw_shadow=new Yn(Bd),this.p_draw_shadow.set_color_from_shape(!0));this.do_draw(b2.DrawFlags.e_shapeBit,this.p_draw_shadow)}}function $n(a){return new b2.Vec2(a[0],a[1])}
function ao(a,b,l,e=null){return function(f){for(let h of Zn){const g=h.cnode_to_obj[b];void 0!==g&&("string"!==typeof a?a(h,f,g):(Id(void 0!==g.obj[a],"object missing function "+a),null!==e&&(f=e(f)),g.obj[a](f)))}l&&l(f)}}class bo extends Gh{constructor(a,b,l,e,f,h=""){super(a,b,l,e,ao(f,a.id+h,null))}}class co extends bo{constructor(a,b,l,e,f,h=""){null===e&&(e={});e.validate=g=>{null!==g&&Sd(0<=g,a.cls,"Can't be negative")};super(a,b,l,e,f,h)}}
class eo extends qh{constructor(a,b,l,e,f=null,h=""){super(a,b,l,ao(e,a.id+h,f))}}class fo extends Jh{constructor(a,b,l,e,f,h=null,g=""){super(a,b,l,e,null,ao(f,a.id+g,h,$n))}}class go extends Ph{constructor(a,b,l,e=""){super(a,b,l,{b2_style:!0},ao(f=>{f.cnode_to_obj[a.id].obj.SetTransformXY(this.translate[0],this.translate[1],Sh.toRadian(this.rotate))},a.id+e,null))}}function ho(a,b,l){const e=new b2.PolygonShape;e.SetAsBox(.5*Math.abs(a),.5*Math.abs(b),l,0);return e}
class io extends ye{static name(){return"Physics Body"}constructor(a){super(a);this.out=new Td(a,"b2_defs");this.type=new Ti(a,"Type",0,[["Static",b2.staticBody],["Kinematic",b2.kinematicBody],["Dynamic",b2.dynamicBody]],b=>{this.kin_lin_velocity.set_visible(1==b);this.kin_ang_velocity.set_visible(1==b);this._sep2.set_visible(1==b)});this.shape=new Ti(a,"Shape",0,["Box","Circle"],b=>{this.size.set_visible(0===b);this.radius.set_visible(1===b)});this.size=new fo(a,"Size(m)",.5,.5,(b,l,e)=>{l=ho(l[0],
l[1],this.get_shape_pivot());b=b.cnode_to_obj[a.id+"_f"];void 0!==b&&(b.obj.m_shape=l);e.obj.SetAwake(!0)});this.radius=new co(a,"Radius(m)",.5,{min:0,max:1},(b,l,e)=>{b=b.cnode_to_obj[a.id+"_f"];void 0!==b&&(b.obj.m_shape.m_radius=l);e.obj.SetAwake(!0)});this._sep1=new mh(a,"_sep1");this.kin_lin_velocity=new fo(a,"Linear V(m/s)",0,0,"SetLinearVelocity");this.kin_ang_velocity=new bo(a,"Angular V(r/s)",0,{min:-90,max:90},"SetAngularVelocity");this._sep2=new mh(a,"_sep2");this.density=new bo(a,"Density(kg)",
1,{min:0,max:10},(b,l,e)=>{b=b.cnode_to_obj[a.id+"_f"];void 0!==b&&b.obj.SetDensity(l);e.obj.ResetMassData()});this.restit=new bo(a,"Restitution",.1,{min:0,max:1},"SetRestitution","_f");this.friction=new bo(a,"Friction",.1,{min:0,max:1},"SetFriction","_f");this.transform=new go(a,"Transform",{});this.radius_dial=new Th(b=>{this.radius.increment(b)})}get_shape_pivot(){return new b2.Vec2(-this.transform.rotate_pivot[0],-this.transform.rotate_pivot[1])}run(){const a=new Tn(this.node.id);a.name=this.node.name;
a.def=new b2.BodyDef;a.def.type=this.type.get_sel_val();a.def.position.Set(this.transform.translate[0],this.transform.translate[1]);a.def.angle=Sh.toRadian(this.transform.rotate);a.t_mat=Qh.copy(Qh.create(),this.transform.v);var b=null,l=this.get_shape_pivot();0===this.shape.sel_idx?b=ho(this.size.x,this.size.y,l):1===this.shape.sel_idx?(b=new b2.CircleShape(this.radius.v),b.Set(l)):Sd(!1,node,"not supported");l=new Sn(this.node.id+"_f");l.def=new b2.FixtureDef;l.def.shape=b;l.def.density=this.density.v;
l.def.restitution=this.restit.v;l.def.friction=this.friction.v;l.def.userData={node_id:this.node.id};a.fixtures.push(l);1===this.type.sel_idx&&a.on_init_params.push(this.kin_lin_velocity,this.kin_ang_velocity);b=new Vn;b.add_body(a);this.out.set(b)}dials_hidden(){0<Zn.length}draw_selection(a){this.dials_hidden()||(this.transform.draw_dial_at_obj(null,a),this.size.pis_visible()&&this.size.size_dial_draw(this.transform.v,a),this.radius.pis_visible()&&this.radius_dial.draw(this.radius.v,0,this.transform.v,
a))}image_find_obj(a){if(this.dials_hidden())return null;if(this.radius.pis_visible()){var b=this.radius_dial.find_obj(a);if(b)return b}return(b=this.transform.dial.find_obj(a))||this.size.pis_visible()&&(b=this.size.size_dial_find_obj(a))?b:null}img_hit_find_obj(){return new jo(this.node)}}
class jo{constructor(a){this.node=a;this.joint=null;this.target=new b2.Vec2;this.with_world=null}mousemovable(){const [a]=this.get_dynamic_obj();return null!==a}mousemove(a){null!==this.joint&&(a=rf.epnt_to_model(a.ex,a.ey),this.target.x=a[0],this.target.y=a[1],this.joint.SetTarget(this.target))}mouseup(){null!==this.joint&&(this.with_world.obj.DestroyJoint(this.joint),this.with_world=this.joint=null)}get_dynamic_obj(){0<Zn.length;return[null,null]}mousedown(a){this.node.select();const [b,l]=this.get_dynamic_obj();
if(null!==b){var e=new b2.MouseJointDef;e.bodyB=b.obj;e.bodyA=b.obj;a=rf.epnt_to_model(a.ex,a.ey);this.target.x=a[0];this.target.y=a[1];e.target=this.target;e.maxForce=100*b.obj.GetMass();b2.LinearStiffness(e,5,.7,e.bodyA,e.bodyB);this.joint=l.obj.CreateJoint(e);this.with_world=l}}}
class ko extends ye{static name(){return"Physics Joint"}constructor(a){super(a);this.inA=new Rd(a,"in_bodyA");this.inB=new Rd(a,"in_bodyB");this.out=new Td(a,"b2_defs");const b=()=>{var l=this.rel_anchor.get_value();this.anchor.set_visible(0===this.type.sel_idx&&!l);l=1===this.type.sel_idx||0===this.type.sel_idx&&l;this.anchorA.set_visible(l);this.anchorB.set_visible(l)};this.type=new Ti(a,"Type",0,["Revolute","Distance"],l=>{this.enableMotor.set_visible(0===l);this.motorSpeed.set_visible(0===l);
this.maxTorque.set_visible(0===l);this.rel_anchor.set_visible(0===l);b();this.collideConnected.set_visible(1===l);this.damping.set_visible(1===l);this.min_len.set_visible(1===l);this.max_len.set_visible(1===l)});this.rel_anchor=new qh(a,"Body-Relative Anchors",!1,()=>{b()});this.anchor=new Jh(a,"Anchor",0,0,null,()=>{});this.anchorA=new fo(a,"Anchor A",0,0,(l,e,f)=>{f.obj.m_localAnchorA=$n(e);this.online_awake_objects(l)});this.anchorB=new fo(a,"Anchor B",0,0,(l,e,f)=>{f.obj.m_localAnchorB=$n(e);
this.online_awake_objects(l)});this.enableMotor=new eo(a,"Motor",!1,"EnableMotor",l=>{this.motorSpeed.set_enable(l);this.maxTorque.set_enable(l)});this.motorSpeed=new bo(a,"Motor Speed(r/s)",.5,{min:-6,max:6},"SetMotorSpeed");this.maxTorque=new bo(a,"Max Torque(N/m)",10,{min:0,max:10},"SetMaxMotorTorque");this.anchor.dial=new Th((l,e)=>{this.anchor.increment(Ff.fromValues(l,e))});this.collideConnected=new eo(a,"Collide Connected",!1,(l,e,f)=>{f.obj.m_collideConnected=e});this.damping=new bo(a,"Damping",
.2,{min:0,max:1},(l,e,f)=>{if(null!==this.last_A_def&&null!==this.last_B_def){var h=l.cnode_to_obj[this.last_A_def.cnode_id];l=l.cnode_to_obj[this.last_B_def.cnode_id];if(void 0!==h&&void 0!==l){var g={};b2.LinearStiffness(g,1,e,h.obj,l.obj);f.obj.SetStiffness(g.stiffness);f.obj.SetDamping(g.damping)}}});this.min_len=new co(a,"Min Length",.1,{min:0,max:2},(l,e,f)=>{f.obj.SetMinLength(f.obj.GetLength()-e)});this.max_len=new co(a,"Max Length",.1,{min:0,max:2},(l,e,f)=>{f.obj.SetMaxLength(f.obj.GetLength()+
e)});this.anchorA.dial=new Th((l,e)=>{this.anchorA.increment(Ff.fromValues(l,e))},null);this.anchorA.member_body_def="last_A_def";this.anchorB.dial=new Th((l,e)=>{this.anchorB.increment(Ff.fromValues(l,e))},null);this.anchorB.member_body_def="last_B_def";this.dialed_params=[this.anchor,this.anchorA,this.anchorB];this.last_B_def=this.last_A_def=null}online_awake_objects(a){if(null!==this.last_A_def){const b=a.cnode_to_obj[this.last_A_def.cnode_id];void 0!==b&&b.obj.SetAwake(!0)}null!==this.last_B_def&&
(a=a.cnode_to_obj[this.last_B_def.cnode_id],void 0!==a&&a.obj.SetAwake(!0))}get_ab_anchors(a,b){const l=$n(this.anchorA.get_value());a.GetWorldPoint(l,l);a=$n(this.anchorB.get_value());b.GetWorldPoint(a,a);return[l,a]}run(){var a=this.inA.get_const();const b=this.inB.get_const();Sd(null!==a&&null!==b,this,"Missing input");Sd(a.constructor===Vn||!(1===a.bodies.length&&0===a.joints.length),this,"bodyA is not a physics body");Sd(b.constructor===Vn||!(1===b.bodies.length&&0===b.joints.length),this,"bodyB is not a physics body");
const l=new Un(this.node.id);l.body_refA=a.bodies[0];l.body_refB=b.bodies[0];this.last_A_def=l.body_refA;this.last_B_def=l.body_refB;0===this.type.sel_idx?(l.def=new b2.RevoluteJointDef,l.init_call=(e,f)=>{l.def.Initialize(e,f,$n(this.anchor.get_value()));this.rel_anchor.get_value()&&(l.def.localAnchorA=$n(this.anchorA.get_value()),l.def.localAnchorB=$n(this.anchorB.get_value()))},l.def.motorSpeed=this.motorSpeed.get_value(),l.def.enableMotor=this.enableMotor.get_value(),l.def.maxMotorTorque=this.maxTorque.get_value()):
1===this.type.sel_idx?(l.def=new b2.DistanceJointDef,l.def.collideConnected=this.collideConnected.get_value(),l.init_call=(e,f)=>{const [h,g]=this.get_ab_anchors(e,f);l.def.Initialize(e,f,h,g);b2.LinearStiffness(l.def,1,this.damping.get_value(),e,f);l.def.minLength-=this.min_len.get_value();l.def.maxLength+=this.max_len.get_value()}):Sd(!1,this,"Unexpected type");a=new Vn;a.add_body(l.body_refA,l.body_refB);a.add_joint(l);this.out.set(a)}dials_hidden(){0<Zn.length}draw_selection(a){if(!this.dials_hidden())for(let b of this.dialed_params)if(b.pis_visible()){let l=
null;if(void 0!==b.member_body_def){const e=this[b.member_body_def];null!==e&&(l=Qh.create(),Qh.translate(l,l,[e.def.position.x,e.def.position.y]),Qh.rotate(l,l,e.def.angle))}b.dial.draw(b.x,b.y,l,a)}}image_find_obj(a){if(this.dials_hidden())return null;for(let b of this.dialed_params)if(b.pis_visible()){const l=b.dial.find_obj(a);if(l)return l}return null}}
function Wn(a,b,l){const e=new Xn;e.obj=new b2.World(new b2.Vec2(b[0],b[1]));l&&Zn.add(e);b=0;for(var f of a.bodies)f.index=null;for(let h of a.bodies)if(null===h.index){h.index=b++;f=new Tn(h.cnode_id);e.bodies.push(f);e.cnode_to_obj[h.cnode_id]=f;f.def=h.def;f.obj=e.obj.CreateBody(f.def);for(let g of h.fixtures)l=new Sn,f.fixtures.push(l),l.def=g.def,l.obj=f.obj.CreateFixture(l.def),e.cnode_to_obj[g.cnode_id]=l;for(let g of h.on_init_params)g.call_change()}for(let h of a.joints)Id(null!==h.body_refA.index&&
null!==h.body_refB.index,"bodies not in world?"),a=new Un(h.cnode_id),e.cnode_to_obj[h.cnode_id]=a,a.def=h.def,a.body_refA=e.bodies[h.body_refA.index],a.body_refB=e.bodies[h.body_refB.index],h.init_call(a.body_refA.obj,a.body_refB.obj),a.obj=e.obj.CreateJoint(a.def);return e}
class lo extends ye{static name(){return"Physics Merge"}constructor(a){super(a);this.in_defs=new Xd(a,"b2_in_defs");this.out=new Td(a,"b2_defs")}run(){const a=this.in_defs.get_input_consts(),b=new Vn,l=new Set;for(let e of a){Sd(null!==e,this,"empty input");for(let f of e.bodies)l.has(f.cnode_id)||(b.add_body(f),l.add(f.cnode_id));b.add_joint(...e.joints)}this.out.set(b)}}var Zn=new Set;
class mo extends ye{static name(){return"Physics Simulator"}constructor(a){super(a);this.in=new Rd(a,"b2_in");this.out=new Td(a,"b2_world");this.gravity=new Jh(a,"Gravity",0,9.8)}run(){const a=this.in.get_const();Sd(null!==a,this,"no input");let b=a;a.constructor===Vn?b=Wn(a,this.gravity.get_value(),!0):Sd(a.constructor===Xn,this,"input not a defs or world");b.obj.Step(1/60,6,2);this.out.set(b)}}
class no extends qe{static name(){return"Extract Transform"}constructor(a){super(a);this.in_world=new Rd(a,"in_world");this.in_body=new Rd(a,"in_body");this.offset=new Jh(a,"Offset",0,0);this.offset.dial=new Th((b,l)=>{this.offset.increment(Ff.fromValues(b,l))});this.name=new oh(a,"Name","trans");this.last_tmat=null}run(){var a=this.in_body.get_const();Sd(null!==a,this,"missing in_body");Sd(a.constructor===Vn&&1===a.bodies.length,this,"in_body should be a single body definition");var b=this.in_world.get_const();
Sd(null!==b,this,"missing in_world");Sd(b.constructor===Xn||b.constructor===Vn,this,"in_world needs to be a B2World, it is "+b.constructor.name);var l=a.bodies[0];a=this.offset.get_value();var e=b.cnode_to_obj[l.cnode_id];Sd(void 0!==e,this,"Can't find body "+l.cnode_id);b=e.getPos();l=e.getAngle();e=Qh.create();Qh.translate(e,e,Ff.fromValues(b.x,b.y));Qh.rotate(e,e,l);this.last_tmat=Qh.create();Qh.copy(this.last_tmat,e);Qh.translate(e,e,a);this.out_single_var(this.name.get_value(),13,e)}draw_selection(a){this.offset.dial.draw(this.offset.x,
this.offset.y,this.last_tmat,a)}image_find_obj(a){return this.offset.dial.find_obj(a)}}
class oo extends ye{static name(){return"Pen"}constructor(a){super(a);a.set_state_evaluators({index:(b,l)=>new bk(b,l)});this.in_obj=new Rd(a,"in_obj");this.out_obj=new Td(a,"out_obj");this.prop_store=new nh(a,"<obj-store>",{gen_id:1,ids_lst:[]},()=>{this.prop_prms.length=0;const b=[...this.prop_store.v.ids_lst];this.prop_store.v.ids_lst.length=0;for(let l of b)this.add_property(a,l);this.props_group.update_elems()});this.steps=new Hh(a,"Steps",1);this.enable=new qh(a,"Enable",!0,null,{expr_visible:!0});
this.pos=new Jh(a,"Position",0,0,{show_code:!0});this.min_dist=new Gh(a,"Min Distance",.05);this.first_sep=new mh(a,"first_sep","param_sep_line");this.props_group=new Xi(a,"vars_params");this.prop_prms=[];this.add_prm_btn=new Wi(a,"[+]",()=>{this.add_property(a,null);this.props_group.update_elems()},["param_btn","param_var_add_btn"]);this.prev_pos=null}add_property(a,b){null===b&&(b=this.prop_store.v.gen_id++);const l="p"+b+"_",e={id:b};this.prop_store.v.ids_lst.push(b);this.prop_prms.push(e);e.p_group=
new Xi(a,l+"group");e.p_group.set_group(this.props_group);e.type=new Ti(a,["Type",l],0,["Float","Float2","Color"],f=>{e.expr_float.set_visible(0===f);e.expr_vec2.set_visible(1===f);e.expr_color.set_visible(2===f)});e.bind_to=new Ti(a,["Bind To",l],0,[["Vertex","vtx_"],["Lines","line_"]]);e.bind_to.share_line_elem_from(e.type);e.remove_btn=new Wi(a,["[-]",l],()=>{se(this.prop_prms,e);xe(this.prop_store.v.ids_lst,e.id);for(let f of e.params)a.remove_param(f);this.props_group.update_elems();this.props_group.pset_dirty(!0)},
["param_btn","param_var_rm_btn"]);e.remove_btn.share_line_elem_from(e.type);e.name=new oh(a,["Name",l],"width");e.expr_float=new Gh(a,["Float",l],1,{show_code:!0});e.expr_vec2=new Jh(a,["Float2",l],0,0,{show_code:!0});e.expr_color=new Nh(a,["Color",l],"#cccccc",{show_code:!0});e.sep=new mh(a,l+"sep","param_sep_line");e.params=[e.p_group,e.type,e.bind_to,e.name,e.expr_float,e.expr_vec2,e.expr_color,e.sep,e.remove_btn];for(let f of e.params)f!==e.p_group&&(f.set_group(e.p_group),f.call_change());return e}add_vtx(){}run(){const a=
this.in_obj.get_mutable();Sd(null!==a,this,"Missing input");Sd(void 0!==a.add_vertex,this,"Expected a geometry object");if(this.enable.get_value()){var b=this.steps.get_value(),l=[0],e=this.pos.need_input_evaler("index");null!==e&&e.dyn_set_obj(l);e={};for(var f of this.prop_prms){var h=null;switch(f.type.sel_idx){case 0:h=f.expr_float;break;case 1:h=f.expr_vec2;break;case 2:h=f.expr_color;break;default:Sd(!1,this,"unexpected type")}const g=f.bind_to.get_sel_val()+f.name.get_value();e[g]=h;h=h.need_input_evaler("index");
null!==h&&h.dyn_set_obj(l)}f={};this.prev_pos=a.get_last_vertex();try{for(h=0;h<b;++h){l[0]=h;const g=this.pos.dyn_eval();if(null!==this.prev_pos){const m=this.min_dist.get_value();if(Ff.distance(this.prev_pos,g)<m)continue}this.prev_pos=g;for(let m in e)f[m]=e[m].dyn_eval();try{a.add_vertex(g,f)}catch(m){Sd(!1,this,m.message)}}}catch(g){Sd(!1,this,g.message)}}this.out_obj.set(a)}}
class Yn extends b2.Draw{constructor(a){super(a);this.ctx=a;this.col_from_shape=!1;this.last_shape_color=null;this.col_template=!1}set_color_from_shape(a){this.col_from_shape=a}set_color_template(a){this.col_template=a}NextShape(a){this.last_shape_color=Rc(a.node_id)}PushTransform(a){const b=this.ctx;b&&(b.save(),b.translate(a.p.x,a.p.y),b.rotate(a.q.GetAngle()))}PopTransform(){const a=this.ctx;a&&a.restore()}resolve_color(a,b){if(this.col_from_shape)return null===this.last_shape_color?"rgba(0,0,0,0)":
this.last_shape_color;null===b&&(b=a.a);return this.col_template?"rgba("+Gc[0]+","+Gc[1]+","+Gc[2]+","+b+")":a.MakeStyleString(b)}DrawPolygon(a,b,l){const e=this.ctx;if(e){e.beginPath();e.moveTo(a[0].x,a[0].y);for(let f=1;f<b;f++)e.lineTo(a[f].x,a[f].y);e.closePath();e.strokeStyle=this.resolve_color(l,1);e.stroke()}}DrawSolidPolygon(a,b,l){const e=this.ctx;if(e){e.beginPath();e.moveTo(a[0].x,a[0].y);for(let f=1;f<b;f++)e.lineTo(a[f].x,a[f].y);e.closePath();e.fillStyle=this.resolve_color(l,.5);e.fill();
e.strokeStyle=this.resolve_color(l,1);e.stroke()}}DrawCircle(a,b,l){const e=this.ctx;e&&(e.beginPath(),e.arc(a.x,a.y,b,0,2*b2.pi,!0),e.strokeStyle=this.resolve_color(l,1),e.stroke())}DrawSolidCircle(a,b,l,e){const f=this.ctx;if(!(0>b)&&f){const h=a.x;a=a.y;f.beginPath();f.arc(h,a,b,0,2*b2.pi,!0);f.moveTo(h,a);f.lineTo(h+l.x*b,a+l.y*b);f.fillStyle=this.resolve_color(e,.5);f.fill();f.strokeStyle=this.resolve_color(e,1);f.stroke()}}DrawParticles(a,b,l,e){const f=this.ctx;if(f)if(null!==l)for(var h=0;h<
e;++h){const g=a[h];f.fillStyle=l[h].MakeStyleString();f.beginPath();f.arc(g.x,g.y,b,0,2*b2.pi,!0);f.fill()}else for(f.fillStyle="rgba(255,255,255,0.5)",l=0;l<e;++l)h=a[l],f.beginPath(),f.arc(h.x,h.y,b,0,2*b2.pi,!0),f.fill()}DrawSegment(a,b,l){const e=this.ctx;e&&(e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(b.x,b.y),e.strokeStyle=this.resolve_color(l,1),e.stroke())}DrawTransform(a){const b=this.ctx;b&&(this.PushTransform(a),b.beginPath(),b.moveTo(0,0),b.lineTo(1,0),b.strokeStyle=b2.Color.RED.MakeStyleString(1),
b.stroke(),b.beginPath(),b.moveTo(0,0),b.lineTo(0,1),b.strokeStyle=b2.Color.GREEN.MakeStyleString(1),b.stroke(),this.PopTransform(a))}DrawPoint(a,b,l){const e=this.ctx;e&&(e.fillStyle=this.resolve_color(l,null),b/=rf.viewport_zoom,l=b/2,e.fillRect(a.x-l,a.y-l,b,b))}DrawAABB(a,b){const l=this.ctx;l&&(l.strokeStyle=this.resolve_color(b,null),l.strokeRect(a.lowerBound.x,a.lowerBound.y,a.upperBound.x-a.lowerBound.x,a.upperBound.y-a.lowerBound.y))}}
class po extends ye{static name(){return"HTTP Send"}constructor(a){super(a);this.in=new Rd(a,"input");this.out=new Td(a,"output");this.attr_name=new oh(a,"Attribute","face_color");this.uri=new oh(a,"URI","/post_data")}run(){const a=this.in.get_const();Sd(void 0!==a.arrs,this,"Object with no arrays");const b=a.arrs[this.attr_name.v];Sd(void 0!==b,this,"Object does not have attribute "+this.attr_name.v);const l=new XMLHttpRequest;l.open("POST",this.uri.v,!0);l.onload=()=>{};try{l.send(b)}catch(e){log.error("failed send "+
this.uri.v)}this.out.set(a)}}var Ff=glMatrix.vec2,Qh=glMatrix.mat3,Sh=glMatrix.glMatrix,Oh=glMatrix.vec4,Hj=glMatrix.vec3;Sh.setMatrixArrayType(Float64Array);var Lc,zd,Mc,Bd;const qo=["img/check_checked.png","img/check_int.png","img/check_none.png","img/red_ex.png","img/gray_ex.png"];var ro=[];function so(){for(var a of qo){let b=new Image;b.src=a;ro.push(b)}}var lm=null,nm=null;
function Xk(){if(null===lm){var a=De,b=document.createElement("DIV");b.innerHTML="<canvas id='scratch_canvas'></canvas>";b=b.firstChild;a.appendChild(b);lm=b;nm=lm.getContext("2d")}}function to(a,b){null!==a&&(uo.style.width=a+"px",sf.width=a);null!==b&&(sf.height=b);rf.resize_redraw()}function vo(a,b,l,e){null!==a&&(wo.style.width=a+"px",pf.width=a,Oe.width=a);wo.style.top=l+"px";wo.style.left=e+"px";gd()}function xo(a,b){null!==b&&(rk.style.height=b+"px")}
function yo(a,b){null!==b&&(Qe.style.height=b+"px",pf.height=b,Oe.height=b);gd()}var De=null,ld=null,uo=null,sf=null,Wk=null,Gf=null,zo=null,wo=null,rk=null,zg=null,Ig=null,Ao=null,Qe=null,pf=null,Oe=null;
class pj{constructor(){this.nodes=[];this.obj_map={};this.lines=[];this.display_node=null;this.names_indices={};this.next_eph_obj_id=this.next_obj_id=1;this.glob_var_nodes=[];this.tdisp_nodes=[];this.input_nodes=[];this.nodes_decor=[];this.anim_flow=new Bo}alloc_graphic_obj_id(){return this.next_obj_id++}alloc_ephemeral_obj_id(a){const b="e"+this.next_eph_obj_id++;this.obj_map[b]=a;return b}add_node(a,b,l,e,f){null===l&&(void 0===this.names_indices[e.name()]?this.names_indices[e.name()]=1:this.names_indices[e.name()]++,
l=e.name().toLowerCase().replace(/[\s-]/g,"_")+"_"+this.names_indices[e.name()]);null===f||void 0===f?f=this.alloc_graphic_obj_id():console.assert(void 0===this.obj_map[f],"node-id already exists");a=new ke(a,b,l,e,f,this);this.obj_map[a.id]=a;this.nodes.push(a);for(let h of a.terminals)h.tuid=this.alloc_ephemeral_obj_id(h);1===this.nodes.length&&0===a.nkind&&this.set_display_node(a);return a}delete_node(a,b){null!==a.is_selected_inf&&a.unselect();this.display_node==a&&dd.set_display_node(null);a.disp_template&&
dd.set_template_node(a,!1);a.receives_input&&dd.set_input_node(a,!1);a.enable_active&&a.cls.toggle_enable_flag(!1,!1);null!==Xe&&Xe.node_deleted(a);a.destructor&&a.destructor();se(this.nodes,a);delete this.obj_map[a.id];for(let l of a.terminals){for(;0<l.lines.length;)this.delete_line(l.lines[0],!1);delete this.obj_map[l.tuid]}b&&(gd(),le(!0))}add_line(a,b,l){this.lines.push(a);if(null===b||void 0===b)b=this.alloc_graphic_obj_id();a.uid=b;this.obj_map[b]=a;a.from_term.lines.push(a);a.to_term.lines.push(a);
try{a.to_term.get_attachee().tdid_connect(a)}catch(e){}a.to_term.tset_dirty(!0);l&&le(!0)}delete_line(a,b){try{a.to_term.get_attachee().tdoing_disconnect(a)}catch(l){}se(a.from_term.lines,a);se(a.to_term.lines,a);a.to_term.clear();a.to_term.tset_dirty(!0);se(this.lines,a);delete this.obj_map[a.uid];try{a.to_term.get_attachee().tdid_disconnect(a)}catch(l){}b&&(gd(),le(!0))}delete_lines_of(a){for(;0<a.lines.length;)this.delete_line(a.lines[0],!1)}set_display_node(a,b=!0){a!=this.display_node&&(this.display_node=
a,b&&le(!0))}set_template_node(a,b=!0){a.disp_template=!a.disp_template;a.disp_template?this.tdisp_nodes.push(a):se(dd.tdisp_nodes,a);b&&le(!0)}set_glob_var_node(a,b,l){a.set_enable_active_dirty(l);a.enable_active?this.glob_var_nodes.push(a):se(dd.glob_var_nodes,a);b&&le(!0)}set_input_node(a,b=!0){a.receives_input=!a.receives_input;a.receives_input?this.input_nodes.push(a):se(dd.input_nodes,a);b&&gd()}nodes_add_decor(a,b=null){if(null===b||void 0===b)b=this.alloc_graphic_obj_id();a.uid=b;this.nodes_decor.push(a);
this.obj_map[a.uid]=a}delete_decor(a){se(this.nodes_decor,a);delete this.obj_map[a.uid];gd()}}var dd=null;function Ue(){ve(!1,!1);dd=new pj}function Sd(a,b,l){console.assert(b.__proto__ instanceof ye,"Assert with the node.cls");console.assert(void 0!==b&&void 0!==l);if(!a)throw{message:l,node_cls:b};}function Id(a,b){if(!a)throw Error(b);}
function Df(){let a=Qh.create();rf.t_viewport=a;let b;sf.width>sf.height?(b=.5*sf.height,rf.margin_x=(sf.width-sf.height)/sf.height,rf.margin_y=0):(b=.5*sf.width,rf.margin_y=(sf.height-sf.width)/sf.width,rf.margin_x=0);rf.viewport_zoom=b*rf.zoom;Qh.scale(a,a,Ff.fromValues(rf.viewport_zoom,rf.viewport_zoom));Qh.translate(a,a,Ff.fromValues(1+rf.margin_x+rf.pan_x/b,1+rf.margin_y+rf.pan_y/b));a[6]=Math.round(a[6]);a[7]=Math.round(a[7]);rf.t_inv_viewport=Qh.create();Qh.invert(rf.t_inv_viewport,a);for(let l of dd.nodes)l.cls.dirty_viewport()}
function od(a){const b=a.from_term.get_ctrl_block();Sd(null!==b,a.from_term.owner.cls,"No output from node "+a.from_term.owner.name);a.to_term.intr_set(b,a.from_term.get_cur_uver())}
async function Co(a,b){if(a._last_visited_fv!=Nj){a._last_visited_fv=Nj;var l=a.cls.is_picking_lines(),e=!1;for(let g of a.inputs){if(0!==g.kind&&1!==g.kind)continue;let m=g.lines;var f=null;if(l&&0===g.kind){m=a.cls.pick_lines(g);var h=g.lines;f=m;const q=[];for(let r of h){h=!1;for(let B of f)if(r===B){h=!0;break}h||q.push(r)}f=q}for(let q of m)e|=await Co(q.from_term.owner,b);if(null!==f)for(let q of f)await Co(q.from_term.owner,!1)}a.cls.nresolve_variables(!0);if(!b)return!1;if(b=a.has_anything_dirty(e)||
(0===a.nkind||1===a.nkind)&&!a.has_cached_output()){if(a.cls.should_clear_out_before_run())for(let g of a.outputs)g.clear();if(l)a.cls.vars_in.collect_terminal();else for(let g of a.inputs)0!==g.kind&&1!==g.kind||g.collect_terminal();a.cls.nresolve_variables(!1);if(!a.check_params_errors())throw{message:"Parameter error",node_cls:a.cls};(l=a.cls.run())&&"function"===typeof l.then&&await l;a.clear_dirty()}return b}}function we(a,b){null===a.get_error()&&a.nset_error({message:b});gd()}
var Do={draw:!1,do_run:!1,clear_all:!1};function le(a,b=!1){Do.draw=!0;Do.do_run|=a;Do.clear_all|=b}function Eo(){Do.draw=!1;Do.do_run=!1;Do.clear_all=!1}function Ri(a,b,l=!0){return function(){Eo();let e;try{e=a.apply(null,arguments)}catch(f){if(void 0===f.node_cls)throw f;Eo();we(f.node_cls,f.message);console.error(f);return}if(Do.draw&&!tg.run){l&&ue();const f=Do.do_run,h=Do.clear_all;Eo();ng(f,h);Eo()}return e}}function Le(a,b,l,e=0){l=Ri(l,b+"-"+a,1!=e);a.addEventListener(b,l);return l}
function Lf(a,...b){for(let l of b)l.addEventListener(a,function(e){e.stopPropagation()})}var Fo=!1;async function ng(a,b,l=null){if(Fo)return null;Fo=!0;try{const e=await Go(a,b);l&&l(!0);return e}catch(e){return l&&l(!1),console.error(e),null}finally{Fo=!1}}var Nj=1;
async function Go(a,b){var l=performance.now(),e=l-vg;500<e&&(rg.innerText=(ug/(e/1E3)).toFixed(1)+" fps",vg=l,ug=0);++ug;Wk.reset_to_latest_max();l=await dd.anim_flow.pget_anim_traits();e=new Set;let f=null;for(let D of dd.glob_var_nodes)e.add(D);null===dd.display_node?Hg(null,null):(e.add(dd.display_node),f=dd.display_node.outputs[0].get_const());for(let D of dd.tdisp_nodes)e.add(D);if(0<Fc.length)for(let D of Fc)D.can_run_on_select&&e.add(D);let [h,g]=[e,f];if(0<h.size&&(a||null===g)){if(b)try{a=
dd;for(var m of a.nodes){m._node_dirty=!0;m.reeval_all_exprs();for(var q of m.outputs)q.clear()}}catch(D){return console.error("Error in do_clear_all: "+D),null}m=dd;q=!1;for(var r of m.nodes)q|=null!==r.cls.get_error(),r.cls.clear_error();q&&gd();m=!1;for(var B of h)try{await Co(B,!0)}catch(D){r=D;if(void 0===r.node_cls)throw r;we(r.node_cls,r.message);console.error(r);B===dd.display_node&&(m=!0)}m?g=null:null!==dd.display_node&&(g=dd.display_node.outputs[0].get_const())}if(!l.render)return++Nj,
l;Hg(g,dd.display_node);null!==dd.display_node&&null===g&&we(dd.display_node.cls,"No output generated");if(null!==g)try{await g.pre_draw(rf.t_viewport,dd.display_node.display_values)}catch(D){null!==dd.display_node&&we(dd.display_node.cls,D.message)}zd.fillStyle="#fff";zd.fillRect(0,0,sf.width,sf.height);Zn.length=0;if(null!==g)try{g.draw(rf.t_viewport,dd.display_node.display_values)}catch(D){null!==dd.display_node&&we(dd.display_node.cls,D.message)}if(0<Fc.length)for(let D of Fc)try{D.cls.draw_selection(rf.t_viewport)}catch(F){we(D.cls,
F.message)}for(let D of dd.tdisp_nodes)if(B=D.outputs[0].get_const(),null===B)we(D.cls,"No output generated");else try{B.draw_template(rf.t_viewport)}catch(F){we(D.cls,F.message)}++Nj;return l}
class Bo{constructor(){this.current_node=null;this.event_nodes=[];this.default_anim_traits=new On}toggle_event_node(a){a.enable_active=!a.enable_active;a.enable_active?this.event_nodes.push(a):se(this.event_nodes,a)}async check_events(){for(let a of this.event_nodes)if(a.cls.clear_flow_hijack(),await Co(a,!0),a.cls.want_flow_hijack())return this.current_node=a,!0;return!1}async pget_anim_traits(){await this.check_events();if(null===this.current_node||0==this.event_nodes.length)return this.default_anim_traits;
let a;do if(null===this.current_node?a=this.default_anim_traits:(await Co(this.current_node,!0),a=this.current_node.cls.get_anim_traits()),a.next){a:{for(let l of this.current_node.outputs)if(2==l.kind){var b=l;break a}b=null}0===b.lines.length?this.current_node=null:(b=b.lines[0].to_term.owner,b!==this.current_node&&(this.current_node.cls.exiting(),this.current_node=b,this.current_node.cls.entered()))}while(a.next);return a}}
class Ho{constructor(){this.run=!1;this.pre_draw_handlers=[];this.globals_vars_box=new Jj;this.frame_num_box=new Mj;this.frame_num_box.vbset(-1,1);this.globals_vars_box.add("frame_num",this.frame_num_box);this.start_time=null;this.frame_time=0;this.fixed_refs=[this.globals_vars_box.make_ref("frame_num")]}rewind(){this.frame_num_box.vbset(-1,1);const a=this.run;this.run=!1;a||window.requestAnimationFrame(Io)}start(){this.run=!0;this.start_time=performance.now();window.requestAnimationFrame(Io)}pause(){this.run=
!1}one_next(){this.run=!1;window.requestAnimationFrame(Io)}set_frame_num(a){this.run||(this.frame_num_box.vbset(a,1),window.requestAnimationFrame(Io))}reg_pre_draw(a){this.pre_draw_handlers.push(a)}notify_pre_draw(){for(let a of this.pre_draw_handlers)a(tg.frame_num_box.v,this.frame_time,this.run)}}var tg=new Ho;
async function Io(){let a=null,b=1,l=0;for(;l<b;)if(tg.frame_num_box.vbset(tg.frame_num_box.v+1,1),tg.notify_pre_draw(),a=await ng(!0,!1,null),null===a&&(a=tg.default_anim_traits),++l,-2===a.frame_rate&&tg.run)b=a.blocking_frames;else break;tg.run&&(-1===a.frame_rate?window.requestAnimationFrame(Io):-2===a.frame_rate?window.postMessage(424242,"*"):Id(!1,"unexpected frame_rate"))}window.addEventListener("message",function(a){a.source==window&&424242==a.data&&(a.stopPropagation(),Io())},!0);
const kf=[{group_name:"Geometry",nodes:[Tj,Zj,zk,ek,ik,jk,lk,pk,vk,Bm,wk,yk,Om,Pm,Ck,oo]},{group_name:"Image",nodes:[Fm,Jk,rm,Am,ln,mn,hn,Dm,Hm]},{group_name:"Distance Field",nodes:[un,wn,En,Gn,In,Jn]},{group_name:"Flow",nodes:[Kn,Ln,Pn,Qn,Rn]},{group_name:"Physics",nodes:[io,ko,lo,mo,no]},{group_name:"Variables",nodes:[Pj,Qj]},{group_name:"Groups",nodes:[sk,tk]},{group_name:"I/O",nodes:[po]},uk];var qj={};
for(let a of kf)if(void 0===a.group_name)qj[a.name()]=a;else for(let b of a.nodes)qj[b.name()]=b;qj.Manual_Points=Zj;qj["Shrink Faces"]=Ck;qj.Geom_Primitive=Tj;qj.Scatter=vk;qj.Scatter2=Bm;qj["Distance Field Primitive"]=un;qj["Distance Field Combine"]=En;qj["Event Flow"]=Pn;var Jo=[Be],rj={};for(let a of Jo)rj[a.name()]=a;
window.page_onload=function(){De=Lg(body,null,"main_view");uo=Lg(De,null,"image_panel");sf=Kg(uo,"canvas",null,"canvas_image");Wk=Kg(uo,"canvas",null,"canvas_webgl");Gf=Kg(uo,"canvas",null,"canvas_img_shadow");zo=Lg(De,"splitter","image_splitter");wo=Lg(De,null,"edit_panel");rk=Lg(wo,null,"edit_params");zg=Lg(rk,null,"div_params_list");Ig=Ce(rk,"div_display_params_cont");Ao=Lg(wo,"splitter","edit_splitter");Qe=Ce(wo);pf=Kg(Qe,"canvas",null,"canvas_nodes");Oe=Kg(body,"canvas",null,"canvas_nd_shadow");
ld=Ce(De,"hover_box");nj=!0;so();nd=new yf(pf);rf=new Cf;Lc=pf.getContext("2d");Mc=Oe.getContext("2d",{alpha:!1});zd=sf.getContext("2d");Bd=Gf.getContext("2d");pc.project=new pc.Project(null);zd.makePath2D=function(){return new Path2D};zd.need_antialias_gap_fill=!0;Ue();try{sj()}catch(a){console.error("failed load "+a)}um(Wk);wf(De,zo,to,vo);vf(wo,Ao,xo,yo);qg(De);sg();Hf(nd,pf,"_nodes");Hf(rf,sf,"_image");Jf(rf,sf);Jf(nd,pf);Nf();rf.resize_redraw();gd();Df();Io();Eo();nj=!1};
